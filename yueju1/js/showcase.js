/*! For license information please see showcase.js.LICENSE.txt */
(()=>{var e,t,i,n,s={87207:(e,t,i)=>{"use strict";e.exports=i.p+"images/chrome.png"},75673:(e,t,i)=>{"use strict";e.exports=i.p+"images/edge.png"},68472:(e,t,i)=>{"use strict";e.exports=i.p+"images/firefox.png"},81826:(e,t,i)=>{"use strict";e.exports=i.p+"images/safari.png"},24877:(e,t,i)=>{"use strict";e.exports=i.p+"images/showcase-password-background.jpg"},90831:(e,t,i)=>{"use strict";e.exports=i.p+"images/matterport-logo-light.svg"},8243:(e,t,i)=>{"use strict";function n(){var e=window.analytics=window.analytics||[];if(!e.initialize)if(e.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{e.invoked=!0,e.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"],e.factory=function(t){return function(){var i=Array.prototype.slice.call(arguments);return i.unshift(t),e.push(i),e}};for(var t=0;t<e.methods.length;t++){var i=e.methods[t];e[i]=e.factory(i)}e.load=function(t,i){var n=document.createElement("script");n.type="text/javascript",n.async=!0,n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(n,s),e._loadOptions=i},e.SNIPPET_VERSION="4.1.0"}}i.r(t),i.d(t,{SegmentBootstrap:()=>n})},89992:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHg9IjAiIHk9IjAiIHZpZXdCb3g9IjAgMCAyMzAuMDUgNDkuNzUiIHhtbDpzcGFjZT0icHJlc2VydmUiPjxzdHlsZT4uc3Qwe2ZpbGw6I2Y1ZjRmM30uc3Qye2ZpbGw6I2ZmZn0uc3Qze2ZpbGw6Izk5OX08L3N0eWxlPjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik02MS4yOCAzNi4xNHYtOC44MmwtLjI0LTUuMDkuMTktLjA0IDIuMDUgNC41NCA0LjgyIDguODYgNC44Mi04Ljg2IDIuMDYtNC41NC4xOC4wNC0uMjQgNS4wOXY4LjgyaDUuMTRWMTQuNGgtNS44MWwtNi4xMSAxMS43N2gtLjA3TDYxLjk1IDE0LjRoLTUuODF2MjEuNzR6TTIxMi42OSAzMC42M2MwIDMuNiAxLjk0IDUuNSA1LjYxIDUuNWgzLjE3di00LjQ1aC0zLjQ1di05LjQ5aDMuNzR2LTQuMzZoLTQuMTV2LTQuMjFoLTQuOTF2MTcuMDF6TTIxMS4yNiAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzSDIwMHYxOC4zMWg1LjMyVjI1LjcyYzAtMS4wOC40MS0xLjg0LjkzLTIuMzMuODktLjg2IDIuNzktMS4xMSA1LjAxLTEuMTF2LTQuNDV6TTE1OC42MyAxNy44M2gtLjg3Yy0zLjAxIDAtNC40NCAyLjAzLTQuODkgMy40M2gtLjE4di0zLjQzaC01LjMydjE4LjMxaDUuMzJWMjUuNzJjMC0xLjA4LjQxLTEuODQuOTMtMi4zMy44OS0uODYgMi43OS0xLjExIDUuMDEtMS4xMXYtNC40NXpNMTI3LjQ4IDI3LjI1YzAtNS45NyAzLjE3LTkuODYgOC44NS05Ljg2IDYuMjYgMCA4Ljc4IDQuNTMgOC43OCA5LjY0djEuNThoLTEyLjEydi4xOGMwIDIuMTIgMS4xNCAzLjYgNC4xNyAzLjYgMi4yMyAwIDMuNDUtMS4wNCA0LjY0LTIuMjdsMi42NiAzLjMxYy0xLjY5IDEuOTQtNC40NiAzLjEzLTcuOTEgMy4xMy01LjguMDEtOS4wNy0zLjI3LTkuMDctOS4zMXptNS41LTIuMDV2LjI5aDYuNjJ2LS4zMmMwLTIuMy0xLjA0LTMuODUtMy4xNy0zLjg1cy0zLjQ1IDEuNTQtMy40NSAzLjg4ek0xODAuMDQgMjcuMjVjMC02LjA4IDMuMzEtOS44NiA4Ljg1LTkuODYgNS41NCAwIDguODUgMy43OCA4Ljg1IDkuODZzLTMuMzEgOS4zMi04Ljg1IDkuMzJjLTUuNTUgMC04Ljg1LTMuMjQtOC44NS05LjMyem0xMi4xNSAxLjM3di0zLjI3YzAtMi4zNy0xLjIyLTMuNzQtMy4zMS0zLjc0cy0zLjMxIDEuMzctMy4zMSAzLjc0djMuMjdjMCAyLjM3IDEuMjIgMy43NCAzLjMxIDMuNzRzMy4zMS0xLjM3IDMuMzEtMy43NHpNMTIyLjQyIDEzLjYyaC00Ljc4djIuMTljMCAxLjMtLjQzIDIuMDEtMS44NyAyLjAxaC0xLjMzdjQuMzZoMi42NnY4LjQ0YzAgMy42IDEuOTQgNS41IDUuNjEgNS41aDMuMTd2LTQuNDVoLTMuNDV2LTkuNDloMy43NHYtNC4zNmgtMy43NHYtNC4yek0xMDkuMTcgMTMuNjJoLTQuNzh2Mi4xOWMwIDEuMy0uNDMgMi4wMS0xLjg3IDIuMDFoLTEuMzN2NC4zNmgyLjY2djguNDRjMCAzLjYgMS45NCA1LjUgNS42MSA1LjVoMy4xN3YtNC40NWgtMy40NXYtOS40OWgzLjc0di00LjM2aC0zLjc0di00LjJ6TTE3MC45IDE3LjM5Yy0yLjQ1IDAtNC41MyAxLjUxLTUuMDcgMy42aC0uMTh2LTMuMTdoLTUuMzJ2MjMuODJoNS4zMnYtOC42N2guMThjLjU0IDIuMDUgMi42MyAzLjYgNS4wNyAzLjYgNC43OCAwIDcuMjctMi45MSA3LjI3LTkuMzItLjAxLTYuNC0yLjQ5LTkuODYtNy4yNy05Ljg2em0xLjcyIDExLjUyYzAgMi4zNy0xLjQ4IDMuMzUtMy40OSAzLjM1LTIuMDEgMC0zLjQ5LTEuMDQtMy40OS0yLjc3di01YzAtMS43MyAxLjQ4LTIuNzcgMy40OS0yLjc3IDIuMDEgMCAzLjQ5IDEuNTUgMy40OSAzLjkydjMuMjd6TTk3LjgzIDM2LjE0Yy0xLjkxIDAtMy4yNy0xLjMtMy42LTMuMzFoLS4yMmMtLjU4IDIuNDUtMi42NiAzLjc0LTUuNTQgMy43NC0zLjc4IDAtNS44Ni0yLjIzLTUuODYtNS41IDAtMy45OSAzLjA5LTUuOSA4LjA5LTUuOWgyLjk5di0uNjFjMC0xLjgzLS45LTIuOTktMy4xMy0yLjk5LTIuMTIgMC0zLjI0IDEuMDgtNC4wNiAyLjIzbC0zLjE3LTIuODFjMS41MS0yLjIzIDMuNjctMy42IDcuNjMtMy42IDUuMzIgMCA4LjA2IDIuNDUgOC4wNiA2LjkxdjcuMzhoMS43NnY0LjQ1aC0yLjk1em0tNC4xMy01Ljcydi0yLjIzaC0yLjU5Yy0yLjA1IDAtMy4xMy43Ni0zLjEzIDIuMTJ2LjU0YzAgMS4zNy45IDIuMDEgMi40OCAyLjAxIDEuNzYgMCAzLjI0LS43MiAzLjI0LTIuNDR6Ii8+PGc+PHBhdGggZD0iTTM5LjA1IDYuOTFMMjYuMjQgMTAuNSAxMy40MiA2LjkxIDguMyA4LjM1djMzLjA2bDUuMTMgMS40NCAxMi44Mi0zLjU5IDEyLjgyIDMuNTkgNS4xMy0xLjQ0VjguMzVsLTUuMTUtMS40NHptLTUuMTIgMjQuNjdsLTcuNjktMi4xNS03LjY5IDIuMTV2LTEzLjRsNy42OSAyLjE1IDcuNjktMi4xNXYxMy40eiIgZmlsbD0iI2I3YmFiYiIvPjxwYXRoIGNsYXNzPSJzdDIiIGQ9Ik0yNi4yNCAxMy4zN3Y2Ljk2bC0xMi44Mi0zLjU5djI2LjFMOC4zIDQxLjQxVjguMzV6TTMzLjkzIDM0LjQ1bC03LjY5LTIuMTZ2Ni45NmwxMi44MSAzLjU5di0yNi4xbC01LjEyIDEuNDR6Ii8+PGc+PHBhdGggY2xhc3M9InN0MyIgZD0iTTM5LjA1IDYuOTFsNS4xMyAxLjQ0LTE3Ljk0IDUuMDJMOC4zIDguMzVsNS4xMi0xLjQ0IDEyLjgyIDMuNTl6TTI2LjI0IDI5LjQybDcuNjkgMi4xNnYyLjg3bC03LjY5LTIuMTYtNy42OSAyLjE2di0yLjg3eiIvPjwvZz48L2c+PC9zdmc+"},31896:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODQiIGhlaWdodD0iODQiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj48cGF0aCBkPSJNNDIgMEMxOC43OSAwIDAgMTguNzkgMCA0MnMxOC43OSA0MiA0MiA0MiA0Mi0xOC43OSA0Mi00MlM2NS4yMSAwIDQyIDB6IiBmaWxsLW9wYWNpdHk9Ii4yNSIgZmlsbD0iIzAwMCIgZmlsbC1ydWxlPSJub256ZXJvIi8+PHBhdGggZD0iTTUxLjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6TTM0LjUgNTdoLTJhLjUuNSAwIDAxLS41LS41di0yOGEuNS41IDAgMDEuNS0uNWgyYS41LjUgMCAwMS41LjV2MjhhLjUuNSAwIDAxLS41LjV6IiBmaWxsPSIjRkZGIi8+PC9nPjwvc3ZnPg=="},78899:(e,t,i)=>{"use strict";e.exports=i.p+"images/escape.png"},49529:(e,t,i)=>{"use strict";e.exports=i.p+"images/headset-quest-2.png"},31891:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-play-button.svg"},71002:(e,t,i)=>{"use strict";e.exports=i.p+"images/Desktop-help-spacebar.png"},14653:(e,t,i)=>{"use strict";e.exports=i.p+"images/mattertag-disc-128-free.v1.png"},94874:(e,t,i)=>{"use strict";e.exports=i.p+"images/mobile-help-play-button.svg"},86533:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_360.png"},70626:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_click_inside.png"},72145:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag.png"},12742:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_drag_two_finger.png"},5435:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_pinch.png"},67649:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position.png"},2433:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_position_two_finger.png"},24367:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_gesture_tap.png"},64549:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_inside_key.png"},76064:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_all.png"},81202:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_left_right.png"},42135:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_keyboard_up_down.png"},41891:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_click.png"},73993:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_left.png"},26668:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_drag_right.png"},82906:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_left.png"},64991:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_position_right.png"},12136:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_mouse_zoom.png"},90619:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_tap_inside.png"},26407:(e,t,i)=>{"use strict";e.exports=i.p+"images/nav_help_zoom_keys.png"},22016:e=>{"use strict";e.exports=JSON.parse('{"v":"4.8.0","meta":{"g":"LottieFiles AE 1.0.0","a":"","k":"","d":"","tc":""},"fr":60,"ip":0,"op":60,"w":876,"h":744,"nm":"Rating Modal","ddd":0,"assets":[],"layers":[{"ddd":0,"ind":1,"ty":4,"nm":"Vector 2","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":0,"s":[0]},{"t":4,"s":[100]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":0,"s":[437.969,578.877,0],"to":[0,-8.167,0],"ti":[0,8.167,0]},{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":18,"s":[437.969,529.877,0],"to":[0,0,0],"ti":[0,0,0]},{"t":25,"s":[437.969,529.877,0]}],"ix":2},"a":{"a":0,"k":[0,51.205,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.83,0.808,0.833],"y":[1.233,0.833,0.35]},"o":{"x":[0.283,0.284,0],"y":[-0.056,-0.064,0]},"t":0,"s":[176.81,195.773,100]},{"i":{"x":[0.564,0.562,0.794],"y":[3.244,0.849,2.131]},"o":{"x":[0.466,0.473,0.167],"y":[-4.295,-0.161,0.141]},"t":23,"s":[207.791,222.842,100]},{"t":28,"s":[207.791,207.791,100]}],"ix":6}},"ao":0,"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[2.52,0.008],[0,0],[0,0],[0.001,-0.183],[-8.335,-0.035],[-1.024,7.367],[-0.728,2.537],[0,0],[2.38,0.806],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2.516,0.006],[0,0],[0,0],[0.432,0.025],[0,0],[2.518,0.008],[0,0],[0,0],[0.409,-0.037],[0,0],[2.516,0.006],[0,0],[0,0],[0.401,-0.185],[0,0]],"o":[[-2.516,-0.006],[0,0],[0,0],[-0.027,8.335],[7.643,0.021],[0.358,-2.606],[0,0],[0,0],[-2.387,-0.816],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-2.514,-0.01],[0,0],[-0.415,-0.039],[0,0],[0,0],[-2.518,-0.01],[0,0],[-0.423,0.021],[0,0],[0,0],[-2.514,-0.008],[0,0],[-0.44,0.144],[0,0],[0,0]],"v":[[-33.701,-15.143],[-36.223,-12.631],[-36.281,6.241],[-36.285,7.503],[-21.234,22.652],[-6.23,9.641],[-4.465,1.945],[-2.629,-4.438],[-4.202,-7.63],[-7.4,-6.064],[-11.102,2.545],[-12.356,1.279],[-12.356,0.023],[-12.35,-1.377],[-12.3,-18.852],[-14.806,-21.374],[-17.328,-18.866],[-17.38,-2.341],[-18.642,-2.448],[-18.584,-20.126],[-21.092,-22.652],[-23.616,-20.144],[-23.674,-2.463],[-24.928,-2.376],[-24.885,-17.628],[-27.394,-20.155],[-29.917,-17.645],[-29.968,-1.429],[-31.228,-0.933],[-31.189,-12.617]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[-2.52,0.008],[0,0],[0,0],[-0.001,-0.183],[8.335,-0.035],[1.024,7.367],[0.728,2.537],[0,0],[-2.378,0.806],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[-2.516,0.006],[0,0],[0,0],[-0.432,0.025],[0,0],[-2.518,0.008],[0,0],[0,0],[-0.407,-0.037],[0,0],[-2.518,0.006],[0,0],[0,0],[-0.399,-0.185],[0,0]],"o":[[2.516,-0.006],[0,0],[0,0],[0.029,8.335],[-7.645,0.021],[-0.358,-2.606],[0,0],[0,0],[2.389,-0.816],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[2.514,-0.01],[0,0],[0.415,-0.039],[0,0],[0,0],[2.518,-0.01],[0,0],[0.426,0.021],[0,0],[0,0],[2.514,-0.008],[0,0],[0.438,0.144],[0,0],[0,0]],"v":[[33.701,-15.143],[36.223,-12.631],[36.281,6.241],[36.285,7.503],[21.234,22.652],[6.23,9.641],[4.465,1.945],[2.629,-4.438],[4.202,-7.63],[7.4,-6.064],[11.102,2.545],[12.354,1.279],[12.354,0.023],[12.348,-1.377],[12.298,-18.852],[14.804,-21.374],[17.328,-18.866],[17.38,-2.341],[18.642,-2.448],[18.584,-20.126],[21.092,-22.652],[23.618,-20.144],[23.674,-2.463],[24.928,-2.376],[24.882,-17.628],[27.394,-20.155],[29.917,-17.645],[29.968,-1.429],[31.226,-0.933],[31.187,-12.617]],"c":true},"ix":2},"nm":"Path 2","mn":"ADBE Vector Shape - Group","hd":false},{"ind":2,"ty":"sh","ix":3,"ks":{"a":0,"k":{"i":[[0,0],[3.333,-0.333]],"o":[[-1.2,-5.2],[0,0]],"v":[[22.51,8.041],[11.01,2.541]],"c":false},"ix":2},"nm":"Path 3","mn":"ADBE Vector Shape - Group","hd":false},{"ind":3,"ty":"sh","ix":4,"ks":{"a":0,"k":{"i":[[0,0],[-3.333,-0.333]],"o":[[1.2,-5.2],[0,0]],"v":[[-21.99,7.614],[-10.49,2.114]],"c":false},"ix":2},"nm":"Path 4","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge","hd":false},{"ty":"st","c":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":2,"s":[1,0.192156862745,0.345098039216,1]},{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":19,"s":[1,0.192156862745,0.345098039216,1]},{"t":26,"s":[0.133333333333,0.133333333333,0.133333333333,1]}],"ix":3},"o":{"a":0,"k":100,"ix":4},"w":{"a":0,"k":2,"ix":5},"lc":1,"lj":1,"ml":4,"bm":0,"nm":"Stroke 1","mn":"ADBE Vector Graphic - Stroke","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Vector","np":6,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":0,"op":300,"st":0,"bm":0},{"ddd":0,"ind":2,"ty":4,"nm":"Vector","sr":1,"ks":{"o":{"a":1,"k":[{"i":{"x":[0.833],"y":[0.833]},"o":{"x":[0.167],"y":[0.167]},"t":23,"s":[0]},{"t":27,"s":[100]}],"ix":11},"r":{"a":0,"k":0,"ix":10},"p":{"a":0,"k":[435.195,196.412,0],"ix":2},"a":{"a":0,"k":[0,0,0],"ix":1},"s":{"a":1,"k":[{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":23,"s":[209.366,209.366,100]},{"i":{"x":[0.833,0.833,0.833],"y":[0.833,0.833,0.833]},"o":{"x":[0.167,0.167,0.167],"y":[0.167,0.167,0.167]},"t":31,"s":[257.214,257.214,100]},{"t":35,"s":[209.366,209.366,100]}],"ix":6}},"ao":0,"hasMask":true,"masksProperties":[{"inv":false,"mode":"a","pt":{"a":1,"k":[{"i":{"x":0.833,"y":0.833},"o":{"x":0.167,"y":0.167},"t":23,"s":[{"i":[[33.137,0],[0,-33.137],[-33.137,0],[0,33.137]],"o":[[-33.137,0],[0,33.137],[33.137,0],[0,-33.137]],"v":[[-0.955,14.988],[-60.955,74.988],[-0.955,134.988],[59.045,74.988]],"c":true}]},{"t":31,"s":[{"i":[[47.354,0],[0,-47.354],[-47.354,0],[0,47.354]],"o":[[-47.354,0],[0,47.354],[47.354,0],[0,-47.354]],"v":[[0.906,-36.975],[-84.837,48.768],[0.906,134.511],[86.648,48.768]],"c":true}]}],"ix":1},"o":{"a":0,"k":100,"ix":3},"x":{"a":0,"k":0,"ix":4},"nm":"Mask 1"}],"shapes":[{"ty":"gr","it":[{"ind":0,"ty":"sh","ix":1,"ks":{"a":0,"k":{"i":[[-0.9,-0.695],[-0.438,0],[-0.403,0.524],[0,0],[0.9,0.695],[0.689,-0.896],[0,0]],"o":[[0.372,0.288],[0.617,0],[0,0],[0.695,-0.898],[-0.898,-0.699],[0,0],[-0.695,0.898]],"v":[[10.071,7.71],[11.325,8.137],[12.953,7.34],[19.076,-0.584],[18.706,-3.468],[15.825,-3.098],[9.701,4.826]],"c":true},"ix":2},"nm":"Path 1","mn":"ADBE Vector Shape - Group","hd":false},{"ind":1,"ty":"sh","ix":2,"ks":{"a":0,"k":{"i":[[0,0],[-0.615,0],[-0.376,0.29],[0.693,0.898],[0,0],[0.898,-0.693],[-0.693,-0.898]],"o":[[0.405,0.524],[0.44,0],[0.898,-0.695],[0,0],[-0.697,-0.898],[-0.898,0.695],[0,0]],"v":[[-12.955,7.338],[-11.327,8.137],[-10.069,7.71],[-9.699,4.826],[-15.823,-3.098],[-18.707,-3.468],[-19.079,-0.584]],"c":true},"ix":2},"nm":"Path 2","mn":"ADBE Vector Shape - Group","hd":false},{"ind":2,"ty":"sh","ix":3,"ks":{"a":0,"k":{"i":[[0,0],[-1.135,0],[0,1.135],[0,0],[1.137,0],[0,-1.135]],"o":[[0,1.135],[1.137,0],[0,0],[0,-1.135],[-1.135,0],[0,0]],"v":[[-2.12,2.14],[-0.065,4.196],[1.991,2.14],[1.991,-6.082],[-0.065,-8.137],[-2.12,-6.082]],"c":true},"ix":2},"nm":"Path 3","mn":"ADBE Vector Shape - Group","hd":false},{"ty":"mm","mm":1,"nm":"Merge Paths 1","mn":"ADBE Vector Filter - Merge","hd":false},{"ty":"fl","c":{"a":0,"k":[0.131453797221,0.131453797221,0.131453797221,1],"ix":4},"o":{"a":0,"k":100,"ix":5},"r":1,"bm":0,"nm":"Fill 1","mn":"ADBE Vector Graphic - Fill","hd":false},{"ty":"tr","p":{"a":0,"k":[0,0],"ix":2},"a":{"a":0,"k":[0,0],"ix":1},"s":{"a":0,"k":[300,300],"ix":3},"r":{"a":0,"k":0,"ix":6},"o":{"a":0,"k":100,"ix":7},"sk":{"a":0,"k":0,"ix":4},"sa":{"a":0,"k":0,"ix":5},"nm":"Transform"}],"nm":"Vector","np":5,"cix":2,"bm":0,"ix":1,"mn":"ADBE Vector Group","hd":false}],"ip":23,"op":253,"st":-47,"bm":0}],"markers":[]}')},63064:e=>{"use strict";e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTQyIiBoZWlnaHQ9IjE0MiIgdmlld0JveD0iMCAwIDE0MiAxNDIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxwYXRoIGQ9Ik04MiA4Mi41MDAxQzg1LjMzMzMgODIuMTY2NyA5Mi4zIDgyLjgwMDEgOTMuNSA4OC4wMDAxTTYwLjUgODIuMDczM0M1Ny4xNjY3IDgxLjc0IDUwLjIgODIuMzczMyA0OSA4Ny41NzMzTTM0Ljc2NjggNjcuMzI3NUMzNC43NjY4IDY3LjMyNzUgMzQuNzczIDY0LjgwOTQgMzcuMjg5IDY0LjgxNTZDMzkuODA5MSA2NC44MjM4IDM5LjgwMDkgNjcuMzQxOSAzOS44MDA5IDY3LjM0MTlMMzkuNzYxOCA3OS4wMjU3QzQwLjE2MjcgNzguODQwNyA0MC41ODIgNzguNjc0MiA0MS4wMjE5IDc4LjUzMDNMNDEuMDczMyA2Mi4zMTRDNDEuMDczMyA2Mi4zMTQgNDEuMDgxNSA1OS43OTYgNDMuNTk1NCA1OS44MDQyQzQ2LjExMTQgNTkuODEwMyA0Ni4xMDUzIDYyLjMzMDUgNDYuMTA1MyA2Mi4zMzA1TDQ2LjA2MjEgNzcuNTgyN0M0Ni40NzEyIDc3LjU0NTcgNDYuODkyNSA3Ny41MTY5IDQ3LjMxNiA3Ny40OTYzTDQ3LjM3MzUgNTkuODE0NUM0Ny4zNzM1IDU5LjgxNDUgNDcuMzc5NyA1Ny4yOTY0IDQ5Ljg5NzggNTcuMzA2N0M1Mi40MTU4IDU3LjMxNDkgNTIuNDA1NSA1OS44MzI5IDUyLjQwNTUgNTkuODMyOUw1Mi4zNDggNzcuNTEwN0M1Mi43Nzk3IDc3LjUzNTQgNTMuMTk0OSA3Ny41Nzg2IDUzLjYxMDEgNzcuNjE3Nkw1My42NjE1IDYxLjA5M0M1My42NjE1IDYxLjA5MyA1My42Njk3IDU4LjU3NDkgNTYuMTgzNyA1OC41ODUyQzU4LjY5OTcgNTguNTkxNCA1OC42ODk0IDYxLjEwNzQgNTguNjg5NCA2MS4xMDc0TDU4LjY0IDc4LjU4MTdMNTguNjMzOSA3OS45ODE1VjgxLjIzNzRMNTkuODg3OCA4Mi41MDM3TDYzLjU4OTggNzMuODk1QzYzLjU4OTggNzMuODk1IDY0LjQwMTggNzEuNTEyNiA2Ni43ODgzIDcyLjMyODdDNjkuMTY4NiA3My4xMzQ0IDY4LjM2MDggNzUuNTIxIDY4LjM2MDggNzUuNTIxTDY2LjUyNTIgODEuOTAzNUM2NS43OTc1IDg0LjQ0IDY1LjExNzEgODYuOTkzIDY0Ljc1OTQgODkuNTk5NEM2My43MzU4IDk2Ljk2NjYgNTcuMzk4NSAxMDIuNjMyIDQ5Ljc1NTkgMTAyLjYxMUM0MS40MjA3IDEwMi41NzYgMzQuNjc4NCA5NS43OTY5IDM0LjcwNTIgODcuNDYxN0MzNC43MDYgODcuMjc4NyAzNC43MDkzIDg2LjE5OTYgMzQuNzA5MyA4Ni4xOTk2TDM0Ljc2NjggNjcuMzI3NVpNMTA3LjIxMyA2Ny4zMjc1QzEwNy4yMTMgNjcuMzI3NSAxMDcuMjA3IDY0LjgwOTQgMTA0LjY5MSA2NC44MTU2QzEwMi4xNzEgNjQuODIzOCAxMDIuMTc3IDY3LjM0MTkgMTAyLjE3NyA2Ny4zNDE5TDEwMi4yMTYgNzkuMDI1N0MxMDEuODE3IDc4Ljg0MDcgMTAxLjM5NiA3OC42NzQyIDEwMC45NTggNzguNTMwM0wxMDAuOTA2IDYyLjMxNEMxMDAuOTA2IDYyLjMxNCAxMDAuODk4IDU5Ljc5NiA5OC4zODQyIDU5LjgwNDJDOTUuODY2MSA1OS44MTAzIDk1Ljg3MjMgNjIuMzMwNSA5NS44NzIzIDYyLjMzMDVMOTUuOTE3NSA3Ny41ODI3Qzk1LjUxMDUgNzcuNTQ1NyA5NS4wODkxIDc3LjUxNjkgOTQuNjYzNiA3Ny40OTYzTDk0LjYwODIgNTkuODE0NUM5NC42MDgyIDU5LjgxNDUgOTQuNTk5OSA1Ny4yOTY0IDkyLjA4MTkgNTcuMzA2N0M4OS41NjM4IDU3LjMxNDkgODkuNTc0MSA1OS44MzI5IDg5LjU3NDEgNTkuODMyOUw4OS42MzE2IDc3LjUxMDdDODkuMiA3Ny41MzU0IDg4Ljc4NDggNzcuNTc4NiA4OC4zNjk1IDc3LjYxNzZMODguMzE4MSA2MS4wOTNDODguMzE4MSA2MS4wOTMgODguMzA3OSA1OC41NzQ5IDg1Ljc5MzkgNTguNTg1MkM4My4yNzc5IDU4LjU5MTQgODMuMjg4MiA2MS4xMDc0IDgzLjI4ODIgNjEuMTA3NEw4My4zMzc1IDc4LjU4MTdMODMuMzQzNyA3OS45ODE1VjgxLjIzNzRMODIuMDkxOSA4Mi41MDM3TDc4LjM4OTggNzMuODk1Qzc4LjM4OTggNzMuODk1IDc3LjU3OTkgNzEuNTEyNiA3NS4xOTE0IDcyLjMyODdDNzIuODEzMSA3My4xMzQ0IDczLjYxODkgNzUuNTIxIDczLjYxODkgNzUuNTIxTDc1LjQ1NDUgODEuOTAzNUM3Ni4xODIxIDg0LjQ0IDc2Ljg2MjUgODYuOTkzIDc3LjIyMDIgODkuNTk5NEM3OC4yNDM5IDk2Ljk2NjYgODQuNTc5MSAxMDIuNjMyIDkyLjIyMzcgMTAyLjYxMUMxMDAuNTU5IDEwMi41NzYgMTA3LjMwMyA5NS43OTY5IDEwNy4yNzQgODcuNDYxN0MxMDcuMjc0IDg3LjI3ODcgMTA3LjI3IDg2LjE5OTYgMTA3LjI3IDg2LjE5OTZMMTA3LjIxMyA2Ny4zMjc1WiIgc3Ryb2tlPSIjMjIyMjIyIiBzdHJva2Utd2lkdGg9IjIiLz4KPHBhdGggZD0iTTgyLjM4OTkgNTYuMjc0OEM4MS45NTIxIDU2LjI3NDggODEuNTA4MSA1Ni4xMzUgODEuMTM2IDU1Ljg0NzJDODAuMjM1NyA1NS4xNTI0IDgwLjA3MTMgNTMuODYxNiA4MC43NjYgNTIuOTYzM0w4Ni44ODk1IDQ1LjAzOTFDODcuNTc4MSA0NC4xNDI5IDg4Ljg3MzEgNDMuOTcwMiA4OS43NzE0IDQ0LjY2OTFDOTAuNjcxOCA0NS4zNjM5IDkwLjgzNjIgNDYuNjU0OCA5MC4xNDE0IDQ3LjU1MzFMODQuMDE3OSA1NS40NzcyQzgzLjYxNSA1Ni4wMDE0IDgzLjAwNjYgNTYuMjc0OCA4Mi4zODk5IDU2LjI3NDhaTTU5LjczNzcgNTYuMjc0OEM1OS4xMjMxIDU2LjI3NDggNTguNTE0NyA1NS45OTkzIDU4LjEwOTcgNTUuNDc1Mkw1MS45ODYyIDQ3LjU1MzFDNTEuMjkzNSA0Ni42NTQ4IDUxLjQ2IDQ1LjM2MzkgNTIuMzU4MyA0NC42NjkxQzUzLjI1NjUgNDMuOTc2NCA1NC41NDU0IDQ0LjE0MDggNTUuMjQyMiA0NS4wMzkxTDYxLjM2NTcgNTIuOTYzM0M2Mi4wNTg0IDUzLjg2MTYgNjEuODk0IDU1LjE1MjQgNjAuOTk1NyA1NS44NDcyQzYwLjYxOTUgNTYuMTM3MSA2MC4xNzc2IDU2LjI3NDggNTkuNzM3NyA1Ni4yNzQ4Wk03MS4wMDAxIDUyLjMzMzNDNjkuODY1NCA1Mi4zMzMzIDY4Ljk0NDUgNTEuNDEyNCA2OC45NDQ1IDUwLjI3NzhWNDIuMDU1NkM2OC45NDQ1IDQwLjkyMDkgNjkuODY1NCA0MCA3MS4wMDAxIDQwQzcyLjEzNjggNDAgNzMuMDU1NiA0MC45MjA5IDczLjA1NTYgNDIuMDU1NlY1MC4yNzc4QzczLjA1NTYgNTEuNDEyNCA3Mi4xMzY4IDUyLjMzMzMgNzEuMDAwMSA1Mi4zMzMzWiIgZmlsbD0iIzIyMjIyMiIvPgo8L3N2Zz4K"},2116:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r,A:()=>o});var n=i(67294),s=i(85861);function r(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,d));e.prototype.shouldComponentUpdate=l}function o(e){if(!e.prototype||!e.prototype.render)return e.__scuWrap||(e.__scuWrap=a(e,s.NK));e.prototype.shouldComponentUpdate=c}function a(e,t){class Wrap extends Wrapper{}return Wrap.prototype.renderChild=e,Wrap.prototype.diffFunc=t,Wrap}class Wrapper extends n.Component{shouldComponentUpdate(e){return this.diffFunc(e,this.props)}render(){return this.renderChild(this.props,this.context)}}function l(e,t){return d(e,this.props)||d(t,this.state)}function c(e,t){return d(e,this.props)||(0,s.NK)(t,this.state)}function d(e,t){for(const i in e)if(e[i]!==t[i])return!0;for(const i in t)if(!(i in e))return!0;return!1}},91975:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgBAMAAACBVGfHAAAAJ1BMVEUAAAD///////////////////////////////////////////////+uPUo5AAAADHRSTlMA4ZNBI+fLwLSGYE5aqgIgAAAAlUlEQVQoz2MAAy91mYNFSxjgwEjmDBAcVIbxPWPOgMHRKRA+c88ZKDhhABbYdgYOssEKchACx0BKPM4ggRagwBxkgZNAHTHIAkcNGJjOoAAFBkdUARGGNagCpxh0UAUOMdSgChxnkEEVOMhwBg1gCGBowTAUw1oMh2E4HcNzGN5HDyCMIMQIZPRowIgozKjEjGyM5AAACSg5ooJJElsAAAAASUVORK5CYII="},40886:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAMAAABEpIrGAAAAPFBMVEUAAAD/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/AVL/////+fr/5er/0tv/ytX/iaH/dJL/cpA84uD/AAAAC3RSTlMA45NBI8vAtIZgTrS8MGcAAAC5SURBVDjLhVPtDoQgDBuICPKpvP+7Xs4t6LlL2j9GWtYCG91w0XqTkvE2OtJYrEkTxi4v2gWhpyS4n+1bUtgeRfY1/cG6z/3Ma8Ui/rP+6LWU2sd04RxBfs+WBe2UpXAZSP4jP3DIWb4m9ua1whI5w/XzC+xiHEWWtreg8XoUh5EVhnj469u1oF+EJ45QtaByCGKrogWFGSiAFjAkPCa8KHjV6LHgc6OGgS2Hmha2PR4cPHp4eOH4fwAGdiPh+RS0GAAAAABJRU5ErkJggg=="},71370:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAD1BMVEUAAAD///////////////+PQt5oAAAABHRSTlMAy4AzqjrmZgAAABRJREFUCNdjAAMjERcXR2Uwc4AEAIn2CZHn9cAcAAAAAElFTkSuQmCC"},88296:e=>{"use strict";e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAIBAMAAABqq+CcAAAAGFBMVEUAAAD/AVL/AVL/AVL/////AVL/r7//OWiicYg+AAAABHRSTlMAy4AzqjrmZgAAABlJREFUCNdjYGBgVgwtcwGC9FAhAyB3YAQAVg4X6a0jaXAAAAAASUVORK5CYII="},92759:(e,t,i)=>{"use strict";e.exports=i.p+"images/login-screen-background.jpg"},64366:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagbg.png"},78947:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagmask.png"},28636:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteColor.png"},27314:(e,t,i)=>{"use strict";e.exports=i.p+"images/NoteIcon.png"},48072:(e,t,i)=>{"use strict";e.exports=i.p+"images/360_placement_pin_mask.png"},68444:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior.png"},85089:(e,t,i)=>{"use strict";e.exports=i.p+"images/exterior_hover.png"},45545:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior.png"},64293:(e,t,i)=>{"use strict";e.exports=i.p+"images/interior_hover.png"},4592:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagColor.png"},47247:(e,t,i)=>{"use strict";e.exports=i.p+"images/tagIcon.png"},35367:()=>{},53204:(e,t,i)=>{"use strict";i.d(t,{fe:()=>ht,cA:()=>O,h4:()=>tt,createHttpLink:()=>p,Ps:()=>li});var n=i(70655),s=i(92924),r=i(81707),o=i(80496),a=i(84913),l=Object.prototype.hasOwnProperty;var c=function(e,t){var i;try{i=JSON.stringify(e)}catch(e){var n=new s.ej(23);throw n.parseError=e,n}return i},d=i(90778),h={http:{includeQuery:!0,includeExtensions:!1},headers:{accept:"*/*","content-type":"application/json"},options:{method:"POST"}},u=i(80285);var p=function(e){void 0===e&&(e={});var t=e.uri,i=void 0===t?"/graphql":t,p=e.fetch,m=e.includeExtensions,f=e.useGETForQueries,g=e.includeUnusedVariables,v=void 0!==g&&g,y=(0,n._T)(e,["uri","fetch","includeExtensions","useGETForQueries","includeUnusedVariables"]);!function(e){if(!e&&"undefined"==typeof fetch)throw new s.ej(22)}(p),p||(p=fetch);var b={http:{includeExtensions:m},options:y.fetchOptions,credentials:y.credentials,headers:y.headers};return new r.i0((function(e){var t=function(e,t){return e.getContext().uri||("function"==typeof t?t(e):t||"/graphql")}(e,i),s=e.getContext(),r={};if(s.clientAwareness){var m=s.clientAwareness,g=m.name,y=m.version;g&&(r["apollographql-client-name"]=g),y&&(r["apollographql-client-version"]=y)}var S,E=(0,n.pi)((0,n.pi)({},r),s.headers),T={http:s.http,options:s.fetchOptions,credentials:s.credentials,headers:E},w=function(e,t){for(var i=[],s=2;s<arguments.length;s++)i[s-2]=arguments[s];var r=(0,n.pi)((0,n.pi)({},t.options),{headers:t.headers,credentials:t.credentials}),o=t.http||{};i.forEach((function(e){r=(0,n.pi)((0,n.pi)((0,n.pi)({},r),e.options),{headers:(0,n.pi)((0,n.pi)({},r.headers),e.headers)}),e.credentials&&(r.credentials=e.credentials),o=(0,n.pi)((0,n.pi)({},o),e.http)}));var a=e.operationName,l=e.extensions,c=e.variables,h=e.query,u={operationName:a,variables:c};return o.includeExtensions&&(u.extensions=l),o.includeQuery&&(u.query=(0,d.S)(h)),{options:r,body:u}}(e,h,b,T),x=w.options,_=w.body;if(_.variables&&!v){var M=new Set(Object.keys(_.variables));(0,u.Vn)(e.query,{Variable:function(e,t,i){i&&"VariableDefinition"!==i.kind&&M.delete(e.name.value)}}),M.size&&(_.variables=(0,n.pi)({},_.variables),M.forEach((function(e){delete _.variables[e]})))}if(!x.signal){var O=function(){if("undefined"==typeof AbortController)return{controller:!1,signal:!1};var e=new AbortController;return{controller:e,signal:e.signal}}(),A=O.controller,C=O.signal;(S=A)&&(x.signal=C)}if(f&&!e.query.definitions.some((function(e){return"OperationDefinition"===e.kind&&"mutation"===e.operation}))&&(x.method="GET"),"GET"===x.method){var P=function(e,t){var i=[],n=function(e,t){i.push(e+"="+encodeURIComponent(t))};if("query"in t&&n("query",t.query),t.operationName&&n("operationName",t.operationName),t.variables){var s=void 0;try{s=c(t.variables)}catch(e){return{parseError:e}}n("variables",s)}if(t.extensions){var r=void 0;try{r=c(t.extensions)}catch(e){return{parseError:e}}n("extensions",r)}var o="",a=e,l=e.indexOf("#");-1!==l&&(o=e.substr(l),a=e.substr(0,l));var d=-1===a.indexOf("?")?"?":"&";return{newURI:a+d+i.join("&")+o}}(t,_),D=P.newURI,N=P.parseError;if(N)return(0,a.Qc)(N);t=D}else try{x.body=c(_)}catch(N){return(0,a.Qc)(N)}return new o.y$((function(i){var n;return p(t,x).then((function(t){return e.setContext({response:t}),t})).then((n=e,function(e){return e.text().then((function(t){try{return JSON.parse(t)}catch(n){var i=n;throw i.name="ServerParseError",i.response=e,i.statusCode=e.status,i.bodyText=t,i}})).then((function(t){return e.status>=300&&(0,a.PW)(e,t,"Response not successful: Received status code "+e.status),Array.isArray(t)||l.call(t,"data")||l.call(t,"errors")||(0,a.PW)(e,t,"Server response was missing for query '"+(Array.isArray(n)?n.map((function(e){return e.operationName})):n.operationName)+"'."),t}))})).then((function(e){return i.next(e),i.complete(),e})).catch((function(e){"AbortError"!==e.name&&(e.result&&e.result.errors&&e.result.data&&i.next(e.result),i.error(e))})),function(){S&&S.abort()}}))}))},m=function(e){function t(t){void 0===t&&(t={});var i=e.call(this,p(t).request)||this;return i.options=t,i}return(0,n.ZT)(t,e),t}(r.i0),f=Object.prototype,g=f.toString,v=f.hasOwnProperty,y=Function.prototype.toString,b=new Map;function S(e,t){try{return E(e,t)}finally{b.clear()}}function E(e,t){if(e===t)return!0;var i,n,s,r=g.call(e);if(r!==g.call(t))return!1;switch(r){case"[object Array]":if(e.length!==t.length)return!1;case"[object Object]":if(_(e,t))return!0;var o=T(e),a=T(t),l=o.length;if(l!==a.length)return!1;for(var c=0;c<l;++c)if(!v.call(t,o[c]))return!1;for(c=0;c<l;++c){var d=o[c];if(!E(e[d],t[d]))return!1}return!0;case"[object Error]":return e.name===t.name&&e.message===t.message;case"[object Number]":if(e!=e)return t!=t;case"[object Boolean]":case"[object Date]":return+e==+t;case"[object RegExp]":case"[object String]":return e==""+t;case"[object Map]":case"[object Set]":if(e.size!==t.size)return!1;if(_(e,t))return!0;for(var h=e.entries(),u="[object Map]"===r;;){var p=h.next();if(p.done)break;var m=p.value,f=m[0],b=m[1];if(!t.has(f))return!1;if(u&&!E(b,t.get(f)))return!1}return!0;case"[object Function]":var S=y.call(e);return S===y.call(t)&&(n=x,!((s=(i=S).length-n.length)>=0&&i.indexOf(n,s)===s))}return!1}function T(e){return Object.keys(e).filter(w,e)}function w(e){return void 0!==this[e]}var x="{ [native code] }";function _(e,t){var i=b.get(e);if(i){if(i.has(t))return!0}else b.set(e,i=new Set);return i.add(t),!1}var M,O=function(e){function t(i){var n,s,r=i.graphQLErrors,a=i.networkError,l=i.errorMessage,c=i.extraInfo,d=e.call(this,l)||this;return d.graphQLErrors=r||[],d.networkError=a||null,d.message=l||(n=d,s="",(0,o.Of)(n.graphQLErrors)&&n.graphQLErrors.forEach((function(e){var t=e?e.message:"Error message not found.";s+=t+"\n"})),n.networkError&&(s+=n.networkError.message+"\n"),s=s.replace(/\n$/,"")),d.extraInfo=c,d.__proto__=t.prototype,d}return(0,n.ZT)(t,e),t}(Error);function A(e){return!!e&&e<7}!function(e){e[e.loading=1]="loading",e[e.setVariables=2]="setVariables",e[e.fetchMore=3]="fetchMore",e[e.refetch=4]="refetch",e[e.poll=6]="poll",e[e.ready=7]="ready",e[e.error=8]="error"}(M||(M={}));var C=function(){function e(e,t,i,n){this.observer=e,this.options=t,this.fetch=i,this.shouldFetch=n}return e.prototype.reobserve=function(e,t){e?this.updateOptions(e):this.updatePolling();var i=this.fetch(this.options,t);return this.concast&&this.concast.removeObserver(this.observer,!0),i.addObserver(this.observer),(this.concast=i).promise},e.prototype.updateOptions=function(e){return Object.assign(this.options,(0,o.oA)(e)),this.updatePolling(),this},e.prototype.stop=function(){this.concast&&(this.concast.removeObserver(this.observer),delete this.concast),this.pollingInfo&&(clearTimeout(this.pollingInfo.timeout),this.options.pollInterval=0,this.updatePolling())},e.prototype.updatePolling=function(){var e=this,t=this.pollingInfo,i=this.options.pollInterval;if(i){if((!t||t.interval!==i)&&((0,s.kG)(i,20),!1!==this.shouldFetch)){(t||(this.pollingInfo={})).interval=i;var n=function(){e.pollingInfo&&(e.shouldFetch&&e.shouldFetch()?e.reobserve({fetchPolicy:"network-only",nextFetchPolicy:e.options.fetchPolicy||"cache-first"},M.poll).then(r,r):r())},r=function(){var t=e.pollingInfo;t&&(clearTimeout(t.timeout),t.timeout=setTimeout(n,t.interval))};r()}}else t&&(clearTimeout(t.timeout),delete this.pollingInfo)},e}(),P=function(e){function t(t){var i=t.queryManager,s=t.queryInfo,r=t.options,a=e.call(this,(function(e){return a.onSubscribe(e)}))||this;a.observers=new Set,a.subscriptions=new Set,a.observer={next:function(e){(a.lastError||a.isDifferentFromLastResult(e))&&(a.updateLastResult(e),(0,o.pM)(a.observers,"next",e))},error:function(e){a.updateLastResult((0,n.pi)((0,n.pi)({},a.lastResult),{error:e,errors:e.graphQLErrors,networkStatus:M.error,loading:!1})),(0,o.pM)(a.observers,"error",a.lastError=e)}},a.isTornDown=!1,a.options=r,a.queryId=i.generateQueryId();var l=(0,o.$H)(r.query);return a.queryName=l&&l.name&&l.name.value,a.queryManager=i,a.queryInfo=s,a}return(0,n.ZT)(t,e),Object.defineProperty(t.prototype,"variables",{get:function(){return this.options.variables},enumerable:!1,configurable:!0}),t.prototype.result=function(){var e=this;return new Promise((function(t,i){var n={next:function(i){t(i),e.observers.delete(n),e.observers.size||e.queryManager.removeQuery(e.queryId),setTimeout((function(){s.unsubscribe()}),0)},error:i},s=e.subscribe(n)}))},t.prototype.getCurrentResult=function(e){void 0===e&&(e=!0);var t=this.lastResult,i=this.queryInfo.networkStatus||t&&t.networkStatus||M.ready,s=(0,n.pi)((0,n.pi)({},t),{loading:A(i),networkStatus:i});if(this.isTornDown)return s;var r=this.options.fetchPolicy,o=void 0===r?"cache-first":r;if("no-cache"===o||"network-only"===o)delete s.partial;else if(!s.data||!this.queryManager.transform(this.options.query).hasForcedResolvers){var a=this.queryInfo.getDiff();s.data=a.complete||this.options.returnPartialData?a.result:void 0,a.complete?(s.networkStatus!==M.loading||"cache-first"!==o&&"cache-only"!==o||(s.networkStatus=M.ready,s.loading=!1),delete s.partial):s.partial=!0}return e&&this.updateLastResult(s),s},t.prototype.isDifferentFromLastResult=function(e){return!S(this.lastResultSnapshot,e)},t.prototype.getLastResult=function(){return this.lastResult},t.prototype.getLastError=function(){return this.lastError},t.prototype.resetLastResults=function(){delete this.lastResult,delete this.lastResultSnapshot,delete this.lastError,this.isTornDown=!1},t.prototype.resetQueryStoreErrors=function(){this.queryManager.resetErrors(this.queryId)},t.prototype.refetch=function(e){var t={pollInterval:0},i=this.options.fetchPolicy;return"no-cache"!==i&&"cache-and-network"!==i&&(t.fetchPolicy="network-only",t.nextFetchPolicy=i||"cache-first"),e&&!S(this.options.variables,e)&&(t.variables=this.options.variables=(0,n.pi)((0,n.pi)({},this.options.variables),e)),this.newReobserver(!1).reobserve(t,M.refetch)},t.prototype.fetchMore=function(e){var t=this,i=(0,n.pi)((0,n.pi)({},e.query?e:(0,n.pi)((0,n.pi)((0,n.pi)({},this.options),e),{variables:(0,n.pi)((0,n.pi)({},this.options.variables),e.variables)})),{fetchPolicy:"no-cache"}),s=this.queryManager.generateQueryId();return i.notifyOnNetworkStatusChange&&(this.queryInfo.networkStatus=M.fetchMore,this.observe()),this.queryManager.fetchQuery(s,i,M.fetchMore).then((function(n){var s=n.data,r=e.updateQuery;return r?t.updateQuery((function(e){return r(e,{fetchMoreResult:s,variables:i.variables})})):t.queryManager.cache.writeQuery({query:i.query,variables:i.variables,data:s}),n})).finally((function(){t.queryManager.stopQuery(s),t.reobserve()}))},t.prototype.subscribeToMore=function(e){var t=this,i=this.queryManager.startGraphQLSubscription({query:e.document,variables:e.variables,context:e.context}).subscribe({next:function(i){var n=e.updateQuery;n&&t.updateQuery((function(e,t){var s=t.variables;return n(e,{subscriptionData:i,variables:s})}))},error:function(t){e.onError&&e.onError(t)}});return this.subscriptions.add(i),function(){t.subscriptions.delete(i)&&i.unsubscribe()}},t.prototype.setOptions=function(e){return this.reobserve(e)},t.prototype.setVariables=function(e){if(S(this.variables,e))return this.observers.size?this.result():Promise.resolve();if(this.options.variables=e,!this.observers.size)return Promise.resolve();var t=this.options.fetchPolicy,i=void 0===t?"cache-first":t,n={fetchPolicy:i,variables:e};return"cache-first"!==i&&"no-cache"!==i&&"network-only"!==i&&(n.fetchPolicy="cache-and-network",n.nextFetchPolicy=i),this.reobserve(n,M.setVariables)},t.prototype.updateQuery=function(e){var t,i=this.queryManager,n=e(i.cache.diff({query:this.options.query,variables:this.variables,previousResult:null===(t=this.lastResult)||void 0===t?void 0:t.data,returnPartialData:!0,optimistic:!1}).result,{variables:this.variables});n&&(i.cache.writeQuery({query:this.options.query,data:n,variables:this.variables}),i.broadcastQueries())},t.prototype.startPolling=function(e){this.getReobserver().updateOptions({pollInterval:e})},t.prototype.stopPolling=function(){this.reobserver&&this.reobserver.updateOptions({pollInterval:0})},t.prototype.updateLastResult=function(e){var t=this.lastResult;return this.lastResult=e,this.lastResultSnapshot=this.queryManager.assumeImmutableResults?e:(0,o.Xh)(e),(0,o.Of)(e.errors)||delete this.lastError,t},t.prototype.onSubscribe=function(e){var t=this;if(e===this.observer)return function(){};try{var i=e._subscription._observer;i&&!i.error&&(i.error=D)}catch(e){}var n=!this.observers.size;return this.observers.add(e),this.lastError?e.error&&e.error(this.lastError):this.lastResult&&e.next&&e.next(this.lastResult),n&&this.reobserve().catch((function(e){})),function(){t.observers.delete(e)&&!t.observers.size&&t.tearDownQuery()}},t.prototype.getReobserver=function(){return this.reobserver||(this.reobserver=this.newReobserver(!0))},t.prototype.newReobserver=function(e){var t=this,i=this.queryManager,s=this.queryId;return i.setObservableQuery(this),new C(this.observer,e?this.options:(0,n.pi)({},this.options),(function(e,n){return i.setObservableQuery(t),i.fetchQueryObservable(s,e,n)}),!i.ssrMode&&function(){return!A(t.queryInfo.networkStatus)})},t.prototype.reobserve=function(e,t){return this.isTornDown=!1,this.getReobserver().reobserve(e,t)},t.prototype.observe=function(){this.observer.next(this.getCurrentResult(!1))},t.prototype.hasObservers=function(){return this.observers.size>0},t.prototype.tearDownQuery=function(){this.isTornDown||(this.reobserver&&(this.reobserver.stop(),delete this.reobserver),this.subscriptions.forEach((function(e){return e.unsubscribe()})),this.subscriptions.clear(),this.queryManager.stopQuery(this.queryId),this.observers.clear(),this.isTornDown=!0)},t}(o.y$);function D(e){}(0,o.Dy)(P);var N=i(27636),I=function(){return Object.create(null)},L=Array.prototype,R=L.forEach,k=L.slice,U=function(){function e(e,t){void 0===e&&(e=!0),void 0===t&&(t=I),this.weakness=e,this.makeData=t}return e.prototype.lookup=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.lookupArray(e)},e.prototype.lookupArray=function(e){var t=this;return R.call(e,(function(e){return t=t.getChildTrie(e)})),t.data||(t.data=this.makeData(k.call(e)))},e.prototype.getChildTrie=function(t){var i=this.weakness&&function(e){switch(typeof e){case"object":if(null===e)break;case"function":return!0}return!1}(t)?this.weak||(this.weak=new WeakMap):this.strong||(this.strong=new Map),n=i.get(t);return n||i.set(t,n=new e(this.weakness,this.makeData)),n},e}();var B=null,F={},V=1,H="@wry/context:Slot",j=Array,G=j[H]||function(){var e=function(){function e(){this.id=["slot",V++,Date.now(),Math.random().toString(36).slice(2)].join(":")}return e.prototype.hasValue=function(){for(var e=B;e;e=e.parent)if(this.id in e.slots){var t=e.slots[this.id];if(t===F)break;return e!==B&&(B.slots[this.id]=t),!0}return B&&(B.slots[this.id]=F),!1},e.prototype.getValue=function(){if(this.hasValue())return B.slots[this.id]},e.prototype.withValue=function(e,t,i,n){var s,r=((s={__proto__:null})[this.id]=e,s),o=B;B={parent:o,slots:r};try{return t.apply(n,i)}finally{B=o}},e.bind=function(e){var t=B;return function(){var i=B;try{return B=t,e.apply(this,arguments)}finally{B=i}}},e.noContext=function(e,t,i){if(!B)return e.apply(i,t);var n=B;try{return B=null,e.apply(i,t)}finally{B=n}},e}();try{Object.defineProperty(j,H,{value:j[H]=e,enumerable:!1,writable:!1,configurable:!1})}finally{return e}}();G.bind,G.noContext;function z(){}var W=function(){function e(e,t){void 0===e&&(e=1/0),void 0===t&&(t=z),this.max=e,this.dispose=t,this.map=new Map,this.newest=null,this.oldest=null}return e.prototype.has=function(e){return this.map.has(e)},e.prototype.get=function(e){var t=this.getEntry(e);return t&&t.value},e.prototype.getEntry=function(e){var t=this.map.get(e);if(t&&t!==this.newest){var i=t.older,n=t.newer;n&&(n.older=i),i&&(i.newer=n),t.older=this.newest,t.older.newer=t,t.newer=null,this.newest=t,t===this.oldest&&(this.oldest=n)}return t},e.prototype.set=function(e,t){var i=this.getEntry(e);return i?i.value=t:(i={key:e,value:t,newer:null,older:this.newest},this.newest&&(this.newest.newer=i),this.newest=i,this.oldest=this.oldest||i,this.map.set(e,i),i.value)},e.prototype.clean=function(){for(;this.oldest&&this.map.size>this.max;)this.delete(this.oldest.key)},e.prototype.delete=function(e){var t=this.map.get(e);return!!t&&(t===this.newest&&(this.newest=t.older),t===this.oldest&&(this.oldest=t.newer),t.newer&&(t.newer.older=t.older),t.older&&(t.older.newer=t.newer),this.map.delete(e),this.dispose(t.value,e),!0)},e}(),K=new G;function Y(e){var t=e.unsubscribe;"function"==typeof t&&(e.unsubscribe=void 0,t())}var q=[];function Z(e,t){if(!e)throw new Error(t||"assertion failure")}function $(e){switch(e.length){case 0:throw new Error("unknown value");case 1:return e[0];case 2:throw e[1]}}var Q=function(){function e(t){this.fn=t,this.parents=new Set,this.childValues=new Map,this.dirtyChildren=null,this.dirty=!0,this.recomputing=!1,this.value=[],this.deps=null,++e.count}return e.prototype.peek=function(){if(1===this.value.length&&!J(this))return this.value[0]},e.prototype.recompute=function(e){return Z(!this.recomputing,"already recomputing"),function(e){var t=K.getValue();if(t)e.parents.add(t),t.childValues.has(e)||t.childValues.set(e,[]),J(e)?ie(t,e):ne(t,e)}(this),J(this)?function(e,t){re(e),K.withValue(e,X,[e,t]),function(e,t){if("function"==typeof e.subscribe)try{Y(e),e.unsubscribe=e.subscribe.apply(null,t)}catch(t){return e.setDirty(),!1}return!0}(e,t)&&function(e){if(e.dirty=!1,J(e))return;te(e)}(e);return $(e.value)}(this,e):$(this.value)},e.prototype.setDirty=function(){this.dirty||(this.dirty=!0,this.value.length=0,ee(this),re(this),Y(this))},e.prototype.dispose=function(){var e=this;re(this),Y(this),this.parents.forEach((function(t){t.setDirty(),oe(t,e)}))},e.prototype.dependOn=function(e){e.add(this),this.deps||(this.deps=q.pop()||new Set),this.deps.add(e)},e.prototype.forgetDeps=function(){var e=this;this.deps&&(this.deps.forEach((function(t){return t.delete(e)})),this.deps.clear(),q.push(this.deps),this.deps=null)},e.count=0,e}();function X(e,t){e.recomputing=!0,e.value.length=0;try{e.value[0]=e.fn.apply(null,t)}catch(t){e.value[1]=t}e.recomputing=!1}function J(e){return e.dirty||!(!e.dirtyChildren||!e.dirtyChildren.size)}function ee(e){e.parents.forEach((function(t){return ie(t,e)}))}function te(e){e.parents.forEach((function(t){return ne(t,e)}))}function ie(e,t){if(Z(e.childValues.has(t)),Z(J(t)),e.dirtyChildren){if(e.dirtyChildren.has(t))return}else e.dirtyChildren=q.pop()||new Set;e.dirtyChildren.add(t),ee(e)}function ne(e,t){Z(e.childValues.has(t)),Z(!J(t));var i,n,s,r=e.childValues.get(t);0===r.length?e.childValues.set(t,t.value.slice(0)):(i=r,n=t.value,(s=i.length)>0&&s===n.length&&i[s-1]===n[s-1]||e.setDirty()),se(e,t),J(e)||te(e)}function se(e,t){var i=e.dirtyChildren;i&&(i.delete(t),0===i.size&&(q.length<100&&q.push(i),e.dirtyChildren=null))}function re(e){e.childValues.size>0&&e.childValues.forEach((function(t,i){oe(e,i)})),e.forgetDeps(),Z(null===e.dirtyChildren)}function oe(e,t){t.parents.delete(e),e.childValues.delete(t),se(e,t)}function ae(e){var t=new Map,i=e&&e.subscribe;function n(e){var n=K.getValue();if(n){var s=t.get(e);s||t.set(e,s=new Set),n.dependOn(s),"function"==typeof i&&(Y(s),s.unsubscribe=i(e))}}return n.dirty=function(e){var i=t.get(e);i&&(i.forEach((function(e){return e.setDirty()})),t.delete(e),Y(i))},n}var le=new U("function"==typeof WeakMap);function ce(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return le.lookupArray(e)}var de=new Set;function he(e,t){void 0===t&&(t=Object.create(null));var i=new W(t.max||Math.pow(2,16),(function(e){return e.dispose()})),n=t.keyArgs||function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return e},s=t.makeCacheKey||ce;function r(){var r=s.apply(null,n.apply(null,arguments));if(void 0===r)return e.apply(null,arguments);var o=i.get(r);o||(i.set(r,o=new Q(e)),o.subscribe=t.subscribe);var a=o.recompute(Array.prototype.slice.call(arguments));return i.set(r,o),de.add(i),K.hasValue()||(de.forEach((function(e){return e.clean()})),de.clear()),a}function o(){var e=s.apply(null,arguments);if(void 0!==e)return i.get(e)}return r.dirty=function(){var e=o.apply(null,arguments);e&&e.setDirty()},r.peek=function(){var e=o.apply(null,arguments);if(e)return e.peek()},r.forget=function(){var e=s.apply(null,arguments);return void 0!==e&&i.delete(e)},r}var ue,pe=function(){function e(){this.getFragmentDoc=he(o.Yk)}return e.prototype.recordOptimisticTransaction=function(e,t){this.performTransaction(e,t)},e.prototype.transformDocument=function(e){return e},e.prototype.identify=function(e){},e.prototype.gc=function(){return[]},e.prototype.modify=function(e){return!1},e.prototype.transformForLink=function(e){return e},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!!e.optimistic),this.read({query:this.getFragmentDoc(e.fragment,e.fragmentName),variables:e.variables,rootId:e.id,returnPartialData:e.returnPartialData,optimistic:t})},e.prototype.writeQuery=function(e){return this.write({dataId:e.id||"ROOT_QUERY",result:e.data,query:e.query,variables:e.variables,broadcast:e.broadcast})},e.prototype.writeFragment=function(e){return this.write({dataId:e.id,result:e.data,variables:e.variables,query:this.getFragmentDoc(e.fragment,e.fragmentName),broadcast:e.broadcast})},e}();ue||(ue={});var me=function(e,t,i,n,s){this.message=e,this.path=t,this.query=i,this.clientOnly=n,this.variables=s},fe=Object.prototype.hasOwnProperty;var ge=/^[_a-z][_0-9a-z]*/i;function ve(e){var t=e.match(ge);return t?t[0]:e}function ye(e,t,i){return!(!t||"object"!=typeof t)&&(Array.isArray(t)?t.every((function(t){return ye(e,t,i)})):e.selections.every((function(e){if((0,o.My)(e)&&(0,o.LZ)(e,i)){var n=(0,o.u2)(e);return fe.call(t,n)&&(!e.selectionSet||ye(e.selectionSet,t[n],i))}return!0})))}function be(e){return null!==e&&"object"==typeof e&&!(0,o.hh)(e)&&!Array.isArray(e)}var Se=Object.create(null),Ee=function(){return Se},Te=Object.create(null),we=function(){function e(e,t){var i=this;this.policies=e,this.group=t,this.data=Object.create(null),this.rootIds=Object.create(null),this.refs=Object.create(null),this.getFieldValue=function(e,t){return(0,o.Jv)((0,o.hh)(e)?i.get(e.__ref,t):e&&e[t])},this.canRead=function(e){return(0,o.hh)(e)?i.has(e.__ref):"object"==typeof e},this.toReference=function(e,t){if("string"==typeof e)return(0,o.kQ)(e);if((0,o.hh)(e))return e;var n=i.policies.identify(e)[0];if(n){var s=(0,o.kQ)(n);return t&&i.merge(n,e),s}}}return e.prototype.toObject=function(){return(0,n.pi)({},this.data)},e.prototype.has=function(e){return void 0!==this.lookup(e,!0)},e.prototype.get=function(e,t){if(this.group.depend(e,t),fe.call(this.data,e)){var i=this.data[e];if(i&&fe.call(i,t))return i[t]}return"__typename"===t&&fe.call(this.policies.rootTypenamesById,e)?this.policies.rootTypenamesById[e]:this instanceof Me?this.parent.get(e,t):void 0},e.prototype.lookup=function(e,t){return t&&this.group.depend(e,"__exists"),fe.call(this.data,e)?this.data[e]:this instanceof Me?this.parent.lookup(e,t):this.policies.rootTypenamesById[e]?Object.create(null):void 0},e.prototype.merge=function(e,t){var i=this,n=this.lookup(e),s=new o.w0(Oe).merge(n,t);if(this.data[e]=s,s!==n&&(delete this.refs[e],this.group.caching)){var r=Object.create(null);n||(r.__exists=1),Object.keys(t).forEach((function(e){if(!n||n[e]!==s[e]){r[e]=1;var t=ve(e);t===e||i.policies.hasKeyArgs(s.__typename,t)||(r[t]=1),void 0!==s[e]||i instanceof Me||delete s[e]}})),Object.keys(r).forEach((function(t){return i.group.dirty(e,t)}))}},e.prototype.modify=function(e,t){var i=this,s=this.lookup(e);if(s){var r=Object.create(null),a=!1,l=!0,c={DELETE:Se,INVALIDATE:Te,isReference:o.hh,toReference:this.toReference,canRead:this.canRead,readField:function(t,n){return i.policies.readField("string"==typeof t?{fieldName:t,from:n||(0,o.kQ)(e)}:t,{store:i})}};if(Object.keys(s).forEach((function(d){var h=ve(d),u=s[d];if(void 0!==u){var p="function"==typeof t?t:t[d]||t[h];if(p){var m=p===Ee?Se:p((0,o.Jv)(u),(0,n.pi)((0,n.pi)({},c),{fieldName:h,storeFieldName:d,storage:i.getStorage(e,d)}));m===Te?i.group.dirty(e,d):(m===Se&&(m=void 0),m!==u&&(r[d]=m,a=!0,u=m))}void 0!==u&&(l=!1)}})),a)return this.merge(e,r),l&&(this instanceof Me?this.data[e]=void 0:delete this.data[e],this.group.dirty(e,"__exists")),!0}return!1},e.prototype.delete=function(e,t,i){var n,s=this.lookup(e);if(s){var r=this.getFieldValue(s,"__typename"),o=t&&i?this.policies.getStoreFieldName({typename:r,fieldName:t,args:i}):t;return this.modify(e,o?((n={})[o]=Ee,n):Ee)}return!1},e.prototype.evict=function(e){var t=!1;return e.id&&(fe.call(this.data,e.id)&&(t=this.delete(e.id,e.fieldName,e.args)),this instanceof Me&&(t=this.parent.evict(e)||t),(e.fieldName||t)&&this.group.dirty(e.id,e.fieldName||"__exists")),t},e.prototype.clear=function(){this.replace(null)},e.prototype.extract=function(){var e=this,t=this.toObject(),i=[];return this.getRootIdSet().forEach((function(t){fe.call(e.policies.rootTypenamesById,t)||i.push(t)})),i.length&&(t.__META={extraRootIds:i.sort()}),t},e.prototype.replace=function(e){var t=this;if(Object.keys(this.data).forEach((function(i){e&&fe.call(e,i)||t.delete(i)})),e){var i=e.__META,s=(0,n._T)(e,["__META"]);Object.keys(s).forEach((function(e){t.merge(e,s[e])})),i&&i.extraRootIds.forEach(this.retain,this)}},e.prototype.retain=function(e){return this.rootIds[e]=(this.rootIds[e]||0)+1},e.prototype.release=function(e){if(this.rootIds[e]>0){var t=--this.rootIds[e];return t||delete this.rootIds[e],t}return 0},e.prototype.getRootIdSet=function(e){return void 0===e&&(e=new Set),Object.keys(this.rootIds).forEach(e.add,e),this instanceof Me?this.parent.getRootIdSet(e):Object.keys(this.policies.rootTypenamesById).forEach(e.add,e),e},e.prototype.gc=function(){var e=this,t=this.getRootIdSet(),i=this.toObject();t.forEach((function(n){fe.call(i,n)&&(Object.keys(e.findChildRefIds(n)).forEach(t.add,t),delete i[n])}));var n=Object.keys(i);if(n.length){for(var s=this;s instanceof Me;)s=s.parent;n.forEach((function(e){return s.delete(e)}))}return n},e.prototype.findChildRefIds=function(e){if(!fe.call(this.refs,e)){var t=this.refs[e]=Object.create(null),i=new Set([this.data[e]]),n=function(e){return null!==e&&"object"==typeof e};i.forEach((function(e){(0,o.hh)(e)?t[e.__ref]=!0:n(e)&&Object.values(e).filter(n).forEach(i.add,i)}))}return this.refs[e]},e.prototype.makeCacheKey=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return this.group.keyMaker.lookupArray(e)},e}(),xe=function(){function e(e){this.caching=e,this.d=null,this.keyMaker=new U(o.mr),this.d=e?ae():null}return e.prototype.depend=function(e,t){if(this.d){this.d(_e(e,t));var i=ve(t);i!==t&&this.d(_e(e,i))}},e.prototype.dirty=function(e,t){this.d&&this.d.dirty(_e(e,t))},e}();function _e(e,t){return t+"#"+e}!function(e){var t=function(e){function t(t){var i=t.policies,n=t.resultCaching,s=void 0===n||n,r=t.seed,a=e.call(this,i,new xe(s))||this;return a.storageTrie=new U(o.mr),a.sharedLayerGroup=new xe(s),r&&a.replace(r),a}return(0,n.ZT)(t,e),t.prototype.addLayer=function(e,t){return new Me(e,this,t,this.sharedLayerGroup)},t.prototype.removeLayer=function(){return this},t.prototype.getStorage=function(){return this.storageTrie.lookupArray(arguments)},t}(e);e.Root=t}(we||(we={}));var Me=function(e){function t(t,i,n,s){var r=e.call(this,i.policies,s)||this;return r.id=t,r.parent=i,r.replay=n,r.group=s,n(r),r}return(0,n.ZT)(t,e),t.prototype.addLayer=function(e,i){return new t(e,this,i,this.group)},t.prototype.removeLayer=function(e){var t=this,i=this.parent.removeLayer(e);return e===this.id?(this.group.caching&&Object.keys(this.data).forEach((function(e){t.data[e]!==i.lookup(e)&&t.delete(e)})),i):i===this.parent?this:i.addLayer(this.id,this.replay)},t.prototype.toObject=function(){return(0,n.pi)((0,n.pi)({},this.parent.toObject()),this.data)},t.prototype.findChildRefIds=function(t){var i=this.parent.findChildRefIds(t);return fe.call(this.data,t)?(0,n.pi)((0,n.pi)({},i),e.prototype.findChildRefIds.call(this,t)):i},t.prototype.getStorage=function(){for(var e=this.parent;e.parent;)e=e.parent;return e.getStorage.apply(e,arguments)},t}(we);function Oe(e,t,i){var n=e[i],s=t[i];return S(n,s)?n:s}function Ae(e){return!!(e instanceof we&&e.group.caching)}function Ce(e,t){return new me(e.message,t.path.slice(),t.query,t.clientOnly,t.variables)}var Pe=function(){function e(e){var t=this;this.config=e,this.executeSelectionSet=he((function(e){return t.execSelectionSetImpl(e)}),{keyArgs:function(e){return[e.selectionSet,e.objectOrReference,e.context]},makeCacheKey:function(e,t,i){if(Ae(i.store))return i.store.makeCacheKey(e,(0,o.hh)(t)?t.__ref:t,i.varString)}}),this.knownResults=new WeakMap,this.executeSubSelectedArray=he((function(e){return t.execSubSelectedArrayImpl(e)}),{makeCacheKey:function(e){var t=e.field,i=e.array,n=e.context;if(Ae(n.store))return n.store.makeCacheKey(t,i,n.varString)}}),this.config=(0,n.pi)({addTypename:!0},e)}return e.prototype.diffQueryAgainstStore=function(e){var t=e.store,i=e.query,s=e.rootId,r=void 0===s?"ROOT_QUERY":s,a=e.variables,l=e.returnPartialData,c=void 0===l||l,d=this.config.cache.policies;a=(0,n.pi)((0,n.pi)({},(0,o.O4)((0,o.iW)(i))),a);var h=this.executeSelectionSet({selectionSet:(0,o.p$)(i).selectionSet,objectOrReference:(0,o.kQ)(r),context:{store:t,query:i,policies:d,variables:a,varString:JSON.stringify(a),fragmentMap:(0,o.F)((0,o.kU)(i)),path:[],clientOnly:!1}}),u=h.missing&&h.missing.length>0;if(u&&!c)throw h.missing[0];return{result:h.result,missing:h.missing,complete:!u}},e.prototype.isFresh=function(e,t,i,n){if(Ae(n.store)&&this.knownResults.get(e)===i){var s=this.executeSelectionSet.peek(i,t,n);if(s&&e===s.result)return!0}return!1},e.prototype.execSelectionSetImpl=function(e){var t=this,i=e.selectionSet,n=e.objectOrReference,r=e.context;if((0,o.hh)(n)&&!r.policies.rootTypenamesById[n.__ref]&&!r.store.has(n.__ref))return{result:{},missing:[Ce(new s.ej(4),r)]};var a=r.variables,l=r.policies,c=r.store,d=[],h={result:null},u=c.getFieldValue(n,"__typename");function p(){return h.missing||(h.missing=[])}function m(e){var t;return e.missing&&(t=p()).push.apply(t,e.missing),e.result}this.config.addTypename&&"string"==typeof u&&!l.rootIdsByTypename[u]&&d.push({__typename:u});var f=new Set(i.selections);return f.forEach((function(e){var i;if((0,o.LZ)(e,a))if((0,o.My)(e)){var c=l.readField({fieldName:e.name.value,field:e,variables:r.variables,from:n},r),h=(0,o.u2)(e);r.path.push(h);var g=r.clientOnly;r.clientOnly=g||!(!e.directives||!e.directives.some((function(e){return"client"===e.name.value}))),void 0===c?o.Gw.added(e)||p().push(Ce(new s.ej(5),r)):Array.isArray(c)?c=m(t.executeSubSelectedArray({field:e,array:c,context:r})):e.selectionSet&&null!=c&&(c=m(t.executeSelectionSet({selectionSet:e.selectionSet,objectOrReference:c,context:r}))),void 0!==c&&d.push(((i={})[h]=c,i)),r.clientOnly=g,(0,s.kG)(r.path.pop()===h)}else{var v=(0,o.hi)(e,r.fragmentMap);v&&l.fragmentMatches(v,u)&&v.selectionSet.selections.forEach(f.add,f)}})),h.result=(0,o.bw)(d),this.knownResults.set(h.result,i),h},e.prototype.execSubSelectedArrayImpl=function(e){var t,i=this,n=e.field,r=e.array,o=e.context;function a(e,i){return e.missing&&(t=t||[]).push.apply(t,e.missing),(0,s.kG)(o.path.pop()===i),e.result}return n.selectionSet&&(r=r.filter(o.store.canRead)),{result:r=r.map((function(e,t){return null===e?null:(o.path.push(t),Array.isArray(e)?a(i.executeSubSelectedArray({field:n,array:e,context:o}),t):n.selectionSet?a(i.executeSelectionSet({selectionSet:n.selectionSet,objectOrReference:e,context:o}),t):((0,s.kG)(o.path.pop()===t),e))})),missing:t}},e}();var De=function(){function e(e,t){this.cache=e,this.reader=t}return e.prototype.writeToStore=function(e){var t=e.query,i=e.result,r=e.dataId,a=e.store,l=e.variables,c=(0,o.$H)(t),d=new o.w0;l=(0,n.pi)((0,n.pi)({},(0,o.O4)(c)),l);var h=this.processSelectionSet({result:i||Object.create(null),dataId:r,selectionSet:c.selectionSet,mergeTree:{map:new Map},context:{store:a,written:Object.create(null),merge:function(e,t){return d.merge(e,t)},variables:l,varString:JSON.stringify(l),fragmentMap:(0,o.F)((0,o.kU)(t))}});if(!(0,o.hh)(h))throw new s.ej(7);return a.retain(h.__ref),h},e.prototype.processSelectionSet=function(e){var t=this,i=e.dataId,n=e.result,r=e.selectionSet,a=e.context,l=e.mergeTree,c=this.cache.policies,d=c.identify(n,r,a.fragmentMap),h=d[0],u=d[1];if("string"==typeof(i=i||h)){var p=a.written[i]||(a.written[i]=[]),m=(0,o.kQ)(i);if(p.indexOf(r)>=0)return m;if(p.push(r),this.reader&&this.reader.isFresh(n,m,r,a))return m}var f=Object.create(null);u&&(f=a.merge(f,u));var g=i&&c.rootTypenamesById[i]||(0,o.qw)(n,r,a.fragmentMap)||i&&a.store.get(i,"__typename");"string"==typeof g&&(f.__typename=g);var v=new Set(r.selections);if(v.forEach((function(e){var i;if((0,o.LZ)(e,a.variables))if((0,o.My)(e)){var r=(0,o.u2)(e),d=n[r];if(void 0!==d){var h=c.getStoreFieldName({typename:g,fieldName:e.name.value,field:e,variables:a.variables}),u=Ie(l,h),p=t.processFieldValue(d,e,a,u),m=e.selectionSet&&a.store.getFieldValue(p,"__typename")||void 0,y=c.getMergeFunction(g,e.name.value,m);y?u.info={field:e,typename:g,merge:y}:Le(l,h),f=a.merge(f,((i={})[h]=p,i))}else if(c.usingPossibleTypes&&!(0,o.FS)(["defer","client"],e))throw new s.ej(8)}else{var b=(0,o.hi)(e,a.fragmentMap);b&&c.fragmentMatches(b,g,n,a.variables)&&b.selectionSet.selections.forEach(v.add,v)}})),"string"==typeof i){var y=(0,o.kQ)(i);return l.map.size&&(f=this.applyMerges(l,y,f,a)),a.store.merge(i,f),y}return f},e.prototype.processFieldValue=function(e,t,i,n){var s=this;return t.selectionSet&&null!==e?Array.isArray(e)?e.map((function(e,r){var o=s.processFieldValue(e,t,i,Ie(n,r));return Le(n,r),o})):this.processSelectionSet({result:e,selectionSet:t.selectionSet,context:i,mergeTree:n}):e},e.prototype.applyMerges=function(e,t,i,r,a){var l,c=this;if(e.map.size&&!(0,o.hh)(i)){var d,h=Array.isArray(i)||!(0,o.hh)(t)&&!be(t)?void 0:t,u=i;h&&!a&&(a=[(0,o.hh)(h)?h.__ref:h]);var p=function(e,t){return Array.isArray(e)?"number"==typeof t?e[t]:void 0:r.store.getFieldValue(e,String(t))};e.map.forEach((function(e,t){a&&a.push(t);var i=p(h,t),n=p(u,t),o=c.applyMerges(e,i,n,r,a);o!==n&&(d=d||new Map).set(t,o),a&&(0,s.kG)(a.pop()===t)})),d&&(i=Array.isArray(u)?u.slice(0):(0,n.pi)({},u),d.forEach((function(e,t){i[t]=e})))}return e.info?this.cache.policies.runMergeFunction(t,i,e.info,r,a&&(l=r.store).getStorage.apply(l,a)):i},e}(),Ne=[];function Ie(e,t){var i=e.map;return i.has(t)||i.set(t,Ne.pop()||{map:new Map}),i.get(t)}function Le(e,t){var i=e.map,n=i.get(t);!n||n.info||n.map.size||(Ne.push(n),i.delete(t))}new Set;var Re=new G;function ke(e,t){if(e.size){var i=[];e.forEach((function(e){return i.push(e)})),e.clear(),i.forEach(t)}}var Ue=new WeakMap;function Be(e){var t=Ue.get(e);return t||Ue.set(e,t={vars:new Set,dep:ae()}),t}function Fe(e){var t=new Set,i=new Set,n=function(r){if(arguments.length>0)e!==r&&(e=r,t.forEach((function(e){Be(e).dep.dirty(n),Ve(e)})),ke(i,(function(t){return t(e)})));else{var o=Re.getValue();o&&(s(o),Be(o).dep(n))}return e};n.onNextChange=function(e){return i.add(e),function(){i.delete(e)}};var s=n.attachCache=function(e){return t.add(e),Be(e).vars.add(n),n};return n.forgetCache=function(e){return t.delete(e)},n}function Ve(e){e.broadcastWatches&&e.broadcastWatches()}function He(e){return void 0!==e.args?e.args:e.field?(0,o.NC)(e.field,e.variables):null}var je=function(e,t){var i=e.__typename,n=e.id,s=e._id;if("string"==typeof i&&(t&&(t.keyObject=void 0!==n?{id:n}:void 0!==s?{_id:s}:void 0),void 0===n&&(n=s),void 0!==n))return i+":"+("number"==typeof n||"string"==typeof n?n:JSON.stringify(n))},Ge=function(){},ze=function(e,t){return t.fieldName},We=function(e,t,i){return(0,i.mergeObjects)(e,t)},Ke=function(e,t){return t},Ye=function(){function e(e){this.config=e,this.typePolicies=Object.create(null),this.toBeAdded=Object.create(null),this.supertypeMap=new Map,this.fuzzySubtypes=new Map,this.rootIdsByTypename=Object.create(null),this.rootTypenamesById=Object.create(null),this.usingPossibleTypes=!1,this.config=(0,n.pi)({dataIdFromObject:je},e),this.cache=this.config.cache,this.setRootTypename("Query"),this.setRootTypename("Mutation"),this.setRootTypename("Subscription"),e.possibleTypes&&this.addPossibleTypes(e.possibleTypes),e.typePolicies&&this.addTypePolicies(e.typePolicies)}return e.prototype.identify=function(e,t,i){var n=t&&i?(0,o.qw)(e,t,i):e.__typename;if(n===this.rootTypenamesById.ROOT_QUERY)return["ROOT_QUERY"];for(var s,r={typename:n,selectionSet:t,fragmentMap:i},a=n&&this.getTypePolicy(n),l=a&&a.keyFn||this.config.dataIdFromObject;l;){var c=l(e,r);if(!Array.isArray(c)){s=c;break}l=Qe(c)}return s=s&&String(s),r.keyObject?[s,r.keyObject]:[s]},e.prototype.addTypePolicies=function(e){var t=this;Object.keys(e).forEach((function(i){var s=e[i],r=s.queryType,o=s.mutationType,a=s.subscriptionType,l=(0,n._T)(s,["queryType","mutationType","subscriptionType"]);r&&t.setRootTypename("Query",i),o&&t.setRootTypename("Mutation",i),a&&t.setRootTypename("Subscription",i),fe.call(t.toBeAdded,i)?t.toBeAdded[i].push(l):t.toBeAdded[i]=[l]}))},e.prototype.updateTypePolicy=function(e,t){var i=this,n=this.getTypePolicy(e),s=t.keyFields,r=t.fields;function o(e,t){e.merge="function"==typeof t?t:!0===t?We:!1===t?Ke:e.merge}o(n,t.merge),n.keyFn=!1===s?Ge:Array.isArray(s)?Qe(s):"function"==typeof s?s:n.keyFn,r&&Object.keys(r).forEach((function(t){var n=i.getFieldPolicy(e,t,!0),s=r[t];if("function"==typeof s)n.read=s;else{var a=s.keyArgs,l=s.read,c=s.merge;n.keyFn=!1===a?ze:Array.isArray(a)?$e(a):"function"==typeof a?a:n.keyFn,"function"==typeof l&&(n.read=l),o(n,c)}n.read&&n.merge&&(n.keyFn=n.keyFn||ze)}))},e.prototype.setRootTypename=function(e,t){void 0===t&&(t=e);var i="ROOT_"+e.toUpperCase(),n=this.rootTypenamesById[i];t!==n&&((0,s.kG)(!n||n===e,1),n&&delete this.rootIdsByTypename[n],this.rootIdsByTypename[t]=i,this.rootTypenamesById[i]=t)},e.prototype.addPossibleTypes=function(e){var t=this;this.usingPossibleTypes=!0,Object.keys(e).forEach((function(i){t.getSupertypeSet(i,!0),e[i].forEach((function(e){t.getSupertypeSet(e,!0).add(i);var n=e.match(ge);n&&n[0]===e||t.fuzzySubtypes.set(e,new RegExp(e))}))}))},e.prototype.getTypePolicy=function(e){var t=this;if(!fe.call(this.typePolicies,e)){var i=this.typePolicies[e]=Object.create(null);i.fields=Object.create(null);var s=this.supertypeMap.get(e);s&&s.size&&s.forEach((function(e){var s=t.getTypePolicy(e),r=s.fields,o=(0,n._T)(s,["fields"]);Object.assign(i,o),Object.assign(i.fields,r)}))}var r=this.toBeAdded[e];return r&&r.length&&this.updateTypePolicy(e,o.oA.apply(void 0,r.splice(0))),this.typePolicies[e]},e.prototype.getFieldPolicy=function(e,t,i){if(e){var n=this.getTypePolicy(e).fields;return n[t]||i&&(n[t]=Object.create(null))}},e.prototype.getSupertypeSet=function(e,t){var i=this.supertypeMap.get(e);return!i&&t&&this.supertypeMap.set(e,i=new Set),i},e.prototype.fragmentMatches=function(e,t,i,n){var s=this;if(!e.typeCondition)return!0;if(!t)return!1;var r=e.typeCondition.name.value;if(t===r)return!0;if(this.usingPossibleTypes&&this.supertypeMap.has(r))for(var o=this.getSupertypeSet(t,!0),a=[o],l=function(e){var t=s.getSupertypeSet(e,!1);t&&t.size&&a.indexOf(t)<0&&a.push(t)},c=!(!i||!this.fuzzySubtypes.size),d=0;d<a.length;++d){var h=a[d];if(h.has(r))return o.has(r)||o.add(r),!0;h.forEach(l),c&&d===a.length-1&&ye(e.selectionSet,i,n)&&(c=!1,!0,this.fuzzySubtypes.forEach((function(e,i){var n=t.match(e);n&&n[0]===t&&l(i)})))}return!1},e.prototype.hasKeyArgs=function(e,t){var i=this.getFieldPolicy(e,t,!1);return!(!i||!i.keyFn)},e.prototype.getStoreFieldName=function(e){var t,i=e.typename,n=e.fieldName,s=this.getFieldPolicy(i,n,!1),r=s&&s.keyFn;if(r&&i)for(var a={typename:i,fieldName:n,field:e.field||null,variables:e.variables},l=He(e);r;){var c=r(l,a);if(!Array.isArray(c)){t=c||n;break}r=$e(c)}return void 0===t&&(t=e.field?(0,o.vf)(e.field,e.variables):(0,o.PT)(n,He(e))),n===ve(t)?t:n+":"+t},e.prototype.readField=function(e,t){var i=e.from;if(i&&(e.field||e.fieldName)){if(void 0===e.typename){var n=t.store.getFieldValue(i,"__typename");n&&(e.typename=n)}var s=this.getStoreFieldName(e),r=ve(s),a=t.store.getFieldValue(i,s),l=this.getFieldPolicy(e.typename,r,!1),c=l&&l.read;if(c){var d=qe(this,i,e,t,t.store.getStorage((0,o.hh)(i)?i.__ref:i,s));return Re.withValue(this.cache,c,[a,d])}return a}},e.prototype.getMergeFunction=function(e,t,i){var n=this.getFieldPolicy(e,t,!1),s=n&&n.merge;return!s&&i&&(s=(n=this.getTypePolicy(i))&&n.merge),s},e.prototype.runMergeFunction=function(e,t,i,n,s){var r=i.field,o=i.typename,a=i.merge;return a===We?Ze(n.store.getFieldValue)(e,t):a===Ke?t:a(e,t,qe(this,void 0,{typename:o,fieldName:r.name.value,field:r,variables:n.variables},n,s||Object.create(null)))},e}();function qe(e,t,i,s,r){var a=e.getStoreFieldName(i),l=ve(a),c=i.variables||s.variables,d=s.store,h=d.getFieldValue,u=d.toReference,p=d.canRead;return{args:He(i),field:i.field||null,fieldName:l,storeFieldName:a,variables:c,isReference:o.hh,toReference:u,storage:r,cache:e.cache,canRead:p,readField:function(i,r){var o="string"==typeof i?{fieldName:i,from:r}:(0,n.pi)({},i);return void 0===o.from&&(o.from=t),void 0===o.variables&&(o.variables=c),e.readField(o,s)},mergeObjects:Ze(h)}}function Ze(e){return function(t,i){if(Array.isArray(t)||Array.isArray(i))throw new s.ej(2);if(t&&"object"==typeof t&&i&&"object"==typeof i){var r=e(t,"__typename"),o=e(i,"__typename");return!(r&&o&&r!==o)&&be(t)&&be(i)?(0,n.pi)((0,n.pi)({},t),i):i}return i}}function $e(e){return function(t,i){return t?i.fieldName+":"+JSON.stringify(Je(t,e,!1)):i.fieldName}}function Qe(e){var t=new U(o.mr);return function(i,n){var s;if(n.selectionSet&&n.fragmentMap){var r=t.lookupArray([n.selectionSet,n.fragmentMap]);s=r.aliasMap||(r.aliasMap=Xe(n.selectionSet,n.fragmentMap))}var o=n.keyObject=Je(i,e,!0,s);return n.typename+":"+JSON.stringify(o)}}function Xe(e,t){var i=Object.create(null),n=new Set([e]);return n.forEach((function(e){e.selections.forEach((function(e){if((0,o.My)(e)){if(e.alias){var s=e.alias.value,r=e.name.value;if(r!==s)(i.aliases||(i.aliases=Object.create(null)))[r]=s}if(e.selectionSet)(i.subsets||(i.subsets=Object.create(null)))[e.name.value]=Xe(e.selectionSet,t)}else{var a=(0,o.hi)(e,t);a&&n.add(a.selectionSet)}}))})),i}function Je(e,t,i,n){var r,o=Object.create(null);return t.forEach((function(t){if(Array.isArray(t)){if("string"==typeof r){var a=n&&n.subsets,l=a&&a[r];o[r]=Je(e[r],t,i,l)}}else{var c=n&&n.aliases,d=c&&c[t]||t;fe.call(e,d)?o[r=t]=e[d]:((0,s.kG)(!i,3),r=void 0)}})),o}var et={dataIdFromObject:je,addTypename:!0,resultCaching:!0,typePolicies:{}},tt=function(e){function t(t){void 0===t&&(t={});var i=e.call(this)||this;return i.watches=new Set,i.typenameDocumentCache=new Map,i.makeVar=Fe,i.txCount=0,i.maybeBroadcastWatch=he((function(e,t){return i.broadcastWatch.call(i,e,!!t)}),{makeCacheKey:function(e){var t=e.optimistic?i.optimisticData:i.data;if(Ae(t)){var n=e.optimistic,s=e.rootId,r=e.variables;return t.makeCacheKey(e.query,e.callback,JSON.stringify({optimistic:n,rootId:s,variables:r}))}}}),i.watchDep=ae(),i.config=(0,n.pi)((0,n.pi)({},et),t),i.addTypename=!!i.config.addTypename,i.policies=new Ye({cache:i,dataIdFromObject:i.config.dataIdFromObject,possibleTypes:i.config.possibleTypes,typePolicies:i.config.typePolicies}),i.data=new we.Root({policies:i.policies,resultCaching:i.config.resultCaching}),i.optimisticData=i.data,i.storeWriter=new De(i,i.storeReader=new Pe({cache:i,addTypename:i.addTypename})),i}return(0,n.ZT)(t,e),t.prototype.restore=function(e){return e&&this.data.replace(e),this},t.prototype.extract=function(e){return void 0===e&&(e=!1),(e?this.optimisticData:this.data).extract()},t.prototype.read=function(e){var t=e.returnPartialData,i=void 0!==t&&t;try{return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,query:e.query,variables:e.variables,rootId:e.rootId,config:this.config,returnPartialData:i}).result||null}catch(e){if(e instanceof me)return null;throw e}},t.prototype.write=function(e){try{return++this.txCount,this.storeWriter.writeToStore({store:this.data,query:e.query,result:e.result,dataId:e.dataId,variables:e.variables})}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.modify=function(e){if(fe.call(e,"id")&&!e.id)return!1;var t=e.optimistic?this.optimisticData:this.data;try{return++this.txCount,t.modify(e.id||"ROOT_QUERY",e.fields)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.diff=function(e){return this.storeReader.diffQueryAgainstStore({store:e.optimistic?this.optimisticData:this.data,rootId:e.id||"ROOT_QUERY",query:e.query,variables:e.variables,returnPartialData:e.returnPartialData,config:this.config})},t.prototype.watch=function(e){var t,i=this;return this.watches.size||Be(t=this).vars.forEach((function(e){return e.attachCache(t)})),this.watches.add(e),e.immediate&&this.maybeBroadcastWatch(e),function(){i.watches.delete(e)&&!i.watches.size&&function(e){Be(e).vars.forEach((function(t){return t.forgetCache(e)}))}(i),i.watchDep.dirty(e),i.maybeBroadcastWatch.forget(e)}},t.prototype.gc=function(){return this.optimisticData.gc()},t.prototype.retain=function(e,t){return(t?this.optimisticData:this.data).retain(e)},t.prototype.release=function(e,t){return(t?this.optimisticData:this.data).release(e)},t.prototype.identify=function(e){return(0,o.hh)(e)?e.__ref:this.policies.identify(e)[0]},t.prototype.evict=function(e){if(!e.id){if(fe.call(e,"id"))return!1;e=(0,n.pi)((0,n.pi)({},e),{id:"ROOT_QUERY"})}try{return++this.txCount,this.optimisticData.evict(e)}finally{--this.txCount||!1===e.broadcast||this.broadcastWatches()}},t.prototype.reset=function(){return this.data.clear(),this.optimisticData=this.data,this.broadcastWatches(),Promise.resolve()},t.prototype.removeOptimistic=function(e){var t=this.optimisticData.removeLayer(e);t!==this.optimisticData&&(this.optimisticData=t,this.broadcastWatches())},t.prototype.performTransaction=function(e,t){var i=this,n=function(t){var n=i,s=n.data,r=n.optimisticData;++i.txCount,t&&(i.data=i.optimisticData=t);try{e(i)}finally{--i.txCount,i.data=s,i.optimisticData=r}},s=!1;"string"==typeof t?(this.optimisticData=this.optimisticData.addLayer(t,n),s=!0):null===t?n(this.data):n(),this.broadcastWatches(s)},t.prototype.transformDocument=function(e){if(this.addTypename){var t=this.typenameDocumentCache.get(e);return t||(t=(0,o.Gw)(e),this.typenameDocumentCache.set(e,t),this.typenameDocumentCache.set(t,t)),t}return e},t.prototype.broadcastWatches=function(e){var t=this;this.txCount||this.watches.forEach((function(i){return t.maybeBroadcastWatch(i,e)}))},t.prototype.broadcastWatch=function(e,t){this.watchDep.dirty(e),this.watchDep(e);var i=this.diff({query:e.query,variables:e.variables,optimistic:e.optimistic});e.optimistic&&t&&(i.fromOptimisticTransaction=!0),e.callback(i)},t}(pe),it=function(){function e(e){var t=e.cache,i=e.client,n=e.resolvers,s=e.fragmentMatcher;this.cache=t,i&&(this.client=i),n&&this.addResolvers(n),s&&this.setFragmentMatcher(s)}return e.prototype.addResolvers=function(e){var t=this;this.resolvers=this.resolvers||{},Array.isArray(e)?e.forEach((function(e){t.resolvers=(0,o.Ee)(t.resolvers,e)})):this.resolvers=(0,o.Ee)(this.resolvers,e)},e.prototype.setResolvers=function(e){this.resolvers={},this.addResolvers(e)},e.prototype.getResolvers=function(){return this.resolvers||{}},e.prototype.runResolvers=function(e){var t=e.document,i=e.remoteResult,s=e.context,r=e.variables,o=e.onlyRunForcedResolvers,a=void 0!==o&&o;return(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(e){return t?[2,this.resolveDocument(t,i.data,s,r,this.fragmentMatcher,a).then((function(e){return(0,n.pi)((0,n.pi)({},i),{data:e.result})}))]:[2,i]}))}))},e.prototype.setFragmentMatcher=function(e){this.fragmentMatcher=e},e.prototype.getFragmentMatcher=function(){return this.fragmentMatcher},e.prototype.clientQuery=function(e){return(0,o.FS)(["client"],e)&&this.resolvers?e:null},e.prototype.serverQuery=function(e){return(0,o.ob)(e)},e.prototype.prepareContext=function(e){var t=this.cache;return(0,n.pi)((0,n.pi)({},e),{cache:t,getCacheKey:function(e){return t.identify(e)}})},e.prototype.addExportedVariables=function(e,t,i){return void 0===t&&(t={}),void 0===i&&(i={}),(0,n.mG)(this,void 0,void 0,(function(){return(0,n.Jh)(this,(function(s){return e?[2,this.resolveDocument(e,this.buildRootValueFromCache(e,t)||{},this.prepareContext(i),t).then((function(e){return(0,n.pi)((0,n.pi)({},t),e.exportedVariables)}))]:[2,(0,n.pi)({},t)]}))}))},e.prototype.shouldForceResolvers=function(e){var t=!1;return(0,N.Vn)(e,{Directive:{enter:function(e){if("client"===e.name.value&&e.arguments&&(t=e.arguments.some((function(e){return"always"===e.name.value&&"BooleanValue"===e.value.kind&&!0===e.value.value}))))return N.$_}}}),t},e.prototype.buildRootValueFromCache=function(e,t){return this.cache.diff({query:(0,o.aL)(e),variables:t,returnPartialData:!0,optimistic:!1}).result},e.prototype.resolveDocument=function(e,t,i,s,r,a){return void 0===i&&(i={}),void 0===s&&(s={}),void 0===r&&(r=function(){return!0}),void 0===a&&(a=!1),(0,n.mG)(this,void 0,void 0,(function(){var l,c,d,h,u,p,m,f,g;return(0,n.Jh)(this,(function(v){return l=(0,o.p$)(e),c=(0,o.kU)(e),d=(0,o.F)(c),h=l.operation,u=h?h.charAt(0).toUpperCase()+h.slice(1):"Query",m=(p=this).cache,f=p.client,g={fragmentMap:d,context:(0,n.pi)((0,n.pi)({},i),{cache:m,client:f}),variables:s,fragmentMatcher:r,defaultOperationType:u,exportedVariables:{},onlyRunForcedResolvers:a},[2,this.resolveSelectionSet(l.selectionSet,t,g).then((function(e){return{result:e,exportedVariables:g.exportedVariables}}))]}))}))},e.prototype.resolveSelectionSet=function(e,t,i){return(0,n.mG)(this,void 0,void 0,(function(){var r,a,l,c,d,h=this;return(0,n.Jh)(this,(function(u){return r=i.fragmentMap,a=i.context,l=i.variables,c=[t],d=function(e){return(0,n.mG)(h,void 0,void 0,(function(){var d,h;return(0,n.Jh)(this,(function(n){return(0,o.LZ)(e,l)?(0,o.My)(e)?[2,this.resolveField(e,t,i).then((function(t){var i;void 0!==t&&c.push(((i={})[(0,o.u2)(e)]=t,i))}))]:((0,o.Ao)(e)?d=e:(d=r[e.name.value],(0,s.kG)(d,11)),d&&d.typeCondition&&(h=d.typeCondition.name.value,i.fragmentMatcher(t,h,a))?[2,this.resolveSelectionSet(d.selectionSet,t,i).then((function(e){c.push(e)}))]:[2]):[2]}))}))},[2,Promise.all(e.selections.map(d)).then((function(){return(0,o.bw)(c)}))]}))}))},e.prototype.resolveField=function(e,t,i){return(0,n.mG)(this,void 0,void 0,(function(){var s,r,a,l,c,d,h,u,p,m=this;return(0,n.Jh)(this,(function(n){return s=i.variables,r=e.name.value,a=(0,o.u2)(e),l=r!==a,c=t[a]||t[r],d=Promise.resolve(c),i.onlyRunForcedResolvers&&!this.shouldForceResolvers(e)||(h=t.__typename||i.defaultOperationType,(u=this.resolvers&&this.resolvers[h])&&(p=u[l?r:a])&&(d=Promise.resolve(Re.withValue(this.cache,p,[t,(0,o.NC)(e,s),i.context,{field:e,fragmentMap:i.fragmentMap}])))),[2,d.then((function(t){return void 0===t&&(t=c),e.directives&&e.directives.forEach((function(e){"export"===e.name.value&&e.arguments&&e.arguments.forEach((function(e){"as"===e.name.value&&"StringValue"===e.value.kind&&(i.exportedVariables[e.value.value]=t)}))})),e.selectionSet?null==t?t:Array.isArray(t)?m.resolveSubSelectedArray(e,t,i):e.selectionSet?m.resolveSelectionSet(e.selectionSet,t,i):void 0:t}))]}))}))},e.prototype.resolveSubSelectedArray=function(e,t,i){var n=this;return Promise.all(t.map((function(t){return null===t?null:Array.isArray(t)?n.resolveSubSelectedArray(e,t,i):e.selectionSet?n.resolveSelectionSet(e.selectionSet,t,i):void 0})))},e}(),nt=new(o.mr?WeakMap:Map);function st(e,t){var i=e[t];"function"==typeof i&&(e[t]=function(){return nt.set(e,(nt.get(e)+1)%1e15),i.apply(this,arguments)})}function rt(e){e.notifyTimeout&&(clearTimeout(e.notifyTimeout),e.notifyTimeout=void 0)}var ot=function(){function e(e){this.cache=e,this.listeners=new Set,this.document=null,this.lastRequestId=1,this.subscriptions=new Set,this.stopped=!1,this.dirty=!1,this.diff=null,this.observableQuery=null,nt.has(e)||(nt.set(e,0),st(e,"evict"),st(e,"modify"),st(e,"reset"))}return e.prototype.init=function(e){var t=e.networkStatus||M.loading;return this.variables&&this.networkStatus!==M.loading&&!S(this.variables,e.variables)&&(t=M.setVariables),S(e.variables,this.variables)||(this.diff=null),Object.assign(this,{document:e.document,variables:e.variables,networkError:null,graphQLErrors:this.graphQLErrors||[],networkStatus:t}),e.observableQuery&&this.setObservableQuery(e.observableQuery),e.lastRequestId&&(this.lastRequestId=e.lastRequestId),this},e.prototype.reset=function(){rt(this),this.diff=null,this.dirty=!1},e.prototype.getDiff=function(e){return void 0===e&&(e=this.variables),this.diff&&S(e,this.variables)?this.diff:(this.updateWatch(this.variables=e),this.diff=this.cache.diff({query:this.document,variables:e,returnPartialData:!0,optimistic:!0}))},e.prototype.setDiff=function(e){var t=this,i=this.diff;this.diff=e,this.dirty||(e&&e.result)===(i&&i.result)||(this.dirty=!0,this.notifyTimeout||(this.notifyTimeout=setTimeout((function(){return t.notify()}),0)))},e.prototype.setObservableQuery=function(e){var t=this;e!==this.observableQuery&&(this.oqListener&&this.listeners.delete(this.oqListener),this.observableQuery=e,e?(e.queryInfo=this,this.listeners.add(this.oqListener=function(){t.getDiff().fromOptimisticTransaction?e.observe():e.reobserve()})):delete this.oqListener)},e.prototype.notify=function(){var e=this;rt(this),this.shouldNotify()&&this.listeners.forEach((function(t){return t(e)})),this.dirty=!1},e.prototype.shouldNotify=function(){if(!this.dirty||!this.listeners.size)return!1;if(A(this.networkStatus)&&this.observableQuery){var e=this.observableQuery.options.fetchPolicy;if("cache-only"!==e&&"cache-and-network"!==e)return!1}return!0},e.prototype.stop=function(){if(!this.stopped){this.stopped=!0,this.cancel(),delete this.cancel,this.subscriptions.forEach((function(e){return e.unsubscribe()}));var e=this.observableQuery;e&&e.stopPolling()}},e.prototype.cancel=function(){},e.prototype.updateWatch=function(e){var t=this;void 0===e&&(e=this.variables);var i=this.observableQuery;i&&"no-cache"===i.options.fetchPolicy||this.lastWatch&&this.lastWatch.query===this.document&&S(e,this.lastWatch.variables)||(this.cancel(),this.cancel=this.cache.watch(this.lastWatch={query:this.document,variables:e,optimistic:!0,callback:function(e){return t.setDiff(e)}}))},e.prototype.shouldWrite=function(e,t){var i=this.lastWrite;return!(i&&i.dmCount===nt.get(this.cache)&&S(t,i.variables)&&S(e.data,i.result.data))},e.prototype.markResult=function(e,t,i){var n=this;this.graphQLErrors=(0,o.Of)(e.errors)?e.errors:[],this.reset(),"no-cache"===t.fetchPolicy?this.diff={result:e.data,complete:!0}:!this.stopped&&i&&(at(e,t.errorPolicy)?this.cache.performTransaction((function(i){if(n.shouldWrite(e,t.variables))i.writeQuery({query:n.document,data:e.data,variables:t.variables}),n.lastWrite={result:e,variables:t.variables,dmCount:nt.get(n.cache)};else if(n.diff&&n.diff.complete)return void(e.data=n.diff.result);var s=i.diff({query:n.document,variables:t.variables,returnPartialData:!0,optimistic:!0});n.stopped||n.updateWatch(t.variables),n.diff=s,s.complete&&(e.data=s.result)})):this.lastWrite=void 0)},e.prototype.markReady=function(){return this.networkError=null,this.networkStatus=M.ready},e.prototype.markError=function(e){return this.networkStatus=M.error,this.lastWrite=void 0,this.reset(),e.graphQLErrors&&(this.graphQLErrors=e.graphQLErrors),e.networkError&&(this.networkError=e.networkError),e},e}();function at(e,t){void 0===t&&(t="none");var i="ignore"===t||"all"===t,n=!(0,o.d2)(e);return!n&&i&&e.data&&(n=!0),n}var lt=Object.prototype.hasOwnProperty,ct=function(){function e(e){var t=e.cache,i=e.link,n=e.queryDeduplication,s=void 0!==n&&n,r=e.onBroadcast,a=e.ssrMode,l=void 0!==a&&a,c=e.clientAwareness,d=void 0===c?{}:c,h=e.localState,u=e.assumeImmutableResults;this.clientAwareness={},this.queries=new Map,this.fetchCancelFns=new Map,this.transformCache=new(o.mr?WeakMap:Map),this.queryIdCounter=1,this.requestIdCounter=1,this.mutationIdCounter=1,this.inFlightLinkObservables=new Map,this.cache=t,this.link=i,this.queryDeduplication=s,this.clientAwareness=d,this.localState=h||new it({cache:t}),this.ssrMode=l,this.assumeImmutableResults=!!u,(this.onBroadcast=r)&&(this.mutationStore=Object.create(null))}return e.prototype.stop=function(){var e=this;this.queries.forEach((function(t,i){e.stopQueryNoBroadcast(i)})),this.cancelPendingFetches(new s.ej(12))},e.prototype.cancelPendingFetches=function(e){this.fetchCancelFns.forEach((function(t){return t(e)})),this.fetchCancelFns.clear()},e.prototype.mutate=function(e){var t=e.mutation,i=e.variables,r=e.optimisticResponse,a=e.updateQueries,l=e.refetchQueries,c=void 0===l?[]:l,d=e.awaitRefetchQueries,h=void 0!==d&&d,u=e.update,p=e.errorPolicy,m=void 0===p?"none":p,f=e.fetchPolicy,g=e.context,v=void 0===g?{}:g;return(0,n.mG)(this,void 0,void 0,(function(){var e,l,d;return(0,n.Jh)(this,(function(p){switch(p.label){case 0:return(0,s.kG)(t,13),(0,s.kG)(!f||"no-cache"===f,14),e=this.generateMutationId(),t=this.transform(t).document,i=this.getVariables(t,i),this.transform(t).hasClientExports?[4,this.localState.addExportedVariables(t,i,v)]:[3,2];case 1:i=p.sent(),p.label=2;case 2:return l=this.mutationStore&&(this.mutationStore[e]={mutation:t,variables:i,loading:!0,error:null}),r&&this.markMutationOptimistic(r,{mutationId:e,document:t,variables:i,errorPolicy:m,updateQueries:a,update:u}),this.broadcastQueries(),d=this,[2,new Promise((function(s,p){var g,y;d.getObservableFromLink(t,(0,n.pi)((0,n.pi)({},v),{optimisticResponse:r}),i,!1).subscribe({next:function(n){if((0,o.d2)(n)&&"none"===m)y=new O({graphQLErrors:n.errors});else{if(l&&(l.loading=!1,l.error=null),"no-cache"!==f)try{d.markMutationResult({mutationId:e,result:n,document:t,variables:i,errorPolicy:m,updateQueries:a,update:u})}catch(e){return void(y=new O({networkError:e}))}g=n}},error:function(t){l&&(l.loading=!1,l.error=t),r&&d.cache.removeOptimistic(e),d.broadcastQueries(),p(new O({networkError:t}))},complete:function(){if(y&&l&&(l.loading=!1,l.error=y),r&&d.cache.removeOptimistic(e),d.broadcastQueries(),y)p(y);else{"function"==typeof c&&(c=c(g));var t=[];(0,o.Of)(c)&&c.forEach((function(e){if("string"==typeof e)d.queries.forEach((function(i){var n=i.observableQuery;n&&n.queryName===e&&t.push(n.refetch())}));else{var i={query:e.query,variables:e.variables,fetchPolicy:"network-only"};e.context&&(i.context=e.context),t.push(d.query(i))}})),Promise.all(h?t:[]).then((function(){"ignore"===m&&g&&(0,o.d2)(g)&&delete g.errors,s(g)}),p)}}})}))]}}))}))},e.prototype.markMutationResult=function(e,t){var i=this;if(void 0===t&&(t=this.cache),at(e.result,e.errorPolicy)){var n=[{result:e.result.data,dataId:"ROOT_MUTATION",query:e.document,variables:e.variables}],s=e.updateQueries;s&&this.queries.forEach((function(r,a){var l=r.observableQuery,c=l&&l.queryName;if(c&&lt.call(s,c)){var d=s[c],h=i.queries.get(a),u=h.document,p=h.variables,m=t.diff({query:u,variables:p,returnPartialData:!0,optimistic:!1}),f=m.result;if(m.complete&&f){var g=d(f,{mutationResult:e.result,queryName:u&&(0,o.rY)(u)||void 0,queryVariables:p});g&&n.push({result:g,dataId:"ROOT_QUERY",query:u,variables:p})}}})),t.performTransaction((function(t){n.forEach((function(e){return t.write(e)}));var i=e.update;i&&i(t,e.result)}),null)}},e.prototype.markMutationOptimistic=function(e,t){var i=this,s="function"==typeof e?e(t.variables):e;return this.cache.recordOptimisticTransaction((function(e){try{i.markMutationResult((0,n.pi)((0,n.pi)({},t),{result:{data:s}}),e)}catch(e){}}),t.mutationId)},e.prototype.fetchQuery=function(e,t,i){return this.fetchQueryObservable(e,t,i).promise},e.prototype.getQueryStore=function(){var e=Object.create(null);return this.queries.forEach((function(t,i){e[i]={variables:t.variables,networkStatus:t.networkStatus,networkError:t.networkError,graphQLErrors:t.graphQLErrors}})),e},e.prototype.resetErrors=function(e){var t=this.queries.get(e);t&&(t.networkError=void 0,t.graphQLErrors=[])},e.prototype.transform=function(e){var t=this.transformCache;if(!t.has(e)){var i=this.cache.transformDocument(e),n=(0,o.Fo)(this.cache.transformForLink(i)),s=this.localState.clientQuery(i),r=n&&this.localState.serverQuery(n),a={document:i,hasClientExports:(0,o.mj)(i),hasForcedResolvers:this.localState.shouldForceResolvers(i),clientQuery:s,serverQuery:r,defaultVars:(0,o.O4)((0,o.$H)(i))},l=function(e){e&&!t.has(e)&&t.set(e,a)};l(e),l(i),l(s),l(r)}return t.get(e)},e.prototype.getVariables=function(e,t){return(0,n.pi)((0,n.pi)({},this.transform(e).defaultVars),t)},e.prototype.watchQuery=function(e){void 0===(e=(0,n.pi)((0,n.pi)({},e),{variables:this.getVariables(e.query,e.variables)})).notifyOnNetworkStatusChange&&(e.notifyOnNetworkStatusChange=!1);var t=new ot(this.cache),i=new P({queryManager:this,queryInfo:t,options:e});return this.queries.set(i.queryId,t),t.init({document:e.query,observableQuery:i,variables:e.variables}),i},e.prototype.query=function(e){var t=this;(0,s.kG)(e.query,15),(0,s.kG)("Document"===e.query.kind,16),(0,s.kG)(!e.returnPartialData,17),(0,s.kG)(!e.pollInterval,18);var i=this.generateQueryId();return this.fetchQuery(i,e).finally((function(){return t.stopQuery(i)}))},e.prototype.generateQueryId=function(){return String(this.queryIdCounter++)},e.prototype.generateRequestId=function(){return this.requestIdCounter++},e.prototype.generateMutationId=function(){return String(this.mutationIdCounter++)},e.prototype.stopQueryInStore=function(e){this.stopQueryInStoreNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryInStoreNoBroadcast=function(e){var t=this.queries.get(e);t&&t.stop()},e.prototype.clearStore=function(){return this.cancelPendingFetches(new s.ej(19)),this.queries.forEach((function(e){e.observableQuery?e.networkStatus=M.loading:e.stop()})),this.mutationStore&&(this.mutationStore=Object.create(null)),this.cache.reset()},e.prototype.resetStore=function(){var e=this;return this.clearStore().then((function(){return e.reFetchObservableQueries()}))},e.prototype.reFetchObservableQueries=function(e){var t=this;void 0===e&&(e=!1);var i=[];return this.queries.forEach((function(n,s){var r=n.observableQuery;if(r&&r.hasObservers()){var o=r.options.fetchPolicy;r.resetLastResults(),"cache-only"===o||!e&&"standby"===o||i.push(r.refetch()),t.getQuery(s).setDiff(null)}})),this.broadcastQueries(),Promise.all(i)},e.prototype.setObservableQuery=function(e){this.getQuery(e.queryId).setObservableQuery(e)},e.prototype.startGraphQLSubscription=function(e){var t=this,i=e.query,n=e.fetchPolicy,s=e.errorPolicy,r=e.variables,a=e.context,l=void 0===a?{}:a;i=this.transform(i).document,r=this.getVariables(i,r);var c=function(e){return t.getObservableFromLink(i,l,e,!1).map((function(r){if("no-cache"!==n&&(at(r,s)&&t.cache.write({query:i,result:r.data,dataId:"ROOT_SUBSCRIPTION",variables:e}),t.broadcastQueries()),(0,o.d2)(r))throw new O({graphQLErrors:r.errors});return r}))};if(this.transform(i).hasClientExports){var d=this.localState.addExportedVariables(i,r,l).then(c);return new o.y$((function(e){var t=null;return d.then((function(i){return t=i.subscribe(e)}),e.error),function(){return t&&t.unsubscribe()}}))}return c(r)},e.prototype.stopQuery=function(e){this.stopQueryNoBroadcast(e),this.broadcastQueries()},e.prototype.stopQueryNoBroadcast=function(e){this.stopQueryInStoreNoBroadcast(e),this.removeQuery(e)},e.prototype.removeQuery=function(e){this.fetchCancelFns.delete(e),this.getQuery(e).stop(),this.queries.delete(e)},e.prototype.broadcastQueries=function(){this.onBroadcast&&this.onBroadcast(),this.queries.forEach((function(e){return e.notify()}))},e.prototype.getLocalState=function(){return this.localState},e.prototype.getObservableFromLink=function(e,t,i,s){var a,l,c=this;void 0===s&&(s=null!==(a=null==t?void 0:t.queryDeduplication)&&void 0!==a?a:this.queryDeduplication);var d=this.transform(e).serverQuery;if(d){var h=this.inFlightLinkObservables,u=this.link,p={query:d,variables:i,operationName:(0,o.rY)(d)||void 0,context:this.prepareContext((0,n.pi)((0,n.pi)({},t),{forceFetch:!s}))};if(t=p.context,s){var m=h.get(d)||new Map;h.set(d,m);var f=JSON.stringify(i);if(!(l=m.get(f))){var g=new o.X_([(0,r.ht)(u,p)]);m.set(f,l=g),g.cleanup((function(){m.delete(f)&&m.size<1&&h.delete(d)}))}}else l=new o.X_([(0,r.ht)(u,p)])}else l=new o.X_([o.y$.of({data:{}})]),t=this.prepareContext(t);var v=this.transform(e).clientQuery;return v&&(l=(0,o.sz)(l,(function(e){return c.localState.runResolvers({document:v,remoteResult:e,context:t,variables:i})}))),l},e.prototype.getResultsFromLink=function(e,t,i){var n=e.lastRequestId;return(0,o.sz)(this.getObservableFromLink(e.document,i.context,i.variables),(function(s){var r=(0,o.Of)(s.errors);if(n>=e.lastRequestId){if(r&&"none"===i.errorPolicy)throw e.markError(new O({graphQLErrors:s.errors}));e.markResult(s,i,t),e.markReady()}var a={data:s.data,loading:!1,networkStatus:e.networkStatus||M.ready};return r&&"ignore"!==i.errorPolicy&&(a.errors=s.errors),a}),(function(t){var i=t.hasOwnProperty("graphQLErrors")?t:new O({networkError:t});throw n>=e.lastRequestId&&e.markError(i),i}))},e.prototype.fetchQueryObservable=function(e,t,i){var n=this;void 0===i&&(i=M.loading);var s=this.transform(t.query).document,r=this.getVariables(s,t.variables),a=this.getQuery(e),l=a.networkStatus,c=t.fetchPolicy,d=void 0===c?"cache-first":c,h=t.errorPolicy,u=void 0===h?"none":h,p=t.returnPartialData,m=void 0!==p&&p,f=t.notifyOnNetworkStatusChange,g=void 0!==f&&f,v=t.context,y=void 0===v?{}:v;("cache-first"===d||"cache-and-network"===d||"network-only"===d||"no-cache"===d)&&g&&"number"==typeof l&&l!==i&&A(i)&&("cache-first"!==d&&(d="cache-and-network"),m=!0);var b=Object.assign({},t,{query:s,variables:r,fetchPolicy:d,errorPolicy:u,returnPartialData:m,notifyOnNetworkStatusChange:g,context:y}),S=function(e){return b.variables=e,n.fetchQueryByPolicy(a,b,i)};this.fetchCancelFns.set(e,(function(e){Promise.resolve().then((function(){return E.cancel(e)}))}));var E=new o.X_(this.transform(b.query).hasClientExports?this.localState.addExportedVariables(b.query,b.variables,b.context).then(S):S(b.variables));return E.cleanup((function(){n.fetchCancelFns.delete(e);var i=t.nextFetchPolicy;i&&(t.nextFetchPolicy=void 0,t.fetchPolicy="function"==typeof i?i.call(t,t.fetchPolicy||"cache-first"):i)})),E},e.prototype.fetchQueryByPolicy=function(e,t,i){var s=this,r=t.query,a=t.variables,l=t.fetchPolicy,c=t.errorPolicy,d=t.returnPartialData,h=t.context;e.init({document:r,variables:a,lastRequestId:this.generateRequestId(),networkStatus:i});var u=function(){return e.getDiff(a)},p=function(t,i){void 0===i&&(i=e.networkStatus||M.loading);var l=t.result;var c=function(e){return o.y$.of((0,n.pi)({data:e,loading:A(i),networkStatus:i},t.complete?null:{partial:!0}))};return s.transform(r).hasForcedResolvers?s.localState.runResolvers({document:r,remoteResult:{data:l},context:h,variables:a,onlyRunForcedResolvers:!0}).then((function(e){return c(e.data)})):c(l)},m=function(t){return s.getResultsFromLink(e,t,{variables:a,context:h,fetchPolicy:l,errorPolicy:c})};switch(l){default:case"cache-first":return(f=u()).complete?[p(f,e.markReady())]:d?[p(f),m(!0)]:[m(!0)];case"cache-and-network":var f;return(f=u()).complete||d?[p(f),m(!0)]:[m(!0)];case"cache-only":return[p(u(),e.markReady())];case"network-only":return[m(!0)];case"no-cache":return[m(!1)];case"standby":return[]}},e.prototype.getQuery=function(e){return e&&!this.queries.has(e)&&this.queries.set(e,new ot(this.cache)),this.queries.get(e)},e.prototype.prepareContext=function(e){void 0===e&&(e={});var t=this.localState.prepareContext(e);return(0,n.pi)((0,n.pi)({},t),{clientAwareness:this.clientAwareness})},e}();function dt(e,t){return(0,o.oA)(e,t,t.variables&&{variables:(0,n.pi)((0,n.pi)({},e.variables),t.variables)})}var ht=function(){function e(e){var t=this;this.defaultOptions={},this.resetStoreCallbacks=[],this.clearStoreCallbacks=[];var i=e.uri,n=e.credentials,o=e.headers,a=e.cache,l=e.ssrMode,c=void 0!==l&&l,d=e.ssrForceFetchDelay,h=void 0===d?0:d,u=e.connectToDevTools,p=void 0===u?"object"==typeof window&&!window.__APOLLO_CLIENT__&&!1:u,f=e.queryDeduplication,g=void 0===f||f,v=e.defaultOptions,y=e.assumeImmutableResults,b=void 0!==y&&y,S=e.resolvers,E=e.typeDefs,T=e.fragmentMatcher,w=e.name,x=e.version,_=e.link;if(_||(_=i?new m({uri:i,credentials:n,headers:o}):r.i0.empty()),!a)throw new s.ej(9);this.link=_,this.cache=a,this.disableNetworkFetches=c||h>0,this.queryDeduplication=g,this.defaultOptions=v||{},this.typeDefs=E,h&&setTimeout((function(){return t.disableNetworkFetches=!1}),h),this.watchQuery=this.watchQuery.bind(this),this.query=this.query.bind(this),this.mutate=this.mutate.bind(this),this.resetStore=this.resetStore.bind(this),this.reFetchObservableQueries=this.reFetchObservableQueries.bind(this),p&&"object"==typeof window&&(window.__APOLLO_CLIENT__=this),this.version="3.3.11",this.localState=new it({cache:a,client:this,resolvers:S,fragmentMatcher:T}),this.queryManager=new ct({cache:this.cache,link:this.link,queryDeduplication:g,ssrMode:c,clientAwareness:{name:w,version:x},localState:this.localState,assumeImmutableResults:b,onBroadcast:p?function(){t.devToolsHookCb&&t.devToolsHookCb({action:{},state:{queries:t.queryManager.getQueryStore(),mutations:t.queryManager.mutationStore||{}},dataWithOptimisticResults:t.cache.extract(!0)})}:void 0})}return e.prototype.stop=function(){this.queryManager.stop()},e.prototype.watchQuery=function(e){return this.defaultOptions.watchQuery&&(e=dt(this.defaultOptions.watchQuery,e)),!this.disableNetworkFetches||"network-only"!==e.fetchPolicy&&"cache-and-network"!==e.fetchPolicy||(e=(0,n.pi)((0,n.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.watchQuery(e)},e.prototype.query=function(e){return this.defaultOptions.query&&(e=dt(this.defaultOptions.query,e)),(0,s.kG)("cache-and-network"!==e.fetchPolicy,10),this.disableNetworkFetches&&"network-only"===e.fetchPolicy&&(e=(0,n.pi)((0,n.pi)({},e),{fetchPolicy:"cache-first"})),this.queryManager.query(e)},e.prototype.mutate=function(e){return this.defaultOptions.mutate&&(e=dt(this.defaultOptions.mutate,e)),this.queryManager.mutate(e)},e.prototype.subscribe=function(e){return this.queryManager.startGraphQLSubscription(e)},e.prototype.readQuery=function(e,t){return void 0===t&&(t=!1),this.cache.readQuery(e,t)},e.prototype.readFragment=function(e,t){return void 0===t&&(t=!1),this.cache.readFragment(e,t)},e.prototype.writeQuery=function(e){this.cache.writeQuery(e),this.queryManager.broadcastQueries()},e.prototype.writeFragment=function(e){this.cache.writeFragment(e),this.queryManager.broadcastQueries()},e.prototype.__actionHookForDevTools=function(e){this.devToolsHookCb=e},e.prototype.__requestRaw=function(e){return(0,r.ht)(this.link,e)},e.prototype.resetStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.resetStoreCallbacks.map((function(e){return e()})))})).then((function(){return e.reFetchObservableQueries()}))},e.prototype.clearStore=function(){var e=this;return Promise.resolve().then((function(){return e.queryManager.clearStore()})).then((function(){return Promise.all(e.clearStoreCallbacks.map((function(e){return e()})))}))},e.prototype.onResetStore=function(e){var t=this;return this.resetStoreCallbacks.push(e),function(){t.resetStoreCallbacks=t.resetStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.onClearStore=function(e){var t=this;return this.clearStoreCallbacks.push(e),function(){t.clearStoreCallbacks=t.clearStoreCallbacks.filter((function(t){return t!==e}))}},e.prototype.reFetchObservableQueries=function(e){return this.queryManager.reFetchObservableQueries(e)},e.prototype.extract=function(e){return this.cache.extract(e)},e.prototype.restore=function(e){return this.cache.restore(e)},e.prototype.addResolvers=function(e){this.localState.addResolvers(e)},e.prototype.setResolvers=function(e){this.localState.setResolvers(e)},e.prototype.getResolvers=function(){return this.localState.getResolvers()},e.prototype.setLocalStateFragmentMatcher=function(e){this.localState.setFragmentMatcher(e)},e.prototype.setLink=function(e){this.link=this.queryManager.link=e},e}();i(72191),i(35367);function ut(e){return(ut="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}"function"==typeof Symbol&&null!=Symbol.iterator&&Symbol.iterator,"function"==typeof Symbol&&null!=Symbol.asyncIterator&&Symbol.asyncIterator;var pt="function"==typeof Symbol&&null!=Symbol.toStringTag?Symbol.toStringTag:"@@toStringTag";function mt(e,t){for(var i,n=/\r\n|[\n\r]/g,s=1,r=t+1;(i=n.exec(e.body))&&i.index<t;)s+=1,r=t+1-(i.index+i[0].length);return{line:s,column:r}}function ft(e){return gt(e.source,mt(e.source,e.start))}function gt(e,t){var i=e.locationOffset.column-1,n=yt(i)+e.body,s=t.line-1,r=e.locationOffset.line-1,o=t.line+r,a=1===t.line?i:0,l=t.column+a,c="".concat(e.name,":").concat(o,":").concat(l,"\n"),d=n.split(/\r\n|[\n\r]/g),h=d[s];if(h.length>120){for(var u=Math.floor(l/80),p=l%80,m=[],f=0;f<h.length;f+=80)m.push(h.slice(f,f+80));return c+vt([["".concat(o),m[0]]].concat(m.slice(1,u+1).map((function(e){return["",e]})),[[" ",yt(p-1)+"^"],["",m[u+1]]]))}return c+vt([["".concat(o-1),d[s-1]],["".concat(o),h],["",yt(l-1)+"^"],["".concat(o+1),d[s+1]]])}function vt(e){var t=e.filter((function(e){e[0];return void 0!==e[1]})),i=Math.max.apply(Math,t.map((function(e){return e[0].length})));return t.map((function(e){var t,n=e[0],s=e[1];return yt(i-(t=n).length)+t+(s?" | "+s:" |")})).join("\n")}function yt(e){return Array(e+1).join(" ")}function bt(e){return(bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function St(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Et(e,t){return!t||"object"!==bt(t)&&"function"!=typeof t?Tt(e):t}function Tt(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wt(e){var t="function"==typeof Map?new Map:void 0;return(wt=function(e){if(null===e||(i=e,-1===Function.toString.call(i).indexOf("[native code]")))return e;var i;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return xt(e,arguments,Ot(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Mt(n,e)})(e)}function xt(e,t,i){return(xt=_t()?Reflect.construct:function(e,t,i){var n=[null];n.push.apply(n,t);var s=new(Function.bind.apply(e,n));return i&&Mt(s,i.prototype),s}).apply(null,arguments)}function _t(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function Mt(e,t){return(Mt=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function Ot(e){return(Ot=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}var At=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Mt(e,t)}(a,e);var t,i,n,s,r,o=(t=a,i=_t(),function(){var e,n=Ot(t);if(i){var s=Ot(this).constructor;e=Reflect.construct(n,arguments,s)}else e=n.apply(this,arguments);return Et(this,e)});function a(e,t,i,n,s,r,l){var c,d,h,u,p;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,a),p=o.call(this,e);var m,f=Array.isArray(t)?0!==t.length?t:void 0:t?[t]:void 0,g=i;!g&&f&&(g=null===(m=f[0].loc)||void 0===m?void 0:m.source);var v,y=n;!y&&f&&(y=f.reduce((function(e,t){return t.loc&&e.push(t.loc.start),e}),[])),y&&0===y.length&&(y=void 0),n&&i?v=n.map((function(e){return mt(i,e)})):f&&(v=f.reduce((function(e,t){return t.loc&&e.push(mt(t.loc.source,t.loc.start)),e}),[]));var b,S=l;if(null==S&&null!=r){var E=r.extensions;"object"==ut(b=E)&&null!==b&&(S=E)}return Object.defineProperties(Tt(p),{name:{value:"GraphQLError"},message:{value:e,enumerable:!0,writable:!0},locations:{value:null!==(c=v)&&void 0!==c?c:void 0,enumerable:null!=v},path:{value:null!=s?s:void 0,enumerable:null!=s},nodes:{value:null!=f?f:void 0},source:{value:null!==(d=g)&&void 0!==d?d:void 0},positions:{value:null!==(h=y)&&void 0!==h?h:void 0},originalError:{value:r},extensions:{value:null!==(u=S)&&void 0!==u?u:void 0,enumerable:null!=S}}),null!=r&&r.stack?(Object.defineProperty(Tt(p),"stack",{value:r.stack,writable:!0,configurable:!0}),Et(p)):(Error.captureStackTrace?Error.captureStackTrace(Tt(p),a):Object.defineProperty(Tt(p),"stack",{value:Error().stack,writable:!0,configurable:!0}),p)}return n=a,(s=[{key:"toString",value:function(){return function(e){var t=e.message;if(e.nodes)for(var i=0,n=e.nodes;i<n.length;i++){var s=n[i];s.loc&&(t+="\n\n"+ft(s.loc))}else if(e.source&&e.locations)for(var r=0,o=e.locations;r<o.length;r++){var a=o[r];t+="\n\n"+gt(e.source,a)}return t}(this)}},{key:pt,get:function(){return"Object"}}])&&St(n.prototype,s),r&&St(n,r),a}(wt(Error));function Ct(e,t,i){return new At("Syntax Error: ".concat(i),void 0,e,[t])}var Pt=Object.freeze({NAME:"Name",DOCUMENT:"Document",OPERATION_DEFINITION:"OperationDefinition",VARIABLE_DEFINITION:"VariableDefinition",SELECTION_SET:"SelectionSet",FIELD:"Field",ARGUMENT:"Argument",FRAGMENT_SPREAD:"FragmentSpread",INLINE_FRAGMENT:"InlineFragment",FRAGMENT_DEFINITION:"FragmentDefinition",VARIABLE:"Variable",INT:"IntValue",FLOAT:"FloatValue",STRING:"StringValue",BOOLEAN:"BooleanValue",NULL:"NullValue",ENUM:"EnumValue",LIST:"ListValue",OBJECT:"ObjectValue",OBJECT_FIELD:"ObjectField",DIRECTIVE:"Directive",NAMED_TYPE:"NamedType",LIST_TYPE:"ListType",NON_NULL_TYPE:"NonNullType",SCHEMA_DEFINITION:"SchemaDefinition",OPERATION_TYPE_DEFINITION:"OperationTypeDefinition",SCALAR_TYPE_DEFINITION:"ScalarTypeDefinition",OBJECT_TYPE_DEFINITION:"ObjectTypeDefinition",FIELD_DEFINITION:"FieldDefinition",INPUT_VALUE_DEFINITION:"InputValueDefinition",INTERFACE_TYPE_DEFINITION:"InterfaceTypeDefinition",UNION_TYPE_DEFINITION:"UnionTypeDefinition",ENUM_TYPE_DEFINITION:"EnumTypeDefinition",ENUM_VALUE_DEFINITION:"EnumValueDefinition",INPUT_OBJECT_TYPE_DEFINITION:"InputObjectTypeDefinition",DIRECTIVE_DEFINITION:"DirectiveDefinition",SCHEMA_EXTENSION:"SchemaExtension",SCALAR_TYPE_EXTENSION:"ScalarTypeExtension",OBJECT_TYPE_EXTENSION:"ObjectTypeExtension",INTERFACE_TYPE_EXTENSION:"InterfaceTypeExtension",UNION_TYPE_EXTENSION:"UnionTypeExtension",ENUM_TYPE_EXTENSION:"EnumTypeExtension",INPUT_OBJECT_TYPE_EXTENSION:"InputObjectTypeExtension"}),Dt=i(83059),Nt=Object.freeze({SOF:"<SOF>",EOF:"<EOF>",BANG:"!",DOLLAR:"$",AMP:"&",PAREN_L:"(",PAREN_R:")",SPREAD:"...",COLON:":",EQUALS:"=",AT:"@",BRACKET_L:"[",BRACKET_R:"]",BRACE_L:"{",PIPE:"|",BRACE_R:"}",NAME:"Name",INT:"Int",FLOAT:"Float",STRING:"String",BLOCK_STRING:"BlockString",COMMENT:"Comment"}),It=i(6589);function Lt(e,t){if(!Boolean(e))throw new Error(t)}const Rt=function(e,t){return e instanceof t};function kt(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var Ut=function(){function e(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GraphQL request",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{line:1,column:1};"string"==typeof e||Lt(0,"Body must be a string. Received: ".concat((0,It.Z)(e),".")),this.body=e,this.name=t,this.locationOffset=i,this.locationOffset.line>0||Lt(0,"line in locationOffset is 1-indexed and must be positive."),this.locationOffset.column>0||Lt(0,"column in locationOffset is 1-indexed and must be positive.")}var t,i,n;return t=e,(i=[{key:pt,get:function(){return"Source"}}])&&kt(t.prototype,i),n&&kt(t,n),e}();var Bt=Object.freeze({QUERY:"QUERY",MUTATION:"MUTATION",SUBSCRIPTION:"SUBSCRIPTION",FIELD:"FIELD",FRAGMENT_DEFINITION:"FRAGMENT_DEFINITION",FRAGMENT_SPREAD:"FRAGMENT_SPREAD",INLINE_FRAGMENT:"INLINE_FRAGMENT",VARIABLE_DEFINITION:"VARIABLE_DEFINITION",SCHEMA:"SCHEMA",SCALAR:"SCALAR",OBJECT:"OBJECT",FIELD_DEFINITION:"FIELD_DEFINITION",ARGUMENT_DEFINITION:"ARGUMENT_DEFINITION",INTERFACE:"INTERFACE",UNION:"UNION",ENUM:"ENUM",ENUM_VALUE:"ENUM_VALUE",INPUT_OBJECT:"INPUT_OBJECT",INPUT_FIELD_DEFINITION:"INPUT_FIELD_DEFINITION"}),Ft=i(7420),Vt=function(){function e(e){var t=new Dt.WU(Nt.SOF,0,0,0,0,null);this.source=e,this.lastToken=t,this.token=t,this.line=1,this.lineStart=0}var t=e.prototype;return t.advance=function(){return this.lastToken=this.token,this.token=this.lookahead()},t.lookahead=function(){var e=this.token;if(e.kind!==Nt.EOF)do{var t;e=null!==(t=e.next)&&void 0!==t?t:e.next=jt(this,e)}while(e.kind===Nt.COMMENT);return e},e}();function Ht(e){return isNaN(e)?Nt.EOF:e<127?JSON.stringify(String.fromCharCode(e)):'"\\u'.concat(("00"+e.toString(16).toUpperCase()).slice(-4),'"')}function jt(e,t){for(var i=e.source,n=i.body,s=n.length,r=t.end;r<s;){var o=n.charCodeAt(r),a=e.line,l=1+r-e.lineStart;switch(o){case 65279:case 9:case 32:case 44:++r;continue;case 10:++r,++e.line,e.lineStart=r;continue;case 13:10===n.charCodeAt(r+1)?r+=2:++r,++e.line,e.lineStart=r;continue;case 33:return new Dt.WU(Nt.BANG,r,r+1,a,l,t);case 35:return zt(i,r,a,l,t);case 36:return new Dt.WU(Nt.DOLLAR,r,r+1,a,l,t);case 38:return new Dt.WU(Nt.AMP,r,r+1,a,l,t);case 40:return new Dt.WU(Nt.PAREN_L,r,r+1,a,l,t);case 41:return new Dt.WU(Nt.PAREN_R,r,r+1,a,l,t);case 46:if(46===n.charCodeAt(r+1)&&46===n.charCodeAt(r+2))return new Dt.WU(Nt.SPREAD,r,r+3,a,l,t);break;case 58:return new Dt.WU(Nt.COLON,r,r+1,a,l,t);case 61:return new Dt.WU(Nt.EQUALS,r,r+1,a,l,t);case 64:return new Dt.WU(Nt.AT,r,r+1,a,l,t);case 91:return new Dt.WU(Nt.BRACKET_L,r,r+1,a,l,t);case 93:return new Dt.WU(Nt.BRACKET_R,r,r+1,a,l,t);case 123:return new Dt.WU(Nt.BRACE_L,r,r+1,a,l,t);case 124:return new Dt.WU(Nt.PIPE,r,r+1,a,l,t);case 125:return new Dt.WU(Nt.BRACE_R,r,r+1,a,l,t);case 34:return 34===n.charCodeAt(r+1)&&34===n.charCodeAt(r+2)?qt(i,r,a,l,t,e):Yt(i,r,a,l,t);case 45:case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return Wt(i,r,o,a,l,t);case 65:case 66:case 67:case 68:case 69:case 70:case 71:case 72:case 73:case 74:case 75:case 76:case 77:case 78:case 79:case 80:case 81:case 82:case 83:case 84:case 85:case 86:case 87:case 88:case 89:case 90:case 95:case 97:case 98:case 99:case 100:case 101:case 102:case 103:case 104:case 105:case 106:case 107:case 108:case 109:case 110:case 111:case 112:case 113:case 114:case 115:case 116:case 117:case 118:case 119:case 120:case 121:case 122:return $t(i,r,a,l,t)}throw Ct(i,r,Gt(o))}var c=e.line,d=1+r-e.lineStart;return new Dt.WU(Nt.EOF,s,s,c,d,t)}function Gt(e){return e<32&&9!==e&&10!==e&&13!==e?"Cannot contain the invalid character ".concat(Ht(e),"."):39===e?"Unexpected single quote character ('), did you mean to use a double quote (\")?":"Cannot parse the unexpected character ".concat(Ht(e),".")}function zt(e,t,i,n,s){var r,o=e.body,a=t;do{r=o.charCodeAt(++a)}while(!isNaN(r)&&(r>31||9===r));return new Dt.WU(Nt.COMMENT,t,a,i,n,s,o.slice(t+1,a))}function Wt(e,t,i,n,s,r){var o=e.body,a=i,l=t,c=!1;if(45===a&&(a=o.charCodeAt(++l)),48===a){if((a=o.charCodeAt(++l))>=48&&a<=57)throw Ct(e,l,"Invalid number, unexpected digit after 0: ".concat(Ht(a),"."))}else l=Kt(e,l,a),a=o.charCodeAt(l);if(46===a&&(c=!0,a=o.charCodeAt(++l),l=Kt(e,l,a),a=o.charCodeAt(l)),69!==a&&101!==a||(c=!0,43!==(a=o.charCodeAt(++l))&&45!==a||(a=o.charCodeAt(++l)),l=Kt(e,l,a),a=o.charCodeAt(l)),46===a||function(e){return 95===e||e>=65&&e<=90||e>=97&&e<=122}(a))throw Ct(e,l,"Invalid number, expected digit but got: ".concat(Ht(a),"."));return new Dt.WU(c?Nt.FLOAT:Nt.INT,t,l,n,s,r,o.slice(t,l))}function Kt(e,t,i){var n=e.body,s=t,r=i;if(r>=48&&r<=57){do{r=n.charCodeAt(++s)}while(r>=48&&r<=57);return s}throw Ct(e,s,"Invalid number, expected digit but got: ".concat(Ht(r),"."))}function Yt(e,t,i,n,s){for(var r,o,a,l,c=e.body,d=t+1,h=d,u=0,p="";d<c.length&&!isNaN(u=c.charCodeAt(d))&&10!==u&&13!==u;){if(34===u)return p+=c.slice(h,d),new Dt.WU(Nt.STRING,t,d+1,i,n,s,p);if(u<32&&9!==u)throw Ct(e,d,"Invalid character within String: ".concat(Ht(u),"."));if(++d,92===u){switch(p+=c.slice(h,d-1),u=c.charCodeAt(d)){case 34:p+='"';break;case 47:p+="/";break;case 92:p+="\\";break;case 98:p+="\b";break;case 102:p+="\f";break;case 110:p+="\n";break;case 114:p+="\r";break;case 116:p+="\t";break;case 117:var m=(r=c.charCodeAt(d+1),o=c.charCodeAt(d+2),a=c.charCodeAt(d+3),l=c.charCodeAt(d+4),Zt(r)<<12|Zt(o)<<8|Zt(a)<<4|Zt(l));if(m<0){var f=c.slice(d+1,d+5);throw Ct(e,d,"Invalid character escape sequence: \\u".concat(f,"."))}p+=String.fromCharCode(m),d+=4;break;default:throw Ct(e,d,"Invalid character escape sequence: \\".concat(String.fromCharCode(u),"."))}h=++d}}throw Ct(e,d,"Unterminated string.")}function qt(e,t,i,n,s,r){for(var o=e.body,a=t+3,l=a,c=0,d="";a<o.length&&!isNaN(c=o.charCodeAt(a));){if(34===c&&34===o.charCodeAt(a+1)&&34===o.charCodeAt(a+2))return d+=o.slice(l,a),new Dt.WU(Nt.BLOCK_STRING,t,a+3,i,n,s,(0,Ft.W7)(d));if(c<32&&9!==c&&10!==c&&13!==c)throw Ct(e,a,"Invalid character within String: ".concat(Ht(c),"."));10===c?(++a,++r.line,r.lineStart=a):13===c?(10===o.charCodeAt(a+1)?a+=2:++a,++r.line,r.lineStart=a):92===c&&34===o.charCodeAt(a+1)&&34===o.charCodeAt(a+2)&&34===o.charCodeAt(a+3)?(d+=o.slice(l,a)+'"""',l=a+=4):++a}throw Ct(e,a,"Unterminated string.")}function Zt(e){return e>=48&&e<=57?e-48:e>=65&&e<=70?e-55:e>=97&&e<=102?e-87:-1}function $t(e,t,i,n,s){for(var r=e.body,o=r.length,a=t+1,l=0;a!==o&&!isNaN(l=r.charCodeAt(a))&&(95===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122);)++a;return new Dt.WU(Nt.NAME,t,a,i,n,s,r.slice(t,a))}var Qt=function(){function e(e,t){var i=function(e){return Rt(e,Ut)}(e)?e:new Ut(e);this._lexer=new Vt(i),this._options=t}var t=e.prototype;return t.parseName=function(){var e=this.expectToken(Nt.NAME);return{kind:Pt.NAME,value:e.value,loc:this.loc(e)}},t.parseDocument=function(){var e=this._lexer.token;return{kind:Pt.DOCUMENT,definitions:this.many(Nt.SOF,this.parseDefinition,Nt.EOF),loc:this.loc(e)}},t.parseDefinition=function(){if(this.peek(Nt.NAME))switch(this._lexer.token.value){case"query":case"mutation":case"subscription":return this.parseOperationDefinition();case"fragment":return this.parseFragmentDefinition();case"schema":case"scalar":case"type":case"interface":case"union":case"enum":case"input":case"directive":return this.parseTypeSystemDefinition();case"extend":return this.parseTypeSystemExtension()}else{if(this.peek(Nt.BRACE_L))return this.parseOperationDefinition();if(this.peekDescription())return this.parseTypeSystemDefinition()}throw this.unexpected()},t.parseOperationDefinition=function(){var e=this._lexer.token;if(this.peek(Nt.BRACE_L))return{kind:Pt.OPERATION_DEFINITION,operation:"query",name:void 0,variableDefinitions:[],directives:[],selectionSet:this.parseSelectionSet(),loc:this.loc(e)};var t,i=this.parseOperationType();return this.peek(Nt.NAME)&&(t=this.parseName()),{kind:Pt.OPERATION_DEFINITION,operation:i,name:t,variableDefinitions:this.parseVariableDefinitions(),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseOperationType=function(){var e=this.expectToken(Nt.NAME);switch(e.value){case"query":return"query";case"mutation":return"mutation";case"subscription":return"subscription"}throw this.unexpected(e)},t.parseVariableDefinitions=function(){return this.optionalMany(Nt.PAREN_L,this.parseVariableDefinition,Nt.PAREN_R)},t.parseVariableDefinition=function(){var e=this._lexer.token;return{kind:Pt.VARIABLE_DEFINITION,variable:this.parseVariable(),type:(this.expectToken(Nt.COLON),this.parseTypeReference()),defaultValue:this.expectOptionalToken(Nt.EQUALS)?this.parseValueLiteral(!0):void 0,directives:this.parseDirectives(!0),loc:this.loc(e)}},t.parseVariable=function(){var e=this._lexer.token;return this.expectToken(Nt.DOLLAR),{kind:Pt.VARIABLE,name:this.parseName(),loc:this.loc(e)}},t.parseSelectionSet=function(){var e=this._lexer.token;return{kind:Pt.SELECTION_SET,selections:this.many(Nt.BRACE_L,this.parseSelection,Nt.BRACE_R),loc:this.loc(e)}},t.parseSelection=function(){return this.peek(Nt.SPREAD)?this.parseFragment():this.parseField()},t.parseField=function(){var e,t,i=this._lexer.token,n=this.parseName();return this.expectOptionalToken(Nt.COLON)?(e=n,t=this.parseName()):t=n,{kind:Pt.FIELD,alias:e,name:t,arguments:this.parseArguments(!1),directives:this.parseDirectives(!1),selectionSet:this.peek(Nt.BRACE_L)?this.parseSelectionSet():void 0,loc:this.loc(i)}},t.parseArguments=function(e){var t=e?this.parseConstArgument:this.parseArgument;return this.optionalMany(Nt.PAREN_L,t,Nt.PAREN_R)},t.parseArgument=function(){var e=this._lexer.token,t=this.parseName();return this.expectToken(Nt.COLON),{kind:Pt.ARGUMENT,name:t,value:this.parseValueLiteral(!1),loc:this.loc(e)}},t.parseConstArgument=function(){var e=this._lexer.token;return{kind:Pt.ARGUMENT,name:this.parseName(),value:(this.expectToken(Nt.COLON),this.parseValueLiteral(!0)),loc:this.loc(e)}},t.parseFragment=function(){var e=this._lexer.token;this.expectToken(Nt.SPREAD);var t=this.expectOptionalKeyword("on");return!t&&this.peek(Nt.NAME)?{kind:Pt.FRAGMENT_SPREAD,name:this.parseFragmentName(),directives:this.parseDirectives(!1),loc:this.loc(e)}:{kind:Pt.INLINE_FRAGMENT,typeCondition:t?this.parseNamedType():void 0,directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(e)}},t.parseFragmentDefinition=function(){var e,t=this._lexer.token;return this.expectKeyword("fragment"),!0===(null===(e=this._options)||void 0===e?void 0:e.experimentalFragmentVariables)?{kind:Pt.FRAGMENT_DEFINITION,name:this.parseFragmentName(),variableDefinitions:this.parseVariableDefinitions(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}:{kind:Pt.FRAGMENT_DEFINITION,name:this.parseFragmentName(),typeCondition:(this.expectKeyword("on"),this.parseNamedType()),directives:this.parseDirectives(!1),selectionSet:this.parseSelectionSet(),loc:this.loc(t)}},t.parseFragmentName=function(){if("on"===this._lexer.token.value)throw this.unexpected();return this.parseName()},t.parseValueLiteral=function(e){var t=this._lexer.token;switch(t.kind){case Nt.BRACKET_L:return this.parseList(e);case Nt.BRACE_L:return this.parseObject(e);case Nt.INT:return this._lexer.advance(),{kind:Pt.INT,value:t.value,loc:this.loc(t)};case Nt.FLOAT:return this._lexer.advance(),{kind:Pt.FLOAT,value:t.value,loc:this.loc(t)};case Nt.STRING:case Nt.BLOCK_STRING:return this.parseStringLiteral();case Nt.NAME:switch(this._lexer.advance(),t.value){case"true":return{kind:Pt.BOOLEAN,value:!0,loc:this.loc(t)};case"false":return{kind:Pt.BOOLEAN,value:!1,loc:this.loc(t)};case"null":return{kind:Pt.NULL,loc:this.loc(t)};default:return{kind:Pt.ENUM,value:t.value,loc:this.loc(t)}}case Nt.DOLLAR:if(!e)return this.parseVariable()}throw this.unexpected()},t.parseStringLiteral=function(){var e=this._lexer.token;return this._lexer.advance(),{kind:Pt.STRING,value:e.value,block:e.kind===Nt.BLOCK_STRING,loc:this.loc(e)}},t.parseList=function(e){var t=this,i=this._lexer.token;return{kind:Pt.LIST,values:this.any(Nt.BRACKET_L,(function(){return t.parseValueLiteral(e)}),Nt.BRACKET_R),loc:this.loc(i)}},t.parseObject=function(e){var t=this,i=this._lexer.token;return{kind:Pt.OBJECT,fields:this.any(Nt.BRACE_L,(function(){return t.parseObjectField(e)}),Nt.BRACE_R),loc:this.loc(i)}},t.parseObjectField=function(e){var t=this._lexer.token,i=this.parseName();return this.expectToken(Nt.COLON),{kind:Pt.OBJECT_FIELD,name:i,value:this.parseValueLiteral(e),loc:this.loc(t)}},t.parseDirectives=function(e){for(var t=[];this.peek(Nt.AT);)t.push(this.parseDirective(e));return t},t.parseDirective=function(e){var t=this._lexer.token;return this.expectToken(Nt.AT),{kind:Pt.DIRECTIVE,name:this.parseName(),arguments:this.parseArguments(e),loc:this.loc(t)}},t.parseTypeReference=function(){var e,t=this._lexer.token;return this.expectOptionalToken(Nt.BRACKET_L)?(e=this.parseTypeReference(),this.expectToken(Nt.BRACKET_R),e={kind:Pt.LIST_TYPE,type:e,loc:this.loc(t)}):e=this.parseNamedType(),this.expectOptionalToken(Nt.BANG)?{kind:Pt.NON_NULL_TYPE,type:e,loc:this.loc(t)}:e},t.parseNamedType=function(){var e=this._lexer.token;return{kind:Pt.NAMED_TYPE,name:this.parseName(),loc:this.loc(e)}},t.parseTypeSystemDefinition=function(){var e=this.peekDescription()?this._lexer.lookahead():this._lexer.token;if(e.kind===Nt.NAME)switch(e.value){case"schema":return this.parseSchemaDefinition();case"scalar":return this.parseScalarTypeDefinition();case"type":return this.parseObjectTypeDefinition();case"interface":return this.parseInterfaceTypeDefinition();case"union":return this.parseUnionTypeDefinition();case"enum":return this.parseEnumTypeDefinition();case"input":return this.parseInputObjectTypeDefinition();case"directive":return this.parseDirectiveDefinition()}throw this.unexpected(e)},t.peekDescription=function(){return this.peek(Nt.STRING)||this.peek(Nt.BLOCK_STRING)},t.parseDescription=function(){if(this.peekDescription())return this.parseStringLiteral()},t.parseSchemaDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("schema");var i=this.parseDirectives(!0),n=this.many(Nt.BRACE_L,this.parseOperationTypeDefinition,Nt.BRACE_R);return{kind:Pt.SCHEMA_DEFINITION,description:t,directives:i,operationTypes:n,loc:this.loc(e)}},t.parseOperationTypeDefinition=function(){var e=this._lexer.token,t=this.parseOperationType();this.expectToken(Nt.COLON);var i=this.parseNamedType();return{kind:Pt.OPERATION_TYPE_DEFINITION,operation:t,type:i,loc:this.loc(e)}},t.parseScalarTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("scalar");var i=this.parseName(),n=this.parseDirectives(!0);return{kind:Pt.SCALAR_TYPE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("type");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),r=this.parseFieldsDefinition();return{kind:Pt.OBJECT_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:r,loc:this.loc(e)}},t.parseImplementsInterfaces=function(){var e;if(!this.expectOptionalKeyword("implements"))return[];if(!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLImplementsInterfaces)){var t=[];this.expectOptionalToken(Nt.AMP);do{t.push(this.parseNamedType())}while(this.expectOptionalToken(Nt.AMP)||this.peek(Nt.NAME));return t}return this.delimitedMany(Nt.AMP,this.parseNamedType)},t.parseFieldsDefinition=function(){var e;return!0===(null===(e=this._options)||void 0===e?void 0:e.allowLegacySDLEmptyFields)&&this.peek(Nt.BRACE_L)&&this._lexer.lookahead().kind===Nt.BRACE_R?(this._lexer.advance(),this._lexer.advance(),[]):this.optionalMany(Nt.BRACE_L,this.parseFieldDefinition,Nt.BRACE_R)},t.parseFieldDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseArgumentDefs();this.expectToken(Nt.COLON);var s=this.parseTypeReference(),r=this.parseDirectives(!0);return{kind:Pt.FIELD_DEFINITION,description:t,name:i,arguments:n,type:s,directives:r,loc:this.loc(e)}},t.parseArgumentDefs=function(){return this.optionalMany(Nt.PAREN_L,this.parseInputValueDef,Nt.PAREN_R)},t.parseInputValueDef=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName();this.expectToken(Nt.COLON);var n,s=this.parseTypeReference();this.expectOptionalToken(Nt.EQUALS)&&(n=this.parseValueLiteral(!0));var r=this.parseDirectives(!0);return{kind:Pt.INPUT_VALUE_DEFINITION,description:t,name:i,type:s,defaultValue:n,directives:r,loc:this.loc(e)}},t.parseInterfaceTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("interface");var i=this.parseName(),n=this.parseImplementsInterfaces(),s=this.parseDirectives(!0),r=this.parseFieldsDefinition();return{kind:Pt.INTERFACE_TYPE_DEFINITION,description:t,name:i,interfaces:n,directives:s,fields:r,loc:this.loc(e)}},t.parseUnionTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("union");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseUnionMemberTypes();return{kind:Pt.UNION_TYPE_DEFINITION,description:t,name:i,directives:n,types:s,loc:this.loc(e)}},t.parseUnionMemberTypes=function(){return this.expectOptionalToken(Nt.EQUALS)?this.delimitedMany(Nt.PIPE,this.parseNamedType):[]},t.parseEnumTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("enum");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseEnumValuesDefinition();return{kind:Pt.ENUM_TYPE_DEFINITION,description:t,name:i,directives:n,values:s,loc:this.loc(e)}},t.parseEnumValuesDefinition=function(){return this.optionalMany(Nt.BRACE_L,this.parseEnumValueDefinition,Nt.BRACE_R)},t.parseEnumValueDefinition=function(){var e=this._lexer.token,t=this.parseDescription(),i=this.parseName(),n=this.parseDirectives(!0);return{kind:Pt.ENUM_VALUE_DEFINITION,description:t,name:i,directives:n,loc:this.loc(e)}},t.parseInputObjectTypeDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("input");var i=this.parseName(),n=this.parseDirectives(!0),s=this.parseInputFieldsDefinition();return{kind:Pt.INPUT_OBJECT_TYPE_DEFINITION,description:t,name:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInputFieldsDefinition=function(){return this.optionalMany(Nt.BRACE_L,this.parseInputValueDef,Nt.BRACE_R)},t.parseTypeSystemExtension=function(){var e=this._lexer.lookahead();if(e.kind===Nt.NAME)switch(e.value){case"schema":return this.parseSchemaExtension();case"scalar":return this.parseScalarTypeExtension();case"type":return this.parseObjectTypeExtension();case"interface":return this.parseInterfaceTypeExtension();case"union":return this.parseUnionTypeExtension();case"enum":return this.parseEnumTypeExtension();case"input":return this.parseInputObjectTypeExtension()}throw this.unexpected(e)},t.parseSchemaExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("schema");var t=this.parseDirectives(!0),i=this.optionalMany(Nt.BRACE_L,this.parseOperationTypeDefinition,Nt.BRACE_R);if(0===t.length&&0===i.length)throw this.unexpected();return{kind:Pt.SCHEMA_EXTENSION,directives:t,operationTypes:i,loc:this.loc(e)}},t.parseScalarTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("scalar");var t=this.parseName(),i=this.parseDirectives(!0);if(0===i.length)throw this.unexpected();return{kind:Pt.SCALAR_TYPE_EXTENSION,name:t,directives:i,loc:this.loc(e)}},t.parseObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("type");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:Pt.OBJECT_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseInterfaceTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("interface");var t=this.parseName(),i=this.parseImplementsInterfaces(),n=this.parseDirectives(!0),s=this.parseFieldsDefinition();if(0===i.length&&0===n.length&&0===s.length)throw this.unexpected();return{kind:Pt.INTERFACE_TYPE_EXTENSION,name:t,interfaces:i,directives:n,fields:s,loc:this.loc(e)}},t.parseUnionTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("union");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseUnionMemberTypes();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:Pt.UNION_TYPE_EXTENSION,name:t,directives:i,types:n,loc:this.loc(e)}},t.parseEnumTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("enum");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseEnumValuesDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:Pt.ENUM_TYPE_EXTENSION,name:t,directives:i,values:n,loc:this.loc(e)}},t.parseInputObjectTypeExtension=function(){var e=this._lexer.token;this.expectKeyword("extend"),this.expectKeyword("input");var t=this.parseName(),i=this.parseDirectives(!0),n=this.parseInputFieldsDefinition();if(0===i.length&&0===n.length)throw this.unexpected();return{kind:Pt.INPUT_OBJECT_TYPE_EXTENSION,name:t,directives:i,fields:n,loc:this.loc(e)}},t.parseDirectiveDefinition=function(){var e=this._lexer.token,t=this.parseDescription();this.expectKeyword("directive"),this.expectToken(Nt.AT);var i=this.parseName(),n=this.parseArgumentDefs(),s=this.expectOptionalKeyword("repeatable");this.expectKeyword("on");var r=this.parseDirectiveLocations();return{kind:Pt.DIRECTIVE_DEFINITION,description:t,name:i,arguments:n,repeatable:s,locations:r,loc:this.loc(e)}},t.parseDirectiveLocations=function(){return this.delimitedMany(Nt.PIPE,this.parseDirectiveLocation)},t.parseDirectiveLocation=function(){var e=this._lexer.token,t=this.parseName();if(void 0!==Bt[t.value])return t;throw this.unexpected(e)},t.loc=function(e){var t;if(!0!==(null===(t=this._options)||void 0===t?void 0:t.noLocation))return new Dt.Ye(e,this._lexer.lastToken,this._lexer.source)},t.peek=function(e){return this._lexer.token.kind===e},t.expectToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t;throw Ct(this._lexer.source,t.start,"Expected ".concat(Jt(e),", found ").concat(Xt(t),"."))},t.expectOptionalToken=function(e){var t=this._lexer.token;if(t.kind===e)return this._lexer.advance(),t},t.expectKeyword=function(e){var t=this._lexer.token;if(t.kind!==Nt.NAME||t.value!==e)throw Ct(this._lexer.source,t.start,'Expected "'.concat(e,'", found ').concat(Xt(t),"."));this._lexer.advance()},t.expectOptionalKeyword=function(e){var t=this._lexer.token;return t.kind===Nt.NAME&&t.value===e&&(this._lexer.advance(),!0)},t.unexpected=function(e){var t=null!=e?e:this._lexer.token;return Ct(this._lexer.source,t.start,"Unexpected ".concat(Xt(t),"."))},t.any=function(e,t,i){this.expectToken(e);for(var n=[];!this.expectOptionalToken(i);)n.push(t.call(this));return n},t.optionalMany=function(e,t,i){if(this.expectOptionalToken(e)){var n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(i));return n}return[]},t.many=function(e,t,i){this.expectToken(e);var n=[];do{n.push(t.call(this))}while(!this.expectOptionalToken(i));return n},t.delimitedMany=function(e,t){this.expectOptionalToken(e);var i=[];do{i.push(t.call(this))}while(this.expectOptionalToken(e));return i},e}();function Xt(e){var t=e.value;return Jt(e.kind)+(null!=t?' "'.concat(t,'"'):"")}function Jt(e){return function(e){return e===Nt.BANG||e===Nt.DOLLAR||e===Nt.AMP||e===Nt.PAREN_L||e===Nt.PAREN_R||e===Nt.SPREAD||e===Nt.COLON||e===Nt.EQUALS||e===Nt.AT||e===Nt.BRACKET_L||e===Nt.BRACKET_R||e===Nt.BRACE_L||e===Nt.PIPE||e===Nt.BRACE_R}(e)?'"'.concat(e,'"'):e}var ei=new Map,ti=new Map,ii=!0,ni=!1;function si(e){return e.replace(/[\s,]+/g," ").trim()}function ri(e){var t=new Set,i=[];return e.definitions.forEach((function(e){if("FragmentDefinition"===e.kind){var n=e.name.value,s=si((o=e.loc).source.body.substring(o.start,o.end)),r=ti.get(n);r&&!r.has(s)?ii&&console.warn("Warning: fragment with name "+n+" already exists.\ngraphql-tag enforces all fragment names across your application to be unique; read more about\nthis in the docs: http://dev.apollodata.com/core/fragments.html#unique-names"):r||ti.set(n,r=new Set),r.add(s),t.has(s)||(t.add(s),i.push(e))}else i.push(e);var o})),(0,n.pi)((0,n.pi)({},e),{definitions:i})}function oi(e){var t=si(e);if(!ei.has(t)){var i=function(e,t){return new Qt(e,t).parseDocument()}(e,{experimentalFragmentVariables:ni});if(!i||"Document"!==i.kind)throw new Error("Not a valid GraphQL document.");ei.set(t,function(e){var t=new Set(e.definitions);t.forEach((function(e){e.loc&&delete e.loc,Object.keys(e).forEach((function(i){var n=e[i];n&&"object"==typeof n&&t.add(n)}))}));var i=e.loc;return i&&(delete i.startToken,delete i.endToken),e}(ri(i)))}return ei.get(t)}function ai(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];"string"==typeof e&&(e=[e]);var n=e[0];return t.forEach((function(t,i){t&&"Document"===t.kind?n+=t.loc.source.body:n+=t,n+=e[i+1]})),oi(n)}const li=Object.assign(ai,{gql:ai,default:ai,resetCaches:function(){ei.clear(),ti.clear()},disableFragmentWarnings:function(){ii=!1},enableExperimentalFragmentVariables:function(){ni=!0},disableExperimentalFragmentVariables:function(){ni=!1}});(0,s.U6)("log");li.resetCaches,li.disableFragmentWarnings,li.enableExperimentalFragmentVariables,li.disableExperimentalFragmentVariables},72191:()=>{},97222:(e,t,i)=>{"use strict";i.d(t,{i:()=>d});var n=i(70655),s=i(92924),r=i(80496),o=i(84913);function a(e,t){return t?t(e):r.y$.of()}function l(e){return"function"==typeof e?new d(e):e}function c(e){return e.request.length<=1}!function(e){function t(t,i){var n=e.call(this,t)||this;return n.link=i,n}(0,n.ZT)(t,e)}(Error);var d=function(){function e(e){e&&(this.request=e)}return e.empty=function(){return new e((function(){return r.y$.of()}))},e.from=function(t){return 0===t.length?e.empty():t.map(l).reduce((function(e,t){return e.concat(t)}))},e.split=function(t,i,n){var s=l(i),o=l(n||new e(a));return c(s)&&c(o)?new e((function(e){return t(e)?s.request(e)||r.y$.of():o.request(e)||r.y$.of()})):new e((function(e,i){return t(e)?s.request(e,i)||r.y$.of():o.request(e,i)||r.y$.of()}))},e.execute=function(e,t){return e.request((0,o.zi)(t.context,(0,o.DQ)((0,o.Ak)(t))))||r.y$.of()},e.concat=function(t,i){var n=l(t);if(c(n))return n;var s=l(i);return c(s)?new e((function(e){return n.request(e,(function(e){return s.request(e)||r.y$.of()}))||r.y$.of()})):new e((function(e,t){return n.request(e,(function(e){return s.request(e,t)||r.y$.of()}))||r.y$.of()}))},e.prototype.split=function(t,i,n){return this.concat(e.split(t,i,n||new e(a)))},e.prototype.concat=function(t){return e.concat(this,t)},e.prototype.request=function(e,t){throw new s.ej(21)},e.prototype.onError=function(e,t){if(t&&t.error)return t.error(e),!1;throw e},e.prototype.setOnError=function(e){return this.onError=e,this},e}()},24957:(e,t,i)=>{"use strict";i(97222).i.concat},67325:(e,t,i)=>{"use strict";i(97222).i.empty},2550:(e,t,i)=>{"use strict";i.d(t,{h:()=>n});var n=i(97222).i.execute},34674:(e,t,i)=>{"use strict";i(97222).i.from},81707:(e,t,i)=>{"use strict";i.d(t,{ht:()=>n.h,i0:()=>s.i});i(67325),i(34674),i(64738),i(24957);var n=i(2550),s=i(97222),r=i(79875);i.o(r,"createHttpLink")&&i.d(t,{createHttpLink:function(){return r.createHttpLink}})},64738:(e,t,i)=>{"use strict";i(97222).i.split},79875:()=>{},84913:(e,t,i)=>{"use strict";i.d(t,{zi:()=>c,Qc:()=>s,PW:()=>o,DQ:()=>d,Ak:()=>a});var n=i(80496);function s(e){return new n.y$((function(t){t.error(e)}))}var r=i(92924);var o=function(e,t,i){var n=new Error(i);throw n.name="ServerError",n.response=e,n.statusCode=e.status,n.result=t,n};function a(e){for(var t=["query","operationName","variables","extensions","context"],i=0,n=Object.keys(e);i<n.length;i++){var s=n[i];if(t.indexOf(s)<0)throw new r.ej(26)}return e}var l=i(70655);function c(e,t){var i=(0,l.pi)({},e);return Object.defineProperty(t,"setContext",{enumerable:!1,value:function(e){i="function"==typeof e?(0,l.pi)((0,l.pi)({},i),e(i)):(0,l.pi)((0,l.pi)({},i),e)}}),Object.defineProperty(t,"getContext",{enumerable:!1,value:function(){return(0,l.pi)({},i)}}),t}function d(e){var t={variables:e.variables||{},extensions:e.extensions||{},operationName:e.operationName,query:e.query};return t.operationName||(t.operationName="string"!=typeof t.query?(0,n.rY)(t.query)||void 0:""),t}},80496:(e,t,i)=>{"use strict";i.d(t,{X_:()=>oe,w0:()=>Z,y$:()=>Q(),Gw:()=>B,NC:()=>S,sz:()=>ne,aL:()=>j,mr:()=>ce,Xh:()=>J,oA:()=>de,F:()=>d,Dy:()=>se,O4:()=>D,kU:()=>A,hi:()=>h,Yk:()=>c,p$:()=>P,$H:()=>M,rY:()=>O,iW:()=>C,PT:()=>b,qw:()=>T,d2:()=>le,mj:()=>a,FS:()=>o,My:()=>w,Ao:()=>x,Of:()=>ae,hh:()=>f,pM:()=>ie,kQ:()=>m,Jv:()=>te,Ee:()=>W,bw:()=>K,ob:()=>G,Fo:()=>V,u2:()=>E,LZ:()=>r,vf:()=>v});var n=i(27636),s=i(92924);function r(e,t){var i=e.directives;return!i||!i.length||function(e){var t=[];e&&e.length&&e.forEach((function(e){if(function(e){var t=e.name.value;return"skip"===t||"include"===t}(e)){var i=e.arguments;e.name.value;(0,s.kG)(i&&1===i.length,39);var n=i[0];(0,s.kG)(n.name&&"if"===n.name.value,40);var r=n.value;(0,s.kG)(r&&("Variable"===r.kind||"BooleanValue"===r.kind),41),t.push({directive:e,ifArgument:n})}}));return t}(i).every((function(e){var i=e.directive,n=e.ifArgument,r=!1;return"Variable"===n.value.kind?(r=t&&t[n.value.name.value],(0,s.kG)(void 0!==r,38)):r=n.value.value,"skip"===i.name.value?!r:r}))}function o(e,t){return function(e){var t=[];return(0,n.Vn)(e,{Directive:function(e){t.push(e.name.value)}}),t}(t).some((function(t){return e.indexOf(t)>-1}))}function a(e){return e&&o(["client"],e)&&o(["export"],e)}var l=i(70655);function c(e,t){var i=t,n=[];return e.definitions.forEach((function(e){if("OperationDefinition"===e.kind)throw new s.ej(42);"FragmentDefinition"===e.kind&&n.push(e)})),void 0===i&&((0,s.kG)(1===n.length,43),i=n[0].name.value),(0,l.pi)((0,l.pi)({},e),{definitions:(0,l.pr)([{kind:"OperationDefinition",operation:"query",selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:i}}]}}],e.definitions)})}function d(e){void 0===e&&(e=[]);var t={};return e.forEach((function(e){t[e.name.value]=e})),t}function h(e,t){switch(e.kind){case"InlineFragment":return e;case"FragmentSpread":var i=t&&t[e.name.value];return(0,s.kG)(i,44),i;default:return null}}var u=i(35035),p=i.n(u);function m(e){return{__ref:String(e)}}function f(e){return Boolean(e&&"object"==typeof e&&"string"==typeof e.__ref)}function g(e,t,i,n){if(function(e){return"IntValue"===e.kind}(i)||function(e){return"FloatValue"===e.kind}(i))e[t.value]=Number(i.value);else if(function(e){return"BooleanValue"===e.kind}(i)||function(e){return"StringValue"===e.kind}(i))e[t.value]=i.value;else if(function(e){return"ObjectValue"===e.kind}(i)){var r={};i.fields.map((function(e){return g(r,e.name,e.value,n)})),e[t.value]=r}else if(function(e){return"Variable"===e.kind}(i)){var o=(n||{})[i.name.value];e[t.value]=o}else if(function(e){return"ListValue"===e.kind}(i))e[t.value]=i.values.map((function(e){var i={};return g(i,t,e,n),i[t.value]}));else if(function(e){return"EnumValue"===e.kind}(i))e[t.value]=i.value;else{if(!function(e){return"NullValue"===e.kind}(i))throw new s.ej(53);e[t.value]=null}}function v(e,t){var i=null;e.directives&&(i={},e.directives.forEach((function(e){i[e.name.value]={},e.arguments&&e.arguments.forEach((function(n){var s=n.name,r=n.value;return g(i[e.name.value],s,r,t)}))})));var n=null;return e.arguments&&e.arguments.length&&(n={},e.arguments.forEach((function(e){var i=e.name,s=e.value;return g(n,i,s,t)}))),b(e.name.value,n,i)}var y=["connection","include","skip","client","rest","export"];function b(e,t,i){if(t&&i&&i.connection&&i.connection.key){if(i.connection.filter&&i.connection.filter.length>0){var n=i.connection.filter?i.connection.filter:[];n.sort();var s={};return n.forEach((function(e){s[e]=t[e]})),i.connection.key+"("+JSON.stringify(s)+")"}return i.connection.key}var r=e;if(t){var o=p()(t);r+="("+o+")"}return i&&Object.keys(i).forEach((function(e){-1===y.indexOf(e)&&(i[e]&&Object.keys(i[e]).length?r+="@"+e+"("+JSON.stringify(i[e])+")":r+="@"+e)})),r}function S(e,t){if(e.arguments&&e.arguments.length){var i={};return e.arguments.forEach((function(e){var n=e.name,s=e.value;return g(i,n,s,t)})),i}return null}function E(e){return e.alias?e.alias.value:e.name.value}function T(e,t,i){if("string"==typeof e.__typename)return e.__typename;for(var n=0,s=t.selections;n<s.length;n++){var r=s[n];if(w(r)){if("__typename"===r.name.value)return e[E(r)]}else{var o=T(e,h(r,i).selectionSet,i);if("string"==typeof o)return o}}}function w(e){return"Field"===e.kind}function x(e){return"InlineFragment"===e.kind}function _(e){(0,s.kG)(e&&"Document"===e.kind,45);var t=e.definitions.filter((function(e){return"FragmentDefinition"!==e.kind})).map((function(e){if("OperationDefinition"!==e.kind)throw new s.ej(46);return e}));return(0,s.kG)(t.length<=1,47),e}function M(e){return _(e),e.definitions.filter((function(e){return"OperationDefinition"===e.kind}))[0]}function O(e){return e.definitions.filter((function(e){return"OperationDefinition"===e.kind&&e.name})).map((function(e){return e.name.value}))[0]||null}function A(e){return e.definitions.filter((function(e){return"FragmentDefinition"===e.kind}))}function C(e){var t=M(e);return(0,s.kG)(t&&"query"===t.operation,48),t}function P(e){var t;_(e);for(var i=0,n=e.definitions;i<n.length;i++){var r=n[i];if("OperationDefinition"===r.kind){var o=r.operation;if("query"===o||"mutation"===o||"subscription"===o)return r}"FragmentDefinition"!==r.kind||t||(t=r)}if(t)return t;throw new s.ej(52)}function D(e){var t=Object.create(null),i=e&&e.variableDefinitions;return i&&i.length&&i.forEach((function(e){e.defaultValue&&g(t,e.variable.name,e.defaultValue)})),t}function N(e,t,i){var n=0;return e.forEach((function(i,s){t.call(this,i,s,e)&&(e[n++]=i)}),i),e.length=n,e}var I={kind:"Field",name:{kind:"Name",value:"__typename"}};function L(e,t){return e.selectionSet.selections.every((function(e){return"FragmentSpread"===e.kind&&L(t[e.name.value],t)}))}function R(e){return L(M(e)||function(e){(0,s.kG)("Document"===e.kind,49),(0,s.kG)(e.definitions.length<=1,50);var t=e.definitions[0];return(0,s.kG)("FragmentDefinition"===t.kind,51),t}(e),d(A(e)))?null:e}function k(e){return function(t){return e.some((function(e){return e.name&&e.name===t.name.value||e.test&&e.test(t)}))}}function U(e,t){var i=Object.create(null),s=[],r=Object.create(null),o=[],a=R((0,n.Vn)(t,{Variable:{enter:function(e,t,n){"VariableDefinition"!==n.kind&&(i[e.name.value]=!0)}},Field:{enter:function(t){if(e&&t.directives&&(e.some((function(e){return e.remove}))&&t.directives&&t.directives.some(k(e))))return t.arguments&&t.arguments.forEach((function(e){"Variable"===e.value.kind&&s.push({name:e.value.name.value})})),t.selectionSet&&H(t.selectionSet).forEach((function(e){o.push({name:e.name.value})})),null}},FragmentSpread:{enter:function(e){r[e.name.value]=!0}},Directive:{enter:function(t){if(k(e)(t))return null}}}));return a&&N(s,(function(e){return!!e.name&&!i[e.name]})).length&&(a=function(e,t){var i=function(e){return function(t){return e.some((function(e){return t.value&&"Variable"===t.value.kind&&t.value.name&&(e.name===t.value.name.value||e.test&&e.test(t))}))}}(e);return R((0,n.Vn)(t,{OperationDefinition:{enter:function(t){return(0,l.pi)((0,l.pi)({},t),{variableDefinitions:t.variableDefinitions?t.variableDefinitions.filter((function(t){return!e.some((function(e){return e.name===t.variable.name.value}))})):[]})}},Field:{enter:function(t){if(e.some((function(e){return e.remove}))){var n=0;if(t.arguments&&t.arguments.forEach((function(e){i(e)&&(n+=1)})),1===n)return null}}},Argument:{enter:function(e){if(i(e))return null}}}))}(s,a)),a&&N(o,(function(e){return!!e.name&&!r[e.name]})).length&&(a=function(e,t){function i(t){if(e.some((function(e){return e.name===t.name.value})))return null}return R((0,n.Vn)(t,{FragmentSpread:{enter:i},FragmentDefinition:{enter:i}}))}(o,a)),a}function B(e){return(0,n.Vn)(_(e),{SelectionSet:{enter:function(e,t,i){if(!i||"OperationDefinition"!==i.kind){var n=e.selections;if(n)if(!n.some((function(e){return w(e)&&("__typename"===e.name.value||0===e.name.value.lastIndexOf("__",0))}))){var s=i;if(!(w(s)&&s.directives&&s.directives.some((function(e){return"export"===e.name.value}))))return(0,l.pi)((0,l.pi)({},e),{selections:(0,l.pr)(n,[I])})}}}}})}B.added=function(e){return e===I};var F={test:function(e){var t="connection"===e.name.value;return t&&(!e.arguments||e.arguments.some((function(e){return"key"===e.name.value}))),t}};function V(e){return U([F],_(e))}function H(e){var t=[];return e.selections.forEach((function(e){(w(e)||x(e))&&e.selectionSet?H(e.selectionSet).forEach((function(e){return t.push(e)})):"FragmentSpread"===e.kind&&t.push(e)})),t}function j(e){return"query"===P(e).operation?e:(0,n.Vn)(e,{OperationDefinition:{enter:function(e){return(0,l.pi)((0,l.pi)({},e),{operation:"query"})}}})}function G(e){_(e);var t=U([{test:function(e){return"client"===e.name.value},remove:!0}],e);return t&&(t=(0,n.Vn)(t,{FragmentDefinition:{enter:function(e){if(e.selectionSet&&e.selectionSet.selections.every((function(e){return w(e)&&"__typename"===e.name.value})))return null}}})),t}var z=Object.prototype.hasOwnProperty;function W(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return K(e)}function K(e){var t=e[0]||{},i=e.length;if(i>1)for(var n=new Z,s=1;s<i;++s)t=n.merge(t,e[s]);return t}function Y(e){return null!==e&&"object"==typeof e}var q=function(e,t,i){return this.merge(e[i],t[i])},Z=function(){function e(e){void 0===e&&(e=q),this.reconciler=e,this.isObject=Y,this.pastCopies=new Set}return e.prototype.merge=function(e,t){for(var i=this,n=[],s=2;s<arguments.length;s++)n[s-2]=arguments[s];return Y(t)&&Y(e)?(Object.keys(t).forEach((function(s){if(z.call(e,s)){var r=e[s];if(t[s]!==r){var o=i.reconciler.apply(i,(0,l.pr)([e,t,s],n));o!==r&&((e=i.shallowCopyForMerge(e))[s]=o)}}else(e=i.shallowCopyForMerge(e))[s]=t[s]})),e):t},e.prototype.shallowCopyForMerge=function(e){return Y(e)&&!this.pastCopies.has(e)&&(e=Array.isArray(e)?e.slice(0):(0,l.pi)({__proto__:Object.getPrototypeOf(e)},e),this.pastCopies.add(e)),e},e}();var $=i(49329),Q=i.n($);i(67121);Q().prototype["@@observable"]=function(){return this};var X=Object.prototype.toString;function J(e){return ee(e)}function ee(e,t){switch(X.call(e)){case"[object Array]":if((t=t||new Map).has(e))return t.get(e);var i=e.slice(0);return t.set(e,i),i.forEach((function(e,n){i[n]=ee(e,t)})),i;case"[object Object]":if((t=t||new Map).has(e))return t.get(e);var n=Object.create(Object.getPrototypeOf(e));return t.set(e,n),Object.keys(e).forEach((function(i){n[i]=ee(e[i],t)})),n;default:return e}}function te(e){return e}function ie(e,t,i){var n=[];e.forEach((function(e){return e[t]&&n.push(e)})),n.forEach((function(e){return e[t](i)}))}function ne(e,t,i){return new(Q())((function(n){var s=n.next,r=n.error,o=n.complete,a=0,l=!1;function c(e,t){return e?function(t){++a,new Promise((function(i){return i(e(t))})).then((function(e){--a,s&&s.call(n,e),l&&d.complete()}),(function(e){--a,r&&r.call(n,e)}))}:function(e){return t&&t.call(n,e)}}var d={next:c(t,s),error:c(i,r),complete:function(){l=!0,a||o&&o.call(n)}},h=e.subscribe(d);return function(){return h.unsubscribe()}}))}function se(e){function t(t){Object.defineProperty(e,t,{value:Q()})}return"function"==typeof Symbol&&Symbol.species&&t(Symbol.species),t("@@species"),e}function re(e){return e&&"function"==typeof e.then}var oe=function(e){function t(t){var i=e.call(this,(function(e){return i.addObserver(e),function(){return i.removeObserver(e)}}))||this;return i.observers=new Set,i.addCount=0,i.promise=new Promise((function(e,t){i.resolve=e,i.reject=t})),i.handlers={next:function(e){null!==i.sub&&(i.latest=["next",e],ie(i.observers,"next",e))},error:function(e){var t=i.sub;null!==t&&(t&&Promise.resolve().then((function(){return t.unsubscribe()})),i.sub=null,i.latest=["error",e],i.reject(e),ie(i.observers,"error",e))},complete:function(){if(null!==i.sub){var e=i.sources.shift();e?re(e)?e.then((function(e){return i.sub=e.subscribe(i.handlers)})):i.sub=e.subscribe(i.handlers):(i.sub=null,i.latest&&"next"===i.latest[0]?i.resolve(i.latest[1]):i.resolve(),ie(i.observers,"complete"))}}},i.cancel=function(e){i.reject(e),i.sources=[],i.handlers.complete()},i.promise.catch((function(e){})),"function"==typeof t&&(t=[new(Q())(t)]),re(t)?t.then((function(e){return i.start(e)}),i.handlers.error):i.start(t),i}return(0,l.ZT)(t,e),t.prototype.start=function(e){void 0===this.sub&&(this.sources=Array.from(e),this.handlers.complete())},t.prototype.deliverLastMessage=function(e){if(this.latest){var t=this.latest[0],i=e[t];i&&i.call(e,this.latest[1]),null===this.sub&&"next"===t&&e.complete&&e.complete()}},t.prototype.addObserver=function(e){this.observers.has(e)||(this.deliverLastMessage(e),this.observers.add(e),++this.addCount)},t.prototype.removeObserver=function(e,t){this.observers.delete(e)&&--this.addCount<1&&!t&&this.handlers.error(new Error("Observable cancelled prematurely"))},t.prototype.cleanup=function(e){var t=this,i=!1,n=function(){i||(i=!0,t.observers.delete(s),e())},s={next:n,error:n,complete:n},r=this.addCount;this.addObserver(s),this.addCount=r},t}(Q());function ae(e){return Array.isArray(e)&&e.length>0}function le(e){return e.errors&&e.errors.length>0||!1}se(oe);var ce="function"==typeof WeakMap&&!("object"==typeof navigator&&"ReactNative"===navigator.product);function de(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var i=Object.create(null);return e.forEach((function(e){e&&Object.keys(e).forEach((function(t){var n=e[t];void 0!==n&&(i[t]=n)}))})),i}},85925:(e,t,i)=>{"use strict";i(84449)},21924:(e,t,i)=>{"use strict";var n=i(10492),s=i(55559),r=s(n("String.prototype.indexOf"));e.exports=function(e,t){var i=n(e,!!t);return"function"==typeof i&&r(e,".prototype.")>-1?s(i):i}},55559:(e,t,i)=>{"use strict";var n=i(58612),s=i(10492),r=s("%Function.prototype.apply%"),o=s("%Function.prototype.call%"),a=s("%Reflect.apply%",!0)||n.call(o,r),l=s("%Object.getOwnPropertyDescriptor%",!0),c=s("%Object.defineProperty%",!0),d=s("%Math.max%");if(c)try{c({},"a",{value:1})}catch(e){c=null}e.exports=function(e){var t=a(n,o,arguments);if(l&&c){var i=l(t,"length");i.configurable&&c(t,"length",{value:1+d(0,e.length-(arguments.length-1))})}return t};var h=function(){return a(n,r,arguments)};c?c(e.exports,"apply",{value:h}):e.exports.apply=h},10492:(e,t,i)=>{"use strict";var n,s=SyntaxError,r=Function,o=TypeError,a=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},d=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=i(41405)(),u=Object.getPrototypeOf||function(e){return e.__proto__},p=a("async function* () {}"),m=p?p.prototype:n,f=m?m.prototype:n,g="undefined"==typeof Uint8Array?n:u(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":h?u([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":a("async function () {}"),"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":f?u(f):n,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":a("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?u(u([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?u((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?u((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?u(""[Symbol.iterator]()):n,"%Symbol%":h?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":d,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i(58612),S=i(17642),E=b.call(Function.call,Array.prototype.concat),T=b.call(Function.apply,Array.prototype.splice),w=b.call(Function.call,String.prototype.replace),x=b.call(Function.call,String.prototype.slice),_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,M=/\\(\\)?/g,O=function(e){var t=x(e,0,1),i=x(e,-1);if("%"===t&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return w(e,_,(function(e,t,i,s){n[n.length]=i?w(s,M,"$1"):t||e})),n},A=function(e,t){var i,n=e;if(S(y,n)&&(n="%"+(i=y[n])[0]+"%"),S(v,n)){var r=v[n];if(void 0===r&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var i=O(e),n=i.length>0?i[0]:"",r=A("%"+n+"%",t),a=r.name,c=r.value,d=!1,h=r.alias;h&&(n=h[0],T(i,E([0,1],h)));for(var u=1,p=!0;u<i.length;u+=1){var m=i[u],f=x(m,0,1),g=x(m,-1);if(('"'===f||"'"===f||"`"===f||'"'===g||"'"===g||"`"===g)&&f!==g)throw new s("property names with quotes must have matching quotes");if("constructor"!==m&&p||(d=!0),S(v,a="%"+(n+="."+m)+"%"))c=v[a];else if(null!=c){if(!(m in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=i.length){var y=l(c,m);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=S(c,m),c=c[m];p&&!d&&(v[a]=c)}}return c}},94184:(e,t)=>{var i;!function(){"use strict";var n={}.hasOwnProperty;function s(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var r=typeof i;if("string"===r||"number"===r)e.push(i);else if(Array.isArray(i)){if(i.length){var o=s.apply(null,i);o&&e.push(o)}}else if("object"===r)if(i.toString===Object.prototype.toString)for(var a in i)n.call(i,a)&&i[a]&&e.push(a);else e.push(i.toString())}}return e.join(" ")}e.exports?(s.default=s,e.exports=s):void 0===(i=function(){return s}.apply(t,[]))||(e.exports=i)}()},5220:(e,t,i)=>{var n=i(8492);e.exports=n},1939:(e,t,i)=>{var n=i(5220);e.exports=n},19662:(e,t,i)=>{var n=i(17854),s=i(60614),r=i(66330),o=n.TypeError;e.exports=function(e){if(s(e))return e;throw o(r(e)+" is not a function")}},96077:(e,t,i)=>{var n=i(17854),s=i(60614),r=n.String,o=n.TypeError;e.exports=function(e){if("object"==typeof e||s(e))return e;throw o("Can't set "+r(e)+" as a prototype")}},51223:(e,t,i)=>{var n=i(5112),s=i(70030),r=i(3070),o=n("unscopables"),a=Array.prototype;null==a[o]&&r.f(a,o,{configurable:!0,value:s(null)}),e.exports=function(e){a[o][e]=!0}},25787:(e,t,i)=>{var n=i(17854),s=i(47976),r=n.TypeError;e.exports=function(e,t){if(s(t,e))return e;throw r("Incorrect invocation")}},19670:(e,t,i)=>{var n=i(17854),s=i(70111),r=n.String,o=n.TypeError;e.exports=function(e){if(s(e))return e;throw o(r(e)+" is not an object")}},41318:(e,t,i)=>{var n=i(45656),s=i(51400),r=i(26244),o=function(e){return function(t,i,o){var a,l=n(t),c=r(l),d=s(o,c);if(e&&i!=i){for(;c>d;)if((a=l[d++])!=a)return!0}else for(;c>d;d++)if((e||d in l)&&l[d]===i)return e||d||0;return!e&&-1}};e.exports={includes:o(!0),indexOf:o(!1)}},41589:(e,t,i)=>{var n=i(17854),s=i(51400),r=i(26244),o=i(86135),a=n.Array,l=Math.max;e.exports=function(e,t,i){for(var n=r(e),c=s(t,n),d=s(void 0===i?n:i,n),h=a(l(d-c,0)),u=0;c<d;c++,u++)o(h,u,e[c]);return h.length=u,h}},94362:(e,t,i)=>{var n=i(41589),s=Math.floor,r=function(e,t){var i=e.length,l=s(i/2);return i<8?o(e,t):a(e,r(n(e,0,l),t),r(n(e,l),t),t)},o=function(e,t){for(var i,n,s=e.length,r=1;r<s;){for(n=r,i=e[r];n&&t(e[n-1],i)>0;)e[n]=e[--n];n!==r++&&(e[n]=i)}return e},a=function(e,t,i,n){for(var s=t.length,r=i.length,o=0,a=0;o<s||a<r;)e[o+a]=o<s&&a<r?n(t[o],i[a])<=0?t[o++]:i[a++]:o<s?t[o++]:i[a++];return e};e.exports=r},84326:(e,t,i)=>{var n=i(1702),s=n({}.toString),r=n("".slice);e.exports=function(e){return r(s(e),8,-1)}},70648:(e,t,i)=>{var n=i(17854),s=i(51694),r=i(60614),o=i(84326),a=i(5112)("toStringTag"),l=n.Object,c="Arguments"==o(function(){return arguments}());e.exports=s?o:function(e){var t,i,n;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(i=function(e,t){try{return e[t]}catch(e){}}(t=l(e),a))?i:c?o(t):"Object"==(n=o(t))&&r(t.callee)?"Arguments":n}},99920:(e,t,i)=>{var n=i(92597),s=i(53887),r=i(31236),o=i(3070);e.exports=function(e,t,i){for(var a=s(t),l=o.f,c=r.f,d=0;d<a.length;d++){var h=a[d];n(e,h)||i&&n(i,h)||l(e,h,c(t,h))}}},49920:(e,t,i)=>{var n=i(47293);e.exports=!n((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}))},24994:(e,t,i)=>{"use strict";var n=i(13383).IteratorPrototype,s=i(70030),r=i(79114),o=i(58003),a=i(97497),l=function(){return this};e.exports=function(e,t,i,c){var d=t+" Iterator";return e.prototype=s(n,{next:r(+!c,i)}),o(e,d,!1,!0),a[d]=l,e}},68880:(e,t,i)=>{var n=i(19781),s=i(3070),r=i(79114);e.exports=n?function(e,t,i){return s.f(e,t,r(1,i))}:function(e,t,i){return e[t]=i,e}},79114:e=>{e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},86135:(e,t,i)=>{"use strict";var n=i(34948),s=i(3070),r=i(79114);e.exports=function(e,t,i){var o=n(t);o in e?s.f(e,o,r(0,i)):e[o]=i}},70654:(e,t,i)=>{"use strict";var n=i(82109),s=i(46916),r=i(31913),o=i(76530),a=i(60614),l=i(24994),c=i(79518),d=i(27674),h=i(58003),u=i(68880),p=i(31320),m=i(5112),f=i(97497),g=i(13383),v=o.PROPER,y=o.CONFIGURABLE,b=g.IteratorPrototype,S=g.BUGGY_SAFARI_ITERATORS,E=m("iterator"),T="keys",w="values",x="entries",_=function(){return this};e.exports=function(e,t,i,o,m,g,M){l(i,t,o);var O,A,C,P=function(e){if(e===m&&R)return R;if(!S&&e in I)return I[e];switch(e){case T:case w:case x:return function(){return new i(this,e)}}return function(){return new i(this)}},D=t+" Iterator",N=!1,I=e.prototype,L=I[E]||I["@@iterator"]||m&&I[m],R=!S&&L||P(m),k="Array"==t&&I.entries||L;if(k&&(O=c(k.call(new e)))!==Object.prototype&&O.next&&(r||c(O)===b||(d?d(O,b):a(O[E])||p(O,E,_)),h(O,D,!0,!0),r&&(f[D]=_)),v&&m==w&&L&&L.name!==w&&(!r&&y?u(I,"name",w):(N=!0,R=function(){return s(L,this)})),m)if(A={values:P(w),keys:g?R:P(T),entries:P(x)},M)for(C in A)(S||N||!(C in I))&&p(I,C,A[C]);else n({target:t,proto:!0,forced:S||N},A);return r&&!M||I[E]===R||p(I,E,R,{name:m}),f[t]=R,A}},19781:(e,t,i)=>{var n=i(47293);e.exports=!n((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}))},80317:(e,t,i)=>{var n=i(17854),s=i(70111),r=n.document,o=s(r)&&s(r.createElement);e.exports=function(e){return o?r.createElement(e):{}}},48324:e=>{e.exports={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}},98509:(e,t,i)=>{var n=i(80317)("span").classList,s=n&&n.constructor&&n.constructor.prototype;e.exports=s===Object.prototype?void 0:s},88113:(e,t,i)=>{var n=i(35005);e.exports=n("navigator","userAgent")||""},7392:(e,t,i)=>{var n,s,r=i(17854),o=i(88113),a=r.process,l=r.Deno,c=a&&a.versions||l&&l.version,d=c&&c.v8;d&&(s=(n=d.split("."))[0]>0&&n[0]<4?1:+(n[0]+n[1])),!s&&o&&(!(n=o.match(/Edge\/(\d+)/))||n[1]>=74)&&(n=o.match(/Chrome\/(\d+)/))&&(s=+n[1]),e.exports=s},80748:e=>{e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},82109:(e,t,i)=>{var n=i(17854),s=i(31236).f,r=i(68880),o=i(31320),a=i(83505),l=i(99920),c=i(54705);e.exports=function(e,t){var i,d,h,u,p,m=e.target,f=e.global,g=e.stat;if(i=f?n:g?n[m]||a(m,{}):(n[m]||{}).prototype)for(d in t){if(u=t[d],h=e.noTargetGet?(p=s(i,d))&&p.value:i[d],!c(f?d:m+(g?".":"#")+d,e.forced)&&void 0!==h){if(typeof u==typeof h)continue;l(u,h)}(e.sham||h&&h.sham)&&r(u,"sham",!0),o(i,d,u,e)}}},47293:e=>{e.exports=function(e){try{return!!e()}catch(e){return!0}}},49974:(e,t,i)=>{var n=i(1702),s=i(19662),r=n(n.bind);e.exports=function(e,t){return s(e),void 0===t?e:r?r(e,t):function(){return e.apply(t,arguments)}}},46916:e=>{var t=Function.prototype.call;e.exports=t.bind?t.bind(t):function(){return t.apply(t,arguments)}},76530:(e,t,i)=>{var n=i(19781),s=i(92597),r=Function.prototype,o=n&&Object.getOwnPropertyDescriptor,a=s(r,"name"),l=a&&"something"===function(){}.name,c=a&&(!n||n&&o(r,"name").configurable);e.exports={EXISTS:a,PROPER:l,CONFIGURABLE:c}},1702:e=>{var t=Function.prototype,i=t.bind,n=t.call,s=i&&i.bind(n,n);e.exports=i?function(e){return e&&s(e)}:function(e){return e&&function(){return n.apply(e,arguments)}}},35005:(e,t,i)=>{var n=i(17854),s=i(60614),r=function(e){return s(e)?e:void 0};e.exports=function(e,t){return arguments.length<2?r(n[e]):n[e]&&n[e][t]}},71246:(e,t,i)=>{var n=i(70648),s=i(58173),r=i(97497),o=i(5112)("iterator");e.exports=function(e){if(null!=e)return s(e,o)||s(e,"@@iterator")||r[n(e)]}},18554:(e,t,i)=>{var n=i(17854),s=i(46916),r=i(19662),o=i(19670),a=i(66330),l=i(71246),c=n.TypeError;e.exports=function(e,t){var i=arguments.length<2?l(e):t;if(r(i))return o(s(i,e));throw c(a(e)+" is not iterable")}},58173:(e,t,i)=>{var n=i(19662);e.exports=function(e,t){var i=e[t];return null==i?void 0:n(i)}},17854:(e,t,i)=>{var n=function(e){return e&&e.Math==Math&&e};e.exports=n("object"==typeof globalThis&&globalThis)||n("object"==typeof window&&window)||n("object"==typeof self&&self)||n("object"==typeof i.g&&i.g)||function(){return this}()||Function("return this")()},92597:(e,t,i)=>{var n=i(1702),s=i(47908),r=n({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return r(s(e),t)}},3501:e=>{e.exports={}},60490:(e,t,i)=>{var n=i(35005);e.exports=n("document","documentElement")},64664:(e,t,i)=>{var n=i(19781),s=i(47293),r=i(80317);e.exports=!n&&!s((function(){return 7!=Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},68361:(e,t,i)=>{var n=i(17854),s=i(1702),r=i(47293),o=i(84326),a=n.Object,l=s("".split);e.exports=r((function(){return!a("z").propertyIsEnumerable(0)}))?function(e){return"String"==o(e)?l(e,""):a(e)}:a},42788:(e,t,i)=>{var n=i(1702),s=i(60614),r=i(5465),o=n(Function.toString);s(r.inspectSource)||(r.inspectSource=function(e){return o(e)}),e.exports=r.inspectSource},29909:(e,t,i)=>{var n,s,r,o=i(68536),a=i(17854),l=i(1702),c=i(70111),d=i(68880),h=i(92597),u=i(5465),p=i(6200),m=i(3501),f="Object already initialized",g=a.TypeError,v=a.WeakMap;if(o||u.state){var y=u.state||(u.state=new v),b=l(y.get),S=l(y.has),E=l(y.set);n=function(e,t){if(S(y,e))throw new g(f);return t.facade=e,E(y,e,t),t},s=function(e){return b(y,e)||{}},r=function(e){return S(y,e)}}else{var T=p("state");m[T]=!0,n=function(e,t){if(h(e,T))throw new g(f);return t.facade=e,d(e,T,t),t},s=function(e){return h(e,T)?e[T]:{}},r=function(e){return h(e,T)}}e.exports={set:n,get:s,has:r,enforce:function(e){return r(e)?s(e):n(e,{})},getterFor:function(e){return function(t){var i;if(!c(t)||(i=s(t)).type!==e)throw g("Incompatible receiver, "+e+" required");return i}}}},60614:e=>{e.exports=function(e){return"function"==typeof e}},54705:(e,t,i)=>{var n=i(47293),s=i(60614),r=/#|\.prototype\./,o=function(e,t){var i=l[a(e)];return i==d||i!=c&&(s(t)?n(t):!!t)},a=o.normalize=function(e){return String(e).replace(r,".").toLowerCase()},l=o.data={},c=o.NATIVE="N",d=o.POLYFILL="P";e.exports=o},70111:(e,t,i)=>{var n=i(60614);e.exports=function(e){return"object"==typeof e?null!==e:n(e)}},31913:e=>{e.exports=!1},52190:(e,t,i)=>{var n=i(17854),s=i(35005),r=i(60614),o=i(47976),a=i(43307),l=n.Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=s("Symbol");return r(t)&&o(t.prototype,l(e))}},13383:(e,t,i)=>{"use strict";var n,s,r,o=i(47293),a=i(60614),l=i(70030),c=i(79518),d=i(31320),h=i(5112),u=i(31913),p=h("iterator"),m=!1;[].keys&&("next"in(r=[].keys())?(s=c(c(r)))!==Object.prototype&&(n=s):m=!0),null==n||o((function(){var e={};return n[p].call(e)!==e}))?n={}:u&&(n=l(n)),a(n[p])||d(n,p,(function(){return this})),e.exports={IteratorPrototype:n,BUGGY_SAFARI_ITERATORS:m}},97497:e=>{e.exports={}},26244:(e,t,i)=>{var n=i(17466);e.exports=function(e){return n(e.length)}},30133:(e,t,i)=>{var n=i(7392),s=i(47293);e.exports=!!Object.getOwnPropertySymbols&&!s((function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&n&&n<41}))},590:(e,t,i)=>{var n=i(47293),s=i(5112),r=i(31913),o=s("iterator");e.exports=!n((function(){var e=new URL("b?a=1&b=2&c=3","http://a"),t=e.searchParams,i="";return e.pathname="c%20d",t.forEach((function(e,n){t.delete("b"),i+=n+e})),r&&!e.toJSON||!t.sort||"http://a/c%20d?a=1&c=3"!==e.href||"3"!==t.get("c")||"a=1"!==String(new URLSearchParams("?a=1"))||!t[o]||"a"!==new URL("https://a@b").username||"b"!==new URLSearchParams(new URLSearchParams("a=b")).get("a")||"xn--e1aybc"!==new URL("http://").host||"#%D0%B1"!==new URL("http://a#").hash||"a1c3"!==i||"x"!==new URL("http://x",void 0).host}))},68536:(e,t,i)=>{var n=i(17854),s=i(60614),r=i(42788),o=n.WeakMap;e.exports=s(o)&&/native code/.test(r(o))},70030:(e,t,i)=>{var n,s=i(19670),r=i(36048),o=i(80748),a=i(3501),l=i(60490),c=i(80317),d=i(6200),h=d("IE_PROTO"),u=function(){},p=function(e){return"<script>"+e+"</"+"script>"},m=function(e){e.write(p("")),e.close();var t=e.parentWindow.Object;return e=null,t},f=function(){try{n=new ActiveXObject("htmlfile")}catch(e){}var e,t;f="undefined"!=typeof document?document.domain&&n?m(n):((t=c("iframe")).style.display="none",l.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(p("document.F=Object")),e.close(),e.F):m(n);for(var i=o.length;i--;)delete f.prototype[o[i]];return f()};a[h]=!0,e.exports=Object.create||function(e,t){var i;return null!==e?(u.prototype=s(e),i=new u,u.prototype=null,i[h]=e):i=f(),void 0===t?i:r.f(i,t)}},36048:(e,t,i)=>{var n=i(19781),s=i(3353),r=i(3070),o=i(19670),a=i(45656),l=i(81956);t.f=n&&!s?Object.defineProperties:function(e,t){o(e);for(var i,n=a(t),s=l(t),c=s.length,d=0;c>d;)r.f(e,i=s[d++],n[i]);return e}},3070:(e,t,i)=>{var n=i(17854),s=i(19781),r=i(64664),o=i(3353),a=i(19670),l=i(34948),c=n.TypeError,d=Object.defineProperty,h=Object.getOwnPropertyDescriptor,u="enumerable",p="configurable",m="writable";t.f=s?o?function(e,t,i){if(a(e),t=l(t),a(i),"function"==typeof e&&"prototype"===t&&"value"in i&&m in i&&!i.writable){var n=h(e,t);n&&n.writable&&(e[t]=i.value,i={configurable:p in i?i.configurable:n.configurable,enumerable:u in i?i.enumerable:n.enumerable,writable:!1})}return d(e,t,i)}:d:function(e,t,i){if(a(e),t=l(t),a(i),r)try{return d(e,t,i)}catch(e){}if("get"in i||"set"in i)throw c("Accessors not supported");return"value"in i&&(e[t]=i.value),e}},31236:(e,t,i)=>{var n=i(19781),s=i(46916),r=i(55296),o=i(79114),a=i(45656),l=i(34948),c=i(92597),d=i(64664),h=Object.getOwnPropertyDescriptor;t.f=n?h:function(e,t){if(e=a(e),t=l(t),d)try{return h(e,t)}catch(e){}if(c(e,t))return o(!s(r.f,e,t),e[t])}},8006:(e,t,i)=>{var n=i(16324),s=i(80748).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return n(e,s)}},25181:(e,t)=>{t.f=Object.getOwnPropertySymbols},79518:(e,t,i)=>{var n=i(17854),s=i(92597),r=i(60614),o=i(47908),a=i(6200),l=i(49920),c=a("IE_PROTO"),d=n.Object,h=d.prototype;e.exports=l?d.getPrototypeOf:function(e){var t=o(e);if(s(t,c))return t[c];var i=t.constructor;return r(i)&&t instanceof i?i.prototype:t instanceof d?h:null}},47976:(e,t,i)=>{var n=i(1702);e.exports=n({}.isPrototypeOf)},16324:(e,t,i)=>{var n=i(1702),s=i(92597),r=i(45656),o=i(41318).indexOf,a=i(3501),l=n([].push);e.exports=function(e,t){var i,n=r(e),c=0,d=[];for(i in n)!s(a,i)&&s(n,i)&&l(d,i);for(;t.length>c;)s(n,i=t[c++])&&(~o(d,i)||l(d,i));return d}},81956:(e,t,i)=>{var n=i(16324),s=i(80748);e.exports=Object.keys||function(e){return n(e,s)}},55296:(e,t)=>{"use strict";var i={}.propertyIsEnumerable,n=Object.getOwnPropertyDescriptor,s=n&&!i.call({1:2},1);t.f=s?function(e){var t=n(this,e);return!!t&&t.enumerable}:i},27674:(e,t,i)=>{var n=i(1702),s=i(19670),r=i(96077);e.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,i={};try{(e=n(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(i,[]),t=i instanceof Array}catch(e){}return function(i,n){return s(i),r(n),t?e(i,n):i.__proto__=n,i}}():void 0)},92140:(e,t,i)=>{var n=i(17854),s=i(46916),r=i(60614),o=i(70111),a=n.TypeError;e.exports=function(e,t){var i,n;if("string"===t&&r(i=e.toString)&&!o(n=s(i,e)))return n;if(r(i=e.valueOf)&&!o(n=s(i,e)))return n;if("string"!==t&&r(i=e.toString)&&!o(n=s(i,e)))return n;throw a("Can't convert object to primitive value")}},53887:(e,t,i)=>{var n=i(35005),s=i(1702),r=i(8006),o=i(25181),a=i(19670),l=s([].concat);e.exports=n("Reflect","ownKeys")||function(e){var t=r.f(a(e)),i=o.f;return i?l(t,i(e)):t}},40857:(e,t,i)=>{var n=i(17854);e.exports=n},12248:(e,t,i)=>{var n=i(31320);e.exports=function(e,t,i){for(var s in t)n(e,s,t[s],i);return e}},31320:(e,t,i)=>{var n=i(17854),s=i(60614),r=i(92597),o=i(68880),a=i(83505),l=i(42788),c=i(29909),d=i(76530).CONFIGURABLE,h=c.get,u=c.enforce,p=String(String).split("String");(e.exports=function(e,t,i,l){var c,h=!!l&&!!l.unsafe,m=!!l&&!!l.enumerable,f=!!l&&!!l.noTargetGet,g=l&&void 0!==l.name?l.name:t;s(i)&&("Symbol("===String(g).slice(0,7)&&(g="["+String(g).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!r(i,"name")||d&&i.name!==g)&&o(i,"name",g),(c=u(i)).source||(c.source=p.join("string"==typeof g?g:""))),e!==n?(h?!f&&e[t]&&(m=!0):delete e[t],m?e[t]=i:o(e,t,i)):m?e[t]=i:a(t,i)})(Function.prototype,"toString",(function(){return s(this)&&h(this).source||l(this)}))},84488:(e,t,i)=>{var n=i(17854).TypeError;e.exports=function(e){if(null==e)throw n("Can't call method on "+e);return e}},83505:(e,t,i)=>{var n=i(17854),s=Object.defineProperty;e.exports=function(e,t){try{s(n,e,{value:t,configurable:!0,writable:!0})}catch(i){n[e]=t}return t}},58003:(e,t,i)=>{var n=i(3070).f,s=i(92597),r=i(5112)("toStringTag");e.exports=function(e,t,i){e&&!i&&(e=e.prototype),e&&!s(e,r)&&n(e,r,{configurable:!0,value:t})}},6200:(e,t,i)=>{var n=i(72309),s=i(69711),r=n("keys");e.exports=function(e){return r[e]||(r[e]=s(e))}},5465:(e,t,i)=>{var n=i(17854),s=i(83505),r="__core-js_shared__",o=n[r]||s(r,{});e.exports=o},72309:(e,t,i)=>{var n=i(31913),s=i(5465);(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.20.2",mode:n?"pure":"global",copyright:" 2022 Denis Pushkarev (zloirock.ru)"})},51400:(e,t,i)=>{var n=i(19303),s=Math.max,r=Math.min;e.exports=function(e,t){var i=n(e);return i<0?s(i+t,0):r(i,t)}},45656:(e,t,i)=>{var n=i(68361),s=i(84488);e.exports=function(e){return n(s(e))}},19303:e=>{var t=Math.ceil,i=Math.floor;e.exports=function(e){var n=+e;return n!=n||0===n?0:(n>0?i:t)(n)}},17466:(e,t,i)=>{var n=i(19303),s=Math.min;e.exports=function(e){return e>0?s(n(e),9007199254740991):0}},47908:(e,t,i)=>{var n=i(17854),s=i(84488),r=n.Object;e.exports=function(e){return r(s(e))}},57593:(e,t,i)=>{var n=i(17854),s=i(46916),r=i(70111),o=i(52190),a=i(58173),l=i(92140),c=i(5112),d=n.TypeError,h=c("toPrimitive");e.exports=function(e,t){if(!r(e)||o(e))return e;var i,n=a(e,h);if(n){if(void 0===t&&(t="default"),i=s(n,e,t),!r(i)||o(i))return i;throw d("Can't convert object to primitive value")}return void 0===t&&(t="number"),l(e,t)}},34948:(e,t,i)=>{var n=i(57593),s=i(52190);e.exports=function(e){var t=n(e,"string");return s(t)?t:t+""}},51694:(e,t,i)=>{var n={};n[i(5112)("toStringTag")]="z",e.exports="[object z]"===String(n)},41340:(e,t,i)=>{var n=i(17854),s=i(70648),r=n.String;e.exports=function(e){if("Symbol"===s(e))throw TypeError("Cannot convert a Symbol value to a string");return r(e)}},66330:(e,t,i)=>{var n=i(17854).String;e.exports=function(e){try{return n(e)}catch(e){return"Object"}}},69711:(e,t,i)=>{var n=i(1702),s=0,r=Math.random(),o=n(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+o(++s+r,36)}},43307:(e,t,i)=>{var n=i(30133);e.exports=n&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},3353:(e,t,i)=>{var n=i(19781),s=i(47293);e.exports=n&&s((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},5112:(e,t,i)=>{var n=i(17854),s=i(72309),r=i(92597),o=i(69711),a=i(30133),l=i(43307),c=s("wks"),d=n.Symbol,h=d&&d.for,u=l?d:d&&d.withoutSetter||o;e.exports=function(e){if(!r(c,e)||!a&&"string"!=typeof c[e]){var t="Symbol."+e;a&&r(d,e)?c[e]=d[e]:c[e]=l&&h?h(t):u(t)}return c[e]}},66992:(e,t,i)=>{"use strict";var n=i(45656),s=i(51223),r=i(97497),o=i(29909),a=i(3070).f,l=i(70654),c=i(31913),d=i(19781),h="Array Iterator",u=o.set,p=o.getterFor(h);e.exports=l(Array,"Array",(function(e,t){u(this,{type:h,target:n(e),index:0,kind:t})}),(function(){var e=p(this),t=e.target,i=e.kind,n=e.index++;return!t||n>=t.length?(e.target=void 0,{value:void 0,done:!0}):"keys"==i?{value:n,done:!1}:"values"==i?{value:t[n],done:!1}:{value:[n,t[n]],done:!1}}),"values");var m=r.Arguments=r.Array;if(s("keys"),s("values"),s("entries"),!c&&d&&"values"!==m.name)try{a(m,"name",{value:"values"})}catch(e){}},33948:(e,t,i)=>{var n=i(17854),s=i(48324),r=i(98509),o=i(66992),a=i(68880),l=i(5112),c=l("iterator"),d=l("toStringTag"),h=o.values,u=function(e,t){if(e){if(e[c]!==h)try{a(e,c,h)}catch(t){e[c]=h}if(e[d]||a(e,d,t),s[t])for(var i in o)if(e[i]!==o[i])try{a(e,i,o[i])}catch(t){e[i]=o[i]}}};for(var p in s)u(n[p]&&n[p].prototype,p);u(r,"DOMTokenList")},41637:(e,t,i)=>{"use strict";i(66992);var n=i(82109),s=i(17854),r=i(35005),o=i(46916),a=i(1702),l=i(590),c=i(31320),d=i(12248),h=i(58003),u=i(24994),p=i(29909),m=i(25787),f=i(60614),g=i(92597),v=i(49974),y=i(70648),b=i(19670),S=i(70111),E=i(41340),T=i(70030),w=i(79114),x=i(18554),_=i(71246),M=i(5112),O=i(94362),A=M("iterator"),C="URLSearchParams",P="URLSearchParamsIterator",D=p.set,N=p.getterFor(C),I=p.getterFor(P),L=r("fetch"),R=r("Request"),k=r("Headers"),U=R&&R.prototype,B=k&&k.prototype,F=s.RegExp,V=s.TypeError,H=s.decodeURIComponent,j=s.encodeURIComponent,G=a("".charAt),z=a([].join),W=a([].push),K=a("".replace),Y=a([].shift),q=a([].splice),Z=a("".split),$=a("".slice),Q=/\+/g,X=Array(4),J=function(e){return X[e-1]||(X[e-1]=F("((?:%[\\da-f]{2}){"+e+"})","gi"))},ee=function(e){try{return H(e)}catch(t){return e}},te=function(e){var t=K(e,Q," "),i=4;try{return H(t)}catch(e){for(;i;)t=K(t,J(i--),ee);return t}},ie=/[!'()~]|%20/g,ne={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},se=function(e){return ne[e]},re=function(e){return K(j(e),ie,se)},oe=function(e,t){if(e<t)throw V("Not enough arguments")},ae=u((function(e,t){D(this,{type:P,iterator:x(N(e).entries),kind:t})}),"Iterator",(function(){var e=I(this),t=e.kind,i=e.iterator.next(),n=i.value;return i.done||(i.value="keys"===t?n.key:"values"===t?n.value:[n.key,n.value]),i}),!0),le=function(e){this.entries=[],this.url=null,void 0!==e&&(S(e)?this.parseObject(e):this.parseQuery("string"==typeof e?"?"===G(e,0)?$(e,1):e:E(e)))};le.prototype={type:C,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var t,i,n,s,r,a,l,c=_(e);if(c)for(i=(t=x(e,c)).next;!(n=o(i,t)).done;){if(r=(s=x(b(n.value))).next,(a=o(r,s)).done||(l=o(r,s)).done||!o(r,s).done)throw V("Expected sequence with length 2");W(this.entries,{key:E(a.value),value:E(l.value)})}else for(var d in e)g(e,d)&&W(this.entries,{key:d,value:E(e[d])})},parseQuery:function(e){if(e)for(var t,i,n=Z(e,"&"),s=0;s<n.length;)(t=n[s++]).length&&(i=Z(t,"="),W(this.entries,{key:te(Y(i)),value:te(z(i,"="))}))},serialize:function(){for(var e,t=this.entries,i=[],n=0;n<t.length;)e=t[n++],W(i,re(e.key)+"="+re(e.value));return z(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var ce=function(){m(this,de);var e=arguments.length>0?arguments[0]:void 0;D(this,new le(e))},de=ce.prototype;if(d(de,{append:function(e,t){oe(arguments.length,2);var i=N(this);W(i.entries,{key:E(e),value:E(t)}),i.updateURL()},delete:function(e){oe(arguments.length,1);for(var t=N(this),i=t.entries,n=E(e),s=0;s<i.length;)i[s].key===n?q(i,s,1):s++;t.updateURL()},get:function(e){oe(arguments.length,1);for(var t=N(this).entries,i=E(e),n=0;n<t.length;n++)if(t[n].key===i)return t[n].value;return null},getAll:function(e){oe(arguments.length,1);for(var t=N(this).entries,i=E(e),n=[],s=0;s<t.length;s++)t[s].key===i&&W(n,t[s].value);return n},has:function(e){oe(arguments.length,1);for(var t=N(this).entries,i=E(e),n=0;n<t.length;)if(t[n++].key===i)return!0;return!1},set:function(e,t){oe(arguments.length,1);for(var i,n=N(this),s=n.entries,r=!1,o=E(e),a=E(t),l=0;l<s.length;l++)(i=s[l]).key===o&&(r?q(s,l--,1):(r=!0,i.value=a));r||W(s,{key:o,value:a}),n.updateURL()},sort:function(){var e=N(this);O(e.entries,(function(e,t){return e.key>t.key?1:-1})),e.updateURL()},forEach:function(e){for(var t,i=N(this).entries,n=v(e,arguments.length>1?arguments[1]:void 0),s=0;s<i.length;)n((t=i[s++]).value,t.key,this)},keys:function(){return new ae(this,"keys")},values:function(){return new ae(this,"values")},entries:function(){return new ae(this,"entries")}},{enumerable:!0}),c(de,A,de.entries,{name:"entries"}),c(de,"toString",(function(){return N(this).serialize()}),{enumerable:!0}),h(ce,C),n({global:!0,forced:!l},{URLSearchParams:ce}),!l&&f(k)){var he=a(B.has),ue=a(B.set),pe=function(e){if(S(e)){var t,i=e.body;if(y(i)===C)return t=e.headers?new k(e.headers):new k,he(t,"content-type")||ue(t,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),T(e,{body:w(0,E(i)),headers:w(0,t)})}return e};if(f(L)&&n({global:!0,enumerable:!0,forced:!0},{fetch:function(e){return L(e,arguments.length>1?pe(arguments[1]):{})}}),f(R)){var me=function(e){return m(this,U),new R(e,arguments.length>1?pe(arguments[1]):{})};U.constructor=me,me.prototype=U,n({global:!0,forced:!0},{Request:me})}}e.exports={URLSearchParams:ce,getState:N}},8492:(e,t,i)=>{var n=i(98504);i(33948),e.exports=n},98504:(e,t,i)=>{i(41637);var n=i(40857);e.exports=n.URLSearchParams},4289:(e,t,i)=>{"use strict";var n=i(82215),s="function"==typeof Symbol&&"symbol"==typeof Symbol("foo"),r=Object.prototype.toString,o=Array.prototype.concat,a=Object.defineProperty,l=a&&function(){var e={};try{for(var t in a(e,"x",{enumerable:!1,value:e}),e)return!1;return e.x===e}catch(e){return!1}}(),c=function(e,t,i,n){var s;(!(t in e)||"function"==typeof(s=n)&&"[object Function]"===r.call(s)&&n())&&(l?a(e,t,{configurable:!0,enumerable:!1,value:i,writable:!0}):e[t]=i)},d=function(e,t){var i=arguments.length>2?arguments[2]:{},r=n(t);s&&(r=o.call(r,Object.getOwnPropertySymbols(t)));for(var a=0;a<r.length;a+=1)c(e,r[a],t[r[a]],i[r[a]])};d.supportsDescriptors=!!l,e.exports=d},35035:e=>{"use strict";e.exports=function(e,t){t||(t={}),"function"==typeof t&&(t={cmp:t});var i,n="boolean"==typeof t.cycles&&t.cycles,s=t.cmp&&(i=t.cmp,function(e){return function(t,n){var s={key:t,value:e[t]},r={key:n,value:e[n]};return i(s,r)}}),r=[];return function e(t){if(t&&t.toJSON&&"function"==typeof t.toJSON&&(t=t.toJSON()),void 0!==t){if("number"==typeof t)return isFinite(t)?""+t:"null";if("object"!=typeof t)return JSON.stringify(t);var i,o;if(Array.isArray(t)){for(o="[",i=0;i<t.length;i++)i&&(o+=","),o+=e(t[i])||"null";return o+"]"}if(null===t)return"null";if(-1!==r.indexOf(t)){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var a=r.push(t)-1,l=Object.keys(t).sort(s&&s(t));for(o="",i=0;i<l.length;i++){var c=l[i],d=e(t[c]);d&&(o&&(o+=","),o+=JSON.stringify(c)+":"+d)}return r.splice(a,1),"{"+o+"}"}}(e)}},94029:(e,t,i)=>{"use strict";var n=i(95320),s=Object.prototype.toString,r=Object.prototype.hasOwnProperty,o=function(e,t,i){for(var n=0,s=e.length;n<s;n++)r.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))},a=function(e,t,i){for(var n=0,s=e.length;n<s;n++)null==i?t(e.charAt(n),n,e):t.call(i,e.charAt(n),n,e)},l=function(e,t,i){for(var n in e)r.call(e,n)&&(null==i?t(e[n],n,e):t.call(i,e[n],n,e))};e.exports=function(e,t,i){if(!n(t))throw new TypeError("iterator must be a function");var r;arguments.length>=3&&(r=i),"[object Array]"===s.call(e)?o(e,t,r):"string"==typeof e?a(e,t,r):l(e,t,r)}},17648:e=>{"use strict";var t="Function.prototype.bind called on incompatible ",i=Array.prototype.slice,n=Object.prototype.toString,s="[object Function]";e.exports=function(e){var r=this;if("function"!=typeof r||n.call(r)!==s)throw new TypeError(t+r);for(var o,a=i.call(arguments,1),l=function(){if(this instanceof o){var t=r.apply(this,a.concat(i.call(arguments)));return Object(t)===t?t:this}return r.apply(e,a.concat(i.call(arguments)))},c=Math.max(0,r.length-a.length),d=[],h=0;h<c;h++)d.push("$"+h);if(o=Function("binder","return function ("+d.join(",")+"){ return binder.apply(this,arguments); }")(l),r.prototype){var u=function(){};u.prototype=r.prototype,o.prototype=new u,u.prototype=null}return o}},58612:(e,t,i)=>{"use strict";var n=i(17648);e.exports=Function.prototype.bind||n},50972:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){var t=e.prototype.toJSON;"function"==typeof t||(0,n.default)(0),e.prototype.inspect=t,s.default&&(e.prototype[s.default]=t)};var n=r(i(7706)),s=r(i(79466));function r(e){return e&&e.__esModule?e:{default:e}}},8002:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){return o(e,[])};var n,s=(n=i(79466))&&n.__esModule?n:{default:n};function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){switch(r(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),n=function(e){var t=e[String(s.default)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==n){var r=n.call(e);if(r!==e)return"string"==typeof r?r:o(r,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),n=e.length-i,s=[],r=0;r<i;++r)s.push(o(e[r],t));1===n?s.push("... 1 more item"):n>1&&s.push("... ".concat(n," more items"));return"["+s.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);if(0===i.length)return"{}";if(t.length>2)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]";return"{ "+i.map((function(i){return i+": "+o(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},6589:(e,t,i)=>{"use strict";i.d(t,{Z:()=>r});var n=i(97986);function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e){return o(e,[])}function o(e,t){switch(s(e)){case"string":return JSON.stringify(e);case"function":return e.name?"[function ".concat(e.name,"]"):"[function]";case"object":return null===e?"null":function(e,t){if(-1!==t.indexOf(e))return"[Circular]";var i=[].concat(t,[e]),s=function(e){var t=e[String(n.Z)];if("function"==typeof t)return t;if("function"==typeof e.inspect)return e.inspect}(e);if(void 0!==s){var r=s.call(e);if(r!==e)return"string"==typeof r?r:o(r,i)}else if(Array.isArray(e))return function(e,t){if(0===e.length)return"[]";if(t.length>2)return"[Array]";for(var i=Math.min(10,e.length),n=e.length-i,s=[],r=0;r<i;++r)s.push(o(e[r],t));1===n?s.push("... 1 more item"):n>1&&s.push("... ".concat(n," more items"));return"["+s.join(", ")+"]"}(e,i);return function(e,t){var i=Object.keys(e);if(0===i.length)return"{}";if(t.length>2)return"["+function(e){var t=Object.prototype.toString.call(e).replace(/^\[object /,"").replace(/]$/,"");if("Object"===t&&"function"==typeof e.constructor){var i=e.constructor.name;if("string"==typeof i&&""!==i)return i}return t}(e)+"]";return"{ "+i.map((function(i){return i+": "+o(e[i],t)})).join(", ")+" }"}(e,i)}(e,t);default:return String(e)}}},7706:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}},79466:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0;t.default=i},97986:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):void 0},91807:(e,t,i)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isNode=function(e){return null!=e&&"string"==typeof e.kind},t.Token=t.Location=void 0;var n,s=(n=i(50972))&&n.__esModule?n:{default:n};var r=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();t.Location=r,(0,s.default)(r);var o=function(){function e(e,t,i,n,s,r,o){this.kind=e,this.start=t,this.end=i,this.line=n,this.column=s,this.value=o,this.prev=r,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();t.Token=o,(0,s.default)(o)},83059:(e,t,i)=>{"use strict";i.d(t,{Ye:()=>r,WU:()=>o,UG:()=>a});var n=i(97986);function s(e){var t=e.prototype.toJSON;"function"==typeof t||function(e,t){if(!Boolean(e))throw new Error(null!=t?t:"Unexpected invariant triggered.")}(0),e.prototype.inspect=t,n.Z&&(e.prototype[n.Z]=t)}var r=function(){function e(e,t,i){this.start=e.start,this.end=t.end,this.startToken=e,this.endToken=t,this.source=i}return e.prototype.toJSON=function(){return{start:this.start,end:this.end}},e}();s(r);var o=function(){function e(e,t,i,n,s,r,o){this.kind=e,this.start=t,this.end=i,this.line=n,this.column=s,this.value=o,this.prev=r,this.next=null}return e.prototype.toJSON=function(){return{kind:this.kind,value:this.value,line:this.line,column:this.column}},e}();function a(e){return null!=e&&"string"==typeof e.kind}s(o)},7420:(e,t,i)=>{"use strict";function n(e){var t=e.split(/\r\n|[\n\r]/g),i=function(e){for(var t,i=!0,n=!0,s=0,r=null,o=0;o<e.length;++o)switch(e.charCodeAt(o)){case 13:10===e.charCodeAt(o+1)&&++o;case 10:i=!1,n=!0,s=0;break;case 9:case 32:++s;break;default:n&&!i&&(null===r||s<r)&&(r=s),n=!1}return null!==(t=r)&&void 0!==t?t:0}(e);if(0!==i)for(var n=1;n<t.length;n++)t[n]=t[n].slice(i);for(var r=0;r<t.length&&s(t[r]);)++r;for(var o=t.length;o>r&&s(t[o-1]);)--o;return t.slice(r,o).join("\n")}function s(e){for(var t=0;t<e.length;++t)if(" "!==e[t]&&"\t"!==e[t])return!1;return!0}function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=-1===e.indexOf("\n"),s=" "===e[0]||"\t"===e[0],r='"'===e[e.length-1],o="\\"===e[e.length-1],a=!n||r||o||i,l="";return!a||n&&s||(l+="\n"+t),l+=t?e.replace(/\n/g,"\n"+t):e,a&&(l+="\n"),'"""'+l.replace(/"""/g,'\\"""')+'"""'}i.d(t,{W7:()=>n,LZ:()=>r})},90778:(e,t,i)=>{"use strict";i.d(t,{S:()=>r});var n=i(27636),s=i(7420);function r(e){return(0,n.Vn)(e,{leave:o})}var o={Name:function(e){return e.value},Variable:function(e){return"$"+e.name},Document:function(e){return l(e.definitions,"\n\n")+"\n"},OperationDefinition:function(e){var t=e.operation,i=e.name,n=d("(",l(e.variableDefinitions,", "),")"),s=l(e.directives," "),r=e.selectionSet;return i||s||n||"query"!==t?l([t,l([i,n]),s,r]," "):r},VariableDefinition:function(e){var t=e.variable,i=e.type,n=e.defaultValue,s=e.directives;return t+": "+i+d(" = ",n)+d(" ",l(s," "))},SelectionSet:function(e){return c(e.selections)},Field:function(e){var t=e.alias,i=e.name,n=e.arguments,s=e.directives,r=e.selectionSet,o=d("",t,": ")+i,a=o+d("(",l(n,", "),")");return a.length>80&&(a=o+d("(\n",h(l(n,"\n")),"\n)")),l([a,l(s," "),r]," ")},Argument:function(e){return e.name+": "+e.value},FragmentSpread:function(e){return"..."+e.name+d(" ",l(e.directives," "))},InlineFragment:function(e){var t=e.typeCondition,i=e.directives,n=e.selectionSet;return l(["...",d("on ",t),l(i," "),n]," ")},FragmentDefinition:function(e){var t=e.name,i=e.typeCondition,n=e.variableDefinitions,s=e.directives,r=e.selectionSet;return"fragment ".concat(t).concat(d("(",l(n,", "),")")," ")+"on ".concat(i," ").concat(d("",l(s," ")," "))+r},IntValue:function(e){return e.value},FloatValue:function(e){return e.value},StringValue:function(e,t){var i=e.value;return e.block?(0,s.LZ)(i,"description"===t?"":"  "):JSON.stringify(i)},BooleanValue:function(e){return e.value?"true":"false"},NullValue:function(){return"null"},EnumValue:function(e){return e.value},ListValue:function(e){return"["+l(e.values,", ")+"]"},ObjectValue:function(e){return"{"+l(e.fields,", ")+"}"},ObjectField:function(e){return e.name+": "+e.value},Directive:function(e){return"@"+e.name+d("(",l(e.arguments,", "),")")},NamedType:function(e){return e.name},ListType:function(e){return"["+e.type+"]"},NonNullType:function(e){return e.type+"!"},SchemaDefinition:a((function(e){var t=e.directives,i=e.operationTypes;return l(["schema",l(t," "),c(i)]," ")})),OperationTypeDefinition:function(e){return e.operation+": "+e.type},ScalarTypeDefinition:a((function(e){return l(["scalar",e.name,l(e.directives," ")]," ")})),ObjectTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["type",t,d("implements ",l(i," & ")),l(n," "),c(s)]," ")})),FieldDefinition:a((function(e){var t=e.name,i=e.arguments,n=e.type,s=e.directives;return t+(p(i)?d("(\n",h(l(i,"\n")),"\n)"):d("(",l(i,", "),")"))+": "+n+d(" ",l(s," "))})),InputValueDefinition:a((function(e){var t=e.name,i=e.type,n=e.defaultValue,s=e.directives;return l([t+": "+i,d("= ",n),l(s," ")]," ")})),InterfaceTypeDefinition:a((function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["interface",t,d("implements ",l(i," & ")),l(n," "),c(s)]," ")})),UnionTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.types;return l(["union",t,l(i," "),n&&0!==n.length?"= "+l(n," | "):""]," ")})),EnumTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.values;return l(["enum",t,l(i," "),c(n)]," ")})),EnumValueDefinition:a((function(e){return l([e.name,l(e.directives," ")]," ")})),InputObjectTypeDefinition:a((function(e){var t=e.name,i=e.directives,n=e.fields;return l(["input",t,l(i," "),c(n)]," ")})),DirectiveDefinition:a((function(e){var t=e.name,i=e.arguments,n=e.repeatable,s=e.locations;return"directive @"+t+(p(i)?d("(\n",h(l(i,"\n")),"\n)"):d("(",l(i,", "),")"))+(n?" repeatable":"")+" on "+l(s," | ")})),SchemaExtension:function(e){var t=e.directives,i=e.operationTypes;return l(["extend schema",l(t," "),c(i)]," ")},ScalarTypeExtension:function(e){return l(["extend scalar",e.name,l(e.directives," ")]," ")},ObjectTypeExtension:function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["extend type",t,d("implements ",l(i," & ")),l(n," "),c(s)]," ")},InterfaceTypeExtension:function(e){var t=e.name,i=e.interfaces,n=e.directives,s=e.fields;return l(["extend interface",t,d("implements ",l(i," & ")),l(n," "),c(s)]," ")},UnionTypeExtension:function(e){var t=e.name,i=e.directives,n=e.types;return l(["extend union",t,l(i," "),n&&0!==n.length?"= "+l(n," | "):""]," ")},EnumTypeExtension:function(e){var t=e.name,i=e.directives,n=e.values;return l(["extend enum",t,l(i," "),c(n)]," ")},InputObjectTypeExtension:function(e){var t=e.name,i=e.directives,n=e.fields;return l(["extend input",t,l(i," "),c(n)]," ")}};function a(e){return function(t){return l([t.description,e(t)],"\n")}}function l(e){var t,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return null!==(t=null==e?void 0:e.filter((function(e){return e})).join(i))&&void 0!==t?t:""}function c(e){return d("{\n",h(l(e,"\n")),"\n}")}function d(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return null!=t&&""!==t?e+t+i:""}function h(e){return d("  ",e.replace(/\n/g,"\n  "))}function u(e){return-1!==e.indexOf("\n")}function p(e){return null!=e&&e.some(u)}},80285:(e,t,i)=>{"use strict";t.Vn=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:o,n=void 0,c=Array.isArray(e),d=[e],h=-1,u=[],p=void 0,m=void 0,f=void 0,g=[],v=[],y=e;do{var b=++h===d.length,S=b&&0!==u.length;if(b){if(m=0===v.length?void 0:g[g.length-1],p=f,f=v.pop(),S){if(c)p=p.slice();else{for(var E={},T=0,w=Object.keys(p);T<w.length;T++){var x=w[T];E[x]=p[x]}p=E}for(var _=0,M=0;M<u.length;M++){var O=u[M][0],A=u[M][1];c&&(O-=_),c&&null===A?(p.splice(O,1),_++):p[O]=A}}h=n.index,d=n.keys,u=n.edits,c=n.inArray,n=n.prev}else{if(m=f?c?h:d[h]:void 0,null==(p=f?f[m]:y))continue;f&&g.push(m)}var C,P=void 0;if(!Array.isArray(p)){if(!(0,r.isNode)(p))throw new Error("Invalid AST Node: ".concat((0,s.default)(p),"."));var D=l(t,p.kind,b);if(D){if((P=D.call(t,p,m,f,g,v))===a)break;if(!1===P){if(!b){g.pop();continue}}else if(void 0!==P&&(u.push([m,P]),!b)){if(!(0,r.isNode)(P)){g.pop();continue}p=P}}}if(void 0===P&&S&&u.push([m,p]),b)g.pop();else n={inArray:c,index:h,keys:d,edits:u,prev:n},c=Array.isArray(p),d=c?p:null!==(C=i[p.kind])&&void 0!==C?C:[],h=-1,u=[],f&&v.push(f),f=p}while(void 0!==n);0!==u.length&&(y=u[u.length-1][1]);return y};var n,s=(n=i(8002))&&n.__esModule?n:{default:n},r=i(91807);var o={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]};var a=Object.freeze({});function l(e,t,i){var n=e[t];if(n){if(!i&&"function"==typeof n)return n;var s=i?n.leave:n.enter;if("function"==typeof s)return s}else{var r=i?e.leave:e.enter;if(r){if("function"==typeof r)return r;var o=r[t];if("function"==typeof o)return o}}}},27636:(e,t,i)=>{"use strict";i.d(t,{$_:()=>o,Vn:()=>a});var n=i(6589),s=i(83059),r={Name:[],Document:["definitions"],OperationDefinition:["name","variableDefinitions","directives","selectionSet"],VariableDefinition:["variable","type","defaultValue","directives"],Variable:["name"],SelectionSet:["selections"],Field:["alias","name","arguments","directives","selectionSet"],Argument:["name","value"],FragmentSpread:["name","directives"],InlineFragment:["typeCondition","directives","selectionSet"],FragmentDefinition:["name","variableDefinitions","typeCondition","directives","selectionSet"],IntValue:[],FloatValue:[],StringValue:[],BooleanValue:[],NullValue:[],EnumValue:[],ListValue:["values"],ObjectValue:["fields"],ObjectField:["name","value"],Directive:["name","arguments"],NamedType:["name"],ListType:["type"],NonNullType:["type"],SchemaDefinition:["description","directives","operationTypes"],OperationTypeDefinition:["type"],ScalarTypeDefinition:["description","name","directives"],ObjectTypeDefinition:["description","name","interfaces","directives","fields"],FieldDefinition:["description","name","arguments","type","directives"],InputValueDefinition:["description","name","type","defaultValue","directives"],InterfaceTypeDefinition:["description","name","interfaces","directives","fields"],UnionTypeDefinition:["description","name","directives","types"],EnumTypeDefinition:["description","name","directives","values"],EnumValueDefinition:["description","name","directives"],InputObjectTypeDefinition:["description","name","directives","fields"],DirectiveDefinition:["description","name","arguments","locations"],SchemaExtension:["directives","operationTypes"],ScalarTypeExtension:["name","directives"],ObjectTypeExtension:["name","interfaces","directives","fields"],InterfaceTypeExtension:["name","interfaces","directives","fields"],UnionTypeExtension:["name","directives","types"],EnumTypeExtension:["name","directives","values"],InputObjectTypeExtension:["name","directives","fields"]},o=Object.freeze({});function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r,a=void 0,c=Array.isArray(e),d=[e],h=-1,u=[],p=void 0,m=void 0,f=void 0,g=[],v=[],y=e;do{var b=++h===d.length,S=b&&0!==u.length;if(b){if(m=0===v.length?void 0:g[g.length-1],p=f,f=v.pop(),S){if(c)p=p.slice();else{for(var E={},T=0,w=Object.keys(p);T<w.length;T++){var x=w[T];E[x]=p[x]}p=E}for(var _=0,M=0;M<u.length;M++){var O=u[M][0],A=u[M][1];c&&(O-=_),c&&null===A?(p.splice(O,1),_++):p[O]=A}}h=a.index,d=a.keys,u=a.edits,c=a.inArray,a=a.prev}else{if(m=f?c?h:d[h]:void 0,null==(p=f?f[m]:y))continue;f&&g.push(m)}var C,P=void 0;if(!Array.isArray(p)){if(!(0,s.UG)(p))throw new Error("Invalid AST Node: ".concat((0,n.Z)(p),"."));var D=l(t,p.kind,b);if(D){if((P=D.call(t,p,m,f,g,v))===o)break;if(!1===P){if(!b){g.pop();continue}}else if(void 0!==P&&(u.push([m,P]),!b)){if(!(0,s.UG)(P)){g.pop();continue}p=P}}}if(void 0===P&&S&&u.push([m,p]),b)g.pop();else a={inArray:c,index:h,keys:d,edits:u,prev:a},d=(c=Array.isArray(p))?p:null!==(C=i[p.kind])&&void 0!==C?C:[],h=-1,u=[],f&&v.push(f),f=p}while(void 0!==a);return 0!==u.length&&(y=u[u.length-1][1]),y}function l(e,t,i){var n=e[t];if(n){if(!i&&"function"==typeof n)return n;var s=i?n.leave:n.enter;if("function"==typeof s)return s}else{var r=i?e.leave:e.enter;if(r){if("function"==typeof r)return r;var o=r[t];if("function"==typeof o)return o}}}},41405:(e,t,i)=>{"use strict";var n=i.g.Symbol,s=i(55419);e.exports=function(){return"function"==typeof n&&("function"==typeof Symbol&&("symbol"==typeof n("foo")&&("symbol"==typeof Symbol("bar")&&s())))}},55419:e=>{"use strict";e.exports=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var e={},t=Symbol("test"),i=Object(t);if("string"==typeof t)return!1;if("[object Symbol]"!==Object.prototype.toString.call(t))return!1;if("[object Symbol]"!==Object.prototype.toString.call(i))return!1;for(t in e[t]=42,e)return!1;if("function"==typeof Object.keys&&0!==Object.keys(e).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(e).length)return!1;var n=Object.getOwnPropertySymbols(e);if(1!==n.length||n[0]!==t)return!1;if(!Object.prototype.propertyIsEnumerable.call(e,t))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var s=Object.getOwnPropertyDescriptor(e,t);if(42!==s.value||!0!==s.enumerable)return!1}return!0}},17642:(e,t,i)=>{"use strict";var n=i(58612);e.exports=n.call(Function.call,Object.prototype.hasOwnProperty)},95320:e=>{"use strict";var t,i,n=Function.prototype.toString,s="object"==typeof Reflect&&null!==Reflect&&Reflect.apply;if("function"==typeof s&&"function"==typeof Object.defineProperty)try{t=Object.defineProperty({},"length",{get:function(){throw i}}),i={},s((function(){throw 42}),null,t)}catch(e){e!==i&&(s=null)}else s=null;var r=/^\s*class\b/,o=function(e){try{var t=n.call(e);return r.test(t)}catch(e){return!1}},a=Object.prototype.toString,l="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag;e.exports=s?function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;try{s(e,null,t)}catch(e){if(e!==i)return!1}return!o(e)}:function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if("function"==typeof e&&!e.prototype)return!0;if(l)return function(e){try{return!o(e)&&(n.call(e),!0)}catch(e){return!1}}(e);if(o(e))return!1;var t=a.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t}},84449:(e,t,i)=>{"use strict";i.r(t)},54078:(e,t,i)=>{"use strict";var n=i(94029),s=i(42473),r=i(17642),o=i(46057),a=function(e){s(!1,e)},l=String.prototype.replace,c=String.prototype.split,d="||||",h=function(e){var t=e%100,i=t%10;return 11!==t&&1===i?0:2<=i&&i<=4&&!(t>=12&&t<=14)?1:2},u={pluralTypes:{arabic:function(e){if(e<3)return e;var t=e%100;return t>=3&&t<=10?3:t>=11?4:5},bosnian_serbian:h,chinese:function(){return 0},croatian:h,french:function(e){return e>1?1:0},german:function(e){return 1!==e?1:0},russian:h,lithuanian:function(e){return e%10==1&&e%100!=11?0:e%10>=2&&e%10<=9&&(e%100<11||e%100>19)?1:2},czech:function(e){return 1===e?0:e>=2&&e<=4?1:2},polish:function(e){if(1===e)return 0;var t=e%10;return 2<=t&&t<=4&&(e%100<10||e%100>=20)?1:2},icelandic:function(e){return e%10!=1||e%100==11?1:0},slovenian:function(e){var t=e%100;return 1===t?0:2===t?1:3===t||4===t?2:3}},pluralTypeToLanguages:{arabic:["ar"],bosnian_serbian:["bs-Latn-BA","bs-Cyrl-BA","srl-RS","sr-RS"],chinese:["id","id-ID","ja","ko","ko-KR","lo","ms","th","th-TH","zh"],croatian:["hr","hr-HR"],german:["fa","da","de","en","es","fi","el","he","hi-IN","hu","hu-HU","it","nl","no","pt","sv","tr"],french:["fr","tl","pt-br"],russian:["ru","ru-RU"],lithuanian:["lt"],czech:["cs","cs-CZ","sk"],polish:["pl"],icelandic:["is"],slovenian:["sl-SL"]}};function p(e,t){var i,s,r=(i=e.pluralTypeToLanguages,s={},n(i,(function(e,t){n(e,(function(e){s[e]=t}))})),s);return r[t]||r[c.call(t,/-/,1)[0]]||r.en}function m(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}var f=/%\{(.*?)\}/g;function g(e,t,i,n,s){if("string"!=typeof e)throw new TypeError("Polyglot.transformPhrase expects argument #1 to be string");if(null==t)return e;var a=e,h=n||f,m=s||u,g="number"==typeof t?{smart_count:t}:t;if(null!=g.smart_count&&a){var v=c.call(a,d);a=o(v[function(e,t,i){return e.pluralTypes[p(e,t)](i)}(m,i||"en",g.smart_count)]||v[0])}return a=l.call(a,h,(function(e,t){return r(g,t)&&null!=g[t]?g[t]:e}))}function v(e){var t=e||{};this.phrases={},this.extend(t.phrases||{}),this.currentLocale=t.locale||"en";var i=t.allowMissing?g:null;this.onMissingKey="function"==typeof t.onMissingKey?t.onMissingKey:i,this.warn=t.warn||a,this.tokenRegex=function(e){var t=e&&e.prefix||"%{",i=e&&e.suffix||"}";if(t===d||i===d)throw new RangeError('"||||" token is reserved for pluralization');return new RegExp(m(t)+"(.*?)"+m(i),"g")}(t.interpolation),this.pluralRules=t.pluralRules||u}v.prototype.locale=function(e){return e&&(this.currentLocale=e),this.currentLocale},v.prototype.extend=function(e,t){n(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.extend(e,n):this.phrases[n]=e}),this)},v.prototype.unset=function(e,t){"string"==typeof e?delete this.phrases[e]:n(e,(function(e,i){var n=t?t+"."+i:i;"object"==typeof e?this.unset(e,n):delete this.phrases[n]}),this)},v.prototype.clear=function(){this.phrases={}},v.prototype.replace=function(e){this.clear(),this.extend(e)},v.prototype.t=function(e,t){var i,n,s=null==t?{}:t;if("string"==typeof this.phrases[e])i=this.phrases[e];else if("string"==typeof s._)i=s._;else if(this.onMissingKey){n=(0,this.onMissingKey)(e,s,this.currentLocale,this.tokenRegex,this.pluralRules)}else this.warn('Missing translation for key: "'+e+'"'),n=e;return"string"==typeof i&&(n=g(i,s,this.currentLocale,this.tokenRegex,this.pluralRules)),n},v.prototype.has=function(e){return r(this.phrases,e)},v.transformPhrase=function(e,t,i){return g(e,t,i)},e.exports=v},27418:e=>{"use strict";var t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;function s(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},i=0;i<10;i++)t["_"+String.fromCharCode(i)]=i;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var n={};return"abcdefghijklmnopqrst".split("").forEach((function(e){n[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},n)).join("")}catch(e){return!1}}()?Object.assign:function(e,r){for(var o,a,l=s(e),c=1;c<arguments.length;c++){for(var d in o=Object(arguments[c]))i.call(o,d)&&(l[d]=o[d]);if(t){a=t(o);for(var h=0;h<a.length;h++)n.call(o,a[h])&&(l[a[h]]=o[a[h]])}}return l}},18987:(e,t,i)=>{"use strict";var n;if(!Object.keys){var s=Object.prototype.hasOwnProperty,r=Object.prototype.toString,o=i(21414),a=Object.prototype.propertyIsEnumerable,l=!a.call({toString:null},"toString"),c=a.call((function(){}),"prototype"),d=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],h=function(e){var t=e.constructor;return t&&t.prototype===e},u={$applicationCache:!0,$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$onmozfullscreenchange:!0,$onmozfullscreenerror:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},p=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!u["$"+e]&&s.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{h(window[e])}catch(e){return!0}}catch(e){return!0}return!1}();n=function(e){var t=null!==e&&"object"==typeof e,i="[object Function]"===r.call(e),n=o(e),a=t&&"[object String]"===r.call(e),u=[];if(!t&&!i&&!n)throw new TypeError("Object.keys called on a non-object");var m=c&&i;if(a&&e.length>0&&!s.call(e,0))for(var f=0;f<e.length;++f)u.push(String(f));if(n&&e.length>0)for(var g=0;g<e.length;++g)u.push(String(g));else for(var v in e)m&&"prototype"===v||!s.call(e,v)||u.push(String(v));if(l)for(var y=function(e){if("undefined"==typeof window||!p)return h(e);try{return h(e)}catch(e){return!1}}(e),b=0;b<d.length;++b)y&&"constructor"===d[b]||!s.call(e,d[b])||u.push(d[b]);return u}}e.exports=n},82215:(e,t,i)=>{"use strict";var n=Array.prototype.slice,s=i(21414),r=Object.keys,o=r?function(e){return r(e)}:i(18987),a=Object.keys;o.shim=function(){Object.keys?function(){var e=Object.keys(arguments);return e&&e.length===arguments.length}(1,2)||(Object.keys=function(e){return s(e)?a(n.call(e)):a(e)}):Object.keys=o;return Object.keys||o},e.exports=o},21414:e=>{"use strict";var t=Object.prototype.toString;e.exports=function(e){var i=t.call(e),n="[object Arguments]"===i;return n||(n="[object Array]"!==i&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===t.call(e.callee)),n}},17141:(e,t,i)=>{var n;!function(s,r){var o={};function a(e){return function(){var t={method:e},i=Array.prototype.slice.call(arguments);/^get/.test(e)?(o.assert(i.length>0,"Get methods require a callback."),i.unshift(t)):(/^set/.test(e)&&(o.assert(0!==i.length,"Set methods require a value."),t.value=i[0]),i=[t]),this.send.apply(this,i)}}o.DEBUG=!1,o.VERSION="0.0.11",o.CONTEXT="player.js",o.POST_MESSAGE=!!s.postMessage,o.origin=function(e){return"//"===e.substr(0,2)&&(e=s.location.protocol+e),e.split("/").slice(0,3).join("/")},o.addEvent=function(e,t,i){e&&(e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent?e.attachEvent("on"+t,i):e["on"+t]=i)},o.log=function(){o.log.history=o.log.history||[],o.log.history.push(arguments),s.console&&o.DEBUG&&s.console.log(Array.prototype.slice.call(arguments))},o.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},o.isObject=function(e){return"[object Object]"===Object.prototype.toString.call(e)},o.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)},o.isNone=function(e){return null==e},o.has=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.indexOf=function(e,t){if(null==e)return-1;var i=0,n=e.length;if(Array.prototype.IndexOf&&e.indexOf===Array.prototype.IndexOf)return e.indexOf(t);for(;i<n;i++)if(e[i]===t)return i;return-1},o.assert=function(e,t){if(!e)throw t||"Player.js Assert Failed"},o.Keeper=function(){this.init()},o.Keeper.prototype.init=function(){this.data={}},o.Keeper.prototype.getUUID=function(){return"listener-xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},o.Keeper.prototype.has=function(e,t){if(!this.data.hasOwnProperty(e))return!1;if(o.isNone(t))return!0;for(var i=this.data[e],n=0;n<i.length;n++)if(i[n].id===t)return!0;return!1},o.Keeper.prototype.add=function(e,t,i,n,s){var r={id:e,event:t,cb:i,ctx:n,one:s};this.has(t)?this.data[t].push(r):this.data[t]=[r]},o.Keeper.prototype.execute=function(e,t,i,n){if(!this.has(e,t))return!1;for(var s=[],r=[],a=0;a<this.data[e].length;a++){var l=this.data[e][a];o.isNone(t)||!o.isNone(t)&&l.id===t?(r.push({cb:l.cb,ctx:l.ctx?l.ctx:n,data:i}),!1===l.one&&s.push(l)):s.push(l)}0===s.length?delete this.data[e]:this.data[e]=s;for(var c=0;c<r.length;c++){var d=r[c];d.cb.call(d.ctx,d.data)}},o.Keeper.prototype.on=function(e,t,i,n){this.add(e,t,i,n,!1)},o.Keeper.prototype.one=function(e,t,i,n){this.add(e,t,i,n,!0)},o.Keeper.prototype.off=function(e,t){var i=[];if(!this.data.hasOwnProperty(e))return i;for(var n=[],s=0;s<this.data[e].length;s++){var r=this.data[e][s];o.isNone(t)||r.cb===t?o.isNone(r.id)||i.push(r.id):n.push(r)}return 0===n.length?delete this.data[e]:this.data[e]=n,i},o.Player=function(e,t){if(!(this instanceof o.Player))return new o.Player(e,t);this.init(e,t)},o.EVENTS={READY:"ready",PLAY:"play",PAUSE:"pause",ENDED:"ended",TIMEUPDATE:"timeupdate",PROGRESS:"progress",ERROR:"error"},o.EVENTS.all=function(){var e=[];for(var t in o.EVENTS)o.has(o.EVENTS,t)&&o.isString(o.EVENTS[t])&&e.push(o.EVENTS[t]);return e},o.METHODS={PLAY:"play",PAUSE:"pause",GETPAUSED:"getPaused",MUTE:"mute",UNMUTE:"unmute",GETMUTED:"getMuted",SETVOLUME:"setVolume",GETVOLUME:"getVolume",GETDURATION:"getDuration",SETCURRENTTIME:"setCurrentTime",GETCURRENTTIME:"getCurrentTime",SETLOOP:"setLoop",GETLOOP:"getLoop",REMOVEEVENTLISTENER:"removeEventListener",ADDEVENTLISTENER:"addEventListener"},o.METHODS.all=function(){var e=[];for(var t in o.METHODS)o.has(o.METHODS,t)&&o.isString(o.METHODS[t])&&e.push(o.METHODS[t]);return e},o.READIED=[],o.Player.prototype.init=function(e,t){var i=this;o.isString(e)&&(e=r.getElementById(e)),this.elem=e,o.assert("IFRAME"===e.nodeName,'playerjs.Player constructor requires an Iframe, got "'+e.nodeName+'"'),o.assert(e.src,"playerjs.Player constructor requires a Iframe with a 'src' attribute."),this.origin=o.origin(e.src),this.keeper=new o.Keeper,this.isReady=!1,this.queue=[],this.events=o.EVENTS.all(),this.methods=o.METHODS.all(),o.POST_MESSAGE?o.addEvent(s,"message",(function(e){i.receive(e)})):o.log("Post Message is not Available."),o.indexOf(o.READIED,e.src)>-1?i.loaded=!0:this.elem.onload=function(){i.loaded=!0}},o.Player.prototype.send=function(e,t,i){if(e.context=o.CONTEXT,e.version=o.VERSION,t){var n=this.keeper.getUUID();e.listener=n,this.keeper.one(n,e.method,t,i)}return this.isReady||"ready"===e.value?(o.log("Player.send",e,this.origin),!0===this.loaded&&this.elem.contentWindow.postMessage(JSON.stringify(e),this.origin),!0):(o.log("Player.queue",e),this.queue.push(e),!1)},o.Player.prototype.receive=function(e){if(o.log("Player.receive",e),e.origin!==this.origin)return!1;var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==o.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src===this.elem.src&&this.ready(t),this.keeper.has(t.event,t.listener)&&this.keeper.execute(t.event,t.listener,t.value,this)},o.Player.prototype.ready=function(e){if(!0===this.isReady)return!1;e.value.events&&(this.events=e.value.events),e.value.methods&&(this.methods=e.value.methods),this.isReady=!0,this.loaded=!0;for(var t=0;t<this.queue.length;t++){var i=this.queue[t];o.log("Player.dequeue",i),"ready"===e.event&&this.keeper.execute(i.event,i.listener,!0,this),this.send(i)}this.queue=[]},o.Player.prototype.on=function(e,t,i){var n=this.keeper.getUUID();return"ready"===e?this.keeper.one(n,e,t,i):this.keeper.on(n,e,t,i),this.send({method:"addEventListener",value:e,listener:n}),!0},o.Player.prototype.off=function(e,t){var i=this.keeper.off(e,t);if(o.log("Player.off",i),i.length>0)for(var n in i)return this.send({method:"removeEventListener",value:e,listener:i[n]}),!0;return!1},o.Player.prototype.supports=function(e,t){o.assert(o.indexOf(["method","event"],e)>-1,'evtOrMethod needs to be either "event" or "method" got '+e),t=o.isArray(t)?t:[t];for(var i="event"===e?this.events:this.methods,n=0;n<t.length;n++)if(-1===o.indexOf(i,t[n]))return!1;return!0};for(var l=0,c=o.METHODS.all().length;l<c;l++){var d=o.METHODS.all()[l];o.Player.prototype.hasOwnProperty(d)||(o.Player.prototype[d]=a(d))}o.addEvent(s,"message",(function(e){var t;try{t=JSON.parse(e.data)}catch(e){return!1}if(t.context!==o.CONTEXT)return!1;"ready"===t.event&&t.value&&t.value.src&&o.READIED.push(t.value.src)})),o.Receiver=function(e,t){this.init(e,t)},o.Receiver.prototype.init=function(e,t){var i=this;this.isReady=!1,this.origin=o.origin(r.referrer),this.methods={},this.supported={events:e||o.EVENTS.all(),methods:t||o.METHODS.all()},this.eventListeners={},this.reject=!(s.self!==s.top&&o.POST_MESSAGE),this.reject||o.addEvent(s,"message",(function(e){i.receive(e)}))},o.Receiver.prototype.receive=function(e){if(e.origin!==this.origin)return!1;var t={};if(o.isObject(e.data))t=e.data;else try{t=s.JSON.parse(e.data)}catch(e){o.log("JSON Parse Error",e)}if(o.log("Receiver.receive",e,t),!t.method)return!1;if(t.context!==o.CONTEXT)return!1;if(-1===o.indexOf(o.METHODS.all(),t.method))return this.emit("error",{code:2,msg:'Invalid Method "'+t.method+'"'}),!1;var i=o.isNone(t.listener)?null:t.listener;if("addEventListener"===t.method)this.eventListeners.hasOwnProperty(t.value)?-1===o.indexOf(this.eventListeners[t.value],i)&&this.eventListeners[t.value].push(i):this.eventListeners[t.value]=[i],"ready"===t.value&&this.isReady&&this.ready();else if("removeEventListener"===t.method){if(this.eventListeners.hasOwnProperty(t.value)){var n=o.indexOf(this.eventListeners[t.value],i);n>-1&&this.eventListeners[t.value].splice(n,1),0===this.eventListeners[t.value].length&&delete this.eventListeners[t.value]}}else this.get(t.method,t.value,i)},o.Receiver.prototype.get=function(e,t,i){var n=this;if(!this.methods.hasOwnProperty(e))return this.emit("error",{code:3,msg:'Method Not Supported"'+e+'"'}),!1;var s=this.methods[e];if("get"===e.substr(0,3)){s.call(this,(function(t){n.send(e,t,i)}))}else s.call(this,t)},o.Receiver.prototype.on=function(e,t){this.methods[e]=t},o.Receiver.prototype.send=function(e,t,i){if(o.log("Receiver.send",e,t,i),this.reject)return o.log("Receiver.send.reject",e,t,i),!1;var n={context:o.CONTEXT,version:o.VERSION,event:e};o.isNone(t)||(n.value=t),o.isNone(i)||(n.listener=i);var r=JSON.stringify(n);s.parent.postMessage(r,""===this.origin?"*":this.origin)},o.Receiver.prototype.emit=function(e,t){if(!this.eventListeners.hasOwnProperty(e))return!1;o.log("Instance.emit",e,t,this.eventListeners[e]);for(var i=0;i<this.eventListeners[e].length;i++){var n=this.eventListeners[e][i];this.send(e,t,n)}return!0},o.Receiver.prototype.ready=function(){o.log("Receiver.ready"),this.isReady=!0;var e={src:s.location.toString(),events:this.supported.events,methods:this.supported.methods};this.emit("ready",e)||this.send("ready",e)},o.HTML5Adapter=function(e){if(!(this instanceof o.HTML5Adapter))return new o.HTML5Adapter(e);this.init(e)},o.HTML5Adapter.prototype.init=function(e){o.assert(e,"playerjs.HTML5Adapter requires a video element");var t=this.receiver=new o.Receiver;e.addEventListener("playing",(function(){t.emit("play")})),e.addEventListener("pause",(function(){t.emit("pause")})),e.addEventListener("ended",(function(){t.emit("ended")})),e.addEventListener("timeupdate",(function(){t.emit("timeupdate",{seconds:e.currentTime,duration:e.duration})})),e.addEventListener("progress",(function(){t.emit("buffered",{percent:e.buffered.length})})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(100*e.volume)})),t.on("setVolume",(function(t){e.volume=t/100})),t.on("mute",(function(){e.muted=!0})),t.on("unmute",(function(){e.muted=!1})),t.on("getMuted",(function(t){t(e.muted)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},o.HTML5Adapter.prototype.ready=function(){this.receiver.ready()},o.JWPlayerAdapter=function(e){if(!(this instanceof o.JWPlayerAdapter))return new o.JWPlayerAdapter(e);this.init(e)},o.JWPlayerAdapter.prototype.init=function(e){o.assert(e,"playerjs.JWPlayerAdapter requires a player object");var t=this.receiver=new o.Receiver;this.looped=!1,e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("time",(function(e){var i=e.position,n=e.duration;if(!i||!n)return!1;var s={seconds:i,duration:n};t.emit("timeupdate",s)}));var i=this;e.on("complete",(function(){!0===i.looped?e.seek(0):t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play(!0)})),t.on("pause",(function(){e.pause(!0)})),t.on("getPaused",(function(t){t(e.getState().toLowerCase()!=="PLAYING".toLowerCase())})),t.on("getCurrentTime",(function(t){t(e.getPosition())})),t.on("setCurrentTime",(function(t){e.seek(t)})),t.on("getDuration",(function(t){t(e.getDuration())})),t.on("getVolume",(function(t){t(e.getVolume())})),t.on("setVolume",(function(t){e.setVolume(t)})),t.on("mute",(function(){e.setMute(!0)})),t.on("unmute",(function(){e.setMute(!1)})),t.on("getMuted",(function(t){t(!0===e.getMute())})),t.on("getLoop",(function(e){e(this.looped)}),this),t.on("setLoop",(function(e){this.looped=e}),this)},o.JWPlayerAdapter.prototype.ready=function(){this.receiver.ready()},o.MockAdapter=function(){if(!(this instanceof o.MockAdapter))return new o.MockAdapter;this.init()},o.MockAdapter.prototype.init=function(){var e={duration:20,currentTime:0,interval:null,timeupdate:function(){},volume:100,mute:!1,playing:!1,loop:!1,play:function(){e.interval=setInterval((function(){e.currentTime+=.25,e.timeupdate({seconds:e.currentTime,duration:e.duration})}),250),e.playing=!0},pause:function(){clearInterval(e.interval),e.playing=!1}},t=this.receiver=new o.Receiver;t.on("play",(function(){var t=this;e.play(),this.emit("play"),e.timeupdate=function(e){t.emit("timeupdate",e)}})),t.on("pause",(function(){e.pause(),this.emit("pause")})),t.on("getPaused",(function(t){t(!e.playing)})),t.on("getCurrentTime",(function(t){t(e.currentTime)})),t.on("setCurrentTime",(function(t){e.currentTime=t})),t.on("getDuration",(function(t){t(e.duration)})),t.on("getVolume",(function(t){t(e.volume)})),t.on("setVolume",(function(t){e.volume=t})),t.on("mute",(function(){e.mute=!0})),t.on("unmute",(function(){e.mute=!1})),t.on("getMuted",(function(t){t(e.mute)})),t.on("getLoop",(function(t){t(e.loop)})),t.on("setLoop",(function(t){e.loop=t}))},o.MockAdapter.prototype.ready=function(){this.receiver.ready()},o.VideoJSAdapter=function(e){if(!(this instanceof o.VideoJSAdapter))return new o.VideoJSAdapter(e);this.init(e)},o.VideoJSAdapter.prototype.init=function(e){o.assert(e,"playerjs.VideoJSReceiver requires a player object");var t=this.receiver=new o.Receiver;e.on("pause",(function(){t.emit("pause")})),e.on("play",(function(){t.emit("play")})),e.on("timeupdate",(function(i){var n=e.currentTime(),s=e.duration();if(!n||!s)return!1;var r={seconds:n,duration:s};t.emit("timeupdate",r)})),e.on("ended",(function(){t.emit("ended")})),e.on("error",(function(){t.emit("error")})),t.on("play",(function(){e.play()})),t.on("pause",(function(){e.pause()})),t.on("getPaused",(function(t){t(e.paused())})),t.on("getCurrentTime",(function(t){t(e.currentTime())})),t.on("setCurrentTime",(function(t){e.currentTime(t)})),t.on("getDuration",(function(t){t(e.duration())})),t.on("getVolume",(function(t){t(100*e.volume())})),t.on("setVolume",(function(t){e.volume(t/100)})),t.on("mute",(function(){e.volume(0)})),t.on("unmute",(function(){e.volume(1)})),t.on("getMuted",(function(t){t(0===e.volume())})),t.on("getLoop",(function(t){t(e.loop())})),t.on("setLoop",(function(t){e.loop(t)}))},o.VideoJSAdapter.prototype.ready=function(){this.receiver.ready()},void 0===(n=function(){return o}.call(t,i,t,e))||(e.exports=n)}(window,document)},64448:(e,t,i)=>{"use strict";var n=i(67294),s=i(27418),r=i(63840);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!n)throw Error(o(227));var a=new Set,l={};function c(e,t){d(e,t),d(e+"Capture",t)}function d(e,t){for(l[e]=t,e=0;e<t.length;e++)a.add(t[e])}var h=!("undefined"==typeof window||void 0===window.document||void 0===window.document.createElement),u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p=Object.prototype.hasOwnProperty,m={},f={};function g(e,t,i,n,s,r,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=i,this.propertyName=e,this.type=t,this.sanitizeURL=r,this.removeEmptyString=o}var v={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){v[e]=new g(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];v[t]=new g(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){v[e]=new g(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){v[e]=new g(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){v[e]=new g(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){v[e]=new g(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){v[e]=new g(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){v[e]=new g(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){v[e]=new g(e,5,!1,e.toLowerCase(),null,!1,!1)}));var y=/[\-:]([a-z])/g;function b(e){return e[1].toUpperCase()}function S(e,t,i,n){var s=v.hasOwnProperty(t)?v[t]:null;(null!==s?0===s.type:!n&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,i,n){if(null==t||function(e,t,i,n){if(null!==i&&0===i.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==i?!i.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,i,n))return!0;if(n)return!1;if(null!==i)switch(i.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,i,s,n)&&(i=null),n||null===s?function(e){return!!p.call(f,e)||!p.call(m,e)&&(u.test(e)?f[e]=!0:(m[e]=!0,!1))}(t)&&(null===i?e.removeAttribute(t):e.setAttribute(t,""+i)):s.mustUseProperty?e[s.propertyName]=null===i?3!==s.type&&"":i:(t=s.attributeName,n=s.attributeNamespace,null===i?e.removeAttribute(t):(i=3===(s=s.type)||4===s&&!0===i?"":""+i,n?e.setAttributeNS(n,t,i):e.setAttribute(t,i))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(y,b);v[t]=new g(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(y,b);v[t]=new g(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(y,b);v[t]=new g(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){v[e]=new g(e,1,!1,e.toLowerCase(),null,!1,!1)})),v.xlinkHref=new g("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){v[e]=new g(e,1,!1,e.toLowerCase(),null,!0,!0)}));var E=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,T=60103,w=60106,x=60107,_=60108,M=60114,O=60109,A=60110,C=60112,P=60113,D=60120,N=60115,I=60116,L=60121,R=60128,k=60129,U=60130,B=60131;if("function"==typeof Symbol&&Symbol.for){var F=Symbol.for;T=F("react.element"),w=F("react.portal"),x=F("react.fragment"),_=F("react.strict_mode"),M=F("react.profiler"),O=F("react.provider"),A=F("react.context"),C=F("react.forward_ref"),P=F("react.suspense"),D=F("react.suspense_list"),N=F("react.memo"),I=F("react.lazy"),L=F("react.block"),F("react.scope"),R=F("react.opaque.id"),k=F("react.debug_trace_mode"),U=F("react.offscreen"),B=F("react.legacy_hidden")}var V,H="function"==typeof Symbol&&Symbol.iterator;function j(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=H&&e[H]||e["@@iterator"])?e:null}function G(e){if(void 0===V)try{throw Error()}catch(e){var t=e.stack.trim().match(/\n( *(at )?)/);V=t&&t[1]||""}return"\n"+V+e}var z=!1;function W(e,t){if(!e||z)return"";z=!0;var i=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"==typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(e){var n=e}Reflect.construct(e,[],t)}else{try{t.call()}catch(e){n=e}e.call(t.prototype)}else{try{throw Error()}catch(e){n=e}e()}}catch(e){if(e&&n&&"string"==typeof e.stack){for(var s=e.stack.split("\n"),r=n.stack.split("\n"),o=s.length-1,a=r.length-1;1<=o&&0<=a&&s[o]!==r[a];)a--;for(;1<=o&&0<=a;o--,a--)if(s[o]!==r[a]){if(1!==o||1!==a)do{if(o--,0>--a||s[o]!==r[a])return"\n"+s[o].replace(" at new "," at ")}while(1<=o&&0<=a);break}}}finally{z=!1,Error.prepareStackTrace=i}return(e=e?e.displayName||e.name:"")?G(e):""}function K(e){switch(e.tag){case 5:return G(e.type);case 16:return G("Lazy");case 13:return G("Suspense");case 19:return G("SuspenseList");case 0:case 2:case 15:return e=W(e.type,!1);case 11:return e=W(e.type.render,!1);case 22:return e=W(e.type._render,!1);case 1:return e=W(e.type,!0);default:return""}}function Y(e){if(null==e)return null;if("function"==typeof e)return e.displayName||e.name||null;if("string"==typeof e)return e;switch(e){case x:return"Fragment";case w:return"Portal";case M:return"Profiler";case _:return"StrictMode";case P:return"Suspense";case D:return"SuspenseList"}if("object"==typeof e)switch(e.$$typeof){case A:return(e.displayName||"Context")+".Consumer";case O:return(e._context.displayName||"Context")+".Provider";case C:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case N:return Y(e.type);case L:return Y(e._render);case I:t=e._payload,e=e._init;try{return Y(e(t))}catch(e){}}return null}function q(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function Z(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function $(e){e._valueTracker||(e._valueTracker=function(e){var t=Z(e)?"checked":"value",i=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&void 0!==i&&"function"==typeof i.get&&"function"==typeof i.set){var s=i.get,r=i.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(e){n=""+e,r.call(this,e)}}),Object.defineProperty(e,t,{enumerable:i.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var i=t.getValue(),n="";return e&&(n=Z(e)?e.checked?"true":"false":e.value),(e=n)!==i&&(t.setValue(e),!0)}function X(e){if(void 0===(e=e||("undefined"!=typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function J(e,t){var i=t.checked;return s({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=i?i:e._wrapperState.initialChecked})}function ee(e,t){var i=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;i=q(null!=t.value?t.value:i),e._wrapperState={initialChecked:n,initialValue:i,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function te(e,t){null!=(t=t.checked)&&S(e,"checked",t,!1)}function ie(e,t){te(e,t);var i=q(t.value),n=t.type;if(null!=i)"number"===n?(0===i&&""===e.value||e.value!=i)&&(e.value=""+i):e.value!==""+i&&(e.value=""+i);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?se(e,t.type,i):t.hasOwnProperty("defaultValue")&&se(e,t.type,q(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function ne(e,t,i){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,i||t===e.value||(e.value=t),e.defaultValue=t}""!==(i=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==i&&(e.name=i)}function se(e,t,i){"number"===t&&X(e.ownerDocument)===e||(null==i?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+i&&(e.defaultValue=""+i))}function re(e,t){return e=s({children:void 0},t),(t=function(e){var t="";return n.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function oe(e,t,i,n){if(e=e.options,t){t={};for(var s=0;s<i.length;s++)t["$"+i[s]]=!0;for(i=0;i<e.length;i++)s=t.hasOwnProperty("$"+e[i].value),e[i].selected!==s&&(e[i].selected=s),s&&n&&(e[i].defaultSelected=!0)}else{for(i=""+q(i),t=null,s=0;s<e.length;s++){if(e[s].value===i)return e[s].selected=!0,void(n&&(e[s].defaultSelected=!0));null!==t||e[s].disabled||(t=e[s])}null!==t&&(t.selected=!0)}}function ae(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return s({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function le(e,t){var i=t.value;if(null==i){if(i=t.children,t=t.defaultValue,null!=i){if(null!=t)throw Error(o(92));if(Array.isArray(i)){if(!(1>=i.length))throw Error(o(93));i=i[0]}t=i}null==t&&(t=""),i=t}e._wrapperState={initialValue:q(i)}}function ce(e,t){var i=q(t.value),n=q(t.defaultValue);null!=i&&((i=""+i)!==e.value&&(e.value=i),null==t.defaultValue&&e.defaultValue!==i&&(e.defaultValue=i)),null!=n&&(e.defaultValue=""+n)}function de(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var he="http://www.w3.org/1999/xhtml",ue="http://www.w3.org/2000/svg";function pe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function me(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?pe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var fe,ge,ve=(ge=function(e,t){if(e.namespaceURI!==ue||"innerHTML"in e)e.innerHTML=t;else{for((fe=fe||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=fe.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!=typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,i,n){MSApp.execUnsafeLocalFunction((function(){return ge(e,t)}))}:ge);function ye(e,t){if(t){var i=e.firstChild;if(i&&i===e.lastChild&&3===i.nodeType)return void(i.nodeValue=t)}e.textContent=t}var be={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Se=["Webkit","ms","Moz","O"];function Ee(e,t,i){return null==t||"boolean"==typeof t||""===t?"":i||"number"!=typeof t||0===t||be.hasOwnProperty(e)&&be[e]?(""+t).trim():t+"px"}function Te(e,t){for(var i in e=e.style,t)if(t.hasOwnProperty(i)){var n=0===i.indexOf("--"),s=Ee(i,t[i],n);"float"===i&&(i="cssFloat"),n?e.setProperty(i,s):e[i]=s}}Object.keys(be).forEach((function(e){Se.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),be[t]=be[e]}))}));var we=s({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xe(e,t){if(t){if(we[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!=typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!=typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"==typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}function Me(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Oe=null,Ae=null,Ce=null;function Pe(e){if(e=es(e)){if("function"!=typeof Oe)throw Error(o(280));var t=e.stateNode;t&&(t=is(t),Oe(e.stateNode,e.type,t))}}function De(e){Ae?Ce?Ce.push(e):Ce=[e]:Ae=e}function Ne(){if(Ae){var e=Ae,t=Ce;if(Ce=Ae=null,Pe(e),t)for(e=0;e<t.length;e++)Pe(t[e])}}function Ie(e,t){return e(t)}function Le(e,t,i,n,s){return e(t,i,n,s)}function Re(){}var ke=Ie,Ue=!1,Be=!1;function Fe(){null===Ae&&null===Ce||(Re(),Ne())}function Ve(e,t){var i=e.stateNode;if(null===i)return null;var n=is(i);if(null===n)return null;i=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(i&&"function"!=typeof i)throw Error(o(231,t,typeof i));return i}var He=!1;if(h)try{var je={};Object.defineProperty(je,"passive",{get:function(){He=!0}}),window.addEventListener("test",je,je),window.removeEventListener("test",je,je)}catch(ge){He=!1}function Ge(e,t,i,n,s,r,o,a,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(i,c)}catch(e){this.onError(e)}}var ze=!1,We=null,Ke=!1,Ye=null,qe={onError:function(e){ze=!0,We=e}};function Ze(e,t,i,n,s,r,o,a,l){ze=!1,We=null,Ge.apply(qe,arguments)}function $e(e){var t=e,i=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!=(1026&(t=e).flags)&&(i=t.return),e=t.return}while(e)}return 3===t.tag?i:null}function Qe(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Xe(e){if($e(e)!==e)throw Error(o(188))}function Je(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=$e(e)))throw Error(o(188));return t!==e?null:e}for(var i=e,n=t;;){var s=i.return;if(null===s)break;var r=s.alternate;if(null===r){if(null!==(n=s.return)){i=n;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===i)return Xe(s),e;if(r===n)return Xe(s),t;r=r.sibling}throw Error(o(188))}if(i.return!==n.return)i=s,n=r;else{for(var a=!1,l=s.child;l;){if(l===i){a=!0,i=s,n=r;break}if(l===n){a=!0,n=s,i=r;break}l=l.sibling}if(!a){for(l=r.child;l;){if(l===i){a=!0,i=r,n=s;break}if(l===n){a=!0,n=r,i=s;break}l=l.sibling}if(!a)throw Error(o(189))}}if(i.alternate!==n)throw Error(o(190))}if(3!==i.tag)throw Error(o(188));return i.stateNode.current===i?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function et(e,t){for(var i=e.alternate;null!==t;){if(t===e||t===i)return!0;t=t.return}return!1}var tt,it,nt,st,rt=!1,ot=[],at=null,lt=null,ct=null,dt=new Map,ht=new Map,ut=[],pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function mt(e,t,i,n,s){return{blockedOn:e,domEventName:t,eventSystemFlags:16|i,nativeEvent:s,targetContainers:[n]}}function ft(e,t){switch(e){case"focusin":case"focusout":at=null;break;case"dragenter":case"dragleave":lt=null;break;case"mouseover":case"mouseout":ct=null;break;case"pointerover":case"pointerout":dt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":ht.delete(t.pointerId)}}function gt(e,t,i,n,s,r){return null===e||e.nativeEvent!==r?(e=mt(t,i,n,s,r),null!==t&&(null!==(t=es(t))&&it(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==s&&-1===t.indexOf(s)&&t.push(s),e)}function vt(e){var t=Jn(e.target);if(null!==t){var i=$e(t);if(null!==i)if(13===(t=i.tag)){if(null!==(t=Qe(i)))return e.blockedOn=t,void st(e.lanePriority,(function(){r.unstable_runWithPriority(e.priority,(function(){nt(i)}))}))}else if(3===t&&i.stateNode.hydrate)return void(e.blockedOn=3===i.tag?i.stateNode.containerInfo:null)}e.blockedOn=null}function yt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var i=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i)return null!==(t=es(i))&&it(t),e.blockedOn=i,!1;t.shift()}return!0}function bt(e,t,i){yt(e)&&i.delete(t)}function St(){for(rt=!1;0<ot.length;){var e=ot[0];if(null!==e.blockedOn){null!==(e=es(e.blockedOn))&&tt(e);break}for(var t=e.targetContainers;0<t.length;){var i=Jt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==i){e.blockedOn=i;break}t.shift()}null===e.blockedOn&&ot.shift()}null!==at&&yt(at)&&(at=null),null!==lt&&yt(lt)&&(lt=null),null!==ct&&yt(ct)&&(ct=null),dt.forEach(bt),ht.forEach(bt)}function Et(e,t){e.blockedOn===t&&(e.blockedOn=null,rt||(rt=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,St)))}function Tt(e){function t(t){return Et(t,e)}if(0<ot.length){Et(ot[0],e);for(var i=1;i<ot.length;i++){var n=ot[i];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==at&&Et(at,e),null!==lt&&Et(lt,e),null!==ct&&Et(ct,e),dt.forEach(t),ht.forEach(t),i=0;i<ut.length;i++)(n=ut[i]).blockedOn===e&&(n.blockedOn=null);for(;0<ut.length&&null===(i=ut[0]).blockedOn;)vt(i),null===i.blockedOn&&ut.shift()}function wt(e,t){var i={};return i[e.toLowerCase()]=t.toLowerCase(),i["Webkit"+e]="webkit"+t,i["Moz"+e]="moz"+t,i}var xt={animationend:wt("Animation","AnimationEnd"),animationiteration:wt("Animation","AnimationIteration"),animationstart:wt("Animation","AnimationStart"),transitionend:wt("Transition","TransitionEnd")},_t={},Mt={};function Ot(e){if(_t[e])return _t[e];if(!xt[e])return e;var t,i=xt[e];for(t in i)if(i.hasOwnProperty(t)&&t in Mt)return _t[e]=i[t];return e}h&&(Mt=document.createElement("div").style,"AnimationEvent"in window||(delete xt.animationend.animation,delete xt.animationiteration.animation,delete xt.animationstart.animation),"TransitionEvent"in window||delete xt.transitionend.transition);var At=Ot("animationend"),Ct=Ot("animationiteration"),Pt=Ot("animationstart"),Dt=Ot("transitionend"),Nt=new Map,It=new Map,Lt=["abort","abort",At,"animationEnd",Ct,"animationIteration",Pt,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Dt,"transitionEnd","waiting","waiting"];function Rt(e,t){for(var i=0;i<e.length;i+=2){var n=e[i],s=e[i+1];s="on"+(s[0].toUpperCase()+s.slice(1)),It.set(n,t),Nt.set(n,s),c(s,[n])}}(0,r.unstable_now)();var kt=8;function Ut(e){if(0!=(1&e))return kt=15,1;if(0!=(2&e))return kt=14,2;if(0!=(4&e))return kt=13,4;var t=24&e;return 0!==t?(kt=12,t):0!=(32&e)?(kt=11,32):0!==(t=192&e)?(kt=10,t):0!=(256&e)?(kt=9,256):0!==(t=3584&e)?(kt=8,t):0!=(4096&e)?(kt=7,4096):0!==(t=4186112&e)?(kt=6,t):0!==(t=62914560&e)?(kt=5,t):67108864&e?(kt=4,67108864):0!=(134217728&e)?(kt=3,134217728):0!==(t=805306368&e)?(kt=2,t):0!=(1073741824&e)?(kt=1,1073741824):(kt=8,e)}function Bt(e,t){var i=e.pendingLanes;if(0===i)return kt=0;var n=0,s=0,r=e.expiredLanes,o=e.suspendedLanes,a=e.pingedLanes;if(0!==r)n=r,s=kt=15;else if(0!==(r=134217727&i)){var l=r&~o;0!==l?(n=Ut(l),s=kt):0!==(a&=r)&&(n=Ut(a),s=kt)}else 0!==(r=i&~o)?(n=Ut(r),s=kt):0!==a&&(n=Ut(a),s=kt);if(0===n)return 0;if(n=i&((0>(n=31-zt(n))?0:1<<n)<<1)-1,0!==t&&t!==n&&0==(t&o)){if(Ut(t),s<=kt)return t;kt=s}if(0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)s=1<<(i=31-zt(t)),n|=e[i],t&=~s;return n}function Ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function Vt(e,t){switch(e){case 15:return 1;case 14:return 2;case 12:return 0===(e=Ht(24&~t))?Vt(10,t):e;case 10:return 0===(e=Ht(192&~t))?Vt(8,t):e;case 8:return 0===(e=Ht(3584&~t))&&(0===(e=Ht(4186112&~t))&&(e=512)),e;case 2:return 0===(t=Ht(805306368&~t))&&(t=268435456),t}throw Error(o(358,e))}function Ht(e){return e&-e}function jt(e){for(var t=[],i=0;31>i;i++)t.push(e);return t}function Gt(e,t,i){e.pendingLanes|=t;var n=t-1;e.suspendedLanes&=n,e.pingedLanes&=n,(e=e.eventTimes)[t=31-zt(t)]=i}var zt=Math.clz32?Math.clz32:function(e){return 0===e?32:31-(Wt(e)/Kt|0)|0},Wt=Math.log,Kt=Math.LN2;var Yt=r.unstable_UserBlockingPriority,qt=r.unstable_runWithPriority,Zt=!0;function $t(e,t,i,n){Ue||Re();var s=Xt,r=Ue;Ue=!0;try{Le(s,e,t,i,n)}finally{(Ue=r)||Fe()}}function Qt(e,t,i,n){qt(Yt,Xt.bind(null,e,t,i,n))}function Xt(e,t,i,n){var s;if(Zt)if((s=0==(4&t))&&0<ot.length&&-1<pt.indexOf(e))e=mt(null,e,t,i,n),ot.push(e);else{var r=Jt(e,t,i,n);if(null===r)s&&ft(e,n);else{if(s){if(-1<pt.indexOf(e))return e=mt(r,e,t,i,n),void ot.push(e);if(function(e,t,i,n,s){switch(t){case"focusin":return at=gt(at,e,t,i,n,s),!0;case"dragenter":return lt=gt(lt,e,t,i,n,s),!0;case"mouseover":return ct=gt(ct,e,t,i,n,s),!0;case"pointerover":var r=s.pointerId;return dt.set(r,gt(dt.get(r)||null,e,t,i,n,s)),!0;case"gotpointercapture":return r=s.pointerId,ht.set(r,gt(ht.get(r)||null,e,t,i,n,s)),!0}return!1}(r,e,t,i,n))return;ft(e,n)}Nn(e,t,n,null,i)}}}function Jt(e,t,i,n){var s=Me(n);if(null!==(s=Jn(s))){var r=$e(s);if(null===r)s=null;else{var o=r.tag;if(13===o){if(null!==(s=Qe(r)))return s;s=null}else if(3===o){if(r.stateNode.hydrate)return 3===r.tag?r.stateNode.containerInfo:null;s=null}else r!==s&&(s=null)}}return Nn(e,t,n,s,i),null}var ei=null,ti=null,ii=null;function ni(){if(ii)return ii;var e,t,i=ti,n=i.length,s="value"in ei?ei.value:ei.textContent,r=s.length;for(e=0;e<n&&i[e]===s[e];e++);var o=n-e;for(t=1;t<=o&&i[n-t]===s[r-t];t++);return ii=s.slice(e,1<t?1-t:void 0)}function si(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function ri(){return!0}function oi(){return!1}function ai(e){function t(t,i,n,s,r){for(var o in this._reactName=t,this._targetInst=n,this.type=i,this.nativeEvent=s,this.target=r,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(s):s[o]);return this.isDefaultPrevented=(null!=s.defaultPrevented?s.defaultPrevented:!1===s.returnValue)?ri:oi,this.isPropagationStopped=oi,this}return s(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!=typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=ri)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!=typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=ri)},persist:function(){},isPersistent:ri}),t}var li,ci,di,hi={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ui=ai(hi),pi=s({},hi,{view:0,detail:0}),mi=ai(pi),fi=s({},pi,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Mi,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==di&&(di&&"mousemove"===e.type?(li=e.screenX-di.screenX,ci=e.screenY-di.screenY):ci=li=0,di=e),li)},movementY:function(e){return"movementY"in e?e.movementY:ci}}),gi=ai(fi),vi=ai(s({},fi,{dataTransfer:0})),yi=ai(s({},pi,{relatedTarget:0})),bi=ai(s({},hi,{animationName:0,elapsedTime:0,pseudoElement:0})),Si=ai(s({},hi,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),Ei=ai(s({},hi,{data:0})),Ti={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wi={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},xi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function _i(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=xi[e])&&!!t[e]}function Mi(){return _i}var Oi=ai(s({},pi,{key:function(e){if(e.key){var t=Ti[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=si(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wi[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Mi,charCode:function(e){return"keypress"===e.type?si(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?si(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),Ai=ai(s({},fi,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Ci=ai(s({},pi,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Mi})),Pi=ai(s({},hi,{propertyName:0,elapsedTime:0,pseudoElement:0})),Di=ai(s({},fi,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),Ni=[9,13,27,32],Ii=h&&"CompositionEvent"in window,Li=null;h&&"documentMode"in document&&(Li=document.documentMode);var Ri=h&&"TextEvent"in window&&!Li,ki=h&&(!Ii||Li&&8<Li&&11>=Li),Ui=String.fromCharCode(32),Bi=!1;function Fi(e,t){switch(e){case"keyup":return-1!==Ni.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vi(e){return"object"==typeof(e=e.detail)&&"data"in e?e.data:null}var Hi=!1;var ji={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Gi(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!ji[e.type]:"textarea"===t}function zi(e,t,i,n){De(n),0<(t=Ln(t,"onChange")).length&&(i=new ui("onChange","change",null,i,n),e.push({event:i,listeners:t}))}var Wi=null,Ki=null;function Yi(e){Mn(e,0)}function qi(e){if(Q(ts(e)))return e}function Zi(e,t){if("change"===e)return t}var $i=!1;if(h){var Qi;if(h){var Xi="oninput"in document;if(!Xi){var Ji=document.createElement("div");Ji.setAttribute("oninput","return;"),Xi="function"==typeof Ji.oninput}Qi=Xi}else Qi=!1;$i=Qi&&(!document.documentMode||9<document.documentMode)}function en(){Wi&&(Wi.detachEvent("onpropertychange",tn),Ki=Wi=null)}function tn(e){if("value"===e.propertyName&&qi(Ki)){var t=[];if(zi(t,Ki,e,Me(e)),e=Yi,Ue)e(t);else{Ue=!0;try{Ie(e,t)}finally{Ue=!1,Fe()}}}}function nn(e,t,i){"focusin"===e?(en(),Ki=i,(Wi=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function sn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return qi(Ki)}function rn(e,t){if("click"===e)return qi(t)}function on(e,t){if("input"===e||"change"===e)return qi(t)}var an="function"==typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e==1/t)||e!=e&&t!=t},ln=Object.prototype.hasOwnProperty;function cn(e,t){if(an(e,t))return!0;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return!1;var i=Object.keys(e),n=Object.keys(t);if(i.length!==n.length)return!1;for(n=0;n<i.length;n++)if(!ln.call(t,i[n])||!an(e[i[n]],t[i[n]]))return!1;return!0}function dn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function hn(e,t){var i,n=dn(e);for(e=0;n;){if(3===n.nodeType){if(i=e+n.textContent.length,e<=t&&i>=t)return{node:n,offset:t-e};e=i}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=dn(n)}}function un(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?un(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function pn(){for(var e=window,t=X();t instanceof e.HTMLIFrameElement;){try{var i="string"==typeof t.contentWindow.location.href}catch(e){i=!1}if(!i)break;t=X((e=t.contentWindow).document)}return t}function mn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var fn=h&&"documentMode"in document&&11>=document.documentMode,gn=null,vn=null,yn=null,bn=!1;function Sn(e,t,i){var n=i.window===i?i.document:9===i.nodeType?i:i.ownerDocument;bn||null==gn||gn!==X(n)||("selectionStart"in(n=gn)&&mn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&cn(yn,n)||(yn=n,0<(n=Ln(vn,"onSelect")).length&&(t=new ui("onSelect","select",null,t,i),e.push({event:t,listeners:n}),t.target=gn)))}Rt("cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focusin focus focusout blur input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Rt("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Rt(Lt,2);for(var En="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Tn=0;Tn<En.length;Tn++)It.set(En[Tn],0);d("onMouseEnter",["mouseout","mouseover"]),d("onMouseLeave",["mouseout","mouseover"]),d("onPointerEnter",["pointerout","pointerover"]),d("onPointerLeave",["pointerout","pointerover"]),c("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),c("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),c("onBeforeInput",["compositionend","keypress","textInput","paste"]),c("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),c("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var wn="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),xn=new Set("cancel close invalid load scroll toggle".split(" ").concat(wn));function _n(e,t,i){var n=e.type||"unknown-event";e.currentTarget=i,function(e,t,i,n,s,r,a,l,c){if(Ze.apply(this,arguments),ze){if(!ze)throw Error(o(198));var d=We;ze=!1,We=null,Ke||(Ke=!0,Ye=d)}}(n,t,void 0,e),e.currentTarget=null}function Mn(e,t){t=0!=(4&t);for(var i=0;i<e.length;i++){var n=e[i],s=n.event;n=n.listeners;e:{var r=void 0;if(t)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==r&&s.isPropagationStopped())break e;_n(s,a,c),r=l}else for(o=0;o<n.length;o++){if(l=(a=n[o]).instance,c=a.currentTarget,a=a.listener,l!==r&&s.isPropagationStopped())break e;_n(s,a,c),r=l}}}if(Ke)throw e=Ye,Ke=!1,Ye=null,e}function On(e,t){var i=ns(t),n=e+"__bubble";i.has(n)||(Dn(t,e,2,!1),i.add(n))}var An="_reactListening"+Math.random().toString(36).slice(2);function Cn(e){e[An]||(e[An]=!0,a.forEach((function(t){xn.has(t)||Pn(t,!1,e,null),Pn(t,!0,e,null)})))}function Pn(e,t,i,n){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=i;if("selectionchange"===e&&9!==i.nodeType&&(r=i.ownerDocument),null!==n&&!t&&xn.has(e)){if("scroll"!==e)return;s|=2,r=n}var o=ns(r),a=e+"__"+(t?"capture":"bubble");o.has(a)||(t&&(s|=4),Dn(r,e,s,t),o.add(a))}function Dn(e,t,i,n){var s=It.get(t);switch(void 0===s?2:s){case 0:s=$t;break;case 1:s=Qt;break;default:s=Xt}i=s.bind(null,t,i,e),s=void 0,!He||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(s=!0),n?void 0!==s?e.addEventListener(t,i,{capture:!0,passive:s}):e.addEventListener(t,i,!0):void 0!==s?e.addEventListener(t,i,{passive:s}):e.addEventListener(t,i,!1)}function Nn(e,t,i,n,s){var r=n;if(0==(1&t)&&0==(2&t)&&null!==n)e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var a=n.stateNode.containerInfo;if(a===s||8===a.nodeType&&a.parentNode===s)break;if(4===o)for(o=n.return;null!==o;){var l=o.tag;if((3===l||4===l)&&((l=o.stateNode.containerInfo)===s||8===l.nodeType&&l.parentNode===s))return;o=o.return}for(;null!==a;){if(null===(o=Jn(a)))return;if(5===(l=o.tag)||6===l){n=r=o;continue e}a=a.parentNode}}n=n.return}!function(e,t,i){if(Be)return e(t,i);Be=!0;try{ke(e,t,i)}finally{Be=!1,Fe()}}((function(){var n=r,s=Me(i),o=[];e:{var a=Nt.get(e);if(void 0!==a){var l=ui,c=e;switch(e){case"keypress":if(0===si(i))break e;case"keydown":case"keyup":l=Oi;break;case"focusin":c="focus",l=yi;break;case"focusout":c="blur",l=yi;break;case"beforeblur":case"afterblur":l=yi;break;case"click":if(2===i.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=gi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=vi;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Ci;break;case At:case Ct:case Pt:l=bi;break;case Dt:l=Pi;break;case"scroll":l=mi;break;case"wheel":l=Di;break;case"copy":case"cut":case"paste":l=Si;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Ai}var d=0!=(4&t),h=!d&&"scroll"===e,u=d?null!==a?a+"Capture":null:a;d=[];for(var p,m=n;null!==m;){var f=(p=m).stateNode;if(5===p.tag&&null!==f&&(p=f,null!==u&&(null!=(f=Ve(m,u))&&d.push(In(m,f,p)))),h)break;m=m.return}0<d.length&&(a=new l(a,c,null,i,s),o.push({event:a,listeners:d}))}}if(0==(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||0!=(16&t)||!(c=i.relatedTarget||i.fromElement)||!Jn(c)&&!c[Qn])&&(l||a)&&(a=s.window===s?s:(a=s.ownerDocument)?a.defaultView||a.parentWindow:window,l?(l=n,null!==(c=(c=i.relatedTarget||i.toElement)?Jn(c):null)&&(c!==(h=$e(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(d=gi,f="onMouseLeave",u="onMouseEnter",m="mouse","pointerout"!==e&&"pointerover"!==e||(d=Ai,f="onPointerLeave",u="onPointerEnter",m="pointer"),h=null==l?a:ts(l),p=null==c?a:ts(c),(a=new d(f,m+"leave",l,i,s)).target=h,a.relatedTarget=p,f=null,Jn(s)===n&&((d=new d(u,m+"enter",c,i,s)).target=p,d.relatedTarget=h,f=d),h=f,l&&c)e:{for(u=c,m=0,p=d=l;p;p=Rn(p))m++;for(p=0,f=u;f;f=Rn(f))p++;for(;0<m-p;)d=Rn(d),m--;for(;0<p-m;)u=Rn(u),p--;for(;m--;){if(d===u||null!==u&&d===u.alternate)break e;d=Rn(d),u=Rn(u)}d=null}else d=null;null!==l&&kn(o,a,l,d,!1),null!==c&&null!==h&&kn(o,h,c,d,!0)}if("select"===(l=(a=n?ts(n):window).nodeName&&a.nodeName.toLowerCase())||"input"===l&&"file"===a.type)var g=Zi;else if(Gi(a))if($i)g=on;else{g=sn;var v=nn}else(l=a.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===a.type||"radio"===a.type)&&(g=rn);switch(g&&(g=g(e,n))?zi(o,g,i,s):(v&&v(e,a,n),"focusout"===e&&(v=a._wrapperState)&&v.controlled&&"number"===a.type&&se(a,"number",a.value)),v=n?ts(n):window,e){case"focusin":(Gi(v)||"true"===v.contentEditable)&&(gn=v,vn=n,yn=null);break;case"focusout":yn=vn=gn=null;break;case"mousedown":bn=!0;break;case"contextmenu":case"mouseup":case"dragend":bn=!1,Sn(o,i,s);break;case"selectionchange":if(fn)break;case"keydown":case"keyup":Sn(o,i,s)}var y;if(Ii)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Hi?Fi(e,i)&&(b="onCompositionEnd"):"keydown"===e&&229===i.keyCode&&(b="onCompositionStart");b&&(ki&&"ko"!==i.locale&&(Hi||"onCompositionStart"!==b?"onCompositionEnd"===b&&Hi&&(y=ni()):(ti="value"in(ei=s)?ei.value:ei.textContent,Hi=!0)),0<(v=Ln(n,b)).length&&(b=new Ei(b,e,null,i,s),o.push({event:b,listeners:v}),y?b.data=y:null!==(y=Vi(i))&&(b.data=y))),(y=Ri?function(e,t){switch(e){case"compositionend":return Vi(t);case"keypress":return 32!==t.which?null:(Bi=!0,Ui);case"textInput":return(e=t.data)===Ui&&Bi?null:e;default:return null}}(e,i):function(e,t){if(Hi)return"compositionend"===e||!Ii&&Fi(e,t)?(e=ni(),ii=ti=ei=null,Hi=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return ki&&"ko"!==t.locale?null:t.data;default:return null}}(e,i))&&(0<(n=Ln(n,"onBeforeInput")).length&&(s=new Ei("onBeforeInput","beforeinput",null,i,s),o.push({event:s,listeners:n}),s.data=y))}Mn(o,t)}))}function In(e,t,i){return{instance:e,listener:t,currentTarget:i}}function Ln(e,t){for(var i=t+"Capture",n=[];null!==e;){var s=e,r=s.stateNode;5===s.tag&&null!==r&&(s=r,null!=(r=Ve(e,i))&&n.unshift(In(e,r,s)),null!=(r=Ve(e,t))&&n.push(In(e,r,s))),e=e.return}return n}function Rn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function kn(e,t,i,n,s){for(var r=t._reactName,o=[];null!==i&&i!==n;){var a=i,l=a.alternate,c=a.stateNode;if(null!==l&&l===n)break;5===a.tag&&null!==c&&(a=c,s?null!=(l=Ve(i,r))&&o.unshift(In(i,l,a)):s||null!=(l=Ve(i,r))&&o.push(In(i,l,a))),i=i.return}0!==o.length&&e.push({event:t,listeners:o})}function Un(){}var Bn=null,Fn=null;function Vn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function Hn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"==typeof t.children||"number"==typeof t.children||"object"==typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var jn="function"==typeof setTimeout?setTimeout:void 0,Gn="function"==typeof clearTimeout?clearTimeout:void 0;function zn(e){1===e.nodeType?e.textContent="":9===e.nodeType&&(null!=(e=e.body)&&(e.textContent=""))}function Wn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Kn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var i=e.data;if("$"===i||"$!"===i||"$?"===i){if(0===t)return e;t--}else"/$"===i&&t++}e=e.previousSibling}return null}var Yn=0;var qn=Math.random().toString(36).slice(2),Zn="__reactFiber$"+qn,$n="__reactProps$"+qn,Qn="__reactContainer$"+qn,Xn="__reactEvents$"+qn;function Jn(e){var t=e[Zn];if(t)return t;for(var i=e.parentNode;i;){if(t=i[Qn]||i[Zn]){if(i=t.alternate,null!==t.child||null!==i&&null!==i.child)for(e=Kn(e);null!==e;){if(i=e[Zn])return i;e=Kn(e)}return t}i=(e=i).parentNode}return null}function es(e){return!(e=e[Zn]||e[Qn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ts(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function is(e){return e[$n]||null}function ns(e){var t=e[Xn];return void 0===t&&(t=e[Xn]=new Set),t}var ss=[],rs=-1;function os(e){return{current:e}}function as(e){0>rs||(e.current=ss[rs],ss[rs]=null,rs--)}function ls(e,t){rs++,ss[rs]=e.current,e.current=t}var cs={},ds=os(cs),hs=os(!1),us=cs;function ps(e,t){var i=e.type.contextTypes;if(!i)return cs;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var s,r={};for(s in i)r[s]=t[s];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=r),r}function ms(e){return null!=(e=e.childContextTypes)}function fs(){as(hs),as(ds)}function gs(e,t,i){if(ds.current!==cs)throw Error(o(168));ls(ds,t),ls(hs,i)}function vs(e,t,i){var n=e.stateNode;if(e=t.childContextTypes,"function"!=typeof n.getChildContext)return i;for(var r in n=n.getChildContext())if(!(r in e))throw Error(o(108,Y(t)||"Unknown",r));return s({},i,n)}function ys(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||cs,us=ds.current,ls(ds,e),ls(hs,hs.current),!0}function bs(e,t,i){var n=e.stateNode;if(!n)throw Error(o(169));i?(e=vs(e,t,us),n.__reactInternalMemoizedMergedChildContext=e,as(hs),as(ds),ls(ds,e)):as(hs),ls(hs,i)}var Ss=null,Es=null,Ts=r.unstable_runWithPriority,ws=r.unstable_scheduleCallback,xs=r.unstable_cancelCallback,_s=r.unstable_shouldYield,Ms=r.unstable_requestPaint,Os=r.unstable_now,As=r.unstable_getCurrentPriorityLevel,Cs=r.unstable_ImmediatePriority,Ps=r.unstable_UserBlockingPriority,Ds=r.unstable_NormalPriority,Ns=r.unstable_LowPriority,Is=r.unstable_IdlePriority,Ls={},Rs=void 0!==Ms?Ms:function(){},ks=null,Us=null,Bs=!1,Fs=Os(),Vs=1e4>Fs?Os:function(){return Os()-Fs};function Hs(){switch(As()){case Cs:return 99;case Ps:return 98;case Ds:return 97;case Ns:return 96;case Is:return 95;default:throw Error(o(332))}}function js(e){switch(e){case 99:return Cs;case 98:return Ps;case 97:return Ds;case 96:return Ns;case 95:return Is;default:throw Error(o(332))}}function Gs(e,t){return e=js(e),Ts(e,t)}function zs(e,t,i){return e=js(e),ws(e,t,i)}function Ws(){if(null!==Us){var e=Us;Us=null,xs(e)}Ks()}function Ks(){if(!Bs&&null!==ks){Bs=!0;var e=0;try{var t=ks;Gs(99,(function(){for(;e<t.length;e++){var i=t[e];do{i=i(!0)}while(null!==i)}})),ks=null}catch(t){throw null!==ks&&(ks=ks.slice(e+1)),ws(Cs,Ws),t}finally{Bs=!1}}}var Ys=E.ReactCurrentBatchConfig;function qs(e,t){if(e&&e.defaultProps){for(var i in t=s({},t),e=e.defaultProps)void 0===t[i]&&(t[i]=e[i]);return t}return t}var Zs=os(null),$s=null,Qs=null,Xs=null;function Js(){Xs=Qs=$s=null}function er(e){var t=Zs.current;as(Zs),e.type._context._currentValue=t}function tr(e,t){for(;null!==e;){var i=e.alternate;if((e.childLanes&t)===t){if(null===i||(i.childLanes&t)===t)break;i.childLanes|=t}else e.childLanes|=t,null!==i&&(i.childLanes|=t);e=e.return}}function ir(e,t){$s=e,Xs=Qs=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!=(e.lanes&t)&&(Lo=!0),e.firstContext=null)}function nr(e,t){if(Xs!==e&&!1!==t&&0!==t)if("number"==typeof t&&1073741823!==t||(Xs=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Qs){if(null===$s)throw Error(o(308));Qs=t,$s.dependencies={lanes:0,firstContext:t,responders:null}}else Qs=Qs.next=t;return e._currentValue}var sr=!1;function rr(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null},effects:null}}function or(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function ar(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function lr(e,t){if(null!==(e=e.updateQueue)){var i=(e=e.shared).pending;null===i?t.next=t:(t.next=i.next,i.next=t),e.pending=t}}function cr(e,t){var i=e.updateQueue,n=e.alternate;if(null!==n&&i===(n=n.updateQueue)){var s=null,r=null;if(null!==(i=i.firstBaseUpdate)){do{var o={eventTime:i.eventTime,lane:i.lane,tag:i.tag,payload:i.payload,callback:i.callback,next:null};null===r?s=r=o:r=r.next=o,i=i.next}while(null!==i);null===r?s=r=t:r=r.next=t}else s=r=t;return i={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,effects:n.effects},void(e.updateQueue=i)}null===(e=i.lastBaseUpdate)?i.firstBaseUpdate=t:e.next=t,i.lastBaseUpdate=t}function dr(e,t,i,n){var r=e.updateQueue;sr=!1;var o=r.firstBaseUpdate,a=r.lastBaseUpdate,l=r.shared.pending;if(null!==l){r.shared.pending=null;var c=l,d=c.next;c.next=null,null===a?o=d:a.next=d,a=c;var h=e.alternate;if(null!==h){var u=(h=h.updateQueue).lastBaseUpdate;u!==a&&(null===u?h.firstBaseUpdate=d:u.next=d,h.lastBaseUpdate=c)}}if(null!==o){for(u=r.baseState,a=0,h=d=c=null;;){l=o.lane;var p=o.eventTime;if((n&l)===l){null!==h&&(h=h.next={eventTime:p,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var m=e,f=o;switch(l=t,p=i,f.tag){case 1:if("function"==typeof(m=f.payload)){u=m.call(p,u,l);break e}u=m;break e;case 3:m.flags=-4097&m.flags|64;case 0:if(null==(l="function"==typeof(m=f.payload)?m.call(p,u,l):m))break e;u=s({},u,l);break e;case 2:sr=!0}}null!==o.callback&&(e.flags|=32,null===(l=r.effects)?r.effects=[o]:l.push(o))}else p={eventTime:p,lane:l,tag:o.tag,payload:o.payload,callback:o.callback,next:null},null===h?(d=h=p,c=u):h=h.next=p,a|=l;if(null===(o=o.next)){if(null===(l=r.shared.pending))break;o=l.next,l.next=null,r.lastBaseUpdate=l,r.shared.pending=null}}null===h&&(c=u),r.baseState=c,r.firstBaseUpdate=d,r.lastBaseUpdate=h,Ba|=a,e.lanes=a,e.memoizedState=u}}function hr(e,t,i){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],s=n.callback;if(null!==s){if(n.callback=null,n=i,"function"!=typeof s)throw Error(o(191,s));s.call(n)}}}var ur=(new n.Component).refs;function pr(e,t,i,n){i=null==(i=i(n,t=e.memoizedState))?t:s({},t,i),e.memoizedState=i,0===e.lanes&&(e.updateQueue.baseState=i)}var mr={isMounted:function(e){return!!(e=e._reactInternals)&&$e(e)===e},enqueueSetState:function(e,t,i){e=e._reactInternals;var n=cl(),s=dl(e),r=ar(n,s);r.payload=t,null!=i&&(r.callback=i),lr(e,r),hl(e,s,n)},enqueueReplaceState:function(e,t,i){e=e._reactInternals;var n=cl(),s=dl(e),r=ar(n,s);r.tag=1,r.payload=t,null!=i&&(r.callback=i),lr(e,r),hl(e,s,n)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var i=cl(),n=dl(e),s=ar(i,n);s.tag=2,null!=t&&(s.callback=t),lr(e,s),hl(e,n,i)}};function fr(e,t,i,n,s,r,o){return"function"==typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,r,o):!t.prototype||!t.prototype.isPureReactComponent||(!cn(i,n)||!cn(s,r))}function gr(e,t,i){var n=!1,s=cs,r=t.contextType;return"object"==typeof r&&null!==r?r=nr(r):(s=ms(t)?us:ds.current,r=(n=null!=(n=t.contextTypes))?ps(e,s):cs),t=new t(i,r),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=mr,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=r),t}function vr(e,t,i,n){e=t.state,"function"==typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(i,n),"function"==typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(i,n),t.state!==e&&mr.enqueueReplaceState(t,t.state,null)}function yr(e,t,i,n){var s=e.stateNode;s.props=i,s.state=e.memoizedState,s.refs=ur,rr(e);var r=t.contextType;"object"==typeof r&&null!==r?s.context=nr(r):(r=ms(t)?us:ds.current,s.context=ps(e,r)),dr(e,i,s,n),s.state=e.memoizedState,"function"==typeof(r=t.getDerivedStateFromProps)&&(pr(e,t,r,i),s.state=e.memoizedState),"function"==typeof t.getDerivedStateFromProps||"function"==typeof s.getSnapshotBeforeUpdate||"function"!=typeof s.UNSAFE_componentWillMount&&"function"!=typeof s.componentWillMount||(t=s.state,"function"==typeof s.componentWillMount&&s.componentWillMount(),"function"==typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),t!==s.state&&mr.enqueueReplaceState(s,s.state,null),dr(e,i,s,n),s.state=e.memoizedState),"function"==typeof s.componentDidMount&&(e.flags|=4)}var br=Array.isArray;function Sr(e,t,i){if(null!==(e=i.ref)&&"function"!=typeof e&&"object"!=typeof e){if(i._owner){if(i=i._owner){if(1!==i.tag)throw Error(o(309));var n=i.stateNode}if(!n)throw Error(o(147,e));var s=""+e;return null!==t&&null!==t.ref&&"function"==typeof t.ref&&t.ref._stringRef===s?t.ref:((t=function(e){var t=n.refs;t===ur&&(t=n.refs={}),null===e?delete t[s]:t[s]=e})._stringRef=s,t)}if("string"!=typeof e)throw Error(o(284));if(!i._owner)throw Error(o(290,e))}return e}function Er(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t))}function Tr(e){function t(t,i){if(e){var n=t.lastEffect;null!==n?(n.nextEffect=i,t.lastEffect=i):t.firstEffect=t.lastEffect=i,i.nextEffect=null,i.flags=8}}function i(i,n){if(!e)return null;for(;null!==n;)t(i,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function s(e,t){return(e=Gl(e,t)).index=0,e.sibling=null,e}function r(t,i,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<i?(t.flags=2,i):n:(t.flags=2,i):i}function a(t){return e&&null===t.alternate&&(t.flags=2),t}function l(e,t,i,n){return null===t||6!==t.tag?((t=Yl(i,e.mode,n)).return=e,t):((t=s(t,i)).return=e,t)}function c(e,t,i,n){return null!==t&&t.elementType===i.type?((n=s(t,i.props)).ref=Sr(e,t,i),n.return=e,n):((n=zl(i.type,i.key,i.props,null,e.mode,n)).ref=Sr(e,t,i),n.return=e,n)}function d(e,t,i,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==i.containerInfo||t.stateNode.implementation!==i.implementation?((t=ql(i,e.mode,n)).return=e,t):((t=s(t,i.children||[])).return=e,t)}function h(e,t,i,n,r){return null===t||7!==t.tag?((t=Wl(i,e.mode,n,r)).return=e,t):((t=s(t,i)).return=e,t)}function u(e,t,i){if("string"==typeof t||"number"==typeof t)return(t=Yl(""+t,e.mode,i)).return=e,t;if("object"==typeof t&&null!==t){switch(t.$$typeof){case T:return(i=zl(t.type,t.key,t.props,null,e.mode,i)).ref=Sr(e,null,t),i.return=e,i;case w:return(t=ql(t,e.mode,i)).return=e,t}if(br(t)||j(t))return(t=Wl(t,e.mode,i,null)).return=e,t;Er(e,t)}return null}function p(e,t,i,n){var s=null!==t?t.key:null;if("string"==typeof i||"number"==typeof i)return null!==s?null:l(e,t,""+i,n);if("object"==typeof i&&null!==i){switch(i.$$typeof){case T:return i.key===s?i.type===x?h(e,t,i.props.children,n,s):c(e,t,i,n):null;case w:return i.key===s?d(e,t,i,n):null}if(br(i)||j(i))return null!==s?null:h(e,t,i,n,null);Er(e,i)}return null}function m(e,t,i,n,s){if("string"==typeof n||"number"==typeof n)return l(t,e=e.get(i)||null,""+n,s);if("object"==typeof n&&null!==n){switch(n.$$typeof){case T:return e=e.get(null===n.key?i:n.key)||null,n.type===x?h(t,e,n.props.children,s,n.key):c(t,e,n,s);case w:return d(t,e=e.get(null===n.key?i:n.key)||null,n,s)}if(br(n)||j(n))return h(t,e=e.get(i)||null,n,s,null);Er(t,n)}return null}function f(s,o,a,l){for(var c=null,d=null,h=o,f=o=0,g=null;null!==h&&f<a.length;f++){h.index>f?(g=h,h=null):g=h.sibling;var v=p(s,h,a[f],l);if(null===v){null===h&&(h=g);break}e&&h&&null===v.alternate&&t(s,h),o=r(v,o,f),null===d?c=v:d.sibling=v,d=v,h=g}if(f===a.length)return i(s,h),c;if(null===h){for(;f<a.length;f++)null!==(h=u(s,a[f],l))&&(o=r(h,o,f),null===d?c=h:d.sibling=h,d=h);return c}for(h=n(s,h);f<a.length;f++)null!==(g=m(h,s,f,a[f],l))&&(e&&null!==g.alternate&&h.delete(null===g.key?f:g.key),o=r(g,o,f),null===d?c=g:d.sibling=g,d=g);return e&&h.forEach((function(e){return t(s,e)})),c}function g(s,a,l,c){var d=j(l);if("function"!=typeof d)throw Error(o(150));if(null==(l=d.call(l)))throw Error(o(151));for(var h=d=null,f=a,g=a=0,v=null,y=l.next();null!==f&&!y.done;g++,y=l.next()){f.index>g?(v=f,f=null):v=f.sibling;var b=p(s,f,y.value,c);if(null===b){null===f&&(f=v);break}e&&f&&null===b.alternate&&t(s,f),a=r(b,a,g),null===h?d=b:h.sibling=b,h=b,f=v}if(y.done)return i(s,f),d;if(null===f){for(;!y.done;g++,y=l.next())null!==(y=u(s,y.value,c))&&(a=r(y,a,g),null===h?d=y:h.sibling=y,h=y);return d}for(f=n(s,f);!y.done;g++,y=l.next())null!==(y=m(f,s,g,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?g:y.key),a=r(y,a,g),null===h?d=y:h.sibling=y,h=y);return e&&f.forEach((function(e){return t(s,e)})),d}return function(e,n,r,l){var c="object"==typeof r&&null!==r&&r.type===x&&null===r.key;c&&(r=r.props.children);var d="object"==typeof r&&null!==r;if(d)switch(r.$$typeof){case T:e:{for(d=r.key,c=n;null!==c;){if(c.key===d){switch(c.tag){case 7:if(r.type===x){i(e,c.sibling),(n=s(c,r.props.children)).return=e,e=n;break e}break;default:if(c.elementType===r.type){i(e,c.sibling),(n=s(c,r.props)).ref=Sr(e,c,r),n.return=e,e=n;break e}}i(e,c);break}t(e,c),c=c.sibling}r.type===x?((n=Wl(r.props.children,e.mode,l,r.key)).return=e,e=n):((l=zl(r.type,r.key,r.props,null,e.mode,l)).ref=Sr(e,n,r),l.return=e,e=l)}return a(e);case w:e:{for(c=r.key;null!==n;){if(n.key===c){if(4===n.tag&&n.stateNode.containerInfo===r.containerInfo&&n.stateNode.implementation===r.implementation){i(e,n.sibling),(n=s(n,r.children||[])).return=e,e=n;break e}i(e,n);break}t(e,n),n=n.sibling}(n=ql(r,e.mode,l)).return=e,e=n}return a(e)}if("string"==typeof r||"number"==typeof r)return r=""+r,null!==n&&6===n.tag?(i(e,n.sibling),(n=s(n,r)).return=e,e=n):(i(e,n),(n=Yl(r,e.mode,l)).return=e,e=n),a(e);if(br(r))return f(e,n,r,l);if(j(r))return g(e,n,r,l);if(d&&Er(e,r),void 0===r&&!c)switch(e.tag){case 1:case 22:case 0:case 11:case 15:throw Error(o(152,Y(e.type)||"Component"))}return i(e,n)}}var wr=Tr(!0),xr=Tr(!1),_r={},Mr=os(_r),Or=os(_r),Ar=os(_r);function Cr(e){if(e===_r)throw Error(o(174));return e}function Pr(e,t){switch(ls(Ar,t),ls(Or,e),ls(Mr,_r),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:me(null,"");break;default:t=me(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}as(Mr),ls(Mr,t)}function Dr(){as(Mr),as(Or),as(Ar)}function Nr(e){Cr(Ar.current);var t=Cr(Mr.current),i=me(t,e.type);t!==i&&(ls(Or,e),ls(Mr,i))}function Ir(e){Or.current===e&&(as(Mr),as(Or))}var Lr=os(0);function Rr(e){for(var t=e;null!==t;){if(13===t.tag){var i=t.memoizedState;if(null!==i&&(null===(i=i.dehydrated)||"$?"===i.data||"$!"===i.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!=(64&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var kr=null,Ur=null,Br=!1;function Fr(e,t){var i=Hl(5,null,null,0);i.elementType="DELETED",i.type="DELETED",i.stateNode=t,i.return=e,i.flags=8,null!==e.lastEffect?(e.lastEffect.nextEffect=i,e.lastEffect=i):e.firstEffect=e.lastEffect=i}function Vr(e,t){switch(e.tag){case 5:var i=e.type;return null!==(t=1!==t.nodeType||i.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Hr(e){if(Br){var t=Ur;if(t){var i=t;if(!Vr(e,t)){if(!(t=Wn(i.nextSibling))||!Vr(e,t))return e.flags=-1025&e.flags|2,Br=!1,void(kr=e);Fr(kr,i)}kr=e,Ur=Wn(t.firstChild)}else e.flags=-1025&e.flags|2,Br=!1,kr=e}}function jr(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;kr=e}function Gr(e){if(e!==kr)return!1;if(!Br)return jr(e),Br=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!Hn(t,e.memoizedProps))for(t=Ur;t;)Fr(e,t),t=Wn(t.nextSibling);if(jr(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var i=e.data;if("/$"===i){if(0===t){Ur=Wn(e.nextSibling);break e}t--}else"$"!==i&&"$!"!==i&&"$?"!==i||t++}e=e.nextSibling}Ur=null}}else Ur=kr?Wn(e.stateNode.nextSibling):null;return!0}function zr(){Ur=kr=null,Br=!1}var Wr=[];function Kr(){for(var e=0;e<Wr.length;e++)Wr[e]._workInProgressVersionPrimary=null;Wr.length=0}var Yr=E.ReactCurrentDispatcher,qr=E.ReactCurrentBatchConfig,Zr=0,$r=null,Qr=null,Xr=null,Jr=!1,eo=!1;function to(){throw Error(o(321))}function io(e,t){if(null===t)return!1;for(var i=0;i<t.length&&i<e.length;i++)if(!an(e[i],t[i]))return!1;return!0}function no(e,t,i,n,s,r){if(Zr=r,$r=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,Yr.current=null===e||null===e.memoizedState?Po:Do,e=i(n,s),eo){r=0;do{if(eo=!1,!(25>r))throw Error(o(301));r+=1,Xr=Qr=null,t.updateQueue=null,Yr.current=No,e=i(n,s)}while(eo)}if(Yr.current=Co,t=null!==Qr&&null!==Qr.next,Zr=0,Xr=Qr=$r=null,Jr=!1,t)throw Error(o(300));return e}function so(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Xr?$r.memoizedState=Xr=e:Xr=Xr.next=e,Xr}function ro(){if(null===Qr){var e=$r.alternate;e=null!==e?e.memoizedState:null}else e=Qr.next;var t=null===Xr?$r.memoizedState:Xr.next;if(null!==t)Xr=t,Qr=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Qr=e).memoizedState,baseState:Qr.baseState,baseQueue:Qr.baseQueue,queue:Qr.queue,next:null},null===Xr?$r.memoizedState=Xr=e:Xr=Xr.next=e}return Xr}function oo(e,t){return"function"==typeof t?t(e):t}function ao(e){var t=ro(),i=t.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=e;var n=Qr,s=n.baseQueue,r=i.pending;if(null!==r){if(null!==s){var a=s.next;s.next=r.next,r.next=a}n.baseQueue=s=r,i.pending=null}if(null!==s){s=s.next,n=n.baseState;var l=a=r=null,c=s;do{var d=c.lane;if((Zr&d)===d)null!==l&&(l=l.next={lane:0,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),n=c.eagerReducer===e?c.eagerState:e(n,c.action);else{var h={lane:d,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===l?(a=l=h,r=n):l=l.next=h,$r.lanes|=d,Ba|=d}c=c.next}while(null!==c&&c!==s);null===l?r=n:l.next=a,an(n,t.memoizedState)||(Lo=!0),t.memoizedState=n,t.baseState=r,t.baseQueue=l,i.lastRenderedState=n}return[t.memoizedState,i.dispatch]}function lo(e){var t=ro(),i=t.queue;if(null===i)throw Error(o(311));i.lastRenderedReducer=e;var n=i.dispatch,s=i.pending,r=t.memoizedState;if(null!==s){i.pending=null;var a=s=s.next;do{r=e(r,a.action),a=a.next}while(a!==s);an(r,t.memoizedState)||(Lo=!0),t.memoizedState=r,null===t.baseQueue&&(t.baseState=r),i.lastRenderedState=r}return[r,n]}function co(e,t,i){var n=t._getVersion;n=n(t._source);var s=t._workInProgressVersionPrimary;if(null!==s?e=s===n:(e=e.mutableReadLanes,(e=(Zr&e)===e)&&(t._workInProgressVersionPrimary=n,Wr.push(t))),e)return i(t._source);throw Wr.push(t),Error(o(350))}function ho(e,t,i,n){var s=Pa;if(null===s)throw Error(o(349));var r=t._getVersion,a=r(t._source),l=Yr.current,c=l.useState((function(){return co(s,t,i)})),d=c[1],h=c[0];c=Xr;var u=e.memoizedState,p=u.refs,m=p.getSnapshot,f=u.source;u=u.subscribe;var g=$r;return e.memoizedState={refs:p,source:t,subscribe:n},l.useEffect((function(){p.getSnapshot=i,p.setSnapshot=d;var e=r(t._source);if(!an(a,e)){e=i(t._source),an(h,e)||(d(e),e=dl(g),s.mutableReadLanes|=e&s.pendingLanes),e=s.mutableReadLanes,s.entangledLanes|=e;for(var n=s.entanglements,o=e;0<o;){var l=31-zt(o),c=1<<l;n[l]|=e,o&=~c}}}),[i,t,n]),l.useEffect((function(){return n(t._source,(function(){var e=p.getSnapshot,i=p.setSnapshot;try{i(e(t._source));var n=dl(g);s.mutableReadLanes|=n&s.pendingLanes}catch(e){i((function(){throw e}))}}))}),[t,n]),an(m,i)&&an(f,t)&&an(u,n)||((e={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:h}).dispatch=d=Ao.bind(null,$r,e),c.queue=e,c.baseQueue=null,h=co(s,t,i),c.memoizedState=c.baseState=h),h}function uo(e,t,i){return ho(ro(),e,t,i)}function po(e){var t=so();return"function"==typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:oo,lastRenderedState:e}).dispatch=Ao.bind(null,$r,e),[t.memoizedState,e]}function mo(e,t,i,n){return e={tag:e,create:t,destroy:i,deps:n,next:null},null===(t=$r.updateQueue)?(t={lastEffect:null},$r.updateQueue=t,t.lastEffect=e.next=e):null===(i=t.lastEffect)?t.lastEffect=e.next=e:(n=i.next,i.next=e,e.next=n,t.lastEffect=e),e}function fo(e){return e={current:e},so().memoizedState=e}function go(){return ro().memoizedState}function vo(e,t,i,n){var s=so();$r.flags|=e,s.memoizedState=mo(1|t,i,void 0,void 0===n?null:n)}function yo(e,t,i,n){var s=ro();n=void 0===n?null:n;var r=void 0;if(null!==Qr){var o=Qr.memoizedState;if(r=o.destroy,null!==n&&io(n,o.deps))return void mo(t,i,r,n)}$r.flags|=e,s.memoizedState=mo(1|t,i,r,n)}function bo(e,t){return vo(516,4,e,t)}function So(e,t){return yo(516,4,e,t)}function Eo(e,t){return yo(4,2,e,t)}function To(e,t){return"function"==typeof t?(e=e(),t(e),function(){t(null)}):null!=t?(e=e(),t.current=e,function(){t.current=null}):void 0}function wo(e,t,i){return i=null!=i?i.concat([e]):null,yo(4,2,To.bind(null,t,e),i)}function xo(){}function _o(e,t){var i=ro();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&io(t,n[1])?n[0]:(i.memoizedState=[e,t],e)}function Mo(e,t){var i=ro();t=void 0===t?null:t;var n=i.memoizedState;return null!==n&&null!==t&&io(t,n[1])?n[0]:(e=e(),i.memoizedState=[e,t],e)}function Oo(e,t){var i=Hs();Gs(98>i?98:i,(function(){e(!0)})),Gs(97<i?97:i,(function(){var i=qr.transition;qr.transition=1;try{e(!1),t()}finally{qr.transition=i}}))}function Ao(e,t,i){var n=cl(),s=dl(e),r={lane:s,action:i,eagerReducer:null,eagerState:null,next:null},o=t.pending;if(null===o?r.next=r:(r.next=o.next,o.next=r),t.pending=r,o=e.alternate,e===$r||null!==o&&o===$r)eo=Jr=!0;else{if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,l=o(a,i);if(r.eagerReducer=o,r.eagerState=l,an(l,a))return}catch(e){}hl(e,s,n)}}var Co={readContext:nr,useCallback:to,useContext:to,useEffect:to,useImperativeHandle:to,useLayoutEffect:to,useMemo:to,useReducer:to,useRef:to,useState:to,useDebugValue:to,useDeferredValue:to,useTransition:to,useMutableSource:to,useOpaqueIdentifier:to,unstable_isNewReconciler:!1},Po={readContext:nr,useCallback:function(e,t){return so().memoizedState=[e,void 0===t?null:t],e},useContext:nr,useEffect:bo,useImperativeHandle:function(e,t,i){return i=null!=i?i.concat([e]):null,vo(4,2,To.bind(null,t,e),i)},useLayoutEffect:function(e,t){return vo(4,2,e,t)},useMemo:function(e,t){var i=so();return t=void 0===t?null:t,e=e(),i.memoizedState=[e,t],e},useReducer:function(e,t,i){var n=so();return t=void 0!==i?i(t):t,n.memoizedState=n.baseState=t,e=(e=n.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=Ao.bind(null,$r,e),[n.memoizedState,e]},useRef:fo,useState:po,useDebugValue:xo,useDeferredValue:function(e){var t=po(e),i=t[0],n=t[1];return bo((function(){var t=qr.transition;qr.transition=1;try{n(e)}finally{qr.transition=t}}),[e]),i},useTransition:function(){var e=po(!1),t=e[0];return fo(e=Oo.bind(null,e[1])),[e,t]},useMutableSource:function(e,t,i){var n=so();return n.memoizedState={refs:{getSnapshot:t,setSnapshot:null},source:e,subscribe:i},ho(n,e,t,i)},useOpaqueIdentifier:function(){if(Br){var e=!1,t=function(e){return{$$typeof:R,toString:e,valueOf:e}}((function(){throw e||(e=!0,i("r:"+(Yn++).toString(36))),Error(o(355))})),i=po(t)[1];return 0==(2&$r.mode)&&($r.flags|=516,mo(5,(function(){i("r:"+(Yn++).toString(36))}),void 0,null)),t}return po(t="r:"+(Yn++).toString(36)),t},unstable_isNewReconciler:!1},Do={readContext:nr,useCallback:_o,useContext:nr,useEffect:So,useImperativeHandle:wo,useLayoutEffect:Eo,useMemo:Mo,useReducer:ao,useRef:go,useState:function(){return ao(oo)},useDebugValue:xo,useDeferredValue:function(e){var t=ao(oo),i=t[0],n=t[1];return So((function(){var t=qr.transition;qr.transition=1;try{n(e)}finally{qr.transition=t}}),[e]),i},useTransition:function(){var e=ao(oo)[0];return[go().current,e]},useMutableSource:uo,useOpaqueIdentifier:function(){return ao(oo)[0]},unstable_isNewReconciler:!1},No={readContext:nr,useCallback:_o,useContext:nr,useEffect:So,useImperativeHandle:wo,useLayoutEffect:Eo,useMemo:Mo,useReducer:lo,useRef:go,useState:function(){return lo(oo)},useDebugValue:xo,useDeferredValue:function(e){var t=lo(oo),i=t[0],n=t[1];return So((function(){var t=qr.transition;qr.transition=1;try{n(e)}finally{qr.transition=t}}),[e]),i},useTransition:function(){var e=lo(oo)[0];return[go().current,e]},useMutableSource:uo,useOpaqueIdentifier:function(){return lo(oo)[0]},unstable_isNewReconciler:!1},Io=E.ReactCurrentOwner,Lo=!1;function Ro(e,t,i,n){t.child=null===e?xr(t,null,i,n):wr(t,e.child,i,n)}function ko(e,t,i,n,s){i=i.render;var r=t.ref;return ir(t,s),n=no(e,t,i,n,r,s),null===e||Lo?(t.flags|=1,Ro(e,t,n,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~s,ia(e,t,s))}function Uo(e,t,i,n,s,r){if(null===e){var o=i.type;return"function"!=typeof o||jl(o)||void 0!==o.defaultProps||null!==i.compare||void 0!==i.defaultProps?((e=zl(i.type,null,n,t,t.mode,r)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Bo(e,t,o,n,s,r))}return o=e.child,0==(s&r)&&(s=o.memoizedProps,(i=null!==(i=i.compare)?i:cn)(s,n)&&e.ref===t.ref)?ia(e,t,r):(t.flags|=1,(e=Gl(o,n)).ref=t.ref,e.return=t,t.child=e)}function Bo(e,t,i,n,s,r){if(null!==e&&cn(e.memoizedProps,n)&&e.ref===t.ref){if(Lo=!1,0==(r&s))return t.lanes=e.lanes,ia(e,t,r);0!=(16384&e.flags)&&(Lo=!0)}return Ho(e,t,i,n,r)}function Fo(e,t,i){var n=t.pendingProps,s=n.children,r=null!==e?e.memoizedState:null;if("hidden"===n.mode||"unstable-defer-without-hiding"===n.mode)if(0==(4&t.mode))t.memoizedState={baseLanes:0},bl(t,i);else{if(0==(1073741824&i))return e=null!==r?r.baseLanes|i:i,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e},bl(t,e),null;t.memoizedState={baseLanes:0},bl(t,null!==r?r.baseLanes:i)}else null!==r?(n=r.baseLanes|i,t.memoizedState=null):n=i,bl(t,n);return Ro(e,t,s,i),t.child}function Vo(e,t){var i=t.ref;(null===e&&null!==i||null!==e&&e.ref!==i)&&(t.flags|=128)}function Ho(e,t,i,n,s){var r=ms(i)?us:ds.current;return r=ps(t,r),ir(t,s),i=no(e,t,i,n,r,s),null===e||Lo?(t.flags|=1,Ro(e,t,i,s),t.child):(t.updateQueue=e.updateQueue,t.flags&=-517,e.lanes&=~s,ia(e,t,s))}function jo(e,t,i,n,s){if(ms(i)){var r=!0;ys(t)}else r=!1;if(ir(t,s),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),gr(t,i,n),yr(t,i,n,s),n=!0;else if(null===e){var o=t.stateNode,a=t.memoizedProps;o.props=a;var l=o.context,c=i.contextType;"object"==typeof c&&null!==c?c=nr(c):c=ps(t,c=ms(i)?us:ds.current);var d=i.getDerivedStateFromProps,h="function"==typeof d||"function"==typeof o.getSnapshotBeforeUpdate;h||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==n||l!==c)&&vr(t,o,n,c),sr=!1;var u=t.memoizedState;o.state=u,dr(t,n,o,s),l=t.memoizedState,a!==n||u!==l||hs.current||sr?("function"==typeof d&&(pr(t,i,d,n),l=t.memoizedState),(a=sr||fr(t,i,a,n,u,l,c))?(h||"function"!=typeof o.UNSAFE_componentWillMount&&"function"!=typeof o.componentWillMount||("function"==typeof o.componentWillMount&&o.componentWillMount(),"function"==typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"==typeof o.componentDidMount&&(t.flags|=4)):("function"==typeof o.componentDidMount&&(t.flags|=4),t.memoizedProps=n,t.memoizedState=l),o.props=n,o.state=l,o.context=c,n=a):("function"==typeof o.componentDidMount&&(t.flags|=4),n=!1)}else{o=t.stateNode,or(e,t),a=t.memoizedProps,c=t.type===t.elementType?a:qs(t.type,a),o.props=c,h=t.pendingProps,u=o.context,"object"==typeof(l=i.contextType)&&null!==l?l=nr(l):l=ps(t,l=ms(i)?us:ds.current);var p=i.getDerivedStateFromProps;(d="function"==typeof p||"function"==typeof o.getSnapshotBeforeUpdate)||"function"!=typeof o.UNSAFE_componentWillReceiveProps&&"function"!=typeof o.componentWillReceiveProps||(a!==h||u!==l)&&vr(t,o,n,l),sr=!1,u=t.memoizedState,o.state=u,dr(t,n,o,s);var m=t.memoizedState;a!==h||u!==m||hs.current||sr?("function"==typeof p&&(pr(t,i,p,n),m=t.memoizedState),(c=sr||fr(t,i,c,n,u,m,l))?(d||"function"!=typeof o.UNSAFE_componentWillUpdate&&"function"!=typeof o.componentWillUpdate||("function"==typeof o.componentWillUpdate&&o.componentWillUpdate(n,m,l),"function"==typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(n,m,l)),"function"==typeof o.componentDidUpdate&&(t.flags|=4),"function"==typeof o.getSnapshotBeforeUpdate&&(t.flags|=256)):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.flags|=256),t.memoizedProps=n,t.memoizedState=m),o.props=n,o.state=m,o.context=l,n=c):("function"!=typeof o.componentDidUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.flags|=4),"function"!=typeof o.getSnapshotBeforeUpdate||a===e.memoizedProps&&u===e.memoizedState||(t.flags|=256),n=!1)}return Go(e,t,i,n,r,s)}function Go(e,t,i,n,s,r){Vo(e,t);var o=0!=(64&t.flags);if(!n&&!o)return s&&bs(t,i,!1),ia(e,t,r);n=t.stateNode,Io.current=t;var a=o&&"function"!=typeof i.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&o?(t.child=wr(t,e.child,null,r),t.child=wr(t,null,a,r)):Ro(e,t,a,r),t.memoizedState=n.state,s&&bs(t,i,!0),t.child}function zo(e){var t=e.stateNode;t.pendingContext?gs(0,t.pendingContext,t.pendingContext!==t.context):t.context&&gs(0,t.context,!1),Pr(e,t.containerInfo)}var Wo,Ko,Yo,qo={dehydrated:null,retryLane:0};function Zo(e,t,i){var n,s=t.pendingProps,r=Lr.current,o=!1;return(n=0!=(64&t.flags))||(n=(null===e||null!==e.memoizedState)&&0!=(2&r)),n?(o=!0,t.flags&=-65):null!==e&&null===e.memoizedState||void 0===s.fallback||!0===s.unstable_avoidThisFallback||(r|=1),ls(Lr,1&r),null===e?(void 0!==s.fallback&&Hr(t),e=s.children,r=s.fallback,o?(e=$o(t,e,r,i),t.child.memoizedState={baseLanes:i},t.memoizedState=qo,e):"number"==typeof s.unstable_expectedLoadTime?(e=$o(t,e,r,i),t.child.memoizedState={baseLanes:i},t.memoizedState=qo,t.lanes=33554432,e):((i=Kl({mode:"visible",children:e},t.mode,i,null)).return=t,t.child=i)):(e.memoizedState,o?(s=Xo(e,t,s.children,s.fallback,i),o=t.child,r=e.child.memoizedState,o.memoizedState=null===r?{baseLanes:i}:{baseLanes:r.baseLanes|i},o.childLanes=e.childLanes&~i,t.memoizedState=qo,s):(i=Qo(e,t,s.children,i),t.memoizedState=null,i))}function $o(e,t,i,n){var s=e.mode,r=e.child;return t={mode:"hidden",children:t},0==(2&s)&&null!==r?(r.childLanes=0,r.pendingProps=t):r=Kl(t,s,0,null),i=Wl(i,s,n,null),r.return=e,i.return=e,r.sibling=i,e.child=r,i}function Qo(e,t,i,n){var s=e.child;return e=s.sibling,i=Gl(s,{mode:"visible",children:i}),0==(2&t.mode)&&(i.lanes=n),i.return=t,i.sibling=null,null!==e&&(e.nextEffect=null,e.flags=8,t.firstEffect=t.lastEffect=e),t.child=i}function Xo(e,t,i,n,s){var r=t.mode,o=e.child;e=o.sibling;var a={mode:"hidden",children:i};return 0==(2&r)&&t.child!==o?((i=t.child).childLanes=0,i.pendingProps=a,null!==(o=i.lastEffect)?(t.firstEffect=i.firstEffect,t.lastEffect=o,o.nextEffect=null):t.firstEffect=t.lastEffect=null):i=Gl(o,a),null!==e?n=Gl(e,n):(n=Wl(n,r,s,null)).flags|=2,n.return=t,i.return=t,i.sibling=n,t.child=i,n}function Jo(e,t){e.lanes|=t;var i=e.alternate;null!==i&&(i.lanes|=t),tr(e.return,t)}function ea(e,t,i,n,s,r){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:i,tailMode:s,lastEffect:r}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=i,o.tailMode=s,o.lastEffect=r)}function ta(e,t,i){var n=t.pendingProps,s=n.revealOrder,r=n.tail;if(Ro(e,t,n.children,i),0!=(2&(n=Lr.current)))n=1&n|2,t.flags|=64;else{if(null!==e&&0!=(64&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Jo(e,i);else if(19===e.tag)Jo(e,i);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(ls(Lr,n),0==(2&t.mode))t.memoizedState=null;else switch(s){case"forwards":for(i=t.child,s=null;null!==i;)null!==(e=i.alternate)&&null===Rr(e)&&(s=i),i=i.sibling;null===(i=s)?(s=t.child,t.child=null):(s=i.sibling,i.sibling=null),ea(t,!1,s,i,r,t.lastEffect);break;case"backwards":for(i=null,s=t.child,t.child=null;null!==s;){if(null!==(e=s.alternate)&&null===Rr(e)){t.child=s;break}e=s.sibling,s.sibling=i,i=s,s=e}ea(t,!0,i,null,r,t.lastEffect);break;case"together":ea(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function ia(e,t,i){if(null!==e&&(t.dependencies=e.dependencies),Ba|=t.lanes,0!=(i&t.childLanes)){if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(i=Gl(e=t.child,e.pendingProps),t.child=i,i.return=t;null!==e.sibling;)e=e.sibling,(i=i.sibling=Gl(e,e.pendingProps)).return=t;i.sibling=null}return t.child}return null}function na(e,t){if(!Br)switch(e.tailMode){case"hidden":t=e.tail;for(var i=null;null!==t;)null!==t.alternate&&(i=t),t=t.sibling;null===i?e.tail=null:i.sibling=null;break;case"collapsed":i=e.tail;for(var n=null;null!==i;)null!==i.alternate&&(n=i),i=i.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function sa(e,t,i){var n=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return ms(t.type)&&fs(),null;case 3:return Dr(),as(hs),as(ds),Kr(),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(Gr(t)?t.flags|=4:n.hydrate||(t.flags|=256)),null;case 5:Ir(t);var r=Cr(Ar.current);if(i=t.type,null!==e&&null!=t.stateNode)Ko(e,t,i,n),e.ref!==t.ref&&(t.flags|=128);else{if(!n){if(null===t.stateNode)throw Error(o(166));return null}if(e=Cr(Mr.current),Gr(t)){n=t.stateNode,i=t.type;var a=t.memoizedProps;switch(n[Zn]=t,n[$n]=a,i){case"dialog":On("cancel",n),On("close",n);break;case"iframe":case"object":case"embed":On("load",n);break;case"video":case"audio":for(e=0;e<wn.length;e++)On(wn[e],n);break;case"source":On("error",n);break;case"img":case"image":case"link":On("error",n),On("load",n);break;case"details":On("toggle",n);break;case"input":ee(n,a),On("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},On("invalid",n);break;case"textarea":le(n,a),On("invalid",n)}for(var c in xe(i,a),e=null,a)a.hasOwnProperty(c)&&(r=a[c],"children"===c?"string"==typeof r?n.textContent!==r&&(e=["children",r]):"number"==typeof r&&n.textContent!==""+r&&(e=["children",""+r]):l.hasOwnProperty(c)&&null!=r&&"onScroll"===c&&On("scroll",n));switch(i){case"input":$(n),ne(n,a,!0);break;case"textarea":$(n),de(n);break;case"select":case"option":break;default:"function"==typeof a.onClick&&(n.onclick=Un)}n=e,t.updateQueue=n,null!==n&&(t.flags|=4)}else{switch(c=9===r.nodeType?r:r.ownerDocument,e===he&&(e=pe(i)),e===he?"script"===i?((e=c.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"==typeof n.is?e=c.createElement(i,{is:n.is}):(e=c.createElement(i),"select"===i&&(c=e,n.multiple?c.multiple=!0:n.size&&(c.size=n.size))):e=c.createElementNS(e,i),e[Zn]=t,e[$n]=n,Wo(e,t),t.stateNode=e,c=_e(i,n),i){case"dialog":On("cancel",e),On("close",e),r=n;break;case"iframe":case"object":case"embed":On("load",e),r=n;break;case"video":case"audio":for(r=0;r<wn.length;r++)On(wn[r],e);r=n;break;case"source":On("error",e),r=n;break;case"img":case"image":case"link":On("error",e),On("load",e),r=n;break;case"details":On("toggle",e),r=n;break;case"input":ee(e,n),r=J(e,n),On("invalid",e);break;case"option":r=re(e,n);break;case"select":e._wrapperState={wasMultiple:!!n.multiple},r=s({},n,{value:void 0}),On("invalid",e);break;case"textarea":le(e,n),r=ae(e,n),On("invalid",e);break;default:r=n}xe(i,r);var d=r;for(a in d)if(d.hasOwnProperty(a)){var h=d[a];"style"===a?Te(e,h):"dangerouslySetInnerHTML"===a?null!=(h=h?h.__html:void 0)&&ve(e,h):"children"===a?"string"==typeof h?("textarea"!==i||""!==h)&&ye(e,h):"number"==typeof h&&ye(e,""+h):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(l.hasOwnProperty(a)?null!=h&&"onScroll"===a&&On("scroll",e):null!=h&&S(e,a,h,c))}switch(i){case"input":$(e),ne(e,n,!1);break;case"textarea":$(e),de(e);break;case"option":null!=n.value&&e.setAttribute("value",""+q(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?oe(e,!!n.multiple,a,!1):null!=n.defaultValue&&oe(e,!!n.multiple,n.defaultValue,!0);break;default:"function"==typeof r.onClick&&(e.onclick=Un)}Vn(i,n)&&(t.flags|=4)}null!==t.ref&&(t.flags|=128)}return null;case 6:if(e&&null!=t.stateNode)Yo(0,t,e.memoizedProps,n);else{if("string"!=typeof n&&null===t.stateNode)throw Error(o(166));i=Cr(Ar.current),Cr(Mr.current),Gr(t)?(n=t.stateNode,i=t.memoizedProps,n[Zn]=t,n.nodeValue!==i&&(t.flags|=4)):((n=(9===i.nodeType?i:i.ownerDocument).createTextNode(n))[Zn]=t,t.stateNode=n)}return null;case 13:return as(Lr),n=t.memoizedState,0!=(64&t.flags)?(t.lanes=i,t):(n=null!==n,i=!1,null===e?void 0!==t.memoizedProps.fallback&&Gr(t):i=null!==e.memoizedState,n&&!i&&0!=(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!=(1&Lr.current)?0===Ra&&(Ra=3):(0!==Ra&&3!==Ra||(Ra=4),null===Pa||0==(134217727&Ba)&&0==(134217727&Fa)||fl(Pa,Na))),(n||i)&&(t.flags|=4),null);case 4:return Dr(),null===e&&Cn(t.stateNode.containerInfo),null;case 10:return er(t),null;case 17:return ms(t.type)&&fs(),null;case 19:if(as(Lr),null===(n=t.memoizedState))return null;if(a=0!=(64&t.flags),null===(c=n.rendering))if(a)na(n,!1);else{if(0!==Ra||null!==e&&0!=(64&e.flags))for(e=t.child;null!==e;){if(null!==(c=Rr(e))){for(t.flags|=64,na(n,!1),null!==(a=c.updateQueue)&&(t.updateQueue=a,t.flags|=4),null===n.lastEffect&&(t.firstEffect=null),t.lastEffect=n.lastEffect,n=i,i=t.child;null!==i;)e=n,(a=i).flags&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(c=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=c.childLanes,a.lanes=c.lanes,a.child=c.child,a.memoizedProps=c.memoizedProps,a.memoizedState=c.memoizedState,a.updateQueue=c.updateQueue,a.type=c.type,e=c.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),i=i.sibling;return ls(Lr,1&Lr.current|2),t.child}e=e.sibling}null!==n.tail&&Vs()>Ga&&(t.flags|=64,a=!0,na(n,!1),t.lanes=33554432)}else{if(!a)if(null!==(e=Rr(c))){if(t.flags|=64,a=!0,null!==(i=e.updateQueue)&&(t.updateQueue=i,t.flags|=4),na(n,!0),null===n.tail&&"hidden"===n.tailMode&&!c.alternate&&!Br)return null!==(t=t.lastEffect=n.lastEffect)&&(t.nextEffect=null),null}else 2*Vs()-n.renderingStartTime>Ga&&1073741824!==i&&(t.flags|=64,a=!0,na(n,!1),t.lanes=33554432);n.isBackwards?(c.sibling=t.child,t.child=c):(null!==(i=n.last)?i.sibling=c:t.child=c,n.last=c)}return null!==n.tail?(i=n.tail,n.rendering=i,n.tail=i.sibling,n.lastEffect=t.lastEffect,n.renderingStartTime=Vs(),i.sibling=null,t=Lr.current,ls(Lr,a?1&t|2:1&t),i):null;case 23:case 24:return Sl(),null!==e&&null!==e.memoizedState!=(null!==t.memoizedState)&&"unstable-defer-without-hiding"!==n.mode&&(t.flags|=4),null}throw Error(o(156,t.tag))}function ra(e){switch(e.tag){case 1:ms(e.type)&&fs();var t=e.flags;return 4096&t?(e.flags=-4097&t|64,e):null;case 3:if(Dr(),as(hs),as(ds),Kr(),0!=(64&(t=e.flags)))throw Error(o(285));return e.flags=-4097&t|64,e;case 5:return Ir(e),null;case 13:return as(Lr),4096&(t=e.flags)?(e.flags=-4097&t|64,e):null;case 19:return as(Lr),null;case 4:return Dr(),null;case 10:return er(e),null;case 23:case 24:return Sl(),null;default:return null}}function oa(e,t){try{var i="",n=t;do{i+=K(n),n=n.return}while(n);var s=i}catch(e){s="\nError generating stack: "+e.message+"\n"+e.stack}return{value:e,source:t,stack:s}}function aa(e,t){try{console.error(t.value)}catch(e){setTimeout((function(){throw e}))}}Wo=function(e,t){for(var i=t.child;null!==i;){if(5===i.tag||6===i.tag)e.appendChild(i.stateNode);else if(4!==i.tag&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;i=i.return}i.sibling.return=i.return,i=i.sibling}},Ko=function(e,t,i,n){var r=e.memoizedProps;if(r!==n){e=t.stateNode,Cr(Mr.current);var o,a=null;switch(i){case"input":r=J(e,r),n=J(e,n),a=[];break;case"option":r=re(e,r),n=re(e,n),a=[];break;case"select":r=s({},r,{value:void 0}),n=s({},n,{value:void 0}),a=[];break;case"textarea":r=ae(e,r),n=ae(e,n),a=[];break;default:"function"!=typeof r.onClick&&"function"==typeof n.onClick&&(e.onclick=Un)}for(h in xe(i,n),i=null,r)if(!n.hasOwnProperty(h)&&r.hasOwnProperty(h)&&null!=r[h])if("style"===h){var c=r[h];for(o in c)c.hasOwnProperty(o)&&(i||(i={}),i[o]="")}else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(l.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in n){var d=n[h];if(c=null!=r?r[h]:void 0,n.hasOwnProperty(h)&&d!==c&&(null!=d||null!=c))if("style"===h)if(c){for(o in c)!c.hasOwnProperty(o)||d&&d.hasOwnProperty(o)||(i||(i={}),i[o]="");for(o in d)d.hasOwnProperty(o)&&c[o]!==d[o]&&(i||(i={}),i[o]=d[o])}else i||(a||(a=[]),a.push(h,i)),i=d;else"dangerouslySetInnerHTML"===h?(d=d?d.__html:void 0,c=c?c.__html:void 0,null!=d&&c!==d&&(a=a||[]).push(h,d)):"children"===h?"string"!=typeof d&&"number"!=typeof d||(a=a||[]).push(h,""+d):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(l.hasOwnProperty(h)?(null!=d&&"onScroll"===h&&On("scroll",e),a||c===d||(a=[])):"object"==typeof d&&null!==d&&d.$$typeof===R?d.toString():(a=a||[]).push(h,d))}i&&(a=a||[]).push("style",i);var h=a;(t.updateQueue=h)&&(t.flags|=4)}},Yo=function(e,t,i,n){i!==n&&(t.flags|=4)};var la="function"==typeof WeakMap?WeakMap:Map;function ca(e,t,i){(i=ar(-1,i)).tag=3,i.payload={element:null};var n=t.value;return i.callback=function(){Ya||(Ya=!0,qa=n),aa(0,t)},i}function da(e,t,i){(i=ar(-1,i)).tag=3;var n=e.type.getDerivedStateFromError;if("function"==typeof n){var s=t.value;i.payload=function(){return aa(0,t),n(s)}}var r=e.stateNode;return null!==r&&"function"==typeof r.componentDidCatch&&(i.callback=function(){"function"!=typeof n&&(null===Za?Za=new Set([this]):Za.add(this),aa(0,t));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),i}var ha="function"==typeof WeakSet?WeakSet:Set;function ua(e){var t=e.ref;if(null!==t)if("function"==typeof t)try{t(null)}catch(t){Ul(e,t)}else t.current=null}function pa(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.flags&&null!==e){var i=e.memoizedProps,n=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?i:qs(t.type,i),n),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:return void(256&t.flags&&zn(t.stateNode.containerInfo));case 5:case 6:case 4:case 17:return}throw Error(o(163))}function ma(e,t,i){switch(i.tag){case 0:case 11:case 15:case 22:if(null!==(t=null!==(t=i.updateQueue)?t.lastEffect:null)){e=t=t.next;do{if(3==(3&e.tag)){var n=e.create;e.destroy=n()}e=e.next}while(e!==t)}if(null!==(t=null!==(t=i.updateQueue)?t.lastEffect:null)){e=t=t.next;do{var s=e;n=s.next,0!=(4&(s=s.tag))&&0!=(1&s)&&(Ll(i,e),Il(i,e)),e=n}while(e!==t)}return;case 1:return e=i.stateNode,4&i.flags&&(null===t?e.componentDidMount():(n=i.elementType===i.type?t.memoizedProps:qs(i.type,t.memoizedProps),e.componentDidUpdate(n,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate))),void(null!==(t=i.updateQueue)&&hr(i,t,e));case 3:if(null!==(t=i.updateQueue)){if(e=null,null!==i.child)switch(i.child.tag){case 5:e=i.child.stateNode;break;case 1:e=i.child.stateNode}hr(i,t,e)}return;case 5:return e=i.stateNode,void(null===t&&4&i.flags&&Vn(i.type,i.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===i.memoizedState&&(i=i.alternate,null!==i&&(i=i.memoizedState,null!==i&&(i=i.dehydrated,null!==i&&Tt(i)))));case 19:case 17:case 20:case 21:case 23:case 24:return}throw Error(o(163))}function fa(e,t){for(var i=e;;){if(5===i.tag){var n=i.stateNode;if(t)"function"==typeof(n=n.style).setProperty?n.setProperty("display","none","important"):n.display="none";else{n=i.stateNode;var s=i.memoizedProps.style;s=null!=s&&s.hasOwnProperty("display")?s.display:null,n.style.display=Ee("display",s)}}else if(6===i.tag)i.stateNode.nodeValue=t?"":i.memoizedProps;else if((23!==i.tag&&24!==i.tag||null===i.memoizedState||i===e)&&null!==i.child){i.child.return=i,i=i.child;continue}if(i===e)break;for(;null===i.sibling;){if(null===i.return||i.return===e)return;i=i.return}i.sibling.return=i.return,i=i.sibling}}function ga(e,t){if(Es&&"function"==typeof Es.onCommitFiberUnmount)try{Es.onCommitFiberUnmount(Ss,t)}catch(e){}switch(t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var i=e=e.next;do{var n=i,s=n.destroy;if(n=n.tag,void 0!==s)if(0!=(4&n))Ll(t,i);else{n=t;try{s()}catch(e){Ul(n,e)}}i=i.next}while(i!==e)}break;case 1:if(ua(t),"function"==typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(e){Ul(t,e)}break;case 5:ua(t);break;case 4:Ta(e,t)}}function va(e){e.alternate=null,e.child=null,e.dependencies=null,e.firstEffect=null,e.lastEffect=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.return=null,e.updateQueue=null}function ya(e){return 5===e.tag||3===e.tag||4===e.tag}function ba(e){e:{for(var t=e.return;null!==t;){if(ya(t))break e;t=t.return}throw Error(o(160))}var i=t;switch(t=i.stateNode,i.tag){case 5:var n=!1;break;case 3:case 4:t=t.containerInfo,n=!0;break;default:throw Error(o(161))}16&i.flags&&(ye(t,""),i.flags&=-17);e:t:for(i=e;;){for(;null===i.sibling;){if(null===i.return||ya(i.return)){i=null;break e}i=i.return}for(i.sibling.return=i.return,i=i.sibling;5!==i.tag&&6!==i.tag&&18!==i.tag;){if(2&i.flags)continue t;if(null===i.child||4===i.tag)continue t;i.child.return=i,i=i.child}if(!(2&i.flags)){i=i.stateNode;break e}}n?Sa(e,i,t):Ea(e,i,t)}function Sa(e,t,i){var n=e.tag,s=5===n||6===n;if(s)e=s?e.stateNode:e.stateNode.instance,t?8===i.nodeType?i.parentNode.insertBefore(e,t):i.insertBefore(e,t):(8===i.nodeType?(t=i.parentNode).insertBefore(e,i):(t=i).appendChild(e),null!=(i=i._reactRootContainer)||null!==t.onclick||(t.onclick=Un));else if(4!==n&&null!==(e=e.child))for(Sa(e,t,i),e=e.sibling;null!==e;)Sa(e,t,i),e=e.sibling}function Ea(e,t,i){var n=e.tag,s=5===n||6===n;if(s)e=s?e.stateNode:e.stateNode.instance,t?i.insertBefore(e,t):i.appendChild(e);else if(4!==n&&null!==(e=e.child))for(Ea(e,t,i),e=e.sibling;null!==e;)Ea(e,t,i),e=e.sibling}function Ta(e,t){for(var i,n,s=t,r=!1;;){if(!r){r=s.return;e:for(;;){if(null===r)throw Error(o(160));switch(i=r.stateNode,r.tag){case 5:n=!1;break e;case 3:case 4:i=i.containerInfo,n=!0;break e}r=r.return}r=!0}if(5===s.tag||6===s.tag){e:for(var a=e,l=s,c=l;;)if(ga(a,c),null!==c.child&&4!==c.tag)c.child.return=c,c=c.child;else{if(c===l)break e;for(;null===c.sibling;){if(null===c.return||c.return===l)break e;c=c.return}c.sibling.return=c.return,c=c.sibling}n?(a=i,l=s.stateNode,8===a.nodeType?a.parentNode.removeChild(l):a.removeChild(l)):i.removeChild(s.stateNode)}else if(4===s.tag){if(null!==s.child){i=s.stateNode.containerInfo,n=!0,s.child.return=s,s=s.child;continue}}else if(ga(e,s),null!==s.child){s.child.return=s,s=s.child;continue}if(s===t)break;for(;null===s.sibling;){if(null===s.return||s.return===t)return;4===(s=s.return).tag&&(r=!1)}s.sibling.return=s.return,s=s.sibling}}function wa(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:var i=t.updateQueue;if(null!==(i=null!==i?i.lastEffect:null)){var n=i=i.next;do{3==(3&n.tag)&&(e=n.destroy,n.destroy=void 0,void 0!==e&&e()),n=n.next}while(n!==i)}return;case 1:return;case 5:if(null!=(i=t.stateNode)){n=t.memoizedProps;var s=null!==e?e.memoizedProps:n;e=t.type;var r=t.updateQueue;if(t.updateQueue=null,null!==r){for(i[$n]=n,"input"===e&&"radio"===n.type&&null!=n.name&&te(i,n),_e(e,s),t=_e(e,n),s=0;s<r.length;s+=2){var a=r[s],l=r[s+1];"style"===a?Te(i,l):"dangerouslySetInnerHTML"===a?ve(i,l):"children"===a?ye(i,l):S(i,a,l,t)}switch(e){case"input":ie(i,n);break;case"textarea":ce(i,n);break;case"select":e=i._wrapperState.wasMultiple,i._wrapperState.wasMultiple=!!n.multiple,null!=(r=n.value)?oe(i,!!n.multiple,r,!1):e!==!!n.multiple&&(null!=n.defaultValue?oe(i,!!n.multiple,n.defaultValue,!0):oe(i,!!n.multiple,n.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((i=t.stateNode).hydrate&&(i.hydrate=!1,Tt(i.containerInfo)));case 12:return;case 13:return null!==t.memoizedState&&(ja=Vs(),fa(t.child,!0)),void xa(t);case 19:return void xa(t);case 17:return;case 23:case 24:return void fa(t,null!==t.memoizedState)}throw Error(o(163))}function xa(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var i=e.stateNode;null===i&&(i=e.stateNode=new ha),t.forEach((function(t){var n=Fl.bind(null,e,t);i.has(t)||(i.add(t),t.then(n,n))}))}}function _a(e,t){return null!==e&&(null===(e=e.memoizedState)||null!==e.dehydrated)&&(null!==(t=t.memoizedState)&&null===t.dehydrated)}var Ma=Math.ceil,Oa=E.ReactCurrentDispatcher,Aa=E.ReactCurrentOwner,Ca=0,Pa=null,Da=null,Na=0,Ia=0,La=os(0),Ra=0,ka=null,Ua=0,Ba=0,Fa=0,Va=0,Ha=null,ja=0,Ga=1/0;function za(){Ga=Vs()+500}var Wa,Ka=null,Ya=!1,qa=null,Za=null,$a=!1,Qa=null,Xa=90,Ja=[],el=[],tl=null,il=0,nl=null,sl=-1,rl=0,ol=0,al=null,ll=!1;function cl(){return 0!=(48&Ca)?Vs():-1!==sl?sl:sl=Vs()}function dl(e){if(0==(2&(e=e.mode)))return 1;if(0==(4&e))return 99===Hs()?1:2;if(0===rl&&(rl=Ua),0!==Ys.transition){0!==ol&&(ol=null!==Ha?Ha.pendingLanes:0),e=rl;var t=4186112&~ol;return 0===(t&=-t)&&(0===(t=(e=4186112&~e)&-e)&&(t=8192)),t}return e=Hs(),0!=(4&Ca)&&98===e?e=Vt(12,rl):e=Vt(e=function(e){switch(e){case 99:return 15;case 98:return 10;case 97:case 96:return 8;case 95:return 2;default:return 0}}(e),rl),e}function hl(e,t,i){if(50<il)throw il=0,nl=null,Error(o(185));if(null===(e=ul(e,t)))return null;Gt(e,t,i),e===Pa&&(Fa|=t,4===Ra&&fl(e,Na));var n=Hs();1===t?0!=(8&Ca)&&0==(48&Ca)?gl(e):(pl(e,i),0===Ca&&(za(),Ws())):(0==(4&Ca)||98!==n&&99!==n||(null===tl?tl=new Set([e]):tl.add(e)),pl(e,i)),Ha=e}function ul(e,t){e.lanes|=t;var i=e.alternate;for(null!==i&&(i.lanes|=t),i=e,e=e.return;null!==e;)e.childLanes|=t,null!==(i=e.alternate)&&(i.childLanes|=t),i=e,e=e.return;return 3===i.tag?i.stateNode:null}function pl(e,t){for(var i=e.callbackNode,n=e.suspendedLanes,s=e.pingedLanes,r=e.expirationTimes,a=e.pendingLanes;0<a;){var l=31-zt(a),c=1<<l,d=r[l];if(-1===d){if(0==(c&n)||0!=(c&s)){d=t,Ut(c);var h=kt;r[l]=10<=h?d+250:6<=h?d+5e3:-1}}else d<=t&&(e.expiredLanes|=c);a&=~c}if(n=Bt(e,e===Pa?Na:0),t=kt,0===n)null!==i&&(i!==Ls&&xs(i),e.callbackNode=null,e.callbackPriority=0);else{if(null!==i){if(e.callbackPriority===t)return;i!==Ls&&xs(i)}15===t?(i=gl.bind(null,e),null===ks?(ks=[i],Us=ws(Cs,Ks)):ks.push(i),i=Ls):14===t?i=zs(99,gl.bind(null,e)):i=zs(i=function(e){switch(e){case 15:case 14:return 99;case 13:case 12:case 11:case 10:return 98;case 9:case 8:case 7:case 6:case 4:case 5:return 97;case 3:case 2:case 1:return 95;case 0:return 90;default:throw Error(o(358,e))}}(t),ml.bind(null,e)),e.callbackPriority=t,e.callbackNode=i}}function ml(e){if(sl=-1,ol=rl=0,0!=(48&Ca))throw Error(o(327));var t=e.callbackNode;if(Nl()&&e.callbackNode!==t)return null;var i=Bt(e,e===Pa?Na:0);if(0===i)return null;var n=i,s=Ca;Ca|=16;var r=wl();for(Pa===e&&Na===n||(za(),El(e,n));;)try{Ml();break}catch(t){Tl(e,t)}if(Js(),Oa.current=r,Ca=s,null!==Da?n=0:(Pa=null,Na=0,n=Ra),0!=(Ua&Fa))El(e,0);else if(0!==n){if(2===n&&(Ca|=64,e.hydrate&&(e.hydrate=!1,zn(e.containerInfo)),0!==(i=Ft(e))&&(n=xl(e,i))),1===n)throw t=ka,El(e,0),fl(e,i),pl(e,Vs()),t;switch(e.finishedWork=e.current.alternate,e.finishedLanes=i,n){case 0:case 1:throw Error(o(345));case 2:Cl(e);break;case 3:if(fl(e,i),(62914560&i)===i&&10<(n=ja+500-Vs())){if(0!==Bt(e,0))break;if(((s=e.suspendedLanes)&i)!==i){cl(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=jn(Cl.bind(null,e),n);break}Cl(e);break;case 4:if(fl(e,i),(4186112&i)===i)break;for(n=e.eventTimes,s=-1;0<i;){var a=31-zt(i);r=1<<a,(a=n[a])>s&&(s=a),i&=~r}if(i=s,10<(i=(120>(i=Vs()-i)?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Ma(i/1960))-i)){e.timeoutHandle=jn(Cl.bind(null,e),i);break}Cl(e);break;case 5:Cl(e);break;default:throw Error(o(329))}}return pl(e,Vs()),e.callbackNode===t?ml.bind(null,e):null}function fl(e,t){for(t&=~Va,t&=~Fa,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var i=31-zt(t),n=1<<i;e[i]=-1,t&=~n}}function gl(e){if(0!=(48&Ca))throw Error(o(327));if(Nl(),e===Pa&&0!=(e.expiredLanes&Na)){var t=Na,i=xl(e,t);0!=(Ua&Fa)&&(i=xl(e,t=Bt(e,t)))}else i=xl(e,t=Bt(e,0));if(0!==e.tag&&2===i&&(Ca|=64,e.hydrate&&(e.hydrate=!1,zn(e.containerInfo)),0!==(t=Ft(e))&&(i=xl(e,t))),1===i)throw i=ka,El(e,0),fl(e,t),pl(e,Vs()),i;return e.finishedWork=e.current.alternate,e.finishedLanes=t,Cl(e),pl(e,Vs()),null}function vl(e,t){var i=Ca;Ca|=1;try{return e(t)}finally{0===(Ca=i)&&(za(),Ws())}}function yl(e,t){var i=Ca;Ca&=-2,Ca|=8;try{return e(t)}finally{0===(Ca=i)&&(za(),Ws())}}function bl(e,t){ls(La,Ia),Ia|=t,Ua|=t}function Sl(){Ia=La.current,as(La)}function El(e,t){e.finishedWork=null,e.finishedLanes=0;var i=e.timeoutHandle;if(-1!==i&&(e.timeoutHandle=-1,Gn(i)),null!==Da)for(i=Da.return;null!==i;){var n=i;switch(n.tag){case 1:null!=(n=n.type.childContextTypes)&&fs();break;case 3:Dr(),as(hs),as(ds),Kr();break;case 5:Ir(n);break;case 4:Dr();break;case 13:case 19:as(Lr);break;case 10:er(n);break;case 23:case 24:Sl()}i=i.return}Pa=e,Da=Gl(e.current,null),Na=Ia=Ua=t,Ra=0,ka=null,Va=Fa=Ba=0}function Tl(e,t){for(;;){var i=Da;try{if(Js(),Yr.current=Co,Jr){for(var n=$r.memoizedState;null!==n;){var s=n.queue;null!==s&&(s.pending=null),n=n.next}Jr=!1}if(Zr=0,Xr=Qr=$r=null,eo=!1,Aa.current=null,null===i||null===i.return){Ra=1,ka=t,Da=null;break}e:{var r=e,o=i.return,a=i,l=t;if(t=Na,a.flags|=2048,a.firstEffect=a.lastEffect=null,null!==l&&"object"==typeof l&&"function"==typeof l.then){var c=l;if(0==(2&a.mode)){var d=a.alternate;d?(a.updateQueue=d.updateQueue,a.memoizedState=d.memoizedState,a.lanes=d.lanes):(a.updateQueue=null,a.memoizedState=null)}var h=0!=(1&Lr.current),u=o;do{var p;if(p=13===u.tag){var m=u.memoizedState;if(null!==m)p=null!==m.dehydrated;else{var f=u.memoizedProps;p=void 0!==f.fallback&&(!0!==f.unstable_avoidThisFallback||!h)}}if(p){var g=u.updateQueue;if(null===g){var v=new Set;v.add(c),u.updateQueue=v}else g.add(c);if(0==(2&u.mode)){if(u.flags|=64,a.flags|=16384,a.flags&=-2981,1===a.tag)if(null===a.alternate)a.tag=17;else{var y=ar(-1,1);y.tag=2,lr(a,y)}a.lanes|=1;break e}l=void 0,a=t;var b=r.pingCache;if(null===b?(b=r.pingCache=new la,l=new Set,b.set(c,l)):void 0===(l=b.get(c))&&(l=new Set,b.set(c,l)),!l.has(a)){l.add(a);var S=Bl.bind(null,r,c,a);c.then(S,S)}u.flags|=4096,u.lanes=t;break e}u=u.return}while(null!==u);l=Error((Y(a.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display.")}5!==Ra&&(Ra=2),l=oa(l,a),u=o;do{switch(u.tag){case 3:r=l,u.flags|=4096,t&=-t,u.lanes|=t,cr(u,ca(0,r,t));break e;case 1:r=l;var E=u.type,T=u.stateNode;if(0==(64&u.flags)&&("function"==typeof E.getDerivedStateFromError||null!==T&&"function"==typeof T.componentDidCatch&&(null===Za||!Za.has(T)))){u.flags|=4096,t&=-t,u.lanes|=t,cr(u,da(u,r,t));break e}}u=u.return}while(null!==u)}Al(i)}catch(e){t=e,Da===i&&null!==i&&(Da=i=i.return);continue}break}}function wl(){var e=Oa.current;return Oa.current=Co,null===e?Co:e}function xl(e,t){var i=Ca;Ca|=16;var n=wl();for(Pa===e&&Na===t||El(e,t);;)try{_l();break}catch(t){Tl(e,t)}if(Js(),Ca=i,Oa.current=n,null!==Da)throw Error(o(261));return Pa=null,Na=0,Ra}function _l(){for(;null!==Da;)Ol(Da)}function Ml(){for(;null!==Da&&!_s();)Ol(Da)}function Ol(e){var t=Wa(e.alternate,e,Ia);e.memoizedProps=e.pendingProps,null===t?Al(e):Da=t,Aa.current=null}function Al(e){var t=e;do{var i=t.alternate;if(e=t.return,0==(2048&t.flags)){if(null!==(i=sa(i,t,Ia)))return void(Da=i);if(24!==(i=t).tag&&23!==i.tag||null===i.memoizedState||0!=(1073741824&Ia)||0==(4&i.mode)){for(var n=0,s=i.child;null!==s;)n|=s.lanes|s.childLanes,s=s.sibling;i.childLanes=n}null!==e&&0==(2048&e.flags)&&(null===e.firstEffect&&(e.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=t.firstEffect),e.lastEffect=t.lastEffect),1<t.flags&&(null!==e.lastEffect?e.lastEffect.nextEffect=t:e.firstEffect=t,e.lastEffect=t))}else{if(null!==(i=ra(t)))return i.flags&=2047,void(Da=i);null!==e&&(e.firstEffect=e.lastEffect=null,e.flags|=2048)}if(null!==(t=t.sibling))return void(Da=t);Da=t=e}while(null!==t);0===Ra&&(Ra=5)}function Cl(e){var t=Hs();return Gs(99,Pl.bind(null,e,t)),null}function Pl(e,t){do{Nl()}while(null!==Qa);if(0!=(48&Ca))throw Error(o(327));var i=e.finishedWork;if(null===i)return null;if(e.finishedWork=null,e.finishedLanes=0,i===e.current)throw Error(o(177));e.callbackNode=null;var n=i.lanes|i.childLanes,s=n,r=e.pendingLanes&~s;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=s,e.mutableReadLanes&=s,e.entangledLanes&=s,s=e.entanglements;for(var a=e.eventTimes,l=e.expirationTimes;0<r;){var c=31-zt(r),d=1<<c;s[c]=0,a[c]=-1,l[c]=-1,r&=~d}if(null!==tl&&0==(24&n)&&tl.has(e)&&tl.delete(e),e===Pa&&(Da=Pa=null,Na=0),1<i.flags?null!==i.lastEffect?(i.lastEffect.nextEffect=i,n=i.firstEffect):n=i:n=i.firstEffect,null!==n){if(s=Ca,Ca|=32,Aa.current=null,Bn=Zt,mn(a=pn())){if("selectionStart"in a)l={start:a.selectionStart,end:a.selectionEnd};else e:if(l=(l=a.ownerDocument)&&l.defaultView||window,(d=l.getSelection&&l.getSelection())&&0!==d.rangeCount){l=d.anchorNode,r=d.anchorOffset,c=d.focusNode,d=d.focusOffset;try{l.nodeType,c.nodeType}catch(e){l=null;break e}var h=0,u=-1,p=-1,m=0,f=0,g=a,v=null;t:for(;;){for(var y;g!==l||0!==r&&3!==g.nodeType||(u=h+r),g!==c||0!==d&&3!==g.nodeType||(p=h+d),3===g.nodeType&&(h+=g.nodeValue.length),null!==(y=g.firstChild);)v=g,g=y;for(;;){if(g===a)break t;if(v===l&&++m===r&&(u=h),v===c&&++f===d&&(p=h),null!==(y=g.nextSibling))break;v=(g=v).parentNode}g=y}l=-1===u||-1===p?null:{start:u,end:p}}else l=null;l=l||{start:0,end:0}}else l=null;Fn={focusedElem:a,selectionRange:l},Zt=!1,al=null,ll=!1,Ka=n;do{try{Dl()}catch(e){if(null===Ka)throw Error(o(330));Ul(Ka,e),Ka=Ka.nextEffect}}while(null!==Ka);al=null,Ka=n;do{try{for(a=e;null!==Ka;){var b=Ka.flags;if(16&b&&ye(Ka.stateNode,""),128&b){var S=Ka.alternate;if(null!==S){var E=S.ref;null!==E&&("function"==typeof E?E(null):E.current=null)}}switch(1038&b){case 2:ba(Ka),Ka.flags&=-3;break;case 6:ba(Ka),Ka.flags&=-3,wa(Ka.alternate,Ka);break;case 1024:Ka.flags&=-1025;break;case 1028:Ka.flags&=-1025,wa(Ka.alternate,Ka);break;case 4:wa(Ka.alternate,Ka);break;case 8:Ta(a,l=Ka);var T=l.alternate;va(l),null!==T&&va(T)}Ka=Ka.nextEffect}}catch(e){if(null===Ka)throw Error(o(330));Ul(Ka,e),Ka=Ka.nextEffect}}while(null!==Ka);if(E=Fn,S=pn(),b=E.focusedElem,a=E.selectionRange,S!==b&&b&&b.ownerDocument&&un(b.ownerDocument.documentElement,b)){null!==a&&mn(b)&&(S=a.start,void 0===(E=a.end)&&(E=S),"selectionStart"in b?(b.selectionStart=S,b.selectionEnd=Math.min(E,b.value.length)):(E=(S=b.ownerDocument||document)&&S.defaultView||window).getSelection&&(E=E.getSelection(),l=b.textContent.length,T=Math.min(a.start,l),a=void 0===a.end?T:Math.min(a.end,l),!E.extend&&T>a&&(l=a,a=T,T=l),l=hn(b,T),r=hn(b,a),l&&r&&(1!==E.rangeCount||E.anchorNode!==l.node||E.anchorOffset!==l.offset||E.focusNode!==r.node||E.focusOffset!==r.offset)&&((S=S.createRange()).setStart(l.node,l.offset),E.removeAllRanges(),T>a?(E.addRange(S),E.extend(r.node,r.offset)):(S.setEnd(r.node,r.offset),E.addRange(S))))),S=[];for(E=b;E=E.parentNode;)1===E.nodeType&&S.push({element:E,left:E.scrollLeft,top:E.scrollTop});for("function"==typeof b.focus&&b.focus(),b=0;b<S.length;b++)(E=S[b]).element.scrollLeft=E.left,E.element.scrollTop=E.top}Zt=!!Bn,Fn=Bn=null,e.current=i,Ka=n;do{try{for(b=e;null!==Ka;){var w=Ka.flags;if(36&w&&ma(b,Ka.alternate,Ka),128&w){S=void 0;var x=Ka.ref;if(null!==x){var _=Ka.stateNode;switch(Ka.tag){case 5:S=_;break;default:S=_}"function"==typeof x?x(S):x.current=S}}Ka=Ka.nextEffect}}catch(e){if(null===Ka)throw Error(o(330));Ul(Ka,e),Ka=Ka.nextEffect}}while(null!==Ka);Ka=null,Rs(),Ca=s}else e.current=i;if($a)$a=!1,Qa=e,Xa=t;else for(Ka=n;null!==Ka;)t=Ka.nextEffect,Ka.nextEffect=null,8&Ka.flags&&((w=Ka).sibling=null,w.stateNode=null),Ka=t;if(0===(n=e.pendingLanes)&&(Za=null),1===n?e===nl?il++:(il=0,nl=e):il=0,i=i.stateNode,Es&&"function"==typeof Es.onCommitFiberRoot)try{Es.onCommitFiberRoot(Ss,i,void 0,64==(64&i.current.flags))}catch(e){}if(pl(e,Vs()),Ya)throw Ya=!1,e=qa,qa=null,e;return 0!=(8&Ca)||Ws(),null}function Dl(){for(;null!==Ka;){var e=Ka.alternate;ll||null===al||(0!=(8&Ka.flags)?et(Ka,al)&&(ll=!0):13===Ka.tag&&_a(e,Ka)&&et(Ka,al)&&(ll=!0));var t=Ka.flags;0!=(256&t)&&pa(e,Ka),0==(512&t)||$a||($a=!0,zs(97,(function(){return Nl(),null}))),Ka=Ka.nextEffect}}function Nl(){if(90!==Xa){var e=97<Xa?97:Xa;return Xa=90,Gs(e,Rl)}return!1}function Il(e,t){Ja.push(t,e),$a||($a=!0,zs(97,(function(){return Nl(),null})))}function Ll(e,t){el.push(t,e),$a||($a=!0,zs(97,(function(){return Nl(),null})))}function Rl(){if(null===Qa)return!1;var e=Qa;if(Qa=null,0!=(48&Ca))throw Error(o(331));var t=Ca;Ca|=32;var i=el;el=[];for(var n=0;n<i.length;n+=2){var s=i[n],r=i[n+1],a=s.destroy;if(s.destroy=void 0,"function"==typeof a)try{a()}catch(e){if(null===r)throw Error(o(330));Ul(r,e)}}for(i=Ja,Ja=[],n=0;n<i.length;n+=2){s=i[n],r=i[n+1];try{var l=s.create;s.destroy=l()}catch(e){if(null===r)throw Error(o(330));Ul(r,e)}}for(l=e.current.firstEffect;null!==l;)e=l.nextEffect,l.nextEffect=null,8&l.flags&&(l.sibling=null,l.stateNode=null),l=e;return Ca=t,Ws(),!0}function kl(e,t,i){lr(e,t=ca(0,t=oa(i,t),1)),t=cl(),null!==(e=ul(e,1))&&(Gt(e,1,t),pl(e,t))}function Ul(e,t){if(3===e.tag)kl(e,e,t);else for(var i=e.return;null!==i;){if(3===i.tag){kl(i,e,t);break}if(1===i.tag){var n=i.stateNode;if("function"==typeof i.type.getDerivedStateFromError||"function"==typeof n.componentDidCatch&&(null===Za||!Za.has(n))){var s=da(i,e=oa(t,e),1);if(lr(i,s),s=cl(),null!==(i=ul(i,1)))Gt(i,1,s),pl(i,s);else if("function"==typeof n.componentDidCatch&&(null===Za||!Za.has(n)))try{n.componentDidCatch(t,e)}catch(e){}break}}i=i.return}}function Bl(e,t,i){var n=e.pingCache;null!==n&&n.delete(t),t=cl(),e.pingedLanes|=e.suspendedLanes&i,Pa===e&&(Na&i)===i&&(4===Ra||3===Ra&&(62914560&Na)===Na&&500>Vs()-ja?El(e,0):Va|=i),pl(e,t)}function Fl(e,t){var i=e.stateNode;null!==i&&i.delete(t),0===(t=0)&&(0==(2&(t=e.mode))?t=1:0==(4&t)?t=99===Hs()?1:2:(0===rl&&(rl=Ua),0===(t=Ht(62914560&~rl))&&(t=4194304))),i=cl(),null!==(e=ul(e,t))&&(Gt(e,t,i),pl(e,i))}function Vl(e,t,i,n){this.tag=e,this.key=i,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.flags=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childLanes=this.lanes=0,this.alternate=null}function Hl(e,t,i,n){return new Vl(e,t,i,n)}function jl(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Gl(e,t){var i=e.alternate;return null===i?((i=Hl(e.tag,t,e.key,e.mode)).elementType=e.elementType,i.type=e.type,i.stateNode=e.stateNode,i.alternate=e,e.alternate=i):(i.pendingProps=t,i.type=e.type,i.flags=0,i.nextEffect=null,i.firstEffect=null,i.lastEffect=null),i.childLanes=e.childLanes,i.lanes=e.lanes,i.child=e.child,i.memoizedProps=e.memoizedProps,i.memoizedState=e.memoizedState,i.updateQueue=e.updateQueue,t=e.dependencies,i.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},i.sibling=e.sibling,i.index=e.index,i.ref=e.ref,i}function zl(e,t,i,n,s,r){var a=2;if(n=e,"function"==typeof e)jl(e)&&(a=1);else if("string"==typeof e)a=5;else e:switch(e){case x:return Wl(i.children,s,r,t);case k:a=8,s|=16;break;case _:a=8,s|=1;break;case M:return(e=Hl(12,i,t,8|s)).elementType=M,e.type=M,e.lanes=r,e;case P:return(e=Hl(13,i,t,s)).type=P,e.elementType=P,e.lanes=r,e;case D:return(e=Hl(19,i,t,s)).elementType=D,e.lanes=r,e;case U:return Kl(i,s,r,t);case B:return(e=Hl(24,i,t,s)).elementType=B,e.lanes=r,e;default:if("object"==typeof e&&null!==e)switch(e.$$typeof){case O:a=10;break e;case A:a=9;break e;case C:a=11;break e;case N:a=14;break e;case I:a=16,n=null;break e;case L:a=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Hl(a,i,t,s)).elementType=e,t.type=n,t.lanes=r,t}function Wl(e,t,i,n){return(e=Hl(7,e,n,t)).lanes=i,e}function Kl(e,t,i,n){return(e=Hl(23,e,n,t)).elementType=U,e.lanes=i,e}function Yl(e,t,i){return(e=Hl(6,e,null,t)).lanes=i,e}function ql(e,t,i){return(t=Hl(4,null!==e.children?e.children:[],e.key,t)).lanes=i,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Zl(e,t,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=i,this.callbackNode=null,this.callbackPriority=0,this.eventTimes=jt(0),this.expirationTimes=jt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=jt(0),this.mutableSourceEagerHydrationData=null}function $l(e,t,i){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==n?null:""+n,children:e,containerInfo:t,implementation:i}}function Ql(e,t,i,n){var s=t.current,r=cl(),a=dl(s);e:if(i){t:{if($e(i=i._reactInternals)!==i||1!==i.tag)throw Error(o(170));var l=i;do{switch(l.tag){case 3:l=l.stateNode.context;break t;case 1:if(ms(l.type)){l=l.stateNode.__reactInternalMemoizedMergedChildContext;break t}}l=l.return}while(null!==l);throw Error(o(171))}if(1===i.tag){var c=i.type;if(ms(c)){i=vs(i,c,l);break e}}i=l}else i=cs;return null===t.context?t.context=i:t.pendingContext=i,(t=ar(r,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),lr(s,t),hl(s,a,r),a}function Xl(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Jl(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var i=e.retryLane;e.retryLane=0!==i&&i<t?i:t}}function ec(e,t){Jl(e,t),(e=e.alternate)&&Jl(e,t)}function tc(e,t,i){var n=null!=i&&null!=i.hydrationOptions&&i.hydrationOptions.mutableSources||null;if(i=new Zl(e,t,null!=i&&!0===i.hydrate),t=Hl(3,null,null,2===t?7:1===t?3:0),i.current=t,t.stateNode=i,rr(t),e[Qn]=i.current,Cn(8===e.nodeType?e.parentNode:e),n)for(e=0;e<n.length;e++){var s=(t=n[e])._getVersion;s=s(t._source),null==i.mutableSourceEagerHydrationData?i.mutableSourceEagerHydrationData=[t,s]:i.mutableSourceEagerHydrationData.push(t,s)}this._internalRoot=i}function ic(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function nc(e,t,i,n,s){var r=i._reactRootContainer;if(r){var o=r._internalRoot;if("function"==typeof s){var a=s;s=function(){var e=Xl(o);a.call(e)}}Ql(t,o,e,s)}else{if(r=i._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var i;i=e.lastChild;)e.removeChild(i);return new tc(e,0,t?{hydrate:!0}:void 0)}(i,n),o=r._internalRoot,"function"==typeof s){var l=s;s=function(){var e=Xl(o);l.call(e)}}yl((function(){Ql(t,o,e,s)}))}return Xl(o)}function sc(e,t){var i=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!ic(t))throw Error(o(200));return $l(e,t,null,i)}Wa=function(e,t,i){var n=t.lanes;if(null!==e)if(e.memoizedProps!==t.pendingProps||hs.current)Lo=!0;else{if(0==(i&n)){switch(Lo=!1,t.tag){case 3:zo(t),zr();break;case 5:Nr(t);break;case 1:ms(t.type)&&ys(t);break;case 4:Pr(t,t.stateNode.containerInfo);break;case 10:n=t.memoizedProps.value;var s=t.type._context;ls(Zs,s._currentValue),s._currentValue=n;break;case 13:if(null!==t.memoizedState)return 0!=(i&t.child.childLanes)?Zo(e,t,i):(ls(Lr,1&Lr.current),null!==(t=ia(e,t,i))?t.sibling:null);ls(Lr,1&Lr.current);break;case 19:if(n=0!=(i&t.childLanes),0!=(64&e.flags)){if(n)return ta(e,t,i);t.flags|=64}if(null!==(s=t.memoizedState)&&(s.rendering=null,s.tail=null,s.lastEffect=null),ls(Lr,Lr.current),n)break;return null;case 23:case 24:return t.lanes=0,Fo(e,t,i)}return ia(e,t,i)}Lo=0!=(16384&e.flags)}else Lo=!1;switch(t.lanes=0,t.tag){case 2:if(n=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,s=ps(t,ds.current),ir(t,i),s=no(null,t,n,e,s,i),t.flags|=1,"object"==typeof s&&null!==s&&"function"==typeof s.render&&void 0===s.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,ms(n)){var r=!0;ys(t)}else r=!1;t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,rr(t);var a=n.getDerivedStateFromProps;"function"==typeof a&&pr(t,n,a,e),s.updater=mr,t.stateNode=s,s._reactInternals=t,yr(t,n,e,i),t=Go(null,t,n,!0,r,i)}else t.tag=0,Ro(null,t,s,i),t=t.child;return t;case 16:s=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,s=(r=s._init)(s._payload),t.type=s,r=t.tag=function(e){if("function"==typeof e)return jl(e)?1:0;if(null!=e){if((e=e.$$typeof)===C)return 11;if(e===N)return 14}return 2}(s),e=qs(s,e),r){case 0:t=Ho(null,t,s,e,i);break e;case 1:t=jo(null,t,s,e,i);break e;case 11:t=ko(null,t,s,e,i);break e;case 14:t=Uo(null,t,s,qs(s.type,e),n,i);break e}throw Error(o(306,s,""))}return t;case 0:return n=t.type,s=t.pendingProps,Ho(e,t,n,s=t.elementType===n?s:qs(n,s),i);case 1:return n=t.type,s=t.pendingProps,jo(e,t,n,s=t.elementType===n?s:qs(n,s),i);case 3:if(zo(t),n=t.updateQueue,null===e||null===n)throw Error(o(282));if(n=t.pendingProps,s=null!==(s=t.memoizedState)?s.element:null,or(e,t),dr(t,n,null,i),(n=t.memoizedState.element)===s)zr(),t=ia(e,t,i);else{if((r=(s=t.stateNode).hydrate)&&(Ur=Wn(t.stateNode.containerInfo.firstChild),kr=t,r=Br=!0),r){if(null!=(e=s.mutableSourceEagerHydrationData))for(s=0;s<e.length;s+=2)(r=e[s])._workInProgressVersionPrimary=e[s+1],Wr.push(r);for(i=xr(t,null,n,i),t.child=i;i;)i.flags=-3&i.flags|1024,i=i.sibling}else Ro(e,t,n,i),zr();t=t.child}return t;case 5:return Nr(t),null===e&&Hr(t),n=t.type,s=t.pendingProps,r=null!==e?e.memoizedProps:null,a=s.children,Hn(n,s)?a=null:null!==r&&Hn(n,r)&&(t.flags|=16),Vo(e,t),Ro(e,t,a,i),t.child;case 6:return null===e&&Hr(t),null;case 13:return Zo(e,t,i);case 4:return Pr(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=wr(t,null,n,i):Ro(e,t,n,i),t.child;case 11:return n=t.type,s=t.pendingProps,ko(e,t,n,s=t.elementType===n?s:qs(n,s),i);case 7:return Ro(e,t,t.pendingProps,i),t.child;case 8:case 12:return Ro(e,t,t.pendingProps.children,i),t.child;case 10:e:{n=t.type._context,s=t.pendingProps,a=t.memoizedProps,r=s.value;var l=t.type._context;if(ls(Zs,l._currentValue),l._currentValue=r,null!==a)if(l=a.value,0===(r=an(l,r)?0:0|("function"==typeof n._calculateChangedBits?n._calculateChangedBits(l,r):1073741823))){if(a.children===s.children&&!hs.current){t=ia(e,t,i);break e}}else for(null!==(l=t.child)&&(l.return=t);null!==l;){var c=l.dependencies;if(null!==c){a=l.child;for(var d=c.firstContext;null!==d;){if(d.context===n&&0!=(d.observedBits&r)){1===l.tag&&((d=ar(-1,i&-i)).tag=2,lr(l,d)),l.lanes|=i,null!==(d=l.alternate)&&(d.lanes|=i),tr(l.return,i),c.lanes|=i;break}d=d.next}}else a=10===l.tag&&l.type===t.type?null:l.child;if(null!==a)a.return=l;else for(a=l;null!==a;){if(a===t){a=null;break}if(null!==(l=a.sibling)){l.return=a.return,a=l;break}a=a.return}l=a}Ro(e,t,s.children,i),t=t.child}return t;case 9:return s=t.type,n=(r=t.pendingProps).children,ir(t,i),n=n(s=nr(s,r.unstable_observedBits)),t.flags|=1,Ro(e,t,n,i),t.child;case 14:return r=qs(s=t.type,t.pendingProps),Uo(e,t,s,r=qs(s.type,r),n,i);case 15:return Bo(e,t,t.type,t.pendingProps,n,i);case 17:return n=t.type,s=t.pendingProps,s=t.elementType===n?s:qs(n,s),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,ms(n)?(e=!0,ys(t)):e=!1,ir(t,i),gr(t,n,s),yr(t,n,s,i),Go(null,t,n,!0,e,i);case 19:return ta(e,t,i);case 23:case 24:return Fo(e,t,i)}throw Error(o(156,t.tag))},tc.prototype.render=function(e){Ql(e,this._internalRoot,null,null)},tc.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;Ql(null,e,null,(function(){t[Qn]=null}))},tt=function(e){13===e.tag&&(hl(e,4,cl()),ec(e,4))},it=function(e){13===e.tag&&(hl(e,67108864,cl()),ec(e,67108864))},nt=function(e){if(13===e.tag){var t=cl(),i=dl(e);hl(e,i,t),ec(e,i)}},st=function(e,t){return t()},Oe=function(e,t,i){switch(t){case"input":if(ie(e,i),t=i.name,"radio"===i.type&&null!=t){for(i=e;i.parentNode;)i=i.parentNode;for(i=i.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<i.length;t++){var n=i[t];if(n!==e&&n.form===e.form){var s=is(n);if(!s)throw Error(o(90));Q(n),ie(n,s)}}}break;case"textarea":ce(e,i);break;case"select":null!=(t=i.value)&&oe(e,!!i.multiple,t,!1)}},Ie=vl,Le=function(e,t,i,n,s){var r=Ca;Ca|=4;try{return Gs(98,e.bind(null,t,i,n,s))}finally{0===(Ca=r)&&(za(),Ws())}},Re=function(){0==(49&Ca)&&(function(){if(null!==tl){var e=tl;tl=null,e.forEach((function(e){e.expiredLanes|=24&e.pendingLanes,pl(e,Vs())}))}Ws()}(),Nl())},ke=function(e,t){var i=Ca;Ca|=2;try{return e(t)}finally{0===(Ca=i)&&(za(),Ws())}};var rc={Events:[es,ts,is,De,Ne,Nl,{current:!1}]},oc={findFiberByHostInstance:Jn,bundleType:0,version:"17.0.2",rendererPackageName:"react-dom"},ac={bundleType:oc.bundleType,version:oc.version,rendererPackageName:oc.rendererPackageName,rendererConfig:oc.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Je(e))?null:e.stateNode},findFiberByHostInstance:oc.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null};if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var lc=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!lc.isDisabled&&lc.supportsFiber)try{Ss=lc.inject(ac),Es=lc}catch(ge){}}t.render=function(e,t,i){if(!ic(t))throw Error(o(200));return nc(null,e,t,!1,i)},t.unmountComponentAtNode=function(e){if(!ic(e))throw Error(o(40));return!!e._reactRootContainer&&(yl((function(){nc(null,null,e,!1,(function(){e._reactRootContainer=null,e[Qn]=null}))})),!0)},t.unstable_batchedUpdates=vl},73935:(e,t,i)=>{"use strict";!function e(){if("undefined"!=typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(e){console.error(e)}}(),e.exports=i(64448)},69590:e=>{var t="undefined"!=typeof Element,i="function"==typeof Map,n="function"==typeof Set,s="function"==typeof ArrayBuffer&&!!ArrayBuffer.isView;function r(e,o){if(e===o)return!0;if(e&&o&&"object"==typeof e&&"object"==typeof o){if(e.constructor!==o.constructor)return!1;var a,l,c,d;if(Array.isArray(e)){if((a=e.length)!=o.length)return!1;for(l=a;0!=l--;)if(!r(e[l],o[l]))return!1;return!0}if(i&&e instanceof Map&&o instanceof Map){if(e.size!==o.size)return!1;for(d=e.entries();!(l=d.next()).done;)if(!o.has(l.value[0]))return!1;for(d=e.entries();!(l=d.next()).done;)if(!r(l.value[1],o.get(l.value[0])))return!1;return!0}if(n&&e instanceof Set&&o instanceof Set){if(e.size!==o.size)return!1;for(d=e.entries();!(l=d.next()).done;)if(!o.has(l.value[0]))return!1;return!0}if(s&&ArrayBuffer.isView(e)&&ArrayBuffer.isView(o)){if((a=e.length)!=o.length)return!1;for(l=a;0!=l--;)if(e[l]!==o[l])return!1;return!0}if(e.constructor===RegExp)return e.source===o.source&&e.flags===o.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===o.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===o.toString();if((a=(c=Object.keys(e)).length)!==Object.keys(o).length)return!1;for(l=a;0!=l--;)if(!Object.prototype.hasOwnProperty.call(o,c[l]))return!1;if(t&&e instanceof Element)return!1;for(l=a;0!=l--;)if(("_owner"!==c[l]&&"__v"!==c[l]&&"__o"!==c[l]||!e.$$typeof)&&!r(e[c[l]],o[c[l]]))return!1;return!0}return e!=e&&o!=o}e.exports=function(e,t){try{return r(e,t)}catch(e){if((e.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw e}}},75251:(e,t,i)=>{"use strict";i(27418);var n=i(67294),s=60103;if(t.Fragment=60107,"function"==typeof Symbol&&Symbol.for){var r=Symbol.for;s=r("react.element"),t.Fragment=r("react.fragment")}var o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a=Object.prototype.hasOwnProperty,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,i){var n,r={},c=null,d=null;for(n in void 0!==i&&(c=""+i),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(r[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===r[n]&&(r[n]=t[n]);return{$$typeof:s,type:e,key:c,ref:d,props:r,_owner:o.current}}t.jsx=c,t.jsxs=c},72408:(e,t,i)=>{"use strict";var n=i(27418),s=60103,r=60106;t.Fragment=60107,t.StrictMode=60108,t.Profiler=60114;var o=60109,a=60110,l=60112;t.Suspense=60113;var c=60115,d=60116;if("function"==typeof Symbol&&Symbol.for){var h=Symbol.for;s=h("react.element"),r=h("react.portal"),t.Fragment=h("react.fragment"),t.StrictMode=h("react.strict_mode"),t.Profiler=h("react.profiler"),o=h("react.provider"),a=h("react.context"),l=h("react.forward_ref"),t.Suspense=h("react.suspense"),c=h("react.memo"),d=h("react.lazy")}var u="function"==typeof Symbol&&Symbol.iterator;function p(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,i=1;i<arguments.length;i++)t+="&args[]="+encodeURIComponent(arguments[i]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var m={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},f={};function g(e,t,i){this.props=e,this.context=t,this.refs=f,this.updater=i||m}function v(){}function y(e,t,i){this.props=e,this.context=t,this.refs=f,this.updater=i||m}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(p(85));this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=g.prototype;var b=y.prototype=new v;b.constructor=y,n(b,g.prototype),b.isPureReactComponent=!0;var S={current:null},E=Object.prototype.hasOwnProperty,T={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,i){var n,r={},o=null,a=null;if(null!=t)for(n in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(o=""+t.key),t)E.call(t,n)&&!T.hasOwnProperty(n)&&(r[n]=t[n]);var l=arguments.length-2;if(1===l)r.children=i;else if(1<l){for(var c=Array(l),d=0;d<l;d++)c[d]=arguments[d+2];r.children=c}if(e&&e.defaultProps)for(n in l=e.defaultProps)void 0===r[n]&&(r[n]=l[n]);return{$$typeof:s,type:e,key:o,ref:a,props:r,_owner:S.current}}function x(e){return"object"==typeof e&&null!==e&&e.$$typeof===s}var _=/\/+/g;function M(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function O(e,t,i,n,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l=!1;if(null===e)l=!0;else switch(a){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case s:case r:l=!0}}if(l)return o=o(l=e),e=""===n?"."+M(l,0):n,Array.isArray(o)?(i="",null!=e&&(i=e.replace(_,"$&/")+"/"),O(o,t,i,"",(function(e){return e}))):null!=o&&(x(o)&&(o=function(e,t){return{$$typeof:s,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,i+(!o.key||l&&l.key===o.key?"":(""+o.key).replace(_,"$&/")+"/")+e)),t.push(o)),1;if(l=0,n=""===n?".":n+":",Array.isArray(e))for(var c=0;c<e.length;c++){var d=n+M(a=e[c],c);l+=O(a,t,i,d,o)}else if("function"==typeof(d=function(e){return null===e||"object"!=typeof e?null:"function"==typeof(e=u&&e[u]||e["@@iterator"])?e:null}(e)))for(e=d.call(e),c=0;!(a=e.next()).done;)l+=O(a=a.value,t,i,d=n+M(a,c++),o);else if("object"===a)throw t=""+e,Error(p(31,"[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t));return l}function A(e,t,i){if(null==e)return e;var n=[],s=0;return O(e,n,"","",(function(e){return t.call(i,e,s++)})),n}function C(e){if(-1===e._status){var t=e._result;t=t(),e._status=0,e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}if(1===e._status)return e._result;throw e._result}var P={current:null};function D(){var e=P.current;if(null===e)throw Error(p(321));return e}var N={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:{transition:0},ReactCurrentOwner:S,IsSomeRendererActing:{current:!1},assign:n};t.Children={map:A,forEach:function(e,t,i){A(e,(function(){t.apply(this,arguments)}),i)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!x(e))throw Error(p(143));return e}},t.Component=g,t.PureComponent=y,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=N,t.cloneElement=function(e,t,i){if(null==e)throw Error(p(267,e));var r=n({},e.props),o=e.key,a=e.ref,l=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,l=S.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(d in t)E.call(t,d)&&!T.hasOwnProperty(d)&&(r[d]=void 0===t[d]&&void 0!==c?c[d]:t[d])}var d=arguments.length-2;if(1===d)r.children=i;else if(1<d){c=Array(d);for(var h=0;h<d;h++)c[h]=arguments[h+2];r.children=c}return{$$typeof:s,type:e.type,key:o,ref:a,props:r,_owner:l}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:a,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=w,t.createFactory=function(e){var t=w.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:l,render:e}},t.isValidElement=x,t.lazy=function(e){return{$$typeof:d,_payload:{_status:-1,_result:e},_init:C}},t.memo=function(e,t){return{$$typeof:c,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return D().useCallback(e,t)},t.useContext=function(e,t){return D().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return D().useEffect(e,t)},t.useImperativeHandle=function(e,t,i){return D().useImperativeHandle(e,t,i)},t.useLayoutEffect=function(e,t){return D().useLayoutEffect(e,t)},t.useMemo=function(e,t){return D().useMemo(e,t)},t.useReducer=function(e,t,i){return D().useReducer(e,t,i)},t.useRef=function(e){return D().useRef(e)},t.useState=function(e){return D().useState(e)},t.version="17.0.2"},67294:(e,t,i)=>{"use strict";e.exports=i(72408)},85893:(e,t,i)=>{"use strict";e.exports=i(75251)},60053:(e,t)=>{"use strict";var i,n,s,r;if("object"==typeof performance&&"function"==typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}if("undefined"==typeof window||"function"!=typeof MessageChannel){var c=null,d=null,h=function(){if(null!==c)try{var e=t.unstable_now();c(!0,e),c=null}catch(e){throw setTimeout(h,0),e}};i=function(e){null!==c?setTimeout(i,0,e):(c=e,setTimeout(h,0))},n=function(e,t){d=setTimeout(e,t)},s=function(){clearTimeout(d)},t.unstable_shouldYield=function(){return!1},r=t.unstable_forceFrameRate=function(){}}else{var u=window.setTimeout,p=window.clearTimeout;if("undefined"!=typeof console){var m=window.cancelAnimationFrame;"function"!=typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills"),"function"!=typeof m&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://reactjs.org/link/react-polyfills")}var f=!1,g=null,v=-1,y=5,b=0;t.unstable_shouldYield=function(){return t.unstable_now()>=b},r=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):y=0<e?Math.floor(1e3/e):5};var S=new MessageChannel,E=S.port2;S.port1.onmessage=function(){if(null!==g){var e=t.unstable_now();b=e+y;try{g(!0,e)?E.postMessage(null):(f=!1,g=null)}catch(e){throw E.postMessage(null),e}}else f=!1},i=function(e){g=e,f||(f=!0,E.postMessage(null))},n=function(e,i){v=u((function(){e(t.unstable_now())}),i)},s=function(){p(v),v=-1}}function T(e,t){var i=e.length;e.push(t);e:for(;;){var n=i-1>>>1,s=e[n];if(!(void 0!==s&&0<_(s,t)))break e;e[n]=t,e[i]=s,i=n}}function w(e){return void 0===(e=e[0])?null:e}function x(e){var t=e[0];if(void 0!==t){var i=e.pop();if(i!==t){e[0]=i;e:for(var n=0,s=e.length;n<s;){var r=2*(n+1)-1,o=e[r],a=r+1,l=e[a];if(void 0!==o&&0>_(o,i))void 0!==l&&0>_(l,o)?(e[n]=l,e[a]=i,n=a):(e[n]=o,e[r]=i,n=r);else{if(!(void 0!==l&&0>_(l,i)))break e;e[n]=l,e[a]=i,n=a}}}return t}return null}function _(e,t){var i=e.sortIndex-t.sortIndex;return 0!==i?i:e.id-t.id}var M=[],O=[],A=1,C=null,P=3,D=!1,N=!1,I=!1;function L(e){for(var t=w(O);null!==t;){if(null===t.callback)x(O);else{if(!(t.startTime<=e))break;x(O),t.sortIndex=t.expirationTime,T(M,t)}t=w(O)}}function R(e){if(I=!1,L(e),!N)if(null!==w(M))N=!0,i(k);else{var t=w(O);null!==t&&n(R,t.startTime-e)}}function k(e,i){N=!1,I&&(I=!1,s()),D=!0;var r=P;try{for(L(i),C=w(M);null!==C&&(!(C.expirationTime>i)||e&&!t.unstable_shouldYield());){var o=C.callback;if("function"==typeof o){C.callback=null,P=C.priorityLevel;var a=o(C.expirationTime<=i);i=t.unstable_now(),"function"==typeof a?C.callback=a:C===w(M)&&x(M),L(i)}else x(M);C=w(M)}if(null!==C)var l=!0;else{var c=w(O);null!==c&&n(R,c.startTime-i),l=!1}return l}finally{C=null,P=r,D=!1}}var U=r;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){N||D||(N=!0,i(k))},t.unstable_getCurrentPriorityLevel=function(){return P},t.unstable_getFirstCallbackNode=function(){return w(M)},t.unstable_next=function(e){switch(P){case 1:case 2:case 3:var t=3;break;default:t=P}var i=P;P=t;try{return e()}finally{P=i}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=U,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var i=P;P=e;try{return t()}finally{P=i}},t.unstable_scheduleCallback=function(e,r,o){var a=t.unstable_now();switch("object"==typeof o&&null!==o?o="number"==typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var l=-1;break;case 2:l=250;break;case 5:l=1073741823;break;case 4:l=1e4;break;default:l=5e3}return e={id:A++,callback:r,priorityLevel:e,startTime:o,expirationTime:l=o+l,sortIndex:-1},o>a?(e.sortIndex=o,T(O,e),null===w(M)&&e===w(O)&&(I?s():I=!0,n(R,o-a))):(e.sortIndex=l,T(M,e),N||D||(N=!0,i(k))),e},t.unstable_wrapCallback=function(e){var t=P;return function(){var i=P;P=t;try{return e.apply(this,arguments)}finally{P=i}}}},63840:(e,t,i)=>{"use strict";e.exports=i(60053)},61040:(e,t,i)=>{"use strict";var n=i(11132),s=i(22566),r=i(21924)("String.prototype.replace"),o=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+/,a=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]+$/;e.exports=function(){var e=s(n(this));return r(r(e,o,""),a,"")}},46057:(e,t,i)=>{"use strict";var n=i(55559),s=i(4289),r=i(61040),o=i(30254),a=i(60029),l=n(o());s(l,{getPolyfill:o,implementation:r,shim:a}),e.exports=l},11132:(e,t,i)=>{"use strict";e.exports=i(37981)},22566:(e,t,i)=>{"use strict";var n=i(18989),s=n("%String%"),r=n("%TypeError%");e.exports=function(e){if("symbol"==typeof e)throw new r("Cannot convert a Symbol value to a string");return s(e)}},37981:(e,t,i)=>{"use strict";var n=i(18989)("%TypeError%");e.exports=function(e,t){if(null==e)throw new n(t||"Cannot call method on "+e);return e}},18989:(e,t,i)=>{"use strict";var n,s=SyntaxError,r=Function,o=TypeError,a=function(e){try{return Function('"use strict"; return ('+e+").constructor;")()}catch(e){}},l=Object.getOwnPropertyDescriptor;if(l)try{l({},"")}catch(e){l=null}var c=function(){throw new o},d=l?function(){try{return c}catch(e){try{return l(arguments,"callee").get}catch(e){return c}}}():c,h=i(41405)(),u=Object.getPrototypeOf||function(e){return e.__proto__},p=a("async function* () {}"),m=p?p.prototype:n,f=m?m.prototype:n,g="undefined"==typeof Uint8Array?n:u(Uint8Array),v={"%AggregateError%":"undefined"==typeof AggregateError?n:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?n:ArrayBuffer,"%ArrayIteratorPrototype%":h?u([][Symbol.iterator]()):n,"%AsyncFromSyncIteratorPrototype%":n,"%AsyncFunction%":a("async function () {}"),"%AsyncGenerator%":m,"%AsyncGeneratorFunction%":p,"%AsyncIteratorPrototype%":f?u(f):n,"%Atomics%":"undefined"==typeof Atomics?n:Atomics,"%BigInt%":"undefined"==typeof BigInt?n:BigInt,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?n:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?n:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?n:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?n:FinalizationRegistry,"%Function%":r,"%GeneratorFunction%":a("function* () {}"),"%Int8Array%":"undefined"==typeof Int8Array?n:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?n:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?n:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":h?u(u([][Symbol.iterator]())):n,"%JSON%":"object"==typeof JSON?JSON:n,"%Map%":"undefined"==typeof Map?n:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&h?u((new Map)[Symbol.iterator]()):n,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?n:Promise,"%Proxy%":"undefined"==typeof Proxy?n:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?n:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?n:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&h?u((new Set)[Symbol.iterator]()):n,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?n:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":h?u(""[Symbol.iterator]()):n,"%Symbol%":h?Symbol:n,"%SyntaxError%":s,"%ThrowTypeError%":d,"%TypedArray%":g,"%TypeError%":o,"%Uint8Array%":"undefined"==typeof Uint8Array?n:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?n:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?n:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?n:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?n:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?n:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?n:WeakSet},y={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},b=i(58612),S=i(17642),E=b.call(Function.call,Array.prototype.concat),T=b.call(Function.apply,Array.prototype.splice),w=b.call(Function.call,String.prototype.replace),x=b.call(Function.call,String.prototype.slice),_=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,M=/\\(\\)?/g,O=function(e){var t=x(e,0,1),i=x(e,-1);if("%"===t&&"%"!==i)throw new s("invalid intrinsic syntax, expected closing `%`");if("%"===i&&"%"!==t)throw new s("invalid intrinsic syntax, expected opening `%`");var n=[];return w(e,_,(function(e,t,i,s){n[n.length]=i?w(s,M,"$1"):t||e})),n},A=function(e,t){var i,n=e;if(S(y,n)&&(n="%"+(i=y[n])[0]+"%"),S(v,n)){var r=v[n];if(void 0===r&&!t)throw new o("intrinsic "+e+" exists, but is not available. Please file an issue!");return{alias:i,name:n,value:r}}throw new s("intrinsic "+e+" does not exist!")};e.exports=function(e,t){if("string"!=typeof e||0===e.length)throw new o("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof t)throw new o('"allowMissing" argument must be a boolean');var i=O(e),n=i.length>0?i[0]:"",r=A("%"+n+"%",t),a=r.name,c=r.value,d=!1,h=r.alias;h&&(n=h[0],T(i,E([0,1],h)));for(var u=1,p=!0;u<i.length;u+=1){var m=i[u],f=x(m,0,1),g=x(m,-1);if(('"'===f||"'"===f||"`"===f||'"'===g||"'"===g||"`"===g)&&f!==g)throw new s("property names with quotes must have matching quotes");if("constructor"!==m&&p||(d=!0),S(v,a="%"+(n+="."+m)+"%"))c=v[a];else if(null!=c){if(!(m in c)){if(!t)throw new o("base intrinsic for "+e+" exists, but the property is not available.");return}if(l&&u+1>=i.length){var y=l(c,m);c=(p=!!y)&&"get"in y&&!("originalValue"in y.get)?y.get:c[m]}else p=S(c,m),c=c[m];p&&!d&&(v[a]=c)}}return c}},30254:(e,t,i)=>{"use strict";var n=i(61040);e.exports=function(){return String.prototype.trim&&""==="".trim()?String.prototype.trim:n}},60029:(e,t,i)=>{"use strict";var n=i(4289),s=i(30254);e.exports=function(){var e=s();return n(String.prototype,{trim:e},{trim:function(){return String.prototype.trim!==e}}),e}},67121:(e,t,i)=>{"use strict";e=i.hmd(e);!function(e){var t,i=e.Symbol;if("function"==typeof i)if(i.observable)t=i.observable;else{t=i.for("https://github.com/benlesh/symbol-observable");try{i.observable=t}catch(e){}}else t="@@observable"}("undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==i.g?i.g:e)},2212:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ACESFilmicToneMapping:()=>ie,AddEquation:()=>_,AddOperation:()=>Q,AdditiveAnimationBlendMode:()=>Kt,AdditiveBlending:()=>E,AlphaFormat:()=>ke,AlwaysDepth:()=>j,AlwaysStencilFunc:()=>wi,AmbientLight:()=>AmbientLight,AmbientLightProbe:()=>AmbientLightProbe,AnimationClip:()=>AnimationClip,AnimationLoader:()=>AnimationLoader,AnimationMixer:()=>AnimationMixer,AnimationObjectGroup:()=>AnimationObjectGroup,AnimationUtils:()=>sc,ArcCurve:()=>ArcCurve,ArrayCamera:()=>ArrayCamera,ArrowHelper:()=>ArrowHelper,Audio:()=>Audio,AudioAnalyser:()=>AudioAnalyser,AudioContext:()=>bc,AudioListener:()=>AudioListener,AudioLoader:()=>AudioLoader,AxesHelper:()=>AxesHelper,AxisHelper:()=>kd,BackSide:()=>f,BasicDepthPacking:()=>si,BasicShadowMap:()=>d,BinaryTextureLoader:()=>Hd,Bone:()=>Bone,BooleanKeyframeTrack:()=>BooleanKeyframeTrack,BoundingBoxHelper:()=>Ud,Box2:()=>Box2,Box3:()=>Box3,Box3Helper:()=>Box3Helper,BoxBufferGeometry:()=>BoxGeometry,BoxGeometry:()=>BoxGeometry,BoxHelper:()=>BoxHelper,BufferAttribute:()=>BufferAttribute,BufferGeometry:()=>BufferGeometry,BufferGeometryLoader:()=>BufferGeometryLoader,ByteType:()=>_e,Cache:()=>oc,Camera:()=>Camera,CameraHelper:()=>CameraHelper,CanvasRenderer:()=>Gd,CanvasTexture:()=>CanvasTexture,CatmullRomCurve3:()=>CatmullRomCurve3,CineonToneMapping:()=>te,CircleBufferGeometry:()=>CircleGeometry,CircleGeometry:()=>CircleGeometry,ClampToEdgeWrapping:()=>ue,Clock:()=>Clock,Color:()=>Color,ColorKeyframeTrack:()=>ColorKeyframeTrack,CompressedTexture:()=>CompressedTexture,CompressedTextureLoader:()=>CompressedTextureLoader,ConeBufferGeometry:()=>ConeGeometry,ConeGeometry:()=>ConeGeometry,CubeCamera:()=>CubeCamera,CubeReflectionMapping:()=>re,CubeRefractionMapping:()=>oe,CubeTexture:()=>CubeTexture,CubeTextureLoader:()=>CubeTextureLoader,CubeUVReflectionMapping:()=>ce,CubeUVRefractionMapping:()=>de,CubicBezierCurve:()=>CubicBezierCurve,CubicBezierCurve3:()=>CubicBezierCurve3,CubicInterpolant:()=>CubicInterpolant,CullFaceBack:()=>a,CullFaceFront:()=>l,CullFaceFrontBack:()=>c,CullFaceNone:()=>o,Curve:()=>Curve,CurvePath:()=>CurvePath,CustomBlending:()=>x,CustomToneMapping:()=>ne,CylinderBufferGeometry:()=>CylinderGeometry,CylinderGeometry:()=>CylinderGeometry,Cylindrical:()=>Cylindrical,DataTexture:()=>DataTexture,DataTexture2DArray:()=>DataTexture2DArray,DataTexture3D:()=>DataTexture3D,DataTextureLoader:()=>DataTextureLoader,DataUtils:()=>DataUtils,DecrementStencilOp:()=>ui,DecrementWrapStencilOp:()=>mi,DefaultLoadingManager:()=>ac,DepthFormat:()=>je,DepthStencilFormat:()=>Ge,DepthTexture:()=>DepthTexture,DirectionalLight:()=>DirectionalLight,DirectionalLightHelper:()=>DirectionalLightHelper,DiscreteInterpolant:()=>DiscreteInterpolant,DodecahedronBufferGeometry:()=>DodecahedronGeometry,DodecahedronGeometry:()=>DodecahedronGeometry,DoubleSide:()=>g,DstAlphaFactor:()=>k,DstColorFactor:()=>B,DynamicBufferAttribute:()=>Md,DynamicCopyUsage:()=>Di,DynamicDrawUsage:()=>_i,DynamicReadUsage:()=>Ai,EdgesGeometry:()=>EdgesGeometry,EdgesHelper:()=>Bd,EllipseCurve:()=>EllipseCurve,EqualDepth:()=>W,EqualStencilFunc:()=>yi,EquirectangularReflectionMapping:()=>ae,EquirectangularRefractionMapping:()=>le,Euler:()=>Euler,EventDispatcher:()=>EventDispatcher,ExtrudeBufferGeometry:()=>ExtrudeGeometry,ExtrudeGeometry:()=>ExtrudeGeometry,FaceColors:()=>fd,FileLoader:()=>FileLoader,FlatShading:()=>v,Float16BufferAttribute:()=>Float16BufferAttribute,Float32Attribute:()=>Ld,Float32BufferAttribute:()=>Float32BufferAttribute,Float64Attribute:()=>Rd,Float64BufferAttribute:()=>Float64BufferAttribute,FloatType:()=>Pe,Fog:()=>Fog,FogExp2:()=>FogExp2,Font:()=>$d,FontLoader:()=>Zd,FrontSide:()=>m,Frustum:()=>Frustum,GLBufferAttribute:()=>GLBufferAttribute,GLSL1:()=>Ii,GLSL3:()=>Li,GammaEncoding:()=>Xt,GreaterDepth:()=>Y,GreaterEqualDepth:()=>K,GreaterEqualStencilFunc:()=>Ti,GreaterStencilFunc:()=>Si,GridHelper:()=>GridHelper,Group:()=>Group,HalfFloatType:()=>De,HemisphereLight:()=>HemisphereLight,HemisphereLightHelper:()=>HemisphereLightHelper,HemisphereLightProbe:()=>HemisphereLightProbe,IcosahedronBufferGeometry:()=>IcosahedronGeometry,IcosahedronGeometry:()=>IcosahedronGeometry,ImageBitmapLoader:()=>ImageBitmapLoader,ImageLoader:()=>ImageLoader,ImageUtils:()=>ImageUtils,ImmediateRenderObject:()=>Qd,IncrementStencilOp:()=>hi,IncrementWrapStencilOp:()=>pi,InstancedBufferAttribute:()=>InstancedBufferAttribute,InstancedBufferGeometry:()=>InstancedBufferGeometry,InstancedInterleavedBuffer:()=>InstancedInterleavedBuffer,InstancedMesh:()=>InstancedMesh,Int16Attribute:()=>Pd,Int16BufferAttribute:()=>Int16BufferAttribute,Int32Attribute:()=>Nd,Int32BufferAttribute:()=>Int32BufferAttribute,Int8Attribute:()=>Od,Int8BufferAttribute:()=>Int8BufferAttribute,IntType:()=>Ae,InterleavedBuffer:()=>InterleavedBuffer,InterleavedBufferAttribute:()=>InterleavedBufferAttribute,Interpolant:()=>Interpolant,InterpolateDiscrete:()=>Ft,InterpolateLinear:()=>Vt,InterpolateSmooth:()=>Ht,InvertStencilOp:()=>fi,JSONLoader:()=>zd,KeepStencilOp:()=>ci,KeyframeTrack:()=>KeyframeTrack,LOD:()=>LOD,LatheBufferGeometry:()=>LatheGeometry,LatheGeometry:()=>LatheGeometry,Layers:()=>Layers,LensFlare:()=>Kd,LessDepth:()=>G,LessEqualDepth:()=>z,LessEqualStencilFunc:()=>bi,LessStencilFunc:()=>vi,Light:()=>Light,LightProbe:()=>LightProbe,Line:()=>Line,Line3:()=>Line3,LineBasicMaterial:()=>LineBasicMaterial,LineCurve:()=>LineCurve,LineCurve3:()=>LineCurve3,LineDashedMaterial:()=>LineDashedMaterial,LineLoop:()=>LineLoop,LinePieces:()=>pd,LineSegments:()=>LineSegments,LineStrip:()=>ud,LinearEncoding:()=>$t,LinearFilter:()=>be,LinearInterpolant:()=>LinearInterpolant,LinearMipMapLinearFilter:()=>we,LinearMipMapNearestFilter:()=>Ee,LinearMipmapLinearFilter:()=>Te,LinearMipmapNearestFilter:()=>Se,LinearToneMapping:()=>J,Loader:()=>Loader,LoaderUtils:()=>LoaderUtils,LoadingManager:()=>LoadingManager,LogLuvEncoding:()=>ei,LoopOnce:()=>kt,LoopPingPong:()=>Bt,LoopRepeat:()=>Ut,LuminanceAlphaFormat:()=>Ve,LuminanceFormat:()=>Fe,MOUSE:()=>s,Material:()=>Material,MaterialLoader:()=>MaterialLoader,Math:()=>Yi,MathUtils:()=>Yi,Matrix3:()=>Matrix3,Matrix4:()=>Matrix4,MaxEquation:()=>C,Mesh:()=>Mesh,MeshBasicMaterial:()=>MeshBasicMaterial,MeshDepthMaterial:()=>MeshDepthMaterial,MeshDistanceMaterial:()=>MeshDistanceMaterial,MeshFaceMaterial:()=>vd,MeshLambertMaterial:()=>MeshLambertMaterial,MeshMatcapMaterial:()=>MeshMatcapMaterial,MeshNormalMaterial:()=>MeshNormalMaterial,MeshPhongMaterial:()=>MeshPhongMaterial,MeshPhysicalMaterial:()=>MeshPhysicalMaterial,MeshStandardMaterial:()=>MeshStandardMaterial,MeshToonMaterial:()=>MeshToonMaterial,MinEquation:()=>A,MirroredRepeatWrapping:()=>pe,MixOperation:()=>$,MultiMaterial:()=>yd,MultiplyBlending:()=>w,MultiplyOperation:()=>Z,NearestFilter:()=>me,NearestMipMapLinearFilter:()=>ye,NearestMipMapNearestFilter:()=>ge,NearestMipmapLinearFilter:()=>ve,NearestMipmapNearestFilter:()=>fe,NeverDepth:()=>H,NeverStencilFunc:()=>gi,NoBlending:()=>b,NoColors:()=>md,NoToneMapping:()=>X,NormalAnimationBlendMode:()=>Wt,NormalBlending:()=>S,NotEqualDepth:()=>q,NotEqualStencilFunc:()=>Ei,NumberKeyframeTrack:()=>NumberKeyframeTrack,Object3D:()=>Object3D,ObjectLoader:()=>ObjectLoader,ObjectSpaceNormalMap:()=>ai,OctahedronBufferGeometry:()=>OctahedronGeometry,OctahedronGeometry:()=>OctahedronGeometry,OneFactor:()=>D,OneMinusDstAlphaFactor:()=>U,OneMinusDstColorFactor:()=>F,OneMinusSrcAlphaFactor:()=>R,OneMinusSrcColorFactor:()=>I,OrthographicCamera:()=>OrthographicCamera,PCFShadowMap:()=>h,PCFSoftShadowMap:()=>u,PMREMGenerator:()=>PMREMGenerator,ParametricGeometry:()=>Yd,Particle:()=>Sd,ParticleBasicMaterial:()=>wd,ParticleSystem:()=>Ed,ParticleSystemMaterial:()=>xd,Path:()=>Path,PerspectiveCamera:()=>PerspectiveCamera,Plane:()=>Plane,PlaneBufferGeometry:()=>PlaneGeometry,PlaneGeometry:()=>PlaneGeometry,PlaneHelper:()=>PlaneHelper,PointCloud:()=>bd,PointCloudMaterial:()=>Td,PointLight:()=>PointLight,PointLightHelper:()=>PointLightHelper,Points:()=>Points,PointsMaterial:()=>PointsMaterial,PolarGridHelper:()=>PolarGridHelper,PolyhedronBufferGeometry:()=>PolyhedronGeometry,PolyhedronGeometry:()=>PolyhedronGeometry,PositionalAudio:()=>PositionalAudio,PropertyBinding:()=>PropertyBinding,PropertyMixer:()=>PropertyMixer,QuadraticBezierCurve:()=>QuadraticBezierCurve,QuadraticBezierCurve3:()=>QuadraticBezierCurve3,Quaternion:()=>Quaternion,QuaternionKeyframeTrack:()=>QuaternionKeyframeTrack,QuaternionLinearInterpolant:()=>QuaternionLinearInterpolant,REVISION:()=>n,RGBADepthPacking:()=>ri,RGBAFormat:()=>Be,RGBAIntegerFormat:()=>Ze,RGBA_ASTC_10x10_Format:()=>yt,RGBA_ASTC_10x5_Format:()=>ft,RGBA_ASTC_10x6_Format:()=>gt,RGBA_ASTC_10x8_Format:()=>vt,RGBA_ASTC_12x10_Format:()=>bt,RGBA_ASTC_12x12_Format:()=>St,RGBA_ASTC_4x4_Format:()=>at,RGBA_ASTC_5x4_Format:()=>lt,RGBA_ASTC_5x5_Format:()=>ct,RGBA_ASTC_6x5_Format:()=>dt,RGBA_ASTC_6x6_Format:()=>ht,RGBA_ASTC_8x5_Format:()=>ut,RGBA_ASTC_8x6_Format:()=>pt,RGBA_ASTC_8x8_Format:()=>mt,RGBA_BPTC_Format:()=>Et,RGBA_ETC2_EAC_Format:()=>ot,RGBA_PVRTC_2BPPV1_Format:()=>nt,RGBA_PVRTC_4BPPV1_Format:()=>it,RGBA_S3TC_DXT1_Format:()=>Qe,RGBA_S3TC_DXT3_Format:()=>Xe,RGBA_S3TC_DXT5_Format:()=>Je,RGBDEncoding:()=>ni,RGBEEncoding:()=>Jt,RGBEFormat:()=>He,RGBFormat:()=>Ue,RGBIntegerFormat:()=>qe,RGBM16Encoding:()=>ii,RGBM7Encoding:()=>ti,RGB_ETC1_Format:()=>st,RGB_ETC2_Format:()=>rt,RGB_PVRTC_2BPPV1_Format:()=>tt,RGB_PVRTC_4BPPV1_Format:()=>et,RGB_S3TC_DXT1_Format:()=>$e,RGFormat:()=>Ke,RGIntegerFormat:()=>Ye,RawShaderMaterial:()=>RawShaderMaterial,Ray:()=>Ray,Raycaster:()=>Raycaster,RectAreaLight:()=>RectAreaLight,RedFormat:()=>ze,RedIntegerFormat:()=>We,ReinhardToneMapping:()=>ee,RepeatWrapping:()=>he,ReplaceStencilOp:()=>di,ReverseSubtractEquation:()=>O,RingBufferGeometry:()=>RingGeometry,RingGeometry:()=>RingGeometry,SRGB8_ALPHA8_ASTC_10x10_Format:()=>It,SRGB8_ALPHA8_ASTC_10x5_Format:()=>Pt,SRGB8_ALPHA8_ASTC_10x6_Format:()=>Dt,SRGB8_ALPHA8_ASTC_10x8_Format:()=>Nt,SRGB8_ALPHA8_ASTC_12x10_Format:()=>Lt,SRGB8_ALPHA8_ASTC_12x12_Format:()=>Rt,SRGB8_ALPHA8_ASTC_4x4_Format:()=>Tt,SRGB8_ALPHA8_ASTC_5x4_Format:()=>wt,SRGB8_ALPHA8_ASTC_5x5_Format:()=>xt,SRGB8_ALPHA8_ASTC_6x5_Format:()=>_t,SRGB8_ALPHA8_ASTC_6x6_Format:()=>Mt,SRGB8_ALPHA8_ASTC_8x5_Format:()=>Ot,SRGB8_ALPHA8_ASTC_8x6_Format:()=>At,SRGB8_ALPHA8_ASTC_8x8_Format:()=>Ct,Scene:()=>Scene,SceneUtils:()=>Wd,ShaderChunk:()=>Js,ShaderLib:()=>tr,ShaderMaterial:()=>ShaderMaterial,ShadowMaterial:()=>ShadowMaterial,Shape:()=>Shape,ShapeBufferGeometry:()=>ShapeGeometry,ShapeGeometry:()=>ShapeGeometry,ShapePath:()=>ShapePath,ShapeUtils:()=>ShapeUtils,ShortType:()=>Me,Skeleton:()=>Skeleton,SkeletonHelper:()=>SkeletonHelper,SkinnedMesh:()=>SkinnedMesh,SmoothShading:()=>y,Sphere:()=>Sphere,SphereBufferGeometry:()=>SphereGeometry,SphereGeometry:()=>SphereGeometry,Spherical:()=>Spherical,SphericalHarmonics3:()=>SphericalHarmonics3,SplineCurve:()=>SplineCurve,SpotLight:()=>SpotLight,SpotLightHelper:()=>SpotLightHelper,Sprite:()=>Sprite,SpriteMaterial:()=>SpriteMaterial,SrcAlphaFactor:()=>L,SrcAlphaSaturateFactor:()=>V,SrcColorFactor:()=>N,StaticCopyUsage:()=>Pi,StaticDrawUsage:()=>xi,StaticReadUsage:()=>Oi,StereoCamera:()=>StereoCamera,StreamCopyUsage:()=>Ni,StreamDrawUsage:()=>Mi,StreamReadUsage:()=>Ci,StringKeyframeTrack:()=>StringKeyframeTrack,SubtractEquation:()=>M,SubtractiveBlending:()=>T,TOUCH:()=>r,TangentSpaceNormalMap:()=>oi,TetrahedronBufferGeometry:()=>TetrahedronGeometry,TetrahedronGeometry:()=>TetrahedronGeometry,TextGeometry:()=>qd,Texture:()=>Texture,TextureLoader:()=>TextureLoader,TorusBufferGeometry:()=>TorusGeometry,TorusGeometry:()=>TorusGeometry,TorusKnotBufferGeometry:()=>TorusKnotGeometry,TorusKnotGeometry:()=>TorusKnotGeometry,Triangle:()=>Triangle,TriangleFanDrawMode:()=>Zt,TriangleStripDrawMode:()=>qt,TrianglesDrawMode:()=>Yt,TubeBufferGeometry:()=>TubeGeometry,TubeGeometry:()=>TubeGeometry,UVMapping:()=>se,Uint16Attribute:()=>Dd,Uint16BufferAttribute:()=>Uint16BufferAttribute,Uint32Attribute:()=>Id,Uint32BufferAttribute:()=>Uint32BufferAttribute,Uint8Attribute:()=>Ad,Uint8BufferAttribute:()=>Uint8BufferAttribute,Uint8ClampedAttribute:()=>Cd,Uint8ClampedBufferAttribute:()=>Uint8ClampedBufferAttribute,Uniform:()=>Uniform,UniformsLib:()=>er,UniformsUtils:()=>zs,UnsignedByteType:()=>xe,UnsignedInt248Type:()=>Re,UnsignedIntType:()=>Ce,UnsignedShort4444Type:()=>Ne,UnsignedShort5551Type:()=>Ie,UnsignedShort565Type:()=>Le,UnsignedShortType:()=>Oe,VSMShadowMap:()=>p,Vector2:()=>Vector2,Vector3:()=>Vector3,Vector4:()=>Vector4,VectorKeyframeTrack:()=>VectorKeyframeTrack,Vertex:()=>_d,VertexColors:()=>gd,VideoTexture:()=>VideoTexture,WebGL1Renderer:()=>WebGL1Renderer,WebGLCubeRenderTarget:()=>WebGLCubeRenderTarget,WebGLMultipleRenderTargets:()=>WebGLMultipleRenderTargets,WebGLMultisampleRenderTarget:()=>WebGLMultisampleRenderTarget,WebGLRenderTarget:()=>WebGLRenderTarget,WebGLRenderTargetCube:()=>jd,WebGLRenderer:()=>Oa,WebGLUtils:()=>xa,WireframeGeometry:()=>WireframeGeometry,WireframeHelper:()=>Fd,WrapAroundEnding:()=>zt,XHRLoader:()=>Vd,ZeroCurvatureEnding:()=>jt,ZeroFactor:()=>P,ZeroSlopeEnding:()=>Gt,ZeroStencilOp:()=>li,sRGBEncoding:()=>Qt});const n="134",s={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},r={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},o=0,a=1,l=2,c=3,d=0,h=1,u=2,p=3,m=0,f=1,g=2,v=1,y=2,b=0,S=1,E=2,T=3,w=4,x=5,_=100,M=101,O=102,A=103,C=104,P=200,D=201,N=202,I=203,L=204,R=205,k=206,U=207,B=208,F=209,V=210,H=0,j=1,G=2,z=3,W=4,K=5,Y=6,q=7,Z=0,$=1,Q=2,X=0,J=1,ee=2,te=3,ie=4,ne=5,se=300,re=301,oe=302,ae=303,le=304,ce=306,de=307,he=1e3,ue=1001,pe=1002,me=1003,fe=1004,ge=1004,ve=1005,ye=1005,be=1006,Se=1007,Ee=1007,Te=1008,we=1008,xe=1009,_e=1010,Me=1011,Oe=1012,Ae=1013,Ce=1014,Pe=1015,De=1016,Ne=1017,Ie=1018,Le=1019,Re=1020,ke=1021,Ue=1022,Be=1023,Fe=1024,Ve=1025,He=Be,je=1026,Ge=1027,ze=1028,We=1029,Ke=1030,Ye=1031,qe=1032,Ze=1033,$e=33776,Qe=33777,Xe=33778,Je=33779,et=35840,tt=35841,it=35842,nt=35843,st=36196,rt=37492,ot=37496,at=37808,lt=37809,ct=37810,dt=37811,ht=37812,ut=37813,pt=37814,mt=37815,ft=37816,gt=37817,vt=37818,yt=37819,bt=37820,St=37821,Et=36492,Tt=37840,wt=37841,xt=37842,_t=37843,Mt=37844,Ot=37845,At=37846,Ct=37847,Pt=37848,Dt=37849,Nt=37850,It=37851,Lt=37852,Rt=37853,kt=2200,Ut=2201,Bt=2202,Ft=2300,Vt=2301,Ht=2302,jt=2400,Gt=2401,zt=2402,Wt=2500,Kt=2501,Yt=0,qt=1,Zt=2,$t=3e3,Qt=3001,Xt=3007,Jt=3002,ei=3003,ti=3004,ii=3005,ni=3006,si=3200,ri=3201,oi=0,ai=1,li=0,ci=7680,di=7681,hi=7682,ui=7683,pi=34055,mi=34056,fi=5386,gi=512,vi=513,yi=514,bi=515,Si=516,Ei=517,Ti=518,wi=519,xi=35044,_i=35048,Mi=35040,Oi=35045,Ai=35049,Ci=35041,Pi=35046,Di=35050,Ni=35042,Ii="100",Li="300 es";class EventDispatcher{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const i=this._listeners[e];if(void 0!==i){const e=i.indexOf(t);-1!==e&&i.splice(e,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const t=this._listeners[e.type];if(void 0!==t){e.target=this;const i=t.slice(0);for(let t=0,n=i.length;t<n;t++)i[t].call(this,e);e.target=null}}}let Ri=1234567;const ki=Math.PI/180,Ui=180/Math.PI,Bi=[];for(let e=0;e<256;e++)Bi[e]=(e<16?"0":"")+e.toString(16);const Fi="undefined"!=typeof crypto&&"randomUUID"in crypto;function Vi(){if(Fi)return crypto.randomUUID().toUpperCase();const e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0;return(Bi[255&e]+Bi[e>>8&255]+Bi[e>>16&255]+Bi[e>>24&255]+"-"+Bi[255&t]+Bi[t>>8&255]+"-"+Bi[t>>16&15|64]+Bi[t>>24&255]+"-"+Bi[63&i|128]+Bi[i>>8&255]+"-"+Bi[i>>16&255]+Bi[i>>24&255]+Bi[255&n]+Bi[n>>8&255]+Bi[n>>16&255]+Bi[n>>24&255]).toUpperCase()}function Hi(e,t,i){return Math.max(t,Math.min(i,e))}function ji(e,t){return(e%t+t)%t}function Gi(e,t,i){return(1-i)*e+i*t}function zi(e){return 0==(e&e-1)&&0!==e}function Wi(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function Ki(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var Yi=Object.freeze({__proto__:null,DEG2RAD:ki,RAD2DEG:Ui,generateUUID:Vi,clamp:Hi,euclideanModulo:ji,mapLinear:function(e,t,i,n,s){return n+(e-t)*(s-n)/(i-t)},inverseLerp:function(e,t,i){return e!==t?(i-e)/(t-e):0},lerp:Gi,damp:function(e,t,i,n){return Gi(e,t,1-Math.exp(-i*n))},pingpong:function(e,t=1){return t-Math.abs(ji(e,2*t)-t)},smoothstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)},smootherstep:function(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){return void 0!==e&&(Ri=e%2147483647),Ri=16807*Ri%2147483647,(Ri-1)/2147483646},degToRad:function(e){return e*ki},radToDeg:function(e){return e*Ui},isPowerOfTwo:zi,ceilPowerOfTwo:Wi,floorPowerOfTwo:Ki,setQuaternionFromProperEuler:function(e,t,i,n,s){const r=Math.cos,o=Math.sin,a=r(i/2),l=o(i/2),c=r((t+n)/2),d=o((t+n)/2),h=r((t-n)/2),u=o((t-n)/2),p=r((n-t)/2),m=o((n-t)/2);switch(s){case"XYX":e.set(a*d,l*h,l*u,a*c);break;case"YZY":e.set(l*u,a*d,l*h,a*c);break;case"ZXZ":e.set(l*h,l*u,a*d,a*c);break;case"XZX":e.set(a*d,l*m,l*p,a*c);break;case"YXY":e.set(l*p,a*d,l*m,a*c);break;case"ZYZ":e.set(l*m,l*p,a*d,a*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}});class Vector2{constructor(e=0,t=0){this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,n=e.elements;return this.x=n[0]*t+n[3]*i+n[6],this.y=n[1]*t+n[4]*i+n[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),n=Math.sin(t),s=this.x-e.x,r=this.y-e.y;return this.x=s*i-r*n+e.x,this.y=s*n+r*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}Vector2.prototype.isVector2=!0;class Matrix3{constructor(){this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,r,o,a,l){const c=this.elements;return c[0]=e,c[1]=n,c[2]=o,c[3]=t,c[4]=s,c[5]=a,c[6]=i,c[7]=r,c[8]=l,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,r=i[0],o=i[3],a=i[6],l=i[1],c=i[4],d=i[7],h=i[2],u=i[5],p=i[8],m=n[0],f=n[3],g=n[6],v=n[1],y=n[4],b=n[7],S=n[2],E=n[5],T=n[8];return s[0]=r*m+o*v+a*S,s[3]=r*f+o*y+a*E,s[6]=r*g+o*b+a*T,s[1]=l*m+c*v+d*S,s[4]=l*f+c*y+d*E,s[7]=l*g+c*b+d*T,s[2]=h*m+u*v+p*S,s[5]=h*f+u*y+p*E,s[8]=h*g+u*b+p*T,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8];return t*r*c-t*o*l-i*s*c+i*o*a+n*s*l-n*r*a}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],d=c*r-o*l,h=o*a-c*s,u=l*s-r*a,p=t*d+i*h+n*u;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const m=1/p;return e[0]=d*m,e[1]=(n*l-c*i)*m,e[2]=(o*i-n*r)*m,e[3]=h*m,e[4]=(c*t-n*a)*m,e[5]=(n*s-o*t)*m,e[6]=u*m,e[7]=(i*a-l*t)*m,e[8]=(r*t-i*s)*m,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,n,s,r,o){const a=Math.cos(s),l=Math.sin(s);return this.set(i*a,i*l,-i*(a*r+l*o)+r+e,-n*l,n*a,-n*(-l*r+a*o)+o+t,0,0,1),this}scale(e,t){const i=this.elements;return i[0]*=e,i[3]*=e,i[6]*=e,i[1]*=t,i[4]*=t,i[7]*=t,this}rotate(e){const t=Math.cos(e),i=Math.sin(e),n=this.elements,s=n[0],r=n[3],o=n[6],a=n[1],l=n[4],c=n[7];return n[0]=t*s+i*a,n[3]=t*r+i*l,n[6]=t*o+i*c,n[1]=-i*s+t*a,n[4]=-i*r+t*l,n[7]=-i*o+t*c,this}translate(e,t){const i=this.elements;return i[0]+=e*i[2],i[3]+=e*i[5],i[6]+=e*i[8],i[1]+=t*i[2],i[4]+=t*i[5],i[7]+=t*i[8],this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<9;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}function qi(e){if(0===e.length)return-1/0;let t=e[0];for(let i=1,n=e.length;i<n;++i)e[i]>t&&(t=e[i]);return t}Matrix3.prototype.isMatrix3=!0;const Zi={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function $i(e,t){return new Zi[e](t)}function Qi(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Xi(e,t=0){let i=3735928559^t,n=1103547991^t;for(let t,s=0;s<e.length;s++)t=e.charCodeAt(s),i=Math.imul(i^t,2654435761),n=Math.imul(n^t,1597334677);return i=Math.imul(i^i>>>16,2246822507)^Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507)^Math.imul(i^i>>>13,3266489909),4294967296*(2097151&n)+(i>>>0)}let Ji;class ImageUtils{static getDataURL(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Ji&&(Ji=Qi("canvas")),Ji.width=e.width,Ji.height=e.height;const i=Ji.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Ji}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}}let en=0;class Texture extends EventDispatcher{constructor(e=Texture.DEFAULT_IMAGE,t=Texture.DEFAULT_MAPPING,i=ue,n=ue,s=be,r=Te,o=Be,a=xe,l=1,c=$t){super(),Object.defineProperty(this,"id",{value:en++}),this.uuid=Vi(),this.name="",this.image=e,this.mipmaps=[],this.mapping=t,this.wrapS=i,this.wrapT=n,this.magFilter=s,this.minFilter=r,this.anisotropy=l,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Vector2(0,0),this.repeat=new Vector2(1,1),this.center=new Vector2(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Matrix3,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=c,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];const i={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(void 0!==this.image){const n=this.image;if(void 0===n.uuid&&(n.uuid=Vi()),!t&&void 0===e.images[n.uuid]){let t;if(Array.isArray(n)){t=[];for(let e=0,i=n.length;e<i;e++)n[e].isDataTexture?t.push(tn(n[e].image)):t.push(tn(n[e]))}else t=tn(n);e.images[n.uuid]={uuid:n.uuid,url:t}}i.image=n.uuid}return"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==se)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case he:e.x=e.x-Math.floor(e.x);break;case ue:e.x=e.x<0?0:1;break;case pe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case he:e.y=e.y-Math.floor(e.y);break;case ue:e.y=e.y<0?0:1;break;case pe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){!0===e&&this.version++}}function tn(e){return"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?ImageUtils.getDataURL(e):e.data?{data:Array.prototype.slice.call(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}Texture.DEFAULT_IMAGE=void 0,Texture.DEFAULT_MAPPING=se,Texture.prototype.isTexture=!0;class Vector4{constructor(e=0,t=0,i=0,n=1){this.x=e,this.y=t,this.z=i,this.w=n}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=this.w,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12]*s,this.y=r[1]*t+r[5]*i+r[9]*n+r[13]*s,this.z=r[2]*t+r[6]*i+r[10]*n+r[14]*s,this.w=r[3]*t+r[7]*i+r[11]*n+r[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,n,s;const r=.01,o=.1,a=e.elements,l=a[0],c=a[4],d=a[8],h=a[1],u=a[5],p=a[9],m=a[2],f=a[6],g=a[10];if(Math.abs(c-h)<r&&Math.abs(d-m)<r&&Math.abs(p-f)<r){if(Math.abs(c+h)<o&&Math.abs(d+m)<o&&Math.abs(p+f)<o&&Math.abs(l+u+g-3)<o)return this.set(1,0,0,0),this;t=Math.PI;const e=(l+1)/2,a=(u+1)/2,v=(g+1)/2,y=(c+h)/4,b=(d+m)/4,S=(p+f)/4;return e>a&&e>v?e<r?(i=0,n=.707106781,s=.707106781):(i=Math.sqrt(e),n=y/i,s=b/i):a>v?a<r?(i=.707106781,n=0,s=.707106781):(n=Math.sqrt(a),i=y/n,s=S/n):v<r?(i=.707106781,n=.707106781,s=0):(s=Math.sqrt(v),i=b/s,n=S/s),this.set(i,n,s,t),this}let v=Math.sqrt((f-p)*(f-p)+(d-m)*(d-m)+(h-c)*(h-c));return Math.abs(v)<.001&&(v=1),this.x=(f-p)/v,this.y=(d-m)/v,this.z=(h-c)/v,this.w=Math.acos((l+u+g-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}Vector4.prototype.isVector4=!0;class WebGLRenderTarget extends EventDispatcher{constructor(e,t,i={}){super(),this.width=e,this.height=t,this.depth=1,this.scissor=new Vector4(0,0,e,t),this.scissorTest=!1,this.viewport=new Vector4(0,0,e,t),this.texture=new Texture(void 0,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.image={width:e,height:t,depth:1},this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:be,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null}setTexture(e){e.image={width:this.width,height:this.height,depth:this.depth},this.texture=e}setSize(e,t,i=1){this.width===e&&this.height===t&&this.depth===i||(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.image={...this.texture.image},this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this}dispose(){this.dispatchEvent({type:"dispose"})}}WebGLRenderTarget.prototype.isWebGLRenderTarget=!0;class WebGLMultipleRenderTargets extends WebGLRenderTarget{constructor(e,t,i){super(e,t);const n=this.texture;this.texture=[];for(let e=0;e<i;e++)this.texture[e]=n.clone()}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let n=0,s=this.texture.length;n<s;n++)this.texture[n].image.width=e,this.texture[n].image.height=t,this.texture[n].image.depth=i;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}copy(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this.texture.length=0;for(let t=0,i=e.texture.length;t<i;t++)this.texture[t]=e.texture[t].clone();return this}}WebGLMultipleRenderTargets.prototype.isWebGLMultipleRenderTargets=!0;class WebGLMultisampleRenderTarget extends WebGLRenderTarget{constructor(e,t,i){super(e,t,i),this.samples=4}copy(e){return super.copy.call(this,e),this.samples=e.samples,this}}WebGLMultisampleRenderTarget.prototype.isWebGLMultisampleRenderTarget=!0;class Quaternion{constructor(e=0,t=0,i=0,n=1){this._x=e,this._y=t,this._z=i,this._w=n}static slerp(e,t,i,n){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),i.slerpQuaternions(e,t,n)}static slerpFlat(e,t,i,n,s,r,o){let a=i[n+0],l=i[n+1],c=i[n+2],d=i[n+3];const h=s[r+0],u=s[r+1],p=s[r+2],m=s[r+3];if(0===o)return e[t+0]=a,e[t+1]=l,e[t+2]=c,void(e[t+3]=d);if(1===o)return e[t+0]=h,e[t+1]=u,e[t+2]=p,void(e[t+3]=m);if(d!==m||a!==h||l!==u||c!==p){let e=1-o;const t=a*h+l*u+c*p+d*m,i=t>=0?1:-1,n=1-t*t;if(n>Number.EPSILON){const s=Math.sqrt(n),r=Math.atan2(s,t*i);e=Math.sin(e*r)/s,o=Math.sin(o*r)/s}const s=o*i;if(a=a*e+h*s,l=l*e+u*s,c=c*e+p*s,d=d*e+m*s,e===1-o){const e=1/Math.sqrt(a*a+l*l+c*c+d*d);a*=e,l*=e,c*=e,d*=e}}e[t]=a,e[t+1]=l,e[t+2]=c,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,n,s,r){const o=i[n],a=i[n+1],l=i[n+2],c=i[n+3],d=s[r],h=s[r+1],u=s[r+2],p=s[r+3];return e[t]=o*p+c*d+a*u-l*h,e[t+1]=a*p+c*h+l*d-o*u,e[t+2]=l*p+c*u+o*h-a*d,e[t+3]=c*p-o*d-a*h-l*u,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");const i=e._x,n=e._y,s=e._z,r=e._order,o=Math.cos,a=Math.sin,l=o(i/2),c=o(n/2),d=o(s/2),h=a(i/2),u=a(n/2),p=a(s/2);switch(r){case"XYZ":this._x=h*c*d+l*u*p,this._y=l*u*d-h*c*p,this._z=l*c*p+h*u*d,this._w=l*c*d-h*u*p;break;case"YXZ":this._x=h*c*d+l*u*p,this._y=l*u*d-h*c*p,this._z=l*c*p-h*u*d,this._w=l*c*d+h*u*p;break;case"ZXY":this._x=h*c*d-l*u*p,this._y=l*u*d+h*c*p,this._z=l*c*p+h*u*d,this._w=l*c*d-h*u*p;break;case"ZYX":this._x=h*c*d-l*u*p,this._y=l*u*d+h*c*p,this._z=l*c*p-h*u*d,this._w=l*c*d+h*u*p;break;case"YZX":this._x=h*c*d+l*u*p,this._y=l*u*d+h*c*p,this._z=l*c*p-h*u*d,this._w=l*c*d-h*u*p;break;case"XZY":this._x=h*c*d-l*u*p,this._y=l*u*d-h*c*p,this._z=l*c*p+h*u*d,this._w=l*c*d+h*u*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+r)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],n=t[4],s=t[8],r=t[1],o=t[5],a=t[9],l=t[2],c=t[6],d=t[10],h=i+o+d;if(h>0){const e=.5/Math.sqrt(h+1);this._w=.25/e,this._x=(c-a)*e,this._y=(s-l)*e,this._z=(r-n)*e}else if(i>o&&i>d){const e=2*Math.sqrt(1+i-o-d);this._w=(c-a)/e,this._x=.25*e,this._y=(n+r)/e,this._z=(s+l)/e}else if(o>d){const e=2*Math.sqrt(1+o-i-d);this._w=(s-l)/e,this._x=(n+r)/e,this._y=.25*e,this._z=(a+c)/e}else{const e=2*Math.sqrt(1+d-i-o);this._w=(r-n)/e,this._x=(s+l)/e,this._y=(a+c)/e,this._z=.25*e}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Hi(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const n=Math.min(1,t/i);return this.slerp(e,n),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,n=e._y,s=e._z,r=e._w,o=t._x,a=t._y,l=t._z,c=t._w;return this._x=i*c+r*o+n*l-s*a,this._y=n*c+r*a+s*o-i*l,this._z=s*c+r*l+i*a-n*o,this._w=r*c-i*o-n*a-s*l,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,n=this._y,s=this._z,r=this._w;let o=r*e._w+i*e._x+n*e._y+s*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=r,this._x=i,this._y=n,this._z=s,this;const a=1-o*o;if(a<=Number.EPSILON){const e=1-t;return this._w=e*r+t*this._w,this._x=e*i+t*this._x,this._y=e*n+t*this._y,this._z=e*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const l=Math.sqrt(a),c=Math.atan2(l,o),d=Math.sin((1-t)*c)/l,h=Math.sin(t*c)/l;return this._w=r*d+this._w*h,this._x=i*d+this._x*h,this._y=n*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),n=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(n),i*Math.sin(s),i*Math.cos(s),t*Math.sin(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Quaternion.prototype.isQuaternion=!0;class Vector3{constructor(e=0,t=0,i=0){this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(sn.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(sn.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*n,this.y=s[1]*t+s[4]*i+s[7]*n,this.z=s[2]*t+s[5]*i+s[8]*n,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,n=this.z,s=e.elements,r=1/(s[3]*t+s[7]*i+s[11]*n+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*n+s[12])*r,this.y=(s[1]*t+s[5]*i+s[9]*n+s[13])*r,this.z=(s[2]*t+s[6]*i+s[10]*n+s[14])*r,this}applyQuaternion(e){const t=this.x,i=this.y,n=this.z,s=e.x,r=e.y,o=e.z,a=e.w,l=a*t+r*n-o*i,c=a*i+o*t-s*n,d=a*n+s*i-r*t,h=-s*t-r*i-o*n;return this.x=l*a+h*-s+c*-o-d*-r,this.y=c*a+h*-r+d*-s-l*-o,this.z=d*a+h*-o+l*-r-c*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,n=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*n,this.y=s[1]*t+s[5]*i+s[9]*n,this.z=s[2]*t+s[6]*i+s[10]*n,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,n=e.y,s=e.z,r=t.x,o=t.y,a=t.z;return this.x=n*a-s*o,this.y=s*r-i*a,this.z=i*o-n*r,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return nn.copy(this).projectOnVector(e),this.sub(nn)}reflect(e){return this.sub(nn.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Hi(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const n=Math.sin(t)*e;return this.x=n*Math.sin(i),this.y=Math.cos(t)*e,this.z=n*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),n=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=n,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t,i){return void 0!==i&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}Vector3.prototype.isVector3=!0;const nn=new Vector3,sn=new Quaternion;class Box3{constructor(e=new Vector3(1/0,1/0,1/0),t=new Vector3(-1/0,-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,n=1/0,s=-1/0,r=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a+=3){const l=e[a],c=e[a+1],d=e[a+2];l<t&&(t=l),c<i&&(i=c),d<n&&(n=d),l>s&&(s=l),c>r&&(r=c),d>o&&(o=d)}return this.min.set(t,i,n),this.max.set(s,r,o),this}setFromBufferAttribute(e){let t=1/0,i=1/0,n=1/0,s=-1/0,r=-1/0,o=-1/0;for(let a=0,l=e.count;a<l;a++){const l=e.getX(a),c=e.getY(a),d=e.getZ(a);l<t&&(t=l),c<i&&(i=c),d<n&&(n=d),l>s&&(s=l),c>r&&(r=c),d>o&&(o=d)}return this.min.set(t,i,n),this.max.set(s,r,o),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=on.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e){return this.makeEmpty(),this.expandByObject(e)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e){e.updateWorldMatrix(!1,!1);const t=e.geometry;void 0!==t&&(null===t.boundingBox&&t.computeBoundingBox(),an.copy(t.boundingBox),an.applyMatrix4(e.matrixWorld),this.union(an));const i=e.children;for(let e=0,t=i.length;e<t;e++)this.expandByObject(i[e]);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,on),on.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(mn),fn.subVectors(this.max,mn),ln.subVectors(e.a,mn),cn.subVectors(e.b,mn),dn.subVectors(e.c,mn),hn.subVectors(cn,ln),un.subVectors(dn,cn),pn.subVectors(ln,dn);let t=[0,-hn.z,hn.y,0,-un.z,un.y,0,-pn.z,pn.y,hn.z,0,-hn.x,un.z,0,-un.x,pn.z,0,-pn.x,-hn.y,hn.x,0,-un.y,un.x,0,-pn.y,pn.x,0];return!!yn(t,ln,cn,dn,fn)&&(t=[1,0,0,0,1,0,0,0,1],!!yn(t,ln,cn,dn,fn)&&(gn.crossVectors(hn,un),t=[gn.x,gn.y,gn.z],yn(t,ln,cn,dn,fn)))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return on.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(on).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(rn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),rn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),rn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),rn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),rn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),rn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),rn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),rn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(rn)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box3.prototype.isBox3=!0;const rn=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3],on=new Vector3,an=new Box3,ln=new Vector3,cn=new Vector3,dn=new Vector3,hn=new Vector3,un=new Vector3,pn=new Vector3,mn=new Vector3,fn=new Vector3,gn=new Vector3,vn=new Vector3;function yn(e,t,i,n,s){for(let r=0,o=e.length-3;r<=o;r+=3){vn.fromArray(e,r);const o=s.x*Math.abs(vn.x)+s.y*Math.abs(vn.y)+s.z*Math.abs(vn.z),a=t.dot(vn),l=i.dot(vn),c=n.dot(vn);if(Math.max(-Math.max(a,l,c),Math.min(a,l,c))>o)return!1}return!0}const bn=new Box3,Sn=new Vector3,En=new Vector3,Tn=new Vector3;class Sphere{constructor(e=new Vector3,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):bn.setFromPoints(e).getCenter(i);let n=0;for(let t=0,s=e.length;t<s;t++)n=Math.max(n,i.distanceToSquared(e[t]));return this.radius=Math.sqrt(n),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){Tn.subVectors(e,this.center);const t=Tn.lengthSq();if(t>this.radius*this.radius){const e=Math.sqrt(t),i=.5*(e-this.radius);this.center.add(Tn.multiplyScalar(i/e)),this.radius+=i}return this}union(e){return En.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(Sn.copy(e.center).add(En)),this.expandByPoint(Sn.copy(e.center).sub(En)),this}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const wn=new Vector3,xn=new Vector3,_n=new Vector3,Mn=new Vector3,On=new Vector3,An=new Vector3,Cn=new Vector3;class Ray{constructor(e=new Vector3,t=new Vector3(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,wn)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=wn.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(wn.copy(this.direction).multiplyScalar(t).add(this.origin),wn.distanceToSquared(e))}distanceSqToSegment(e,t,i,n){xn.copy(e).add(t).multiplyScalar(.5),_n.copy(t).sub(e).normalize(),Mn.copy(this.origin).sub(xn);const s=.5*e.distanceTo(t),r=-this.direction.dot(_n),o=Mn.dot(this.direction),a=-Mn.dot(_n),l=Mn.lengthSq(),c=Math.abs(1-r*r);let d,h,u,p;if(c>0)if(d=r*a-o,h=r*o-a,p=s*c,d>=0)if(h>=-p)if(h<=p){const e=1/c;d*=e,h*=e,u=d*(d+r*h+2*o)+h*(r*d+h+2*a)+l}else h=s,d=Math.max(0,-(r*h+o)),u=-d*d+h*(h+2*a)+l;else h=-s,d=Math.max(0,-(r*h+o)),u=-d*d+h*(h+2*a)+l;else h<=-p?(d=Math.max(0,-(-r*s+o)),h=d>0?-s:Math.min(Math.max(-s,-a),s),u=-d*d+h*(h+2*a)+l):h<=p?(d=0,h=Math.min(Math.max(-s,-a),s),u=h*(h+2*a)+l):(d=Math.max(0,-(r*s+o)),h=d>0?s:Math.min(Math.max(-s,-a),s),u=-d*d+h*(h+2*a)+l);else h=r>0?-s:s,d=Math.max(0,-(r*h+o)),u=-d*d+h*(h+2*a)+l;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),n&&n.copy(_n).multiplyScalar(h).add(xn),u}intersectSphere(e,t){wn.subVectors(e.center,this.origin);const i=wn.dot(this.direction),n=wn.dot(wn)-i*i,s=e.radius*e.radius;if(n>s)return null;const r=Math.sqrt(s-n),o=i-r,a=i+r;return o<0&&a<0?null:o<0?this.at(a,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);if(0===t)return!0;return e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,n,s,r,o,a;const l=1/this.direction.x,c=1/this.direction.y,d=1/this.direction.z,h=this.origin;return l>=0?(i=(e.min.x-h.x)*l,n=(e.max.x-h.x)*l):(i=(e.max.x-h.x)*l,n=(e.min.x-h.x)*l),c>=0?(s=(e.min.y-h.y)*c,r=(e.max.y-h.y)*c):(s=(e.max.y-h.y)*c,r=(e.min.y-h.y)*c),i>r||s>n?null:((s>i||i!=i)&&(i=s),(r<n||n!=n)&&(n=r),d>=0?(o=(e.min.z-h.z)*d,a=(e.max.z-h.z)*d):(o=(e.max.z-h.z)*d,a=(e.min.z-h.z)*d),i>a||o>n?null:((o>i||i!=i)&&(i=o),(a<n||n!=n)&&(n=a),n<0?null:this.at(i>=0?i:n,t)))}intersectsBox(e){return null!==this.intersectBox(e,wn)}intersectTriangle(e,t,i,n,s){On.subVectors(t,e),An.subVectors(i,e),Cn.crossVectors(On,An);let r,o=this.direction.dot(Cn);if(o>0){if(n)return null;r=1}else{if(!(o<0))return null;r=-1,o=-o}Mn.subVectors(this.origin,e);const a=r*this.direction.dot(An.crossVectors(Mn,An));if(a<0)return null;const l=r*this.direction.dot(On.cross(Mn));if(l<0)return null;if(a+l>o)return null;const c=-r*Mn.dot(Cn);return c<0?null:this.at(c/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Matrix4{constructor(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}set(e,t,i,n,s,r,o,a,l,c,d,h,u,p,m,f){const g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=s,g[5]=r,g[9]=o,g[13]=a,g[2]=l,g[6]=c,g[10]=d,g[14]=h,g[3]=u,g[7]=p,g[11]=m,g[15]=f,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Matrix4).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,n=1/Pn.setFromMatrixColumn(e,0).length(),s=1/Pn.setFromMatrixColumn(e,1).length(),r=1/Pn.setFromMatrixColumn(e,2).length();return t[0]=i[0]*n,t[1]=i[1]*n,t[2]=i[2]*n,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*r,t[9]=i[9]*r,t[10]=i[10]*r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");const t=this.elements,i=e.x,n=e.y,s=e.z,r=Math.cos(i),o=Math.sin(i),a=Math.cos(n),l=Math.sin(n),c=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const e=r*c,i=r*d,n=o*c,s=o*d;t[0]=a*c,t[4]=-a*d,t[8]=l,t[1]=i+n*l,t[5]=e-s*l,t[9]=-o*a,t[2]=s-e*l,t[6]=n+i*l,t[10]=r*a}else if("YXZ"===e.order){const e=a*c,i=a*d,n=l*c,s=l*d;t[0]=e+s*o,t[4]=n*o-i,t[8]=r*l,t[1]=r*d,t[5]=r*c,t[9]=-o,t[2]=i*o-n,t[6]=s+e*o,t[10]=r*a}else if("ZXY"===e.order){const e=a*c,i=a*d,n=l*c,s=l*d;t[0]=e-s*o,t[4]=-r*d,t[8]=n+i*o,t[1]=i+n*o,t[5]=r*c,t[9]=s-e*o,t[2]=-r*l,t[6]=o,t[10]=r*a}else if("ZYX"===e.order){const e=r*c,i=r*d,n=o*c,s=o*d;t[0]=a*c,t[4]=n*l-i,t[8]=e*l+s,t[1]=a*d,t[5]=s*l+e,t[9]=i*l-n,t[2]=-l,t[6]=o*a,t[10]=r*a}else if("YZX"===e.order){const e=r*a,i=r*l,n=o*a,s=o*l;t[0]=a*c,t[4]=s-e*d,t[8]=n*d+i,t[1]=d,t[5]=r*c,t[9]=-o*c,t[2]=-l*c,t[6]=i*d+n,t[10]=e-s*d}else if("XZY"===e.order){const e=r*a,i=r*l,n=o*a,s=o*l;t[0]=a*c,t[4]=-d,t[8]=l*c,t[1]=e*d+s,t[5]=r*c,t[9]=i*d-n,t[2]=n*d-i,t[6]=o*c,t[10]=s*d+e}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Nn,e,In)}lookAt(e,t,i){const n=this.elements;return kn.subVectors(e,t),0===kn.lengthSq()&&(kn.z=1),kn.normalize(),Ln.crossVectors(i,kn),0===Ln.lengthSq()&&(1===Math.abs(i.z)?kn.x+=1e-4:kn.z+=1e-4,kn.normalize(),Ln.crossVectors(i,kn)),Ln.normalize(),Rn.crossVectors(kn,Ln),n[0]=Ln.x,n[4]=Rn.x,n[8]=kn.x,n[1]=Ln.y,n[5]=Rn.y,n[9]=kn.y,n[2]=Ln.z,n[6]=Rn.z,n[10]=kn.z,this}multiply(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,n=t.elements,s=this.elements,r=i[0],o=i[4],a=i[8],l=i[12],c=i[1],d=i[5],h=i[9],u=i[13],p=i[2],m=i[6],f=i[10],g=i[14],v=i[3],y=i[7],b=i[11],S=i[15],E=n[0],T=n[4],w=n[8],x=n[12],_=n[1],M=n[5],O=n[9],A=n[13],C=n[2],P=n[6],D=n[10],N=n[14],I=n[3],L=n[7],R=n[11],k=n[15];return s[0]=r*E+o*_+a*C+l*I,s[4]=r*T+o*M+a*P+l*L,s[8]=r*w+o*O+a*D+l*R,s[12]=r*x+o*A+a*N+l*k,s[1]=c*E+d*_+h*C+u*I,s[5]=c*T+d*M+h*P+u*L,s[9]=c*w+d*O+h*D+u*R,s[13]=c*x+d*A+h*N+u*k,s[2]=p*E+m*_+f*C+g*I,s[6]=p*T+m*M+f*P+g*L,s[10]=p*w+m*O+f*D+g*R,s[14]=p*x+m*A+f*N+g*k,s[3]=v*E+y*_+b*C+S*I,s[7]=v*T+y*M+b*P+S*L,s[11]=v*w+y*O+b*D+S*R,s[15]=v*x+y*A+b*N+S*k,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],n=e[8],s=e[12],r=e[1],o=e[5],a=e[9],l=e[13],c=e[2],d=e[6],h=e[10],u=e[14];return e[3]*(+s*a*d-n*l*d-s*o*h+i*l*h+n*o*u-i*a*u)+e[7]*(+t*a*u-t*l*h+s*r*h-n*r*u+n*l*c-s*a*c)+e[11]*(+t*l*d-t*o*u-s*r*d+i*r*u+s*o*c-i*l*c)+e[15]*(-n*o*c-t*a*d+t*o*h+n*r*d-i*r*h+i*a*c)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const n=this.elements;return e.isVector3?(n[12]=e.x,n[13]=e.y,n[14]=e.z):(n[12]=e,n[13]=t,n[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],n=e[2],s=e[3],r=e[4],o=e[5],a=e[6],l=e[7],c=e[8],d=e[9],h=e[10],u=e[11],p=e[12],m=e[13],f=e[14],g=e[15],v=d*f*l-m*h*l+m*a*u-o*f*u-d*a*g+o*h*g,y=p*h*l-c*f*l-p*a*u+r*f*u+c*a*g-r*h*g,b=c*m*l-p*d*l+p*o*u-r*m*u-c*o*g+r*d*g,S=p*d*a-c*m*a-p*o*h+r*m*h+c*o*f-r*d*f,E=t*v+i*y+n*b+s*S;if(0===E)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const T=1/E;return e[0]=v*T,e[1]=(m*h*s-d*f*s-m*n*u+i*f*u+d*n*g-i*h*g)*T,e[2]=(o*f*s-m*a*s+m*n*l-i*f*l-o*n*g+i*a*g)*T,e[3]=(d*a*s-o*h*s-d*n*l+i*h*l+o*n*u-i*a*u)*T,e[4]=y*T,e[5]=(c*f*s-p*h*s+p*n*u-t*f*u-c*n*g+t*h*g)*T,e[6]=(p*a*s-r*f*s-p*n*l+t*f*l+r*n*g-t*a*g)*T,e[7]=(r*h*s-c*a*s+c*n*l-t*h*l-r*n*u+t*a*u)*T,e[8]=b*T,e[9]=(p*d*s-c*m*s-p*i*u+t*m*u+c*i*g-t*d*g)*T,e[10]=(r*m*s-p*o*s+p*i*l-t*m*l-r*i*g+t*o*g)*T,e[11]=(c*o*s-r*d*s-c*i*l+t*d*l+r*i*u-t*o*u)*T,e[12]=S*T,e[13]=(c*m*n-p*d*n+p*i*h-t*m*h-c*i*f+t*d*f)*T,e[14]=(p*o*n-r*m*n-p*i*a+t*m*a+r*i*f-t*o*f)*T,e[15]=(r*d*n-c*o*n+c*i*a-t*d*a-r*i*h+t*o*h)*T,this}scale(e){const t=this.elements,i=e.x,n=e.y,s=e.z;return t[0]*=i,t[4]*=n,t[8]*=s,t[1]*=i,t[5]*=n,t[9]*=s,t[2]*=i,t[6]*=n,t[10]*=s,t[3]*=i,t[7]*=n,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,n))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),n=Math.sin(t),s=1-i,r=e.x,o=e.y,a=e.z,l=s*r,c=s*o;return this.set(l*r+i,l*o-n*a,l*a+n*o,0,l*o+n*a,c*o+i,c*a-n*r,0,l*a-n*o,c*a+n*r,s*a*a+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,n,s,r){return this.set(1,i,s,0,e,1,r,0,t,n,1,0,0,0,0,1),this}compose(e,t,i){const n=this.elements,s=t._x,r=t._y,o=t._z,a=t._w,l=s+s,c=r+r,d=o+o,h=s*l,u=s*c,p=s*d,m=r*c,f=r*d,g=o*d,v=a*l,y=a*c,b=a*d,S=i.x,E=i.y,T=i.z;return n[0]=(1-(m+g))*S,n[1]=(u+b)*S,n[2]=(p-y)*S,n[3]=0,n[4]=(u-b)*E,n[5]=(1-(h+g))*E,n[6]=(f+v)*E,n[7]=0,n[8]=(p+y)*T,n[9]=(f-v)*T,n[10]=(1-(h+m))*T,n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,this}decompose(e,t,i){const n=this.elements;let s=Pn.set(n[0],n[1],n[2]).length();const r=Pn.set(n[4],n[5],n[6]).length(),o=Pn.set(n[8],n[9],n[10]).length();this.determinant()<0&&(s=-s),e.x=n[12],e.y=n[13],e.z=n[14],Dn.copy(this);const a=1/s,l=1/r,c=1/o;return Dn.elements[0]*=a,Dn.elements[1]*=a,Dn.elements[2]*=a,Dn.elements[4]*=l,Dn.elements[5]*=l,Dn.elements[6]*=l,Dn.elements[8]*=c,Dn.elements[9]*=c,Dn.elements[10]*=c,t.setFromRotationMatrix(Dn),i.x=s,i.y=r,i.z=o,this}makePerspective(e,t,i,n,s,r){void 0===r&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");const o=this.elements,a=2*s/(t-e),l=2*s/(i-n),c=(t+e)/(t-e),d=(i+n)/(i-n),h=-(r+s)/(r-s),u=-2*r*s/(r-s);return o[0]=a,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=l,o[9]=d,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=u,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}makeOrthographic(e,t,i,n,s,r){const o=this.elements,a=1/(t-e),l=1/(i-n),c=1/(r-s),d=(t+e)*a,h=(i+n)*l,u=(r+s)*c;return o[0]=2*a,o[4]=0,o[8]=0,o[12]=-d,o[1]=0,o[5]=2*l,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-u,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let e=0;e<16;e++)if(t[e]!==i[e])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}Matrix4.prototype.isMatrix4=!0;const Pn=new Vector3,Dn=new Matrix4,Nn=new Vector3(0,0,0),In=new Vector3(1,1,1),Ln=new Vector3,Rn=new Vector3,kn=new Vector3,Un=new Matrix4,Bn=new Quaternion;class Euler{constructor(e=0,t=0,i=0,n=Euler.DefaultOrder){this._x=e,this._y=t,this._z=i,this._order=n}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,n=this._order){return this._x=e,this._y=t,this._z=i,this._order=n,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const n=e.elements,s=n[0],r=n[4],o=n[8],a=n[1],l=n[5],c=n[9],d=n[2],h=n[6],u=n[10];switch(t){case"XYZ":this._y=Math.asin(Hi(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,u),this._z=Math.atan2(-r,s)):(this._x=Math.atan2(h,l),this._z=0);break;case"YXZ":this._x=Math.asin(-Hi(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,u),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-d,s),this._z=0);break;case"ZXY":this._x=Math.asin(Hi(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-d,u),this._z=Math.atan2(-r,l)):(this._y=0,this._z=Math.atan2(a,s));break;case"ZYX":this._y=Math.asin(-Hi(d,-1,1)),Math.abs(d)<.9999999?(this._x=Math.atan2(h,u),this._z=Math.atan2(a,s)):(this._x=0,this._z=Math.atan2(-r,l));break;case"YZX":this._z=Math.asin(Hi(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,l),this._y=Math.atan2(-d,s)):(this._x=0,this._y=Math.atan2(o,u));break;case"XZY":this._z=Math.asin(-Hi(r,-1,1)),Math.abs(r)<.9999999?(this._x=Math.atan2(h,l),this._y=Math.atan2(o,s)):(this._x=Math.atan2(-c,u),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===i&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return Un.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Un,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return Bn.setFromEuler(this),this.setFromQuaternion(Bn,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}toVector3(e){return e?e.set(this._x,this._y,this._z):new Vector3(this._x,this._y,this._z)}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}}Euler.prototype.isEuler=!0,Euler.DefaultOrder="XYZ",Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];class Layers{constructor(){this.mask=1}set(e){this.mask=1<<e|0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}}let Fn=0;const Vn=new Vector3,Hn=new Quaternion,jn=new Matrix4,Gn=new Vector3,zn=new Vector3,Wn=new Vector3,Kn=new Quaternion,Yn=new Vector3(1,0,0),qn=new Vector3(0,1,0),Zn=new Vector3(0,0,1),$n={type:"added"},Qn={type:"removed"};class Object3D extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:Fn++}),this.uuid=Vi(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Object3D.DefaultUp.clone();const e=new Vector3,t=new Euler,i=new Quaternion,n=new Vector3(1,1,1);t._onChange((function(){i.setFromEuler(t,!1)})),i._onChange((function(){t.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:n},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}}),this.matrix=new Matrix4,this.matrixWorld=new Matrix4,this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new Layers,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Hn.setFromAxisAngle(e,t),this.quaternion.multiply(Hn),this}rotateOnWorldAxis(e,t){return Hn.setFromAxisAngle(e,t),this.quaternion.premultiply(Hn),this}rotateX(e){return this.rotateOnAxis(Yn,e)}rotateY(e){return this.rotateOnAxis(qn,e)}rotateZ(e){return this.rotateOnAxis(Zn,e)}translateOnAxis(e,t){return Vn.copy(e).applyQuaternion(this.quaternion),this.position.add(Vn.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(Yn,e)}translateY(e){return this.translateOnAxis(qn,e)}translateZ(e){return this.translateOnAxis(Zn,e)}localToWorld(e){return e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return e.applyMatrix4(jn.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Gn.copy(e):Gn.set(e,t,i);const n=this.parent;this.updateWorldMatrix(!0,!1),zn.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?jn.lookAt(zn,Gn,this.up):jn.lookAt(Gn,zn,this.up),this.quaternion.setFromRotationMatrix(jn),n&&(jn.extractRotation(n.matrixWorld),Hn.setFromRotationMatrix(jn),this.quaternion.premultiply(Hn.invert()))}add(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent($n)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.remove(arguments[e]);return this}const t=this.children.indexOf(e);return-1!==t&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Qn)),this}removeFromParent(){const e=this.parent;return null!==e&&e.remove(this),this}clear(){for(let e=0;e<this.children.length;e++){const t=this.children[e];t.parent=null,t.dispatchEvent(Qn)}return this.children.length=0,this}attach(e){return this.updateWorldMatrix(!0,!1),jn.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),jn.multiply(e.parent.matrixWorld)),e.applyMatrix4(jn),this.add(e),e.updateWorldMatrix(!1,!0),this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,n=this.children.length;i<n;i++){const n=this.children[i].getObjectByProperty(e,t);if(void 0!==n)return n}}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zn,e,Wn),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(zn,Kn,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverse(e)}traverseVisible(e){if(!1===this.visible)return;e(this);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,n=t.length;i<n;i++)t[i].updateMatrixWorld(e)}updateWorldMatrix(e,t){const i=this.parent;if(!0===e&&null!==i&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t){const e=this.children;for(let t=0,i=e.length;t<i;t++)e[t].updateWorldMatrix(!1,!0)}}toJSON(e){const t=void 0===e||"string"==typeof e,i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{}},i.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const n={};function s(t,i){return void 0===t[i.uuid]&&(t[i.uuid]=i.toJSON(e)),i.uuid}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),!0===this.castShadow&&(n.castShadow=!0),!0===this.receiveShadow&&(n.receiveShadow=!0),!1===this.visible&&(n.visible=!1),!1===this.frustumCulled&&(n.frustumCulled=!1),0!==this.renderOrder&&(n.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),n.layers=this.layers.mask,n.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(n.matrixAutoUpdate=!1),this.isInstancedMesh&&(n.type="InstancedMesh",n.count=this.count,n.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(n.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?n.background=this.background.toJSON():this.background.isTexture&&(n.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(n.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){n.geometry=s(e.geometries,this.geometry);const t=this.geometry.parameters;if(void 0!==t&&void 0!==t.shapes){const i=t.shapes;if(Array.isArray(i))for(let t=0,n=i.length;t<n;t++){const n=i[t];s(e.shapes,n)}else s(e.shapes,i)}}if(this.isSkinnedMesh&&(n.bindMode=this.bindMode,n.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(s(e.skeletons,this.skeleton),n.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const t=[];for(let i=0,n=this.material.length;i<n;i++)t.push(s(e.materials,this.material[i]));n.material=t}else n.material=s(e.materials,this.material);if(this.children.length>0){n.children=[];for(let t=0;t<this.children.length;t++)n.children.push(this.children[t].toJSON(e).object)}if(this.animations.length>0){n.animations=[];for(let t=0;t<this.animations.length;t++){const i=this.animations[t];n.animations.push(s(e.animations,i))}}if(t){const t=r(e.geometries),n=r(e.materials),s=r(e.textures),o=r(e.images),a=r(e.shapes),l=r(e.skeletons),c=r(e.animations);t.length>0&&(i.geometries=t),n.length>0&&(i.materials=n),s.length>0&&(i.textures=s),o.length>0&&(i.images=o),a.length>0&&(i.shapes=a),l.length>0&&(i.skeletons=l),c.length>0&&(i.animations=c)}return i.object=n,i;function r(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}}clone(e){return(new this.constructor).copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(let t=0;t<e.children.length;t++){const i=e.children[t];this.add(i.clone())}return this}}Object3D.DefaultUp=new Vector3(0,1,0),Object3D.DefaultMatrixAutoUpdate=!0,Object3D.prototype.isObject3D=!0;const Xn=new Vector3,Jn=new Vector3,es=new Vector3,ts=new Vector3,is=new Vector3,ns=new Vector3,ss=new Vector3,rs=new Vector3,os=new Vector3,as=new Vector3;class Triangle{constructor(e=new Vector3,t=new Vector3,i=new Vector3){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,n){n.subVectors(i,t),Xn.subVectors(e,t),n.cross(Xn);const s=n.lengthSq();return s>0?n.multiplyScalar(1/Math.sqrt(s)):n.set(0,0,0)}static getBarycoord(e,t,i,n,s){Xn.subVectors(n,t),Jn.subVectors(i,t),es.subVectors(e,t);const r=Xn.dot(Xn),o=Xn.dot(Jn),a=Xn.dot(es),l=Jn.dot(Jn),c=Jn.dot(es),d=r*l-o*o;if(0===d)return s.set(-2,-1,-1);const h=1/d,u=(l*a-o*c)*h,p=(r*c-o*a)*h;return s.set(1-u-p,p,u)}static containsPoint(e,t,i,n){return this.getBarycoord(e,t,i,n,ts),ts.x>=0&&ts.y>=0&&ts.x+ts.y<=1}static getUV(e,t,i,n,s,r,o,a){return this.getBarycoord(e,t,i,n,ts),a.set(0,0),a.addScaledVector(s,ts.x),a.addScaledVector(r,ts.y),a.addScaledVector(o,ts.z),a}static isFrontFacing(e,t,i,n){return Xn.subVectors(i,t),Jn.subVectors(e,t),Xn.cross(Jn).dot(n)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this}setFromAttributeAndIndices(e,t,i,n){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,n),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Xn.subVectors(this.c,this.b),Jn.subVectors(this.a,this.b),.5*Xn.cross(Jn).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Triangle.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Triangle.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,n,s){return Triangle.getUV(e,this.a,this.b,this.c,t,i,n,s)}containsPoint(e){return Triangle.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Triangle.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,n=this.b,s=this.c;let r,o;is.subVectors(n,i),ns.subVectors(s,i),rs.subVectors(e,i);const a=is.dot(rs),l=ns.dot(rs);if(a<=0&&l<=0)return t.copy(i);os.subVectors(e,n);const c=is.dot(os),d=ns.dot(os);if(c>=0&&d<=c)return t.copy(n);const h=a*d-c*l;if(h<=0&&a>=0&&c<=0)return r=a/(a-c),t.copy(i).addScaledVector(is,r);as.subVectors(e,s);const u=is.dot(as),p=ns.dot(as);if(p>=0&&u<=p)return t.copy(s);const m=u*l-a*p;if(m<=0&&l>=0&&p<=0)return o=l/(l-p),t.copy(i).addScaledVector(ns,o);const f=c*p-u*d;if(f<=0&&d-c>=0&&u-p>=0)return ss.subVectors(s,n),o=(d-c)/(d-c+(u-p)),t.copy(n).addScaledVector(ss,o);const g=1/(f+m+h);return r=m*g,o=h*g,t.copy(i).addScaledVector(is,r).addScaledVector(ns,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let ls=0;class Material extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:ls++}),this.uuid=Vi(),this.name="",this.type="Material",this.fog=!0,this.blending=S,this.side=m,this.vertexColors=!1,this.opacity=1,this.format=Be,this.transparent=!1,this.blendSrc=L,this.blendDst=R,this.blendEquation=_,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=z,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=wi,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=ci,this.stencilZFail=ci,this.stencilZPass=ci,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}if("shading"===t){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=i===v;continue}const n=this[t];void 0!==n?n&&n.isColor?n.set(i):n&&n.isVector3&&i&&i.isVector3?n.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function n(e){const t=[];for(const i in e){const n=e[i];delete n.metadata,t.push(n)}return t}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==S&&(i.blending=this.blending),this.side!==m&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.format!==Be&&(i.format=this.format),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const t=n(e.textures),s=n(e.images);t.length>0&&(i.textures=t),s.length>0&&(i.images=s)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.format=e.format,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const e=t.length;i=new Array(e);for(let n=0;n!==e;++n)i[n]=t[n].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}Material.prototype.isMaterial=!0;const cs={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ds={h:0,s:0,l:0},hs={h:0,s:0,l:0};function us(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+6*(t-e)*(2/3-i):e}function ps(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function ms(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}class Color{constructor(e,t,i){return void 0===t&&void 0===i?this.set(e):this.setRGB(e,t,i)}set(e){return e&&e.isColor?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this}setRGB(e,t,i){return this.r=e,this.g=t,this.b=i,this}setHSL(e,t,i){if(e=ji(e,1),t=Hi(t,0,1),i=Hi(i,0,1),0===t)this.r=this.g=this.b=i;else{const n=i<=.5?i*(1+t):i+t-i*t,s=2*i-n;this.r=us(s,n,e+1/3),this.g=us(s,n,e),this.b=us(s,n,e-1/3)}return this}setStyle(e){function t(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){let e;const n=i[1],s=i[2];switch(n){case"rgb":case"rgba":if(e=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,t(e[4]),this;if(e=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s))return this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,t(e[4]),this;break;case"hsl":case"hsla":if(e=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(s)){const i=parseFloat(e[1])/360,n=parseInt(e[2],10)/100,s=parseInt(e[3],10)/100;return t(e[4]),this.setHSL(i,n,s)}}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const e=i[1],t=e.length;if(3===t)return this.r=parseInt(e.charAt(0)+e.charAt(0),16)/255,this.g=parseInt(e.charAt(1)+e.charAt(1),16)/255,this.b=parseInt(e.charAt(2)+e.charAt(2),16)/255,this;if(6===t)return this.r=parseInt(e.charAt(0)+e.charAt(1),16)/255,this.g=parseInt(e.charAt(2)+e.charAt(3),16)/255,this.b=parseInt(e.charAt(4)+e.charAt(5),16)/255,this}return e&&e.length>0?this.setColorName(e):this}setColorName(e){const t=cs[e.toLowerCase()];return void 0!==t?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copyGammaToLinear(e,t=2){return this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this}copyLinearToGamma(e,t=2){const i=t>0?1/t:1;return this.r=Math.pow(e.r,i),this.g=Math.pow(e.g,i),this.b=Math.pow(e.b,i),this}convertGammaToLinear(e){return this.copyGammaToLinear(this,e),this}convertLinearToGamma(e){return this.copyLinearToGamma(this,e),this}copySRGBToLinear(e){return this.r=ps(e.r),this.g=ps(e.g),this.b=ps(e.b),this}copyLinearToSRGB(e){return this.r=ms(e.r),this.g=ms(e.g),this.b=ms(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0}getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)}getHSL(e){const t=this.r,i=this.g,n=this.b,s=Math.max(t,i,n),r=Math.min(t,i,n);let o,a;const l=(r+s)/2;if(r===s)o=0,a=0;else{const e=s-r;switch(a=l<=.5?e/(s+r):e/(2-s-r),s){case t:o=(i-n)/e+(i<n?6:0);break;case i:o=(n-t)/e+2;break;case n:o=(t-i)/e+4}o/=6}return e.h=o,e.s=a,e.l=l,e}getStyle(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"}offsetHSL(e,t,i){return this.getHSL(ds),ds.h+=e,ds.s+=t,ds.l+=i,this.setHSL(ds.h,ds.s,ds.l),this}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ds),e.getHSL(hs);const i=Gi(ds.h,hs.h,t),n=Gi(ds.s,hs.s,t),s=Gi(ds.l,hs.l,t);return this.setHSL(i,n,s),this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}toJSON(){return this.getHex()}}Color.NAMES=cs,Color.prototype.isColor=!0,Color.prototype.r=1,Color.prototype.g=1,Color.prototype.b=1;class MeshBasicMaterial extends Material{constructor(e){super(),this.type="MeshBasicMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;const fs=new Vector3,gs=new Vector2;class BufferAttribute{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=xi,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let n=0,s=this.itemSize;n<s;n++)this.array[e+n]=t.array[i+n];return this}copyArray(e){return this.array.set(e),this}copyColorsArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",n),s=new Color),t[i++]=s.r,t[i++]=s.g,t[i++]=s.b}return this}copyVector2sArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",n),s=new Vector2),t[i++]=s.x,t[i++]=s.y}return this}copyVector3sArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",n),s=new Vector3),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z}return this}copyVector4sArray(e){const t=this.array;let i=0;for(let n=0,s=e.length;n<s;n++){let s=e[n];void 0===s&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",n),s=new Vector4),t[i++]=s.x,t[i++]=s.y,t[i++]=s.z,t[i++]=s.w}return this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)gs.fromBufferAttribute(this,t),gs.applyMatrix3(e),this.setXY(t,gs.x,gs.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)fs.fromBufferAttribute(this,t),fs.applyMatrix3(e),this.setXYZ(t,fs.x,fs.y,fs.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)fs.x=this.getX(t),fs.y=this.getY(t),fs.z=this.getZ(t),fs.applyMatrix4(e),this.setXYZ(t,fs.x,fs.y,fs.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)fs.x=this.getX(t),fs.y=this.getY(t),fs.z=this.getZ(t),fs.applyNormalMatrix(e),this.setXYZ(t,fs.x,fs.y,fs.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)fs.x=this.getX(t),fs.y=this.getY(t),fs.z=this.getZ(t),fs.transformDirection(e),this.setXYZ(t,fs.x,fs.y,fs.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){return this.array[e*this.itemSize]}setX(e,t){return this.array[e*this.itemSize]=t,this}getY(e){return this.array[e*this.itemSize+1]}setY(e,t){return this.array[e*this.itemSize+1]=t,this}getZ(e){return this.array[e*this.itemSize+2]}setZ(e,t){return this.array[e*this.itemSize+2]=t,this}getW(e){return this.array[e*this.itemSize+3]}setW(e,t){return this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=n,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==xi&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}BufferAttribute.prototype.isBufferAttribute=!0;class Int8BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Int8Array(e),t,i)}}class Uint8BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint8Array(e),t,i)}}class Uint8ClampedBufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint8ClampedArray(e),t,i)}}class Int16BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Int16Array(e),t,i)}}class Uint16BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class Int32BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Int32Array(e),t,i)}}class Uint32BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Float16BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Uint16Array(e),t,i)}}Float16BufferAttribute.prototype.isFloat16BufferAttribute=!0;class Float32BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Float32Array(e),t,i)}}class Float64BufferAttribute extends BufferAttribute{constructor(e,t,i){super(new Float64Array(e),t,i)}}let vs=0;const ys=new Matrix4,bs=new Object3D,Ss=new Vector3,Es=new Box3,Ts=new Box3,ws=new Vector3;class BufferGeometry extends EventDispatcher{constructor(){super(),Object.defineProperty(this,"id",{value:vs++}),this.uuid=Vi(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(qi(e)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const t=(new Matrix3).getNormalMatrix(e);i.applyNormalMatrix(t),i.needsUpdate=!0}const n=this.attributes.tangent;return void 0!==n&&(n.transformDirection(e),n.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return ys.makeRotationFromQuaternion(e),this.applyMatrix4(ys),this}rotateX(e){return ys.makeRotationX(e),this.applyMatrix4(ys),this}rotateY(e){return ys.makeRotationY(e),this.applyMatrix4(ys),this}rotateZ(e){return ys.makeRotationZ(e),this.applyMatrix4(ys),this}translate(e,t,i){return ys.makeTranslation(e,t,i),this.applyMatrix4(ys),this}scale(e,t,i){return ys.makeScale(e,t,i),this.applyMatrix4(ys),this}lookAt(e){return bs.lookAt(e),bs.updateMatrix(),this.applyMatrix4(bs.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ss).negate(),this.translate(Ss.x,Ss.y,Ss.z),this}setFromPoints(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i];t.push(n.x,n.y,n.z||0)}return this.setAttribute("position",new Float32BufferAttribute(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Box3);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Vector3(-1/0,-1/0,-1/0),new Vector3(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Es.setFromBufferAttribute(i),this.morphTargetsRelative?(ws.addVectors(this.boundingBox.min,Es.min),this.boundingBox.expandByPoint(ws),ws.addVectors(this.boundingBox.max,Es.max),this.boundingBox.expandByPoint(ws)):(this.boundingBox.expandByPoint(Es.min),this.boundingBox.expandByPoint(Es.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new Sphere);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Vector3,1/0);if(e){const i=this.boundingSphere.center;if(Es.setFromBufferAttribute(e),t)for(let e=0,i=t.length;e<i;e++){const i=t[e];Ts.setFromBufferAttribute(i),this.morphTargetsRelative?(ws.addVectors(Es.min,Ts.min),Es.expandByPoint(ws),ws.addVectors(Es.max,Ts.max),Es.expandByPoint(ws)):(Es.expandByPoint(Ts.min),Es.expandByPoint(Ts.max))}Es.getCenter(i);let n=0;for(let t=0,s=e.count;t<s;t++)ws.fromBufferAttribute(e,t),n=Math.max(n,i.distanceToSquared(ws));if(t)for(let s=0,r=t.length;s<r;s++){const r=t[s],o=this.morphTargetsRelative;for(let t=0,s=r.count;t<s;t++)ws.fromBufferAttribute(r,t),o&&(Ss.fromBufferAttribute(e,t),ws.add(Ss)),n=Math.max(n,i.distanceToSquared(ws))}this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,n=t.position.array,s=t.normal.array,r=t.uv.array,o=n.length/3;void 0===t.tangent&&this.setAttribute("tangent",new BufferAttribute(new Float32Array(4*o),4));const a=t.tangent.array,l=[],c=[];for(let e=0;e<o;e++)l[e]=new Vector3,c[e]=new Vector3;const d=new Vector3,h=new Vector3,u=new Vector3,p=new Vector2,m=new Vector2,f=new Vector2,g=new Vector3,v=new Vector3;function y(e,t,i){d.fromArray(n,3*e),h.fromArray(n,3*t),u.fromArray(n,3*i),p.fromArray(r,2*e),m.fromArray(r,2*t),f.fromArray(r,2*i),h.sub(d),u.sub(d),m.sub(p),f.sub(p);const s=1/(m.x*f.y-f.x*m.y);isFinite(s)&&(g.copy(h).multiplyScalar(f.y).addScaledVector(u,-m.y).multiplyScalar(s),v.copy(u).multiplyScalar(m.x).addScaledVector(h,-f.x).multiplyScalar(s),l[e].add(g),l[t].add(g),l[i].add(g),c[e].add(v),c[t].add(v),c[i].add(v))}let b=this.groups;0===b.length&&(b=[{start:0,count:i.length}]);for(let e=0,t=b.length;e<t;++e){const t=b[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)y(i[e+0],i[e+1],i[e+2])}const S=new Vector3,E=new Vector3,T=new Vector3,w=new Vector3;function x(e){T.fromArray(s,3*e),w.copy(T);const t=l[e];S.copy(t),S.sub(T.multiplyScalar(T.dot(t))).normalize(),E.crossVectors(w,t);const i=E.dot(c[e])<0?-1:1;a[4*e]=S.x,a[4*e+1]=S.y,a[4*e+2]=S.z,a[4*e+3]=i}for(let e=0,t=b.length;e<t;++e){const t=b[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)x(i[e+0]),x(i[e+1]),x(i[e+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new BufferAttribute(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let e=0,t=i.count;e<t;e++)i.setXYZ(e,0,0,0);const n=new Vector3,s=new Vector3,r=new Vector3,o=new Vector3,a=new Vector3,l=new Vector3,c=new Vector3,d=new Vector3;if(e)for(let h=0,u=e.count;h<u;h+=3){const u=e.getX(h+0),p=e.getX(h+1),m=e.getX(h+2);n.fromBufferAttribute(t,u),s.fromBufferAttribute(t,p),r.fromBufferAttribute(t,m),c.subVectors(r,s),d.subVectors(n,s),c.cross(d),o.fromBufferAttribute(i,u),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,m),o.add(c),a.add(c),l.add(c),i.setXYZ(u,o.x,o.y,o.z),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(m,l.x,l.y,l.z)}else for(let e=0,o=t.count;e<o;e+=3)n.fromBufferAttribute(t,e+0),s.fromBufferAttribute(t,e+1),r.fromBufferAttribute(t,e+2),c.subVectors(r,s),d.subVectors(n,s),c.cross(d),i.setXYZ(e+0,c.x,c.y,c.z),i.setXYZ(e+1,c.x,c.y,c.z),i.setXYZ(e+2,c.x,c.y,c.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(e,t){if(!e||!e.isBufferGeometry)return void console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e);void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));const i=this.attributes;for(const n in i){if(void 0===e.attributes[n])continue;const s=i[n].array,r=e.attributes[n],o=r.array,a=r.itemSize*t,l=Math.min(o.length,s.length-a);for(let e=0,t=a;e<l;e++,t++)s[t]=o[e]}return this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ws.fromBufferAttribute(e,t),ws.normalize(),e.setXYZ(t,ws.x,ws.y,ws.z)}toNonIndexed(){function e(e,t){const i=e.array,n=e.itemSize,s=e.normalized,r=new i.constructor(t.length*n);let o=0,a=0;for(let s=0,l=t.length;s<l;s++){o=e.isInterleavedBufferAttribute?t[s]*e.data.stride+e.offset:t[s]*n;for(let e=0;e<n;e++)r[a++]=i[o++]}return new BufferAttribute(r,n,s)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new BufferGeometry,i=this.index.array,n=this.attributes;for(const s in n){const r=e(n[s],i);t.setAttribute(s,r)}const s=this.morphAttributes;for(const n in s){const r=[],o=s[n];for(let t=0,n=o.length;t<n;t++){const n=e(o[t],i);r.push(n)}t.morphAttributes[n]=r}t.morphTargetsRelative=this.morphTargetsRelative;const r=this.groups;for(let e=0,i=r.length;e<i;e++){const i=r[e];t.addGroup(i.start,i.count,i.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const t=this.parameters;for(const i in t)void 0!==t[i]&&(e[i]=t[i]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const t in i){const n=i[t];e.data.attributes[t]=n.toJSON(e.data)}const n={};let s=!1;for(const t in this.morphAttributes){const i=this.morphAttributes[t],r=[];for(let t=0,n=i.length;t<n;t++){const n=i[t];r.push(n.toJSON(e.data))}r.length>0&&(n[t]=r,s=!0)}s&&(e.data.morphAttributes=n,e.data.morphTargetsRelative=this.morphTargetsRelative);const r=this.groups;r.length>0&&(e.data.groups=JSON.parse(JSON.stringify(r)));const o=this.boundingSphere;return null!==o&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const n=e.attributes;for(const e in n){const i=n[e];this.setAttribute(e,i.clone(t))}const s=e.morphAttributes;for(const e in s){const i=[],n=s[e];for(let e=0,s=n.length;e<s;e++)i.push(n[e].clone(t));this.morphAttributes[e]=i}this.morphTargetsRelative=e.morphTargetsRelative;const r=e.groups;for(let e=0,t=r.length;e<t;e++){const t=r[e];this.addGroup(t.start,t.count,t.materialIndex)}const o=e.boundingBox;null!==o&&(this.boundingBox=o.clone());const a=e.boundingSphere;return null!==a&&(this.boundingSphere=a.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}BufferGeometry.prototype.isBufferGeometry=!0;const xs=new Matrix4,_s=new Ray,Ms=new Sphere,Os=new Vector3,As=new Vector3,Cs=new Vector3,Ps=new Vector3,Ds=new Vector3,Ns=new Vector3,Is=new Vector3,Ls=new Vector3,Rs=new Vector3,ks=new Vector2,Us=new Vector2,Bs=new Vector2,Fs=new Vector3,Vs=new Vector3;class Mesh extends Object3D{constructor(e=new BufferGeometry,t=new MeshBasicMaterial){super(),this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}raycast(e,t){const i=this.geometry,n=this.material,s=this.matrixWorld;if(void 0===n)return;if(null===i.boundingSphere&&i.computeBoundingSphere(),Ms.copy(i.boundingSphere),Ms.applyMatrix4(s),!1===e.ray.intersectsSphere(Ms))return;if(xs.copy(s).invert(),_s.copy(e.ray).applyMatrix4(xs),null!==i.boundingBox&&!1===_s.intersectsBox(i.boundingBox))return;let r;if(i.isBufferGeometry){const s=i.index,o=i.attributes.position,a=i.morphAttributes.position,l=i.morphTargetsRelative,c=i.attributes.uv,d=i.attributes.uv2,h=i.groups,u=i.drawRange;if(null!==s)if(Array.isArray(n))for(let i=0,p=h.length;i<p;i++){const p=h[i],m=n[p.materialIndex];for(let i=Math.max(p.start,u.start),n=Math.min(s.count,Math.min(p.start+p.count,u.start+u.count));i<n;i+=3){const n=s.getX(i),h=s.getX(i+1),u=s.getX(i+2);r=Hs(this,m,e,_s,o,a,l,c,d,n,h,u),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=p.materialIndex,t.push(r))}}else{for(let i=Math.max(0,u.start),h=Math.min(s.count,u.start+u.count);i<h;i+=3){const h=s.getX(i),u=s.getX(i+1),p=s.getX(i+2);r=Hs(this,n,e,_s,o,a,l,c,d,h,u,p),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}else if(void 0!==o)if(Array.isArray(n))for(let i=0,s=h.length;i<s;i++){const s=h[i],p=n[s.materialIndex];for(let i=Math.max(s.start,u.start),n=Math.min(o.count,Math.min(s.start+s.count,u.start+u.count));i<n;i+=3){r=Hs(this,p,e,_s,o,a,l,c,d,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),r.face.materialIndex=s.materialIndex,t.push(r))}}else{for(let i=Math.max(0,u.start),s=Math.min(o.count,u.start+u.count);i<s;i+=3){r=Hs(this,n,e,_s,o,a,l,c,d,i,i+1,i+2),r&&(r.faceIndex=Math.floor(i/3),t.push(r))}}}else i.isGeometry&&console.error("THREE.Mesh.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}}function Hs(e,t,i,n,s,r,o,a,l,c,d,h){Os.fromBufferAttribute(s,c),As.fromBufferAttribute(s,d),Cs.fromBufferAttribute(s,h);const u=e.morphTargetInfluences;if(r&&u){Is.set(0,0,0),Ls.set(0,0,0),Rs.set(0,0,0);for(let e=0,t=r.length;e<t;e++){const t=u[e],i=r[e];0!==t&&(Ps.fromBufferAttribute(i,c),Ds.fromBufferAttribute(i,d),Ns.fromBufferAttribute(i,h),o?(Is.addScaledVector(Ps,t),Ls.addScaledVector(Ds,t),Rs.addScaledVector(Ns,t)):(Is.addScaledVector(Ps.sub(Os),t),Ls.addScaledVector(Ds.sub(As),t),Rs.addScaledVector(Ns.sub(Cs),t)))}Os.add(Is),As.add(Ls),Cs.add(Rs)}e.isSkinnedMesh&&(e.boneTransform(c,Os),e.boneTransform(d,As),e.boneTransform(h,Cs));const p=function(e,t,i,n,s,r,o,a){let l;if(l=t.side===f?n.intersectTriangle(o,r,s,!0,a):n.intersectTriangle(s,r,o,t.side!==g,a),null===l)return null;Vs.copy(a),Vs.applyMatrix4(e.matrixWorld);const c=i.ray.origin.distanceTo(Vs);return c<i.near||c>i.far?null:{distance:c,point:Vs.clone(),object:e}}(e,t,i,n,Os,As,Cs,Fs);if(p){a&&(ks.fromBufferAttribute(a,c),Us.fromBufferAttribute(a,d),Bs.fromBufferAttribute(a,h),p.uv=Triangle.getUV(Fs,Os,As,Cs,ks,Us,Bs,new Vector2)),l&&(ks.fromBufferAttribute(l,c),Us.fromBufferAttribute(l,d),Bs.fromBufferAttribute(l,h),p.uv2=Triangle.getUV(Fs,Os,As,Cs,ks,Us,Bs,new Vector2));const e={a:c,b:d,c:h,normal:new Vector3,materialIndex:0};Triangle.getNormal(Os,As,Cs,e.normal),p.face=e}return p}Mesh.prototype.isMesh=!0;class BoxGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,n=1,s=1,r=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:n,heightSegments:s,depthSegments:r};const o=this;n=Math.floor(n),s=Math.floor(s),r=Math.floor(r);const a=[],l=[],c=[],d=[];let h=0,u=0;function p(e,t,i,n,s,r,p,m,f,g,v){const y=r/f,b=p/g,S=r/2,E=p/2,T=m/2,w=f+1,x=g+1;let _=0,M=0;const O=new Vector3;for(let r=0;r<x;r++){const o=r*b-E;for(let a=0;a<w;a++){const h=a*y-S;O[e]=h*n,O[t]=o*s,O[i]=T,l.push(O.x,O.y,O.z),O[e]=0,O[t]=0,O[i]=m>0?1:-1,c.push(O.x,O.y,O.z),d.push(a/f),d.push(1-r/g),_+=1}}for(let e=0;e<g;e++)for(let t=0;t<f;t++){const i=h+t+w*e,n=h+t+w*(e+1),s=h+(t+1)+w*(e+1),r=h+(t+1)+w*e;a.push(i,n,r),a.push(n,s,r),M+=6}o.addGroup(u,M,v),u+=M,h+=_}p("z","y","x",-1,-1,i,t,e,r,s,0),p("z","y","x",1,-1,i,t,-e,r,s,1),p("x","z","y",1,1,e,i,t,n,r,2),p("x","z","y",1,-1,e,i,-t,n,r,3),p("x","y","z",1,-1,e,t,i,n,s,4),p("x","y","z",-1,-1,e,t,-i,n,s,5),this.setIndex(a),this.setAttribute("position",new Float32BufferAttribute(l,3)),this.setAttribute("normal",new Float32BufferAttribute(c,3)),this.setAttribute("uv",new Float32BufferAttribute(d,2))}static fromJSON(e){return new BoxGeometry(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function js(e){const t={};for(const i in e){t[i]={};for(const n in e[i]){const s=e[i][n];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?t[i][n]=s.clone():Array.isArray(s)?t[i][n]=s.slice():t[i][n]=s}}return t}function Gs(e){const t={};for(let i=0;i<e.length;i++){const n=js(e[i]);for(const e in n)t[e]=n[e]}return t}const zs={clone:js,merge:Gs};class ShaderMaterial extends Material{constructor(e){super(),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=js(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const n=this.uniforms[i].value;n&&n.isTexture?t.uniforms[i]={type:"t",value:n.toJSON(e).uuid}:n&&n.isColor?t.uniforms[i]={type:"c",value:n.getHex()}:n&&n.isVector2?t.uniforms[i]={type:"v2",value:n.toArray()}:n&&n.isVector3?t.uniforms[i]={type:"v3",value:n.toArray()}:n&&n.isVector4?t.uniforms[i]={type:"v4",value:n.toArray()}:n&&n.isMatrix3?t.uniforms[i]={type:"m3",value:n.toArray()}:n&&n.isMatrix4?t.uniforms[i]={type:"m4",value:n.toArray()}:t.uniforms[i]={value:n}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const e in this.extensions)!0===this.extensions[e]&&(i[e]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}ShaderMaterial.prototype.isShaderMaterial=!0;class Camera extends Object3D{constructor(){super(),this.type="Camera",this.matrixWorldInverse=new Matrix4,this.projectionMatrix=new Matrix4,this.projectionMatrixInverse=new Matrix4}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}Camera.prototype.isCamera=!0;class PerspectiveCamera extends Camera{constructor(e=50,t=1,i=.1,n=2e3){super(),this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=n,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Ui*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*ki*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Ui*Math.atan(Math.tan(.5*ki*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,n,s,r){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*ki*this.fov)/this.zoom,i=2*t,n=this.aspect*i,s=-.5*n;const r=this.view;if(null!==this.view&&this.view.enabled){const e=r.fullWidth,o=r.fullHeight;s+=r.offsetX*n/e,t-=r.offsetY*i/o,n*=r.width/e,i*=r.height/o}const o=this.filmOffset;0!==o&&(s+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+n,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}PerspectiveCamera.prototype.isPerspectiveCamera=!0;const Ws=90;class CubeCamera extends Object3D{constructor(e,t,i){if(super(),this.type="CubeCamera",!0!==i.isWebGLCubeRenderTarget)return void console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter.");this.renderTarget=i;const n=new PerspectiveCamera(Ws,1,e,t);n.layers=this.layers,n.up.set(0,-1,0),n.lookAt(new Vector3(1,0,0)),this.add(n);const s=new PerspectiveCamera(Ws,1,e,t);s.layers=this.layers,s.up.set(0,-1,0),s.lookAt(new Vector3(-1,0,0)),this.add(s);const r=new PerspectiveCamera(Ws,1,e,t);r.layers=this.layers,r.up.set(0,0,1),r.lookAt(new Vector3(0,1,0)),this.add(r);const o=new PerspectiveCamera(Ws,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(new Vector3(0,-1,0)),this.add(o);const a=new PerspectiveCamera(Ws,1,e,t);a.layers=this.layers,a.up.set(0,-1,0),a.lookAt(new Vector3(0,0,1)),this.add(a);const l=new PerspectiveCamera(Ws,1,e,t);l.layers=this.layers,l.up.set(0,-1,0),l.lookAt(new Vector3(0,0,-1)),this.add(l)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[n,s,r,o,a,l]=this.children,c=e.xr.enabled,d=e.getRenderTarget();e.xr.enabled=!1;const h=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,n),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,r),e.setRenderTarget(i,3),e.render(t,o),e.setRenderTarget(i,4),e.render(t,a),i.texture.generateMipmaps=h,e.setRenderTarget(i,5),e.render(t,l),e.setRenderTarget(d),e.xr.enabled=c}}class CubeTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c){super(e=void 0!==e?e:[],t=void 0!==t?t:re,i,n,s,r,o,a,l,c),this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}CubeTexture.prototype.isCubeTexture=!0;class WebGLCubeRenderTarget extends WebGLRenderTarget{constructor(e,t,i){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=i),super(e,e,t),t=t||{},this.texture=new CubeTexture(void 0,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:be,this.texture._needsFlipEnvMap=!1}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.format=Be,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:"\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",fragmentShader:"\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t"},n=new BoxGeometry(5,5,5),s=new ShaderMaterial({name:"CubemapFromEquirect",uniforms:js(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:f,blending:b});s.uniforms.tEquirect.value=t;const r=new Mesh(n,s),o=t.minFilter;t.minFilter===Te&&(t.minFilter=be);return new CubeCamera(1,10,this).update(e,r),t.minFilter=o,r.geometry.dispose(),r.material.dispose(),this}clear(e,t,i,n){const s=e.getRenderTarget();for(let s=0;s<6;s++)e.setRenderTarget(this,s),e.clear(t,i,n);e.setRenderTarget(s)}}WebGLCubeRenderTarget.prototype.isWebGLCubeRenderTarget=!0;const Ks=new Vector3,Ys=new Vector3,qs=new Matrix3;class Plane{constructor(e=new Vector3(1,0,0),t=0){this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const n=Ks.subVectors(i,t).cross(Ys.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(n,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(Ks),n=this.normal.dot(i);if(0===n)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/n;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||qs.getNormalMatrix(e),n=this.coplanarPoint(Ks).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-n.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}Plane.prototype.isPlane=!0;const Zs=new Sphere,$s=new Vector3;class Frustum{constructor(e=new Plane,t=new Plane,i=new Plane,n=new Plane,s=new Plane,r=new Plane){this.planes=[e,t,i,n,s,r]}set(e,t,i,n,s,r){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(n),o[4].copy(s),o[5].copy(r),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,n=i[0],s=i[1],r=i[2],o=i[3],a=i[4],l=i[5],c=i[6],d=i[7],h=i[8],u=i[9],p=i[10],m=i[11],f=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(o-n,d-a,m-h,y-f).normalize(),t[1].setComponents(o+n,d+a,m+h,y+f).normalize(),t[2].setComponents(o+s,d+l,m+u,y+g).normalize(),t[3].setComponents(o-s,d-l,m-u,y-g).normalize(),t[4].setComponents(o-r,d-c,m-p,y-v).normalize(),t[5].setComponents(o+r,d+c,m+p,y+v).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Zs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Zs)}intersectsSprite(e){return Zs.center.set(0,0,0),Zs.radius=.7071067811865476,Zs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zs)}intersectsSphere(e){const t=this.planes,i=e.center,n=-e.radius;for(let e=0;e<6;e++){if(t[e].distanceToPoint(i)<n)return!1}return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const n=t[i];if($s.x=n.normal.x>0?e.max.x:e.min.x,$s.y=n.normal.y>0?e.max.y:e.min.y,$s.z=n.normal.z>0?e.max.z:e.min.z,n.distanceToPoint($s)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function Qs(){let e=null,t=!1,i=null,n=null;function s(t,r){i(t,r),n=e.requestAnimationFrame(s)}return{start:function(){!0!==t&&null!==i&&(n=e.requestAnimationFrame(s),t=!0)},stop:function(){e.cancelAnimationFrame(n),t=!1},setAnimationLoop:function(e){i=e},setContext:function(t){e=t}}}function Xs(e,t){const i=t.isWebGL2,n=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),n.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);const i=n.get(t);i&&(e.deleteBuffer(i.buffer),n.delete(t))},update:function(t,s){if(t.isGLBufferAttribute){const e=n.get(t);return void((!e||e.version<t.version)&&n.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version}))}t.isInterleavedBufferAttribute&&(t=t.data);const r=n.get(t);void 0===r?n.set(t,function(t,n){const s=t.array,r=t.usage,o=e.createBuffer();e.bindBuffer(n,o),e.bufferData(n,s,r),t.onUploadCallback();let a=5126;return s instanceof Float32Array?a=5126:s instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):s instanceof Uint16Array?t.isFloat16BufferAttribute?i?a=5131:console.warn("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2."):a=5123:s instanceof Int16Array?a=5122:s instanceof Uint32Array?a=5125:s instanceof Int32Array?a=5124:s instanceof Int8Array?a=5120:(s instanceof Uint8Array||s instanceof Uint8ClampedArray)&&(a=5121),{buffer:o,type:a,bytesPerElement:s.BYTES_PER_ELEMENT,version:t.version}}(t,s)):r.version<t.version&&(!function(t,n,s){const r=n.array,o=n.updateRange;e.bindBuffer(s,t),-1===o.count?e.bufferSubData(s,0,r):(i?e.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r,o.offset,o.count):e.bufferSubData(s,o.offset*r.BYTES_PER_ELEMENT,r.subarray(o.offset,o.offset+o.count)),o.count=-1)}(r.buffer,t,s),r.version=t.version)}}}class PlaneGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,n=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:n};const s=e/2,r=t/2,o=Math.floor(i),a=Math.floor(n),l=o+1,c=a+1,d=e/o,h=t/a,u=[],p=[],m=[],f=[];for(let e=0;e<c;e++){const t=e*h-r;for(let i=0;i<l;i++){const n=i*d-s;p.push(n,-t,0),m.push(0,0,1),f.push(i/o),f.push(1-e/a)}}for(let e=0;e<a;e++)for(let t=0;t<o;t++){const i=t+l*e,n=t+l*(e+1),s=t+1+l*(e+1),r=t+1+l*e;u.push(i,n,r),u.push(n,s,r)}this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}static fromJSON(e){return new PlaneGeometry(e.width,e.height,e.widthSegments,e.heightSegments)}}const Js={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_maxMipLevel 8.0\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_maxTileSize 256.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tfloat texelSize = 1.0 / ( 3.0 * cubeUV_maxTileSize );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 1.0 );\n\t\tvec2 f = fract( uv );\n\t\tuv += 0.5 - f;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tif ( mipInt < cubeUV_maxMipLevel ) {\n\t\t\tuv.y += 2.0 * cubeUV_maxTileSize;\n\t\t}\n\t\tuv.y += filterInt * 2.0 * cubeUV_minTileSize;\n\t\tuv.x += 3.0 * max( 0.0, cubeUV_maxTileSize - 2.0 * faceSize );\n\t\tuv *= texelSize;\n\t\tvec3 tl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x += texelSize;\n\t\tvec3 tr = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.y += texelSize;\n\t\tvec3 br = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tuv.x -= texelSize;\n\t\tvec3 bl = envMapTexelToLinear( texture2D( envMap, uv ) ).rgb;\n\t\tvec3 tm = mix( tl, tr, f.x );\n\t\tvec3 bm = mix( bl, br, f.x );\n\t\treturn mix( tm, bm, f.y );\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, cubeUV_maxMipLevel );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"\nvec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );\n}\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\n\treturn vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );\n}\nvec4 sRGBToLinear( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}\nvec4 RGBEToLinear( in vec4 value ) {\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\n}\nvec4 LinearToRGBE( in vec4 value ) {\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\n}\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * value.a * maxRange, 1.0 );\n}\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat M = clamp( maxRGB / maxRange, 0.0, 1.0 );\n\tM = ceil( M * 255.0 ) / 255.0;\n\treturn vec4( value.rgb / ( M * maxRange ), M );\n}\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\n}\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\n\tfloat maxRGB = max( value.r, max( value.g, value.b ) );\n\tfloat D = max( maxRange / maxRGB, 1.0 );\n\tD = clamp( floor( D ) / 255.0, 0.0, 1.0 );\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\n}\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\nvec4 LinearToLogLuv( in vec4 value ) {\n\tvec3 Xp_Y_XYZp = cLogLuvM * value.rgb;\n\tXp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );\n\tvec4 vResult;\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\n\tvResult.w = fract( Le );\n\tvResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;\n\treturn vResult;\n}\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\nvec4 LogLuvToLinear( in vec4 value ) {\n\tfloat Le = value.z * 255.0 + value.w;\n\tvec3 Xp_Y_XYZp;\n\tXp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\n\tvec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;\n\treturn vec4( max( vRGB, 0.0 ), 1.0 );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t\tenvColor = envMapTexelToLinear( envColor );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\tuniform int maxMipLevel;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\t#ifdef ENVMAP_MODE_REFRACTION\n\t\tuniform float refractionRatio;\n\t#endif\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec;\n\t\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\t\treflectVec = reflect( - viewDir, normal );\n\t\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\t#else\n\t\t\t\treflectVec = refract( - viewDir, normal, refractionRatio );\n\t\t\t#endif\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn texture2D( gradientMap, coord ).rgb;\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\tlightMapIrradiance *= PI;\n\t#endif\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= specularColorMapTexelToLinear( texture2D( specularColorMap, vUv ) ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= sheenColorMapTexelToLinear( texture2D( sheenColorMap, vUv ) ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\tvec3 FssEss = specularColor * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\treflectedLight.directSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\n\t\t\tlightMapIrradiance *= PI;\n\t\t#endif\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 texelColor = texture2D( map, vUv );\n\ttexelColor = mapTexelToLinear( texelColor );\n\tdiffuseColor *= texelColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tvec4 mapTexel = texture2D( map, uv );\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1, 2 ) * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform vec2 morphTargetsTextureSize;\n\t\tvec3 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset, const in int stride ) {\n\t\t\tfloat texelIndex = float( vertexIndex * stride + offset );\n\t\t\tfloat y = floor( texelIndex / morphTargetsTextureSize.x );\n\t\t\tfloat x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tvec3 morphUV = vec3( ( x + 0.5 ) / morphTargetsTextureSize.x, y / morphTargetsTextureSize.y, morphTargetIndex );\n\t\t\treturn texture( morphTargetsTexture, morphUV ).xyz;\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\t#ifndef USE_MORPHNORMALS\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 1 ) * morphTargetInfluences[ i ];\n\t\t\t#else\n\t\t\t\tif ( morphTargetInfluences[ i ] > 0.0 ) transformed += getMorph( gl_VertexID, i, 0, 2 ) * morphTargetInfluences[ i ];\n\t\t\t#endif\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\t#ifdef BONE_TEXTURE\n\t\tuniform highp sampler2D boneTexture;\n\t\tuniform int boneTextureSize;\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tfloat j = i * 4.0;\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\t\ty = dy * ( y + 0.5 );\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\t\treturn bone;\n\t\t}\n\t#else\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\n\t\tmat4 getBoneMatrix( const in float i ) {\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\n\t\t\treturn bone;\n\t\t}\n\t#endif\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( vec3 n, vec3 v, float thickness, float ior, mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( float roughness, float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( vec2 fragCoord, float roughness, float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef TEXTURE_LOD_EXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( vec3 radiance, float transmissionDistance, vec3 attenuationColor, float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( vec3 n, vec3 v, float roughness, vec3 diffuseColor, vec3 specularColor, float specularF90,\n\t\tvec3 position, mat4 modelMatrix, mat4 viewMatrix, mat4 projMatrix, float ior, float thickness,\n\t\tvec3 attenuationColor, float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tvec4 texColor = texture2D( tEquirect, sampleUV );\n\tgl_FragColor = mapTexelToLinear( texColor );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel= texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t\tmatcapColor = matcapTexelToLinear( matcapColor );\n\t#else\n\t\tvec4 matcapColor = vec4( 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - clearcoat * Fcc ) + clearcoatSpecular * clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},er={common:{diffuse:{value:new Color(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},uv2Transform:{value:new Matrix3},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Color(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Matrix3}},sprite:{diffuse:{value:new Color(16777215)},opacity:{value:1},center:{value:new Vector2(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new Matrix3}}},tr={basic:{uniforms:Gs([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.fog]),vertexShader:Js.meshbasic_vert,fragmentShader:Js.meshbasic_frag},lambert:{uniforms:Gs([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.fog,er.lights,{emissive:{value:new Color(0)}}]),vertexShader:Js.meshlambert_vert,fragmentShader:Js.meshlambert_frag},phong:{uniforms:Gs([er.common,er.specularmap,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.fog,er.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:Js.meshphong_vert,fragmentShader:Js.meshphong_frag},standard:{uniforms:Gs([er.common,er.envmap,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.roughnessmap,er.metalnessmap,er.fog,er.lights,{emissive:{value:new Color(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Js.meshphysical_vert,fragmentShader:Js.meshphysical_frag},toon:{uniforms:Gs([er.common,er.aomap,er.lightmap,er.emissivemap,er.bumpmap,er.normalmap,er.displacementmap,er.gradientmap,er.fog,er.lights,{emissive:{value:new Color(0)}}]),vertexShader:Js.meshtoon_vert,fragmentShader:Js.meshtoon_frag},matcap:{uniforms:Gs([er.common,er.bumpmap,er.normalmap,er.displacementmap,er.fog,{matcap:{value:null}}]),vertexShader:Js.meshmatcap_vert,fragmentShader:Js.meshmatcap_frag},points:{uniforms:Gs([er.points,er.fog]),vertexShader:Js.points_vert,fragmentShader:Js.points_frag},dashed:{uniforms:Gs([er.common,er.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Js.linedashed_vert,fragmentShader:Js.linedashed_frag},depth:{uniforms:Gs([er.common,er.displacementmap]),vertexShader:Js.depth_vert,fragmentShader:Js.depth_frag},normal:{uniforms:Gs([er.common,er.bumpmap,er.normalmap,er.displacementmap,{opacity:{value:1}}]),vertexShader:Js.meshnormal_vert,fragmentShader:Js.meshnormal_frag},sprite:{uniforms:Gs([er.sprite,er.fog]),vertexShader:Js.sprite_vert,fragmentShader:Js.sprite_frag},background:{uniforms:{uvTransform:{value:new Matrix3},t2D:{value:null}},vertexShader:Js.background_vert,fragmentShader:Js.background_frag},cube:{uniforms:Gs([er.envmap,{opacity:{value:1}}]),vertexShader:Js.cube_vert,fragmentShader:Js.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Js.equirect_vert,fragmentShader:Js.equirect_frag},distanceRGBA:{uniforms:Gs([er.common,er.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Js.distanceRGBA_vert,fragmentShader:Js.distanceRGBA_frag},shadow:{uniforms:Gs([er.lights,er.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:Js.shadow_vert,fragmentShader:Js.shadow_frag}};function ir(e,t,i,n,s){const r=new Color(0);let o,a,l=0,c=null,d=0,h=null;function u(e,t){i.buffers.color.setClear(e.r,e.g,e.b,t,s)}return{getClearColor:function(){return r},setClearColor:function(e,t=1){r.set(e),l=t,u(r,l)},getClearAlpha:function(){return l},setClearAlpha:function(e){l=e,u(r,l)},render:function(i,s){let p=!1,g=!0===s.isScene?s.background:null;g&&g.isTexture&&(g=t.get(g));const v=e.xr,y=v.getSession&&v.getSession();y&&"additive"===y.environmentBlendMode&&(g=null),null===g?u(r,l):g&&g.isColor&&(u(g,1),p=!0),(e.autoClear||p)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),g&&(g.isCubeTexture||g.mapping===ce)?(void 0===a&&(a=new Mesh(new BoxGeometry(1,1,1),new ShaderMaterial({name:"BackgroundCubeMaterial",uniforms:js(tr.cube.uniforms),vertexShader:tr.cube.vertexShader,fragmentShader:tr.cube.fragmentShader,side:f,depthTest:!1,depthWrite:!1,fog:!1})),a.geometry.deleteAttribute("normal"),a.geometry.deleteAttribute("uv"),a.onBeforeRender=function(e,t,i){this.matrixWorld.copyPosition(i.matrixWorld)},Object.defineProperty(a.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),n.update(a)),a.material.uniforms.envMap.value=g,a.material.uniforms.flipEnvMap.value=g.isCubeTexture&&!1===g.isRenderTargetTexture?-1:1,c===g&&d===g.version&&h===e.toneMapping||(a.material.needsUpdate=!0,c=g,d=g.version,h=e.toneMapping),i.unshift(a,a.geometry,a.material,0,0,null)):g&&g.isTexture&&(void 0===o&&(o=new Mesh(new PlaneGeometry(2,2),new ShaderMaterial({name:"BackgroundMaterial",uniforms:js(tr.background.uniforms),vertexShader:tr.background.vertexShader,fragmentShader:tr.background.fragmentShader,side:m,depthTest:!1,depthWrite:!1,fog:!1})),o.geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),n.update(o)),o.material.uniforms.t2D.value=g,!0===g.matrixAutoUpdate&&g.updateMatrix(),o.material.uniforms.uvTransform.value.copy(g.matrix),c===g&&d===g.version&&h===e.toneMapping||(o.material.needsUpdate=!0,c=g,d=g.version,h=e.toneMapping),i.unshift(o,o.geometry,o.material,0,0,null))}}}function nr(e,t,i,n){const s=e.getParameter(34921),r=n.isWebGL2?null:t.get("OES_vertex_array_object"),o=n.isWebGL2||null!==r,a={},l=u(null);let c=l;function d(t){return n.isWebGL2?e.bindVertexArray(t):r.bindVertexArrayOES(t)}function h(t){return n.isWebGL2?e.deleteVertexArray(t):r.deleteVertexArrayOES(t)}function u(e){const t=[],i=[],n=[];for(let e=0;e<s;e++)t[e]=0,i[e]=0,n[e]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:i,attributeDivisors:n,object:e,attributes:{},index:null}}function p(){const e=c.newAttributes;for(let t=0,i=e.length;t<i;t++)e[t]=0}function m(e){f(e,0)}function f(i,s){const r=c.newAttributes,o=c.enabledAttributes,a=c.attributeDivisors;if(r[i]=1,0===o[i]&&(e.enableVertexAttribArray(i),o[i]=1),a[i]!==s){(n.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[n.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](i,s),a[i]=s}}function g(){const t=c.newAttributes,i=c.enabledAttributes;for(let n=0,s=i.length;n<s;n++)i[n]!==t[n]&&(e.disableVertexAttribArray(n),i[n]=0)}function v(t,i,s,r,o,a){!0!==n.isWebGL2||5124!==s&&5125!==s?e.vertexAttribPointer(t,i,s,r,o,a):e.vertexAttribIPointer(t,i,s,o,a)}function y(){b(),c!==l&&(c=l,d(c.object))}function b(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function(s,l,h,y,b){let S=!1;if(o){const t=function(t,i,s){const o=!0===s.wireframe;let l=a[t.id];void 0===l&&(l={},a[t.id]=l);let c=l[i.id];void 0===c&&(c={},l[i.id]=c);let d=c[o];void 0===d&&(d=u(n.isWebGL2?e.createVertexArray():r.createVertexArrayOES()),c[o]=d);return d}(y,h,l);c!==t&&(c=t,d(c.object)),S=function(e,t){const i=c.attributes,n=e.attributes;let s=0;for(const e in n){const t=i[e],r=n[e];if(void 0===t)return!0;if(t.attribute!==r)return!0;if(t.data!==r.data)return!0;s++}return c.attributesNum!==s||c.index!==t}(y,b),S&&function(e,t){const i={},n=e.attributes;let s=0;for(const e in n){const t=n[e],r={};r.attribute=t,t.data&&(r.data=t.data),i[e]=r,s++}c.attributes=i,c.attributesNum=s,c.index=t}(y,b)}else{const e=!0===l.wireframe;c.geometry===y.id&&c.program===h.id&&c.wireframe===e||(c.geometry=y.id,c.program=h.id,c.wireframe=e,S=!0)}!0===s.isInstancedMesh&&(S=!0),null!==b&&i.update(b,34963),S&&(!function(s,r,o,a){if(!1===n.isWebGL2&&(s.isInstancedMesh||a.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();const l=a.attributes,c=o.getAttributes(),d=r.defaultAttributeValues;for(const t in c){const n=c[t];if(n.location>=0){let r=l[t];if(void 0===r&&("instanceMatrix"===t&&s.instanceMatrix&&(r=s.instanceMatrix),"instanceColor"===t&&s.instanceColor&&(r=s.instanceColor)),void 0!==r){const t=r.normalized,o=r.itemSize,l=i.get(r);if(void 0===l)continue;const c=l.buffer,d=l.type,h=l.bytesPerElement;if(r.isInterleavedBufferAttribute){const i=r.data,l=i.stride,u=r.offset;if(i&&i.isInstancedInterleavedBuffer){for(let e=0;e<n.locationSize;e++)f(n.location+e,i.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=i.meshPerAttribute*i.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)v(n.location+e,o/n.locationSize,d,t,l*h,(u+o/n.locationSize*e)*h)}else{if(r.isInstancedBufferAttribute){for(let e=0;e<n.locationSize;e++)f(n.location+e,r.meshPerAttribute);!0!==s.isInstancedMesh&&void 0===a._maxInstanceCount&&(a._maxInstanceCount=r.meshPerAttribute*r.count)}else for(let e=0;e<n.locationSize;e++)m(n.location+e);e.bindBuffer(34962,c);for(let e=0;e<n.locationSize;e++)v(n.location+e,o/n.locationSize,d,t,o*h,o/n.locationSize*e*h)}}else if(void 0!==d){const i=d[t];if(void 0!==i)switch(i.length){case 2:e.vertexAttrib2fv(n.location,i);break;case 3:e.vertexAttrib3fv(n.location,i);break;case 4:e.vertexAttrib4fv(n.location,i);break;default:e.vertexAttrib1fv(n.location,i)}}}}g()}(s,l,h,y),null!==b&&e.bindBuffer(34963,i.get(b).buffer))},reset:y,resetDefaultState:b,dispose:function(){y();for(const e in a){const t=a[e];for(const e in t){const i=t[e];for(const e in i)h(i[e].object),delete i[e];delete t[e]}delete a[e]}},releaseStatesOfGeometry:function(e){if(void 0===a[e.id])return;const t=a[e.id];for(const e in t){const i=t[e];for(const e in i)h(i[e].object),delete i[e];delete t[e]}delete a[e.id]},releaseStatesOfProgram:function(e){for(const t in a){const i=a[t];if(void 0===i[e.id])continue;const n=i[e.id];for(const e in n)h(n[e].object),delete n[e];delete i[e.id]}},initAttributes:p,enableAttribute:m,disableUnusedAttributes:g}}function sr(e,t,i,n){const s=n.isWebGL2;let r;this.setMode=function(e){r=e},this.render=function(t,n){e.drawArrays(r,t,n),i.update(n,r,1)},this.renderInstances=function(n,o,a){if(0===a)return;let l,c;if(s)l=e,c="drawArraysInstanced";else if(l=t.get("ANGLE_instanced_arrays"),c="drawArraysInstancedANGLE",null===l)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[c](r,n,o,a),i.update(o,r,a)}}function rr(e,t,i){let n;function s(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const r="undefined"!=typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!=typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext;let o=void 0!==i.precision?i.precision:"highp";const a=s(o);a!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",a,"instead."),o=a);const l=r||t.has("WEBGL_draw_buffers"),c=!0===i.logarithmicDepthBuffer,d=e.getParameter(34930),h=e.getParameter(35660),u=e.getParameter(3379),p=e.getParameter(34076),m=e.getParameter(34921),f=e.getParameter(36347),g=e.getParameter(36348),v=e.getParameter(36349),y=h>0,b=r||t.has("OES_texture_float");return{isWebGL2:r,drawBuffers:l,getMaxAnisotropy:function(){if(void 0!==n)return n;if(!0===t.has("EXT_texture_filter_anisotropic")){const i=t.get("EXT_texture_filter_anisotropic");n=e.getParameter(i.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else n=0;return n},getMaxPrecision:s,precision:o,logarithmicDepthBuffer:c,maxTextures:d,maxVertexTextures:h,maxTextureSize:u,maxCubemapSize:p,maxAttributes:m,maxVertexUniforms:f,maxVaryings:g,maxFragmentUniforms:v,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:r?e.getParameter(36183):0}}function or(e){const t=this;let i=null,n=0,s=!1,r=!1;const o=new Plane,a=new Matrix3,l={value:null,needsUpdate:!1};function c(){l.value!==i&&(l.value=i,l.needsUpdate=n>0),t.numPlanes=n,t.numIntersection=0}function d(e,i,n,s){const r=null!==e?e.length:0;let c=null;if(0!==r){if(c=l.value,!0!==s||null===c){const t=n+4*r,s=i.matrixWorldInverse;a.getNormalMatrix(s),(null===c||c.length<t)&&(c=new Float32Array(t));for(let t=0,i=n;t!==r;++t,i+=4)o.copy(e[t]).applyMatrix4(s,a),o.normal.toArray(c,i),c[i+3]=o.constant}l.value=c,l.needsUpdate=!0}return t.numPlanes=r,t.numIntersection=0,c}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,r){const o=0!==e.length||t||0!==n||s;return s=t,i=d(e,r,0),n=e.length,o},this.beginShadows=function(){r=!0,d(null)},this.endShadows=function(){r=!1,c()},this.setState=function(t,o,a){const h=t.clippingPlanes,u=t.clipIntersection,p=t.clipShadows,m=e.get(t);if(!s||null===h||0===h.length||r&&!p)r?d(null):c();else{const e=r?0:n,t=4*e;let s=m.clippingState||null;l.value=s,s=d(h,o,t,a);for(let e=0;e!==t;++e)s[e]=i[e];m.clippingState=s,this.numIntersection=u?this.numPlanes:0,this.numPlanes+=e}}}function ar(e){let t=new WeakMap;function i(e,t){return t===ae?e.mapping=re:t===le&&(e.mapping=oe),e}function n(e){const i=e.target;i.removeEventListener("dispose",n);const s=t.get(i);void 0!==s&&(t.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const r=s.mapping;if(r===ae||r===le){if(t.has(s)){return i(t.get(s).texture,s.mapping)}{const r=s.image;if(r&&r.height>0){const o=e.getRenderTarget(),a=new WebGLCubeRenderTarget(r.height/2);return a.fromEquirectangularTexture(e,s),t.set(s,a),e.setRenderTarget(o),s.addEventListener("dispose",n),i(a.texture,s.mapping)}return null}}}return s},dispose:function(){t=new WeakMap}}}tr.physical={uniforms:Gs([tr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new Vector2(1,1)},clearcoatNormalMap:{value:null},sheen:{value:0},sheenColor:{value:new Color(0)},sheenColorMap:{value:null},sheenRoughness:{value:0},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new Vector2},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Color(0)},specularIntensity:{value:0},specularIntensityMap:{value:null},specularColor:{value:new Color(1,1,1)},specularColorMap:{value:null}}]),vertexShader:Js.meshphysical_vert,fragmentShader:Js.meshphysical_frag};class OrthographicCamera extends Camera{constructor(e=-1,t=1,i=1,n=-1,s=.1,r=2e3){super(),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=s,this.far=r,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,n,s,r){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=n,this.view.width=s,this.view.height=r,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,n=(this.top+this.bottom)/2;let s=i-e,r=i+e,o=n+t,a=n-t;if(null!==this.view&&this.view.enabled){const e=(this.right-this.left)/this.view.fullWidth/this.zoom,t=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=e*this.view.offsetX,r=s+e*this.view.width,o-=t*this.view.offsetY,a=o-t*this.view.height}this.projectionMatrix.makeOrthographic(s,r,o,a,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}OrthographicCamera.prototype.isOrthographicCamera=!0;class RawShaderMaterial extends ShaderMaterial{constructor(e){super(e),this.type="RawShaderMaterial"}}RawShaderMaterial.prototype.isRawShaderMaterial=!0;const lr=Math.pow(2,8),cr=[.125,.215,.35,.446,.526,.582],dr=5+cr.length,hr=20,ur={[$t]:0,[Qt]:1,[Jt]:2,[ti]:3,[ii]:4,[ni]:5,[Xt]:6},pr=new OrthographicCamera,{_lodPlanes:mr,_sizeLods:fr,_sigmas:gr}=wr(),vr=new Color;let yr=null;const br=(1+Math.sqrt(5))/2,Sr=1/br,Er=[new Vector3(1,1,1),new Vector3(-1,1,1),new Vector3(1,1,-1),new Vector3(-1,1,-1),new Vector3(0,br,Sr),new Vector3(0,br,-Sr),new Vector3(Sr,0,br),new Vector3(-Sr,0,br),new Vector3(br,Sr,0),new Vector3(-br,Sr,0)];class PMREMGenerator{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._blurMaterial=function(e){const t=new Float32Array(e),i=new Vector3(0,1,0);return new RawShaderMaterial({name:"SphericalGaussianBlur",defines:{n:e},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:t},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i},inputEncoding:{value:ur[$t]},outputEncoding:{value:ur[$t]}},vertexShader:Ar(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t${Cr()}\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}(hr),this._equirectShader=null,this._cubemapShader=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,n=100){yr=this._renderer.getRenderTarget();const s=this._allocateTargets();return this._sceneToCubeUV(e,i,n,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e){return this._fromTexture(e)}fromCubemap(e){return this._fromTexture(e)}compileCubemapShader(){null===this._cubemapShader&&(this._cubemapShader=Or(),this._compileMaterial(this._cubemapShader))}compileEquirectangularShader(){null===this._equirectShader&&(this._equirectShader=Mr(),this._compileMaterial(this._equirectShader))}dispose(){this._blurMaterial.dispose(),null!==this._cubemapShader&&this._cubemapShader.dispose(),null!==this._equirectShader&&this._equirectShader.dispose();for(let e=0;e<mr.length;e++)mr[e].dispose()}_cleanup(e){this._pingPongRenderTarget.dispose(),this._renderer.setRenderTarget(yr),e.scissorTest=!1,_r(e,0,0,e.width,e.height)}_fromTexture(e){yr=this._renderer.getRenderTarget();const t=this._allocateTargets(e);return this._textureToCubeUV(e,t),this._applyPMREM(t),this._cleanup(t),t}_allocateTargets(e){const t={magFilter:me,minFilter:me,generateMipmaps:!1,type:xe,format:He,encoding:Tr(e)?e.encoding:Jt,depthBuffer:!1},i=xr(t);return i.depthBuffer=!e,this._pingPongRenderTarget=xr(t),i}_compileMaterial(e){const t=new Mesh(mr[0],e);this._renderer.compile(t,pr)}_sceneToCubeUV(e,t,i,n){const s=new PerspectiveCamera(90,1,t,i),r=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],a=this._renderer,l=a.autoClear,c=a.outputEncoding,d=a.toneMapping;a.getClearColor(vr),a.toneMapping=X,a.outputEncoding=$t,a.autoClear=!1;const h=new MeshBasicMaterial({name:"PMREM.Background",side:f,depthWrite:!1,depthTest:!1}),u=new Mesh(new BoxGeometry,h);let p=!1;const m=e.background;m?m.isColor&&(h.color.copy(m),e.background=null,p=!0):(h.color.copy(vr),p=!0);for(let t=0;t<6;t++){const i=t%3;0==i?(s.up.set(0,r[t],0),s.lookAt(o[t],0,0)):1==i?(s.up.set(0,0,r[t]),s.lookAt(0,o[t],0)):(s.up.set(0,r[t],0),s.lookAt(0,0,o[t])),_r(n,i*lr,t>2?lr:0,lr,lr),a.setRenderTarget(n),p&&a.render(u,s),a.render(e,s)}u.geometry.dispose(),u.material.dispose(),a.toneMapping=d,a.outputEncoding=c,a.autoClear=l,e.background=m}_setEncoding(e,t){!0===this._renderer.capabilities.isWebGL2&&t.format===Be&&t.type===xe&&t.encoding===Qt?e.value=ur[$t]:e.value=ur[t.encoding]}_textureToCubeUV(e,t){const i=this._renderer,n=e.mapping===re||e.mapping===oe;n?null==this._cubemapShader&&(this._cubemapShader=Or()):null==this._equirectShader&&(this._equirectShader=Mr());const s=n?this._cubemapShader:this._equirectShader,r=new Mesh(mr[0],s),o=s.uniforms;o.envMap.value=e,n||o.texelSize.value.set(1/e.image.width,1/e.image.height),this._setEncoding(o.inputEncoding,e),this._setEncoding(o.outputEncoding,t.texture),_r(t,0,0,3*lr,2*lr),i.setRenderTarget(t),i.render(r,pr)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let t=1;t<dr;t++){const i=Math.sqrt(gr[t]*gr[t]-gr[t-1]*gr[t-1]),n=Er[(t-1)%Er.length];this._blur(e,t-1,t,i,n)}t.autoClear=i}_blur(e,t,i,n,s){const r=this._pingPongRenderTarget;this._halfBlur(e,r,t,i,n,"latitudinal",s),this._halfBlur(r,e,i,i,n,"longitudinal",s)}_halfBlur(e,t,i,n,s,r,o){const a=this._renderer,l=this._blurMaterial;"latitudinal"!==r&&"longitudinal"!==r&&console.error("blur direction must be either latitudinal or longitudinal!");const c=new Mesh(mr[n],l),d=l.uniforms,h=fr[i]-1,u=isFinite(s)?Math.PI/(2*h):2*Math.PI/39,p=s/u,m=isFinite(s)?1+Math.floor(3*p):hr;m>hr&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const f=[];let g=0;for(let e=0;e<hr;++e){const t=e/p,i=Math.exp(-t*t/2);f.push(i),0==e?g+=i:e<m&&(g+=2*i)}for(let e=0;e<f.length;e++)f[e]=f[e]/g;d.envMap.value=e.texture,d.samples.value=m,d.weights.value=f,d.latitudinal.value="latitudinal"===r,o&&(d.poleAxis.value=o),d.dTheta.value=u,d.mipInt.value=8-i,this._setEncoding(d.inputEncoding,e.texture),this._setEncoding(d.outputEncoding,e.texture);const v=fr[n];_r(t,3*Math.max(0,lr-2*v),(0===n?0:2*lr)+2*v*(n>4?n-8+4:0),3*v,2*v),a.setRenderTarget(t),a.render(c,pr)}}function Tr(e){return void 0!==e&&e.type===xe&&(e.encoding===$t||e.encoding===Qt||e.encoding===Xt)}function wr(){const e=[],t=[],i=[];let n=8;for(let s=0;s<dr;s++){const r=Math.pow(2,n);t.push(r);let o=1/r;s>4?o=cr[s-8+4-1]:0==s&&(o=0),i.push(o);const a=1/(r-1),l=-a/2,c=1+a/2,d=[l,l,c,l,c,c,l,l,c,c,l,c],h=6,u=6,p=3,m=2,f=1,g=new Float32Array(p*u*h),v=new Float32Array(m*u*h),y=new Float32Array(f*u*h);for(let e=0;e<h;e++){const t=e%3*2/3-1,i=e>2?0:-1,n=[t,i,0,t+2/3,i,0,t+2/3,i+1,0,t,i,0,t+2/3,i+1,0,t,i+1,0];g.set(n,p*u*e),v.set(d,m*u*e);const s=[e,e,e,e,e,e];y.set(s,f*u*e)}const b=new BufferGeometry;b.setAttribute("position",new BufferAttribute(g,p)),b.setAttribute("uv",new BufferAttribute(v,m)),b.setAttribute("faceIndex",new BufferAttribute(y,f)),e.push(b),n>4&&n--}return{_lodPlanes:e,_sizeLods:t,_sigmas:i}}function xr(e){const t=new WebGLRenderTarget(3*lr,3*lr,e);return t.texture.mapping=ce,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function _r(e,t,i,n,s){e.viewport.set(t,i,n,s),e.scissor.set(t,i,n,s)}function Mr(){const e=new Vector2(1,1);return new RawShaderMaterial({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null},texelSize:{value:e},inputEncoding:{value:ur[$t]},outputEncoding:{value:ur[$t]}},vertexShader:Ar(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform vec2 texelSize;\n\n\t\t\t${Cr()}\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tvec2 f = fract( uv / texelSize - 0.5 );\n\t\t\t\tuv -= f * texelSize;\n\t\t\t\tvec3 tl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x += texelSize.x;\n\t\t\t\tvec3 tr = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.y += texelSize.y;\n\t\t\t\tvec3 br = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\t\t\t\tuv.x -= texelSize.x;\n\t\t\t\tvec3 bl = envMapTexelToLinear( texture2D ( envMap, uv ) ).rgb;\n\n\t\t\t\tvec3 tm = mix( tl, tr, f.x );\n\t\t\t\tvec3 bm = mix( bl, br, f.x );\n\t\t\t\tgl_FragColor.rgb = mix( tm, bm, f.y );\n\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function Or(){return new RawShaderMaterial({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},inputEncoding:{value:ur[$t]},outputEncoding:{value:ur[$t]}},vertexShader:Ar(),fragmentShader:`\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\t${Cr()}\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb = envMapTexelToLinear( textureCube( envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ) ) ).rgb;\n\t\t\t\tgl_FragColor = linearToOutputTexel( gl_FragColor );\n\n\t\t\t}\n\t\t`,blending:b,depthTest:!1,depthWrite:!1})}function Ar(){return"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute vec3 position;\n\t\tattribute vec2 uv;\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t"}function Cr(){return"\n\n\t\tuniform int inputEncoding;\n\t\tuniform int outputEncoding;\n\n\t\t#include <encodings_pars_fragment>\n\n\t\tvec4 inputTexelToLinear( vec4 value ) {\n\n\t\t\tif ( inputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( inputEncoding == 1 ) {\n\n\t\t\t\treturn sRGBToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 2 ) {\n\n\t\t\t\treturn RGBEToLinear( value );\n\n\t\t\t} else if ( inputEncoding == 3 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 7.0 );\n\n\t\t\t} else if ( inputEncoding == 4 ) {\n\n\t\t\t\treturn RGBMToLinear( value, 16.0 );\n\n\t\t\t} else if ( inputEncoding == 5 ) {\n\n\t\t\t\treturn RGBDToLinear( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn GammaToLinear( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 linearToOutputTexel( vec4 value ) {\n\n\t\t\tif ( outputEncoding == 0 ) {\n\n\t\t\t\treturn value;\n\n\t\t\t} else if ( outputEncoding == 1 ) {\n\n\t\t\t\treturn LinearTosRGB( value );\n\n\t\t\t} else if ( outputEncoding == 2 ) {\n\n\t\t\t\treturn LinearToRGBE( value );\n\n\t\t\t} else if ( outputEncoding == 3 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 7.0 );\n\n\t\t\t} else if ( outputEncoding == 4 ) {\n\n\t\t\t\treturn LinearToRGBM( value, 16.0 );\n\n\t\t\t} else if ( outputEncoding == 5 ) {\n\n\t\t\t\treturn LinearToRGBD( value, 256.0 );\n\n\t\t\t} else {\n\n\t\t\t\treturn LinearToGamma( value, 2.2 );\n\n\t\t\t}\n\n\t\t}\n\n\t\tvec4 envMapTexelToLinear( vec4 color ) {\n\n\t\t\treturn inputTexelToLinear( color );\n\n\t\t}\n\t"}function Pr(e){let t=new WeakMap,i=null;function n(e){const i=e.target;i.removeEventListener("dispose",n);const s=t.get(i);void 0!==s&&(t.delete(i),s.dispose())}return{get:function(s){if(s&&s.isTexture&&!1===s.isRenderTargetTexture){const r=s.mapping,o=r===ae||r===le,a=r===re||r===oe;if(o||a){if(t.has(s))return t.get(s).texture;{const r=s.image;if(o&&r&&r.height>0||a&&r&&function(e){let t=0;const i=6;for(let n=0;n<i;n++)void 0!==e[n]&&t++;return t===i}(r)){const r=e.getRenderTarget();null===i&&(i=new PMREMGenerator(e));const a=o?i.fromEquirectangular(s):i.fromCubemap(s);return t.set(s,a),e.setRenderTarget(r),s.addEventListener("dispose",n),a.texture}return null}}}return s},dispose:function(){t=new WeakMap,null!==i&&(i.dispose(),i=null)}}}function Dr(e){const t={};function i(i){if(void 0!==t[i])return t[i];let n;switch(i){case"WEBGL_depth_texture":n=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":n=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":n=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":n=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:n=e.getExtension(i)}return t[i]=n,n}return{has:function(e){return null!==i(e)},init:function(e){e.isWebGL2?i("EXT_color_buffer_float"):(i("WEBGL_depth_texture"),i("OES_texture_float"),i("OES_texture_half_float"),i("OES_texture_half_float_linear"),i("OES_standard_derivatives"),i("OES_element_index_uint"),i("OES_vertex_array_object"),i("ANGLE_instanced_arrays")),i("OES_texture_float_linear"),i("EXT_color_buffer_half_float")},get:function(e){const t=i(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function Nr(e,t,i,n){const s={},r=new WeakMap;function o(e){const a=e.target;null!==a.index&&t.remove(a.index);for(const e in a.attributes)t.remove(a.attributes[e]);a.removeEventListener("dispose",o),delete s[a.id];const l=r.get(a);l&&(t.remove(l),r.delete(a)),n.releaseStatesOfGeometry(a),!0===a.isInstancedBufferGeometry&&delete a._maxInstanceCount,i.memory.geometries--}function a(e){const i=[],n=e.index,s=e.attributes.position;let o=0;if(null!==n){const e=n.array;o=n.version;for(let t=0,n=e.length;t<n;t+=3){const n=e[t+0],s=e[t+1],r=e[t+2];i.push(n,s,s,r,r,n)}}else{const e=s.array;o=s.version;for(let t=0,n=e.length/3-1;t<n;t+=3){const e=t+0,n=t+1,s=t+2;i.push(e,n,n,s,s,e)}}const a=new(qi(i)>65535?Uint32BufferAttribute:Uint16BufferAttribute)(i,1);a.version=o;const l=r.get(e);l&&t.remove(l),r.set(e,a)}return{get:function(e,t){return!0===s[t.id]||(t.addEventListener("dispose",o),s[t.id]=!0,i.memory.geometries++),t},update:function(e){const i=e.attributes;for(const e in i)t.update(i[e],34962);const n=e.morphAttributes;for(const e in n){const i=n[e];for(let e=0,n=i.length;e<n;e++)t.update(i[e],34962)}},getWireframeAttribute:function(e){const t=r.get(e);if(t){const i=e.index;null!==i&&t.version<i.version&&a(e)}else a(e);return r.get(e)}}}function Ir(e,t,i,n){const s=n.isWebGL2;let r,o,a;this.setMode=function(e){r=e},this.setIndex=function(e){o=e.type,a=e.bytesPerElement},this.render=function(t,n){e.drawElements(r,n,o,t*a),i.update(n,r,1)},this.renderInstances=function(n,l,c){if(0===c)return;let d,h;if(s)d=e,h="drawElementsInstanced";else if(d=t.get("ANGLE_instanced_arrays"),h="drawElementsInstancedANGLE",null===d)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");d[h](r,l,o,n*a,c),i.update(l,r,c)}}function Lr(e){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,i,n){switch(t.calls++,i){case 4:t.triangles+=n*(e/3);break;case 1:t.lines+=n*(e/2);break;case 3:t.lines+=n*(e-1);break;case 2:t.lines+=n*e;break;case 0:t.points+=n*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",i)}}}}class DataTexture2DArray extends Texture{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=me,this.minFilter=me,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}function Rr(e,t){return e[0]-t[0]}function kr(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ur(e,t){let i=1;const n=t.isInterleavedBufferAttribute?t.data.array:t.array;n instanceof Int8Array?i=127:n instanceof Int16Array?i=32767:n instanceof Int32Array?i=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",n),e.divideScalar(i)}function Br(e,t,i){const n={},s=new Float32Array(8),r=new WeakMap,o=new Vector3,a=[];for(let e=0;e<8;e++)a[e]=[e,0];return{update:function(l,c,d,h){const u=l.morphTargetInfluences;if(!0===t.isWebGL2){const n=c.morphAttributes.position.length;let s=r.get(c);if(void 0===s||s.count!==n){void 0!==s&&s.texture.dispose();const e=void 0!==c.morphAttributes.normal,i=c.morphAttributes.position,a=c.morphAttributes.normal||[],l=!0===e?2:1;let d=c.attributes.position.count*l,h=1;d>t.maxTextureSize&&(h=Math.ceil(d/t.maxTextureSize),d=t.maxTextureSize);const u=new Float32Array(d*h*4*n),p=new DataTexture2DArray(u,d,h,n);p.format=Be,p.type=Pe;const m=4*l;for(let t=0;t<n;t++){const n=i[t],s=a[t],r=d*h*4*t;for(let t=0;t<n.count;t++){o.fromBufferAttribute(n,t),!0===n.normalized&&Ur(o,n);const i=t*m;u[r+i+0]=o.x,u[r+i+1]=o.y,u[r+i+2]=o.z,u[r+i+3]=0,!0===e&&(o.fromBufferAttribute(s,t),!0===s.normalized&&Ur(o,s),u[r+i+4]=o.x,u[r+i+5]=o.y,u[r+i+6]=o.z,u[r+i+7]=0)}}s={count:n,texture:p,size:new Vector2(d,h)},r.set(c,s)}let a=0;for(let e=0;e<u.length;e++)a+=u[e];const l=c.morphTargetsRelative?1:1-a;h.getUniforms().setValue(e,"morphTargetBaseInfluence",l),h.getUniforms().setValue(e,"morphTargetInfluences",u),h.getUniforms().setValue(e,"morphTargetsTexture",s.texture,i),h.getUniforms().setValue(e,"morphTargetsTextureSize",s.size)}else{const t=void 0===u?0:u.length;let i=n[c.id];if(void 0===i||i.length!==t){i=[];for(let e=0;e<t;e++)i[e]=[e,0];n[c.id]=i}for(let e=0;e<t;e++){const t=i[e];t[0]=e,t[1]=u[e]}i.sort(kr);for(let e=0;e<8;e++)e<t&&i[e][1]?(a[e][0]=i[e][0],a[e][1]=i[e][1]):(a[e][0]=Number.MAX_SAFE_INTEGER,a[e][1]=0);a.sort(Rr);const r=c.morphAttributes.position,o=c.morphAttributes.normal;let l=0;for(let e=0;e<8;e++){const t=a[e],i=t[0],n=t[1];i!==Number.MAX_SAFE_INTEGER&&n?(r&&c.getAttribute("morphTarget"+e)!==r[i]&&c.setAttribute("morphTarget"+e,r[i]),o&&c.getAttribute("morphNormal"+e)!==o[i]&&c.setAttribute("morphNormal"+e,o[i]),s[e]=n,l+=n):(r&&!0===c.hasAttribute("morphTarget"+e)&&c.deleteAttribute("morphTarget"+e),o&&!0===c.hasAttribute("morphNormal"+e)&&c.deleteAttribute("morphNormal"+e),s[e]=0)}const d=c.morphTargetsRelative?1:1-l;h.getUniforms().setValue(e,"morphTargetBaseInfluence",d),h.getUniforms().setValue(e,"morphTargetInfluences",s)}}}}function Fr(e,t,i,n){let s=new WeakMap;function r(e){const t=e.target;t.removeEventListener("dispose",r),i.remove(t.instanceMatrix),null!==t.instanceColor&&i.remove(t.instanceColor)}return{update:function(e){const o=n.render.frame,a=e.geometry,l=t.get(e,a);return s.get(l)!==o&&(t.update(l),s.set(l,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",r)&&e.addEventListener("dispose",r),i.update(e.instanceMatrix,34962),null!==e.instanceColor&&i.update(e.instanceColor,34962)),l},dispose:function(){s=new WeakMap}}}DataTexture2DArray.prototype.isDataTexture2DArray=!0;class DataTexture3D extends Texture{constructor(e=null,t=1,i=1,n=1){super(null),this.image={data:e,width:t,height:i,depth:n},this.magFilter=me,this.minFilter=me,this.wrapR=ue,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture3D.prototype.isDataTexture3D=!0;const Vr=new Texture,Hr=new DataTexture2DArray,jr=new DataTexture3D,Gr=new CubeTexture,zr=[],Wr=[],Kr=new Float32Array(16),Yr=new Float32Array(9),qr=new Float32Array(4);function Zr(e,t,i){const n=e[0];if(n<=0||n>0)return e;const s=t*i;let r=zr[s];if(void 0===r&&(r=new Float32Array(s),zr[s]=r),0!==t){n.toArray(r,0);for(let n=1,s=0;n!==t;++n)s+=i,e[n].toArray(r,s)}return r}function $r(e,t){if(e.length!==t.length)return!1;for(let i=0,n=e.length;i<n;i++)if(e[i]!==t[i])return!1;return!0}function Qr(e,t){for(let i=0,n=t.length;i<n;i++)e[i]=t[i]}function Xr(e,t){let i=Wr[t];void 0===i&&(i=new Int32Array(t),Wr[t]=i);for(let n=0;n!==t;++n)i[n]=e.allocateTextureUnit();return i}function Jr(e,t){const i=this.cache;i[0]!==t&&(e.uniform1f(this.addr,t),i[0]=t)}function eo(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),i[0]=t.x,i[1]=t.y);else{if($r(i,t))return;e.uniform2fv(this.addr,t),Qr(i,t)}}function to(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),i[0]=t.x,i[1]=t.y,i[2]=t.z);else if(void 0!==t.r)i[0]===t.r&&i[1]===t.g&&i[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),i[0]=t.r,i[1]=t.g,i[2]=t.b);else{if($r(i,t))return;e.uniform3fv(this.addr,t),Qr(i,t)}}function io(e,t){const i=this.cache;if(void 0!==t.x)i[0]===t.x&&i[1]===t.y&&i[2]===t.z&&i[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=t.w);else{if($r(i,t))return;e.uniform4fv(this.addr,t),Qr(i,t)}}function no(e,t){const i=this.cache,n=t.elements;if(void 0===n){if($r(i,t))return;e.uniformMatrix2fv(this.addr,!1,t),Qr(i,t)}else{if($r(i,n))return;qr.set(n),e.uniformMatrix2fv(this.addr,!1,qr),Qr(i,n)}}function so(e,t){const i=this.cache,n=t.elements;if(void 0===n){if($r(i,t))return;e.uniformMatrix3fv(this.addr,!1,t),Qr(i,t)}else{if($r(i,n))return;Yr.set(n),e.uniformMatrix3fv(this.addr,!1,Yr),Qr(i,n)}}function ro(e,t){const i=this.cache,n=t.elements;if(void 0===n){if($r(i,t))return;e.uniformMatrix4fv(this.addr,!1,t),Qr(i,t)}else{if($r(i,n))return;Kr.set(n),e.uniformMatrix4fv(this.addr,!1,Kr),Qr(i,n)}}function oo(e,t){const i=this.cache;i[0]!==t&&(e.uniform1i(this.addr,t),i[0]=t)}function ao(e,t){const i=this.cache;$r(i,t)||(e.uniform2iv(this.addr,t),Qr(i,t))}function lo(e,t){const i=this.cache;$r(i,t)||(e.uniform3iv(this.addr,t),Qr(i,t))}function co(e,t){const i=this.cache;$r(i,t)||(e.uniform4iv(this.addr,t),Qr(i,t))}function ho(e,t){const i=this.cache;i[0]!==t&&(e.uniform1ui(this.addr,t),i[0]=t)}function uo(e,t){const i=this.cache;$r(i,t)||(e.uniform2uiv(this.addr,t),Qr(i,t))}function po(e,t){const i=this.cache;$r(i,t)||(e.uniform3uiv(this.addr,t),Qr(i,t))}function mo(e,t){const i=this.cache;$r(i,t)||(e.uniform4uiv(this.addr,t),Qr(i,t))}function fo(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.safeSetTexture2D(t||Vr,s)}function go(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.setTexture3D(t||jr,s)}function vo(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.safeSetTextureCube(t||Gr,s)}function yo(e,t,i){const n=this.cache,s=i.allocateTextureUnit();n[0]!==s&&(e.uniform1i(this.addr,s),n[0]=s),i.setTexture2DArray(t||Hr,s)}function bo(e,t){e.uniform1fv(this.addr,t)}function So(e,t){const i=Zr(t,this.size,2);e.uniform2fv(this.addr,i)}function Eo(e,t){const i=Zr(t,this.size,3);e.uniform3fv(this.addr,i)}function To(e,t){const i=Zr(t,this.size,4);e.uniform4fv(this.addr,i)}function wo(e,t){const i=Zr(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,i)}function xo(e,t){const i=Zr(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,i)}function _o(e,t){const i=Zr(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,i)}function Mo(e,t){e.uniform1iv(this.addr,t)}function Oo(e,t){e.uniform2iv(this.addr,t)}function Ao(e,t){e.uniform3iv(this.addr,t)}function Co(e,t){e.uniform4iv(this.addr,t)}function Po(e,t){e.uniform1uiv(this.addr,t)}function Do(e,t){e.uniform2uiv(this.addr,t)}function No(e,t){e.uniform3uiv(this.addr,t)}function Io(e,t){e.uniform4uiv(this.addr,t)}function Lo(e,t,i){const n=t.length,s=Xr(i,n);e.uniform1iv(this.addr,s);for(let e=0;e!==n;++e)i.safeSetTexture2D(t[e]||Vr,s[e])}function Ro(e,t,i){const n=t.length,s=Xr(i,n);e.uniform1iv(this.addr,s);for(let e=0;e!==n;++e)i.safeSetTextureCube(t[e]||Gr,s[e])}function ko(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function(e){switch(e){case 5126:return Jr;case 35664:return eo;case 35665:return to;case 35666:return io;case 35674:return no;case 35675:return so;case 35676:return ro;case 5124:case 35670:return oo;case 35667:case 35671:return ao;case 35668:case 35672:return lo;case 35669:case 35673:return co;case 5125:return ho;case 36294:return uo;case 36295:return po;case 36296:return mo;case 35678:case 36198:case 36298:case 36306:case 35682:return fo;case 35679:case 36299:case 36307:return go;case 35680:case 36300:case 36308:case 36293:return vo;case 36289:case 36303:case 36311:case 36292:return yo}}(t.type)}function Uo(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function(e){switch(e){case 5126:return bo;case 35664:return So;case 35665:return Eo;case 35666:return To;case 35674:return wo;case 35675:return xo;case 35676:return _o;case 5124:case 35670:return Mo;case 35667:case 35671:return Oo;case 35668:case 35672:return Ao;case 35669:case 35673:return Co;case 5125:return Po;case 36294:return Do;case 36295:return No;case 36296:return Io;case 35678:case 36198:case 36298:case 36306:case 35682:return Lo;case 35680:case 36300:case 36308:case 36293:return Ro}}(t.type)}function Bo(e){this.id=e,this.seq=[],this.map={}}Uo.prototype.updateCache=function(e){const t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Qr(t,e)},Bo.prototype.setValue=function(e,t,i){const n=this.seq;for(let s=0,r=n.length;s!==r;++s){const r=n[s];r.setValue(e,t[r.id],i)}};const Fo=/(\w+)(\])?(\[|\.)?/g;function Vo(e,t){e.seq.push(t),e.map[t.id]=t}function Ho(e,t,i){const n=e.name,s=n.length;for(Fo.lastIndex=0;;){const r=Fo.exec(n),o=Fo.lastIndex;let a=r[1];const l="]"===r[2],c=r[3];if(l&&(a|=0),void 0===c||"["===c&&o+2===s){Vo(i,void 0===c?new ko(a,e,t):new Uo(a,e,t));break}{let e=i.map[a];void 0===e&&(e=new Bo(a),Vo(i,e)),i=e}}}function jo(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let n=0;n<i;++n){const i=e.getActiveUniform(t,n);Ho(i,e.getUniformLocation(t,i.name),this)}}function Go(e,t,i){const n=e.createShader(t);return e.shaderSource(n,i),e.compileShader(n),n}jo.prototype.setValue=function(e,t,i,n){const s=this.map[t];void 0!==s&&s.setValue(e,i,n)},jo.prototype.setOptional=function(e,t,i){const n=t[i];void 0!==n&&this.setValue(e,i,n)},jo.upload=function(e,t,i,n){for(let s=0,r=t.length;s!==r;++s){const r=t[s],o=i[r.id];!1!==o.needsUpdate&&r.setValue(e,o.value,n)}},jo.seqWithValue=function(e,t){const i=[];for(let n=0,s=e.length;n!==s;++n){const s=e[n];s.id in t&&i.push(s)}return i};let zo=0;function Wo(e){switch(e){case $t:return["Linear","( value )"];case Qt:return["sRGB","( value )"];case Jt:return["RGBE","( value )"];case ti:return["RGBM","( value, 7.0 )"];case ii:return["RGBM","( value, 16.0 )"];case ni:return["RGBD","( value, 256.0 )"];case Xt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case ei:return["LogLuv","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}function Ko(e,t,i){const n=e.getShaderParameter(t,35713),s=e.getShaderInfoLog(t).trim();return n&&""===s?"":i.toUpperCase()+"\n\n"+s+"\n\n"+function(e){const t=e.split("\n");for(let e=0;e<t.length;e++)t[e]=e+1+": "+t[e];return t.join("\n")}(e.getShaderSource(t))}function Yo(e,t){const i=Wo(t);return"vec4 "+e+"( vec4 value ) { return "+i[0]+"ToLinear"+i[1]+"; }"}function qo(e,t){const i=Wo(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+i[0]+i[1]+"; }"}function Zo(e,t){let i;switch(t){case J:i="Linear";break;case ee:i="Reinhard";break;case te:i="OptimizedCineon";break;case ie:i="ACESFilmic";break;case ne:i="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),i="Linear"}return"vec3 "+e+"( vec3 color ) { return "+i+"ToneMapping( color ); }"}function $o(e){return""!==e}function Qo(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function Xo(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}const Jo=/^[ \t]*#include +<([\w\d./]+)>/gm;function ea(e){return e.replace(Jo,ta)}function ta(e,t){const i=Js[t];if(void 0===i)throw new Error("Can not resolve #include <"+t+">");return ea(i)}const ia=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,na=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function sa(e){return e.replace(na,oa).replace(ia,ra)}function ra(e,t,i,n){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),oa(e,t,i,n)}function oa(e,t,i,n){let s="";for(let e=parseInt(t);e<parseInt(i);e++)s+=n.replace(/\[\s*i\s*\]/g,"[ "+e+" ]").replace(/UNROLLED_LOOP_INDEX/g,e);return s}function aa(e){let t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function la(e,t,i,n){const s=e.getContext(),r=i.defines;let o=i.vertexShader,a=i.fragmentShader;const l=function(e){let t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===h?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===u?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===p&&(t="SHADOWMAP_TYPE_VSM"),t}(i),c=function(e){let t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case re:case oe:t="ENVMAP_TYPE_CUBE";break;case ce:case de:t="ENVMAP_TYPE_CUBE_UV"}return t}(i),d=function(e){let t="ENVMAP_MODE_REFLECTION";if(e.envMap)switch(e.envMapMode){case oe:case de:t="ENVMAP_MODE_REFRACTION"}return t}(i),m=function(e){let t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Z:t="ENVMAP_BLENDING_MULTIPLY";break;case $:t="ENVMAP_BLENDING_MIX";break;case Q:t="ENVMAP_BLENDING_ADD"}return t}(i),f=e.gammaFactor>0?e.gammaFactor:1,g=i.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUV||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter($o).join("\n")}(i),v=function(e){const t=[];for(const i in e){const n=e[i];!1!==n&&t.push("#define "+i+" "+n)}return t.join("\n")}(r),y=s.createProgram();let b,S,E=i.glslVersion?"#version "+i.glslVersion+"\n":"";i.isRawShaderMaterial?(b=[v].filter($o).join("\n"),b.length>0&&(b+="\n"),S=[g,v].filter($o).join("\n"),S.length>0&&(S+="\n")):(b=[aa(i),"#define SHADER_NAME "+i.shaderName,v,i.instancing?"#define USE_INSTANCING":"",i.instancingColor?"#define USE_INSTANCING_COLOR":"",i.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+f,"#define MAX_BONES "+i.maxBones,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+d:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.displacementMap&&i.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.flatShading?"#define FLAT_SHADED":"",i.skinning?"#define USE_SKINNING":"",i.useVertexTexture?"#define BONE_TEXTURE":"",i.morphTargets?"#define USE_MORPHTARGETS":"",i.morphNormals&&!1===i.flatShading?"#define USE_MORPHNORMALS":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",i.morphTargets&&i.isWebGL2?"#define MORPHTARGETS_COUNT "+i.morphTargetsCount:"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.sizeAttenuation?"#define USE_SIZEATTENUATION":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter($o).join("\n"),S=[g,aa(i),"#define SHADER_NAME "+i.shaderName,v,"#define GAMMA_FACTOR "+f,i.useFog&&i.fog?"#define USE_FOG":"",i.useFog&&i.fogExp2?"#define FOG_EXP2":"",i.map?"#define USE_MAP":"",i.matcap?"#define USE_MATCAP":"",i.envMap?"#define USE_ENVMAP":"",i.envMap?"#define "+c:"",i.envMap?"#define "+d:"",i.envMap?"#define "+m:"",i.lightMap?"#define USE_LIGHTMAP":"",i.aoMap?"#define USE_AOMAP":"",i.emissiveMap?"#define USE_EMISSIVEMAP":"",i.bumpMap?"#define USE_BUMPMAP":"",i.normalMap?"#define USE_NORMALMAP":"",i.normalMap&&i.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",i.normalMap&&i.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",i.clearcoat?"#define USE_CLEARCOAT":"",i.clearcoatMap?"#define USE_CLEARCOATMAP":"",i.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",i.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",i.specularMap?"#define USE_SPECULARMAP":"",i.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",i.specularColorMap?"#define USE_SPECULARCOLORMAP":"",i.roughnessMap?"#define USE_ROUGHNESSMAP":"",i.metalnessMap?"#define USE_METALNESSMAP":"",i.alphaMap?"#define USE_ALPHAMAP":"",i.alphaTest?"#define USE_ALPHATEST":"",i.sheen?"#define USE_SHEEN":"",i.sheenColorMap?"#define USE_SHEENCOLORMAP":"",i.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",i.transmission?"#define USE_TRANSMISSION":"",i.transmissionMap?"#define USE_TRANSMISSIONMAP":"",i.thicknessMap?"#define USE_THICKNESSMAP":"",i.vertexTangents?"#define USE_TANGENT":"",i.vertexColors||i.instancingColor?"#define USE_COLOR":"",i.vertexAlphas?"#define USE_COLOR_ALPHA":"",i.vertexUvs?"#define USE_UV":"",i.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",i.gradientMap?"#define USE_GRADIENTMAP":"",i.flatShading?"#define FLAT_SHADED":"",i.doubleSided?"#define DOUBLE_SIDED":"",i.flipSided?"#define FLIP_SIDED":"",i.shadowMapEnabled?"#define USE_SHADOWMAP":"",i.shadowMapEnabled?"#define "+l:"",i.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",i.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",i.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",i.logarithmicDepthBuffer&&i.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(i.extensionShaderTextureLOD||i.envMap)&&i.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",i.toneMapping!==X?"#define TONE_MAPPING":"",i.toneMapping!==X?Js.tonemapping_pars_fragment:"",i.toneMapping!==X?Zo("toneMapping",i.toneMapping):"",i.dithering?"#define DITHERING":"",i.format===Ue?"#define OPAQUE":"",Js.encodings_pars_fragment,i.map?Yo("mapTexelToLinear",i.mapEncoding):"",i.matcap?Yo("matcapTexelToLinear",i.matcapEncoding):"",i.envMap?Yo("envMapTexelToLinear",i.envMapEncoding):"",i.emissiveMap?Yo("emissiveMapTexelToLinear",i.emissiveMapEncoding):"",i.specularColorMap?Yo("specularColorMapTexelToLinear",i.specularColorMapEncoding):"",i.sheenColorMap?Yo("sheenColorMapTexelToLinear",i.sheenColorMapEncoding):"",i.lightMap?Yo("lightMapTexelToLinear",i.lightMapEncoding):"",qo("linearToOutputTexel",i.outputEncoding),i.depthPacking?"#define DEPTH_PACKING "+i.depthPacking:"","\n"].filter($o).join("\n")),o=ea(o),o=Qo(o,i),o=Xo(o,i),a=ea(a),a=Qo(a,i),a=Xo(a,i),o=sa(o),a=sa(a),i.isWebGL2&&!0!==i.isRawShaderMaterial&&(E="#version 300 es\n",b=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+b,S=["#define varying in",i.glslVersion===Li?"":"out highp vec4 pc_fragColor;",i.glslVersion===Li?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+S);const T=E+S+a,w=Go(s,35633,E+b+o),x=Go(s,35632,T);if(s.attachShader(y,w),s.attachShader(y,x),void 0!==i.index0AttributeName?s.bindAttribLocation(y,0,i.index0AttributeName):!0===i.morphTargets&&s.bindAttribLocation(y,0,"position"),s.linkProgram(y),e.debug.checkShaderErrors){const e=s.getProgramInfoLog(y).trim(),t=s.getShaderInfoLog(w).trim(),i=s.getShaderInfoLog(x).trim();let n=!0,r=!0;if(!1===s.getProgramParameter(y,35714)){n=!1;const t=Ko(s,w,"vertex"),i=Ko(s,x,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(y,35715)+"\n\nProgram Info Log: "+e+"\n"+t+"\n"+i)}else""!==e?console.warn("THREE.WebGLProgram: Program Info Log:",e):""!==t&&""!==i||(r=!1);r&&(this.diagnostics={runnable:n,programLog:e,vertexShader:{log:t,prefix:b},fragmentShader:{log:i,prefix:S}})}let _,M;return s.deleteShader(w),s.deleteShader(x),this.getUniforms=function(){return void 0===_&&(_=new jo(s,y)),_},this.getAttributes=function(){return void 0===M&&(M=function(e,t){const i={},n=e.getProgramParameter(t,35721);for(let s=0;s<n;s++){const n=e.getActiveAttrib(t,s),r=n.name;let o=1;35674===n.type&&(o=2),35675===n.type&&(o=3),35676===n.type&&(o=4),i[r]={type:n.type,location:e.getAttribLocation(t,r),locationSize:o}}return i}(s,y)),M},this.destroy=function(){n.releaseStatesOfProgram(this),s.deleteProgram(y),this.program=void 0},this.name=i.shaderName,this.id=zo++,this.cacheKey=t,this.usedTimes=1,this.program=y,this.vertexShader=w,this.fragmentShader=x,this}function ca(e,t,i,n,s,r,o){const a=[],l=s.isWebGL2,c=s.logarithmicDepthBuffer,d=s.floatVertexTextures,h=s.maxVertexUniforms,u=s.vertexTextures;let p=s.precision;const m={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},v=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","instancingColor","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoat","clearcoatMap","clearcoatRoughnessMap","clearcoatNormalMap","displacementMap","specularMap",,"roughnessMap","metalnessMap","gradientMap","alphaMap","alphaTest","combine","vertexColors","vertexAlphas","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","morphTargetsCount","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","format","specularIntensityMap","specularColorMap","specularColorMapEncoding","transmission","transmissionMap","thicknessMap","sheen","sheenColorMap","sheenColorMapEncoding","sheenRoughnessMap"];function y(e){let t;return e&&e.isTexture?t=e.encoding:e&&e.isWebGLRenderTarget?(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),t=e.texture.encoding):t=$t,l&&e&&e.isTexture&&e.format===Be&&e.type===xe&&e.encoding===Qt&&(t=$t),t}return{getParameters:function(r,a,v,b,S){const E=b.fog,T=r.isMeshStandardMaterial?b.environment:null,w=(r.isMeshStandardMaterial?i:t).get(r.envMap||T),x=m[r.type],_=S.isSkinnedMesh?function(e){const t=e.skeleton.bones;if(d)return 1024;{const e=h,i=Math.floor((e-20)/4),n=Math.min(i,t.length);return n<t.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+t.length+" bones. This GPU supports "+n+"."),0):n}}(S):0;let M,O;if(null!==r.precision&&(p=s.getMaxPrecision(r.precision),p!==r.precision&&console.warn("THREE.WebGLProgram.getParameters:",r.precision,"not supported, using",p,"instead.")),x){const e=tr[x];M=e.vertexShader,O=e.fragmentShader}else M=r.vertexShader,O=r.fragmentShader;const A=e.getRenderTarget(),C=r.alphaTest>0,P=r.clearcoat>0;return{isWebGL2:l,shaderID:x,shaderName:r.type,vertexShader:M,fragmentShader:O,defines:r.defines,isRawShaderMaterial:!0===r.isRawShaderMaterial,glslVersion:r.glslVersion,precision:p,instancing:!0===S.isInstancedMesh,instancingColor:!0===S.isInstancedMesh&&null!==S.instanceColor,supportsVertexTextures:u,outputEncoding:null!==A?y(A.texture):e.outputEncoding,map:!!r.map,mapEncoding:y(r.map),matcap:!!r.matcap,matcapEncoding:y(r.matcap),envMap:!!w,envMapMode:w&&w.mapping,envMapEncoding:y(w),envMapCubeUV:!!w&&(w.mapping===ce||w.mapping===de),lightMap:!!r.lightMap,lightMapEncoding:y(r.lightMap),aoMap:!!r.aoMap,emissiveMap:!!r.emissiveMap,emissiveMapEncoding:y(r.emissiveMap),bumpMap:!!r.bumpMap,normalMap:!!r.normalMap,objectSpaceNormalMap:r.normalMapType===ai,tangentSpaceNormalMap:r.normalMapType===oi,clearcoat:P,clearcoatMap:P&&!!r.clearcoatMap,clearcoatRoughnessMap:P&&!!r.clearcoatRoughnessMap,clearcoatNormalMap:P&&!!r.clearcoatNormalMap,displacementMap:!!r.displacementMap,roughnessMap:!!r.roughnessMap,metalnessMap:!!r.metalnessMap,specularMap:!!r.specularMap,specularIntensityMap:!!r.specularIntensityMap,specularColorMap:!!r.specularColorMap,specularColorMapEncoding:y(r.specularColorMap),alphaMap:!!r.alphaMap,alphaTest:C,gradientMap:!!r.gradientMap,sheen:r.sheen>0,sheenColorMap:!!r.sheenColorMap,sheenColorMapEncoding:y(r.sheenColorMap),sheenRoughnessMap:!!r.sheenRoughnessMap,transmission:r.transmission>0,transmissionMap:!!r.transmissionMap,thicknessMap:!!r.thicknessMap,combine:r.combine,vertexTangents:!!r.normalMap&&!!S.geometry&&!!S.geometry.attributes.tangent,vertexColors:r.vertexColors,vertexAlphas:!0===r.vertexColors&&!!S.geometry&&!!S.geometry.attributes.color&&4===S.geometry.attributes.color.itemSize,vertexUvs:!!r.map||!!r.bumpMap||!!r.normalMap||!!r.specularMap||!!r.alphaMap||!!r.emissiveMap||!!r.roughnessMap||!!r.metalnessMap||!!r.clearcoatMap||!!r.clearcoatRoughnessMap||!!r.clearcoatNormalMap||!!r.displacementMap||!!r.transmissionMap||!!r.thicknessMap||!!r.specularIntensityMap||!!r.specularColorMap||!!r.sheenColorMap||r.sheenRoughnessMap,uvsVertexOnly:!(r.map||r.bumpMap||r.normalMap||r.specularMap||r.alphaMap||r.emissiveMap||r.roughnessMap||r.metalnessMap||r.clearcoatNormalMap||r.transmission>0||r.transmissionMap||r.thicknessMap||r.specularIntensityMap||r.specularColorMap||!!r.sheen>0||r.sheenColorMap||r.sheenRoughnessMap||!r.displacementMap),fog:!!E,useFog:r.fog,fogExp2:E&&E.isFogExp2,flatShading:!!r.flatShading,sizeAttenuation:r.sizeAttenuation,logarithmicDepthBuffer:c,skinning:!0===S.isSkinnedMesh&&_>0,maxBones:_,useVertexTexture:d,morphTargets:!!S.geometry&&!!S.geometry.morphAttributes.position,morphNormals:!!S.geometry&&!!S.geometry.morphAttributes.normal,morphTargetsCount:S.geometry&&S.geometry.morphAttributes.position?S.geometry.morphAttributes.position.length:0,numDirLights:a.directional.length,numPointLights:a.point.length,numSpotLights:a.spot.length,numRectAreaLights:a.rectArea.length,numHemiLights:a.hemi.length,numDirLightShadows:a.directionalShadowMap.length,numPointLightShadows:a.pointShadowMap.length,numSpotLightShadows:a.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,format:r.format,dithering:r.dithering,shadowMapEnabled:e.shadowMap.enabled&&v.length>0,shadowMapType:e.shadowMap.type,toneMapping:r.toneMapped?e.toneMapping:X,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:r.premultipliedAlpha,doubleSided:r.side===g,flipSided:r.side===f,depthPacking:void 0!==r.depthPacking&&r.depthPacking,index0AttributeName:r.index0AttributeName,extensionDerivatives:r.extensions&&r.extensions.derivatives,extensionFragDepth:r.extensions&&r.extensions.fragDepth,extensionDrawBuffers:r.extensions&&r.extensions.drawBuffers,extensionShaderTextureLOD:r.extensions&&r.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||n.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||n.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||n.has("EXT_shader_texture_lod"),customProgramCacheKey:r.customProgramCacheKey()}},getProgramCacheKey:function(t){const i=[];if(t.shaderID?i.push(t.shaderID):(i.push(Xi(t.fragmentShader)),i.push(Xi(t.vertexShader))),void 0!==t.defines)for(const e in t.defines)i.push(e),i.push(t.defines[e]);if(!1===t.isRawShaderMaterial){for(let e=0;e<v.length;e++)i.push(t[v[e]]);i.push(e.outputEncoding),i.push(e.gammaFactor)}return i.push(t.customProgramCacheKey),i.join()},getUniforms:function(e){const t=m[e.type];let i;if(t){const e=tr[t];i=zs.clone(e.uniforms)}else i=e.uniforms;return i},acquireProgram:function(t,i){let n;for(let e=0,t=a.length;e<t;e++){const t=a[e];if(t.cacheKey===i){n=t,++n.usedTimes;break}}return void 0===n&&(n=new la(e,i,t,r),a.push(n)),n},releaseProgram:function(e){if(0==--e.usedTimes){const t=a.indexOf(e);a[t]=a[a.length-1],a.pop(),e.destroy()}},programs:a}}function da(){let e=new WeakMap;return{get:function(t){let i=e.get(t);return void 0===i&&(i={},e.set(t,i)),i},remove:function(t){e.delete(t)},update:function(t,i,n){e.get(t)[i]=n},dispose:function(){e=new WeakMap}}}function ha(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function ua(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function pa(e){const t=[];let i=0;const n=[],s=[],r=[],o={id:-1};function a(n,s,r,a,l,c){let d=t[i];const h=e.get(r);return void 0===d?(d={id:n.id,object:n,geometry:s,material:r,program:h.program||o,groupOrder:a,renderOrder:n.renderOrder,z:l,group:c},t[i]=d):(d.id=n.id,d.object=n,d.geometry=s,d.material=r,d.program=h.program||o,d.groupOrder=a,d.renderOrder=n.renderOrder,d.z=l,d.group=c),i++,d}return{opaque:n,transmissive:s,transparent:r,init:function(){i=0,n.length=0,s.length=0,r.length=0},push:function(e,t,i,o,l,c){const d=a(e,t,i,o,l,c);i.transmission>0?s.push(d):!0===i.transparent?r.push(d):n.push(d)},unshift:function(e,t,i,o,l,c){const d=a(e,t,i,o,l,c);i.transmission>0?s.unshift(d):!0===i.transparent?r.unshift(d):n.unshift(d)},finish:function(){for(let e=i,n=t.length;e<n;e++){const i=t[e];if(null===i.id)break;i.id=null,i.object=null,i.geometry=null,i.material=null,i.program=null,i.group=null}},sort:function(e,t){n.length>1&&n.sort(e||ha),s.length>1&&s.sort(t||ua),r.length>1&&r.sort(t||ua)}}}function ma(e){let t=new WeakMap;return{get:function(i,n){let s;return!1===t.has(i)?(s=new pa(e),t.set(i,[s])):n>=t.get(i).length?(s=new pa(e),t.get(i).push(s)):s=t.get(i)[n],s},dispose:function(){t=new WeakMap}}}function fa(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":i={direction:new Vector3,color:new Color};break;case"SpotLight":i={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":i={position:new Vector3,color:new Color,distance:0,decay:0};break;case"HemisphereLight":i={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":i={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3}}return e[t.id]=i,i}}}let ga=0;function va(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function ya(e,t){const i=new fa,n=function(){const e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];let i;switch(t.type){case"DirectionalLight":case"SpotLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":i={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=i,i}}}(),s={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]};for(let e=0;e<9;e++)s.probe.push(new Vector3);const r=new Vector3,o=new Matrix4,a=new Matrix4;return{setup:function(r,o){let a=0,l=0,c=0;for(let e=0;e<9;e++)s.probe[e].set(0,0,0);let d=0,h=0,u=0,p=0,m=0,f=0,g=0,v=0;r.sort(va);const y=!0!==o?Math.PI:1;for(let e=0,t=r.length;e<t;e++){const t=r[e],o=t.color,b=t.intensity,S=t.distance,E=t.shadow&&t.shadow.map?t.shadow.map.texture:null;if(t.isAmbientLight)a+=o.r*b*y,l+=o.g*b*y,c+=o.b*b*y;else if(t.isLightProbe)for(let e=0;e<9;e++)s.probe[e].addScaledVector(t.sh.coefficients[e],b);else if(t.isDirectionalLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,s.directionalShadow[d]=i,s.directionalShadowMap[d]=E,s.directionalShadowMatrix[d]=t.shadow.matrix,f++}s.directional[d]=e,d++}else if(t.isSpotLight){const e=i.get(t);if(e.position.setFromMatrixPosition(t.matrixWorld),e.color.copy(o).multiplyScalar(b*y),e.distance=S,e.coneCos=Math.cos(t.angle),e.penumbraCos=Math.cos(t.angle*(1-t.penumbra)),e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,s.spotShadow[u]=i,s.spotShadowMap[u]=E,s.spotShadowMatrix[u]=t.shadow.matrix,v++}s.spot[u]=e,u++}else if(t.isRectAreaLight){const e=i.get(t);e.color.copy(o).multiplyScalar(b),e.halfWidth.set(.5*t.width,0,0),e.halfHeight.set(0,.5*t.height,0),s.rectArea[p]=e,p++}else if(t.isPointLight){const e=i.get(t);if(e.color.copy(t.color).multiplyScalar(t.intensity*y),e.distance=t.distance,e.decay=t.decay,t.castShadow){const e=t.shadow,i=n.get(t);i.shadowBias=e.bias,i.shadowNormalBias=e.normalBias,i.shadowRadius=e.radius,i.shadowMapSize=e.mapSize,i.shadowCameraNear=e.camera.near,i.shadowCameraFar=e.camera.far,s.pointShadow[h]=i,s.pointShadowMap[h]=E,s.pointShadowMatrix[h]=t.shadow.matrix,g++}s.point[h]=e,h++}else if(t.isHemisphereLight){const e=i.get(t);e.skyColor.copy(t.color).multiplyScalar(b*y),e.groundColor.copy(t.groundColor).multiplyScalar(b*y),s.hemi[m]=e,m++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(s.rectAreaLTC1=er.LTC_FLOAT_1,s.rectAreaLTC2=er.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(s.rectAreaLTC1=er.LTC_HALF_1,s.rectAreaLTC2=er.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),s.ambient[0]=a,s.ambient[1]=l,s.ambient[2]=c;const b=s.hash;b.directionalLength===d&&b.pointLength===h&&b.spotLength===u&&b.rectAreaLength===p&&b.hemiLength===m&&b.numDirectionalShadows===f&&b.numPointShadows===g&&b.numSpotShadows===v||(s.directional.length=d,s.spot.length=u,s.rectArea.length=p,s.point.length=h,s.hemi.length=m,s.directionalShadow.length=f,s.directionalShadowMap.length=f,s.pointShadow.length=g,s.pointShadowMap.length=g,s.spotShadow.length=v,s.spotShadowMap.length=v,s.directionalShadowMatrix.length=f,s.pointShadowMatrix.length=g,s.spotShadowMatrix.length=v,b.directionalLength=d,b.pointLength=h,b.spotLength=u,b.rectAreaLength=p,b.hemiLength=m,b.numDirectionalShadows=f,b.numPointShadows=g,b.numSpotShadows=v,s.version=ga++)},setupView:function(e,t){let i=0,n=0,l=0,c=0,d=0;const h=t.matrixWorldInverse;for(let t=0,u=e.length;t<u;t++){const u=e[t];if(u.isDirectionalLight){const e=s.directional[i];e.direction.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),i++}else if(u.isSpotLight){const e=s.spot[l];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(h),e.direction.setFromMatrixPosition(u.matrixWorld),r.setFromMatrixPosition(u.target.matrixWorld),e.direction.sub(r),e.direction.transformDirection(h),l++}else if(u.isRectAreaLight){const e=s.rectArea[c];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(h),a.identity(),o.copy(u.matrixWorld),o.premultiply(h),a.extractRotation(o),e.halfWidth.set(.5*u.width,0,0),e.halfHeight.set(0,.5*u.height,0),e.halfWidth.applyMatrix4(a),e.halfHeight.applyMatrix4(a),c++}else if(u.isPointLight){const e=s.point[n];e.position.setFromMatrixPosition(u.matrixWorld),e.position.applyMatrix4(h),n++}else if(u.isHemisphereLight){const e=s.hemi[d];e.direction.setFromMatrixPosition(u.matrixWorld),e.direction.transformDirection(h),e.direction.normalize(),d++}}},state:s}}function ba(e,t){const i=new ya(e,t),n=[],s=[];return{init:function(){n.length=0,s.length=0},state:{lightsArray:n,shadowsArray:s,lights:i},setupLights:function(e){i.setup(n,e)},setupLightsView:function(e){i.setupView(n,e)},pushLight:function(e){n.push(e)},pushShadow:function(e){s.push(e)}}}function Sa(e,t){let i=new WeakMap;return{get:function(n,s=0){let r;return!1===i.has(n)?(r=new ba(e,t),i.set(n,[r])):s>=i.get(n).length?(r=new ba(e,t),i.get(n).push(r)):r=i.get(n)[s],r},dispose:function(){i=new WeakMap}}}class MeshDepthMaterial extends Material{constructor(e){super(),this.type="MeshDepthMaterial",this.depthPacking=si,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;class MeshDistanceMaterial extends Material{constructor(e){super(),this.type="MeshDistanceMaterial",this.referencePosition=new Vector3,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;function Ea(e,t,i){let n=new Frustum;const s=new Vector2,r=new Vector2,o=new Vector4,a=new MeshDepthMaterial({depthPacking:ri}),l=new MeshDistanceMaterial,c={},d=i.maxTextureSize,u={0:f,1:m,2:g},v=new ShaderMaterial({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Vector2},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),y=v.clone();y.defines.HORIZONTAL_PASS=1;const S=new BufferGeometry;S.setAttribute("position",new BufferAttribute(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const E=new Mesh(S,v),T=this;function w(i,n){const s=t.update(E);v.defines.VSM_SAMPLES!==i.blurSamples&&(v.defines.VSM_SAMPLES=i.blurSamples,y.defines.VSM_SAMPLES=i.blurSamples,v.needsUpdate=!0,y.needsUpdate=!0),v.uniforms.shadow_pass.value=i.map.texture,v.uniforms.resolution.value=i.mapSize,v.uniforms.radius.value=i.radius,e.setRenderTarget(i.mapPass),e.clear(),e.renderBufferDirect(n,null,s,v,E,null),y.uniforms.shadow_pass.value=i.mapPass.texture,y.uniforms.resolution.value=i.mapSize,y.uniforms.radius.value=i.radius,e.setRenderTarget(i.map),e.clear(),e.renderBufferDirect(n,null,s,y,E,null)}function x(t,i,n,s,r,o,d){let h=null;const m=!0===s.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(h=void 0!==m?m:!0===s.isPointLight?l:a,e.localClippingEnabled&&!0===n.clipShadows&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){const e=h.uuid,t=n.uuid;let i=c[e];void 0===i&&(i={},c[e]=i);let s=i[t];void 0===s&&(s=h.clone(),i[t]=s),h=s}return h.visible=n.visible,h.wireframe=n.wireframe,h.side=d===p?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:u[n.side],h.alphaMap=n.alphaMap,h.alphaTest=n.alphaTest,h.clipShadows=n.clipShadows,h.clippingPlanes=n.clippingPlanes,h.clipIntersection=n.clipIntersection,h.displacementMap=n.displacementMap,h.displacementScale=n.displacementScale,h.displacementBias=n.displacementBias,h.wireframeLinewidth=n.wireframeLinewidth,h.linewidth=n.linewidth,!0===s.isPointLight&&!0===h.isMeshDistanceMaterial&&(h.referencePosition.setFromMatrixPosition(s.matrixWorld),h.nearDistance=r,h.farDistance=o),h}function _(i,s,r,o,a){if(!1===i.visible)return;if(i.layers.test(s.layers)&&(i.isMesh||i.isLine||i.isPoints)&&(i.castShadow||i.receiveShadow&&a===p)&&(!i.frustumCulled||n.intersectsObject(i))){i.modelViewMatrix.multiplyMatrices(r.matrixWorldInverse,i.matrixWorld);const n=t.update(i),s=i.material;if(Array.isArray(s)){const t=n.groups;for(let l=0,c=t.length;l<c;l++){const c=t[l],d=s[c.materialIndex];if(d&&d.visible){const t=x(i,0,d,o,r.near,r.far,a);e.renderBufferDirect(r,null,n,t,i,c)}}}else if(s.visible){const t=x(i,0,s,o,r.near,r.far,a);e.renderBufferDirect(r,null,n,t,i,null)}}const l=i.children;for(let e=0,t=l.length;e<t;e++)_(l[e],s,r,o,a)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=h,this.render=function(t,i,a){if(!1===T.enabled)return;if(!1===T.autoUpdate&&!1===T.needsUpdate)return;if(0===t.length)return;const l=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),u=e.state;u.setBlending(b),u.buffers.color.setClear(1,1,1,1),u.buffers.depth.setTest(!0),u.setScissorTest(!1);for(let l=0,c=t.length;l<c;l++){const c=t[l],h=c.shadow;if(void 0===h){console.warn("THREE.WebGLShadowMap:",c,"has no shadow.");continue}if(!1===h.autoUpdate&&!1===h.needsUpdate)continue;s.copy(h.mapSize);const m=h.getFrameExtents();if(s.multiply(m),r.copy(h.mapSize),(s.x>d||s.y>d)&&(s.x>d&&(r.x=Math.floor(d/m.x),s.x=r.x*m.x,h.mapSize.x=r.x),s.y>d&&(r.y=Math.floor(d/m.y),s.y=r.y*m.y,h.mapSize.y=r.y)),null===h.map&&!h.isPointLightShadow&&this.type===p){const e={minFilter:be,magFilter:be,format:Be};h.map=new WebGLRenderTarget(s.x,s.y,e),h.map.texture.name=c.name+".shadowMap",h.mapPass=new WebGLRenderTarget(s.x,s.y,e),h.camera.updateProjectionMatrix()}if(null===h.map){const e={minFilter:me,magFilter:me,format:Be};h.map=new WebGLRenderTarget(s.x,s.y,e),h.map.texture.name=c.name+".shadowMap",h.camera.updateProjectionMatrix()}e.setRenderTarget(h.map),e.clear();const f=h.getViewportCount();for(let e=0;e<f;e++){const t=h.getViewport(e);o.set(r.x*t.x,r.y*t.y,r.x*t.z,r.y*t.w),u.viewport(o),h.updateMatrices(c,e),n=h.getFrustum(),_(i,a,h.camera,c,this.type)}h.isPointLightShadow||this.type!==p||w(h,a),h.needsUpdate=!1}T.needsUpdate=!1,e.setRenderTarget(l,c,h)}}function Ta(e,t,i){const n=i.isWebGL2;const s=new function(){let t=!1;const i=new Vector4;let n=null;const s=new Vector4(0,0,0,0);return{setMask:function(i){n===i||t||(e.colorMask(i,i,i,i),n=i)},setLocked:function(e){t=e},setClear:function(t,n,r,o,a){!0===a&&(t*=o,n*=o,r*=o),i.set(t,n,r,o),!1===s.equals(i)&&(e.clearColor(t,n,r,o),s.copy(i))},reset:function(){t=!1,n=null,s.set(-1,0,0,0)}}},r=new function(){let t=!1,i=null,n=null,s=null;return{setTest:function(e){e?ye(2929):be(2929)},setMask:function(n){i===n||t||(e.depthMask(n),i=n)},setFunc:function(t){if(n!==t){if(t)switch(t){case H:e.depthFunc(512);break;case j:e.depthFunc(519);break;case G:e.depthFunc(513);break;case z:e.depthFunc(515);break;case W:e.depthFunc(514);break;case K:e.depthFunc(518);break;case Y:e.depthFunc(516);break;case q:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);n=t}},setLocked:function(e){t=e},setClear:function(t){s!==t&&(e.clearDepth(t),s=t)},reset:function(){t=!1,i=null,n=null,s=null}}},c=new function(){let t=!1,i=null,n=null,s=null,r=null,o=null,a=null,l=null,c=null;return{setTest:function(e){t||(e?ye(2960):be(2960))},setMask:function(n){i===n||t||(e.stencilMask(n),i=n)},setFunc:function(t,i,o){n===t&&s===i&&r===o||(e.stencilFunc(t,i,o),n=t,s=i,r=o)},setOp:function(t,i,n){o===t&&a===i&&l===n||(e.stencilOp(t,i,n),o=t,a=i,l=n)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,i=null,n=null,s=null,r=null,o=null,a=null,l=null,c=null}}};let d={},h=null,u={},p=null,m=!1,v=null,y=null,Z=null,$=null,Q=null,X=null,J=null,ee=!1,te=null,ie=null,ne=null,se=null,re=null;const oe=e.getParameter(35661);let ae=!1,le=0;const ce=e.getParameter(7938);-1!==ce.indexOf("WebGL")?(le=parseFloat(/^WebGL (\d)/.exec(ce)[1]),ae=le>=1):-1!==ce.indexOf("OpenGL ES")&&(le=parseFloat(/^OpenGL ES (\d)/.exec(ce)[1]),ae=le>=2);let de=null,he={};const ue=e.getParameter(3088),pe=e.getParameter(2978),me=(new Vector4).fromArray(ue),fe=(new Vector4).fromArray(pe);function ge(t,i,n){const s=new Uint8Array(4),r=e.createTexture();e.bindTexture(t,r),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(let t=0;t<n;t++)e.texImage2D(i+t,0,6408,1,1,0,6408,5121,s);return r}const ve={};function ye(t){!0!==d[t]&&(e.enable(t),d[t]=!0)}function be(t){!1!==d[t]&&(e.disable(t),d[t]=!1)}ve[3553]=ge(3553,3553,1),ve[34067]=ge(34067,34069,6),s.setClear(0,0,0,1),r.setClear(1),c.setClear(0),ye(2929),r.setFunc(z),we(!1),xe(a),ye(2884),Te(b);const Se={[_]:32774,[M]:32778,[O]:32779};if(n)Se[A]=32775,Se[C]=32776;else{const e=t.get("EXT_blend_minmax");null!==e&&(Se[A]=e.MIN_EXT,Se[C]=e.MAX_EXT)}const Ee={[P]:0,[D]:1,[N]:768,[L]:770,[V]:776,[B]:774,[k]:772,[I]:769,[R]:771,[F]:775,[U]:773};function Te(t,i,n,s,r,o,a,l){if(t!==b){if(!1===m&&(ye(3042),m=!0),t===x)r=r||i,o=o||n,a=a||s,i===y&&r===Q||(e.blendEquationSeparate(Se[i],Se[r]),y=i,Q=r),n===Z&&s===$&&o===X&&a===J||(e.blendFuncSeparate(Ee[n],Ee[s],Ee[o],Ee[a]),Z=n,$=s,X=o,J=a),v=t,ee=null;else if(t!==v||l!==ee){if(y===_&&Q===_||(e.blendEquation(32774),y=_,Q=_),l)switch(t){case S:e.blendFuncSeparate(1,771,1,771);break;case E:e.blendFunc(1,1);break;case T:e.blendFuncSeparate(0,0,769,771);break;case w:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case S:e.blendFuncSeparate(770,771,1,771);break;case E:e.blendFunc(770,1);break;case T:e.blendFunc(0,769);break;case w:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}Z=null,$=null,X=null,J=null,v=t,ee=l}}else!0===m&&(be(3042),m=!1)}function we(t){te!==t&&(t?e.frontFace(2304):e.frontFace(2305),te=t)}function xe(t){t!==o?(ye(2884),t!==ie&&(t===a?e.cullFace(1029):t===l?e.cullFace(1028):e.cullFace(1032))):be(2884),ie=t}function _e(t,i,n){t?(ye(32823),se===i&&re===n||(e.polygonOffset(i,n),se=i,re=n)):be(32823)}function Me(t){void 0===t&&(t=33984+oe-1),de!==t&&(e.activeTexture(t),de=t)}return{buffers:{color:s,depth:r,stencil:c},enable:ye,disable:be,bindFramebuffer:function(t,i){return null===i&&null!==h&&(i=h),u[t]!==i&&(e.bindFramebuffer(t,i),u[t]=i,n&&(36009===t&&(u[36160]=i),36160===t&&(u[36009]=i)),!0)},bindXRFramebuffer:function(t){t!==h&&(e.bindFramebuffer(36160,t),h=t)},useProgram:function(t){return p!==t&&(e.useProgram(t),p=t,!0)},setBlending:Te,setMaterial:function(e,t){e.side===g?be(2884):ye(2884);let i=e.side===f;t&&(i=!i),we(i),e.blending===S&&!1===e.transparent?Te(b):Te(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),r.setFunc(e.depthFunc),r.setTest(e.depthTest),r.setMask(e.depthWrite),s.setMask(e.colorWrite);const n=e.stencilWrite;c.setTest(n),n&&(c.setMask(e.stencilWriteMask),c.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),c.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),_e(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?ye(32926):be(32926)},setFlipSided:we,setCullFace:xe,setLineWidth:function(t){t!==ne&&(ae&&e.lineWidth(t),ne=t)},setPolygonOffset:_e,setScissorTest:function(e){e?ye(3089):be(3089)},activeTexture:Me,bindTexture:function(t,i){null===de&&Me();let n=he[de];void 0===n&&(n={type:void 0,texture:void 0},he[de]=n),n.type===t&&n.texture===i||(e.bindTexture(t,i||ve[t]),n.type=t,n.texture=i)},unbindTexture:function(){const t=he[de];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(e){console.error("THREE.WebGLState:",e)}},scissor:function(t){!1===me.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),me.copy(t))},viewport:function(t){!1===fe.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),fe.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===n&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),d={},de=null,he={},h=null,u={},p=null,m=!1,v=null,y=null,Z=null,$=null,Q=null,X=null,J=null,ee=!1,te=null,ie=null,ne=null,se=null,re=null,me.set(0,0,e.canvas.width,e.canvas.height),fe.set(0,0,e.canvas.width,e.canvas.height),s.reset(),r.reset(),c.reset()}}}function wa(e,t,i,n,s,r,o){const a=s.isWebGL2,l=s.maxTextures,c=s.maxCubemapSize,d=s.maxTextureSize,h=s.maxSamples,u=new WeakMap;let p,m=!1;try{m="undefined"!=typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch(e){}function f(e,t){return m?new OffscreenCanvas(e,t):Qi("canvas")}function g(e,t,i,n){let s=1;if((e.width>n||e.height>n)&&(s=n/Math.max(e.width,e.height)),s<1||!0===t){if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap){const n=t?Ki:Math.floor,r=n(s*e.width),o=n(s*e.height);void 0===p&&(p=f(r,o));const a=i?f(r,o):p;a.width=r,a.height=o;return a.getContext("2d").drawImage(e,0,0,r,o),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+r+"x"+o+")."),a}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function v(e){return zi(e.width)&&zi(e.height)}function y(e,t){return e.generateMipmaps&&t&&e.minFilter!==me&&e.minFilter!==be}function b(t,i,s,r,o=1){e.generateMipmap(t);n.get(i).__maxMipLevel=Math.log2(Math.max(s,r,o))}function S(i,n,s,r){if(!1===a)return n;if(null!==i){if(void 0!==e[i])return e[i];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+i+"'")}let o=n;return 6403===n&&(5126===s&&(o=33326),5131===s&&(o=33325),5121===s&&(o=33321)),6407===n&&(5126===s&&(o=34837),5131===s&&(o=34843),5121===s&&(o=32849)),6408===n&&(5126===s&&(o=34836),5131===s&&(o=34842),5121===s&&(o=r===Qt?35907:32856)),33325!==o&&33326!==o&&34842!==o&&34836!==o||t.get("EXT_color_buffer_float"),o}function E(e){return e===me||e===fe||e===ve?9728:9729}function T(t){const i=t.target;i.removeEventListener("dispose",T),function(t){const i=n.get(t);if(void 0===i.__webglInit)return;e.deleteTexture(i.__webglTexture),n.remove(t)}(i),i.isVideoTexture&&u.delete(i),o.memory.textures--}function w(t){const i=t.target;i.removeEventListener("dispose",w),function(t){const i=t.texture,s=n.get(t),r=n.get(i);if(!t)return;void 0!==r.__webglTexture&&(e.deleteTexture(r.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(let t=0;t<6;t++)e.deleteFramebuffer(s.__webglFramebuffer[t]),s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer[t]);else e.deleteFramebuffer(s.__webglFramebuffer),s.__webglDepthbuffer&&e.deleteRenderbuffer(s.__webglDepthbuffer),s.__webglMultisampledFramebuffer&&e.deleteFramebuffer(s.__webglMultisampledFramebuffer),s.__webglColorRenderbuffer&&e.deleteRenderbuffer(s.__webglColorRenderbuffer),s.__webglDepthRenderbuffer&&e.deleteRenderbuffer(s.__webglDepthRenderbuffer);if(t.isWebGLMultipleRenderTargets)for(let t=0,s=i.length;t<s;t++){const s=n.get(i[t]);s.__webglTexture&&(e.deleteTexture(s.__webglTexture),o.memory.textures--),n.remove(i[t])}n.remove(i),n.remove(t)}(i)}let x=0;function _(e,t){const s=n.get(e);if(e.isVideoTexture&&function(e){const t=o.render.frame;u.get(e)!==t&&(u.set(e,t),e.update())}(e),e.version>0&&s.__version!==e.version){const i=e.image;if(void 0===i)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(!1!==i.complete)return void D(s,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}i.activeTexture(33984+t),i.bindTexture(3553,s.__webglTexture)}function M(t,s){const o=n.get(t);t.version>0&&o.__version!==t.version?function(t,n,s){if(6!==n.image.length)return;P(t,n),i.activeTexture(33984+s),i.bindTexture(34067,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const o=n&&(n.isCompressedTexture||n.image[0].isCompressedTexture),l=n.image[0]&&n.image[0].isDataTexture,d=[];for(let e=0;e<6;e++)d[e]=o||l?l?n.image[e].image:n.image[e]:g(n.image[e],!1,!0,c);const h=d[0],u=v(h)||a,p=r.convert(n.format),m=r.convert(n.type),f=S(n.internalFormat,p,m,n.encoding);let E;if(C(34067,n,u),o){for(let e=0;e<6;e++){E=d[e].mipmaps;for(let t=0;t<E.length;t++){const s=E[t];n.format!==Be&&n.format!==Ue?null!==p?i.compressedTexImage2D(34069+e,t,f,s.width,s.height,0,s.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):i.texImage2D(34069+e,t,f,s.width,s.height,0,p,m,s.data)}}t.__maxMipLevel=E.length-1}else{E=n.mipmaps;for(let e=0;e<6;e++)if(l){i.texImage2D(34069+e,0,f,d[e].width,d[e].height,0,p,m,d[e].data);for(let t=0;t<E.length;t++){const n=E[t].image[e].image;i.texImage2D(34069+e,t+1,f,n.width,n.height,0,p,m,n.data)}}else{i.texImage2D(34069+e,0,f,p,m,d[e]);for(let t=0;t<E.length;t++){const n=E[t];i.texImage2D(34069+e,t+1,f,p,m,n.image[e])}}t.__maxMipLevel=E.length}y(n,u)&&b(34067,n,h.width,h.height);t.__version=n.version,n.onUpdate&&n.onUpdate(n)}(o,t,s):(i.activeTexture(33984+s),i.bindTexture(34067,o.__webglTexture))}const O={[he]:10497,[ue]:33071,[pe]:33648},A={[me]:9728,[fe]:9984,[ve]:9986,[be]:9729,[Se]:9985,[Te]:9987};function C(i,r,o){if(o?(e.texParameteri(i,10242,O[r.wrapS]),e.texParameteri(i,10243,O[r.wrapT]),32879!==i&&35866!==i||e.texParameteri(i,32882,O[r.wrapR]),e.texParameteri(i,10240,A[r.magFilter]),e.texParameteri(i,10241,A[r.minFilter])):(e.texParameteri(i,10242,33071),e.texParameteri(i,10243,33071),32879!==i&&35866!==i||e.texParameteri(i,32882,33071),r.wrapS===ue&&r.wrapT===ue||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(i,10240,E(r.magFilter)),e.texParameteri(i,10241,E(r.minFilter)),r.minFilter!==me&&r.minFilter!==be&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){const o=t.get("EXT_texture_filter_anisotropic");if(r.type===Pe&&!1===t.has("OES_texture_float_linear"))return;if(!1===a&&r.type===De&&!1===t.has("OES_texture_half_float_linear"))return;(r.anisotropy>1||n.get(r).__currentAnisotropy)&&(e.texParameterf(i,o.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(r.anisotropy,s.getMaxAnisotropy())),n.get(r).__currentAnisotropy=r.anisotropy)}}function P(t,i){void 0===t.__webglInit&&(t.__webglInit=!0,i.addEventListener("dispose",T),t.__webglTexture=e.createTexture(),o.memory.textures++)}function D(t,n,s){let o=3553;n.isDataTexture2DArray&&(o=35866),n.isDataTexture3D&&(o=32879),P(t,n),i.activeTexture(33984+s),i.bindTexture(o,t.__webglTexture),e.pixelStorei(37440,n.flipY),e.pixelStorei(37441,n.premultiplyAlpha),e.pixelStorei(3317,n.unpackAlignment),e.pixelStorei(37443,0);const l=function(e){return!a&&(e.wrapS!==ue||e.wrapT!==ue||e.minFilter!==me&&e.minFilter!==be)}(n)&&!1===v(n.image),c=g(n.image,l,!1,d),h=v(c)||a,u=r.convert(n.format);let p,m=r.convert(n.type),f=S(n.internalFormat,u,m,n.encoding);C(o,n,h);const E=n.mipmaps;if(n.isDepthTexture)f=6402,a?f=n.type===Pe?36012:n.type===Ce?33190:n.type===Re?35056:33189:n.type===Pe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),n.format===je&&6402===f&&n.type!==Oe&&n.type!==Ce&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),n.type=Oe,m=r.convert(n.type)),n.format===Ge&&6402===f&&(f=34041,n.type!==Re&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),n.type=Re,m=r.convert(n.type))),i.texImage2D(3553,0,f,c.width,c.height,0,u,m,null);else if(n.isDataTexture)if(E.length>0&&h){for(let e=0,t=E.length;e<t;e++)p=E[e],i.texImage2D(3553,e,f,p.width,p.height,0,u,m,p.data);n.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else i.texImage2D(3553,0,f,c.width,c.height,0,u,m,c.data),t.__maxMipLevel=0;else if(n.isCompressedTexture){for(let e=0,t=E.length;e<t;e++)p=E[e],n.format!==Be&&n.format!==Ue?null!==u?i.compressedTexImage2D(3553,e,f,p.width,p.height,0,p.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):i.texImage2D(3553,e,f,p.width,p.height,0,u,m,p.data);t.__maxMipLevel=E.length-1}else if(n.isDataTexture2DArray)i.texImage3D(35866,0,f,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(n.isDataTexture3D)i.texImage3D(32879,0,f,c.width,c.height,c.depth,0,u,m,c.data),t.__maxMipLevel=0;else if(E.length>0&&h){for(let e=0,t=E.length;e<t;e++)p=E[e],i.texImage2D(3553,e,f,u,m,p);n.generateMipmaps=!1,t.__maxMipLevel=E.length-1}else i.texImage2D(3553,0,f,u,m,c),t.__maxMipLevel=0;y(n,h)&&b(o,n,c.width,c.height),t.__version=n.version,n.onUpdate&&n.onUpdate(n)}function N(t,s,o,a,l){const c=r.convert(o.format),d=r.convert(o.type),h=S(o.internalFormat,c,d,o.encoding);32879===l||35866===l?i.texImage3D(l,0,h,s.width,s.height,s.depth,0,c,d,null):i.texImage2D(l,0,h,s.width,s.height,0,c,d,null),i.bindFramebuffer(36160,t),e.framebufferTexture2D(36160,a,l,n.get(o).__webglTexture,0),i.bindFramebuffer(36160,null)}function I(t,i,n){if(e.bindRenderbuffer(36161,t),i.depthBuffer&&!i.stencilBuffer){let s=33189;if(n){const t=i.depthTexture;t&&t.isDepthTexture&&(t.type===Pe?s=36012:t.type===Ce&&(s=33190));const n=R(i);e.renderbufferStorageMultisample(36161,n,s,i.width,i.height)}else e.renderbufferStorage(36161,s,i.width,i.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(i.depthBuffer&&i.stencilBuffer){if(n){const t=R(i);e.renderbufferStorageMultisample(36161,t,35056,i.width,i.height)}else e.renderbufferStorage(36161,34041,i.width,i.height);e.framebufferRenderbuffer(36160,33306,36161,t)}else{const t=!0===i.isWebGLMultipleRenderTargets?i.texture[0]:i.texture,s=r.convert(t.format),o=r.convert(t.type),a=S(t.internalFormat,s,o,t.encoding);if(n){const t=R(i);e.renderbufferStorageMultisample(36161,t,a,i.width,i.height)}else e.renderbufferStorage(36161,a,i.width,i.height)}e.bindRenderbuffer(36161,null)}function L(t){const s=n.get(t),r=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture){if(r)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,s){if(s&&s.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(i.bindFramebuffer(36160,t),!s.depthTexture||!s.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");n.get(s.depthTexture).__webglTexture&&s.depthTexture.image.width===s.width&&s.depthTexture.image.height===s.height||(s.depthTexture.image.width=s.width,s.depthTexture.image.height=s.height,s.depthTexture.needsUpdate=!0),_(s.depthTexture,0);const r=n.get(s.depthTexture).__webglTexture;if(s.depthTexture.format===je)e.framebufferTexture2D(36160,36096,3553,r,0);else{if(s.depthTexture.format!==Ge)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,r,0)}}(s.__webglFramebuffer,t)}else if(r){s.__webglDepthbuffer=[];for(let n=0;n<6;n++)i.bindFramebuffer(36160,s.__webglFramebuffer[n]),s.__webglDepthbuffer[n]=e.createRenderbuffer(),I(s.__webglDepthbuffer[n],t,!1)}else i.bindFramebuffer(36160,s.__webglFramebuffer),s.__webglDepthbuffer=e.createRenderbuffer(),I(s.__webglDepthbuffer,t,!1);i.bindFramebuffer(36160,null)}function R(e){return a&&e.isWebGLMultisampleRenderTarget?Math.min(h,e.samples):0}let k=!1,U=!1;this.allocateTextureUnit=function(){const e=x;return e>=l&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+l),x+=1,e},this.resetTextureUnits=function(){x=0},this.setTexture2D=_,this.setTexture2DArray=function(e,t){const s=n.get(e);e.version>0&&s.__version!==e.version?D(s,e,t):(i.activeTexture(33984+t),i.bindTexture(35866,s.__webglTexture))},this.setTexture3D=function(e,t){const s=n.get(e);e.version>0&&s.__version!==e.version?D(s,e,t):(i.activeTexture(33984+t),i.bindTexture(32879,s.__webglTexture))},this.setTextureCube=M,this.setupRenderTarget=function(t){const l=t.texture,c=n.get(t),d=n.get(l);t.addEventListener("dispose",w),!0!==t.isWebGLMultipleRenderTargets&&(d.__webglTexture=e.createTexture(),d.__version=l.version,o.memory.textures++);const h=!0===t.isWebGLCubeRenderTarget,u=!0===t.isWebGLMultipleRenderTargets,p=!0===t.isWebGLMultisampleRenderTarget,m=l.isDataTexture3D||l.isDataTexture2DArray,f=v(t)||a;if(!a||l.format!==Ue||l.type!==Pe&&l.type!==De||(l.format=Be,console.warn("THREE.WebGLRenderer: Rendering to textures with RGB format is not supported. Using RGBA format instead.")),h){c.__webglFramebuffer=[];for(let t=0;t<6;t++)c.__webglFramebuffer[t]=e.createFramebuffer()}else if(c.__webglFramebuffer=e.createFramebuffer(),u)if(s.drawBuffers){const i=t.texture;for(let t=0,s=i.length;t<s;t++){const s=n.get(i[t]);void 0===s.__webglTexture&&(s.__webglTexture=e.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");else if(p)if(a){c.__webglMultisampledFramebuffer=e.createFramebuffer(),c.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,c.__webglColorRenderbuffer);const n=r.convert(l.format),s=r.convert(l.type),o=S(l.internalFormat,n,s,l.encoding),a=R(t);e.renderbufferStorageMultisample(36161,a,o,t.width,t.height),i.bindFramebuffer(36160,c.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,c.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),t.depthBuffer&&(c.__webglDepthRenderbuffer=e.createRenderbuffer(),I(c.__webglDepthRenderbuffer,t,!0)),i.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");if(h){i.bindTexture(34067,d.__webglTexture),C(34067,l,f);for(let e=0;e<6;e++)N(c.__webglFramebuffer[e],t,l,36064,34069+e);y(l,f)&&b(34067,l,t.width,t.height),i.unbindTexture()}else if(u){const e=t.texture;for(let s=0,r=e.length;s<r;s++){const r=e[s],o=n.get(r);i.bindTexture(3553,o.__webglTexture),C(3553,r,f),N(c.__webglFramebuffer,t,r,36064+s,3553),y(r,f)&&b(3553,r,t.width,t.height)}i.unbindTexture()}else{let e=3553;if(m)if(a){e=l.isDataTexture3D?32879:35866}else console.warn("THREE.DataTexture3D and THREE.DataTexture2DArray only supported with WebGL2.");i.bindTexture(e,d.__webglTexture),C(e,l,f),N(c.__webglFramebuffer,t,l,36064,e),y(l,f)&&b(e,l,t.width,t.height,t.depth),i.unbindTexture()}t.depthBuffer&&L(t)},this.updateRenderTargetMipmap=function(e){const t=v(e)||a,s=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture];for(let r=0,o=s.length;r<o;r++){const o=s[r];if(y(o,t)){const t=e.isWebGLCubeRenderTarget?34067:3553,s=n.get(o).__webglTexture;i.bindTexture(t,s),b(t,o,e.width,e.height),i.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(t.isWebGLMultisampleRenderTarget)if(a){const s=t.width,r=t.height;let o=16384;t.depthBuffer&&(o|=256),t.stencilBuffer&&(o|=1024);const a=n.get(t);i.bindFramebuffer(36008,a.__webglMultisampledFramebuffer),i.bindFramebuffer(36009,a.__webglFramebuffer),e.blitFramebuffer(0,0,s,r,0,0,s,r,o,9728),i.bindFramebuffer(36008,null),i.bindFramebuffer(36009,a.__webglMultisampledFramebuffer)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(e,t){e&&e.isWebGLRenderTarget&&(!1===k&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),k=!0),e=e.texture),_(e,t)},this.safeSetTextureCube=function(e,t){e&&e.isWebGLCubeRenderTarget&&(!1===U&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),U=!0),e=e.texture),M(e,t)}}function xa(e,t,i){const n=i.isWebGL2;return{convert:function(e){let i;if(e===xe)return 5121;if(e===Ne)return 32819;if(e===Ie)return 32820;if(e===Le)return 33635;if(e===_e)return 5120;if(e===Me)return 5122;if(e===Oe)return 5123;if(e===Ae)return 5124;if(e===Ce)return 5125;if(e===Pe)return 5126;if(e===De)return n?5131:(i=t.get("OES_texture_half_float"),null!==i?i.HALF_FLOAT_OES:null);if(e===ke)return 6406;if(e===Ue)return 6407;if(e===Be)return 6408;if(e===Fe)return 6409;if(e===Ve)return 6410;if(e===je)return 6402;if(e===Ge)return 34041;if(e===ze)return 6403;if(e===We)return 36244;if(e===Ke)return 33319;if(e===Ye)return 33320;if(e===qe)return 36248;if(e===Ze)return 36249;if(e===$e||e===Qe||e===Xe||e===Je){if(i=t.get("WEBGL_compressed_texture_s3tc"),null===i)return null;if(e===$e)return i.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===Qe)return i.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Xe)return i.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Je)return i.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(e===et||e===tt||e===it||e===nt){if(i=t.get("WEBGL_compressed_texture_pvrtc"),null===i)return null;if(e===et)return i.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===tt)return i.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===it)return i.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===nt)return i.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(e===st)return i=t.get("WEBGL_compressed_texture_etc1"),null!==i?i.COMPRESSED_RGB_ETC1_WEBGL:null;if((e===rt||e===ot)&&(i=t.get("WEBGL_compressed_texture_etc"),null!==i)){if(e===rt)return i.COMPRESSED_RGB8_ETC2;if(e===ot)return i.COMPRESSED_RGBA8_ETC2_EAC}return e===at||e===lt||e===ct||e===dt||e===ht||e===ut||e===pt||e===mt||e===ft||e===gt||e===vt||e===yt||e===bt||e===St||e===Tt||e===wt||e===xt||e===_t||e===Mt||e===Ot||e===At||e===Ct||e===Pt||e===Dt||e===Nt||e===It||e===Lt||e===Rt?(i=t.get("WEBGL_compressed_texture_astc"),null!==i?e:null):e===Et?(i=t.get("EXT_texture_compression_bptc"),null!==i?e:null):e===Re?n?34042:(i=t.get("WEBGL_depth_texture"),null!==i?i.UNSIGNED_INT_24_8_WEBGL:null):void 0}}}class ArrayCamera extends PerspectiveCamera{constructor(e=[]){super(),this.cameras=e}}ArrayCamera.prototype.isArrayCamera=!0;class Group extends Object3D{constructor(){super(),this.type="Group"}}Group.prototype.isGroup=!0;const _a={type:"move"};class WebXRController{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new Group,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new Group,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Vector3,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Vector3),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new Group,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Vector3,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Vector3),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let n=null,s=null,r=null;const o=this._targetRay,a=this._grip,l=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState)if(null!==o&&(n=t.getPose(e.targetRaySpace,i),null!==n&&(o.matrix.fromArray(n.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),n.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(n.linearVelocity)):o.hasLinearVelocity=!1,n.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(n.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(_a))),l&&e.hand){r=!0;for(const n of e.hand.values()){const e=t.getJointPose(n,i);if(void 0===l.joints[n.jointName]){const e=new Group;e.matrixAutoUpdate=!1,e.visible=!1,l.joints[n.jointName]=e,l.add(e)}const s=l.joints[n.jointName];null!==e&&(s.matrix.fromArray(e.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),s.jointRadius=e.radius),s.visible=null!==e}const n=l.joints["index-finger-tip"],s=l.joints["thumb-tip"],o=n.position.distanceTo(s.position),a=.02,c=.005;l.inputState.pinching&&o>a+c?(l.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!l.inputState.pinching&&o<=a-c&&(l.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==a&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(a.matrix.fromArray(s.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),s.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(s.linearVelocity)):a.hasLinearVelocity=!1,s.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(s.angularVelocity)):a.hasAngularVelocity=!1));return null!==o&&(o.visible=null!==n),null!==a&&(a.visible=null!==s),null!==l&&(l.visible=null!==r),this}}class WebXRManager extends EventDispatcher{constructor(e,t){super();const i=this,n=e.state;let s=null,r=1,o=null,a="local-floor",l=null,c=null,d=null,h=null,u=null,p=!1,m=null,f=null,g=null,v=null,y=null,b=null;const S=[],E=new Map,T=new PerspectiveCamera;T.layers.enable(1),T.viewport=new Vector4;const w=new PerspectiveCamera;w.layers.enable(2),w.viewport=new Vector4;const x=[T,w],_=new ArrayCamera;_.layers.enable(1),_.layers.enable(2);let M=null,O=null;function A(e){const t=E.get(e.inputSource);t&&t.dispatchEvent({type:e.type,data:e.inputSource})}function C(){E.forEach((function(e,t){e.disconnect(t)})),E.clear(),M=null,O=null,n.bindXRFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),d&&t.deleteFramebuffer(d),m&&t.deleteFramebuffer(m),f&&t.deleteRenderbuffer(f),g&&t.deleteRenderbuffer(g),d=null,m=null,f=null,g=null,u=null,h=null,c=null,s=null,R.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function P(e){const t=s.inputSources;for(let e=0;e<S.length;e++)E.set(t[e],S[e]);for(let t=0;t<e.removed.length;t++){const i=e.removed[t],n=E.get(i);n&&(n.dispatchEvent({type:"disconnected",data:i}),E.delete(i))}for(let t=0;t<e.added.length;t++){const i=e.added[t],n=E.get(i);n&&n.dispatchEvent({type:"connected",data:i})}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(e){let t=S[e];return void 0===t&&(t=new WebXRController,S[e]=t),t.getTargetRaySpace()},this.getControllerGrip=function(e){let t=S[e];return void 0===t&&(t=new WebXRController,S[e]=t),t.getGripSpace()},this.getHand=function(e){let t=S[e];return void 0===t&&(t=new WebXRController,S[e]=t),t.getHandSpace()},this.setFramebufferScaleFactor=function(e){r=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(e){a=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return o},this.getBaseLayer=function(){return null!==h?h:u},this.getBinding=function(){return c},this.getFrame=function(){return v},this.getSession=function(){return s},this.setSession=async function(e){if(s=e,null!==s){s.addEventListener("select",A),s.addEventListener("selectstart",A),s.addEventListener("selectend",A),s.addEventListener("squeeze",A),s.addEventListener("squeezestart",A),s.addEventListener("squeezeend",A),s.addEventListener("end",C),s.addEventListener("inputsourceschange",P);const e=t.getContextAttributes();if(!0!==e.xrCompatible&&await t.makeXRCompatible(),void 0===s.renderState.layers){const i={antialias:e.antialias,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(s,t,i),s.updateRenderState({baseLayer:u})}else if(t instanceof WebGLRenderingContext){const i={antialias:!0,alpha:e.alpha,depth:e.depth,stencil:e.stencil,framebufferScaleFactor:r};u=new XRWebGLLayer(s,t,i),s.updateRenderState({layers:[u]})}else{p=e.antialias;let i=null;e.depth&&(b=256,e.stencil&&(b|=1024),y=e.stencil?33306:36096,i=e.stencil?35056:33190);const o={colorFormat:e.alpha?32856:32849,depthFormat:i,scaleFactor:r};c=new XRWebGLBinding(s,t),h=c.createProjectionLayer(o),d=t.createFramebuffer(),s.updateRenderState({layers:[h]}),p&&(m=t.createFramebuffer(),f=t.createRenderbuffer(),t.bindRenderbuffer(36161,f),t.renderbufferStorageMultisample(36161,4,32856,h.textureWidth,h.textureHeight),n.bindFramebuffer(36160,m),t.framebufferRenderbuffer(36160,36064,36161,f),t.bindRenderbuffer(36161,null),null!==i&&(g=t.createRenderbuffer(),t.bindRenderbuffer(36161,g),t.renderbufferStorageMultisample(36161,4,i,h.textureWidth,h.textureHeight),t.framebufferRenderbuffer(36160,y,36161,g),t.bindRenderbuffer(36161,null)),n.bindFramebuffer(36160,null))}o=await s.requestReferenceSpace(a),R.setContext(s),R.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}};const D=new Vector3,N=new Vector3;function I(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}this.updateCamera=function(e){if(null===s)return;_.near=w.near=T.near=e.near,_.far=w.far=T.far=e.far,M===_.near&&O===_.far||(s.updateRenderState({depthNear:_.near,depthFar:_.far}),M=_.near,O=_.far);const t=e.parent,i=_.cameras;I(_,t);for(let e=0;e<i.length;e++)I(i[e],t);_.matrixWorld.decompose(_.position,_.quaternion,_.scale),e.position.copy(_.position),e.quaternion.copy(_.quaternion),e.scale.copy(_.scale),e.matrix.copy(_.matrix),e.matrixWorld.copy(_.matrixWorld);const n=e.children;for(let e=0,t=n.length;e<t;e++)n[e].updateMatrixWorld(!0);2===i.length?function(e,t,i){D.setFromMatrixPosition(t.matrixWorld),N.setFromMatrixPosition(i.matrixWorld);const n=D.distanceTo(N),s=t.projectionMatrix.elements,r=i.projectionMatrix.elements,o=s[14]/(s[10]-1),a=s[14]/(s[10]+1),l=(s[9]+1)/s[5],c=(s[9]-1)/s[5],d=(s[8]-1)/s[0],h=(r[8]+1)/r[0],u=o*d,p=o*h,m=n/(-d+h),f=m*-d;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(f),e.translateZ(m),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();const g=o+m,v=a+m,y=u-f,b=p+(n-f),S=l*a/v*g,E=c*a/v*g;e.projectionMatrix.makePerspective(y,b,S,E,g,v)}(_,T,w):_.projectionMatrix.copy(T.projectionMatrix)},this.getCamera=function(){return _},this.getFoveation=function(){return null!==h?h.fixedFoveation:null!==u?u.fixedFoveation:void 0},this.setFoveation=function(e){null!==h&&(h.fixedFoveation=e),null!==u&&void 0!==u.fixedFoveation&&(u.fixedFoveation=e)};let L=null;const R=new Qs;R.setAnimationLoop((function(e,i){if(l=i.getViewerPose(o),v=i,null!==l){const e=l.views;null!==u&&n.bindXRFramebuffer(u.framebuffer);let i=!1;e.length!==_.cameras.length&&(_.cameras.length=0,i=!0);for(let s=0;s<e.length;s++){const r=e[s];let o=null;if(null!==u)o=u.getViewport(r);else{const e=c.getViewSubImage(h,r);n.bindXRFramebuffer(d),void 0!==e.depthStencilTexture&&t.framebufferTexture2D(36160,y,3553,e.depthStencilTexture,0),t.framebufferTexture2D(36160,36064,3553,e.colorTexture,0),o=e.viewport}const a=x[s];a.matrix.fromArray(r.transform.matrix),a.projectionMatrix.fromArray(r.projectionMatrix),a.viewport.set(o.x,o.y,o.width,o.height),0===s&&_.matrix.copy(a.matrix),!0===i&&_.cameras.push(a)}p&&(n.bindXRFramebuffer(m),null!==b&&t.clear(b))}const r=s.inputSources;for(let e=0;e<S.length;e++){const t=S[e],n=r[e];t.update(n,i,o)}if(L&&L(e,i),p){const e=h.textureWidth,i=h.textureHeight;n.bindFramebuffer(36008,m),n.bindFramebuffer(36009,d),t.invalidateFramebuffer(36008,[y]),t.invalidateFramebuffer(36009,[y]),t.blitFramebuffer(0,0,e,i,0,0,e,i,16384,9728),t.invalidateFramebuffer(36008,[36064]),n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),n.bindFramebuffer(36160,m)}v=null})),this.setAnimationLoop=function(e){L=e},this.dispose=function(){}}}function Ma(e){function t(t,i){t.opacity.value=i.opacity,i.color&&t.diffuse.value.copy(i.color),i.emissive&&t.emissive.value.copy(i.emissive).multiplyScalar(i.emissiveIntensity),i.map&&(t.map.value=i.map),i.alphaMap&&(t.alphaMap.value=i.alphaMap),i.specularMap&&(t.specularMap.value=i.specularMap),i.alphaTest>0&&(t.alphaTest.value=i.alphaTest);const n=e.get(i).envMap;if(n){t.envMap.value=n,t.flipEnvMap.value=n.isCubeTexture&&!1===n.isRenderTargetTexture?-1:1,t.reflectivity.value=i.reflectivity,t.ior.value=i.ior,t.refractionRatio.value=i.refractionRatio;const s=e.get(n).__maxMipLevel;void 0!==s&&(t.maxMipLevel.value=s)}let s,r;i.lightMap&&(t.lightMap.value=i.lightMap,t.lightMapIntensity.value=i.lightMapIntensity),i.aoMap&&(t.aoMap.value=i.aoMap,t.aoMapIntensity.value=i.aoMapIntensity),i.map?s=i.map:i.specularMap?s=i.specularMap:i.displacementMap?s=i.displacementMap:i.normalMap?s=i.normalMap:i.bumpMap?s=i.bumpMap:i.roughnessMap?s=i.roughnessMap:i.metalnessMap?s=i.metalnessMap:i.alphaMap?s=i.alphaMap:i.emissiveMap?s=i.emissiveMap:i.clearcoatMap?s=i.clearcoatMap:i.clearcoatNormalMap?s=i.clearcoatNormalMap:i.clearcoatRoughnessMap?s=i.clearcoatRoughnessMap:i.specularIntensityMap?s=i.specularIntensityMap:i.specularColorMap?s=i.specularColorMap:i.transmissionMap?s=i.transmissionMap:i.thicknessMap?s=i.thicknessMap:i.sheenColorMap?s=i.sheenColorMap:i.sheenRoughnessMap&&(s=i.sheenRoughnessMap),void 0!==s&&(s.isWebGLRenderTarget&&(s=s.texture),!0===s.matrixAutoUpdate&&s.updateMatrix(),t.uvTransform.value.copy(s.matrix)),i.aoMap?r=i.aoMap:i.lightMap&&(r=i.lightMap),void 0!==r&&(r.isWebGLRenderTarget&&(r=r.texture),!0===r.matrixAutoUpdate&&r.updateMatrix(),t.uv2Transform.value.copy(r.matrix))}function i(t,i){t.roughness.value=i.roughness,t.metalness.value=i.metalness,i.roughnessMap&&(t.roughnessMap.value=i.roughnessMap),i.metalnessMap&&(t.metalnessMap.value=i.metalnessMap),i.emissiveMap&&(t.emissiveMap.value=i.emissiveMap),i.bumpMap&&(t.bumpMap.value=i.bumpMap,t.bumpScale.value=i.bumpScale,i.side===f&&(t.bumpScale.value*=-1)),i.normalMap&&(t.normalMap.value=i.normalMap,t.normalScale.value.copy(i.normalScale),i.side===f&&t.normalScale.value.negate()),i.displacementMap&&(t.displacementMap.value=i.displacementMap,t.displacementScale.value=i.displacementScale,t.displacementBias.value=i.displacementBias);e.get(i).envMap&&(t.envMapIntensity.value=i.envMapIntensity)}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,n,s,r,o){n.isMeshBasicMaterial?t(e,n):n.isMeshLambertMaterial?(t(e,n),function(e,t){t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap)}(e,n)):n.isMeshToonMaterial?(t(e,n),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap);t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshPhongMaterial?(t(e,n),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4),t.emissiveMap&&(e.emissiveMap.value=t.emissiveMap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshStandardMaterial?(t(e,n),n.isMeshPhysicalMaterial?function(e,t,n){i(e,t),e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===f&&e.clearcoatNormalScale.value.negate()));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,n,o):i(e,n)):n.isMeshMatcapMaterial?(t(e,n),function(e,t){t.matcap&&(e.matcap.value=t.matcap);t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDepthMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isMeshDistanceMaterial?(t(e,n),function(e,t){t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias);e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,n)):n.isMeshNormalMaterial?(t(e,n),function(e,t){t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale,t.side===f&&(e.bumpScale.value*=-1));t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale),t.side===f&&e.normalScale.value.negate());t.displacementMap&&(e.displacementMap.value=t.displacementMap,e.displacementScale.value=t.displacementScale,e.displacementBias.value=t.displacementBias)}(e,n)):n.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,n),n.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,n)):n.isPointsMaterial?function(e,t,i,n){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*i,e.scale.value=.5*n,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let s;t.map?s=t.map:t.alphaMap&&(s=t.alphaMap);void 0!==s&&(!0===s.matrixAutoUpdate&&s.updateMatrix(),e.uvTransform.value.copy(s.matrix))}(e,n,s,r):n.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);let i;t.map?i=t.map:t.alphaMap&&(i=t.alphaMap);void 0!==i&&(!0===i.matrixAutoUpdate&&i.updateMatrix(),e.uvTransform.value.copy(i.matrix))}(e,n):n.isShadowMaterial?(e.color.value.copy(n.color),e.opacity.value=n.opacity):n.isShaderMaterial&&(n.uniformsNeedUpdate=!1)}}}function Oa(e={}){const t=void 0!==e.canvas?e.canvas:function(){const e=Qi("canvas");return e.style.display="block",e}(),i=void 0!==e.context?e.context:null,n=void 0!==e.alpha&&e.alpha,s=void 0===e.depth||e.depth,r=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,a=void 0===e.premultipliedAlpha||e.premultipliedAlpha,l=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",d=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;let h=null,u=null;const p=[],v=[];this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=$t,this.physicallyCorrectLights=!1,this.toneMapping=X,this.toneMappingExposure=1;const y=this;let b=!1,S=0,E=0,T=null,w=-1,x=null;const _=new Vector4,M=new Vector4;let O=null,A=t.width,C=t.height,P=1,D=null,N=null;const I=new Vector4(0,0,A,C),L=new Vector4(0,0,A,C);let R=!1;const k=[],U=new Frustum;let B=!1,F=!1,V=null;const H=new Matrix4,j=new Vector3,G={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function z(){return null===T?P:1}let W,K,Y,q,Z,$,Q,J,ee,te,ie,ne,se,re,oe,ae,le,ce,de,he,pe,fe,ge,ve=i;function ye(e,i){for(let n=0;n<e.length;n++){const s=e[n],r=t.getContext(s,i);if(null!==r)return r}return null}try{const e={alpha:n,depth:s,stencil:r,antialias:o,premultipliedAlpha:a,preserveDrawingBuffer:l,powerPreference:c,failIfMajorPerformanceCaveat:d};if(t.addEventListener("webglcontextlost",Ee,!1),t.addEventListener("webglcontextrestored",we,!1),null===ve){const t=["webgl2","webgl","experimental-webgl"];if(!0===y.isWebGL1Renderer&&t.shift(),ve=ye(t,e),null===ve)throw ye(t)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===ve.getShaderPrecisionFormat&&(ve.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(e){throw console.error("THREE.WebGLRenderer: "+e.message),e}function be(){W=new Dr(ve),K=new rr(ve,W,e),W.init(K),fe=new xa(ve,W,K),Y=new Ta(ve,W,K),k[0]=1029,q=new Lr(ve),Z=new da,$=new wa(ve,W,Y,Z,K,fe,q),Q=new ar(y),J=new Pr(y),ee=new Xs(ve,K),ge=new nr(ve,W,ee,K),te=new Nr(ve,ee,q,ge),ie=new Fr(ve,te,ee,q),de=new Br(ve,K,$),ae=new or(Z),ne=new ca(y,Q,J,W,K,ge,ae),se=new Ma(Z),re=new ma(Z),oe=new Sa(W,K),ce=new ir(y,Q,Y,ie,a),le=new Ea(y,ie,K),he=new sr(ve,W,q,K),pe=new Ir(ve,W,q,K),q.programs=ne.programs,y.capabilities=K,y.extensions=W,y.properties=Z,y.renderLists=re,y.shadowMap=le,y.state=Y,y.info=q}be();const Se=new WebXRManager(y,ve);function Ee(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),b=!0}function we(){console.log("THREE.WebGLRenderer: Context Restored."),b=!1;const e=q.autoReset,t=le.enabled,i=le.autoUpdate,n=le.needsUpdate,s=le.type;be(),q.autoReset=e,le.enabled=t,le.autoUpdate=i,le.needsUpdate=n,le.type=s}function _e(e){const t=e.target;t.removeEventListener("dispose",_e),function(e){(function(e){const t=Z.get(e).programs;void 0!==t&&t.forEach((function(e){ne.releaseProgram(e)}))})(e),Z.remove(e)}(t)}this.xr=Se,this.getContext=function(){return ve},this.getContextAttributes=function(){return ve.getContextAttributes()},this.forceContextLoss=function(){const e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){const e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return P},this.setPixelRatio=function(e){void 0!==e&&(P=e,this.setSize(A,C,!1))},this.getSize=function(e){return e.set(A,C)},this.setSize=function(e,i,n){Se.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(A=e,C=i,t.width=Math.floor(e*P),t.height=Math.floor(i*P),!1!==n&&(t.style.width=e+"px",t.style.height=i+"px"),this.setViewport(0,0,e,i))},this.getDrawingBufferSize=function(e){return e.set(A*P,C*P).floor()},this.setDrawingBufferSize=function(e,i,n){A=e,C=i,P=n,t.width=Math.floor(e*n),t.height=Math.floor(i*n),this.setViewport(0,0,e,i)},this.getCurrentViewport=function(e){return e.copy(_)},this.getViewport=function(e){return e.copy(I)},this.setViewport=function(e,t,i,n){e.isVector4?I.set(e.x,e.y,e.z,e.w):I.set(e,t,i,n),Y.viewport(_.copy(I).multiplyScalar(P).floor())},this.getScissor=function(e){return e.copy(L)},this.setScissor=function(e,t,i,n){e.isVector4?L.set(e.x,e.y,e.z,e.w):L.set(e,t,i,n),Y.scissor(M.copy(L).multiplyScalar(P).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){Y.setScissorTest(R=e)},this.setOpaqueSort=function(e){D=e},this.setTransparentSort=function(e){N=e},this.getClearColor=function(e){return e.copy(ce.getClearColor())},this.setClearColor=function(){ce.setClearColor.apply(ce,arguments)},this.getClearAlpha=function(){return ce.getClearAlpha()},this.setClearAlpha=function(){ce.setClearAlpha.apply(ce,arguments)},this.clear=function(e,t,i){let n=0;(void 0===e||e)&&(n|=16384),(void 0===t||t)&&(n|=256),(void 0===i||i)&&(n|=1024),ve.clear(n)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ee,!1),t.removeEventListener("webglcontextrestored",we,!1),re.dispose(),oe.dispose(),Z.dispose(),Q.dispose(),J.dispose(),ie.dispose(),ge.dispose(),Se.dispose(),Se.removeEventListener("sessionstart",Oe),Se.removeEventListener("sessionend",Ae),V&&(V.dispose(),V=null),Ce.stop()},this.renderBufferDirect=function(e,t,i,n,s,r){null===t&&(t=G);const o=s.isMesh&&s.matrixWorld.determinant()<0,a=function(e,t,i,n,s){!0!==t.isScene&&(t=G);$.resetTextureUnits();const r=t.fog,o=n.isMeshStandardMaterial?t.environment:null,a=null===T?y.outputEncoding:T.texture.encoding,l=(n.isMeshStandardMaterial?J:Q).get(n.envMap||o),c=!0===n.vertexColors&&!!i.attributes.color&&4===i.attributes.color.itemSize,d=!!n.normalMap&&!!i.attributes.tangent,h=!!i.morphAttributes.position,p=!!i.morphAttributes.normal,m=i.morphAttributes.position?i.morphAttributes.position.length:0,f=Z.get(n),g=u.state.lights;if(!0===B&&(!0===F||e!==x)){const t=e===x&&n.id===w;ae.setState(n,e,t)}let v=!1;n.version===f.__version?f.needsLights&&f.lightsStateVersion!==g.state.version||f.outputEncoding!==a||s.isInstancedMesh&&!1===f.instancing?v=!0:s.isInstancedMesh||!0!==f.instancing?s.isSkinnedMesh&&!1===f.skinning?v=!0:s.isSkinnedMesh||!0!==f.skinning?f.envMap!==l||n.fog&&f.fog!==r?v=!0:void 0===f.numClippingPlanes||f.numClippingPlanes===ae.numPlanes&&f.numIntersection===ae.numIntersection?(f.vertexAlphas!==c||f.vertexTangents!==d||f.morphTargets!==h||f.morphNormals!==p||!0===K.isWebGL2&&f.morphTargetsCount!==m)&&(v=!0):v=!0:v=!0:v=!0:(v=!0,f.__version=n.version);let b=f.currentProgram;!0===v&&(b=ke(n,t,s));let S=!1,E=!1,_=!1;const M=b.getUniforms(),O=f.uniforms;Y.useProgram(b.program)&&(S=!0,E=!0,_=!0);n.id!==w&&(w=n.id,E=!0);if(S||x!==e){if(M.setValue(ve,"projectionMatrix",e.projectionMatrix),K.logarithmicDepthBuffer&&M.setValue(ve,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),x!==e&&(x=e,E=!0,_=!0),n.isShaderMaterial||n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshStandardMaterial||n.envMap){const t=M.map.cameraPosition;void 0!==t&&t.setValue(ve,j.setFromMatrixPosition(e.matrixWorld))}(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial)&&M.setValue(ve,"isOrthographic",!0===e.isOrthographicCamera),(n.isMeshPhongMaterial||n.isMeshToonMaterial||n.isMeshLambertMaterial||n.isMeshBasicMaterial||n.isMeshStandardMaterial||n.isShaderMaterial||n.isShadowMaterial||s.isSkinnedMesh)&&M.setValue(ve,"viewMatrix",e.matrixWorldInverse)}if(s.isSkinnedMesh){M.setOptional(ve,s,"bindMatrix"),M.setOptional(ve,s,"bindMatrixInverse");const e=s.skeleton;e&&(K.floatVertexTextures?(null===e.boneTexture&&e.computeBoneTexture(),M.setValue(ve,"boneTexture",e.boneTexture,$),M.setValue(ve,"boneTextureSize",e.boneTextureSize)):M.setOptional(ve,e,"boneMatrices"))}!i||void 0===i.morphAttributes.position&&void 0===i.morphAttributes.normal||de.update(s,i,n,b);(E||f.receiveShadow!==s.receiveShadow)&&(f.receiveShadow=s.receiveShadow,M.setValue(ve,"receiveShadow",s.receiveShadow));E&&(M.setValue(ve,"toneMappingExposure",y.toneMappingExposure),f.needsLights&&(D=_,(A=O).ambientLightColor.needsUpdate=D,A.lightProbe.needsUpdate=D,A.directionalLights.needsUpdate=D,A.directionalLightShadows.needsUpdate=D,A.pointLights.needsUpdate=D,A.pointLightShadows.needsUpdate=D,A.spotLights.needsUpdate=D,A.spotLightShadows.needsUpdate=D,A.rectAreaLights.needsUpdate=D,A.hemisphereLights.needsUpdate=D),r&&n.fog&&se.refreshFogUniforms(O,r),se.refreshMaterialUniforms(O,n,P,C,V),jo.upload(ve,f.uniformsList,O,$));var A,D;n.isShaderMaterial&&!0===n.uniformsNeedUpdate&&(jo.upload(ve,f.uniformsList,O,$),n.uniformsNeedUpdate=!1);n.isSpriteMaterial&&M.setValue(ve,"center",s.center);return M.setValue(ve,"modelViewMatrix",s.modelViewMatrix),M.setValue(ve,"normalMatrix",s.normalMatrix),M.setValue(ve,"modelMatrix",s.matrixWorld),b}(e,t,i,n,s);Y.setMaterial(n,o);let l=i.index;const c=i.attributes.position;if(null===l){if(void 0===c||0===c.count)return}else if(0===l.count)return;let d,h=1;!0===n.wireframe&&(l=te.getWireframeAttribute(i),h=2),ge.setup(s,n,a,i,l);let p=he;null!==l&&(d=ee.get(l),p=pe,p.setIndex(d));const m=null!==l?l.count:c.count,f=i.drawRange.start*h,g=i.drawRange.count*h,v=null!==r?r.start*h:0,b=null!==r?r.count*h:1/0,S=Math.max(f,v),E=Math.min(m,f+g,v+b)-1,_=Math.max(0,E-S+1);if(0!==_){if(s.isMesh)!0===n.wireframe?(Y.setLineWidth(n.wireframeLinewidth*z()),p.setMode(1)):p.setMode(4);else if(s.isLine){let e=n.linewidth;void 0===e&&(e=1),Y.setLineWidth(e*z()),s.isLineSegments?p.setMode(1):s.isLineLoop?p.setMode(2):p.setMode(3)}else s.isPoints?p.setMode(0):s.isSprite&&p.setMode(4);if(s.isInstancedMesh)p.renderInstances(S,_,s.count);else if(i.isInstancedBufferGeometry){const e=Math.min(i.instanceCount,i._maxInstanceCount);p.renderInstances(S,_,e)}else p.render(S,_)}},this.compile=function(e,t){u=oe.get(e),u.init(),v.push(u),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(u.pushLight(e),e.castShadow&&u.pushShadow(e))})),u.setupLights(y.physicallyCorrectLights),e.traverse((function(t){const i=t.material;if(i)if(Array.isArray(i))for(let n=0;n<i.length;n++){ke(i[n],e,t)}else ke(i,e,t)})),v.pop(),u=null};let Me=null;function Oe(){Ce.stop()}function Ae(){Ce.start()}const Ce=new Qs;function Ne(e,t,i,n){if(!1===e.visible)return;if(e.layers.test(t.layers))if(e.isGroup)i=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)u.pushLight(e),e.castShadow&&u.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||U.intersectsSprite(e)){n&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),s=e.material;s.visible&&h.push(e,t,s,i,j.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==q.render.frame&&(e.skeleton.update(),e.skeleton.frame=q.render.frame),!e.frustumCulled||U.intersectsObject(e))){n&&j.setFromMatrixPosition(e.matrixWorld).applyMatrix4(H);const t=ie.update(e),s=e.material;if(Array.isArray(s)){const n=t.groups;for(let r=0,o=n.length;r<o;r++){const o=n[r],a=s[o.materialIndex];a&&a.visible&&h.push(e,t,a,i,j.z,o)}}else s.visible&&h.push(e,t,s,i,j.z,null)}const s=e.children;for(let e=0,r=s.length;e<r;e++)Ne(s[e],t,i,n)}function Ie(e,t,i,n){const s=e.opaque,r=e.transmissive,a=e.transparent;u.setupLightsView(i),r.length>0&&function(e,t,i){if(null===V){const e=!0===o&&!0===K.isWebGL2;V=new(e?WebGLMultisampleRenderTarget:WebGLRenderTarget)(1024,1024,{generateMipmaps:!0,type:null!==fe.convert(De)?De:xe,minFilter:Te,magFilter:me,wrapS:ue,wrapT:ue})}const n=y.getRenderTarget();y.setRenderTarget(V),y.clear();const s=y.toneMapping;y.toneMapping=X,Le(e,t,i),y.toneMapping=s,$.updateMultisampleRenderTarget(V),$.updateRenderTargetMipmap(V),y.setRenderTarget(n)}(s,t,i),n&&Y.viewport(_.copy(n)),s.length>0&&Le(s,t,i),r.length>0&&Le(r,t,i),a.length>0&&Le(a,t,i)}function Le(e,t,i){const n=!0===t.isScene?t.overrideMaterial:null;for(let s=0,r=e.length;s<r;s++){const r=e[s],o=r.object,a=r.geometry,l=null===n?r.material:n,c=r.group;o.layers.test(i.layers)&&Re(o,t,i,a,l,c)}}function Re(e,t,i,n,s,r){e.onBeforeRender(y,t,i,n,s,r),e.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),s.onBeforeRender(y,t,i,n,e,r),!0===s.transparent&&s.side===g?(s.side=f,s.needsUpdate=!0,y.renderBufferDirect(i,t,n,s,e,r),s.side=m,s.needsUpdate=!0,y.renderBufferDirect(i,t,n,s,e,r),s.side=g):y.renderBufferDirect(i,t,n,s,e,r),e.onAfterRender(y,t,i,n,s,r)}function ke(e,t,i){!0!==t.isScene&&(t=G);const n=Z.get(e),s=u.state.lights,r=u.state.shadowsArray,o=s.state.version,a=ne.getParameters(e,s.state,r,t,i),l=ne.getProgramCacheKey(a);let c=n.programs;n.environment=e.isMeshStandardMaterial?t.environment:null,n.fog=t.fog,n.envMap=(e.isMeshStandardMaterial?J:Q).get(e.envMap||n.environment),void 0===c&&(e.addEventListener("dispose",_e),c=new Map,n.programs=c);let d=c.get(l);if(void 0!==d){if(n.currentProgram===d&&n.lightsStateVersion===o)return Ue(e,a),d}else a.uniforms=ne.getUniforms(e),e.onBuild(i,a,y),e.onBeforeCompile(a,y),d=ne.acquireProgram(a,l),c.set(l,d),n.uniforms=a.uniforms;const h=n.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=ae.uniform),Ue(e,a),n.needsLights=function(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}(e),n.lightsStateVersion=o,n.needsLights&&(h.ambientLightColor.value=s.state.ambient,h.lightProbe.value=s.state.probe,h.directionalLights.value=s.state.directional,h.directionalLightShadows.value=s.state.directionalShadow,h.spotLights.value=s.state.spot,h.spotLightShadows.value=s.state.spotShadow,h.rectAreaLights.value=s.state.rectArea,h.ltc_1.value=s.state.rectAreaLTC1,h.ltc_2.value=s.state.rectAreaLTC2,h.pointLights.value=s.state.point,h.pointLightShadows.value=s.state.pointShadow,h.hemisphereLights.value=s.state.hemi,h.directionalShadowMap.value=s.state.directionalShadowMap,h.directionalShadowMatrix.value=s.state.directionalShadowMatrix,h.spotShadowMap.value=s.state.spotShadowMap,h.spotShadowMatrix.value=s.state.spotShadowMatrix,h.pointShadowMap.value=s.state.pointShadowMap,h.pointShadowMatrix.value=s.state.pointShadowMatrix);const p=d.getUniforms(),m=jo.seqWithValue(p.seq,h);return n.currentProgram=d,n.uniformsList=m,d}function Ue(e,t){const i=Z.get(e);i.outputEncoding=t.outputEncoding,i.instancing=t.instancing,i.skinning=t.skinning,i.morphTargets=t.morphTargets,i.morphNormals=t.morphNormals,i.morphTargetsCount=t.morphTargetsCount,i.numClippingPlanes=t.numClippingPlanes,i.numIntersection=t.numClipIntersection,i.vertexAlphas=t.vertexAlphas,i.vertexTangents=t.vertexTangents}Ce.setAnimationLoop((function(e){Me&&Me(e)})),"undefined"!=typeof window&&Ce.setContext(window),this.setAnimationLoop=function(e){Me=e,Se.setAnimationLoop(e),null===e?Ce.stop():Ce.start()},Se.addEventListener("sessionstart",Oe),Se.addEventListener("sessionend",Ae),this.render=function(e,t){if(void 0!==t&&!0!==t.isCamera)return void console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");if(!0===b)return;!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===Se.enabled&&!0===Se.isPresenting&&(!0===Se.cameraAutoUpdate&&Se.updateCamera(t),t=Se.getCamera()),!0===e.isScene&&e.onBeforeRender(y,e,t,T),u=oe.get(e,v.length),u.init(),v.push(u),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),U.setFromProjectionMatrix(H),F=this.localClippingEnabled,B=ae.init(this.clippingPlanes,F,t),h=re.get(e,p.length),h.init(),p.push(h),Ne(e,t,0,y.sortObjects),h.finish(),!0===y.sortObjects&&h.sort(D,N),!0===B&&ae.beginShadows();const i=u.state.shadowsArray;if(le.render(i,e,t),!0===B&&ae.endShadows(),!0===this.info.autoReset&&this.info.reset(),ce.render(h,e),u.setupLights(y.physicallyCorrectLights),t.isArrayCamera){const i=t.cameras;for(let t=0,n=i.length;t<n;t++){const n=i[t];Ie(h,e,n,n.viewport)}}else Ie(h,e,t);null!==T&&($.updateMultisampleRenderTarget(T),$.updateRenderTargetMipmap(T)),!0===e.isScene&&e.onAfterRender(y,e,t),Y.buffers.depth.setTest(!0),Y.buffers.depth.setMask(!0),Y.buffers.color.setMask(!0),Y.setPolygonOffset(!1),ge.resetDefaultState(),w=-1,x=null,v.pop(),u=v.length>0?v[v.length-1]:null,p.pop(),h=p.length>0?p[p.length-1]:null},this.getActiveCubeFace=function(){return S},this.getActiveMipmapLevel=function(){return E},this.getRenderTarget=function(){return T},this.setRenderTarget=function(e,t=0,i=0){T=e,S=t,E=i,e&&void 0===Z.get(e).__webglFramebuffer&&$.setupRenderTarget(e);let n=null,s=!1,r=!1;if(e){const i=e.texture;(i.isDataTexture3D||i.isDataTexture2DArray)&&(r=!0);const o=Z.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(n=o[t],s=!0):n=e.isWebGLMultisampleRenderTarget?Z.get(e).__webglMultisampledFramebuffer:o,_.copy(e.viewport),M.copy(e.scissor),O=e.scissorTest}else _.copy(I).multiplyScalar(P).floor(),M.copy(L).multiplyScalar(P).floor(),O=R;if(Y.bindFramebuffer(36160,n)&&K.drawBuffers){let t=!1;if(e)if(e.isWebGLMultipleRenderTargets){const i=e.texture;if(k.length!==i.length||36064!==k[0]){for(let e=0,t=i.length;e<t;e++)k[e]=36064+e;k.length=i.length,t=!0}}else 1===k.length&&36064===k[0]||(k[0]=36064,k.length=1,t=!0);else 1===k.length&&1029===k[0]||(k[0]=1029,k.length=1,t=!0);t&&(K.isWebGL2?ve.drawBuffers(k):W.get("WEBGL_draw_buffers").drawBuffersWEBGL(k))}if(Y.viewport(_),Y.scissor(M),Y.setScissorTest(O),s){const n=Z.get(e.texture);ve.framebufferTexture2D(36160,36064,34069+t,n.__webglTexture,i)}else if(r){const n=Z.get(e.texture),s=t||0;ve.framebufferTextureLayer(36160,36064,n.__webglTexture,i||0,s)}w=-1},this.readRenderTargetPixels=function(e,t,i,n,s,r,o){if(!e||!e.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let a=Z.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(a=a[o]),a){Y.bindFramebuffer(36160,a);try{const o=e.texture,a=o.format,l=o.type;if(a!==Be&&fe.convert(a)!==ve.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const c=l===De&&(W.has("EXT_color_buffer_half_float")||K.isWebGL2&&W.has("EXT_color_buffer_float"));if(!(l===xe||fe.convert(l)===ve.getParameter(35738)||l===Pe&&(K.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float"))||c))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");36053===ve.checkFramebufferStatus(36160)?t>=0&&t<=e.width-n&&i>=0&&i<=e.height-s&&ve.readPixels(t,i,n,s,fe.convert(a),fe.convert(l),r):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{const e=null!==T?Z.get(T).__webglFramebuffer:null;Y.bindFramebuffer(36160,e)}}},this.copyFramebufferToTexture=function(e,t,i=0){const n=Math.pow(2,-i),s=Math.floor(t.image.width*n),r=Math.floor(t.image.height*n);let o=fe.convert(t.format);K.isWebGL2&&(6407===o&&(o=32849),6408===o&&(o=32856)),$.setTexture2D(t,0),ve.copyTexImage2D(3553,i,o,e.x,e.y,s,r,0),Y.unbindTexture()},this.copyTextureToTexture=function(e,t,i,n=0){const s=t.image.width,r=t.image.height,o=fe.convert(i.format),a=fe.convert(i.type);$.setTexture2D(i,0),ve.pixelStorei(37440,i.flipY),ve.pixelStorei(37441,i.premultiplyAlpha),ve.pixelStorei(3317,i.unpackAlignment),t.isDataTexture?ve.texSubImage2D(3553,n,e.x,e.y,s,r,o,a,t.image.data):t.isCompressedTexture?ve.compressedTexSubImage2D(3553,n,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):ve.texSubImage2D(3553,n,e.x,e.y,o,a,t.image),0===n&&i.generateMipmaps&&ve.generateMipmap(3553),Y.unbindTexture()},this.copyTextureToTexture3D=function(e,t,i,n,s=0){if(y.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const r=e.max.x-e.min.x+1,o=e.max.y-e.min.y+1,a=e.max.z-e.min.z+1,l=fe.convert(n.format),c=fe.convert(n.type);let d;if(n.isDataTexture3D)$.setTexture3D(n,0),d=32879;else{if(!n.isDataTexture2DArray)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");$.setTexture2DArray(n,0),d=35866}ve.pixelStorei(37440,n.flipY),ve.pixelStorei(37441,n.premultiplyAlpha),ve.pixelStorei(3317,n.unpackAlignment);const h=ve.getParameter(3314),u=ve.getParameter(32878),p=ve.getParameter(3316),m=ve.getParameter(3315),f=ve.getParameter(32877),g=i.isCompressedTexture?i.mipmaps[0]:i.image;ve.pixelStorei(3314,g.width),ve.pixelStorei(32878,g.height),ve.pixelStorei(3316,e.min.x),ve.pixelStorei(3315,e.min.y),ve.pixelStorei(32877,e.min.z),i.isDataTexture||i.isDataTexture3D?ve.texSubImage3D(d,s,t.x,t.y,t.z,r,o,a,l,c,g.data):i.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),ve.compressedTexSubImage3D(d,s,t.x,t.y,t.z,r,o,a,l,g.data)):ve.texSubImage3D(d,s,t.x,t.y,t.z,r,o,a,l,c,g),ve.pixelStorei(3314,h),ve.pixelStorei(32878,u),ve.pixelStorei(3316,p),ve.pixelStorei(3315,m),ve.pixelStorei(32877,f),0===s&&n.generateMipmaps&&ve.generateMipmap(d),Y.unbindTexture()},this.initTexture=function(e){$.setTexture2D(e,0),Y.unbindTexture()},this.resetState=function(){S=0,E=0,T=null,Y.reset(),ge.reset()},"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}Oa.prototype.isWebGLRenderer=!0;class WebGL1Renderer extends Oa{}WebGL1Renderer.prototype.isWebGL1Renderer=!0;class FogExp2{constructor(e,t=25e-5){this.name="",this.color=new Color(e),this.density=t}clone(){return new FogExp2(this.color,this.density)}toJSON(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}FogExp2.prototype.isFogExp2=!0;class Fog{constructor(e,t=1,i=1e3){this.name="",this.color=new Color(e),this.near=t,this.far=i}clone(){return new Fog(this.color,this.near,this.far)}toJSON(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}Fog.prototype.isFog=!0;class Scene extends Object3D{constructor(){super(),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}Scene.prototype.isScene=!0;class InterleavedBuffer{constructor(e,t){this.array=e,this.stride=t,this.count=void 0!==e?e.length/t:0,this.usage=xi,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=Vi()}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,i){e*=this.stride,i*=t.stride;for(let n=0,s=this.stride;n<s;n++)this.array[e+n]=t.array[i+n];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Vi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),i=new this.constructor(t,this.stride);return i.setUsage(this.usage),i}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=Vi()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.prototype.slice.call(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}InterleavedBuffer.prototype.isInterleavedBuffer=!0;const Aa=new Vector3;class InterleavedBufferAttribute{constructor(e,t,i,n=!1){this.name="",this.data=e,this.itemSize=t,this.offset=i,this.normalized=!0===n}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,i=this.data.count;t<i;t++)Aa.x=this.getX(t),Aa.y=this.getY(t),Aa.z=this.getZ(t),Aa.applyMatrix4(e),this.setXYZ(t,Aa.x,Aa.y,Aa.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)Aa.x=this.getX(t),Aa.y=this.getY(t),Aa.z=this.getZ(t),Aa.applyNormalMatrix(e),this.setXYZ(t,Aa.x,Aa.y,Aa.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)Aa.x=this.getX(t),Aa.y=this.getY(t),Aa.z=this.getZ(t),Aa.transformDirection(e),this.setXYZ(t,Aa.x,Aa.y,Aa.z);return this}setX(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){return this.data.array[e*this.data.stride+this.offset]}getY(e){return this.data.array[e*this.data.stride+this.offset+1]}getZ(e){return this.data.array[e*this.data.stride+this.offset+2]}getW(e){return this.data.array[e*this.data.stride+this.offset+3]}setXY(e,t,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this}setXYZ(e,t,i,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this}setXYZW(e,t,i,n,s){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=i,this.data.array[e+2]=n,this.data.array[e+3]=s,this}clone(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return new BufferAttribute(new this.array.constructor(e),this.itemSize,this.normalized)}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new InterleavedBufferAttribute(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interlaved buffer attribute will deinterleave buffer data.");const e=[];for(let t=0;t<this.count;t++){const i=t*this.data.stride+this.offset;for(let t=0;t<this.itemSize;t++)e.push(this.data.array[i+t])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:e,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}InterleavedBufferAttribute.prototype.isInterleavedBufferAttribute=!0;class SpriteMaterial extends Material{constructor(e){super(),this.type="SpriteMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this}}let Ca;SpriteMaterial.prototype.isSpriteMaterial=!0;const Pa=new Vector3,Da=new Vector3,Na=new Vector3,Ia=new Vector2,La=new Vector2,Ra=new Matrix4,ka=new Vector3,Ua=new Vector3,Ba=new Vector3,Fa=new Vector2,Va=new Vector2,Ha=new Vector2;class Sprite extends Object3D{constructor(e){if(super(),this.type="Sprite",void 0===Ca){Ca=new BufferGeometry;const e=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),t=new InterleavedBuffer(e,5);Ca.setIndex([0,1,2,0,2,3]),Ca.setAttribute("position",new InterleavedBufferAttribute(t,3,0,!1)),Ca.setAttribute("uv",new InterleavedBufferAttribute(t,2,3,!1))}this.geometry=Ca,this.material=void 0!==e?e:new SpriteMaterial,this.center=new Vector2(.5,.5)}raycast(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Da.setFromMatrixScale(this.matrixWorld),Ra.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Na.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&Da.multiplyScalar(-Na.z);const i=this.material.rotation;let n,s;0!==i&&(s=Math.cos(i),n=Math.sin(i));const r=this.center;ja(ka.set(-.5,-.5,0),Na,r,Da,n,s),ja(Ua.set(.5,-.5,0),Na,r,Da,n,s),ja(Ba.set(.5,.5,0),Na,r,Da,n,s),Fa.set(0,0),Va.set(1,0),Ha.set(1,1);let o=e.ray.intersectTriangle(ka,Ua,Ba,!1,Pa);if(null===o&&(ja(Ua.set(-.5,.5,0),Na,r,Da,n,s),Va.set(0,1),o=e.ray.intersectTriangle(ka,Ba,Ua,!1,Pa),null===o))return;const a=e.ray.origin.distanceTo(Pa);a<e.near||a>e.far||t.push({distance:a,point:Pa.clone(),uv:Triangle.getUV(Pa,ka,Ua,Ba,Fa,Va,Ha,new Vector2),face:null,object:this})}copy(e){return super.copy(e),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}function ja(e,t,i,n,s,r){Ia.subVectors(e,i).addScalar(.5).multiply(n),void 0!==s?(La.x=r*Ia.x-s*Ia.y,La.y=s*Ia.x+r*Ia.y):La.copy(Ia),e.copy(t),e.x+=La.x,e.y+=La.y,e.applyMatrix4(Ra)}Sprite.prototype.isSprite=!0;const Ga=new Vector3,za=new Vector3;class LOD extends Object3D{constructor(){super(),this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let e=0,i=t.length;e<i;e++){const i=t[e];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0){t=Math.abs(t);const i=this.levels;let n;for(n=0;n<i.length&&!(t<i[n].distance);n++);return i.splice(n,0,{distance:t,object:e}),this.add(e),this}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let i,n;for(i=1,n=t.length;i<n&&!(e<t[i].distance);i++);return t[i-1].object}return null}raycast(e,t){if(this.levels.length>0){Ga.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(Ga);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){Ga.setFromMatrixPosition(e.matrixWorld),za.setFromMatrixPosition(this.matrixWorld);const i=Ga.distanceTo(za)/e.zoom;let n,s;for(t[0].object.visible=!0,n=1,s=t.length;n<s&&i>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<s;n++)t[n].object.visible=!1}}toJSON(e){const t=super.toJSON(e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];const i=this.levels;for(let e=0,n=i.length;e<n;e++){const n=i[e];t.object.levels.push({object:n.object.uuid,distance:n.distance})}return t}}const Wa=new Vector3,Ka=new Vector4,Ya=new Vector4,qa=new Vector3,Za=new Matrix4;class SkinnedMesh extends Mesh{constructor(e,t){super(e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new Matrix4,this.bindMatrixInverse=new Matrix4}copy(e){return super.copy(e),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}bind(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Vector4,t=this.geometry.attributes.skinWeight;for(let i=0,n=t.count;i<n;i++){e.x=t.getX(i),e.y=t.getY(i),e.z=t.getZ(i),e.w=t.getW(i);const n=1/e.manhattanLength();n!==1/0?e.multiplyScalar(n):e.set(1,0,0,0),t.setXYZW(i,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}boneTransform(e,t){const i=this.skeleton,n=this.geometry;Ka.fromBufferAttribute(n.attributes.skinIndex,e),Ya.fromBufferAttribute(n.attributes.skinWeight,e),Wa.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let e=0;e<4;e++){const n=Ya.getComponent(e);if(0!==n){const s=Ka.getComponent(e);Za.multiplyMatrices(i.bones[s].matrixWorld,i.boneInverses[s]),t.addScaledVector(qa.copy(Wa).applyMatrix4(Za),n)}}return t.applyMatrix4(this.bindMatrixInverse)}}SkinnedMesh.prototype.isSkinnedMesh=!0;class Bone extends Object3D{constructor(){super(),this.type="Bone"}}Bone.prototype.isBone=!0;class DataTexture extends Texture{constructor(e=null,t=1,i=1,n,s,r,o,a,l=me,c=me,d,h){super(null,r,o,a,l,c,n,s,d,h),this.image={data:e,width:t,height:i},this.magFilter=l,this.minFilter=c,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}}DataTexture.prototype.isDataTexture=!0;const $a=new Matrix4,Qa=new Matrix4;class Skeleton{constructor(e=[],t=[]){this.uuid=Vi(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let e=0,t=this.bones.length;e<t;e++)this.boneInverses.push(new Matrix4)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const t=new Matrix4;this.bones[e]&&t.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(t)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&t.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const t=this.bones[e];t&&(t.parent&&t.parent.isBone?(t.matrix.copy(t.parent.matrixWorld).invert(),t.matrix.multiply(t.matrixWorld)):t.matrix.copy(t.matrixWorld),t.matrix.decompose(t.position,t.quaternion,t.scale))}}update(){const e=this.bones,t=this.boneInverses,i=this.boneMatrices,n=this.boneTexture;for(let n=0,s=e.length;n<s;n++){const s=e[n]?e[n].matrixWorld:Qa;$a.multiplyMatrices(s,t[n]),$a.toArray(i,16*n)}null!==n&&(n.needsUpdate=!0)}clone(){return new Skeleton(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(4*this.bones.length);e=Wi(e),e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const i=new DataTexture(t,e,e,Be,Pe);return this.boneMatrices=t,this.boneTexture=i,this.boneTextureSize=e,this}getBoneByName(e){for(let t=0,i=this.bones.length;t<i;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let i=0,n=e.bones.length;i<n;i++){const n=e.bones[i];let s=t[n];void 0===s&&(console.warn("THREE.Skeleton: No bone found with UUID:",n),s=new Bone),this.bones.push(s),this.boneInverses.push((new Matrix4).fromArray(e.boneInverses[i]))}return this.init(),this}toJSON(){const e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,i=this.boneInverses;for(let n=0,s=t.length;n<s;n++){const s=t[n];e.bones.push(s.uuid);const r=i[n];e.boneInverses.push(r.toArray())}return e}}class InstancedBufferAttribute extends BufferAttribute{constructor(e,t,i,n=1){"number"==typeof i&&(n=i,i=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),super(e,t,i),this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}InstancedBufferAttribute.prototype.isInstancedBufferAttribute=!0;const Xa=new Matrix4,Ja=new Matrix4,el=[],tl=new Mesh;class InstancedMesh extends Mesh{constructor(e,t,i){super(e,t),this.instanceMatrix=new InstancedBufferAttribute(new Float32Array(16*i),16),this.instanceColor=null,this.count=i,this.frustumCulled=!1}copy(e){return super.copy(e),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}getColorAt(e,t){t.fromArray(this.instanceColor.array,3*e)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,16*e)}raycast(e,t){const i=this.matrixWorld,n=this.count;if(tl.geometry=this.geometry,tl.material=this.material,void 0!==tl.material)for(let s=0;s<n;s++){this.getMatrixAt(s,Xa),Ja.multiplyMatrices(i,Xa),tl.matrixWorld=Ja,tl.raycast(e,el);for(let e=0,i=el.length;e<i;e++){const i=el[e];i.instanceId=s,i.object=this,t.push(i)}el.length=0}}setColorAt(e,t){null===this.instanceColor&&(this.instanceColor=new InstancedBufferAttribute(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,16*e)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"})}}InstancedMesh.prototype.isInstancedMesh=!0;class LineBasicMaterial extends Material{constructor(e){super(),this.type="LineBasicMaterial",this.color=new Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this}}LineBasicMaterial.prototype.isLineBasicMaterial=!0;const il=new Vector3,nl=new Vector3,sl=new Matrix4,rl=new Ray,ol=new Sphere;class Line extends Object3D{constructor(e=new BufferGeometry,t=new LineBasicMaterial){super(),this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[0];for(let e=1,n=t.count;e<n;e++)il.fromBufferAttribute(t,e-1),nl.fromBufferAttribute(t,e),i[e]=i[e-1],i[e]+=il.distanceTo(nl);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.Line.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Line.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),ol.copy(i.boundingSphere),ol.applyMatrix4(n),ol.radius+=s,!1===e.ray.intersectsSphere(ol))return;sl.copy(n).invert(),rl.copy(e.ray).applyMatrix4(sl);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o,l=new Vector3,c=new Vector3,d=new Vector3,h=new Vector3,u=this.isLineSegments?2:1;if(i.isBufferGeometry){const n=i.index,s=i.attributes.position;if(null!==n){for(let i=Math.max(0,r.start),o=Math.min(n.count,r.start+r.count)-1;i<o;i+=u){const r=n.getX(i),o=n.getX(i+1);l.fromBufferAttribute(s,r),c.fromBufferAttribute(s,o);if(rl.distanceSqToSegment(l,c,h,d)>a)continue;h.applyMatrix4(this.matrixWorld);const u=e.ray.origin.distanceTo(h);u<e.near||u>e.far||t.push({distance:u,point:d.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(let i=Math.max(0,r.start),n=Math.min(s.count,r.start+r.count)-1;i<n;i+=u){l.fromBufferAttribute(s,i),c.fromBufferAttribute(s,i+1);if(rl.distanceSqToSegment(l,c,h,d)>a)continue;h.applyMatrix4(this.matrixWorld);const n=e.ray.origin.distanceTo(h);n<e.near||n>e.far||t.push({distance:n,point:d.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else i.isGeometry&&console.error("THREE.Line.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Line.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}Line.prototype.isLine=!0;const al=new Vector3,ll=new Vector3;class LineSegments extends Line{constructor(e,t){super(e,t),this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.isBufferGeometry)if(null===e.index){const t=e.attributes.position,i=[];for(let e=0,n=t.count;e<n;e+=2)al.fromBufferAttribute(t,e),ll.fromBufferAttribute(t,e+1),i[e]=0===e?0:i[e-1],i[e+1]=i[e]+al.distanceTo(ll);e.setAttribute("lineDistance",new Float32BufferAttribute(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else e.isGeometry&&console.error("THREE.LineSegments.computeLineDistances() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.");return this}}LineSegments.prototype.isLineSegments=!0;class LineLoop extends Line{constructor(e,t){super(e,t),this.type="LineLoop"}}LineLoop.prototype.isLineLoop=!0;class PointsMaterial extends Material{constructor(e){super(),this.type="PointsMaterial",this.color=new Color(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this}}PointsMaterial.prototype.isPointsMaterial=!0;const cl=new Matrix4,dl=new Ray,hl=new Sphere,ul=new Vector3;class Points extends Object3D{constructor(e=new BufferGeometry,t=new PointsMaterial){super(),this.type="Points",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e){return super.copy(e),this.material=e.material,this.geometry=e.geometry,this}raycast(e,t){const i=this.geometry,n=this.matrixWorld,s=e.params.Points.threshold,r=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),hl.copy(i.boundingSphere),hl.applyMatrix4(n),hl.radius+=s,!1===e.ray.intersectsSphere(hl))return;cl.copy(n).invert(),dl.copy(e.ray).applyMatrix4(cl);const o=s/((this.scale.x+this.scale.y+this.scale.z)/3),a=o*o;if(i.isBufferGeometry){const s=i.index,o=i.attributes.position;if(null!==s){for(let i=Math.max(0,r.start),l=Math.min(s.count,r.start+r.count);i<l;i++){const r=s.getX(i);ul.fromBufferAttribute(o,r),pl(ul,r,a,n,e,t,this)}}else{for(let i=Math.max(0,r.start),s=Math.min(o.count,r.start+r.count);i<s;i++)ul.fromBufferAttribute(o,i),pl(ul,i,a,n,e,t,this)}}else console.error("THREE.Points.raycast() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}updateMorphTargets(){const e=this.geometry;if(e.isBufferGeometry){const t=e.morphAttributes,i=Object.keys(t);if(i.length>0){const e=t[i[0]];if(void 0!==e){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let t=0,i=e.length;t<i;t++){const i=e[t].name||String(t);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=t}}}}else{const t=e.morphTargets;void 0!==t&&t.length>0&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}}}function pl(e,t,i,n,s,r,o){const a=dl.distanceSqToPoint(e);if(a<i){const i=new Vector3;dl.closestPointToPoint(e,i),i.applyMatrix4(n);const l=s.ray.origin.distanceTo(i);if(l<s.near||l>s.far)return;r.push({distance:l,distanceToRay:Math.sqrt(a),point:i,index:t,face:null,object:o})}}Points.prototype.isPoints=!0;class VideoTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l){super(e,t,i,n,s,r,o,a,l),this.format=void 0!==o?o:Ue,this.minFilter=void 0!==r?r:be,this.magFilter=void 0!==s?s:be,this.generateMipmaps=!1;const c=this;"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){c.needsUpdate=!0,e.requestVideoFrameCallback(t)}))}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}VideoTexture.prototype.isVideoTexture=!0;class CompressedTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c,d,h){super(null,r,o,a,l,c,n,s,d,h),this.image={width:t,height:i},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}CompressedTexture.prototype.isCompressedTexture=!0;class CanvasTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l){super(e,t,i,n,s,r,o,a,l),this.needsUpdate=!0}}CanvasTexture.prototype.isCanvasTexture=!0;class DepthTexture extends Texture{constructor(e,t,i,n,s,r,o,a,l,c){if((c=void 0!==c?c:je)!==je&&c!==Ge)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&c===je&&(i=Oe),void 0===i&&c===Ge&&(i=Re),super(null,n,s,r,o,a,c,i,l),this.image={width:e,height:t},this.magFilter=void 0!==o?o:me,this.minFilter=void 0!==a?a:me,this.flipY=!1,this.generateMipmaps=!1}}DepthTexture.prototype.isDepthTexture=!0;class CircleGeometry extends BufferGeometry{constructor(e=1,t=8,i=0,n=2*Math.PI){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:i,thetaLength:n},t=Math.max(3,t);const s=[],r=[],o=[],a=[],l=new Vector3,c=new Vector2;r.push(0,0,0),o.push(0,0,1),a.push(.5,.5);for(let s=0,d=3;s<=t;s++,d+=3){const h=i+s/t*n;l.x=e*Math.cos(h),l.y=e*Math.sin(h),r.push(l.x,l.y,l.z),o.push(0,0,1),c.x=(r[d]/e+1)/2,c.y=(r[d+1]/e+1)/2,a.push(c.x,c.y)}for(let e=1;e<=t;e++)s.push(e,e+1,0);this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("normal",new Float32BufferAttribute(o,3)),this.setAttribute("uv",new Float32BufferAttribute(a,2))}static fromJSON(e){return new CircleGeometry(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class CylinderGeometry extends BufferGeometry{constructor(e=1,t=1,i=1,n=8,s=1,r=!1,o=0,a=2*Math.PI){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:i,radialSegments:n,heightSegments:s,openEnded:r,thetaStart:o,thetaLength:a};const l=this;n=Math.floor(n),s=Math.floor(s);const c=[],d=[],h=[],u=[];let p=0;const m=[],f=i/2;let g=0;function v(i){const s=p,r=new Vector2,m=new Vector3;let v=0;const y=!0===i?e:t,b=!0===i?1:-1;for(let e=1;e<=n;e++)d.push(0,f*b,0),h.push(0,b,0),u.push(.5,.5),p++;const S=p;for(let e=0;e<=n;e++){const t=e/n*a+o,i=Math.cos(t),s=Math.sin(t);m.x=y*s,m.y=f*b,m.z=y*i,d.push(m.x,m.y,m.z),h.push(0,b,0),r.x=.5*i+.5,r.y=.5*s*b+.5,u.push(r.x,r.y),p++}for(let e=0;e<n;e++){const t=s+e,n=S+e;!0===i?c.push(n,n+1,t):c.push(n+1,n,t),v+=3}l.addGroup(g,v,!0===i?1:2),g+=v}!function(){const r=new Vector3,v=new Vector3;let y=0;const b=(t-e)/i;for(let l=0;l<=s;l++){const c=[],g=l/s,y=g*(t-e)+e;for(let e=0;e<=n;e++){const t=e/n,s=t*a+o,l=Math.sin(s),m=Math.cos(s);v.x=y*l,v.y=-g*i+f,v.z=y*m,d.push(v.x,v.y,v.z),r.set(l,b,m).normalize(),h.push(r.x,r.y,r.z),u.push(t,1-g),c.push(p++)}m.push(c)}for(let e=0;e<n;e++)for(let t=0;t<s;t++){const i=m[t][e],n=m[t+1][e],s=m[t+1][e+1],r=m[t][e+1];c.push(i,n,r),c.push(n,s,r),y+=6}l.addGroup(g,y,0),g+=y}(),!1===r&&(e>0&&v(!0),t>0&&v(!1)),this.setIndex(c),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}static fromJSON(e){return new CylinderGeometry(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class ConeGeometry extends CylinderGeometry{constructor(e=1,t=1,i=8,n=1,s=!1,r=0,o=2*Math.PI){super(0,e,t,i,n,s,r,o),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:i,heightSegments:n,openEnded:s,thetaStart:r,thetaLength:o}}static fromJSON(e){return new ConeGeometry(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class PolyhedronGeometry extends BufferGeometry{constructor(e=[],t=[],i=1,n=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:i,detail:n};const s=[],r=[];function o(e,t,i,n){const s=n+1,r=[];for(let n=0;n<=s;n++){r[n]=[];const o=e.clone().lerp(i,n/s),a=t.clone().lerp(i,n/s),l=s-n;for(let e=0;e<=l;e++)r[n][e]=0===e&&n===s?o:o.clone().lerp(a,e/l)}for(let e=0;e<s;e++)for(let t=0;t<2*(s-e)-1;t++){const i=Math.floor(t/2);t%2==0?(a(r[e][i+1]),a(r[e+1][i]),a(r[e][i])):(a(r[e][i+1]),a(r[e+1][i+1]),a(r[e+1][i]))}}function a(e){s.push(e.x,e.y,e.z)}function l(t,i){const n=3*t;i.x=e[n+0],i.y=e[n+1],i.z=e[n+2]}function c(e,t,i,n){n<0&&1===e.x&&(r[t]=e.x-1),0===i.x&&0===i.z&&(r[t]=n/2/Math.PI+.5)}function d(e){return Math.atan2(e.z,-e.x)}!function(e){const i=new Vector3,n=new Vector3,s=new Vector3;for(let r=0;r<t.length;r+=3)l(t[r+0],i),l(t[r+1],n),l(t[r+2],s),o(i,n,s,e)}(n),function(e){const t=new Vector3;for(let i=0;i<s.length;i+=3)t.x=s[i+0],t.y=s[i+1],t.z=s[i+2],t.normalize().multiplyScalar(e),s[i+0]=t.x,s[i+1]=t.y,s[i+2]=t.z}(i),function(){const e=new Vector3;for(let i=0;i<s.length;i+=3){e.x=s[i+0],e.y=s[i+1],e.z=s[i+2];const n=d(e)/2/Math.PI+.5,o=(t=e,Math.atan2(-t.y,Math.sqrt(t.x*t.x+t.z*t.z))/Math.PI+.5);r.push(n,1-o)}var t;(function(){const e=new Vector3,t=new Vector3,i=new Vector3,n=new Vector3,o=new Vector2,a=new Vector2,l=new Vector2;for(let h=0,u=0;h<s.length;h+=9,u+=6){e.set(s[h+0],s[h+1],s[h+2]),t.set(s[h+3],s[h+4],s[h+5]),i.set(s[h+6],s[h+7],s[h+8]),o.set(r[u+0],r[u+1]),a.set(r[u+2],r[u+3]),l.set(r[u+4],r[u+5]),n.copy(e).add(t).add(i).divideScalar(3);const p=d(n);c(o,u+0,e,p),c(a,u+2,t,p),c(l,u+4,i,p)}})(),function(){for(let e=0;e<r.length;e+=6){const t=r[e+0],i=r[e+2],n=r[e+4],s=Math.max(t,i,n),o=Math.min(t,i,n);s>.9&&o<.1&&(t<.2&&(r[e+0]+=1),i<.2&&(r[e+2]+=1),n<.2&&(r[e+4]+=1))}}()}(),this.setAttribute("position",new Float32BufferAttribute(s,3)),this.setAttribute("normal",new Float32BufferAttribute(s.slice(),3)),this.setAttribute("uv",new Float32BufferAttribute(r,2)),0===n?this.computeVertexNormals():this.normalizeNormals()}static fromJSON(e){return new PolyhedronGeometry(e.vertices,e.indices,e.radius,e.details)}}class DodecahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2,n=1/i;super([-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-n,-i,0,-n,i,0,n,-i,0,n,i,-n,-i,0,-n,i,0,n,-i,0,n,i,0,-i,0,-n,i,0,-n,-i,0,n,i,0,n],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new DodecahedronGeometry(e.radius,e.detail)}}const ml=new Vector3,fl=new Vector3,gl=new Vector3,vl=new Triangle;class EdgesGeometry extends BufferGeometry{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const i=4,n=Math.pow(10,i),s=Math.cos(ki*t),r=e.getIndex(),o=e.getAttribute("position"),a=r?r.count:o.count,l=[0,0,0],c=["a","b","c"],d=new Array(3),h={},u=[];for(let e=0;e<a;e+=3){r?(l[0]=r.getX(e),l[1]=r.getX(e+1),l[2]=r.getX(e+2)):(l[0]=e,l[1]=e+1,l[2]=e+2);const{a:t,b:i,c:a}=vl;if(t.fromBufferAttribute(o,l[0]),i.fromBufferAttribute(o,l[1]),a.fromBufferAttribute(o,l[2]),vl.getNormal(gl),d[0]=`${Math.round(t.x*n)},${Math.round(t.y*n)},${Math.round(t.z*n)}`,d[1]=`${Math.round(i.x*n)},${Math.round(i.y*n)},${Math.round(i.z*n)}`,d[2]=`${Math.round(a.x*n)},${Math.round(a.y*n)},${Math.round(a.z*n)}`,d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(let e=0;e<3;e++){const t=(e+1)%3,i=d[e],n=d[t],r=vl[c[e]],o=vl[c[t]],a=`${i}_${n}`,p=`${n}_${i}`;p in h&&h[p]?(gl.dot(h[p].normal)<=s&&(u.push(r.x,r.y,r.z),u.push(o.x,o.y,o.z)),h[p]=null):a in h||(h[a]={index0:l[e],index1:l[t],normal:gl.clone()})}}for(const e in h)if(h[e]){const{index0:t,index1:i}=h[e];ml.fromBufferAttribute(o,t),fl.fromBufferAttribute(o,i),u.push(ml.x,ml.y,ml.z),u.push(fl.x,fl.y,fl.z)}this.setAttribute("position",new Float32BufferAttribute(u,3))}}}class Curve{constructor(){this.type="Curve",this.arcLengthDivisions=200}getPoint(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}getPointAt(e,t){const i=this.getUtoTmapping(e);return this.getPoint(i,t)}getPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return t}getSpacedPoints(e=5){const t=[];for(let i=0;i<=e;i++)t.push(this.getPointAt(i/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let i,n=this.getPoint(0),s=0;t.push(0);for(let r=1;r<=e;r++)i=this.getPoint(r/e),s+=i.distanceTo(n),t.push(s),n=i;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t){const i=this.getLengths();let n=0;const s=i.length;let r;r=t||e*i[s-1];let o,a=0,l=s-1;for(;a<=l;)if(n=Math.floor(a+(l-a)/2),o=i[n]-r,o<0)a=n+1;else{if(!(o>0)){l=n;break}l=n-1}if(n=l,i[n]===r)return n/(s-1);const c=i[n];return(n+(r-c)/(i[n+1]-c))/(s-1)}getTangent(e,t){const i=1e-4;let n=e-i,s=e+i;n<0&&(n=0),s>1&&(s=1);const r=this.getPoint(n),o=this.getPoint(s),a=t||(r.isVector2?new Vector2:new Vector3);return a.copy(o).sub(r).normalize(),a}getTangentAt(e,t){const i=this.getUtoTmapping(e);return this.getTangent(i,t)}computeFrenetFrames(e,t){const i=new Vector3,n=[],s=[],r=[],o=new Vector3,a=new Matrix4;for(let t=0;t<=e;t++){const i=t/e;n[t]=this.getTangentAt(i,new Vector3)}s[0]=new Vector3,r[0]=new Vector3;let l=Number.MAX_VALUE;const c=Math.abs(n[0].x),d=Math.abs(n[0].y),h=Math.abs(n[0].z);c<=l&&(l=c,i.set(1,0,0)),d<=l&&(l=d,i.set(0,1,0)),h<=l&&i.set(0,0,1),o.crossVectors(n[0],i).normalize(),s[0].crossVectors(n[0],o),r[0].crossVectors(n[0],s[0]);for(let t=1;t<=e;t++){if(s[t]=s[t-1].clone(),r[t]=r[t-1].clone(),o.crossVectors(n[t-1],n[t]),o.length()>Number.EPSILON){o.normalize();const e=Math.acos(Hi(n[t-1].dot(n[t]),-1,1));s[t].applyMatrix4(a.makeRotationAxis(o,e))}r[t].crossVectors(n[t],s[t])}if(!0===t){let t=Math.acos(Hi(s[0].dot(s[e]),-1,1));t/=e,n[0].dot(o.crossVectors(s[0],s[e]))>0&&(t=-t);for(let i=1;i<=e;i++)s[i].applyMatrix4(a.makeRotationAxis(n[i],t*i)),r[i].crossVectors(n[i],s[i])}return{tangents:n,normals:s,binormals:r}}clone(){return(new this.constructor).copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class EllipseCurve extends Curve{constructor(e=0,t=0,i=1,n=1,s=0,r=2*Math.PI,o=!1,a=0){super(),this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=s,this.aEndAngle=r,this.aClockwise=o,this.aRotation=a}getPoint(e,t){const i=t||new Vector2,n=2*Math.PI;let s=this.aEndAngle-this.aStartAngle;const r=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=n;for(;s>n;)s-=n;s<Number.EPSILON&&(s=r?0:n),!0!==this.aClockwise||r||(s===n?s=-n:s-=n);const o=this.aStartAngle+e*s;let a=this.aX+this.xRadius*Math.cos(o),l=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){const e=Math.cos(this.aRotation),t=Math.sin(this.aRotation),i=a-this.aX,n=l-this.aY;a=i*e-n*t+this.aX,l=i*t+n*e+this.aY}return i.set(a,l)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}EllipseCurve.prototype.isEllipseCurve=!0;class ArcCurve extends EllipseCurve{constructor(e,t,i,n,s,r){super(e,t,i,i,n,s,r),this.type="ArcCurve"}}function yl(){let e=0,t=0,i=0,n=0;function s(s,r,o,a){e=s,t=o,i=-3*s+3*r-2*o-a,n=2*s-2*r+o+a}return{initCatmullRom:function(e,t,i,n,r){s(t,i,r*(i-e),r*(n-t))},initNonuniformCatmullRom:function(e,t,i,n,r,o,a){let l=(t-e)/r-(i-e)/(r+o)+(i-t)/o,c=(i-t)/o-(n-t)/(o+a)+(n-i)/a;l*=o,c*=o,s(t,i,l,c)},calc:function(s){const r=s*s;return e+t*s+i*r+n*(r*s)}}}ArcCurve.prototype.isArcCurve=!0;const bl=new Vector3,Sl=new yl,El=new yl,Tl=new yl;class CatmullRomCurve3 extends Curve{constructor(e=[],t=!1,i="centripetal",n=.5){super(),this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=i,this.tension=n}getPoint(e,t=new Vector3){const i=t,n=this.points,s=n.length,r=(s-(this.closed?0:1))*e;let o,a,l=Math.floor(r),c=r-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:0===c&&l===s-1&&(l=s-2,c=1),this.closed||l>0?o=n[(l-1)%s]:(bl.subVectors(n[0],n[1]).add(n[0]),o=bl);const d=n[l%s],h=n[(l+1)%s];if(this.closed||l+2<s?a=n[(l+2)%s]:(bl.subVectors(n[s-1],n[s-2]).add(n[s-1]),a=bl),"centripetal"===this.curveType||"chordal"===this.curveType){const e="chordal"===this.curveType?.5:.25;let t=Math.pow(o.distanceToSquared(d),e),i=Math.pow(d.distanceToSquared(h),e),n=Math.pow(h.distanceToSquared(a),e);i<1e-4&&(i=1),t<1e-4&&(t=i),n<1e-4&&(n=i),Sl.initNonuniformCatmullRom(o.x,d.x,h.x,a.x,t,i,n),El.initNonuniformCatmullRom(o.y,d.y,h.y,a.y,t,i,n),Tl.initNonuniformCatmullRom(o.z,d.z,h.z,a.z,t,i,n)}else"catmullrom"===this.curveType&&(Sl.initCatmullRom(o.x,d.x,h.x,a.x,this.tension),El.initCatmullRom(o.y,d.y,h.y,a.y,this.tension),Tl.initCatmullRom(o.z,d.z,h.z,a.z,this.tension));return i.set(Sl.calc(c),El.calc(c),Tl.calc(c)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Vector3).fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function wl(e,t,i,n,s){const r=.5*(n-t),o=.5*(s-i),a=e*e;return(2*i-2*n+r+o)*(e*a)+(-3*i+3*n-2*r-o)*a+r*e+i}function xl(e,t,i,n){return function(e,t){const i=1-e;return i*i*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,i)+function(e,t){return e*e*t}(e,n)}function _l(e,t,i,n,s){return function(e,t){const i=1-e;return i*i*i*t}(e,t)+function(e,t){const i=1-e;return 3*i*i*e*t}(e,i)+function(e,t){return 3*(1-e)*e*e*t}(e,n)+function(e,t){return e*e*e*t}(e,s)}CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;class CubicBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,i=new Vector2,n=new Vector2){super(),this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Vector2){const i=t,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return i.set(_l(e,n.x,s.x,r.x,o.x),_l(e,n.y,s.y,r.y,o.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve.prototype.isCubicBezierCurve=!0;class CubicBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,i=new Vector3,n=new Vector3){super(),this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=i,this.v3=n}getPoint(e,t=new Vector3){const i=t,n=this.v0,s=this.v1,r=this.v2,o=this.v3;return i.set(_l(e,n.x,s.x,r.x,o.x),_l(e,n.y,s.y,r.y,o.y),_l(e,n.z,s.z,r.z,o.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;class LineCurve extends Curve{constructor(e=new Vector2,t=new Vector2){super(),this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Vector2){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t){const i=t||new Vector2;return i.copy(this.v2).sub(this.v1).normalize(),i}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}LineCurve.prototype.isLineCurve=!0;class LineCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3){super(),this.type="LineCurve3",this.isLineCurve3=!0,this.v1=e,this.v2=t}getPoint(e,t=new Vector3){const i=t;return 1===e?i.copy(this.v2):(i.copy(this.v2).sub(this.v1),i.multiplyScalar(e).add(this.v1)),i}getPointAt(e,t){return this.getPoint(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class QuadraticBezierCurve extends Curve{constructor(e=new Vector2,t=new Vector2,i=new Vector2){super(),this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Vector2){const i=t,n=this.v0,s=this.v1,r=this.v2;return i.set(xl(e,n.x,s.x,r.x),xl(e,n.y,s.y,r.y)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;class QuadraticBezierCurve3 extends Curve{constructor(e=new Vector3,t=new Vector3,i=new Vector3){super(),this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=i}getPoint(e,t=new Vector3){const i=t,n=this.v0,s=this.v1,r=this.v2;return i.set(xl(e,n.x,s.x,r.x),xl(e,n.y,s.y,r.y),xl(e,n.z,s.z,r.z)),i}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;class SplineCurve extends Curve{constructor(e=[]){super(),this.type="SplineCurve",this.points=e}getPoint(e,t=new Vector2){const i=t,n=this.points,s=(n.length-1)*e,r=Math.floor(s),o=s-r,a=n[0===r?r:r-1],l=n[r],c=n[r>n.length-2?n.length-1:r+1],d=n[r>n.length-3?n.length-1:r+2];return i.set(wl(o,a.x,l.x,c.x,d.x),wl(o,a.y,l.y,c.y,d.y)),i}copy(e){super.copy(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,i=this.points.length;t<i;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,i=e.points.length;t<i;t++){const i=e.points[t];this.points.push((new Vector2).fromArray(i))}return this}}SplineCurve.prototype.isSplineCurve=!0;var Ml=Object.freeze({__proto__:null,ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});class CurvePath extends Curve{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new LineCurve(t,e))}getPoint(e,t){const i=e*this.getLength(),n=this.getCurveLengths();let s=0;for(;s<n.length;){if(n[s]>=i){const e=n[s]-i,r=this.curves[s],o=r.getLength(),a=0===o?0:1-e/o;return r.getPointAt(a,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let i=0,n=this.curves.length;i<n;i++)t+=this.curves[i].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let i=0;i<=e;i++)t.push(this.getPoint(i/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let i;for(let n=0,s=this.curves;n<s.length;n++){const r=s[n],o=r&&r.isEllipseCurve?2*e:r&&(r.isLineCurve||r.isLineCurve3)?1:r&&r.isSplineCurve?e*r.points.length:e,a=r.getPoints(o);for(let e=0;e<a.length;e++){const n=a[e];i&&i.equals(n)||(t.push(n),i=n)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,i=this.curves.length;t<i;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,i=e.curves.length;t<i;t++){const i=e.curves[t];this.curves.push((new Ml[i.type]).fromJSON(i))}return this}}class Path extends CurvePath{constructor(e){super(),this.type="Path",this.currentPoint=new Vector2,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,i=e.length;t<i;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const i=new LineCurve(this.currentPoint.clone(),new Vector2(e,t));return this.curves.push(i),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,i,n){const s=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,n));return this.curves.push(s),this.currentPoint.set(i,n),this}bezierCurveTo(e,t,i,n,s,r){const o=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(e,t),new Vector2(i,n),new Vector2(s,r));return this.curves.push(o),this.currentPoint.set(s,r),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),i=new SplineCurve(t);return this.curves.push(i),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,i,n,s,r){const o=this.currentPoint.x,a=this.currentPoint.y;return this.absarc(e+o,t+a,i,n,s,r),this}absarc(e,t,i,n,s,r){return this.absellipse(e,t,i,i,n,s,r),this}ellipse(e,t,i,n,s,r,o,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+l,t+c,i,n,s,r,o,a),this}absellipse(e,t,i,n,s,r,o,a){const l=new EllipseCurve(e,t,i,n,s,r,o,a);if(this.curves.length>0){const e=l.getPoint(0);e.equals(this.currentPoint)||this.lineTo(e.x,e.y)}this.curves.push(l);const c=l.getPoint(1);return this.currentPoint.copy(c),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class Shape extends Path{constructor(e){super(e),this.uuid=Vi(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let i=0,n=this.holes.length;i<n;i++)t[i]=this.holes[i].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,i=this.holes.length;t<i;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,i=e.holes.length;t<i;t++){const i=e.holes[t];this.holes.push((new Path).fromJSON(i))}return this}}const Ol=function(e,t,i=2){const n=t&&t.length,s=n?t[0]*i:e.length;let r=Al(e,0,s,i,!0);const o=[];if(!r||r.next===r.prev)return o;let a,l,c,d,h,u,p;if(n&&(r=function(e,t,i,n){const s=[];let r,o,a,l,c;for(r=0,o=t.length;r<o;r++)a=t[r]*n,l=r<o-1?t[r+1]*n:e.length,c=Al(e,a,l,n,!1),c===c.next&&(c.steiner=!0),s.push(Fl(c));for(s.sort(Rl),r=0;r<s.length;r++)kl(s[r],i),i=Cl(i,i.next);return i}(e,t,r,i)),e.length>80*i){a=c=e[0],l=d=e[1];for(let t=i;t<s;t+=i)h=e[t],u=e[t+1],h<a&&(a=h),u<l&&(l=u),h>c&&(c=h),u>d&&(d=u);p=Math.max(c-a,d-l),p=0!==p?1/p:0}return Pl(r,o,i,a,l,p),o};function Al(e,t,i,n,s){let r,o;if(s===function(e,t,i,n){let s=0;for(let r=t,o=i-n;r<i;r+=n)s+=(e[o]-e[r])*(e[r+1]+e[o+1]),o=r;return s}(e,t,i,n)>0)for(r=t;r<i;r+=n)o=Zl(r,e[r],e[r+1],o);else for(r=i-n;r>=t;r-=n)o=Zl(r,e[r],e[r+1],o);return o&&Gl(o,o.next)&&($l(o),o=o.next),o}function Cl(e,t){if(!e)return e;t||(t=e);let i,n=e;do{if(i=!1,n.steiner||!Gl(n,n.next)&&0!==jl(n.prev,n,n.next))n=n.next;else{if($l(n),n=t=n.prev,n===n.next)break;i=!0}}while(i||n!==t);return t}function Pl(e,t,i,n,s,r,o){if(!e)return;!o&&r&&function(e,t,i,n){let s=e;do{null===s.z&&(s.z=Bl(s.x,s.y,t,i,n)),s.prevZ=s.prev,s.nextZ=s.next,s=s.next}while(s!==e);s.prevZ.nextZ=null,s.prevZ=null,function(e){let t,i,n,s,r,o,a,l,c=1;do{for(i=e,e=null,r=null,o=0;i;){for(o++,n=i,a=0,t=0;t<c&&(a++,n=n.nextZ,n);t++);for(l=c;a>0||l>0&&n;)0!==a&&(0===l||!n||i.z<=n.z)?(s=i,i=i.nextZ,a--):(s=n,n=n.nextZ,l--),r?r.nextZ=s:e=s,s.prevZ=r,r=s;i=n}r.nextZ=null,c*=2}while(o>1)}(s)}(e,n,s,r);let a,l,c=e;for(;e.prev!==e.next;)if(a=e.prev,l=e.next,r?Nl(e,n,s,r):Dl(e))t.push(a.i/i),t.push(e.i/i),t.push(l.i/i),$l(e),e=l.next,c=l.next;else if((e=l)===c){o?1===o?Pl(e=Il(Cl(e),t,i),t,i,n,s,r,2):2===o&&Ll(e,t,i,n,s,r):Pl(Cl(e),t,i,n,s,r,1);break}}function Dl(e){const t=e.prev,i=e,n=e.next;if(jl(t,i,n)>=0)return!1;let s=e.next.next;for(;s!==e.prev;){if(Vl(t.x,t.y,i.x,i.y,n.x,n.y,s.x,s.y)&&jl(s.prev,s,s.next)>=0)return!1;s=s.next}return!0}function Nl(e,t,i,n){const s=e.prev,r=e,o=e.next;if(jl(s,r,o)>=0)return!1;const a=s.x<r.x?s.x<o.x?s.x:o.x:r.x<o.x?r.x:o.x,l=s.y<r.y?s.y<o.y?s.y:o.y:r.y<o.y?r.y:o.y,c=s.x>r.x?s.x>o.x?s.x:o.x:r.x>o.x?r.x:o.x,d=s.y>r.y?s.y>o.y?s.y:o.y:r.y>o.y?r.y:o.y,h=Bl(a,l,t,i,n),u=Bl(c,d,t,i,n);let p=e.prevZ,m=e.nextZ;for(;p&&p.z>=h&&m&&m.z<=u;){if(p!==e.prev&&p!==e.next&&Vl(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&jl(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,m!==e.prev&&m!==e.next&&Vl(s.x,s.y,r.x,r.y,o.x,o.y,m.x,m.y)&&jl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}for(;p&&p.z>=h;){if(p!==e.prev&&p!==e.next&&Vl(s.x,s.y,r.x,r.y,o.x,o.y,p.x,p.y)&&jl(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;m&&m.z<=u;){if(m!==e.prev&&m!==e.next&&Vl(s.x,s.y,r.x,r.y,o.x,o.y,m.x,m.y)&&jl(m.prev,m,m.next)>=0)return!1;m=m.nextZ}return!0}function Il(e,t,i){let n=e;do{const s=n.prev,r=n.next.next;!Gl(s,r)&&zl(s,n,n.next,r)&&Yl(s,r)&&Yl(r,s)&&(t.push(s.i/i),t.push(n.i/i),t.push(r.i/i),$l(n),$l(n.next),n=e=r),n=n.next}while(n!==e);return Cl(n)}function Ll(e,t,i,n,s,r){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Hl(o,e)){let a=ql(o,e);return o=Cl(o,o.next),a=Cl(a,a.next),Pl(o,t,i,n,s,r),void Pl(a,t,i,n,s,r)}e=e.next}o=o.next}while(o!==e)}function Rl(e,t){return e.x-t.x}function kl(e,t){if(t=function(e,t){let i=t;const n=e.x,s=e.y;let r,o=-1/0;do{if(s<=i.y&&s>=i.next.y&&i.next.y!==i.y){const e=i.x+(s-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(e<=n&&e>o){if(o=e,e===n){if(s===i.y)return i;if(s===i.next.y)return i.next}r=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!r)return null;if(n===o)return r;const a=r,l=r.x,c=r.y;let d,h=1/0;i=r;do{n>=i.x&&i.x>=l&&n!==i.x&&Vl(s<c?n:o,s,l,c,s<c?o:n,s,i.x,i.y)&&(d=Math.abs(s-i.y)/(n-i.x),Yl(i,e)&&(d<h||d===h&&(i.x>r.x||i.x===r.x&&Ul(r,i)))&&(r=i,h=d)),i=i.next}while(i!==a);return r}(e,t)){const i=ql(t,e);Cl(t,t.next),Cl(i,i.next)}}function Ul(e,t){return jl(e.prev,e,t.prev)<0&&jl(t.next,e,e.next)<0}function Bl(e,t,i,n,s){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)*s)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*s)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Fl(e){let t=e,i=e;do{(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next}while(t!==e);return i}function Vl(e,t,i,n,s,r,o,a){return(s-o)*(t-a)-(e-o)*(r-a)>=0&&(e-o)*(n-a)-(i-o)*(t-a)>=0&&(i-o)*(r-a)-(s-o)*(n-a)>=0}function Hl(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==t.i&&i.next.i!==t.i&&zl(i,i.next,e,t))return!0;i=i.next}while(i!==e);return!1}(e,t)&&(Yl(e,t)&&Yl(t,e)&&function(e,t){let i=e,n=!1;const s=(e.x+t.x)/2,r=(e.y+t.y)/2;do{i.y>r!=i.next.y>r&&i.next.y!==i.y&&s<(i.next.x-i.x)*(r-i.y)/(i.next.y-i.y)+i.x&&(n=!n),i=i.next}while(i!==e);return n}(e,t)&&(jl(e.prev,e,t.prev)||jl(e,t.prev,t))||Gl(e,t)&&jl(e.prev,e,e.next)>0&&jl(t.prev,t,t.next)>0)}function jl(e,t,i){return(t.y-e.y)*(i.x-t.x)-(t.x-e.x)*(i.y-t.y)}function Gl(e,t){return e.x===t.x&&e.y===t.y}function zl(e,t,i,n){const s=Kl(jl(e,t,i)),r=Kl(jl(e,t,n)),o=Kl(jl(i,n,e)),a=Kl(jl(i,n,t));return s!==r&&o!==a||(!(0!==s||!Wl(e,i,t))||(!(0!==r||!Wl(e,n,t))||(!(0!==o||!Wl(i,e,n))||!(0!==a||!Wl(i,t,n)))))}function Wl(e,t,i){return t.x<=Math.max(e.x,i.x)&&t.x>=Math.min(e.x,i.x)&&t.y<=Math.max(e.y,i.y)&&t.y>=Math.min(e.y,i.y)}function Kl(e){return e>0?1:e<0?-1:0}function Yl(e,t){return jl(e.prev,e,e.next)<0?jl(e,t,e.next)>=0&&jl(e,e.prev,t)>=0:jl(e,t,e.prev)<0||jl(e,e.next,t)<0}function ql(e,t){const i=new Ql(e.i,e.x,e.y),n=new Ql(t.i,t.x,t.y),s=e.next,r=t.prev;return e.next=t,t.prev=e,i.next=s,s.prev=i,n.next=i,i.prev=n,r.next=n,n.prev=r,n}function Zl(e,t,i,n){const s=new Ql(e,t,i);return n?(s.next=n.next,s.prev=n,n.next.prev=s,n.next=s):(s.prev=s,s.next=s),s}function $l(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Ql(e,t,i){this.i=e,this.x=t,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}class ShapeUtils{static area(e){const t=e.length;let i=0;for(let n=t-1,s=0;s<t;n=s++)i+=e[n].x*e[s].y-e[s].x*e[n].y;return.5*i}static isClockWise(e){return ShapeUtils.area(e)<0}static triangulateShape(e,t){const i=[],n=[],s=[];Xl(e),Jl(i,e);let r=e.length;t.forEach(Xl);for(let e=0;e<t.length;e++)n.push(r),r+=t[e].length,Jl(i,t[e]);const o=Ol(i,n);for(let e=0;e<o.length;e+=3)s.push(o.slice(e,e+3));return s}}function Xl(e){const t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function Jl(e,t){for(let i=0;i<t.length;i++)e.push(t[i].x),e.push(t[i].y)}class ExtrudeGeometry extends BufferGeometry{constructor(e=new Shape([new Vector2(.5,.5),new Vector2(-.5,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const i=this,n=[],s=[];for(let t=0,i=e.length;t<i;t++){r(e[t])}function r(e){const r=[],o=void 0!==t.curveSegments?t.curveSegments:12,a=void 0!==t.steps?t.steps:1;let l=void 0!==t.depth?t.depth:1,c=void 0===t.bevelEnabled||t.bevelEnabled,d=void 0!==t.bevelThickness?t.bevelThickness:.2,h=void 0!==t.bevelSize?t.bevelSize:d-.1,u=void 0!==t.bevelOffset?t.bevelOffset:0,p=void 0!==t.bevelSegments?t.bevelSegments:3;const m=t.extrudePath,f=void 0!==t.UVGenerator?t.UVGenerator:ec;void 0!==t.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),l=t.amount);let g,v,y,b,S,E=!1;m&&(g=m.getSpacedPoints(a),E=!0,c=!1,v=m.computeFrenetFrames(a,!1),y=new Vector3,b=new Vector3,S=new Vector3),c||(p=0,d=0,h=0,u=0);const T=e.extractPoints(o);let w=T.shape;const x=T.holes;if(!ShapeUtils.isClockWise(w)){w=w.reverse();for(let e=0,t=x.length;e<t;e++){const t=x[e];ShapeUtils.isClockWise(t)&&(x[e]=t.reverse())}}const _=ShapeUtils.triangulateShape(w,x),M=w;for(let e=0,t=x.length;e<t;e++){const t=x[e];w=w.concat(t)}function O(e,t,i){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(i).add(e)}const A=w.length,C=_.length;function P(e,t,i){let n,s,r;const o=e.x-t.x,a=e.y-t.y,l=i.x-e.x,c=i.y-e.y,d=o*o+a*a,h=o*c-a*l;if(Math.abs(h)>Number.EPSILON){const h=Math.sqrt(d),u=Math.sqrt(l*l+c*c),p=t.x-a/h,m=t.y+o/h,f=((i.x-c/u-p)*c-(i.y+l/u-m)*l)/(o*c-a*l);n=p+o*f-e.x,s=m+a*f-e.y;const g=n*n+s*s;if(g<=2)return new Vector2(n,s);r=Math.sqrt(g/2)}else{let e=!1;o>Number.EPSILON?l>Number.EPSILON&&(e=!0):o<-Number.EPSILON?l<-Number.EPSILON&&(e=!0):Math.sign(a)===Math.sign(c)&&(e=!0),e?(n=-a,s=o,r=Math.sqrt(d)):(n=o,s=a,r=Math.sqrt(d/2))}return new Vector2(n/r,s/r)}const D=[];for(let e=0,t=M.length,i=t-1,n=e+1;e<t;e++,i++,n++)i===t&&(i=0),n===t&&(n=0),D[e]=P(M[e],M[i],M[n]);const N=[];let I,L=D.concat();for(let e=0,t=x.length;e<t;e++){const t=x[e];I=[];for(let e=0,i=t.length,n=i-1,s=e+1;e<i;e++,n++,s++)n===i&&(n=0),s===i&&(s=0),I[e]=P(t[e],t[n],t[s]);N.push(I),L=L.concat(I)}for(let e=0;e<p;e++){const t=e/p,i=d*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+u;for(let e=0,t=M.length;e<t;e++){const t=O(M[e],D[e],n);U(t.x,t.y,-i)}for(let e=0,t=x.length;e<t;e++){const t=x[e];I=N[e];for(let e=0,s=t.length;e<s;e++){const s=O(t[e],I[e],n);U(s.x,s.y,-i)}}}const R=h+u;for(let e=0;e<A;e++){const t=c?O(w[e],L[e],R):w[e];E?(b.copy(v.normals[0]).multiplyScalar(t.x),y.copy(v.binormals[0]).multiplyScalar(t.y),S.copy(g[0]).add(b).add(y),U(S.x,S.y,S.z)):U(t.x,t.y,0)}for(let e=1;e<=a;e++)for(let t=0;t<A;t++){const i=c?O(w[t],L[t],R):w[t];E?(b.copy(v.normals[e]).multiplyScalar(i.x),y.copy(v.binormals[e]).multiplyScalar(i.y),S.copy(g[e]).add(b).add(y),U(S.x,S.y,S.z)):U(i.x,i.y,l/a*e)}for(let e=p-1;e>=0;e--){const t=e/p,i=d*Math.cos(t*Math.PI/2),n=h*Math.sin(t*Math.PI/2)+u;for(let e=0,t=M.length;e<t;e++){const t=O(M[e],D[e],n);U(t.x,t.y,l+i)}for(let e=0,t=x.length;e<t;e++){const t=x[e];I=N[e];for(let e=0,s=t.length;e<s;e++){const s=O(t[e],I[e],n);E?U(s.x,s.y+g[a-1].y,g[a-1].x+i):U(s.x,s.y,l+i)}}}function k(e,t){let i=e.length;for(;--i>=0;){const n=i;let s=i-1;s<0&&(s=e.length-1);for(let e=0,i=a+2*p;e<i;e++){const i=A*e,r=A*(e+1);F(t+n+i,t+s+i,t+s+r,t+n+r)}}}function U(e,t,i){r.push(e),r.push(t),r.push(i)}function B(e,t,s){V(e),V(t),V(s);const r=n.length/3,o=f.generateTopUV(i,n,r-3,r-2,r-1);H(o[0]),H(o[1]),H(o[2])}function F(e,t,s,r){V(e),V(t),V(r),V(t),V(s),V(r);const o=n.length/3,a=f.generateSideWallUV(i,n,o-6,o-3,o-2,o-1);H(a[0]),H(a[1]),H(a[3]),H(a[1]),H(a[2]),H(a[3])}function V(e){n.push(r[3*e+0]),n.push(r[3*e+1]),n.push(r[3*e+2])}function H(e){s.push(e.x),s.push(e.y)}!function(){const e=n.length/3;if(c){let e=0,t=A*e;for(let e=0;e<C;e++){const i=_[e];B(i[2]+t,i[1]+t,i[0]+t)}e=a+2*p,t=A*e;for(let e=0;e<C;e++){const i=_[e];B(i[0]+t,i[1]+t,i[2]+t)}}else{for(let e=0;e<C;e++){const t=_[e];B(t[2],t[1],t[0])}for(let e=0;e<C;e++){const t=_[e];B(t[0]+A*a,t[1]+A*a,t[2]+A*a)}}i.addGroup(e,n.length/3-e,0)}(),function(){const e=n.length/3;let t=0;k(M,t),t+=M.length;for(let e=0,i=x.length;e<i;e++){const i=x[e];k(i,t),t+=i.length}i.addGroup(e,n.length/3-e,1)}()}this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("uv",new Float32BufferAttribute(s,2)),this.computeVertexNormals()}toJSON(){const e=super.toJSON();return function(e,t,i){if(i.shapes=[],Array.isArray(e))for(let t=0,n=e.length;t<n;t++){const n=e[t];i.shapes.push(n.uuid)}else i.shapes.push(e.uuid);void 0!==t.extrudePath&&(i.options.extrudePath=t.extrudePath.toJSON());return i}(this.parameters.shapes,this.parameters.options,e)}static fromJSON(e,t){const i=[];for(let n=0,s=e.shapes.length;n<s;n++){const s=t[e.shapes[n]];i.push(s)}const n=e.options.extrudePath;return void 0!==n&&(e.options.extrudePath=(new Ml[n.type]).fromJSON(n)),new ExtrudeGeometry(i,e.options)}}const ec={generateTopUV:function(e,t,i,n,s){const r=t[3*i],o=t[3*i+1],a=t[3*n],l=t[3*n+1],c=t[3*s],d=t[3*s+1];return[new Vector2(r,o),new Vector2(a,l),new Vector2(c,d)]},generateSideWallUV:function(e,t,i,n,s,r){const o=t[3*i],a=t[3*i+1],l=t[3*i+2],c=t[3*n],d=t[3*n+1],h=t[3*n+2],u=t[3*s],p=t[3*s+1],m=t[3*s+2],f=t[3*r],g=t[3*r+1],v=t[3*r+2];return Math.abs(a-d)<Math.abs(o-c)?[new Vector2(o,1-l),new Vector2(c,1-h),new Vector2(u,1-m),new Vector2(f,1-v)]:[new Vector2(a,1-l),new Vector2(d,1-h),new Vector2(p,1-m),new Vector2(g,1-v)]}};class IcosahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){const i=(1+Math.sqrt(5))/2;super([-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new IcosahedronGeometry(e.radius,e.detail)}}class LatheGeometry extends BufferGeometry{constructor(e=[new Vector2(0,.5),new Vector2(.5,0),new Vector2(0,-.5)],t=12,i=0,n=2*Math.PI){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:i,phiLength:n},t=Math.floor(t),n=Hi(n,0,2*Math.PI);const s=[],r=[],o=[],a=1/t,l=new Vector3,c=new Vector2;for(let s=0;s<=t;s++){const d=i+s*a*n,h=Math.sin(d),u=Math.cos(d);for(let i=0;i<=e.length-1;i++)l.x=e[i].x*h,l.y=e[i].y,l.z=e[i].x*u,r.push(l.x,l.y,l.z),c.x=s/t,c.y=i/(e.length-1),o.push(c.x,c.y)}for(let i=0;i<t;i++)for(let t=0;t<e.length-1;t++){const n=t+i*e.length,r=n,o=n+e.length,a=n+e.length+1,l=n+1;s.push(r,o,l),s.push(o,a,l)}if(this.setIndex(s),this.setAttribute("position",new Float32BufferAttribute(r,3)),this.setAttribute("uv",new Float32BufferAttribute(o,2)),this.computeVertexNormals(),n===2*Math.PI){const i=this.attributes.normal.array,n=new Vector3,s=new Vector3,r=new Vector3,o=t*e.length*3;for(let t=0,a=0;t<e.length;t++,a+=3)n.x=i[a+0],n.y=i[a+1],n.z=i[a+2],s.x=i[o+a+0],s.y=i[o+a+1],s.z=i[o+a+2],r.addVectors(n,s).normalize(),i[a+0]=i[o+a+0]=r.x,i[a+1]=i[o+a+1]=r.y,i[a+2]=i[o+a+2]=r.z}}static fromJSON(e){return new LatheGeometry(e.points,e.segments,e.phiStart,e.phiLength)}}class OctahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new OctahedronGeometry(e.radius,e.detail)}}class RingGeometry extends BufferGeometry{constructor(e=.5,t=1,i=8,n=1,s=0,r=2*Math.PI){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:i,phiSegments:n,thetaStart:s,thetaLength:r},i=Math.max(3,i);const o=[],a=[],l=[],c=[];let d=e;const h=(t-e)/(n=Math.max(1,n)),u=new Vector3,p=new Vector2;for(let e=0;e<=n;e++){for(let e=0;e<=i;e++){const n=s+e/i*r;u.x=d*Math.cos(n),u.y=d*Math.sin(n),a.push(u.x,u.y,u.z),l.push(0,0,1),p.x=(u.x/t+1)/2,p.y=(u.y/t+1)/2,c.push(p.x,p.y)}d+=h}for(let e=0;e<n;e++){const t=e*(i+1);for(let e=0;e<i;e++){const n=e+t,s=n,r=n+i+1,a=n+i+2,l=n+1;o.push(s,r,l),o.push(r,a,l)}}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}static fromJSON(e){return new RingGeometry(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class ShapeGeometry extends BufferGeometry{constructor(e=new Shape([new Vector2(0,.5),new Vector2(-.5,-.5),new Vector2(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const i=[],n=[],s=[],r=[];let o=0,a=0;if(!1===Array.isArray(e))l(e);else for(let t=0;t<e.length;t++)l(e[t]),this.addGroup(o,a,t),o+=a,a=0;function l(e){const o=n.length/3,l=e.extractPoints(t);let c=l.shape;const d=l.holes;!1===ShapeUtils.isClockWise(c)&&(c=c.reverse());for(let e=0,t=d.length;e<t;e++){const t=d[e];!0===ShapeUtils.isClockWise(t)&&(d[e]=t.reverse())}const h=ShapeUtils.triangulateShape(c,d);for(let e=0,t=d.length;e<t;e++){const t=d[e];c=c.concat(t)}for(let e=0,t=c.length;e<t;e++){const t=c[e];n.push(t.x,t.y,0),s.push(0,0,1),r.push(t.x,t.y)}for(let e=0,t=h.length;e<t;e++){const t=h[e],n=t[0]+o,s=t[1]+o,r=t[2]+o;i.push(n,s,r),a+=3}}this.setIndex(i),this.setAttribute("position",new Float32BufferAttribute(n,3)),this.setAttribute("normal",new Float32BufferAttribute(s,3)),this.setAttribute("uv",new Float32BufferAttribute(r,2))}toJSON(){const e=super.toJSON();return function(e,t){if(t.shapes=[],Array.isArray(e))for(let i=0,n=e.length;i<n;i++){const n=e[i];t.shapes.push(n.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}static fromJSON(e,t){const i=[];for(let n=0,s=e.shapes.length;n<s;n++){const s=t[e.shapes[n]];i.push(s)}return new ShapeGeometry(i,e.curveSegments)}}class SphereGeometry extends BufferGeometry{constructor(e=1,t=32,i=16,n=0,s=2*Math.PI,r=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:n,phiLength:s,thetaStart:r,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const a=Math.min(r+o,Math.PI);let l=0;const c=[],d=new Vector3,h=new Vector3,u=[],p=[],m=[],f=[];for(let u=0;u<=i;u++){const g=[],v=u/i;let y=0;0==u&&0==r?y=.5/t:u==i&&a==Math.PI&&(y=-.5/t);for(let i=0;i<=t;i++){const a=i/t;d.x=-e*Math.cos(n+a*s)*Math.sin(r+v*o),d.y=e*Math.cos(r+v*o),d.z=e*Math.sin(n+a*s)*Math.sin(r+v*o),p.push(d.x,d.y,d.z),h.copy(d).normalize(),m.push(h.x,h.y,h.z),f.push(a+y,1-v),g.push(l++)}c.push(g)}for(let e=0;e<i;e++)for(let n=0;n<t;n++){const t=c[e][n+1],s=c[e][n],o=c[e+1][n],l=c[e+1][n+1];(0!==e||r>0)&&u.push(t,s,l),(e!==i-1||a<Math.PI)&&u.push(s,o,l)}this.setIndex(u),this.setAttribute("position",new Float32BufferAttribute(p,3)),this.setAttribute("normal",new Float32BufferAttribute(m,3)),this.setAttribute("uv",new Float32BufferAttribute(f,2))}static fromJSON(e){return new SphereGeometry(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class TetrahedronGeometry extends PolyhedronGeometry{constructor(e=1,t=0){super([1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new TetrahedronGeometry(e.radius,e.detail)}}class TorusGeometry extends BufferGeometry{constructor(e=1,t=.4,i=8,n=6,s=2*Math.PI){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:i,tubularSegments:n,arc:s},i=Math.floor(i),n=Math.floor(n);const r=[],o=[],a=[],l=[],c=new Vector3,d=new Vector3,h=new Vector3;for(let r=0;r<=i;r++)for(let u=0;u<=n;u++){const p=u/n*s,m=r/i*Math.PI*2;d.x=(e+t*Math.cos(m))*Math.cos(p),d.y=(e+t*Math.cos(m))*Math.sin(p),d.z=t*Math.sin(m),o.push(d.x,d.y,d.z),c.x=e*Math.cos(p),c.y=e*Math.sin(p),h.subVectors(d,c).normalize(),a.push(h.x,h.y,h.z),l.push(u/n),l.push(r/i)}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*e+t-1,s=(n+1)*(e-1)+t-1,o=(n+1)*(e-1)+t,a=(n+1)*e+t;r.push(i,s,a),r.push(s,o,a)}this.setIndex(r),this.setAttribute("position",new Float32BufferAttribute(o,3)),this.setAttribute("normal",new Float32BufferAttribute(a,3)),this.setAttribute("uv",new Float32BufferAttribute(l,2))}static fromJSON(e){return new TorusGeometry(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class TorusKnotGeometry extends BufferGeometry{constructor(e=1,t=.4,i=64,n=8,s=2,r=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:i,radialSegments:n,p:s,q:r},i=Math.floor(i),n=Math.floor(n);const o=[],a=[],l=[],c=[],d=new Vector3,h=new Vector3,u=new Vector3,p=new Vector3,m=new Vector3,f=new Vector3,g=new Vector3;for(let o=0;o<=i;++o){const y=o/i*s*Math.PI*2;v(y,s,r,e,u),v(y+.01,s,r,e,p),f.subVectors(p,u),g.addVectors(p,u),m.crossVectors(f,g),g.crossVectors(m,f),m.normalize(),g.normalize();for(let e=0;e<=n;++e){const s=e/n*Math.PI*2,r=-t*Math.cos(s),p=t*Math.sin(s);d.x=u.x+(r*g.x+p*m.x),d.y=u.y+(r*g.y+p*m.y),d.z=u.z+(r*g.z+p*m.z),a.push(d.x,d.y,d.z),h.subVectors(d,u).normalize(),l.push(h.x,h.y,h.z),c.push(o/i),c.push(e/n)}}for(let e=1;e<=i;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),s=(n+1)*e+(t-1),r=(n+1)*e+t,a=(n+1)*(e-1)+t;o.push(i,s,a),o.push(s,r,a)}function v(e,t,i,n,s){const r=Math.cos(e),o=Math.sin(e),a=i/t*e,l=Math.cos(a);s.x=n*(2+l)*.5*r,s.y=n*(2+l)*o*.5,s.z=n*Math.sin(a)*.5}this.setIndex(o),this.setAttribute("position",new Float32BufferAttribute(a,3)),this.setAttribute("normal",new Float32BufferAttribute(l,3)),this.setAttribute("uv",new Float32BufferAttribute(c,2))}static fromJSON(e){return new TorusKnotGeometry(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class TubeGeometry extends BufferGeometry{constructor(e=new QuadraticBezierCurve3(new Vector3(-1,-1,0),new Vector3(-1,1,0),new Vector3(1,1,0)),t=64,i=1,n=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:i,radialSegments:n,closed:s};const r=e.computeFrenetFrames(t,s);this.tangents=r.tangents,this.normals=r.normals,this.binormals=r.binormals;const o=new Vector3,a=new Vector3,l=new Vector2;let c=new Vector3;const d=[],h=[],u=[],p=[];function m(s){c=e.getPointAt(s/t,c);const l=r.normals[s],u=r.binormals[s];for(let e=0;e<=n;e++){const t=e/n*Math.PI*2,s=Math.sin(t),r=-Math.cos(t);a.x=r*l.x+s*u.x,a.y=r*l.y+s*u.y,a.z=r*l.z+s*u.z,a.normalize(),h.push(a.x,a.y,a.z),o.x=c.x+i*a.x,o.y=c.y+i*a.y,o.z=c.z+i*a.z,d.push(o.x,o.y,o.z)}}!function(){for(let e=0;e<t;e++)m(e);m(!1===s?t:0),function(){for(let e=0;e<=t;e++)for(let i=0;i<=n;i++)l.x=e/t,l.y=i/n,u.push(l.x,l.y)}(),function(){for(let e=1;e<=t;e++)for(let t=1;t<=n;t++){const i=(n+1)*(e-1)+(t-1),s=(n+1)*e+(t-1),r=(n+1)*e+t,o=(n+1)*(e-1)+t;p.push(i,s,o),p.push(s,r,o)}}()}(),this.setIndex(p),this.setAttribute("position",new Float32BufferAttribute(d,3)),this.setAttribute("normal",new Float32BufferAttribute(h,3)),this.setAttribute("uv",new Float32BufferAttribute(u,2))}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new TubeGeometry((new Ml[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class WireframeGeometry extends BufferGeometry{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},null!==e){const t=[],i=new Set,n=new Vector3,s=new Vector3;if(null!==e.index){const r=e.attributes.position,o=e.index;let a=e.groups;0===a.length&&(a=[{start:0,count:o.count,materialIndex:0}]);for(let e=0,l=a.length;e<l;++e){const l=a[e],c=l.start;for(let e=c,a=c+l.count;e<a;e+=3)for(let a=0;a<3;a++){const l=o.getX(e+a),c=o.getX(e+(a+1)%3);n.fromBufferAttribute(r,l),s.fromBufferAttribute(r,c),!0===tc(n,s,i)&&(t.push(n.x,n.y,n.z),t.push(s.x,s.y,s.z))}}}else{const r=e.attributes.position;for(let e=0,o=r.count/3;e<o;e++)for(let o=0;o<3;o++){const a=3*e+o,l=3*e+(o+1)%3;n.fromBufferAttribute(r,a),s.fromBufferAttribute(r,l),!0===tc(n,s,i)&&(t.push(n.x,n.y,n.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Float32BufferAttribute(t,3))}}}function tc(e,t,i){const n=`${e.x},${e.y},${e.z}-${t.x},${t.y},${t.z}`,s=`${t.x},${t.y},${t.z}-${e.x},${e.y},${e.z}`;return!0!==i.has(n)&&!0!==i.has(s)&&(i.add(n,s),!0)}var ic=Object.freeze({__proto__:null,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronGeometry,EdgesGeometry:EdgesGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeGeometry,WireframeGeometry:WireframeGeometry});class ShadowMaterial extends Material{constructor(e){super(),this.type="ShadowMaterial",this.color=new Color(0),this.transparent=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this}}ShadowMaterial.prototype.isShadowMaterial=!0;class MeshStandardMaterial extends Material{constructor(e){super(),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Color(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;class MeshPhysicalMaterial extends MeshStandardMaterial{constructor(e){super(),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Vector2(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return Hi(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),this.sheenColor=new Color(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=.01,this.thicknessMap=null,this.attenuationDistance=0,this.attenuationColor=new Color(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new Color(1,1,1),this.specularColorMap=null,this._sheen=0,this._clearcoat=0,this._transmission=0,this.setValues(e)}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;class MeshPhongMaterial extends Material{constructor(e){super(),this.type="MeshPhongMaterial",this.color=new Color(16777215),this.specular=new Color(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this}}MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;class MeshToonMaterial extends Material{constructor(e){super(),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Color(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MeshToonMaterial.prototype.isMeshToonMaterial=!0;class MeshNormalMaterial extends Material{constructor(e){super(),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;class MeshLambertMaterial extends Material{constructor(e){super(),this.type="MeshLambertMaterial",this.color=new Color(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Color(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Z,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this}}MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;class MeshMatcapMaterial extends Material{constructor(e){super(),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Color(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=oi,this.normalScale=new Vector2(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this}}MeshMatcapMaterial.prototype.isMeshMatcapMaterial=!0;class LineDashedMaterial extends LineBasicMaterial{constructor(e){super(),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}LineDashedMaterial.prototype.isLineDashedMaterial=!0;var nc=Object.freeze({__proto__:null,ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,MeshMatcapMaterial:MeshMatcapMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material});const sc={arraySlice:function(e,t,i){return sc.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==i?i:e.length)):e.slice(t,i)},convertArray:function(e,t,i){return!e||!i&&e.constructor===t?e:"number"==typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){const t=e.length,i=new Array(t);for(let e=0;e!==t;++e)i[e]=e;return i.sort((function(t,i){return e[t]-e[i]})),i},sortedArray:function(e,t,i){const n=e.length,s=new e.constructor(n);for(let r=0,o=0;o!==n;++r){const n=i[r]*t;for(let i=0;i!==t;++i)s[o++]=e[n+i]}return s},flattenJSON:function(e,t,i,n){let s=1,r=e[0];for(;void 0!==r&&void 0===r[n];)r=e[s++];if(void 0===r)return;let o=r[n];if(void 0!==o)if(Array.isArray(o))do{o=r[n],void 0!==o&&(t.push(r.time),i.push.apply(i,o)),r=e[s++]}while(void 0!==r);else if(void 0!==o.toArray)do{o=r[n],void 0!==o&&(t.push(r.time),o.toArray(i,i.length)),r=e[s++]}while(void 0!==r);else do{o=r[n],void 0!==o&&(t.push(r.time),i.push(o)),r=e[s++]}while(void 0!==r)},subclip:function(e,t,i,n,s=30){const r=e.clone();r.name=t;const o=[];for(let e=0;e<r.tracks.length;++e){const t=r.tracks[e],a=t.getValueSize(),l=[],c=[];for(let e=0;e<t.times.length;++e){const r=t.times[e]*s;if(!(r<i||r>=n)){l.push(t.times[e]);for(let i=0;i<a;++i)c.push(t.values[e*a+i])}}0!==l.length&&(t.times=sc.convertArray(l,t.times.constructor),t.values=sc.convertArray(c,t.values.constructor),o.push(t))}r.tracks=o;let a=1/0;for(let e=0;e<r.tracks.length;++e)a>r.tracks[e].times[0]&&(a=r.tracks[e].times[0]);for(let e=0;e<r.tracks.length;++e)r.tracks[e].shift(-1*a);return r.resetDuration(),r},makeClipAdditive:function(e,t=0,i=e,n=30){n<=0&&(n=30);const s=i.tracks.length,r=t/n;for(let t=0;t<s;++t){const n=i.tracks[t],s=n.ValueTypeName;if("bool"===s||"string"===s)continue;const o=e.tracks.find((function(e){return e.name===n.name&&e.ValueTypeName===s}));if(void 0===o)continue;let a=0;const l=n.getValueSize();n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(a=l/3);let c=0;const d=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=d/3);const h=n.times.length-1;let u;if(r<=n.times[0]){const e=a,t=l-a;u=sc.arraySlice(n.values,e,t)}else if(r>=n.times[h]){const e=h*l+a,t=e+l-a;u=sc.arraySlice(n.values,e,t)}else{const e=n.createInterpolant(),t=a,i=l-a;e.evaluate(r),u=sc.arraySlice(e.resultBuffer,t,i)}if("quaternion"===s){(new Quaternion).fromArray(u).normalize().conjugate().toArray(u)}const p=o.times.length;for(let e=0;e<p;++e){const t=e*d+c;if("quaternion"===s)Quaternion.multiplyQuaternionsFlat(o.values,t,u,0,o.values,t);else{const e=d-2*c;for(let i=0;i<e;++i)o.values[t+i]-=u[i]}}}return e.blendMode=Kt,e}};class Interpolant{constructor(e,t,i,n){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==n?n:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,n=t[i],s=t[i-1];e:{t:{let r;i:{n:if(!(e<n)){for(let r=i+2;;){if(void 0===n){if(e<s)break n;return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,e,s)}if(i===r)break;if(s=n,n=t[++i],e<n)break t}r=t.length;break i}if(e>=s)break e;{const o=t[1];e<o&&(i=2,s=o);for(let r=i-2;;){if(void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(i===r)break;if(n=s,s=t[--i-1],e>=s)break t}r=i,i=0}}for(;i<r;){const n=i+r>>>1;e<t[n]?r=n:i=n+1}if(n=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.beforeStart_(0,e,n);if(void 0===n)return i=t.length,this._cachedIndex=i,this.afterEnd_(i-1,s,e)}this._cachedIndex=i,this.intervalChanged_(i,s,n)}return this.interpolate_(i,s,e,n)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,n=this.valueSize,s=e*n;for(let e=0;e!==n;++e)t[e]=i[s+e];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}Interpolant.prototype.beforeStart_=Interpolant.prototype.copySampleValue_,Interpolant.prototype.afterEnd_=Interpolant.prototype.copySampleValue_;class CubicInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:jt,endingEnd:jt}}intervalChanged_(e,t,i){const n=this.parameterPositions;let s=e-2,r=e+1,o=n[s],a=n[r];if(void 0===o)switch(this.getSettings_().endingStart){case Gt:s=e,o=2*t-i;break;case zt:s=n.length-2,o=t+n[s]-n[s+1];break;default:s=e,o=i}if(void 0===a)switch(this.getSettings_().endingEnd){case Gt:r=e,a=2*i-t;break;case zt:r=1,a=i+n[1]-n[0];break;default:r=e-1,a=t}const l=.5*(i-t),c=this.valueSize;this._weightPrev=l/(t-o),this._weightNext=l/(a-i),this._offsetPrev=s*c,this._offsetNext=r*c}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,u=this._weightNext,p=(i-t)/(n-t),m=p*p,f=m*p,g=-h*f+2*h*m-h*p,v=(1+h)*f+(-1.5-2*h)*m+(-.5+h)*p+1,y=(-1-u)*f+(1.5+u)*m+.5*p,b=u*f-u*m;for(let e=0;e!==o;++e)s[e]=g*r[c+e]+v*r[l+e]+y*r[a+e]+b*r[d+e];return s}}class LinearInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=e*o,l=a-o,c=(i-t)/(n-t),d=1-c;for(let e=0;e!==o;++e)s[e]=r[l+e]*d+r[a+e]*c;return s}}class DiscreteInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e){return this.copySampleValue_(e-1)}}class KeyframeTrack{constructor(e,t,i,n){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=sc.convertArray(t,this.TimeBufferType),this.values=sc.convertArray(i,this.ValueBufferType),this.setInterpolation(n||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:sc.convertArray(e.times,Array),values:sc.convertArray(e.values,Array)};const t=e.getInterpolation();t!==e.DefaultInterpolation&&(i.interpolation=t)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new LinearInterpolant(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new CubicInterpolant(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case Ft:t=this.InterpolantFactoryMethodDiscrete;break;case Vt:t=this.InterpolantFactoryMethodLinear;break;case Ht:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const t="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(t);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",t),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Ft;case this.InterpolantFactoryMethodLinear:return Vt;case this.InterpolantFactoryMethodSmooth:return Ht}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,n=t.length;i!==n;++i)t[i]*=e}return this}trim(e,t){const i=this.times,n=i.length;let s=0,r=n-1;for(;s!==n&&i[s]<e;)++s;for(;-1!==r&&i[r]>t;)--r;if(++r,0!==s||r!==n){s>=r&&(r=Math.max(r,1),s=r-1);const e=this.getValueSize();this.times=sc.arraySlice(i,s,r),this.values=sc.arraySlice(this.values,s*e,r*e)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,n=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let r=null;for(let t=0;t!==s;t++){const n=i[t];if("number"==typeof n&&isNaN(n)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,t,n),e=!1;break}if(null!==r&&r>n){console.error("THREE.KeyframeTrack: Out of order keys.",this,t,n,r),e=!1;break}r=n}if(void 0!==n&&sc.isTypedArray(n))for(let t=0,i=n.length;t!==i;++t){const i=n[t];if(isNaN(i)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,t,i),e=!1;break}}return e}optimize(){const e=sc.arraySlice(this.times),t=sc.arraySlice(this.values),i=this.getValueSize(),n=this.getInterpolation()===Ht,s=e.length-1;let r=1;for(let o=1;o<s;++o){let s=!1;const a=e[o];if(a!==e[o+1]&&(1!==o||a!==e[0]))if(n)s=!0;else{const e=o*i,n=e-i,r=e+i;for(let o=0;o!==i;++o){const i=t[e+o];if(i!==t[n+o]||i!==t[r+o]){s=!0;break}}}if(s){if(o!==r){e[r]=e[o];const n=o*i,s=r*i;for(let e=0;e!==i;++e)t[s+e]=t[n+e]}++r}}if(s>0){e[r]=e[s];for(let e=s*i,n=r*i,o=0;o!==i;++o)t[n+o]=t[e+o];++r}return r!==e.length?(this.times=sc.arraySlice(e,0,r),this.values=sc.arraySlice(t,0,r*i)):(this.times=e,this.values=t),this}clone(){const e=sc.arraySlice(this.times,0),t=sc.arraySlice(this.values,0),i=new(0,this.constructor)(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}KeyframeTrack.prototype.TimeBufferType=Float32Array,KeyframeTrack.prototype.ValueBufferType=Float32Array,KeyframeTrack.prototype.DefaultInterpolation=Vt;class BooleanKeyframeTrack extends KeyframeTrack{}BooleanKeyframeTrack.prototype.ValueTypeName="bool",BooleanKeyframeTrack.prototype.ValueBufferType=Array,BooleanKeyframeTrack.prototype.DefaultInterpolation=Ft,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,BooleanKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class ColorKeyframeTrack extends KeyframeTrack{}ColorKeyframeTrack.prototype.ValueTypeName="color";class NumberKeyframeTrack extends KeyframeTrack{}NumberKeyframeTrack.prototype.ValueTypeName="number";class QuaternionLinearInterpolant extends Interpolant{constructor(e,t,i,n){super(e,t,i,n)}interpolate_(e,t,i,n){const s=this.resultBuffer,r=this.sampleValues,o=this.valueSize,a=(i-t)/(n-t);let l=e*o;for(let e=l+o;l!==e;l+=4)Quaternion.slerpFlat(s,0,r,l-o,r,l,a);return s}}class QuaternionKeyframeTrack extends KeyframeTrack{InterpolantFactoryMethodLinear(e){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),e)}}QuaternionKeyframeTrack.prototype.ValueTypeName="quaternion",QuaternionKeyframeTrack.prototype.DefaultInterpolation=Vt,QuaternionKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class StringKeyframeTrack extends KeyframeTrack{}StringKeyframeTrack.prototype.ValueTypeName="string",StringKeyframeTrack.prototype.ValueBufferType=Array,StringKeyframeTrack.prototype.DefaultInterpolation=Ft,StringKeyframeTrack.prototype.InterpolantFactoryMethodLinear=void 0,StringKeyframeTrack.prototype.InterpolantFactoryMethodSmooth=void 0;class VectorKeyframeTrack extends KeyframeTrack{}VectorKeyframeTrack.prototype.ValueTypeName="vector";class AnimationClip{constructor(e,t=-1,i,n=Wt){this.name=e,this.tracks=i,this.duration=t,this.blendMode=n,this.uuid=Vi(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],i=e.tracks,n=1/(e.fps||1);for(let e=0,s=i.length;e!==s;++e)t.push(rc(i[e]).scale(n));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],i=e.tracks,n={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let e=0,n=i.length;e!==n;++e)t.push(KeyframeTrack.toJSON(i[e]));return n}static CreateFromMorphTargetSequence(e,t,i,n){const s=t.length,r=[];for(let e=0;e<s;e++){let o=[],a=[];o.push((e+s-1)%s,e,(e+1)%s),a.push(0,1,0);const l=sc.getKeyframeOrder(o);o=sc.sortedArray(o,1,l),a=sc.sortedArray(a,1,l),n||0!==o[0]||(o.push(s),a.push(a[0])),r.push(new NumberKeyframeTrack(".morphTargetInfluences["+t[e].name+"]",o,a).scale(1/i))}return new this(e,-1,r)}static findByName(e,t){let i=e;if(!Array.isArray(e)){const t=e;i=t.geometry&&t.geometry.animations||t.animations}for(let e=0;e<i.length;e++)if(i[e].name===t)return i[e];return null}static CreateClipsFromMorphTargetSequences(e,t,i){const n={},s=/^([\w-]*?)([\d]+)$/;for(let t=0,i=e.length;t<i;t++){const i=e[t],r=i.name.match(s);if(r&&r.length>1){const e=r[1];let t=n[e];t||(n[e]=t=[]),t.push(i)}}const r=[];for(const e in n)r.push(this.CreateFromMorphTargetSequence(e,n[e],t,i));return r}static parseAnimation(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const i=function(e,t,i,n,s){if(0!==i.length){const r=[],o=[];sc.flattenJSON(i,r,o,n),0!==r.length&&s.push(new e(t,r,o))}},n=[],s=e.name||"default",r=e.fps||30,o=e.blendMode;let a=e.length||-1;const l=e.hierarchy||[];for(let e=0;e<l.length;e++){const s=l[e].keys;if(s&&0!==s.length)if(s[0].morphTargets){const e={};let t;for(t=0;t<s.length;t++)if(s[t].morphTargets)for(let i=0;i<s[t].morphTargets.length;i++)e[s[t].morphTargets[i]]=-1;for(const i in e){const e=[],r=[];for(let n=0;n!==s[t].morphTargets.length;++n){const n=s[t];e.push(n.time),r.push(n.morphTarget===i?1:0)}n.push(new NumberKeyframeTrack(".morphTargetInfluence["+i+"]",e,r))}a=e.length*(r||1)}else{const r=".bones["+t[e].name+"]";i(VectorKeyframeTrack,r+".position",s,"pos",n),i(QuaternionKeyframeTrack,r+".quaternion",s,"rot",n),i(VectorKeyframeTrack,r+".scale",s,"scl",n)}}if(0===n.length)return null;return new this(s,a,n,o)}resetDuration(){let e=0;for(let t=0,i=this.tracks.length;t!==i;++t){const i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function rc(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){const t=[],i=[];sc.flattenJSON(e.keys,t,i,"value"),e.times=t,e.values=i}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}const oc={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};class LoadingManager{constructor(e,t,i){const n=this;let s,r=!1,o=0,a=0;const l=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(e){a++,!1===r&&void 0!==n.onStart&&n.onStart(e,o,a),r=!0},this.itemEnd=function(e){o++,void 0!==n.onProgress&&n.onProgress(e,o,a),o===a&&(r=!1,void 0!==n.onLoad&&n.onLoad())},this.itemError=function(e){void 0!==n.onError&&n.onError(e)},this.resolveURL=function(e){return s?s(e):e},this.setURLModifier=function(e){return s=e,this},this.addHandler=function(e,t){return l.push(e,t),this},this.removeHandler=function(e){const t=l.indexOf(e);return-1!==t&&l.splice(t,2),this},this.getHandler=function(e){for(let t=0,i=l.length;t<i;t+=2){const i=l[t],n=l[t+1];if(i.global&&(i.lastIndex=0),i.test(e))return n}return null}}}const ac=new LoadingManager;class Loader{constructor(e){this.manager=void 0!==e?e:ac,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise((function(n,s){i.load(e,n,t,s)}))}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}const lc={};class FileLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=oc.get(e);if(void 0!==s)return this.manager.itemStart(e),setTimeout((()=>{t&&t(s),this.manager.itemEnd(e)}),0),s;if(void 0!==lc[e])return void lc[e].push({onLoad:t,onProgress:i,onError:n});lc[e]=[],lc[e].push({onLoad:t,onProgress:i,onError:n});const r=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"});fetch(r).then((t=>{if(200===t.status||0===t.status){0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received.");const i=lc[e],n=t.body.getReader(),s=t.headers.get("Content-Length"),r=s?parseInt(s):0,o=0!==r;let a=0;return new ReadableStream({start(e){!function t(){n.read().then((({done:n,value:s})=>{if(n)e.close();else{a+=s.byteLength;const n=new ProgressEvent("progress",{lengthComputable:o,loaded:a,total:r});for(let e=0,t=i.length;e<t;e++){const t=i[e];t.onProgress&&t.onProgress(n)}e.enqueue(s),t()}}))}()}})}throw Error(`fetch for "${t.url}" responded with ${t.status}: ${t.statusText}`)})).then((e=>{const t=new Response(e);switch(this.responseType){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"document":return t.text().then((e=>(new DOMParser).parseFromString(e,this.mimeType)));case"json":return t.json();default:return t.text()}})).then((t=>{oc.add(e,t);const i=lc[e];delete lc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onLoad&&n.onLoad(t)}this.manager.itemEnd(e)})).catch((t=>{const i=lc[e];delete lc[e];for(let e=0,n=i.length;e<n;e++){const n=i[e];n.onError&&n.onError(t)}this.manager.itemError(e),this.manager.itemEnd(e)})),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class AnimationLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(this.manager);r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}parse(e){const t=[];for(let i=0;i<e.length;i++){const n=AnimationClip.parse(e[i]);t.push(n)}return t}}class CompressedTextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=[],o=new CompressedTexture,a=new FileLoader(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(s.withCredentials);let l=0;function c(c){a.load(e[c],(function(e){const i=s.parse(e,!0);r[c]={width:i.width,height:i.height,format:i.format,mipmaps:i.mipmaps},l+=1,6===l&&(1===i.mipmapCount&&(o.minFilter=be),o.image=r,o.format=i.format,o.needsUpdate=!0,t&&t(o))}),i,n)}if(Array.isArray(e))for(let t=0,i=e.length;t<i;++t)c(t);else a.load(e,(function(e){const i=s.parse(e,!0);if(i.isCubemap){const e=i.mipmaps.length/i.mipmapCount;for(let t=0;t<e;t++){r[t]={mipmaps:[]};for(let e=0;e<i.mipmapCount;e++)r[t].mipmaps.push(i.mipmaps[t*i.mipmapCount+e]),r[t].format=i.format,r[t].width=i.width,r[t].height=i.height}o.image=r}else o.image.width=i.width,o.image.height=i.height,o.mipmaps=i.mipmaps;1===i.mipmapCount&&(o.minFilter=be),o.format=i.format,o.needsUpdate=!0,t&&t(o)}),i,n);return o}}class ImageLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=oc.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const o=Qi("img");function a(){c(),oc.add(e,this),t&&t(this),s.manager.itemEnd(e)}function l(t){c(),n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)}function c(){o.removeEventListener("load",a,!1),o.removeEventListener("error",l,!1)}return o.addEventListener("load",a,!1),o.addEventListener("error",l,!1),"data:"!==e.substr(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),s.manager.itemStart(e),o.src=e,o}}class CubeTextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=new CubeTexture,r=new ImageLoader(this.manager);r.setCrossOrigin(this.crossOrigin),r.setPath(this.path);let o=0;function a(i){r.load(e[i],(function(e){s.images[i]=e,o++,6===o&&(s.needsUpdate=!0,t&&t(s))}),void 0,n)}for(let t=0;t<e.length;++t)a(t);return s}}class DataTextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new DataTexture,o=new FileLoader(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(s.withCredentials),o.load(e,(function(e){const i=s.parse(e);i&&(void 0!==i.image?r.image=i.image:void 0!==i.data&&(r.image.width=i.width,r.image.height=i.height,r.image.data=i.data),r.wrapS=void 0!==i.wrapS?i.wrapS:ue,r.wrapT=void 0!==i.wrapT?i.wrapT:ue,r.magFilter=void 0!==i.magFilter?i.magFilter:be,r.minFilter=void 0!==i.minFilter?i.minFilter:be,r.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,void 0!==i.encoding&&(r.encoding=i.encoding),void 0!==i.flipY&&(r.flipY=i.flipY),void 0!==i.format&&(r.format=i.format),void 0!==i.type&&(r.type=i.type),void 0!==i.mipmaps&&(r.mipmaps=i.mipmaps,r.minFilter=Te),1===i.mipmapCount&&(r.minFilter=be),void 0!==i.generateMipmaps&&(r.generateMipmaps=i.generateMipmaps),r.needsUpdate=!0,t&&t(r,i))}),i,n),r}}class TextureLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=new Texture,r=new ImageLoader(this.manager);return r.setCrossOrigin(this.crossOrigin),r.setPath(this.path),r.load(e,(function(e){s.image=e,s.needsUpdate=!0,void 0!==t&&t(s)}),i,n),s}}class Light extends Object3D{constructor(e,t=1){super(),this.type="Light",this.color=new Color(e),this.intensity=t}dispose(){}copy(e){return super.copy(e),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}Light.prototype.isLight=!0;class HemisphereLight extends Light{constructor(e,t,i){super(e,i),this.type="HemisphereLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.groundColor=new Color(t)}copy(e){return Light.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}HemisphereLight.prototype.isHemisphereLight=!0;const cc=new Matrix4,dc=new Vector3,hc=new Vector3;class LightShadow{constructor(e){this.camera=e,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Vector2(512,512),this.map=null,this.mapPass=null,this.matrix=new Matrix4,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new Frustum,this._frameExtents=new Vector2(1,1),this._viewportCount=1,this._viewports=[new Vector4(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,i=this.matrix;dc.setFromMatrixPosition(e.matrixWorld),t.position.copy(dc),hc.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(hc),t.updateMatrixWorld(),cc.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(cc),i.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),i.multiply(t.projectionMatrix),i.multiply(t.matrixWorldInverse)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return(new this.constructor).copy(this)}toJSON(){const e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class SpotLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(50,1,.5,500)),this.focus=1}updateMatrices(e){const t=this.camera,i=2*Ui*e.angle*this.focus,n=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;i===t.fov&&n===t.aspect&&s===t.far||(t.fov=i,t.aspect=n,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}SpotLightShadow.prototype.isSpotLightShadow=!0;class SpotLight extends Light{constructor(e,t,i=0,n=Math.PI/3,s=0,r=1){super(e,t),this.type="SpotLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.distance=i,this.angle=n,this.penumbra=s,this.decay=r,this.shadow=new SpotLightShadow}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}SpotLight.prototype.isSpotLight=!0;const uc=new Matrix4,pc=new Vector3,mc=new Vector3;class PointLightShadow extends LightShadow{constructor(){super(new PerspectiveCamera(90,1,.5,500)),this._frameExtents=new Vector2(4,2),this._viewportCount=6,this._viewports=[new Vector4(2,1,1,1),new Vector4(0,1,1,1),new Vector4(3,1,1,1),new Vector4(1,1,1,1),new Vector4(3,0,1,1),new Vector4(1,0,1,1)],this._cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],this._cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)]}updateMatrices(e,t=0){const i=this.camera,n=this.matrix,s=e.distance||i.far;s!==i.far&&(i.far=s,i.updateProjectionMatrix()),pc.setFromMatrixPosition(e.matrixWorld),i.position.copy(pc),mc.copy(i.position),mc.add(this._cubeDirections[t]),i.up.copy(this._cubeUps[t]),i.lookAt(mc),i.updateMatrixWorld(),n.makeTranslation(-pc.x,-pc.y,-pc.z),uc.multiplyMatrices(i.projectionMatrix,i.matrixWorldInverse),this._frustum.setFromProjectionMatrix(uc)}}PointLightShadow.prototype.isPointLightShadow=!0;class PointLight extends Light{constructor(e,t,i=0,n=1){super(e,t),this.type="PointLight",this.distance=i,this.decay=n,this.shadow=new PointLightShadow}get power(){return 4*this.intensity*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}PointLight.prototype.isPointLight=!0;class DirectionalLightShadow extends LightShadow{constructor(){super(new OrthographicCamera(-5,5,5,-5,.5,500))}}DirectionalLightShadow.prototype.isDirectionalLightShadow=!0;class DirectionalLight extends Light{constructor(e,t){super(e,t),this.type="DirectionalLight",this.position.copy(Object3D.DefaultUp),this.updateMatrix(),this.target=new Object3D,this.shadow=new DirectionalLightShadow}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}DirectionalLight.prototype.isDirectionalLight=!0;class AmbientLight extends Light{constructor(e,t){super(e,t),this.type="AmbientLight"}}AmbientLight.prototype.isAmbientLight=!0;class RectAreaLight extends Light{constructor(e,t,i=10,n=10){super(e,t),this.type="RectAreaLight",this.width=i,this.height=n}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}RectAreaLight.prototype.isRectAreaLight=!0;class SphericalHarmonics3{constructor(){this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Vector3)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const i=e.x,n=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.282095),t.addScaledVector(r[1],.488603*n),t.addScaledVector(r[2],.488603*s),t.addScaledVector(r[3],.488603*i),t.addScaledVector(r[4],i*n*1.092548),t.addScaledVector(r[5],n*s*1.092548),t.addScaledVector(r[6],.315392*(3*s*s-1)),t.addScaledVector(r[7],i*s*1.092548),t.addScaledVector(r[8],.546274*(i*i-n*n)),t}getIrradianceAt(e,t){const i=e.x,n=e.y,s=e.z,r=this.coefficients;return t.copy(r[0]).multiplyScalar(.886227),t.addScaledVector(r[1],1.023328*n),t.addScaledVector(r[2],1.023328*s),t.addScaledVector(r[3],1.023328*i),t.addScaledVector(r[4],.858086*i*n),t.addScaledVector(r[5],.858086*n*s),t.addScaledVector(r[6],.743125*s*s-.247708),t.addScaledVector(r[7],.858086*i*s),t.addScaledVector(r[8],.429043*(i*i-n*n)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let i=0;i<9;i++)this.coefficients[i].addScaledVector(e.coefficients[i],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let i=0;i<9;i++)this.coefficients[i].lerp(e.coefficients[i],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return(new this.constructor).copy(this)}fromArray(e,t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].fromArray(e,t+3*n);return this}toArray(e=[],t=0){const i=this.coefficients;for(let n=0;n<9;n++)i[n].toArray(e,t+3*n);return e}static getBasisAt(e,t){const i=e.x,n=e.y,s=e.z;t[0]=.282095,t[1]=.488603*n,t[2]=.488603*s,t[3]=.488603*i,t[4]=1.092548*i*n,t[5]=1.092548*n*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*i*s,t[8]=.546274*(i*i-n*n)}}SphericalHarmonics3.prototype.isSphericalHarmonics3=!0;class LightProbe extends Light{constructor(e=new SphericalHarmonics3,t=1){super(void 0,t),this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}LightProbe.prototype.isLightProbe=!0;class MaterialLoader extends Loader{constructor(e){super(e),this.textures={}}load(e,t,i,n){const s=this,r=new FileLoader(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}parse(e){const t=this.textures;function i(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}const n=new nc[e.type];if(void 0!==e.uuid&&(n.uuid=e.uuid),void 0!==e.name&&(n.name=e.name),void 0!==e.color&&void 0!==n.color&&n.color.setHex(e.color),void 0!==e.roughness&&(n.roughness=e.roughness),void 0!==e.metalness&&(n.metalness=e.metalness),void 0!==e.sheen&&(n.sheen=e.sheen),void 0!==e.sheenColor&&(n.sheenColor=(new Color).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(n.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==n.emissive&&n.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==n.specular&&n.specular.setHex(e.specular),void 0!==e.specularIntensity&&(n.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==n.specularColor&&n.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(n.shininess=e.shininess),void 0!==e.clearcoat&&(n.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(n.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.transmission&&(n.transmission=e.transmission),void 0!==e.thickness&&(n.thickness=e.thickness),void 0!==e.attenuationDistance&&(n.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==n.attenuationColor&&n.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(n.fog=e.fog),void 0!==e.flatShading&&(n.flatShading=e.flatShading),void 0!==e.blending&&(n.blending=e.blending),void 0!==e.combine&&(n.combine=e.combine),void 0!==e.side&&(n.side=e.side),void 0!==e.shadowSide&&(n.shadowSide=e.shadowSide),void 0!==e.opacity&&(n.opacity=e.opacity),void 0!==e.format&&(n.format=e.format),void 0!==e.transparent&&(n.transparent=e.transparent),void 0!==e.alphaTest&&(n.alphaTest=e.alphaTest),void 0!==e.depthTest&&(n.depthTest=e.depthTest),void 0!==e.depthWrite&&(n.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(n.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(n.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(n.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(n.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(n.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(n.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(n.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(n.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(n.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(n.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(n.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(n.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(n.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(n.rotation=e.rotation),1!==e.linewidth&&(n.linewidth=e.linewidth),void 0!==e.dashSize&&(n.dashSize=e.dashSize),void 0!==e.gapSize&&(n.gapSize=e.gapSize),void 0!==e.scale&&(n.scale=e.scale),void 0!==e.polygonOffset&&(n.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(n.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(n.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(n.dithering=e.dithering),void 0!==e.alphaToCoverage&&(n.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(n.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(n.visible=e.visible),void 0!==e.toneMapped&&(n.toneMapped=e.toneMapped),void 0!==e.userData&&(n.userData=e.userData),void 0!==e.vertexColors&&("number"==typeof e.vertexColors?n.vertexColors=e.vertexColors>0:n.vertexColors=e.vertexColors),void 0!==e.uniforms)for(const t in e.uniforms){const s=e.uniforms[t];switch(n.uniforms[t]={},s.type){case"t":n.uniforms[t].value=i(s.value);break;case"c":n.uniforms[t].value=(new Color).setHex(s.value);break;case"v2":n.uniforms[t].value=(new Vector2).fromArray(s.value);break;case"v3":n.uniforms[t].value=(new Vector3).fromArray(s.value);break;case"v4":n.uniforms[t].value=(new Vector4).fromArray(s.value);break;case"m3":n.uniforms[t].value=(new Matrix3).fromArray(s.value);break;case"m4":n.uniforms[t].value=(new Matrix4).fromArray(s.value);break;default:n.uniforms[t].value=s.value}}if(void 0!==e.defines&&(n.defines=e.defines),void 0!==e.vertexShader&&(n.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(n.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(const t in e.extensions)n.extensions[t]=e.extensions[t];if(void 0!==e.shading&&(n.flatShading=1===e.shading),void 0!==e.size&&(n.size=e.size),void 0!==e.sizeAttenuation&&(n.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(n.map=i(e.map)),void 0!==e.matcap&&(n.matcap=i(e.matcap)),void 0!==e.alphaMap&&(n.alphaMap=i(e.alphaMap)),void 0!==e.bumpMap&&(n.bumpMap=i(e.bumpMap)),void 0!==e.bumpScale&&(n.bumpScale=e.bumpScale),void 0!==e.normalMap&&(n.normalMap=i(e.normalMap)),void 0!==e.normalMapType&&(n.normalMapType=e.normalMapType),void 0!==e.normalScale){let t=e.normalScale;!1===Array.isArray(t)&&(t=[t,t]),n.normalScale=(new Vector2).fromArray(t)}return void 0!==e.displacementMap&&(n.displacementMap=i(e.displacementMap)),void 0!==e.displacementScale&&(n.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(n.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(n.roughnessMap=i(e.roughnessMap)),void 0!==e.metalnessMap&&(n.metalnessMap=i(e.metalnessMap)),void 0!==e.emissiveMap&&(n.emissiveMap=i(e.emissiveMap)),void 0!==e.emissiveIntensity&&(n.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(n.specularMap=i(e.specularMap)),void 0!==e.specularIntensityMap&&(n.specularIntensityMap=i(e.specularIntensityMap)),void 0!==e.specularColorMap&&(n.specularColorMap=i(e.specularColorMap)),void 0!==e.envMap&&(n.envMap=i(e.envMap)),void 0!==e.envMapIntensity&&(n.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(n.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(n.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(n.lightMap=i(e.lightMap)),void 0!==e.lightMapIntensity&&(n.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(n.aoMap=i(e.aoMap)),void 0!==e.aoMapIntensity&&(n.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(n.gradientMap=i(e.gradientMap)),void 0!==e.clearcoatMap&&(n.clearcoatMap=i(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(n.clearcoatRoughnessMap=i(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(n.clearcoatNormalMap=i(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(n.clearcoatNormalScale=(new Vector2).fromArray(e.clearcoatNormalScale)),void 0!==e.transmissionMap&&(n.transmissionMap=i(e.transmissionMap)),void 0!==e.thicknessMap&&(n.thicknessMap=i(e.thicknessMap)),void 0!==e.sheenColorMap&&(n.sheenColorMap=i(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(n.sheenRoughnessMap=i(e.sheenRoughnessMap)),n}setTextures(e){return this.textures=e,this}}class LoaderUtils{static decodeText(e){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(e);let t="";for(let i=0,n=e.length;i<n;i++)t+=String.fromCharCode(e[i]);try{return decodeURIComponent(escape(t))}catch(e){return t}}static extractUrlBase(e){const t=e.lastIndexOf("/");return-1===t?"./":e.substr(0,t+1)}static resolveURL(e,t){return"string"!=typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class InstancedBufferGeometry extends BufferGeometry{constructor(){super(),this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}clone(){return(new this.constructor).copy(this)}toJSON(){const e=super.toJSON(this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}InstancedBufferGeometry.prototype.isInstancedBufferGeometry=!0;class BufferGeometryLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(s.manager);r.setPath(s.path),r.setRequestHeader(s.requestHeader),r.setWithCredentials(s.withCredentials),r.load(e,(function(i){try{t(s.parse(JSON.parse(i)))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}parse(e){const t={},i={};function n(e,n){if(void 0!==t[n])return t[n];const s=e.interleavedBuffers[n],r=function(e,t){if(void 0!==i[t])return i[t];const n=e.arrayBuffers[t],s=new Uint32Array(n).buffer;return i[t]=s,s}(e,s.buffer),o=$i(s.type,r),a=new InterleavedBuffer(o,s.stride);return a.uuid=s.uuid,t[n]=a,a}const s=e.isInstancedBufferGeometry?new InstancedBufferGeometry:new BufferGeometry,r=e.data.index;if(void 0!==r){const e=$i(r.type,r.array);s.setIndex(new BufferAttribute(e,1))}const o=e.data.attributes;for(const t in o){const i=o[t];let r;if(i.isInterleavedBufferAttribute){const t=n(e.data,i.data);r=new InterleavedBufferAttribute(t,i.itemSize,i.offset,i.normalized)}else{const e=$i(i.type,i.array);r=new(i.isInstancedBufferAttribute?InstancedBufferAttribute:BufferAttribute)(e,i.itemSize,i.normalized)}void 0!==i.name&&(r.name=i.name),void 0!==i.usage&&r.setUsage(i.usage),void 0!==i.updateRange&&(r.updateRange.offset=i.updateRange.offset,r.updateRange.count=i.updateRange.count),s.setAttribute(t,r)}const a=e.data.morphAttributes;if(a)for(const t in a){const i=a[t],r=[];for(let t=0,s=i.length;t<s;t++){const s=i[t];let o;if(s.isInterleavedBufferAttribute){const t=n(e.data,s.data);o=new InterleavedBufferAttribute(t,s.itemSize,s.offset,s.normalized)}else{const e=$i(s.type,s.array);o=new BufferAttribute(e,s.itemSize,s.normalized)}void 0!==s.name&&(o.name=s.name),r.push(o)}s.morphAttributes[t]=r}e.data.morphTargetsRelative&&(s.morphTargetsRelative=!0);const l=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==l)for(let e=0,t=l.length;e!==t;++e){const t=l[e];s.addGroup(t.start,t.count,t.materialIndex)}const c=e.data.boundingSphere;if(void 0!==c){const e=new Vector3;void 0!==c.center&&e.fromArray(c.center),s.boundingSphere=new Sphere(e,c.radius)}return e.name&&(s.name=e.name),e.userData&&(s.userData=e.userData),s}}class ObjectLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=""===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||r;const o=new FileLoader(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(i){let r=null;try{r=JSON.parse(i)}catch(t){return void 0!==n&&n(t),void console.error("THREE:ObjectLoader: Can't parse "+e+".",t.message)}const o=r.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?s.parse(r,t):console.error("THREE.ObjectLoader: Can't load "+e)}),i,n)}async loadAsync(e,t){const i=""===this.path?LoaderUtils.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const n=new FileLoader(this.manager);n.setPath(this.path),n.setRequestHeader(this.requestHeader),n.setWithCredentials(this.withCredentials);const s=await n.loadAsync(e,t),r=JSON.parse(s),o=r.metadata;if(void 0===o||void 0===o.type||"geometry"===o.type.toLowerCase())throw new Error("THREE.ObjectLoader: Can't load "+e);return await this.parseAsync(r)}parse(e,t){const i=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,n),r=this.parseImages(e.images,(function(){void 0!==t&&t(l)})),o=this.parseTextures(e.textures,r),a=this.parseMaterials(e.materials,o),l=this.parseObject(e.object,s,a,o,i),c=this.parseSkeletons(e.skeletons,l);if(this.bindSkeletons(l,c),void 0!==t){let e=!1;for(const t in r)if(r[t]instanceof HTMLImageElement){e=!0;break}!1===e&&t(l)}return l}async parseAsync(e){const t=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),n=this.parseGeometries(e.geometries,i),s=await this.parseImagesAsync(e.images),r=this.parseTextures(e.textures,s),o=this.parseMaterials(e.materials,r),a=this.parseObject(e.object,n,o,r,t),l=this.parseSkeletons(e.skeletons,a);return this.bindSkeletons(a,l),a}parseShapes(e){const t={};if(void 0!==e)for(let i=0,n=e.length;i<n;i++){const n=(new Shape).fromJSON(e[i]);t[n.uuid]=n}return t}parseSkeletons(e,t){const i={},n={};if(t.traverse((function(e){e.isBone&&(n[e.uuid]=e)})),void 0!==e)for(let t=0,s=e.length;t<s;t++){const s=(new Skeleton).fromJSON(e[t],n);i[s.uuid]=s}return i}parseGeometries(e,t){const i={};if(void 0!==e){const n=new BufferGeometryLoader;for(let s=0,r=e.length;s<r;s++){let r;const o=e[s];switch(o.type){case"BufferGeometry":case"InstancedBufferGeometry":r=n.parse(o);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:o.type in ic?r=ic[o.type].fromJSON(o,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${o.type}"`)}r.uuid=o.uuid,void 0!==o.name&&(r.name=o.name),!0===r.isBufferGeometry&&void 0!==o.userData&&(r.userData=o.userData),i[o.uuid]=r}}return i}parseMaterials(e,t){const i={},n={};if(void 0!==e){const s=new MaterialLoader;s.setTextures(t);for(let t=0,r=e.length;t<r;t++){const r=e[t];if("MultiMaterial"===r.type){const e=[];for(let t=0;t<r.materials.length;t++){const n=r.materials[t];void 0===i[n.uuid]&&(i[n.uuid]=s.parse(n)),e.push(i[n.uuid])}n[r.uuid]=e}else void 0===i[r.uuid]&&(i[r.uuid]=s.parse(r)),n[r.uuid]=i[r.uuid]}}return n}parseAnimations(e){const t={};if(void 0!==e)for(let i=0;i<e.length;i++){const n=e[i],s=AnimationClip.parse(n);t[s.uuid]=s}return t}parseImages(e,t){const i=this,n={};let s;function r(e){if("string"==typeof e){const t=e;return function(e){return i.manager.itemStart(e),s.load(e,(function(){i.manager.itemEnd(e)}),void 0,(function(){i.manager.itemError(e),i.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:i.resourcePath+t)}return e.data?{data:$i(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){const i=new LoadingManager(t);s=new ImageLoader(i),s.setCrossOrigin(this.crossOrigin);for(let t=0,i=e.length;t<i;t++){const i=e[t],s=i.url;if(Array.isArray(s)){n[i.uuid]=[];for(let e=0,t=s.length;e<t;e++){const t=r(s[e]);null!==t&&(t instanceof HTMLImageElement?n[i.uuid].push(t):n[i.uuid].push(new DataTexture(t.data,t.width,t.height)))}}else{const e=r(i.url);null!==e&&(n[i.uuid]=e)}}}return n}async parseImagesAsync(e){const t=this,i={};let n;async function s(e){if("string"==typeof e){const i=e,s=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(i)?i:t.resourcePath+i;return await n.loadAsync(s)}return e.data?{data:$i(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){n=new ImageLoader(this.manager),n.setCrossOrigin(this.crossOrigin);for(let t=0,n=e.length;t<n;t++){const n=e[t],r=n.url;if(Array.isArray(r)){i[n.uuid]=[];for(let e=0,t=r.length;e<t;e++){const t=r[e],o=await s(t);null!==o&&(o instanceof HTMLImageElement?i[n.uuid].push(o):i[n.uuid].push(new DataTexture(o.data,o.width,o.height)))}}else{const e=await s(n.url);null!==e&&(i[n.uuid]=e)}}}return i}parseTextures(e,t){function i(e,t){return"number"==typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}const n={};if(void 0!==e)for(let s=0,r=e.length;s<r;s++){const r=e[s];let o;void 0===r.image&&console.warn('THREE.ObjectLoader: No "image" specified for',r.uuid),void 0===t[r.image]&&console.warn("THREE.ObjectLoader: Undefined image",r.image);const a=t[r.image];Array.isArray(a)?(o=new CubeTexture(a),6===a.length&&(o.needsUpdate=!0)):(o=a&&a.data?new DataTexture(a.data,a.width,a.height):new Texture(a),a&&(o.needsUpdate=!0)),o.uuid=r.uuid,void 0!==r.name&&(o.name=r.name),void 0!==r.mapping&&(o.mapping=i(r.mapping,fc)),void 0!==r.offset&&o.offset.fromArray(r.offset),void 0!==r.repeat&&o.repeat.fromArray(r.repeat),void 0!==r.center&&o.center.fromArray(r.center),void 0!==r.rotation&&(o.rotation=r.rotation),void 0!==r.wrap&&(o.wrapS=i(r.wrap[0],gc),o.wrapT=i(r.wrap[1],gc)),void 0!==r.format&&(o.format=r.format),void 0!==r.type&&(o.type=r.type),void 0!==r.encoding&&(o.encoding=r.encoding),void 0!==r.minFilter&&(o.minFilter=i(r.minFilter,vc)),void 0!==r.magFilter&&(o.magFilter=i(r.magFilter,vc)),void 0!==r.anisotropy&&(o.anisotropy=r.anisotropy),void 0!==r.flipY&&(o.flipY=r.flipY),void 0!==r.premultiplyAlpha&&(o.premultiplyAlpha=r.premultiplyAlpha),void 0!==r.unpackAlignment&&(o.unpackAlignment=r.unpackAlignment),void 0!==r.userData&&(o.userData=r.userData),n[r.uuid]=o}return n}parseObject(e,t,i,n,s){let r,o,a;function l(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){const t=[];for(let n=0,s=e.length;n<s;n++){const s=e[n];void 0===i[s]&&console.warn("THREE.ObjectLoader: Undefined material",s),t.push(i[s])}return t}return void 0===i[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),i[e]}}function d(e){return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),n[e]}switch(e.type){case"Scene":r=new Scene,void 0!==e.background&&(Number.isInteger(e.background)?r.background=new Color(e.background):r.background=d(e.background)),void 0!==e.environment&&(r.environment=d(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?r.fog=new Fog(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(r.fog=new FogExp2(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":r=new PerspectiveCamera(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(r.focus=e.focus),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.filmGauge&&(r.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(r.filmOffset=e.filmOffset),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"OrthographicCamera":r=new OrthographicCamera(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(r.zoom=e.zoom),void 0!==e.view&&(r.view=Object.assign({},e.view));break;case"AmbientLight":r=new AmbientLight(e.color,e.intensity);break;case"DirectionalLight":r=new DirectionalLight(e.color,e.intensity);break;case"PointLight":r=new PointLight(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":r=new RectAreaLight(e.color,e.intensity,e.width,e.height);break;case"SpotLight":r=new SpotLight(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":r=new HemisphereLight(e.color,e.groundColor,e.intensity);break;case"LightProbe":r=(new LightProbe).fromJSON(e);break;case"SkinnedMesh":o=l(e.geometry),a=c(e.material),r=new SkinnedMesh(o,a),void 0!==e.bindMode&&(r.bindMode=e.bindMode),void 0!==e.bindMatrix&&r.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(r.skeleton=e.skeleton);break;case"Mesh":o=l(e.geometry),a=c(e.material),r=new Mesh(o,a);break;case"InstancedMesh":o=l(e.geometry),a=c(e.material);const t=e.count,i=e.instanceMatrix,n=e.instanceColor;r=new InstancedMesh(o,a,t),r.instanceMatrix=new InstancedBufferAttribute(new Float32Array(i.array),16),void 0!==n&&(r.instanceColor=new InstancedBufferAttribute(new Float32Array(n.array),n.itemSize));break;case"LOD":r=new LOD;break;case"Line":r=new Line(l(e.geometry),c(e.material));break;case"LineLoop":r=new LineLoop(l(e.geometry),c(e.material));break;case"LineSegments":r=new LineSegments(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":r=new Points(l(e.geometry),c(e.material));break;case"Sprite":r=new Sprite(c(e.material));break;case"Group":r=new Group;break;case"Bone":r=new Bone;break;default:r=new Object3D}if(r.uuid=e.uuid,void 0!==e.name&&(r.name=e.name),void 0!==e.matrix?(r.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(r.matrixAutoUpdate=e.matrixAutoUpdate),r.matrixAutoUpdate&&r.matrix.decompose(r.position,r.quaternion,r.scale)):(void 0!==e.position&&r.position.fromArray(e.position),void 0!==e.rotation&&r.rotation.fromArray(e.rotation),void 0!==e.quaternion&&r.quaternion.fromArray(e.quaternion),void 0!==e.scale&&r.scale.fromArray(e.scale)),void 0!==e.castShadow&&(r.castShadow=e.castShadow),void 0!==e.receiveShadow&&(r.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(r.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(r.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(r.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&r.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(r.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(r.visible=e.visible),void 0!==e.frustumCulled&&(r.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(r.renderOrder=e.renderOrder),void 0!==e.userData&&(r.userData=e.userData),void 0!==e.layers&&(r.layers.mask=e.layers),void 0!==e.children){const o=e.children;for(let e=0;e<o.length;e++)r.add(this.parseObject(o[e],t,i,n,s))}if(void 0!==e.animations){const t=e.animations;for(let e=0;e<t.length;e++){const i=t[e];r.animations.push(s[i])}}if("LOD"===e.type){void 0!==e.autoUpdate&&(r.autoUpdate=e.autoUpdate);const t=e.levels;for(let e=0;e<t.length;e++){const i=t[e],n=r.getObjectByProperty("uuid",i.object);void 0!==n&&r.addLevel(n,i.distance)}}return r}bindSkeletons(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){const i=t[e.skeleton];void 0===i?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(i,e.bindMatrix)}}))}setTexturePath(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}const fc={UVMapping:se,CubeReflectionMapping:re,CubeRefractionMapping:oe,EquirectangularReflectionMapping:ae,EquirectangularRefractionMapping:le,CubeUVReflectionMapping:ce,CubeUVRefractionMapping:de},gc={RepeatWrapping:he,ClampToEdgeWrapping:ue,MirroredRepeatWrapping:pe},vc={NearestFilter:me,NearestMipmapNearestFilter:fe,NearestMipmapLinearFilter:ve,LinearFilter:be,LinearMipmapNearestFilter:Se,LinearMipmapLinearFilter:Te};class ImageBitmapLoader extends Loader{constructor(e){super(e),"undefined"==typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"==typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,i,n){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,r=oc.get(e);if(void 0!==r)return s.manager.itemStart(e),setTimeout((function(){t&&t(r),s.manager.itemEnd(e)}),0),r;const o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(s.options,{colorSpaceConversion:"none"}))})).then((function(i){oc.add(e,i),t&&t(i),s.manager.itemEnd(e)})).catch((function(t){n&&n(t),s.manager.itemError(e),s.manager.itemEnd(e)})),s.manager.itemStart(e)}}let yc;ImageBitmapLoader.prototype.isImageBitmapLoader=!0;const bc={getContext:function(){return void 0===yc&&(yc=new(window.AudioContext||window.webkitAudioContext)),yc},setContext:function(e){yc=e}};class AudioLoader extends Loader{constructor(e){super(e)}load(e,t,i,n){const s=this,r=new FileLoader(this.manager);r.setResponseType("arraybuffer"),r.setPath(this.path),r.setRequestHeader(this.requestHeader),r.setWithCredentials(this.withCredentials),r.load(e,(function(i){try{const e=i.slice(0);bc.getContext().decodeAudioData(e,(function(e){t(e)}))}catch(t){n?n(t):console.error(t),s.manager.itemError(e)}}),i,n)}}class HemisphereLightProbe extends LightProbe{constructor(e,t,i=1){super(void 0,i);const n=(new Color).set(e),s=(new Color).set(t),r=new Vector3(n.r,n.g,n.b),o=new Vector3(s.r,s.g,s.b),a=Math.sqrt(Math.PI),l=a*Math.sqrt(.75);this.sh.coefficients[0].copy(r).add(o).multiplyScalar(a),this.sh.coefficients[1].copy(r).sub(o).multiplyScalar(l)}}HemisphereLightProbe.prototype.isHemisphereLightProbe=!0;class AmbientLightProbe extends LightProbe{constructor(e,t=1){super(void 0,t);const i=(new Color).set(e);this.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI))}}AmbientLightProbe.prototype.isAmbientLightProbe=!0;const Sc=new Matrix4,Ec=new Matrix4;class StereoCamera{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new PerspectiveCamera,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new PerspectiveCamera,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;const i=e.projectionMatrix.clone(),n=t.eyeSep/2,s=n*t.near/t.focus,r=t.near*Math.tan(ki*t.fov*.5)/t.zoom;let o,a;Ec.elements[12]=-n,Sc.elements[12]=n,o=-r*t.aspect+s,a=r*t.aspect+s,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraL.projectionMatrix.copy(i),o=-r*t.aspect-s,a=r*t.aspect-s,i.elements[0]=2*t.near/(a-o),i.elements[8]=(a+o)/(a-o),this.cameraR.projectionMatrix.copy(i)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Ec),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Sc)}}class Clock{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Tc(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Tc();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Tc(){return("undefined"==typeof performance?Date:performance).now()}const wc=new Vector3,xc=new Quaternion,_c=new Vector3,Mc=new Vector3;class AudioListener extends Object3D{constructor(){super(),this.type="AudioListener",this.context=bc.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new Clock}getInput(){return this.gain}removeFilter(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,i=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(wc,xc,_c),Mc.set(0,0,-1).applyQuaternion(xc),t.positionX){const e=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(wc.x,e),t.positionY.linearRampToValueAtTime(wc.y,e),t.positionZ.linearRampToValueAtTime(wc.z,e),t.forwardX.linearRampToValueAtTime(Mc.x,e),t.forwardY.linearRampToValueAtTime(Mc.y,e),t.forwardZ.linearRampToValueAtTime(Mc.z,e),t.upX.linearRampToValueAtTime(i.x,e),t.upY.linearRampToValueAtTime(i.y,e),t.upZ.linearRampToValueAtTime(i.z,e)}else t.setPosition(wc.x,wc.y,wc.z),t.setOrientation(Mc.x,Mc.y,Mc.z,i.x,i.y,i.z)}}class Audio extends Object3D{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(!0===this.isPlaying)return void console.warn("THREE.Audio: Audio is already playing.");if(!1===this.hasPlaybackControl)return void console.warn("THREE.Audio: this Audio has no playback control.");this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}stop(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}getFilters(){return this.filters}setFilters(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1}getLoop(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}const Oc=new Vector3,Ac=new Quaternion,Cc=new Vector3,Pc=new Vector3;class PositionalAudio extends Audio{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,i){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=i,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),!0===this.hasPlaybackControl&&!1===this.isPlaying)return;this.matrixWorld.decompose(Oc,Ac,Cc),Pc.set(0,0,1).applyQuaternion(Ac);const t=this.panner;if(t.positionX){const e=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Oc.x,e),t.positionY.linearRampToValueAtTime(Oc.y,e),t.positionZ.linearRampToValueAtTime(Oc.z,e),t.orientationX.linearRampToValueAtTime(Pc.x,e),t.orientationY.linearRampToValueAtTime(Pc.y,e),t.orientationZ.linearRampToValueAtTime(Pc.z,e)}else t.setPosition(Oc.x,Oc.y,Oc.z),t.setOrientation(Pc.x,Pc.y,Pc.z)}}class AudioAnalyser{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let i=0;i<t.length;i++)e+=t[i];return e/t.length}}class PropertyMixer{constructor(e,t,i){let n,s,r;switch(this.binding=e,this.valueSize=i,t){case"quaternion":n=this._slerp,s=this._slerpAdditive,r=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*i),this._workIndex=5;break;case"string":case"bool":n=this._select,s=this._select,r=this._setAdditiveIdentityOther,this.buffer=new Array(5*i);break;default:n=this._lerp,s=this._lerpAdditive,r=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*i)}this._mixBufferRegion=n,this._mixBufferRegionAdditive=s,this._setIdentity=r,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const i=this.buffer,n=this.valueSize,s=e*n+n;let r=this.cumulativeWeight;if(0===r){for(let e=0;e!==n;++e)i[s+e]=i[e];r=t}else{r+=t;const e=t/r;this._mixBufferRegion(i,s,0,e,n)}this.cumulativeWeight=r}accumulateAdditive(e){const t=this.buffer,i=this.valueSize,n=i*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,n,0,e,i),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,i=this.buffer,n=e*t+t,s=this.cumulativeWeight,r=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const e=t*this._origIndex;this._mixBufferRegion(i,n,e,1-s,t)}r>0&&this._mixBufferRegionAdditive(i,n,this._addIndex*t,1,t);for(let e=t,s=t+t;e!==s;++e)if(i[e]!==i[e+t]){o.setValue(i,n);break}}saveOriginalState(){const e=this.binding,t=this.buffer,i=this.valueSize,n=i*this._origIndex;e.getValue(t,n);for(let e=i,s=n;e!==s;++e)t[e]=t[n+e%i];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=3*this.valueSize;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let i=e;i<t;i++)this.buffer[i]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let i=0;i<this.valueSize;i++)this.buffer[t+i]=this.buffer[e+i]}_select(e,t,i,n,s){if(n>=.5)for(let n=0;n!==s;++n)e[t+n]=e[i+n]}_slerp(e,t,i,n){Quaternion.slerpFlat(e,t,e,t,e,i,n)}_slerpAdditive(e,t,i,n,s){const r=this._workIndex*s;Quaternion.multiplyQuaternionsFlat(e,r,e,t,e,i),Quaternion.slerpFlat(e,t,e,t,e,r,n)}_lerp(e,t,i,n,s){const r=1-n;for(let o=0;o!==s;++o){const s=t+o;e[s]=e[s]*r+e[i+o]*n}}_lerpAdditive(e,t,i,n,s){for(let r=0;r!==s;++r){const s=t+r;e[s]=e[s]+e[i+r]*n}}}const Dc="\\[\\]\\.:\\/",Nc=new RegExp("[\\[\\]\\.:\\/]","g"),Ic="[^\\[\\]\\.:\\/]",Lc="[^"+Dc.replace("\\.","")+"]",Rc=/((?:WC+[\/:])*)/.source.replace("WC",Ic),kc=/(WCOD+)?/.source.replace("WCOD",Lc),Uc=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",Ic),Bc=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",Ic),Fc=new RegExp("^"+Rc+kc+Uc+Bc+"$"),Vc=["material","materials","bones"];class PropertyBinding{constructor(e,t,i){this.path=t,this.parsedPath=i||PropertyBinding.parseTrackName(t),this.node=PropertyBinding.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,i){return e&&e.isAnimationObjectGroup?new PropertyBinding.Composite(e,t,i):new PropertyBinding(e,t,i)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(Nc,"")}static parseTrackName(e){const t=Fc.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const i={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},n=i.nodeName&&i.nodeName.lastIndexOf(".");if(void 0!==n&&-1!==n){const e=i.nodeName.substring(n+1);-1!==Vc.indexOf(e)&&(i.nodeName=i.nodeName.substring(0,n),i.objectName=e)}if(null===i.propertyName||0===i.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return i}static findNode(e,t){if(!t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){const i=e.skeleton.getBoneByName(t);if(void 0!==i)return i}if(e.children){const i=function(e){for(let n=0;n<e.length;n++){const s=e[n];if(s.name===t||s.uuid===t)return s;const r=i(s.children);if(r)return r}return null},n=i(e.children);if(n)return n}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)e[t++]=i[n]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const i=this.resolvedProperty;for(let n=0,s=i.length;n!==s;++n)i[n]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,i=t.objectName,n=t.propertyName;let s=t.propertyIndex;if(e||(e=PropertyBinding.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(i){let n=t.objectIndex;switch(i){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(let t=0;t<e.length;t++)if(e[t].name===n){n=t;break}break;default:if(void 0===e[i])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[i]}if(void 0!==n){if(void 0===e[n])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[n]}}const r=e[n];if(void 0===r){const i=t.nodeName;return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i+"."+n+" but it wasn't found.",e)}let o=this.Versioning.None;this.targetObject=e,void 0!==e.needsUpdate?o=this.Versioning.NeedsUpdate:void 0!==e.matrixWorldNeedsUpdate&&(o=this.Versioning.MatrixWorldNeedsUpdate);let a=this.BindingType.Direct;if(void 0!==s){if("morphTargetInfluences"===n){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!e.geometry.isBufferGeometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences on THREE.Geometry. Use THREE.BufferGeometry instead.",this);if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==e.morphTargetDictionary[s]&&(s=e.morphTargetDictionary[s])}a=this.BindingType.ArrayElement,this.resolvedProperty=r,this.propertyIndex=s}else void 0!==r.fromArray&&void 0!==r.toArray?(a=this.BindingType.HasFromToArray,this.resolvedProperty=r):Array.isArray(r)?(a=this.BindingType.EntireArray,this.resolvedProperty=r):this.propertyName=n;this.getValue=this.GetterByBindingType[a],this.setValue=this.SetterByBindingTypeAndVersioning[a][o]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}PropertyBinding.Composite=class Composite{constructor(e,t,i){const n=i||PropertyBinding.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,n)}getValue(e,t){this.bind();const i=this._targetGroup.nCachedObjects_,n=this._bindings[i];void 0!==n&&n.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let n=this._targetGroup.nCachedObjects_,s=i.length;n!==s;++n)i[n].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}},PropertyBinding.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},PropertyBinding.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},PropertyBinding.prototype.GetterByBindingType=[PropertyBinding.prototype._getValue_direct,PropertyBinding.prototype._getValue_array,PropertyBinding.prototype._getValue_arrayElement,PropertyBinding.prototype._getValue_toArray],PropertyBinding.prototype.SetterByBindingTypeAndVersioning=[[PropertyBinding.prototype._setValue_direct,PropertyBinding.prototype._setValue_direct_setNeedsUpdate,PropertyBinding.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_array,PropertyBinding.prototype._setValue_array_setNeedsUpdate,PropertyBinding.prototype._setValue_array_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_arrayElement,PropertyBinding.prototype._setValue_arrayElement_setNeedsUpdate,PropertyBinding.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[PropertyBinding.prototype._setValue_fromArray,PropertyBinding.prototype._setValue_fromArray_setNeedsUpdate,PropertyBinding.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class AnimationObjectGroup{constructor(){this.uuid=Vi(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let t=0,i=arguments.length;t!==i;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,i=this._paths,n=this._parsedPaths,s=this._bindings,r=s.length;let o,a=e.length,l=this.nCachedObjects_;for(let c=0,d=arguments.length;c!==d;++c){const d=arguments[c],h=d.uuid;let u=t[h];if(void 0===u){u=a++,t[h]=u,e.push(d);for(let e=0,t=r;e!==t;++e)s[e].push(new PropertyBinding(d,i[e],n[e]))}else if(u<l){o=e[u];const a=--l,c=e[a];t[c.uuid]=u,e[u]=c,t[h]=a,e[a]=d;for(let e=0,t=r;e!==t;++e){const t=s[e],r=t[a];let o=t[u];t[u]=r,void 0===o&&(o=new PropertyBinding(d,i[e],n[e])),t[a]=o}}else e[u]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=l}remove(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_;for(let r=0,o=arguments.length;r!==o;++r){const o=arguments[r],a=o.uuid,l=t[a];if(void 0!==l&&l>=s){const r=s++,c=e[r];t[c.uuid]=l,e[l]=c,t[a]=r,e[r]=o;for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[r],s=t[l];t[l]=n,t[r]=s}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,i=this._bindings,n=i.length;let s=this.nCachedObjects_,r=e.length;for(let o=0,a=arguments.length;o!==a;++o){const a=arguments[o].uuid,l=t[a];if(void 0!==l)if(delete t[a],l<s){const o=--s,a=e[o],c=--r,d=e[c];t[a.uuid]=l,e[l]=a,t[d.uuid]=o,e[o]=d,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e],n=t[o],s=t[c];t[l]=n,t[o]=s,t.pop()}}else{const s=--r,o=e[s];s>0&&(t[o.uuid]=l),e[l]=o,e.pop();for(let e=0,t=n;e!==t;++e){const t=i[e];t[l]=t[s],t.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const i=this._bindingsIndicesByPath;let n=i[e];const s=this._bindings;if(void 0!==n)return s[n];const r=this._paths,o=this._parsedPaths,a=this._objects,l=a.length,c=this.nCachedObjects_,d=new Array(l);n=s.length,i[e]=n,r.push(e),o.push(t),s.push(d);for(let i=c,n=a.length;i!==n;++i){const n=a[i];d[i]=new PropertyBinding(n,e,t)}return d}unsubscribe_(e){const t=this._bindingsIndicesByPath,i=t[e];if(void 0!==i){const n=this._paths,s=this._parsedPaths,r=this._bindings,o=r.length-1,a=r[o];t[e[o]]=i,r[i]=a,r.pop(),s[i]=s[o],s.pop(),n[i]=n[o],n.pop()}}}AnimationObjectGroup.prototype.isAnimationObjectGroup=!0;class AnimationAction{constructor(e,t,i=null,n=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=i,this.blendMode=n;const s=t.tracks,r=s.length,o=new Array(r),a={endingStart:jt,endingEnd:jt};for(let e=0;e!==r;++e){const t=s[e].createInterpolant(null);o[e]=t,t.settings=a}this._interpolantSettings=a,this._interpolants=o,this._propertyBindings=new Array(r),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=Ut,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,i){if(e.fadeOut(t),this.fadeIn(t),i){const i=this._clip.duration,n=e._clip.duration,s=n/i,r=i/n;e.warp(1,s,t),this.warp(r,1,t)}return this}crossFadeTo(e,t,i){return e.crossFadeFrom(this,t,i)}stopFading(){const e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,i){const n=this._mixer,s=n.time,r=this.timeScale;let o=this._timeScaleInterpolant;null===o&&(o=n._lendControlInterpolant(),this._timeScaleInterpolant=o);const a=o.parameterPositions,l=o.sampleValues;return a[0]=s,a[1]=s+i,l[0]=e/r,l[1]=t/r,this}stopWarping(){const e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,i,n){if(!this.enabled)return void this._updateWeight(e);const s=this._startTime;if(null!==s){const n=(e-s)*i;if(n<0||0===i)return;this._startTime=null,t=i*n}t*=this._updateTimeScale(e);const r=this._updateTime(t),o=this._updateWeight(e);if(o>0){const e=this._interpolants,t=this._propertyBindings;switch(this.blendMode){case Kt:for(let i=0,n=e.length;i!==n;++i)e[i].evaluate(r),t[i].accumulateAdditive(o);break;case Wt:default:for(let i=0,s=e.length;i!==s;++i)e[i].evaluate(r),t[i].accumulate(n,o)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const i=this._weightInterpolant;if(null!==i){const n=i.evaluate(e)[0];t*=n,e>i.parameterPositions[1]&&(this.stopFading(),0===n&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const i=this._timeScaleInterpolant;if(null!==i){t*=i.evaluate(e)[0],e>i.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,i=this.loop;let n=this.time+e,s=this._loopCount;const r=i===Bt;if(0===e)return-1===s?n:r&&1==(1&s)?t-n:n;if(i===kt){-1===s&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(n>=t)n=t;else{if(!(n<0)){this.time=n;break e}n=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===s&&(e>=0?(s=0,this._setEndings(!0,0===this.repetitions,r)):this._setEndings(0===this.repetitions,!0,r)),n>=t||n<0){const i=Math.floor(n/t);n-=t*i,s+=Math.abs(i);const o=this.repetitions-s;if(o<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,n=e>0?t:0,this.time=n,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===o){const t=e<0;this._setEndings(t,!t,r)}else this._setEndings(!1,!1,r);this._loopCount=s,this.time=n,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:i})}}else this.time=n;if(r&&1==(1&s))return t-n}return n}_setEndings(e,t,i){const n=this._interpolantSettings;i?(n.endingStart=Gt,n.endingEnd=Gt):(n.endingStart=e?this.zeroSlopeAtStart?Gt:jt:zt,n.endingEnd=t?this.zeroSlopeAtEnd?Gt:jt:zt)}_scheduleFading(e,t,i){const n=this._mixer,s=n.time;let r=this._weightInterpolant;null===r&&(r=n._lendControlInterpolant(),this._weightInterpolant=r);const o=r.parameterPositions,a=r.sampleValues;return o[0]=s,a[0]=t,o[1]=s+e,a[1]=i,this}}class AnimationMixer extends EventDispatcher{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const i=e._localRoot||this._root,n=e._clip.tracks,s=n.length,r=e._propertyBindings,o=e._interpolants,a=i.uuid,l=this._bindingsByRootAndName;let c=l[a];void 0===c&&(c={},l[a]=c);for(let e=0;e!==s;++e){const s=n[e],l=s.name;let d=c[l];if(void 0!==d)r[e]=d;else{if(d=r[e],void 0!==d){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,a,l));continue}const n=t&&t._propertyBindings[e].binding.parsedPath;d=new PropertyMixer(PropertyBinding.create(i,l,n),s.ValueTypeName,s.getValueSize()),++d.referenceCount,this._addInactiveBinding(d,a,l),r[e]=d}o[e].resultBuffer=d.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){const t=(e._localRoot||this._root).uuid,i=e._clip.uuid,n=this._actionsByClip[i];this._bindAction(e,n&&n.knownActions[0]),this._addInactiveAction(e,i,t)}const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==i.useCount++&&(this._lendBinding(i),i.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.useCount&&(i.restoreOriginalState(),this._takeBackBinding(i))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return null!==t&&t<this._nActiveActions}_addInactiveAction(e,t,i){const n=this._actions,s=this._actionsByClip;let r=s[t];if(void 0===r)r={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=r;else{const t=r.knownActions;e._byClipCacheIndex=t.length,t.push(e)}e._cacheIndex=n.length,n.push(e),r.actionByRoot[i]=e}_removeInactiveAction(e){const t=this._actions,i=t[t.length-1],n=e._cacheIndex;i._cacheIndex=n,t[n]=i,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,r=this._actionsByClip,o=r[s],a=o.knownActions,l=a[a.length-1],c=e._byClipCacheIndex;l._byClipCacheIndex=c,a[c]=l,a.pop(),e._byClipCacheIndex=null;delete o.actionByRoot[(e._localRoot||this._root).uuid],0===a.length&&delete r[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let e=0,i=t.length;e!==i;++e){const i=t[e];0==--i.referenceCount&&this._removeInactiveBinding(i)}}_lendAction(e){const t=this._actions,i=e._cacheIndex,n=this._nActiveActions++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackAction(e){const t=this._actions,i=e._cacheIndex,n=--this._nActiveActions,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_addInactiveBinding(e,t,i){const n=this._bindingsByRootAndName,s=this._bindings;let r=n[t];void 0===r&&(r={},n[t]=r),r[i]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,i=e.binding,n=i.rootNode.uuid,s=i.path,r=this._bindingsByRootAndName,o=r[n],a=t[t.length-1],l=e._cacheIndex;a._cacheIndex=l,t[l]=a,t.pop(),delete o[s],0===Object.keys(o).length&&delete r[n]}_lendBinding(e){const t=this._bindings,i=e._cacheIndex,n=this._nActiveBindings++,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_takeBackBinding(e){const t=this._bindings,i=e._cacheIndex,n=--this._nActiveBindings,s=t[n];e._cacheIndex=n,t[n]=e,s._cacheIndex=i,t[i]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let i=e[t];return void 0===i&&(i=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer),i.__cacheIndex=t,e[t]=i),i}_takeBackControlInterpolant(e){const t=this._controlInterpolants,i=e.__cacheIndex,n=--this._nActiveControlInterpolants,s=t[n];e.__cacheIndex=n,t[n]=e,s.__cacheIndex=i,t[i]=s}clipAction(e,t,i){const n=t||this._root,s=n.uuid;let r="string"==typeof e?AnimationClip.findByName(n,e):e;const o=null!==r?r.uuid:e,a=this._actionsByClip[o];let l=null;if(void 0===i&&(i=null!==r?r.blendMode:Wt),void 0!==a){const e=a.actionByRoot[s];if(void 0!==e&&e.blendMode===i)return e;l=a.knownActions[0],null===r&&(r=l._clip)}if(null===r)return null;const c=new AnimationAction(this,r,t,i);return this._bindAction(c,l),this._addInactiveAction(c,o,s),c}existingAction(e,t){const i=t||this._root,n=i.uuid,s="string"==typeof e?AnimationClip.findByName(i,e):e,r=s?s.uuid:e,o=this._actionsByClip[r];return void 0!==o&&o.actionByRoot[n]||null}stopAllAction(){const e=this._actions;for(let t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}update(e){e*=this.timeScale;const t=this._actions,i=this._nActiveActions,n=this.time+=e,s=Math.sign(e),r=this._accuIndex^=1;for(let o=0;o!==i;++o){t[o]._update(n,e,s,r)}const o=this._bindings,a=this._nActiveBindings;for(let e=0;e!==a;++e)o[e].apply(r);return this}setTime(e){this.time=0;for(let e=0;e<this._actions.length;e++)this._actions[e].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,i=e.uuid,n=this._actionsByClip,s=n[i];if(void 0!==s){const e=s.knownActions;for(let i=0,n=e.length;i!==n;++i){const n=e[i];this._deactivateAction(n);const s=n._cacheIndex,r=t[t.length-1];n._cacheIndex=null,n._byClipCacheIndex=null,r._cacheIndex=s,t[s]=r,t.pop(),this._removeInactiveBindingsForAction(n)}delete n[i]}}uncacheRoot(e){const t=e.uuid,i=this._actionsByClip;for(const e in i){const n=i[e].actionByRoot[t];void 0!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}const n=this._bindingsByRootAndName[t];if(void 0!==n)for(const e in n){const t=n[e];t.restoreOriginalState(),this._removeInactiveBinding(t)}}uncacheAction(e,t){const i=this.existingAction(e,t);null!==i&&(this._deactivateAction(i),this._removeInactiveAction(i))}}AnimationMixer.prototype._controlInterpolantsResultBuffer=new Float32Array(1);class Uniform{constructor(e){"string"==typeof e&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}clone(){return new Uniform(void 0===this.value.clone?this.value:this.value.clone())}}class InstancedInterleavedBuffer extends InterleavedBuffer{constructor(e,t,i=1){super(e,t),this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}InstancedInterleavedBuffer.prototype.isInstancedInterleavedBuffer=!0;class GLBufferAttribute{constructor(e,t,i,n,s){this.buffer=e,this.type=t,this.itemSize=i,this.elementSize=n,this.count=s,this.version=0}set needsUpdate(e){!0===e&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}GLBufferAttribute.prototype.isGLBufferAttribute=!0;class Raycaster{constructor(e,t,i=0,n=1/0){this.ray=new Ray(e,t),this.near=i,this.far=n,this.camera=null,this.layers=new Layers,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return jc(e,this,i,t),i.sort(Hc),i}intersectObjects(e,t=!0,i=[]){for(let n=0,s=e.length;n<s;n++)jc(e[n],this,i,t);return i.sort(Hc),i}}function Hc(e,t){return e.distance-t.distance}function jc(e,t,i,n){if(e.layers.test(t.layers)&&e.raycast(t,i),!0===n){const n=e.children;for(let e=0,s=n.length;e<s;e++)jc(n[e],t,i,!0)}}class Spherical{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){const e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Hi(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}class Cylindrical{constructor(e=1,t=0,i=0){return this.radius=e,this.theta=t,this.y=i,this}set(e,t,i){return this.radius=e,this.theta=t,this.y=i,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+i*i),this.theta=Math.atan2(e,i),this.y=t,this}clone(){return(new this.constructor).copy(this)}}const Gc=new Vector2;class Box2{constructor(e=new Vector2(1/0,1/0),t=new Vector2(-1/0,-1/0)){this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Gc.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Gc.copy(e).clamp(this.min,this.max).sub(e).length()}intersect(e){return this.min.max(e.min),this.max.min(e.max),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}Box2.prototype.isBox2=!0;const zc=new Vector3,Wc=new Vector3;class Line3{constructor(e=new Vector3,t=new Vector3){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){zc.subVectors(e,this.start),Wc.subVectors(this.end,this.start);const i=Wc.dot(Wc);let n=Wc.dot(zc)/i;return t&&(n=Hi(n,0,1)),n}closestPointToPoint(e,t,i){const n=this.closestPointToPointParameter(e,t);return this.delta(i).multiplyScalar(n).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return(new this.constructor).copy(this)}}const Kc=new Vector3;class SpotLightHelper extends Object3D{constructor(e,t){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;const i=new BufferGeometry,n=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let e=0,t=1,i=32;e<i;e++,t++){const s=e/i*Math.PI*2,r=t/i*Math.PI*2;n.push(Math.cos(s),Math.sin(s),1,Math.cos(r),Math.sin(r),1)}i.setAttribute("position",new Float32BufferAttribute(n,3));const s=new LineBasicMaterial({fog:!1,toneMapped:!1});this.cone=new LineSegments(i,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateMatrixWorld();const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Kc.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Kc),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const Yc=new Vector3,qc=new Matrix4,Zc=new Matrix4;class SkeletonHelper extends LineSegments{constructor(e){const t=$c(e),i=new BufferGeometry,n=[],s=[],r=new Color(0,0,1),o=new Color(0,1,0);for(let e=0;e<t.length;e++){const i=t[e];i.parent&&i.parent.isBone&&(n.push(0,0,0),n.push(0,0,0),s.push(r.r,r.g,r.b),s.push(o.r,o.g,o.b))}i.setAttribute("position",new Float32BufferAttribute(n,3)),i.setAttribute("color",new Float32BufferAttribute(s,3));super(i,new LineBasicMaterial({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0})),this.type="SkeletonHelper",this.isSkeletonHelper=!0,this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,i=this.geometry,n=i.getAttribute("position");Zc.copy(this.root.matrixWorld).invert();for(let e=0,i=0;e<t.length;e++){const s=t[e];s.parent&&s.parent.isBone&&(qc.multiplyMatrices(Zc,s.matrixWorld),Yc.setFromMatrixPosition(qc),n.setXYZ(i,Yc.x,Yc.y,Yc.z),qc.multiplyMatrices(Zc,s.parent.matrixWorld),Yc.setFromMatrixPosition(qc),n.setXYZ(i+1,Yc.x,Yc.y,Yc.z),i+=2)}i.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}}function $c(e){const t=[];e&&e.isBone&&t.push(e);for(let i=0;i<e.children.length;i++)t.push.apply(t,$c(e.children[i]));return t}class PointLightHelper extends Mesh{constructor(e,t,i){super(new SphereGeometry(t,4,2),new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1})),this.light=e,this.light.updateMatrixWorld(),this.color=i,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const Qc=new Vector3,Xc=new Color,Jc=new Color;class HemisphereLightHelper extends Object3D{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i;const n=new OctahedronGeometry(t);n.rotateY(.5*Math.PI),this.material=new MeshBasicMaterial({wireframe:!0,fog:!1,toneMapped:!1}),void 0===this.color&&(this.material.vertexColors=!0);const s=n.getAttribute("position"),r=new Float32Array(3*s.count);n.setAttribute("color",new BufferAttribute(r,3)),this.add(new Mesh(n,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Xc.copy(this.light.color),Jc.copy(this.light.groundColor);for(let e=0,i=t.count;e<i;e++){const n=e<i/2?Xc:Jc;t.setXYZ(e,n.r,n.g,n.b)}t.needsUpdate=!0}e.lookAt(Qc.setFromMatrixPosition(this.light.matrixWorld).negate())}}class GridHelper extends LineSegments{constructor(e=10,t=10,i=4473924,n=8947848){i=new Color(i),n=new Color(n);const s=t/2,r=e/t,o=e/2,a=[],l=[];for(let e=0,c=0,d=-o;e<=t;e++,d+=r){a.push(-o,0,d,o,0,d),a.push(d,0,-o,d,0,o);const t=e===s?i:n;t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3,t.toArray(l,c),c+=3}const c=new BufferGeometry;c.setAttribute("position",new Float32BufferAttribute(a,3)),c.setAttribute("color",new Float32BufferAttribute(l,3));super(c,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="GridHelper"}}class PolarGridHelper extends LineSegments{constructor(e=10,t=16,i=8,n=64,s=4473924,r=8947848){s=new Color(s),r=new Color(r);const o=[],a=[];for(let i=0;i<=t;i++){const n=i/t*(2*Math.PI),l=Math.sin(n)*e,c=Math.cos(n)*e;o.push(0,0,0),o.push(l,0,c);const d=1&i?s:r;a.push(d.r,d.g,d.b),a.push(d.r,d.g,d.b)}for(let t=0;t<=i;t++){const l=1&t?s:r,c=e-e/i*t;for(let e=0;e<n;e++){let t=e/n*(2*Math.PI),i=Math.sin(t)*c,s=Math.cos(t)*c;o.push(i,0,s),a.push(l.r,l.g,l.b),t=(e+1)/n*(2*Math.PI),i=Math.sin(t)*c,s=Math.cos(t)*c,o.push(i,0,s),a.push(l.r,l.g,l.b)}}const l=new BufferGeometry;l.setAttribute("position",new Float32BufferAttribute(o,3)),l.setAttribute("color",new Float32BufferAttribute(a,3));super(l,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="PolarGridHelper"}}const ed=new Vector3,td=new Vector3,id=new Vector3;class DirectionalLightHelper extends Object3D{constructor(e,t,i){super(),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=i,void 0===t&&(t=1);let n=new BufferGeometry;n.setAttribute("position",new Float32BufferAttribute([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new LineBasicMaterial({fog:!1,toneMapped:!1});this.lightPlane=new Line(n,s),this.add(this.lightPlane),n=new BufferGeometry,n.setAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3)),this.targetLine=new Line(n,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){ed.setFromMatrixPosition(this.light.matrixWorld),td.setFromMatrixPosition(this.light.target.matrixWorld),id.subVectors(td,ed),this.lightPlane.lookAt(td),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(td),this.targetLine.scale.z=id.length()}}const nd=new Vector3,sd=new Camera;class CameraHelper extends LineSegments{constructor(e){const t=new BufferGeometry,i=new LineBasicMaterial({color:16777215,vertexColors:!0,toneMapped:!1}),n=[],s=[],r={},o=new Color(16755200),a=new Color(16711680),l=new Color(43775),c=new Color(16777215),d=new Color(3355443);function h(e,t,i){u(e,i),u(t,i)}function u(e,t){n.push(0,0,0),s.push(t.r,t.g,t.b),void 0===r[e]&&(r[e]=[]),r[e].push(n.length/3-1)}h("n1","n2",o),h("n2","n4",o),h("n4","n3",o),h("n3","n1",o),h("f1","f2",o),h("f2","f4",o),h("f4","f3",o),h("f3","f1",o),h("n1","f1",o),h("n2","f2",o),h("n3","f3",o),h("n4","f4",o),h("p","n1",a),h("p","n2",a),h("p","n3",a),h("p","n4",a),h("u1","u2",l),h("u2","u3",l),h("u3","u1",l),h("c","t",c),h("p","c",d),h("cn1","cn2",d),h("cn3","cn4",d),h("cf1","cf2",d),h("cf3","cf4",d),t.setAttribute("position",new Float32BufferAttribute(n,3)),t.setAttribute("color",new Float32BufferAttribute(s,3)),super(t,i),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=r,this.update()}update(){const e=this.geometry,t=this.pointMap;sd.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),rd("c",t,e,sd,0,0,-1),rd("t",t,e,sd,0,0,1),rd("n1",t,e,sd,-1,-1,-1),rd("n2",t,e,sd,1,-1,-1),rd("n3",t,e,sd,-1,1,-1),rd("n4",t,e,sd,1,1,-1),rd("f1",t,e,sd,-1,-1,1),rd("f2",t,e,sd,1,-1,1),rd("f3",t,e,sd,-1,1,1),rd("f4",t,e,sd,1,1,1),rd("u1",t,e,sd,.7,1.1,-1),rd("u2",t,e,sd,-.7,1.1,-1),rd("u3",t,e,sd,0,2,-1),rd("cf1",t,e,sd,-1,0,1),rd("cf2",t,e,sd,1,0,1),rd("cf3",t,e,sd,0,-1,1),rd("cf4",t,e,sd,0,1,1),rd("cn1",t,e,sd,-1,0,-1),rd("cn2",t,e,sd,1,0,-1),rd("cn3",t,e,sd,0,-1,-1),rd("cn4",t,e,sd,0,1,-1),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function rd(e,t,i,n,s,r,o){nd.set(s,r,o).unproject(n);const a=t[e];if(void 0!==a){const e=i.getAttribute("position");for(let t=0,i=a.length;t<i;t++)e.setXYZ(a[t],nd.x,nd.y,nd.z)}}const od=new Box3;class BoxHelper extends LineSegments{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new Float32Array(24),s=new BufferGeometry;s.setIndex(new BufferAttribute(i,1)),s.setAttribute("position",new BufferAttribute(n,3)),super(s,new LineBasicMaterial({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&od.setFromObject(this.object),od.isEmpty())return;const t=od.min,i=od.max,n=this.geometry.attributes.position,s=n.array;s[0]=i.x,s[1]=i.y,s[2]=i.z,s[3]=t.x,s[4]=i.y,s[5]=i.z,s[6]=t.x,s[7]=t.y,s[8]=i.z,s[9]=i.x,s[10]=t.y,s[11]=i.z,s[12]=i.x,s[13]=i.y,s[14]=t.z,s[15]=t.x,s[16]=i.y,s[17]=t.z,s[18]=t.x,s[19]=t.y,s[20]=t.z,s[21]=i.x,s[22]=t.y,s[23]=t.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e){return LineSegments.prototype.copy.call(this,e),this.object=e.object,this}}class Box3Helper extends LineSegments{constructor(e,t=16776960){const i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),n=new BufferGeometry;n.setIndex(new BufferAttribute(i,1)),n.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),super(n,new LineBasicMaterial({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}}class PlaneHelper extends Line{constructor(e,t=1,i=16776960){const n=i,s=new BufferGeometry;s.setAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),s.computeBoundingSphere(),super(s,new LineBasicMaterial({color:n,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const r=new BufferGeometry;r.setAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),r.computeBoundingSphere(),this.add(new Mesh(r,new MeshBasicMaterial({color:n,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){let t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?f:m,this.lookAt(this.plane.normal),super.updateMatrixWorld(e)}}const ad=new Vector3;let ld,cd;class ArrowHelper extends Object3D{constructor(e=new Vector3(0,0,1),t=new Vector3(0,0,0),i=1,n=16776960,s=.2*i,r=.2*s){super(),this.type="ArrowHelper",void 0===ld&&(ld=new BufferGeometry,ld.setAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3)),cd=new CylinderGeometry(0,.5,1,5,1),cd.translate(0,-.5,0)),this.position.copy(t),this.line=new Line(ld,new LineBasicMaterial({color:n,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Mesh(cd,new MeshBasicMaterial({color:n,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,s,r)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{ad.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(ad,t)}}setLength(e,t=.2*e,i=.2*t){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}class AxesHelper extends LineSegments{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],i=new BufferGeometry;i.setAttribute("position",new Float32BufferAttribute(t,3)),i.setAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));super(i,new LineBasicMaterial({vertexColors:!0,toneMapped:!1})),this.type="AxesHelper"}setColors(e,t,i){const n=new Color,s=this.geometry.attributes.color.array;return n.set(e),n.toArray(s,0),n.toArray(s,3),n.set(t),n.toArray(s,6),n.toArray(s,9),n.set(i),n.toArray(s,12),n.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class ShapePath{constructor(){this.type="ShapePath",this.color=new Color,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new Path,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,i,n){return this.currentPath.quadraticCurveTo(e,t,i,n),this}bezierCurveTo(e,t,i,n,s,r){return this.currentPath.bezierCurveTo(e,t,i,n,s,r),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e,t){function i(e){const t=[];for(let i=0,n=e.length;i<n;i++){const n=e[i],s=new Shape;s.curves=n.curves,t.push(s)}return t}function n(e,t){const i=t.length;let n=!1;for(let s=i-1,r=0;r<i;s=r++){let i=t[s],o=t[r],a=o.x-i.x,l=o.y-i.y;if(Math.abs(l)>Number.EPSILON){if(l<0&&(i=t[r],a=-a,o=t[s],l=-l),e.y<i.y||e.y>o.y)continue;if(e.y===i.y){if(e.x===i.x)return!0}else{const t=l*(e.x-i.x)-a*(e.y-i.y);if(0===t)return!0;if(t<0)continue;n=!n}}else{if(e.y!==i.y)continue;if(o.x<=e.x&&e.x<=i.x||i.x<=e.x&&e.x<=o.x)return!0}}return n}const s=ShapeUtils.isClockWise,r=this.subPaths;if(0===r.length)return[];if(!0===t)return i(r);let o,a,l;const c=[];if(1===r.length)return a=r[0],l=new Shape,l.curves=a.curves,c.push(l),c;let d=!s(r[0].getPoints());d=e?!d:d;const h=[],u=[];let p,m,f=[],g=0;u[g]=void 0,f[g]=[];for(let t=0,i=r.length;t<i;t++)a=r[t],p=a.getPoints(),o=s(p),o=e?!o:o,o?(!d&&u[g]&&g++,u[g]={s:new Shape,p:p},u[g].s.curves=a.curves,d&&g++,f[g]=[]):f[g].push({h:a,p:p[0]});if(!u[0])return i(r);if(u.length>1){let e=!1;const t=[];for(let e=0,t=u.length;e<t;e++)h[e]=[];for(let i=0,s=u.length;i<s;i++){const s=f[i];for(let r=0;r<s.length;r++){const o=s[r];let a=!0;for(let s=0;s<u.length;s++)n(o.p,u[s].p)&&(i!==s&&t.push({froms:i,tos:s,hole:r}),a?(a=!1,h[s].push(o)):e=!0);a&&h[i].push(o)}}t.length>0&&(e||(f=h))}for(let e=0,t=u.length;e<t;e++){l=u[e].s,c.push(l),m=f[e];for(let e=0,t=m.length;e<t;e++)l.holes.push(m[e].h)}return c}}const dd=new Float32Array(1),hd=new Int32Array(dd.buffer);class DataUtils{static toHalfFloat(e){e>65504&&(console.warn("THREE.DataUtils.toHalfFloat(): value exceeds 65504."),e=65504),dd[0]=e;const t=hd[0];let i=t>>16&32768,n=t>>12&2047;const s=t>>23&255;return s<103?i:s>142?(i|=31744,i|=(255==s?0:1)&&8388607&t,i):s<113?(n|=2048,i|=(n>>114-s)+(n>>113-s&1),i):(i|=s-112<<10|n>>1,i+=1&n,i)}}const ud=0,pd=1,md=0,fd=1,gd=2;function vd(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e}function yd(e=[]){return console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,e.materials=e,e.clone=function(){return e.slice()},e}function bd(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new Points(e,t)}function Sd(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new Sprite(e)}function Ed(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new Points(e,t)}function Td(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function wd(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function xd(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new PointsMaterial(e)}function _d(e,t,i){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Vector3(e,t,i)}function Md(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new BufferAttribute(e,t).setUsage(_i)}function Od(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new Int8BufferAttribute(e,t)}function Ad(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new Uint8BufferAttribute(e,t)}function Cd(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new Uint8ClampedBufferAttribute(e,t)}function Pd(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Int16BufferAttribute(e,t)}function Dd(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new Uint16BufferAttribute(e,t)}function Nd(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new Int32BufferAttribute(e,t)}function Id(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Uint32BufferAttribute(e,t)}function Ld(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new Float32BufferAttribute(e,t)}function Rd(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new Float64BufferAttribute(e,t)}function kd(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new AxesHelper(e)}function Ud(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new BoxHelper(e,t)}function Bd(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new LineSegments(new EdgesGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function Fd(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new LineSegments(new WireframeGeometry(e.geometry),new LineBasicMaterial({color:void 0!==t?t:16777215}))}function Vd(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new FileLoader(e)}function Hd(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new DataTextureLoader(e)}function jd(e,t,i){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new WebGLCubeRenderTarget(e,i)}function Gd(){console.error("THREE.CanvasRenderer has been removed")}function zd(){console.error("THREE.JSONLoader has been removed.")}Curve.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(Curve.prototype),e.prototype.constructor=e,e.prototype.getPoint=t,e},Path.prototype.fromPoints=function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)},GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Loader.prototype.extractUrlBase=function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),LoaderUtils.extractUrlBase(e)},Loader.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Box2.prototype.center=function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box2.prototype.empty=function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box2.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box2.prototype.size=function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)},Box3.prototype.center=function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Box3.prototype.empty=function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Box3.prototype.isIntersectionBox=function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Box3.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Box3.prototype.size=function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)},Sphere.prototype.empty=function(){return console.warn("THREE.Sphere: .empty() has been renamed to .isEmpty()."),this.isEmpty()},Frustum.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},Line3.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Matrix3.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix3.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},Matrix3.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},Matrix3.prototype.applyToVector3Array=function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")},Matrix3.prototype.getInverse=function(e){return console.warn("THREE.Matrix3: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Matrix4.prototype.extractPosition=function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},Matrix4.prototype.flattenToArrayOffset=function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},Matrix4.prototype.getPosition=function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),(new Vector3).setFromMatrixColumn(this,3)},Matrix4.prototype.setRotationFromQuaternion=function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},Matrix4.prototype.multiplyToArray=function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},Matrix4.prototype.multiplyVector3=function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector4=function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.multiplyVector3Array=function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},Matrix4.prototype.rotateAxis=function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},Matrix4.prototype.crossVector=function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.translate=function(){console.error("THREE.Matrix4: .translate() has been removed.")},Matrix4.prototype.rotateX=function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},Matrix4.prototype.rotateY=function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},Matrix4.prototype.rotateZ=function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},Matrix4.prototype.rotateByAxis=function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},Matrix4.prototype.applyToBufferAttribute=function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},Matrix4.prototype.applyToVector3Array=function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},Matrix4.prototype.makeFrustum=function(e,t,i,n,s,r){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,n,i,s,r)},Matrix4.prototype.getInverse=function(e){return console.warn("THREE.Matrix4: .getInverse() has been removed. Use matrixInv.copy( matrix ).invert(); instead."),this.copy(e).invert()},Plane.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Quaternion.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Quaternion.prototype.inverse=function(){return console.warn("THREE.Quaternion: .inverse() has been renamed to invert()."),this.invert()},Ray.prototype.isIntersectionBox=function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},Ray.prototype.isIntersectionPlane=function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},Ray.prototype.isIntersectionSphere=function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},Triangle.prototype.area=function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},Triangle.prototype.barycoordFromPoint=function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},Triangle.prototype.midpoint=function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},Triangle.prototypenormal=function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},Triangle.prototype.plane=function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)},Triangle.barycoordFromPoint=function(e,t,i,n,s){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),Triangle.getBarycoord(e,t,i,n,s)},Triangle.normal=function(e,t,i,n){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),Triangle.getNormal(e,t,i,n)},Shape.prototype.extractAllPoints=function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},Shape.prototype.extrude=function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new ExtrudeGeometry(this,e)},Shape.prototype.makeGeometry=function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new ShapeGeometry(this,e)},Vector2.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Vector2.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector2.prototype.lengthManhattan=function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector3.prototype.setEulerFromRotationMatrix=function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},Vector3.prototype.setEulerFromQuaternion=function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},Vector3.prototype.getPositionFromMatrix=function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},Vector3.prototype.getScaleFromMatrix=function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},Vector3.prototype.getColumnFromMatrix=function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},Vector3.prototype.applyProjection=function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},Vector3.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Vector3.prototype.distanceToManhattan=function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},Vector3.prototype.lengthManhattan=function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Vector4.prototype.fromAttribute=function(e,t,i){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,i)},Vector4.prototype.lengthManhattan=function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()},Object3D.prototype.getChildByName=function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},Object3D.prototype.renderDepth=function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},Object3D.prototype.translate=function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},Object3D.prototype.getWorldRotation=function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},Object3D.prototype.applyMatrix=function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Mesh.prototype.setDrawMode=function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")},Object.defineProperties(Mesh.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),Yt},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),SkinnedMesh.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},PerspectiveCamera.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),void 0!==t&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Light.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(BufferAttribute.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===_i},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(_i)}}}),BufferAttribute.prototype.setDynamic=function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?_i:xi),this},BufferAttribute.prototype.copyIndicesArray=function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},BufferAttribute.prototype.setArray=function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},BufferGeometry.prototype.addIndex=function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},BufferGeometry.prototype.addAttribute=function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?"index"===e?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new BufferAttribute(arguments[1],arguments[2])))},BufferGeometry.prototype.addDrawCall=function(e,t,i){void 0!==i&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},BufferGeometry.prototype.clearDrawCalls=function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},BufferGeometry.prototype.computeOffsets=function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},BufferGeometry.prototype.removeAttribute=function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},BufferGeometry.prototype.applyMatrix=function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)},Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),InterleavedBuffer.prototype.setDynamic=function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(!0===e?_i:xi),this},InterleavedBuffer.prototype.setArray=function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")},ExtrudeGeometry.prototype.getArrays=function(){console.error("THREE.ExtrudeGeometry: .getArrays() has been removed.")},ExtrudeGeometry.prototype.addShapeList=function(){console.error("THREE.ExtrudeGeometry: .addShapeList() has been removed.")},ExtrudeGeometry.prototype.addShape=function(){console.error("THREE.ExtrudeGeometry: .addShape() has been removed.")},Scene.prototype.dispose=function(){console.error("THREE.Scene: .dispose() has been removed.")},Uniform.prototype.onUpdate=function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this},Object.defineProperties(Material.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Color}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===v}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}},vertexTangents:{get:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")},set:function(){console.warn("THREE."+this.type+": .vertexTangents has been removed.")}}}),Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Oa.prototype.clearTarget=function(e,t,i,n){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,i,n)},Oa.prototype.animate=function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},Oa.prototype.getCurrentRenderTarget=function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},Oa.prototype.getMaxAnisotropy=function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},Oa.prototype.getPrecision=function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},Oa.prototype.resetGLState=function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},Oa.prototype.supportsFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},Oa.prototype.supportsHalfFloatTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},Oa.prototype.supportsStandardDerivatives=function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},Oa.prototype.supportsCompressedTextureS3TC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},Oa.prototype.supportsCompressedTexturePVRTC=function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},Oa.prototype.supportsBlendMinMax=function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},Oa.prototype.supportsVertexTextures=function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},Oa.prototype.supportsInstancedArrays=function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},Oa.prototype.enableScissorTest=function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},Oa.prototype.initMaterial=function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},Oa.prototype.addPrePlugin=function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},Oa.prototype.addPostPlugin=function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},Oa.prototype.updateShadowMap=function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},Oa.prototype.setFaceCulling=function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},Oa.prototype.allocTextureUnit=function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},Oa.prototype.setTexture=function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},Oa.prototype.setTexture2D=function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},Oa.prototype.setTextureCube=function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},Oa.prototype.getActiveMipMapLevel=function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()},Object.defineProperties(Oa.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=!0===e?Qt:$t}},toneMappingWhitePoint:{get:function(){return console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed."),1},set:function(){console.warn("THREE.WebGLRenderer: .toneMappingWhitePoint has been removed.")}}}),Object.defineProperties(Ea.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Audio.prototype.load=function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");const t=this;return(new AudioLoader).load(e,(function(e){t.setBuffer(e)})),this},AudioAnalyser.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},CubeCamera.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)},CubeCamera.prototype.clear=function(e,t,i,n){return console.warn("THREE.CubeCamera: .clear() is now .renderTarget.clear()."),this.renderTarget.clear(e,t,i,n)},ImageUtils.crossOrigin=void 0,ImageUtils.loadTexture=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");const s=new TextureLoader;s.setCrossOrigin(this.crossOrigin);const r=s.load(e,i,void 0,n);return t&&(r.mapping=t),r},ImageUtils.loadTextureCube=function(e,t,i,n){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");const s=new CubeTextureLoader;s.setCrossOrigin(this.crossOrigin);const r=s.load(e,i,void 0,n);return t&&(r.mapping=t),r},ImageUtils.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},ImageUtils.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};const Wd={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/jsm/utils/SceneUtils.js")}};function Kd(){console.error("THREE.LensFlare has been moved to /examples/jsm/objects/Lensflare.js")}function Yd(){return console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),new BufferGeometry}function qd(){return console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),new BufferGeometry}function Zd(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function $d(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function Qd(){console.error("THREE.ImmediateRenderObject has been removed.")}"undefined"!=typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:n}})),"undefined"!=typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=n)},92924:(e,t,i)=>{"use strict";i.d(t,{ej:()=>l,kG:()=>c,U6:()=>p});var n=i(70655);!function(e){function t(){var t=this||self;t.globalThis=t,delete e.prototype._T_}"object"!=typeof globalThis&&(this?t():(e.defineProperty(e.prototype,"_T_",{configurable:!0,get:t}),_T_))}(Object);const s=globalThis;var r="Invariant Violation",o=Object.setPrototypeOf,a=void 0===o?function(e,t){return e.__proto__=t,e}:o,l=function(e){function t(i){void 0===i&&(i=r);var n=e.call(this,"number"==typeof i?r+": "+i+" (see https://github.com/apollographql/invariant-packages)":i)||this;return n.framesToPop=1,n.name=r,a(n,t.prototype),n}return(0,n.ZT)(t,e),t}(Error);function c(e,t){if(!e)throw new l(t)}var d=["log","warn","error","silent"],h=d.indexOf("log");function u(e){return function(){if(d.indexOf(e)>=h)return console[e].apply(console,arguments)}}function p(e){var t=d[h];return h=Math.max(0,d.indexOf(e)),t}!function(e){e.log=u("log"),e.warn=u("warn"),e.error=u("error")}(c||(c={}));var m=s.process||{env:{}};if(!s.process)try{Object.defineProperty(s,"process",{value:m})}catch(e){}},52720:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ErrorType:()=>g,default:()=>ErrorGui});var n=i(47724),s=i(41452),r=i(13789),o=i(60771),a=i(87207),l=i(68472),c=i(75673),d=i(81826);const h=e=>({problem:"",solution:e.t(r.Z.ERROR_BROWSER_SOLUTION),explanation:e.t(r.Z.ERROR_BROWSER_EXPLANATION),actions:(0,o.tq)()?"":["<div id='browser-tiles'>","<a href='https://www.google.com/chrome/browser/' target='_blank'>","<div class='tile'>",`<img src=${a}>`,"</div>","</a>","<a href='https://www.mozilla.org/en-US/firefox/new/' target='_blank'>","<div class='tile'>",`<img src=${l}>`,"</div>","</a>","<a href='https://www.microsoft.com/en-us/edge' target='_blank'>","<div class='tile'>",`<img src=${c}>`,"</div>","</a>","<a href='https://support.apple.com/en-us/HT204416' target='_blank'>","<div class='tile'>",`<img src=${d}>`,"</div>","</a>","</div>"].join("")}),u=e=>Object.assign(Object.assign({},h(e)),{problem:`${e.t(r.Z.ERROR_WEBGL_UNSUPPORTED_PROBLEM)}`}),p="https://support.matterport.com/hc/articles/208220058",m=e=>{const t=p,i=(0,o.tq)()?e.t(r.Z.ERROR_GENERIC_ACTIONS_MOBILE,{"support-url":t}):e.t(r.Z.ERROR_GENERIC_ACTIONS,{"browsers-url":"#install-browser","support-url":t});return{problem:e.t(r.Z.ERROR_GENERIC_PROBLEM),solution:e.t(r.Z.ERROR_GENERIC_SOLUTION),explanation:"",actions:i}},f=e=>{const t=e.t(r.Z.ERROR_LOADING_FAILED_ACTIONS,{"support-url":"https://support.matterport.com/hc/articles/208220058"});return{problem:e.t(r.Z.ERROR_LOADING_FAILED_PROBLEM),solution:"",explanation:"",actions:t}};var g;!function(e){e[e.UNSUPPORTED=1]="UNSUPPORTED",e[e.WEBGL=2]="WEBGL",e[e.GENERIC=3]="GENERIC"}(g||(g={}));class ErrorGui extends n.Y{constructor(){super(...arguments),this.name="error-gui"}async init(e,t){this.container=document.querySelector("#error-container"),this.problem=document.querySelector("#error-problem"),this.solution=document.querySelector("#error-solution"),this.explanation=document.querySelector("#error-explanation"),this.actions=document.querySelector("#error-actions"),this.localeModule=await t.getModule(s.default)}showError(e){switch(e){case g.UNSUPPORTED:this.populateErrorScreen(u);break;case g.WEBGL:this.populateErrorScreen(m);break;case g.GENERIC:default:this.populateErrorScreen(f)}const t=this.actions.querySelector('[href="#install-browser"]');t&&t.addEventListener("click",(e=>{e.preventDefault(),this.populateErrorScreen(h)}))}populateErrorScreen(e){const t=e(this.localeModule);this.container.classList.remove("hidden"),this.problem.innerText=t.problem,this.solution.innerText=t.solution,this.explanation.innerText=t.explanation,this.actions.innerHTML=t.actions}}},68944:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseGui});var n,s,r=i(67294),o=i(73935),a=i(47724),l=i(85893),c=i(94184),d=i.n(c),h=i(8150),u=i(21479),p=i(79553),m=i(25813),f=i(13789),g=i(35597),v=i(27326),y=i(3805),b=i(96216),S=i(88512);!function(e){e.Inside="panorama",e.InsideMesh="mesh",e.Dollhouse="dollhouse",e.Floorplan="floorplan",e.None="none"}(n||(n={})),function(e){e.Inside="click_inside_mode_button",e.InsideMesh="click_mesh_mode_button",e.Dollhouse="click_dollhouse_mode_button",e.Floorplan="click_dollhouse_mode_button"}(s||(s={}));var E=i(60771),T=i(36114),w=i(47210),x=i(33746);class ModeButton extends r.Component{constructor(e){super(e),this.onClick=()=>{const{buttonId:e,analyticsName:t}=this.props;this.props.onClick(e,t)}}static isTouchDevice(){return(0,E.Jm)()}get tooltip(){return this.context.locale.t(this.props.tooltipPhraseKey)}render(){const{disabled:e,decorative:t,active:i,buttonId:n,tooltipPos:s}=this.props,r=i?w.BN.ACTIVE:e?w.BN.DISABLED:t?w.BN.DECORATIVE:w.BN.ENABLED,o=!ModeButton.isTouchDevice(),a=`icon-${n}`;return(0,l.jsx)(T.hU,Object.assign({onClick:this.onClick,className:`mode-${n}`,iconClass:o?void 0:a,buttonState:r,ariaLabel:this.tooltip},{children:o&&(0,l.jsx)(x.oO,Object.assign({content:this.tooltip,position:s||x.lZ.UP},{children:(0,l.jsx)("span",{className:`icon ${a}`},void 0)}),void 0)}),void 0)}}ModeButton.contextType=m.I;var _=i(3248);const M=["dh",_.gx.Dollhouse],O=["fp",_.gx.FloorPlan];function A(e,t){if(t)return!1;const i=e.checkUrlParam("dh",0,1),n=!e.tryGetProperty(_.gx.Dollhouse,!1);return i||n}function C(e,t){if(t)return!1;const i=e.checkUrlParam("fp",0,1),n=!e.tryGetProperty(_.gx.FloorPlan,!1);return i||n}function P(e,t){return!t&&!e}function D(e,t,i){const s=e===t;switch(e){case n.Dollhouse:case n.Floorplan:return i||!s;case n.Inside:return i?t!==n.InsideMesh:!s;case n.InsideMesh:return i?s:t===n.Inside}return!1}const N=new S.Z("mode-buttons");class ModeButtons extends r.Component{constructor(e){super(e),this.onClick=async(e,t)=>{const{transitioning:i}=this.props;if(i)return;const s=function(e){switch(e){case n.Dollhouse:return y.BD.DOLLHOUSE;case n.Floorplan:return y.BD.FLOORPLAN;case n.Inside:return y.BD.INSIDE;case n.InsideMesh:return y.BD.MESH;default:throw new Error(`cannot get viewmode for mode buttonId ${e}`)}}(e),{analytics:r,commandBinder:o}=this.context;r.track("showcase_gui",{gui_action:t});try{await o.issueCommand(new b.vy),await o.issueCommand(new y._i(s))}catch(e){N.warn(e)}}}render(){const{activeButtonId:e,transitioning:t,viewmodeChangeEnabled:i,activeStateDisplay:r,dollhousePrevented:o,floorplanPrevented:a,insidePrevented:c,meshPrevented:d}=this.props,h=r?x.lZ.DOWN:x.lZ.UP,u=!i,p=t,m=!d&&D(n.InsideMesh,e,!!r),g=!c&&D(n.Inside,e,!!r),v=!o&&D(n.Dollhouse,e,!!r),y=!a&&D(n.Floorplan,e,!!r);return(0,l.jsxs)("div",Object.assign({className:"mode-buttons"},{children:[m&&(0,l.jsx)(ModeButton,{tooltipPhraseKey:f.Z.VIEW_INSIDE_MESH,tooltipPos:h,analyticsName:s.InsideMesh,buttonId:n.InsideMesh,active:e===n.InsideMesh,onClick:this.onClick,disabled:u,decorative:p},void 0),g&&(0,l.jsx)(ModeButton,{tooltipPhraseKey:f.Z.VIEW_INSIDE,tooltipPos:h,analyticsName:s.Inside,buttonId:n.Inside,active:e===n.Inside,onClick:this.onClick,disabled:u,decorative:p},void 0),v&&(0,l.jsx)(ModeButton,{tooltipPhraseKey:f.Z.VIEW_DOLLHOUSE,tooltipPos:h,analyticsName:s.Dollhouse,buttonId:n.Dollhouse,active:e===n.Dollhouse,onClick:this.onClick,disabled:u,decorative:p},void 0),y&&(0,l.jsx)(ModeButton,{tooltipPhraseKey:f.Z.VIEW_FLOORPLAN,tooltipPos:h,analyticsName:s.Floorplan,buttonId:n.Floorplan,active:e===n.Floorplan,onClick:this.onClick,disabled:u,decorative:p},void 0)]}),void 0)}}ModeButtons.contextType=m.I;class ModeControls extends r.Component{constructor(e){super(e),this.bindings=[],this.isUnmounting=!1,this.updateDollhouseState=()=>{const{editMode:e,settings:t}=this.context;this.setState({dollhousePrevented:A(t,e)})},this.updateFloorplanState=()=>{const{editMode:e,settings:t}=this.context;this.setState({floorplanPrevented:C(t,e)})},this.onCurrentFloorChanged=()=>{const{editMode:e}=this.context,t=this.floorsViewData.currentFloor,i=this.floorsViewData.hasEnabledAlignedSweeps(t&&t.id);this.setState({insidePrevented:P(i,e)})},this.onViewmodeChangeLockUpdate=()=>{const{market:e}=this.context,t=e.tryGetData(g.O);if(!t)return;const i=t.viewmodeChangeEnabled;this.setState({viewmodeChangeEnabled:i})},this.state={dollhousePrevented:!1,floorplanPrevented:!1,insidePrevented:!1,viewmodeChangeEnabled:!0}}componentDidMount(){const{market:e,settings:t}=this.context;Promise.all([e.waitForData(g.O),e.waitForData(v.c)]).then((([e,i])=>{this.isUnmounting||(this.floorsViewData=i,this.bindings.push(e.onPropertyChanged("viewmodeChangeEnabled",this.onViewmodeChangeLockUpdate),i.makeFloorChangeSubscription(this.onCurrentFloorChanged)),M.forEach((e=>{this.bindings.push(t.onPropertyChanged(e,this.updateDollhouseState))})),O.forEach((e=>{this.bindings.push(t.onPropertyChanged(e,this.updateFloorplanState))})),this.onCurrentFloorChanged(),this.updateDollhouseState(),this.updateFloorplanState(),this.onViewmodeChangeLockUpdate())}))}componentWillUnmount(){this.isUnmounting=!0;for(const e of this.bindings)e.cancel();this.bindings=[]}render(){const{editMode:e}=this.context,{unaligned:t,viewmode:i,activeStateDisplay:s}=this.props,{viewmodeChangeEnabled:r,dollhousePrevented:o,floorplanPrevented:a,insidePrevented:c}=this.state,d=i===y.BD.TRANSITIONING;d||(this.activeButtonId=function(e,t){if(e)return n.None;switch(t){case y.BD.DOLLHOUSE:return n.Dollhouse;case y.BD.FLOORPLAN:return n.Floorplan;case y.BD.INSIDE:return n.Inside;case y.BD.MESH:return n.InsideMesh}return n.None}(t,i));const h=function(e){return!e}(e);return(0,l.jsx)(ModeButtons,{activeStateDisplay:s,activeButtonId:this.activeButtonId,transitioning:d,dollhousePrevented:o,floorplanPrevented:a,insidePrevented:c,meshPrevented:h,viewmodeChangeEnabled:r},void 0)}}ModeControls.contextType=m.I;var I=i(2116),L=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const R=new S.Z("tour-controls");let k=class TourControls extends r.Component{constructor(e){super(e),this.handlePlayPause=async()=>{if(!this.props.tourEmpty)try{this.props.tourPlaying?await this.stopTour():(this.context.analytics.track("showcase_gui",{gui_action:"play_highlights",tool:"hlr"}),await this.startTour())}catch(e){R.debug(e)}}}async startTour(){try{await this.context.commandBinder.issueCommand(new b.TH)}catch(e){R.debug(e)}}async stopTour(){try{this.context.analytics.track("showcase_gui",{gui_action:"pause_highlights"}),await this.context.commandBinder.issueCommand(new b.vy)}catch(e){R.debug(e)}}render(){const{tourEmpty:e,tourPlaying:t}=this.props,i="ontouchstart"in window,n=e?w.BN.DISABLED:t?w.BN.ACTIVE:w.BN.ENABLED,s=t?this.context.locale.t(f.Z.PAUSE):this.context.locale.t(f.Z.PLAY);return(0,l.jsx)(T.hU,Object.assign({buttonState:n,onClick:this.handlePlayPause,className:"tour-controls",ariaLabel:s},{children:e?(0,l.jsx)("span",{className:"icon icon-play"},void 0):(0,l.jsx)(x.oO,Object.assign({content:s,position:x.lZ.UP,tooltipTimeout:i?1e3:void 0},{children:(0,l.jsx)("span",{className:d()({icon:!0,"icon-pause-outline":t,"icon-play":!t})},void 0)}),void 0)}),void 0)}};k.contextType=m.I,k=L([I.Z],k);const U=k,B=250;var F,V;!function(e){e.horizontal="horizontal",e.vertical="vertical"}(F||(F={})),function(e){e.x="x",e.y="y"}(V||(V={}));const H=e=>{switch(e){case F.horizontal:return V.x;case F.vertical:return V.y}throw Error()},j=e=>{switch(e){case V.x:return F.horizontal;case V.y:return F.vertical}throw Error()},G={[F.horizontal]:{scrollOffset:"scrollLeft",offsetLength:"offsetWidth",clientLength:"clientWidth",positionOffset:"offsetLeft",lengthName:"width",offsetName:"left",eventPosition:"clientX",delta:V.x},[F.vertical]:{scrollOffset:"scrollTop",offsetLength:"offsetHeight",clientLength:"clientHeight",positionOffset:"offsetTop",lengthName:"height",offsetName:"top",eventPosition:"clientY",delta:V.y}};var z;!function(e){e.Beginning="Beginning",e.Middle="Middle",e.End="End",e.None="None"}(z||(z={}));const W=(e,t)=>{for(const i in t)if(e[i]!==t[i])return!0;return!1};var K=i(74002),Y=i(57812);class InputFilter{constructor(e){this.couldBeDrag=!1,this.isDragging=!1,this.shouldHandleEvents=!0,this.handleEvent=e=>{if(this.shouldHandleEvents)switch(e.stopPropagation(),e.type){case"mousedown":case"touchstart":case"pointerdown":this.onPressStart(e);break;case"mousemove":case"pointermove":case"touchmove":this.onPressMove(e);break;case"mouseup":case"pointerup":case"mouseleave":case"touchend":case"touchcancel":case"pointercancel":case"pointerleave":this.onPressEnd(e)}},this.callbacks=e}setEnabled(e){this.shouldHandleEvents=e,this.couldBeDrag=this.couldBeDrag&&e}getPosition(e){return(0,K.z6)(e)?{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}:{x:e.clientX,y:e.clientY}}onPressStart(e){this.couldBeDrag=!0,this.dragEvents=[],this.dragStart=this.getPosition(e),this.callbacks.handlePressStart&&this.callbacks.handlePressStart(this.getPosition(e))}onPressMove(e){if(!this.couldBeDrag)return;const t=this.getPosition(e);this.addDragEvent(t),this.isDragging||Math.sqrt(Math.pow(t.x-this.dragStart.x,2)+Math.pow(t.y-this.dragStart.y,2))>Y.JU&&(this.isDragging=!0,this.callbacks.handleDragStart&&this.callbacks.handleDragStart()),this.callbacks.handlePressMove&&this.callbacks.handlePressMove({x:this.dragStart.x-t.x,y:this.dragStart.y-t.y})}onPressEnd(e){if(this.couldBeDrag){if(this.couldBeDrag=!1,this.isDragging){if(!this.dragEvents||!this.dragEvents[0])return;const e=this.dragEvents[0],t=this.dragEvents[this.dragEvents.length-1];if(this.callbacks.handleDragEnd){const i={x:0,y:0};Date.now()-t.timestamp<InputFilter.dragMoveTimeout&&(i.x=e.position.x-t.position.x,i.y=e.position.y-t.position.y),this.callbacks.handleDragEnd(i,t.timestamp-e.timestamp)}}else this.callbacks.handleClick&&this.callbacks.handleClick(e);this.isDragging=!1}}addDragEvent(e){this.dragEvents.push({position:e,timestamp:Date.now()}),this.dragEvents.length>10&&this.dragEvents.shift()}}InputFilter.dragMoveTimeout=100;class Scrollbar extends r.Component{constructor(e){super(e),this.state={visible:!1,trackLength:1,thumbLength:1,thumbOffset:0},this.direction=G[e.direction],this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleTrackClick=this.handleTrackClick.bind(this),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove}),window.PointerEvent||(window.addEventListener("mousemove",this.inputFilter.handleEvent),window.addEventListener("mouseleave",this.inputFilter.handleEvent),window.addEventListener("mouseup",this.inputFilter.handleEvent)),window.addEventListener("pointermove",this.inputFilter.handleEvent),window.addEventListener("pointerup",this.inputFilter.handleEvent)}componentWillUnmount(){window.PointerEvent||(window.removeEventListener("mousemove",this.inputFilter.handleEvent),window.removeEventListener("mouseleave",this.inputFilter.handleEvent),window.removeEventListener("mouseup",this.inputFilter.handleEvent)),window.removeEventListener("pointermove",this.inputFilter.handleEvent),window.removeEventListener("pointerup",this.inputFilter.handleEvent)}getTrackLength(){return Number(this.thumbTrack&&this.thumbTrack[this.direction.clientLength]||window.innerWidth)}handleTrackClick(e){if(e.target!==this.thumbTrack)return;const t=this.direction.eventPosition,i=this.thumbTrack.getBoundingClientRect()[this.direction.offsetName],n=e[t]<i+this.state.thumbOffset,s=this.getTrackLength();let r=0;r=n?Math.max(0,(this.state.thumbOffset-this.state.thumbLength)/s):Math.min(s,(this.state.thumbOffset+this.state.thumbLength)/s),this.props.scrollTo({[H(this.props.direction)]:r})}handlePressStart(e){this.dragStartThumbOffset=this.state.thumbOffset}handlePressMove(e){const t=this.getTrackLength(),i=(this.dragStartThumbOffset-e[this.direction.delta])/t;this.props.scrollTo({[H(this.props.direction)]:i}),this.props.onThumbDrag&&this.props.onThumbDrag()}componentDidUpdate(){const{wrapperLength:e,childLength:t,scrollOffset:i}=this.props;if(e>0&&t>0){const s=this.getTrackLength(),r=e/t*s,o={thumbLength:r,visible:t>e,thumbOffset:Math.min(i/t*s,s-r)};if(W(this.state,o)){const e=this.state.visible!==o.visible;e&&this.props.onVisibilityChange&&this.props.onVisibilityChange(o.visible);const t=(n=o.thumbOffset/(s-r),o.visible?n<.01?z.Beginning:1-n<.01?z.End:z.Middle:z.None);(t!==this.scrollPosition||e)&&(this.scrollPosition=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)),this.setState(o)}}var n}render(){const e={[`${this.direction.lengthName}`]:this.state.thumbLength+"px",[`${this.direction.offsetName}`]:this.state.thumbOffset+"px"},t=this.inputFilter.handleEvent,i=window.PointerEvent,n=i?t:void 0,s=i?void 0:t,r=i?void 0:t;return(0,l.jsx)("div",{children:this.state.visible&&!this.props.forceHidden&&(0,l.jsx)("div",Object.assign({className:"scrollbarTrack "+this.props.direction,onClick:this.handleTrackClick,ref:e=>{this.thumbTrack=e}},{children:(0,l.jsx)("div",{className:"scrollbarThumb",style:e,onPointerDown:n,onMouseDown:r,onTouchStart:s},void 0)}),void 0)},void 0)}}var q=i(70179),Z=i(79437),$=i(85917);class Scrollbars extends r.Component{constructor(e){super(e),this.horizontal={scrollbar:null,animation:null,dragStartScroll:0},this.vertical={scrollbar:null,animation:null,dragStartScroll:0},this.prevSuppressDrag=!1,this.manuallyMoved=!1,this.isUnmounting=!1,this.scrollPosition={horizontal:z.Beginning,vertical:z.End},this.handleEvent=e=>{this.inputFilter.handleEvent(e)},this.getScrollableContainer=()=>this.innerWrapper,this.getScrolledOffset=e=>{const t=G[e].scrollOffset;return this.innerWrapper[t]/this.state[e].childLength},this.debouncedSetState=e=>{new URL(`${document.location}`).searchParams.get("temp-disable-debounce-scroll")?this.setState(e):(cancelAnimationFrame(this.rAFHandle),this.rAFHandle=requestAnimationFrame((()=>{this.isUnmounting||this.setState(e)})))},this.state={horizontal:{wrapperLength:1,childLength:1,scrollOffset:1,isVisible:!1},vertical:{wrapperLength:1,childLength:1,scrollOffset:1,isVisible:!1}},this.resizeSubscription=(0,$.kp)($.g_.RESIZE,(()=>this.handleExternalChange($.g_.RESIZE))),this.scrollTo=this.scrollTo.bind(this),this.handlePressStart=this.handlePressStart.bind(this),this.handlePressMove=this.handlePressMove.bind(this),this.handleDragEnd=this.handleDragEnd.bind(this),this.handleDragStart=this.handleDragStart.bind(this),this.handleWheelEvent=this.handleWheelEvent.bind(this),this.handleClick=this.handleClick.bind(this),this.toggleVisibility=this.toggleVisibility.bind(this),this.hasManuallyMoved=this.hasManuallyMoved.bind(this),this.prevSuppressDrag=!!e.suppressDrag,this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick});const t=this.handleEvent;window.PointerEvent||(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t)),window.addEventListener("pointermove",t),window.addEventListener("pointerup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t)}componentDidMount(){if(this.resizeSubscription.renew(),this.innerWrapper.addEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly)this.innerWrapper.addEventListener("click",this.handleClick);else{const e=this.handleEvent;this.innerWrapper.addEventListener("mousedown",e),this.innerWrapper.addEventListener("pointerdown",e),this.innerWrapper.addEventListener("touchstart",e)}this.firstChild=this.innerWrapper.firstElementChild,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(),this.props.hasOwnProperty("suppressDrag")&&this.inputFilter.setEnabled(!!this.props.suppressDrag)}componentWillUnmount(){this.isUnmounting=!0;const e=this.handleEvent;this.resizeSubscription.cancel(),window.PointerEvent||(window.removeEventListener("mousemove",e),window.removeEventListener("mouseleave",e),window.removeEventListener("mouseup",e)),window.removeEventListener("pointermove",e),window.removeEventListener("touchmove",e),window.removeEventListener("pointerup",e),window.removeEventListener("touchend",e),window.removeEventListener("touchcancel",e),this.innerWrapper.removeEventListener("wheel",this.handleWheelEvent,!0),this.props.thumbScrollingOnly?this.innerWrapper.removeEventListener("click",this.handleClick):(this.innerWrapper.removeEventListener("mousedown",e),this.innerWrapper.removeEventListener("pointerdown",e),this.innerWrapper.removeEventListener("touchstart",e))}componentDidUpdate(){if(this.props.waitToUpdate||this.handleExternalChange(),this.prevSuppressDrag!==this.props.suppressDrag&&(this.inputFilter.setEnabled(!!this.props.suppressDrag),this.props.suppressDrag&&(this.manuallyMoved=!1),this.prevSuppressDrag=!!this.props.suppressDrag),!this.horizontal.animation&&!this.vertical.animation)return;const e={};for(const t in this.state){const i=t;this[i].animation&&(this[i].animation.isAnimating?e[H(i)]=this[i].animation.getUpdatedValue():this[i].animation=null)}Object.keys(e).length>0&&window.requestAnimationFrame((()=>{this.innerWrapper&&this.scrollTo(e)}))}scrollTo(e){if(!e.hasOwnProperty(V.x)&&!e.hasOwnProperty(V.y))return;const t={};for(const i of this.getVisibleAxes(e)){const n=j(i),s=G[n].scrollOffset,r=e[i];if(void 0!==r){if(isNaN(r))return;this.innerWrapper[s]=Math.max(Math.min(1,r)*this.state[n].childLength,0),t[n]=Object.assign(Object.assign({},this.state[n]),{scrollOffset:this.innerWrapper[s]})}}this.setState(t)}animatedScrollTo(e,t){if(e.hasOwnProperty(V.x)||e.hasOwnProperty(V.y))for(const i of this.getVisibleAxes(e)){const n=j(i),s=G[n].scrollOffset;this[n].animation=new q.Z({duration:t||B,startValue:this.innerWrapper[s]/this.state[n].childLength,endValue:Math.max(0,Math.min(1,e[i]))})}}setScrollCenter(e){if(!(e&&e.compareDocumentPosition(this.innerWrapper)&Node.DOCUMENT_POSITION_CONTAINS))return;this.scrollCenter=e;const t={},i={};for(const n of this.getVisibleAxes(this.state)){const s=H(n);t[s]=e[G[n].positionOffset]+e[G[n].offsetLength]/2;let r=e;for(;r.parentElement&&r!==this.innerWrapper;)r=r.parentElement,t[s]+=r[G[n].positionOffset];const o=this.outerWrapper.parentElement[G[n].offsetLength];i[s]=(t[s]-o/2)/this.state[n].childLength}Object.keys(i).length>0&&this.animatedScrollTo(i)}getVisibleAxes(e){const t=[];for(const i in e)(e[i]||"number"==typeof e[i])&&(i in V&&this.state[j(i)].isVisible||i in F&&this.state[i].isVisible)&&t.push(i);return t}handleDragStart(){delete this.scrollCenter,this.hasManuallyMoved()}handlePressStart(){this.horizontal.dragStartScroll=this.innerWrapper.scrollLeft,this.vertical.dragStartScroll=this.innerWrapper.scrollTop}handlePressMove(e){const t={};for(const i of this.getVisibleAxes(e)){const n=j(i);t[i]=(e[i]+this[n].dragStartScroll)/this.state[n].childLength}this.scrollTo(t)}handleWheelEvent(e){this.props.singleScrollDirection===F.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.hasManuallyMoved(),this.handleExternalChange())}handleClick(e){this.props.handleClick&&this.props.handleClick(e)}toggleVisibility(e){return t=>{const i=Object.assign(Object.assign({},this.state[e]),{isVisible:t});if(W(this.state[e],i)){const t={};t[e]=i,this.setState(t),this.props.onScrollbarVisibilityChange&&this.props.onScrollbarVisibilityChange()}}}toggleScrollPosition(e){return t=>{this.scrollPosition[e]=t,this.props.onScrollPositionChange&&this.props.onScrollPositionChange(t)}}handleDragEnd(e,t){for(const i of this.getVisibleAxes(e)){const n=j(i),s=e[i]/t,r=Math.min(B,Math.abs(B*s)),o=this.innerWrapper[G[n].scrollOffset],a=s*r/2;this[n].animation=new q.Z({duration:r,startValue:o/this.state[n].childLength,endValue:Math.max(0,Math.min((o+a)/this.state[n].childLength,1)),easingFunction:Z.hl})}this.setState({})}handleExternalChange(e){if(this.isUnmounting)return;this.scrollCenter&&e&&e===$.g_.RESIZE&&this.setScrollCenter(this.scrollCenter);const t={};for(const e in this.state){const i=e,n=G[i].clientLength,s=Object.assign(Object.assign({},this.state[i]),{wrapperLength:Number(this.innerWrapper&&this.innerWrapper[n])||1,childLength:Number(this.firstChild&&this.firstChild[n])||1,scrollOffset:this.innerWrapper&&this.innerWrapper[G[i].scrollOffset]});W(this.state[i],s)&&(t[i]=s)}Object.keys(t).length>0&&this.debouncedSetState(t)}hasManuallyMoved(){this.manuallyMoved=!0,this.props.onScrolled&&this.props.onScrolled()}resetManuallyMoved(){this.manuallyMoved=!1}renderScrollbar(e,t){const{forceHidden:i}=this.props,{wrapperLength:n,childLength:s,scrollOffset:r}=t;return(0,l.jsx)(Scrollbar,{direction:e,ref:e=>{this.horizontal.scrollbar=e},wrapperLength:n,childLength:s,scrollOffset:r,scrollTo:this.scrollTo,onVisibilityChange:this.toggleVisibility(e),onScrollPositionChange:this.toggleScrollPosition(e),forceHidden:i,onThumbDrag:this.hasManuallyMoved},void 0)}render(){const{scrollbarHeight:e,singleScrollDirection:t,name:i,children:n}=this.props,s={maxHeight:e||""},r=t||`${F.vertical} ${F.horizontal}`;return(0,l.jsxs)("div",Object.assign({className:d()("outerScrollbarWrapper",r,`scrollbar-${i}`),ref:e=>{this.outerWrapper=e},style:s},{children:[(0,l.jsx)("div",Object.assign({className:"innerScrollbarWrapper",ref:e=>{this.innerWrapper=e}},{children:(0,l.jsx)("div",Object.assign({className:"paddingScrollbarWrapper"},{children:n}),void 0)}),void 0),t!==F.vertical&&this.renderScrollbar(F.horizontal,this.state.horizontal),t!==F.horizontal&&this.renderScrollbar(F.vertical,this.state.vertical)]}),void 0)}}const Q="floor-button";class FloorIconSelector extends r.Component{constructor(e){super(e),this.scrollbarsRef=(0,r.createRef)(),this.mobile=(0,E.tq)(),this.updateScrollCenter=()=>{if(Object.keys(this.props.floors).length<6||!this.scrollbarsRef.current)return;const{currentFloor:e}=this.props,t=e&&document.querySelector(`.floor-button[data-value="${e.id}"]`);t?this.scrollbarsRef.current.setScrollCenter(t):this.scrollbarsRef.current.scrollTo({y:0})},this.onOutsideClick=e=>{this.setShowMenu(!1)},this.onIconClick=e=>{e.stopPropagation(),this.setShowMenu(!this.state.showMenu),this.context.analytics.track("showcase_gui",{gui_action:"floor_controls"})},this.setShowMenu=e=>{this.state.showMenu!==e&&(e?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.setState({showMenu:e}))},this.onFloorClick=e=>{e.stopPropagation(),this.setShowMenu(!1);const t=e.target.getAttribute("data-value");this.props.handleClickFloor(t),this.context.analytics.track("showcase_gui",{gui_action:"floor_clicked"})},this.renderFloorName=e=>{const{currentFloor:t,currentFloorIndicator:i}=this.props,n=i&&(null==t?void 0:t.id)===e.id,s=d()(Q,{current:n});return(0,l.jsx)("div",Object.assign({className:s,onClick:this.onFloorClick,"data-value":e.id},{children:e.name}),e.id)},this.state={showMenu:!1}}componentDidMount(){this.updateScrollCenter()}componentWillUnmount(){window.removeEventListener("click",this.onOutsideClick)}componentDidUpdate(e){e.currentFloor!==this.props.currentFloor&&this.updateScrollCenter()}renderAllFloorName(){const e=!this.props.currentFloor,t=d()(Q,{current:e}),i=this.context.locale.t(f.Z.FLOOR_ALL);return(0,l.jsx)("div",Object.assign({className:t,onClick:this.onFloorClick},{children:i}),"all")}getFloorMenu(){const e=this.props.floors.map(this.renderFloorName).reverse();this.props.shouldShowAll&&e.unshift(this.renderAllFloorName());const t=e.length>=6,i=d()("floor-menu-wrapper",{"faded-in":this.state.showMenu,scrollable:t});return t?(0,l.jsx)("div",Object.assign({className:i},{children:(0,l.jsx)(Scrollbars,Object.assign({name:"floor-menu-wrapper",forceHidden:this.mobile,ref:this.scrollbarsRef,singleScrollDirection:F.vertical,onScrollbarVisibilityChange:this.updateScrollCenter},{children:e}),void 0)}),void 0):(0,l.jsx)("div",Object.assign({className:i},{children:e}),void 0)}render(){const{currentFloor:e,currentFloorIndicator:t}=this.props,{showMenu:i}=this.state,n=t&&e&&e.index+1,s=this.context.locale.t(f.Z.HELP_MORE_FLOORS_A),r=i?w.BN.ACTIVE:w.BN.ENABLED,o=d()("select-floor",{"tooltip-hidden":i}),a=d()("floor-number",{"two-digit":void 0!==n&&n>=10}),c=d()("icon",{"icon-floor-controls-all":!n,"icon-floor-controls":n});return(0,l.jsxs)(T.hU,Object.assign({buttonState:r,onClick:this.onIconClick,className:"floor-controls",ariaLabel:s},{children:[this.getFloorMenu(),(0,l.jsxs)(x.oO,Object.assign({content:s,position:x.lZ.UP,className:o},{children:[(0,l.jsx)("div",Object.assign({className:a},{children:(0,l.jsx)("span",{children:n},void 0)}),void 0),(0,l.jsx)("span",{className:c},void 0)]}),void 0)]}),void 0)}}FloorIconSelector.contextType=m.I;var X,J,ee=i(5087),te=i(19806),ie=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.NONE="no-arrow",e.TOP_LEFT="position-top-left",e.TOP_RIGHT="position-top-right",e.TOP_CENTER="position-top-center",e.BOTTOM_RIGHT="position-bottom-right",e.BOTTOM_LEFT="position-bottom-left",e.BOTTOM_CENTER="position-bottom-center",e.RIGHT_BOTTOM="position-right-bottom"}(J||(J={}));let ne=X=class Tooltip extends r.Component{constructor(e){super(e),this.tooltipWrapperRef=(0,r.createRef)(),this.tooltipContentRef=(0,r.createRef)(),this.maxDurationTimeout=0,this.addClickListenerTimeout=0,this.closeTooltip=()=>{this.setState({showing:!1}),window.removeEventListener("click",this.handleOutsideClick)},this.timeoutTooltip=()=>{this.closeTooltip(),this.props.onTimeout&&this.props.onTimeout()},this.openTooltip=e=>{this.setState({showing:!0}),this.addClickListenerTimeout=window.setTimeout((()=>{window.addEventListener("click",this.handleOutsideClick),void 0!==e&&(this.maxDurationTimeout=window.setTimeout(this.timeoutTooltip,e))}),0)},this.getContentPosition=()=>{if(!this.tooltipWrapperRef.current||!this.tooltipContentRef.current)return{};const e=this.tooltipWrapperRef.current.parentElement,t=this.tooltipContentRef.current;switch(this.props.arrowPos){case J.BOTTOM_RIGHT:return{transform:`translate(${15-t.offsetWidth}px, ${-t.offsetHeight-e.getBoundingClientRect().height-22}px)`};case J.BOTTOM_LEFT:return{transform:`translate(0, ${-t.offsetHeight-e.getBoundingClientRect().height-35}px)`};case J.RIGHT_BOTTOM:return{transform:`translate(${-t.offsetWidth-7}px, ${9-t.offsetHeight}px)`};default:return{}}},this.handleOutsideClick=e=>{this.props.onClose&&this.props.onClose(e)},this.state={showing:e.open};const t=X.count++;this.wrapperId=`tooltip-wrapper-${e.name||t}`,this.id=`${e.tooltipId||`tooltip-${t}`}`}static clearCount(){this.count=0}componentDidMount(){this.props.open&&this.openTooltip(this.props.maxMsOpen)}componentWillUnmount(){window.clearTimeout(this.maxDurationTimeout),window.clearTimeout(this.addClickListenerTimeout),window.removeEventListener("click",this.handleOutsideClick)}UNSAFE_componentWillReceiveProps(e){e.open&&!this.props.open?this.openTooltip(e.maxMsOpen):!e.open&&this.props.open&&this.closeTooltip()}render(){const{arrowPos:e,title:t,message:i,onClose:n,closeButton:s,darkTheme:r,appendHTML:o,bodyClassName:a,className:c}=this.props,{showing:h}=this.state,u={emulatedDialog:!0,open:h,dark:r,[void 0===e?J.TOP_CENTER:e]:!0};return(0,l.jsx)("div",Object.assign({id:this.wrapperId,className:d()(u,c),ref:this.tooltipWrapperRef},{children:(0,l.jsxs)("div",Object.assign({id:this.id,className:d()("tooltip",a),style:this.getContentPosition(),ref:this.tooltipContentRef},{children:[t&&(0,l.jsx)("div",Object.assign({className:"title"},{children:t}),void 0),s&&n&&(0,l.jsx)(te.P,{onClose:n},void 0),i,o]}),void 0)}),void 0)}};ne.POPUP_OFFSET=28,ne.count=0,ne=X=ie([I.Z],ne);class SelectMenu extends r.Component{constructor(e){super(e),this.onSelectOption=e=>{const{onChange:t}=this.props,i=e.target.getAttribute("data-value");this.closeMenu(),t(i)},this.onClick=e=>{const{open:t}=this.state;return t?this.closeMenu():this.openMenu()},this.onTooltipClose=()=>{this.closeMenu()},this.state={open:!1}}getSelectedOption(){return this.props.options.find((e=>e.selected))||null}openMenu(){this.setState({open:!0})}closeMenu(){this.setState({open:!1})}renderPopupContents(){const e=[];return this.props.options.forEach(((t,i)=>{const n=t.className||"";e.push((0,l.jsx)("div",Object.assign({"data-value":t.value,className:d()({tpMsg:!0,disabled:!!t.disabled,[n]:!!n}),onClick:this.onSelectOption},{children:t.text}),`${i}-${t.value}`))})),(0,l.jsx)("div",Object.assign({className:"tooltip-menu"},{children:e}),void 0)}render(){const{id:e,arrowPos:t,label:i,className:n,menuStyle:s,placeholder:r}=this.props,{open:o}=this.state,a=this.getSelectedOption(),c=a?a.text:r||"",h=s===se.BUTTON,u=s===se.DROPDOWN,p=d()("select-popup",{"select-button":h,"select-dropdown":u},n);return(0,l.jsxs)("div",Object.assign({className:p,id:e},{children:[i&&(0,l.jsx)("label",Object.assign({className:"select-label"},{children:i}),void 0),(0,l.jsxs)("div",Object.assign({className:"select-trigger",onClick:this.onClick},{children:[(0,l.jsx)("span",Object.assign({className:"select-menu-text"},{children:c}),void 0),(0,l.jsx)("span",{className:"icon icon-dpad-down"},void 0),(0,l.jsx)(ne,{open:!!o,onClose:this.onTooltipClose,message:this.renderPopupContents(),arrowPos:t||J.NONE,bodyClassName:"item-tooltip"},void 0)]}),void 0)]}),void 0)}}var se;!function(e){e[e.DROPDOWN=0]="DROPDOWN",e[e.BUTTON=1]="BUTTON"}(se||(se={}));var re=i(17490);function oe(e){return()=>{const{market:t}=(0,r.useContext)(m.I),[i,n]=(0,r.useState)(t.tryGetData(e));return(0,r.useEffect)((()=>{if(i)return()=>{};let s=!1;return t.waitForData(e).then((e=>{s||n(e)})),()=>s=!0}),[t]),i}}function ae(e,t){return i=>n=>{const s=t(),r=Object.assign(Object.assign({},n),{[e]:s});return(0,l.jsx)(i,Object.assign({},r),void 0)}}const le=oe(v.c),ce=ae("floorsViewData",le);function de(e){return e?e.getNavigableFloorIds().map(e.getViewData):[]}function he(){const e=le(),[t,i]=(0,r.useState)(e?e.currentFloorId:null);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=()=>{const t=e.currentFloorId;i(t)},n=e.makeFloorChangeSubscription(t);return t(),()=>n.cancel()}),[e]),t}const ue=ae("currentFloorId",he);function pe(){return function(e){const t=le(),[i,n]=(0,r.useState)(t&&null!==e?t.getViewData(e):null);return(0,r.useEffect)((()=>{if(!t)return()=>{};if(null===e)n(null);else{const i=t.getViewData(e);n(i)}return()=>{}}),[t,e]),i}(he())}const me=oe(g.O);var fe=i(2725);const ge=new S.Z("floor-controls-switch-floor");async function ve(e,t){const{analytics:i,commandBinder:n}=t;try{await n.issueCommand(new b.vy);const t=null===e?"click_toggle_all_floors_button":"click_floor_select_button";i.track("showcase_gui",{gui_action:t});const s=new fe.Vw(e);await n.issueCommand(s)}catch(e){ge.debug(e)}}var ye=i(41452);class DefaultLocale{t(){return""}}function be(){const{engine:e}=(0,r.useContext)(m.I),[t,i]=(0,r.useState)(new DefaultLocale);return(0,r.useEffect)((()=>{let t=!1;return e.getModule(ye.default).then((e=>{t||i(e)})),()=>{t=!0}}),[e]),t}function Se(e){const t=function(){const e=le(),[t,i]=(0,r.useState)(de(e));return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=()=>i(de(e)),n=new re.V(e.floors.onNameChange(t),e.onNavigableFloorIdsChanged(t));return t(),()=>n.cancel()}),[e]),t}(),i=function(){const e=me(),[t,i]=(0,r.useState)(null);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=e.currentModeObservable.onChanged(i);return i(e.currentMode),()=>t.cancel()}),[e]),t}(),n=pe(),s=(0,r.useContext)(m.I),{analytics:o}=s,a=be(),c=t.map((e=>({text:e.name,value:e.id,selected:(null==n?void 0:n.id)===e.id}))).reverse();i!==ee.Ey.Panorama&&c.unshift({text:a.t(f.Z.FLOOR_ALL),value:"",selected:!n});const h=d()("floor-menu-selector",e.className);return(0,l.jsx)(SelectMenu,{menuStyle:se.DROPDOWN,onChange:e=>{ve(e,s),o.track("showcase_gui",{gui_action:"floor_clicked"})},options:c,className:h},void 0)}var Ee=i(73844);class FloorControls extends r.Component{constructor(e){super(e),this.bindings=[],this.isUnmounting=!1,this.handleClickFloor=e=>{ve(e,this.context)},this.onCurrentFloorChanged=()=>{var e,t;const i=(null===(e=this.floorsViewData)||void 0===e?void 0:e.currentFloor)||void 0,n=i&&(null===(t=this.floorsViewData)||void 0===t?void 0:t.getViewData(i.id));this.setState({currentFloor:n})},this.onFloorsChanged=()=>{var e,t;const i=(null===(e=this.floorsViewData)||void 0===e?void 0:e.getNavigableFloorIds()).map(null===(t=this.floorsViewData)||void 0===t?void 0:t.getViewData);this.setState({floors:i})},this.state={currentFloorIndicator:!0,floors:[]}}onSettingsChanged(){const{settings:e}=this.context,t=e.tryGetProperty(Ee.u_,!0);this.setState({currentFloorIndicator:t})}componentDidMount(){const{settings:e,market:t}=this.context;e&&(this.bindings.push(e.onPropertyChanged(Ee.u_,(()=>this.onSettingsChanged()))),this.onSettingsChanged()),t&&t.waitForData(v.c).then((e=>{this.isUnmounting||(this.floorsViewData=e,this.bindings.push(this.floorsViewData.makeFloorChangeSubscription(this.onCurrentFloorChanged),this.floorsViewData.floors.onNameChange(this.onFloorsChanged),this.floorsViewData.onNavigableFloorIdsChanged(this.onFloorsChanged)),this.onCurrentFloorChanged(),this.onFloorsChanged())}))}componentWillUnmount(){this.isUnmounting=!0,this.bindings.forEach((e=>{e.cancel()}))}render(){const{viewmode:e,iconStyle:t}=this.props,{currentFloor:i,currentFloorIndicator:n,floors:s}=this.state;if(!(s.length>1&&e!==y.BD.OUTSIDE))return null;const r=e!==y.BD.INSIDE;return(0,l.jsxs)("div",Object.assign({className:"floor-selector"},{children:[t&&(0,l.jsx)(FloorIconSelector,{floors:s,currentFloor:i,handleClickFloor:this.handleClickFloor,shouldShowAll:r,currentFloorIndicator:n},void 0),!t&&(0,l.jsx)("span",{className:"divider"},void 0),!t&&(0,l.jsx)(Se,{},void 0)]}),void 0)}}FloorControls.contextType=m.I;var Te=i(49080),we=i(89046),xe=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let _e=class VrModalControls extends r.Component{constructor(e){super(e),this.handleClick=()=>{this.context.commandBinder.issueCommand(new we.Bz(Te.P.VR_SELECT,!this.props.open))}}render(){const e=this.context.locale.t(f.Z.VIEW_IN_VR);return(0,l.jsx)(T.hU,Object.assign({className:"view-in-vr",onClick:this.handleClick,ariaLabel:e},{children:(0,l.jsx)(x.oO,Object.assign({content:e,position:x.lZ.UP,tooltipTimeout:(0,E.Jm)()?1e3:void 0},{children:(0,l.jsx)("span",{className:"icon icon-vr"},void 0)}),void 0)}),void 0)}};_e.contextType=m.I,_e=xe([I.Z],_e);class FullscreenControls extends r.Component{constructor(e){super(e),this.handleButtonClick=()=>{E.rm()?(this.context.analytics.track("showcase_gui",{gui_action:"click_exit_fullscreen",interaction_source:"gui"}),E.Qg()):(this.context.analytics.track("showcase_gui",{gui_action:"click_enter_fullscreen",interaction_source:"gui"}),E.Zx(document.body))},this.onFullScreenChange=e=>{const{mainDiv:t}=this.context,i=E.rm();i?t.classList.add("full-screen"):t.classList.remove("full-screen"),this.setState({fullscreen:i})},this.state={fullscreen:E.rm()},document.addEventListener("fullscreenchange",this.onFullScreenChange),document.addEventListener("webkitfullscreenchange",this.onFullScreenChange),document.addEventListener("MSFullscreenChange",this.onFullScreenChange),document.addEventListener("mozfullscreenchange",this.onFullScreenChange)}componentWillUnmount(){document.removeEventListener("fullscreenchange",this.onFullScreenChange),document.removeEventListener("webkitfullscreenchange",this.onFullScreenChange),document.removeEventListener("MSFullscreenChange",this.onFullScreenChange),document.removeEventListener("mozfullscreenchange",this.onFullScreenChange)}render(){const e=E.Jm(),{fullscreen:t}=this.state,i=t?this.context.locale.t(f.Z.EXIT_FULLSCREEN):this.context.locale.t(f.Z.VIEW_FULLSCREEN);return(0,l.jsx)("div",Object.assign({className:"fullscreen-mode"},{children:(0,l.jsx)(T.hU,Object.assign({onClick:this.handleButtonClick,ariaLabel:i},{children:(0,l.jsx)(x.oO,Object.assign({content:i,position:x.lZ.UP_LEFT,tooltipTimeout:e?1e3:void 0},{children:(0,l.jsx)("span",{className:d()("icon",t?"icon-fullscreen-exit":"icon-fullscreen")},void 0)}),void 0)}),void 0)}),void 0)}}FullscreenControls.contextType=m.I;var Me=i(73394),Oe=i(66157),Ae=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ce=class HighlightButton extends r.Component{constructor(e){super(e),this.handleButtonClick=()=>{const e=this.props.reelOpen?"hide_":"show_";this.context.analytics.track("showcase_gui",{gui_action:e+"highlight_reel",tool:"hlr"}),this.props.onToggleHLR(!this.props.reelOpen)}}render(){const{reelEnabled:e,reelOpen:t}=this.props,i=t?this.context.locale.t(f.Z.CLOSE_HIGHLIGHTS):this.context.locale.t(f.Z.OPEN_HIGHLIGHTS);return e?(0,l.jsx)(T.hU,Object.assign({className:"highlight-button",onClick:this.handleButtonClick,ariaLabel:i,"aria-expanded":t?"true":"false"},{children:(0,l.jsx)(x.oO,Object.assign({content:i,position:x.lZ.UP_RIGHT,tooltipTimeout:(0,E.Jm)()?1e3:void 0},{children:(0,l.jsx)("span",{className:"icon "+(t?"icon-dpad-down":"icon-dpad-up")},void 0)}),void 0)}),void 0):null}};Ce.contextType=m.I,Ce=Ae([I.Z],Ce);const Pe=Ce,De=e=>e.innerWidth<487||e.innerHeight<487;var Ne=i(27408);class SingleScrollbar extends r.Component{constructor(e){super(e),this.outerWrapperRef=(0,r.createRef)(),this.innerWrapperRef=(0,r.createRef)(),this.contentContainerRef=(0,r.createRef)(),this.dragStartScroll=0,this.listening=!1,this.animation=null,this.handlingPaused=!1,this.isUnmounting=!1,this.handleEvent=e=>{"mousedown"!==e.type&&"pointerdown"!==e.type&&"touchstart"!==e.type||(this.handlingPaused=!1),this.props.suppressDrag||this.handlingPaused||this.inputFilter.handleEvent(e)},this.getScrolledOffset=()=>{if(!this.innerWrapperRef.current||0===this.state.contentSize)return 0;const e=this.props.direction===F.vertical?"scrollTop":"scrollLeft";return this.innerWrapperRef.current[e]/this.state.contentSize},this.getScrollableContainer=()=>this.innerWrapperRef.current||void 0,this.pauseScrollHandling=()=>{this.handlingPaused=!0,this.toggleDownEventListening(!1)},this.scrollWithScrollBar=e=>{if(!this.props.suppressDrag){const t=this.getAxis();e.hasOwnProperty(t)&&this.scrollTo(e[t])}},this.scrollTo=e=>{void 0===e||isNaN(e)||(this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentSize,0)),this.setState({scrollOffset:this.getScrollPosition()}))},this.handleDragStart=()=>{this.setState({scrollCenter:null})},this.handlePressStart=()=>{this.dragStartScroll=this.getScrollPosition()},this.handlePressMove=e=>{if(!this.props.suppressDrag){const t=(e[this.getAxis()]+this.dragStartScroll)/this.state.contentSize;this.scrollTo(t)}},this.handleWheelEvent=e=>{if(this.props.suppressDrag)return void e.preventDefault();this.props.direction===F.horizontal&&0===e.deltaX&&0!==e.deltaY?(this.handlePressStart(),this.handlePressMove({x:e.deltaY,y:0})):(this.setState({scrollCenter:null}),this.handleExternalChange())},this.handleClick=e=>{this.props.handleClick&&this.props.handleClick(e)},this.handleDragEnd=(e,t)=>{const i=e[this.getAxis()]/t,n=Math.min(B,Math.abs(B*i)),s=this.getScrollPosition(),r=i*n/2;this.animation=new q.Z({duration:n,startValue:s/this.state.contentSize,endValue:Math.max(0,Math.min((s+r)/this.state.contentSize,1)),easingFunction:Z.hl})},this.debouncedSetState=e=>{new URL(`${document.location}`).searchParams.get("temp-disable-debounce-scroll")?this.setState(e):(cancelAnimationFrame(this.rAFHandle),this.rAFHandle=requestAnimationFrame((()=>{this.isUnmounting||this.setState(e)})))},this.onManualScroll=()=>{this.props.onScrolled&&this.props.onScrolled()},this.onButtonScroll=e=>{if(this.contentContainerRef.current&&this.props.steps){const t=this.props.direction===F.vertical?"offsetHeight":"offsetWidth",i=this.contentContainerRef.current[t]/this.props.steps,n=this.getScrollPosition();let s;s=e?(n+i)/this.state.contentSize:(n-i)/this.state.contentSize,this.scrollTo((0,Ne.uZ)(s,0,1))}},this.onScrollBack=()=>{this.onButtonScroll(!1)},this.onScrollForward=()=>{this.onButtonScroll(!0)},this.onHoldScrollBack=()=>{this.mouseInterval=window.setInterval(this.onScrollBack,300)},this.onHoldScrollForward=()=>{this.mouseInterval=window.setInterval(this.onScrollForward,300)},this.onScrollButtonUp=()=>{window.clearInterval(this.mouseInterval)},this.renderScrollBackButton=()=>{const e=this.getScrollPosition(),t=this.props.direction===F.vertical?"icon-dpad-up":"icon-dpad-left",i=0===e?w.BN.DISABLED:w.BN.ENABLED;return(0,l.jsx)(T.hU,{className:d()("scroll-button","scroll-back"),iconClass:t,buttonStyle:T.Dd.CLEAR,buttonState:i,onClick:this.onScrollBack,onMouseDown:this.onHoldScrollBack,onMouseUp:this.onScrollButtonUp},void 0)},this.renderScrollForwardButton=()=>{const e=this.contentContainerRef.current,t=this.innerWrapperRef.current;if(!e||!t)return null;const i=this.getScrollPosition(),n=this.props.direction===F.vertical?"offsetHeight":"offsetWidth",s=this.props.direction===F.vertical?"icon-dpad-down":"icon-dpad-right",r=e[n]-t[n]-i>0?w.BN.ENABLED:w.BN.DISABLED;return(0,l.jsx)(T.hU,{className:d()("scroll-button","scroll-forward"),iconClass:s,buttonStyle:T.Dd.CLEAR,buttonState:r,onClick:this.onScrollForward,onMouseDown:this.onHoldScrollForward,onMouseUp:this.onScrollButtonUp},void 0)},this.state={scrollCenter:null,scrollOffset:0,innerSize:0,contentSize:0},this.resizeSubscription=(0,$.kp)($.g_.RESIZE,(()=>this.handleExternalChange($.g_.RESIZE))),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd,handleClick:this.handleClick})}componentDidMount(){this.resizeSubscription.renew(),this.props.thumbScrollingOnly?this.innerWrapperRef.current&&this.innerWrapperRef.current.addEventListener("click",this.handleClick):this.toggleDownEventListening(!0),this.toggleDragHandling(!0),this.innerWrapperRef.current&&this.innerWrapperRef.current.addEventListener("wheel",this.handleWheelEvent),this.inputFilter.setEnabled(!this.props.suppressDrag),this.handleExternalChange()}componentWillUnmount(){this.isUnmounting=!0,this.resizeSubscription.cancel(),this.innerWrapperRef.current&&this.innerWrapperRef.current.removeEventListener("wheel",this.handleWheelEvent),this.toggleDragHandling(!1),this.props.thumbScrollingOnly?this.innerWrapperRef.current&&this.innerWrapperRef.current.removeEventListener("click",this.handleClick):this.toggleDownEventListening(!1)}UNSAFE_componentWillReceiveProps(e){e.thumbScrollingOnly&&!this.props.thumbScrollingOnly?(this.innerWrapperRef.current&&this.innerWrapperRef.current.addEventListener("click",this.handleClick),this.toggleDownEventListening(!1)):!e.thumbScrollingOnly&&this.props.thumbScrollingOnly&&(this.toggleDownEventListening(!0),this.innerWrapperRef.current&&this.innerWrapperRef.current.removeEventListener("click",this.handleClick)),e.suppressDrag!==this.props.suppressDrag&&this.inputFilter.setEnabled(!e.suppressDrag)}componentDidUpdate(e,t){this.props.waitToUpdate||this.handleExternalChange();const i=this.animation;if(i)if(i.isAnimating){const e=i.getUpdatedValue();window.requestAnimationFrame((()=>{this.innerWrapperRef.current&&this.scrollTo(e)}))}else this.animation=null;t.scrollOffset!==this.state.scrollOffset&&this.props.onScrolled&&this.props.onScrolled()}toggleDownEventListening(e){const t=this.handleEvent;this.innerWrapperRef.current&&(e?window.PointerEvent?this.innerWrapperRef.current.addEventListener("pointerdown",t):(this.innerWrapperRef.current.addEventListener("mousedown",t),this.innerWrapperRef.current.addEventListener("touchstart",t)):window.PointerEvent?this.innerWrapperRef.current.removeEventListener("pointerdown",t):(this.innerWrapperRef.current.removeEventListener("mousedown",t),this.innerWrapperRef.current.removeEventListener("touchstart",t)))}toggleDragHandling(e){const t=this.handleEvent;!this.listening&&e?(this.listening=!0,window.PointerEvent?(window.addEventListener("pointermove",t),window.addEventListener("pointerup",t)):(window.addEventListener("mousemove",t),window.addEventListener("mouseleave",t),window.addEventListener("mouseup",t),window.addEventListener("touchmove",t),window.addEventListener("touchend",t),window.addEventListener("touchcancel",t))):this.listening&&!e&&(this.listening=!1,window.PointerEvent?(window.removeEventListener("pointermove",t),window.removeEventListener("pointerup",t)):(window.removeEventListener("mousemove",t),window.removeEventListener("mouseleave",t),window.removeEventListener("mouseup",t),window.removeEventListener("touchmove",t),window.removeEventListener("touchend",t),window.removeEventListener("touchcancel",t)))}getScrollPosition(){if(!this.innerWrapperRef.current)return 0;const e=this.props.direction===F.vertical?"scrollTop":"scrollLeft";return this.innerWrapperRef.current[e]}setScrollPosition(e){if(!this.innerWrapperRef.current)return;const t=this.props.direction===F.vertical?"scrollTop":"scrollLeft";this.innerWrapperRef.current[t]=e}getAxis(){return this.props.direction===F.vertical?"y":"x"}scrollToPercentage(e,t){this.animation=new q.Z({duration:t,startValue:this.getScrolledOffset(),endValue:Math.max(0,Math.min(1,e))})}scrollToElement(e){const t=this.innerWrapperRef.current,i=this.outerWrapperRef.current;if(!e||!t||!i)return;if(!(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINS))return;const n=this.props.direction===F.vertical;this.setState({scrollCenter:e});const s=n?"offsetTop":"offsetLeft",r=n?"offsetHeight":"offsetWidth";let o=e[s]+e[r]/2,a=e;for(;a.parentElement&&a!==t;)a=a.parentElement,o+=a[s];const l=(o-i.parentElement[r]/2)/this.state.contentSize;this.animation=new q.Z({duration:B,startValue:this.getScrollPosition()/this.state.contentSize,endValue:Math.max(0,Math.min(1,l))})}handleExternalChange(e){if(this.isUnmounting||!this.innerWrapperRef.current||!this.contentContainerRef.current)return;this.state.scrollCenter&&e&&e===$.g_.RESIZE&&this.scrollToElement(this.state.scrollCenter);const t=this.props.direction===F.vertical?"clientHeight":"clientWidth",i={innerSize:Number(this.innerWrapperRef.current&&this.innerWrapperRef.current[t])||1,contentSize:Number(this.contentContainerRef.current&&this.contentContainerRef.current[t])||1,scrollOffset:this.innerWrapperRef.current&&this.getScrollPosition()};W(this.state,i)&&this.debouncedSetState(i)}needScrolling(){if(!this.contentContainerRef.current||!this.outerWrapperRef.current)return!1;const e=this.props.direction===F.vertical?"offsetHeight":"offsetWidth";return this.contentContainerRef.current[e]>this.outerWrapperRef.current[e]}render(){const{hideScrollbar:e,children:t,onScrollableChanged:i,scrollButtons:n,steps:s,onScrollPositionChange:r,direction:o,className:a}=this.props,{innerSize:c,contentSize:h,scrollOffset:u}=this.state,p=n&&!!s&&this.needScrolling();return(0,l.jsxs)("div",Object.assign({className:d()("outerScrollbarWrapper",[o],[a],{"button-scrolling":p}),ref:this.outerWrapperRef},{children:[p&&this.renderScrollBackButton(),(0,l.jsx)("div",Object.assign({className:"innerScrollbarWrapper",ref:this.innerWrapperRef},{children:(0,l.jsx)("div",Object.assign({className:"paddingScrollbarWrapper",ref:this.contentContainerRef},{children:t}),void 0)}),void 0),(0,l.jsx)(Scrollbar,{direction:o,wrapperLength:c,childLength:h,scrollOffset:u,scrollTo:this.scrollWithScrollBar,forceHidden:!!e,onVisibilityChange:i,onScrollPositionChange:r,onThumbDrag:this.onManualScroll},void 0),p&&this.renderScrollForwardButton()]}),void 0)}}class ReelScrollContainer extends r.Component{constructor(e){super(e),this.scrollbarRef=(0,r.createRef)(),this.elementRef=(0,r.createRef)(),this.onWindowResize=()=>{const e=De(window);this.state.hideScrollbar!==e&&this.setState({hideScrollbar:e})},this.onScrollableChanged=e=>{this.setState({scrollable:e})},this.onScrollPositionChange=e=>{this.setState({scrollPosition:e})},this.getScrollableContainer=()=>{const e=this.scrollbarRef.current;return(null==e?void 0:e.getScrollableContainer())||void 0},this.handleHighlightClickable=()=>{this.props.highlightClickable(!0)},this.state={scrollLeft:0,hideScrollbar:De(window),scrollPosition:z.None,scrollable:!1},this.resizeSubscription=(0,$.kp)($.g_.RESIZE,this.onWindowResize)}componentDidMount(){this.resizeSubscription.renew(),this.onScrollableChanged(!0),this.onScrollPositionChange(z.Beginning)}componentWillUnmount(){this.resizeSubscription.cancel()}componentDidUpdate(e){const{activeElement:t}=this.props;if(null!==t&&e.activeElement!==t){const e=this.scrollbarRef.current;e&&e.scrollToElement(t)}}setSorting(e){const t=this.elementRef.current;if(t)if(e){if(t.classList.add("sorting"),this.props.mobile){const e=this.scrollbarRef.current;e&&e.pauseScrollHandling()}}else t.classList.remove("sorting")}render(){const{thumbScrollingOnly:e,children:t,totalSteps:i}=this.props,{hideScrollbar:n,scrollPosition:s,scrollable:r}=this.state,o=d()({scrollable:r,[s]:!0});return(0,l.jsx)("div",Object.assign({id:"reel",className:o,ref:this.elementRef},{children:(0,l.jsx)(SingleScrollbar,Object.assign({direction:F.horizontal,ref:this.scrollbarRef,hideScrollbar:n,thumbScrollingOnly:e,waitToUpdate:0===i,handleClick:this.handleHighlightClickable,onScrollableChanged:this.onScrollableChanged,onScrollPositionChange:this.onScrollPositionChange},{children:t}),void 0)}),void 0)}}class EmptyReel extends r.Component{render(){return(0,l.jsxs)("div",Object.assign({className:"no-highlights-message"},{children:[(0,l.jsx)("p",{children:"Your space does not have any highlights yet."},void 0),(0,l.jsxs)("p",{children:["A Highlight Reel lets your visitors get a taste of what the Space is like.",(0,l.jsx)("a",Object.assign({className:"link",target:"_blank",href:"https://support.matterport.com/hc/en-us/articles/360019401733"},{children:"Learn More"}),void 0)]},void 0)]}),void 0)}}var Ie,Le=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.OPEN="open",e.UNLOADING="unloading",e.CLOSED="closed"}(Ie||(Ie={}));let Re=class TransitionedUnload extends r.Component{constructor(e){super(e),this.ref=(0,r.createRef)(),this.onTransitionCancel=e=>{e.target===e.currentTarget&&this.state.phase===Ie.UNLOADING&&this.setState({phase:Ie.CLOSED,activeChild:null})},this.onTransitionEnd=e=>{e.target===e.currentTarget&&this.state.phase===Ie.UNLOADING&&this.setState({phase:Ie.CLOSED,activeChild:null})},this.onClick=e=>{this.props.onClick&&this.props.onClick(e)},this.onPointerDown=e=>{this.props.onPointerDown&&this.props.onPointerDown(e)},this.onPointerUp=e=>{this.props.onPointerUp&&this.props.onPointerUp(e)},this.state={phase:e.open?Ie.OPEN:Ie.CLOSED,activeChild:e.selectChild&&e.childKey||null}}componentDidMount(){this.ref.current&&this.ref.current.addEventListener("transitioncancel",this.onTransitionCancel)}componentWillUnmount(){this.ref.current&&this.ref.current.removeEventListener("transitioncancel",this.onTransitionCancel)}UNSAFE_componentWillReceiveProps(e){const{open:t,childKey:i}=this.props;t&&!e.open?this.setState({phase:Ie.UNLOADING}):!t&&e.open?this.setState({phase:Ie.OPEN,activeChild:e.selectChild&&e.childKey||null}):i!==e.childKey&&this.setState({activeChild:e.selectChild&&e.childKey||null})}renderChildren(){const{children:e,selectChild:t}=this.props,{phase:i,activeChild:n}=this.state;return i===Ie.CLOSED||t&&!n?null:t?e&&Array.isArray(e)&&e.length&&e.find((e=>e&&e.key===n))||null:e}render(){const{className:e,firstChild:t}=this.props,{phase:i}=this.state,n=d()({unloading:i===Ie.UNLOADING},e);return(0,l.jsxs)("div",Object.assign({ref:this.ref,className:n,onTransitionEnd:this.onTransitionEnd,onClick:this.onClick,onPointerDown:this.onPointerDown,onPointerUp:this.onPointerUp},{children:[t||null,this.renderChildren()]}),void 0)}};Re=Le([I.Z],Re);var ke=i(17597),Ue=i(10757),Be=i(31278),Fe=i(52599);const{HLR:Ve}=f.Z.WORKSHOP;class Highlight extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.editHighlight=e=>{e.stopPropagation(),this.props.onClickHighlight(this.props.index,!0)},this.removeHighlight=e=>{e.stopPropagation(),this.props.onRemoveHighlight&&this.props.onRemoveHighlight(this.props.highlight.snapshot.sid)},this.onClickHighlight=e=>{e.preventDefault(),this.props.onClickHighlight(this.props.index,!1)},this.setContainerRef=e=>{const{index:t,getRef:i}=this.props;this.element=e,i(t,this.element)},this.state={thumbnailUrl:""}}componentDidMount(){this.loadThumbnail()}componentWillUnmount(){this.isUnmounting=!0}async loadThumbnail(){const{snapshot:e}=this.props.highlight,t=await e.thumbnailUrl.get();this.isUnmounting||this.setState({thumbnailUrl:t})}renderTransitionSettings(){const{locale:e}=this.context,{transitionType:t,panDirection:i,transitionCondition:n}=this.props;let s="pan-auto";i===Fe.kw.Left?s="icon icon-rotate-left":i===Fe.kw.Right&&(s="icon icon-rotate-right");let r="";return t===Be.n.FadeToBlack?r=e.t(Ve.TRANSITION_SETTING_SLIDESHOW):t===Be.n.Interpolate&&(r=e.t(Ve.TRANSITION_SETTING_WALKTHROUGH)),(0,l.jsxs)("div",Object.assign({className:"transition-settings"},{children:[(0,l.jsxs)("span",Object.assign({className:"transition-type"},{children:[r,n&&(0,l.jsx)("span",{children:"*"},void 0)]}),void 0),(0,l.jsx)("span",{className:`pan-icon ${s}`},void 0)]}),void 0)}renderImageBar(){const{locale:e}=this.context,{highlight:t,editable:i}=this.props,n=t.snapshot.is360,s=t.snapshot.metadata.cameraMode,r=this.getMarker(s,n),o=e.t(Ve.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE),a=e.t(Ve.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE);return(0,l.jsxs)("div",Object.assign({className:"image-bar"},{children:[(0,l.jsx)("span",{className:d()("highlight-marker",r)},void 0),i&&(0,l.jsx)(x.oO,Object.assign({className:"highlight-remove",content:o,position:x.lZ.DOWN_RIGHT},{children:(0,l.jsx)("span",{className:d()("icon-delete"),"aria-label":o,"aria-labelledby":"",onClick:this.removeHighlight},void 0)}),void 0),i&&(0,l.jsx)(x.oO,Object.assign({className:"highlight-edit",content:a,position:x.lZ.DOWN_LEFT},{children:(0,l.jsx)("span",{className:d()("icon-toggle-pencil"),"aria-label":a,onClick:this.editHighlight},void 0)}),void 0)]}),void 0)}getMarker(e,t){return e===ee.Ey.Dollhouse||e===ee.Ey.Floorplan?null:t?"icon-360":"icon-panorama"}render(){const{thumbnailUrl:e}=this.state,{highlight:t,active:i,editable:n}=this.props,{name:s}=t.snapshot,r=!!s||n,o=e?{backgroundImage:`url('${e}')`}:{};return(0,l.jsxs)("div",Object.assign({className:d()("highlight-box",{active:i,editable:n}),onClick:this.onClickHighlight,ref:this.setContainerRef},{children:[(0,l.jsx)("div",{className:"highlight-image",style:o},void 0),this.renderImageBar(),n&&this.renderTransitionSettings(),(0,l.jsx)("div",Object.assign({className:d()("image-name",{shadowed:r})},{children:(0,l.jsx)("span",Object.assign({className:"static-text",role:"listitem","aria-label":s||"highlight"},{children:s}),void 0)}),void 0)]}),void 0)}}Highlight.contextType=m.I;class ReelContents extends r.Component{constructor(e){super(e),this.highlights=[],this.highlightList=e=>{const{currentStep:t,onHighlightClicked:i}=this.props;return(0,l.jsx)("div",Object.assign({className:"hlr-container"},{children:(0,l.jsx)("div",Object.assign({className:"highlights",role:"list"},{children:e.items.map(((e,n)=>(0,l.jsx)(Highlight,{highlight:e,index:n,active:n===t,editable:!1,onClickHighlight:i,getRef:this.addHighlightRef},`${e.sid}_${n}`)))}),void 0)}),void 0)},this.addHighlightRef=(e,t)=>{this.highlights[e]=t,e===this.props.currentStep&&this.props.setActiveElement&&this.props.setActiveElement(t)}}render(){const{highlights:e}=this.props;return e&&e.length?(0,l.jsx)(this.highlightList,{items:e},void 0):null}}var He=i(80191),je=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Ge=new S.Z("highlight-reel");var ze;!function(e){e[e.flash=0]="flash",e[e.expanded=1]="expanded",e[e.collapsed=2]="collapsed"}(ze||(ze={}));const We=[ze.flash,ze.expanded,ze.collapsed];let Ke=class ReelReadOnly extends r.Component{constructor(e){super(e),this.bindings=[],this.mobile=(0,E.tq)(),this.isUnmounting=!1,this.showReel=()=>{if(this.isUnmounting)return;const{onToggleHLR:e,highlights:t}=this.props;if(e&&t.length>0)switch(this.hlStartupStyle){case ze.expanded:case ze.flash:e(!0)}(0,Ue.gw)(3e3).then(this.dismissReel)},this.dismissReel=()=>{if(this.isUnmounting)return;const{onToggleHLR:e,onBriefHLR:t}=this.props;e&&this.hlStartupStyle===ze.flash&&e(!1),t&&t()},this.setActiveElement=e=>{this.setState({activeElement:e})},this.setHighlightClickable=(e=>this.highlightClickable=e).bind(this),this.onHighlightClicked=async e=>{const{commandBinder:t,analytics:i}=this.context;if(this.highlightClickable)try{this.props.tourPlaying&&await t.issueCommand(new b.vy),this.props.transition.active||(i.track("showcase_gui",{gui_action:"click_highlight",tool:"hlr"}),await t.issueCommand(new b.rU(e)).catch((e=>{if(!(e instanceof He.z))throw e;Ge.warn(e.message)})),this.setHighlightClickable(!1))}catch(e){Ge.debug(e)}},this.state={activeElement:null}}componentDidMount(){if(this.props.briefHlr){const e=this.context.settings.tryGetProperty(_.gx.HighlightReel,!0);!this.context.editMode&&this.props.totalSteps>0&&e&&(this.hlStartupStyle=this.getHlStartupValue(),(0,Ue.gw)(100).then(this.showReel))}}componentWillUnmount(){this.isUnmounting=!0,this.bindings.forEach((e=>{e.cancel()}))}render(){const{reelOpen:e,activeStep:t,highlights:i,totalSteps:n}=this.props,s=n>0,r=s?(0,l.jsx)(ReelContents,{highlights:i,currentStep:t,onHighlightClicked:this.onHighlightClicked,setActiveElement:this.setActiveElement},void 0):(0,l.jsx)(EmptyReel,{},void 0);return(0,l.jsx)(Re,Object.assign({className:d()("highlight-reel",{"reel-viewing":s,"reel-empty":!s}),open:e},{children:(0,l.jsx)("div",Object.assign({id:"reel-container"},{children:(0,l.jsx)(ReelScrollContainer,Object.assign({totalSteps:n,activeElement:this.state.activeElement,mobile:this.mobile,highlightClickable:this.setHighlightClickable,thumbScrollingOnly:!1},{children:r}),void 0)}),void 0)}),void 0)}getHlStartupValue(){if((0,ke.eY)("note","")||(0,ke.eY)("tag",""))return ze.collapsed;const e=this.props.highlights.some((e=>e.snapshot.is360))?ze.expanded:ze.flash,t=(0,ke.eY)("hl",e);return We.includes(t)?t:e}};Ke.contextType=m.I,Ke=je([I.Z],Ke);const Ye=Ke;var qe=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ze=class TourProgress extends r.Component{constructor(){super(...arguments),this.handleClick=()=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_progress",tool:"hlr"}),this.props.reelOpen||this.props.onToggleHLR(!0)}}getTourSteps(){const{totalSteps:e,activeStep:t}=this.props,i=[];for(let n=0;n<e;n++)i.push((0,l.jsx)("div",{className:d()({active:n===t})},n.toString()));return i}render(){const{reelOpen:e,tourPlaying:t,activeStep:i,totalSteps:n}=this.props,s=i+1+"/"+n,r=-1!==i&&!e&&s,o=-1!==i&&e&&t;return n>0?(0,l.jsxs)("div",Object.assign({id:"tour-progress",className:d()({"faded-in":t}),onClick:this.handleClick,"data-balloon":r,"data-balloon-pos":"right","data-balloon-size":"xs"},{children:[o&&(0,l.jsx)("div",Object.assign({className:"progress-number"},{children:s}),void 0),-1!==i&&(0,l.jsx)("div",Object.assign({className:"progress-bar"},{children:this.getTourSteps()}),void 0)]}),void 0):null}};Ze.contextType=m.I,Ze=qe([I.Z],Ze);const $e=Ze,Qe=new S.Z("pause-button");class PauseButton extends r.Component{constructor(e){super(e),this.justEnded=!1,this.stopTour=async e=>{this.context.analytics.track("showcase_gui",{gui_action:"tour_stopped"}),e.preventDefault();try{this.context.commandBinder.issueCommand(new b.vy)}catch(e){Qe.debug(e)}},this.state={justPaused:!1}}componentDidUpdate(){this.state.justPaused&&this.setState({justPaused:!1}),this.justEnded=!1}UNSAFE_componentWillReceiveProps(e){!this.props.tourPlaying||e.tourPlaying||this.justEnded||this.setState({justPaused:!0}),this.props.tourEnded&&(this.justEnded=!0)}render(){const{tourPlaying:e}=this.props,{justPaused:t}=this.state;return(0,l.jsx)("div",Object.assign({id:"pause-button",onClick:this.stopTour,onTouchMove:this.stopTour,onTouchStart:this.stopTour},{children:!e&&(0,l.jsx)("img",{src:i(31896),className:d()({justPaused:t}),alt:"","aria-hidden":"true"},void 0)}),void 0)}}PauseButton.contextType=m.I;var Xe,Je=i(98292),et=i(87182),tt=i(55305),it=i(92532),nt=i(84842),st=i(76495),rt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ot=Xe=class NotesModeButton extends r.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.bindings=[],this.onModalToggled=e=>{e.modal!==Te.P.NOTES_INTRO||e.open||this.toggleNotesMode(!0)},this.dismissNudge=()=>{this.state.showNudge&&(this.trackEvent("notes_nudge_dismissed"),this.context.settings.setLocalStorageProperty(tt.F.NotesModeNudgeSeen,!0),this.setState({showNudge:!1}))},this.modeButtonClicked=()=>{const e=this.props.openTool!==p.w1.NOTES;if(e){const{commandBinder:e,settings:t}=this.context;this.trackEvent("notes_mode_click_open");if(!t.tryGetProperty(tt.F.NotesIntroModalSeen,!1))return void e.issueCommand(new we.Bz(Te.P.NOTES_INTRO,!0))}this.toggleNotesMode(e)},this.localized={notesModeString:t.locale.t(f.Z.NOTES_MODE),nudgeTitleString:t.locale.t(f.Z.NOTES_NUDGE_TITLE),nudgeMessageString:t.locale.t(f.Z.NOTES_NUDGE_MESSAGE)},this.state={showNudge:!1}}componentDidMount(){this.updateNudge(),this.bindings.push(this.context.messageBus.subscribe(nt.nV,this.onModalToggled))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}updateNudge(){const e=this.context.settings.tryGetProperty(et.pE,!1),t=this.context.settings.tryGetProperty(tt.F.NotesModeNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),Xe.DISMISS_NUDGE_TIMEOUT)}),Xe.SHOW_NUDGE_TIMEOUT))}toggleNotesMode(e){const{commandBinder:t,messageBus:i}=this.context;e&&i.broadcast(new st.Ey),t.issueCommand(new it.tT(p.w1.NOTES,e))}render(){const{tooltipTimeout:e,openTool:t}=this.props,{showNudge:i}=this.state,{nudgeTitleString:n,nudgeMessageString:s}=this.localized,r=this.localized.notesModeString,o=t===p.w1.NOTES?w.BN.ACTIVE:w.BN.ENABLED;return(0,l.jsxs)("div",Object.assign({className:"notes-mode-button"},{children:[(0,l.jsx)(T.hU,Object.assign({ariaLabel:r,buttonState:o,onClick:this.modeButtonClicked},{children:(0,l.jsx)(x.oO,Object.assign({content:r,position:x.lZ.UP,tooltipTimeout:e},{children:(0,l.jsx)("span",{className:"icon icon-comment-outline"},void 0)}),void 0)}),void 0),(0,l.jsx)(ne,{className:d()("tooltip-title-large","nudge-tooltip"),open:i,closeButton:!0,onClose:this.dismissNudge,title:n,message:(0,l.jsx)("div",Object.assign({className:"nudge-message"},{children:(0,l.jsx)("span",Object.assign({className:"message"},{children:s}),void 0)}),void 0),arrowPos:J.BOTTOM_CENTER},void 0)]}),void 0)}};ot.contextType=m.I,ot.SHOW_NUDGE_TIMEOUT=15e3,ot.DISMISS_NUDGE_TIMEOUT=1e4,ot=Xe=rt([I.Z],ot);const at=ot;var lt,ct=i(30060),dt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ht=lt=class MeasurementModeButton extends r.Component{constructor(e,t){super(e),this.nudgeTimeout=0,this.updateNudge=()=>{const e=this.context.settings.tryGetProperty(ct.b,!1),t=this.context.settings.tryGetProperty(tt.F.MeasurementUserNudgeSeen,!1);!e||t||this.nudgeTimeout||(this.nudgeTimeout=window.setTimeout((()=>{this.setState({showNudge:!0}),window.setTimeout((()=>{this.dismissNudge()}),lt.DISMISS_NUDGE_TIMEOUT)}),lt.SHOW_NUDGE_TIMEOUT))},this.dismissNudge=()=>{this.state.showNudge&&(this.context.analytics.track("showcase_gui",{gui_action:"mesasure_nudge",tool:"measurements"}),this.context.settings.setLocalStorageProperty(tt.F.MeasurementUserNudgeSeen,!0),this.setState({showNudge:!1}))},this.modeButtonClicked=()=>{const e=this.props.openTool!==p.w1.MEASUREMENTS;e&&this.context.analytics.track("showcase_gui",{gui_action:"measure_mode",tool:"measurements"}),this.context.commandBinder.issueCommand(new it.tT(p.w1.MEASUREMENTS,e))},this.localized={measurement_mode:t.locale.t(f.Z.MEASUREMENT_MODE),nudgeTitleString:t.locale.t(f.Z.MEASUREMENT_NUDGE_TITLE),nudgeMessageString:t.locale.t(f.Z.MEASUREMENT_NUDGE_MESSAGE)},this.state={showNudge:!1}}componentDidMount(){this.updateNudge()}render(){const{tooltipTimeout:e,openTool:t}=this.props,{showNudge:i}=this.state,{nudgeTitleString:n,nudgeMessageString:s}=this.localized,r=this.localized.measurement_mode,o=t===p.w1.MEASUREMENTS?w.BN.ACTIVE:w.BN.ENABLED;return(0,l.jsxs)("div",Object.assign({className:"measure-mode-button"},{children:[(0,l.jsx)(T.hU,Object.assign({onClick:this.modeButtonClicked,buttonState:o,ariaLabel:r},{children:(0,l.jsx)(x.oO,Object.assign({content:r,position:x.lZ.UP,tooltipTimeout:e},{children:(0,l.jsx)("span",{className:"icon icon-tape-measure"},void 0)}),void 0)}),void 0),(0,l.jsx)(ne,{className:d()("tooltip-title-large","nudge-tooltip"),open:i,closeButton:!0,onClose:this.dismissNudge,title:n,message:(0,l.jsx)("div",Object.assign({className:"nudge-message"},{children:(0,l.jsx)("span",Object.assign({className:"message"},{children:s}),void 0)}),void 0),arrowPos:J.BOTTOM_CENTER},void 0)]}),void 0)}};ht.contextType=m.I,ht.SHOW_NUDGE_TIMEOUT=6e4,ht.DISMISS_NUDGE_TIMEOUT=1e4,ht=lt=dt([I.Z],ht);const ut=ht;var pt=function(){if("undefined"!=typeof Map)return Map;function e(e,t){var i=-1;return e.some((function(e,n){return e[0]===t&&(i=n,!0)})),i}return function(){function t(){this.__entries__=[]}return Object.defineProperty(t.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),t.prototype.get=function(t){var i=e(this.__entries__,t),n=this.__entries__[i];return n&&n[1]},t.prototype.set=function(t,i){var n=e(this.__entries__,t);~n?this.__entries__[n][1]=i:this.__entries__.push([t,i])},t.prototype.delete=function(t){var i=this.__entries__,n=e(i,t);~n&&i.splice(n,1)},t.prototype.has=function(t){return!!~e(this.__entries__,t)},t.prototype.clear=function(){this.__entries__.splice(0)},t.prototype.forEach=function(e,t){void 0===t&&(t=null);for(var i=0,n=this.__entries__;i<n.length;i++){var s=n[i];e.call(t,s[1],s[0])}},t}()}(),mt="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,ft=void 0!==i.g&&i.g.Math===Math?i.g:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")(),gt="function"==typeof requestAnimationFrame?requestAnimationFrame.bind(ft):function(e){return setTimeout((function(){return e(Date.now())}),1e3/60)};var vt=["top","right","bottom","left","width","height","size","weight"],yt="undefined"!=typeof MutationObserver,bt=function(){function e(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(e,t){var i=!1,n=!1,s=0;function r(){i&&(i=!1,e()),n&&a()}function o(){gt(r)}function a(){var e=Date.now();if(i){if(e-s<2)return;n=!0}else i=!0,n=!1,setTimeout(o,t);s=e}return a}(this.refresh.bind(this),20)}return e.prototype.addObserver=function(e){~this.observers_.indexOf(e)||this.observers_.push(e),this.connected_||this.connect_()},e.prototype.removeObserver=function(e){var t=this.observers_,i=t.indexOf(e);~i&&t.splice(i,1),!t.length&&this.connected_&&this.disconnect_()},e.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},e.prototype.updateObservers_=function(){var e=this.observers_.filter((function(e){return e.gatherActive(),e.hasActive()}));return e.forEach((function(e){return e.broadcastActive()})),e.length>0},e.prototype.connect_=function(){mt&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),yt?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},e.prototype.disconnect_=function(){mt&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},e.prototype.onTransitionEnd_=function(e){var t=e.propertyName,i=void 0===t?"":t;vt.some((function(e){return!!~i.indexOf(e)}))&&this.refresh()},e.getInstance=function(){return this.instance_||(this.instance_=new e),this.instance_},e.instance_=null,e}(),St=function(e,t){for(var i=0,n=Object.keys(t);i<n.length;i++){var s=n[i];Object.defineProperty(e,s,{value:t[s],enumerable:!1,writable:!1,configurable:!0})}return e},Et=function(e){return e&&e.ownerDocument&&e.ownerDocument.defaultView||ft},Tt=At(0,0,0,0);function wt(e){return parseFloat(e)||0}function xt(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];return t.reduce((function(t,i){return t+wt(e["border-"+i+"-width"])}),0)}function _t(e){var t=e.clientWidth,i=e.clientHeight;if(!t&&!i)return Tt;var n=Et(e).getComputedStyle(e),s=function(e){for(var t={},i=0,n=["top","right","bottom","left"];i<n.length;i++){var s=n[i],r=e["padding-"+s];t[s]=wt(r)}return t}(n),r=s.left+s.right,o=s.top+s.bottom,a=wt(n.width),l=wt(n.height);if("border-box"===n.boxSizing&&(Math.round(a+r)!==t&&(a-=xt(n,"left","right")+r),Math.round(l+o)!==i&&(l-=xt(n,"top","bottom")+o)),!function(e){return e===Et(e).document.documentElement}(e)){var c=Math.round(a+r)-t,d=Math.round(l+o)-i;1!==Math.abs(c)&&(a-=c),1!==Math.abs(d)&&(l-=d)}return At(s.left,s.top,a,l)}var Mt="undefined"!=typeof SVGGraphicsElement?function(e){return e instanceof Et(e).SVGGraphicsElement}:function(e){return e instanceof Et(e).SVGElement&&"function"==typeof e.getBBox};function Ot(e){return mt?Mt(e)?function(e){var t=e.getBBox();return At(0,0,t.width,t.height)}(e):_t(e):Tt}function At(e,t,i,n){return{x:e,y:t,width:i,height:n}}var Ct=function(){function e(e){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=At(0,0,0,0),this.target=e}return e.prototype.isActive=function(){var e=Ot(this.target);return this.contentRect_=e,e.width!==this.broadcastWidth||e.height!==this.broadcastHeight},e.prototype.broadcastRect=function(){var e=this.contentRect_;return this.broadcastWidth=e.width,this.broadcastHeight=e.height,e},e}(),Pt=function(e,t){var i,n,s,r,o,a,l,c=(n=(i=t).x,s=i.y,r=i.width,o=i.height,a="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,l=Object.create(a.prototype),St(l,{x:n,y:s,width:r,height:o,top:s,right:n+r,bottom:o+s,left:n}),l);St(this,{target:e,contentRect:c})},Dt=function(){function e(e,t,i){if(this.activeObservations_=[],this.observations_=new pt,"function"!=typeof e)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=e,this.controller_=t,this.callbackCtx_=i}return e.prototype.observe=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof Et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)||(t.set(e,new Ct(e)),this.controller_.addObserver(this),this.controller_.refresh())}},e.prototype.unobserve=function(e){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(e instanceof Et(e).Element))throw new TypeError('parameter 1 is not of type "Element".');var t=this.observations_;t.has(e)&&(t.delete(e),t.size||this.controller_.removeObserver(this))}},e.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},e.prototype.gatherActive=function(){var e=this;this.clearActive(),this.observations_.forEach((function(t){t.isActive()&&e.activeObservations_.push(t)}))},e.prototype.broadcastActive=function(){if(this.hasActive()){var e=this.callbackCtx_,t=this.activeObservations_.map((function(e){return new Pt(e.target,e.broadcastRect())}));this.callback_.call(e,t,e),this.clearActive()}},e.prototype.clearActive=function(){this.activeObservations_.splice(0)},e.prototype.hasActive=function(){return this.activeObservations_.length>0},e}(),Nt="undefined"!=typeof WeakMap?new WeakMap:new pt,It=function e(t){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var i=bt.getInstance(),n=new Dt(t,i,this);Nt.set(this,n)};["observe","unobserve","disconnect"].forEach((function(e){It.prototype[e]=function(){var t;return(t=Nt.get(this))[e].apply(t,arguments)}}));const Lt=void 0!==ft.ResizeObserver?ft.ResizeObserver:It;var Rt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},kt=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};var Ut;!function(e){e.UP="up",e.DOWN="down"}(Ut||(Ut={}));let Bt=class Dropdown extends r.Component{constructor(e){super(e),this.elementRef=(0,r.createRef)(),this.onOutsideClick=e=>{this.toggleDropdown(!1)},this.onToggleClick=e=>{e.stopPropagation(),this.toggleDropdown()},this.onTransitionEnd=e=>{e&&e.target!==e.currentTarget||(window.clearTimeout(this.transitionTimeout),this.setState({transitioning:!1}))},this.toggleDropdown=e=>{const{open:t}=this.state,i=void 0!==e?e:!t;i?window.addEventListener("click",this.onOutsideClick):window.removeEventListener("click",this.onOutsideClick),this.transitionTimeout=window.setTimeout(this.onTransitionEnd,1e3),this.setState({open:i,transitioning:!0})},this.state={open:!1,transitioning:!1}}componentWillUnmount(){window.removeEventListener("click",this.onOutsideClick)}render(){const{open:e,transitioning:t}=this.state,i=this.props,{children:n,className:s,direction:r}=i,o=kt(i,["children","className","direction"]),a={up:r===Ut.UP,open:e,transitioning:t};return(0,l.jsxs)("div",Object.assign({ref:this.elementRef,className:d()("dropdown",a,s)},o,{children:[(0,l.jsx)("div",Object.assign({className:"dropdown-mask"},{children:(0,l.jsx)("div",Object.assign({className:"dropdown-menu",onTransitionEnd:this.onTransitionEnd},{children:n}),void 0)}),void 0),(0,l.jsx)("div",Object.assign({className:"dropdown-toggle"},{children:(0,l.jsx)(T.hU,{iconClass:"icon-toolbar-more-horiz",onClick:this.onToggleClick,className:"dropdown-toggle"},void 0)}),void 0)]}),void 0)}};Bt.defaultProps={direction:Ut.DOWN},Bt=Rt([I.Z],Bt);var Ft=i(62330),Vt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o},Ht=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i};const jt="collapsed";let Gt=class CollapsibleList extends r.Component{constructor(e){super(e),this.contentRef=(0,r.createRef)(),this.collapsedRef=(0,r.createRef)(),this.toggleRef=(0,r.createRef)(),this.onResize=()=>{this.update()},this.update=(0,Ft.P)((()=>{var e;const t=null===(e=this.toggleRef.current)||void 0===e?void 0:e.elementRef.current,i=this.contentRef.current,n=this.collapsedRef.current;if(!i||!n||!t)return;const s=i.children,r=n.children;if(!s||s.length!==r.length)return;const{collapsed:o}=this.state,a=i.offsetWidth,l=t.offsetWidth||0;let c=0,d=0;for(let e=0;e<s.length;e++){let t=s[e].offsetWidth||0;d||e!==s.length-1||(t-=l),c+=t,c<=a?(s[e].classList.remove(jt),r[e].classList.add(jt)):(d++,s[e].classList.add(jt),r[e].classList.remove(jt))}!!d!==o&&this.setState({collapsed:!o})}),50),this.state={collapsed:!1},this.observer=new Lt(this.onResize)}componentDidMount(){this.connectObserver(),this.update()}componentDidUpdate(){this.update()}componentWillUnmount(){this.disconnectObserver(),this.reset()}connectObserver(){const e=this.contentRef.current;e&&this.observer.observe(e)}disconnectObserver(){this.observer&&this.observer.disconnect()}reset(){const e=this.contentRef.current;if(!e)return;const t=e.querySelectorAll(".collapsed");Array.from(t).forEach((e=>e.classList.remove(jt)))}render(){const e=this.props,{children:t,className:i}=e,n=Ht(e,["children","className"]),{collapsed:s}=this.state,r=`collapsible-list ${i}`,o={hidden:!s};return t&&Array.isArray(t)?(0,l.jsxs)("div",Object.assign({className:d()(r)},n,{children:[(0,l.jsx)("div",Object.assign({ref:this.contentRef,className:"collapsible-list-items"},{children:t}),void 0),(0,l.jsx)(Bt,Object.assign({ref:this.toggleRef,direction:Ut.UP,className:d()(o)},{children:(0,l.jsx)("div",Object.assign({ref:this.collapsedRef,className:"collapsible-list-menu"},{children:t}),void 0)}),void 0)]}),void 0):{children:t}}};Gt.defaultProps={},Gt=Vt([I.Z],Gt);var zt=i(25138),Wt=i(43229),Kt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Yt=class Footer extends r.Component{constructor(e){super(e),this.handleTermsClick=()=>{const e=this.props.openModal===Te.P.TERMS;this.context.commandBinder.issueCommand(new we.Bz(Te.P.TERMS,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_terms_button",interaction_source:"gui"})},this.handleHelpClick=()=>{const e=this.props.openModal===Te.P.HELP;this.context.commandBinder.issueCommand(new we.Bz(Te.P.HELP,!e)),this.context.analytics.track("showcase_gui",{gui_action:"click_help_button",interaction_source:"gui"})},this.handleFeedbackClick=()=>{const{isWorkshop:e}=this.props;this.context.commandBinder.issueCommand(new Wt.m),this.context.analytics.track(e?"workshop_gui":"showcase_gui",{gui_action:"click_feedback_button",interaction_source:"gui"})}}getFooterLogo(){const{locale:e,settings:t}=this.context,n=e.t(f.Z.ALT_MATTERPORT_LOGO),s=!t.tryGetProperty(zt.sX,!1),r=i(89992),o=(0,l.jsx)("img",{className:"footer-logo",alt:n,src:r},void 0);return s?(0,l.jsx)("a",Object.assign({className:"link logo-link",href:"https://matterport.com",target:"_blank"},{children:o}),void 0):o}render(){const{isWorkshop:e=!1,modelRatingEnabled:t}=this.props;return e&&!t?null:(0,l.jsxs)("div",Object.assign({id:"footer"},{children:[t&&(0,l.jsx)("span",Object.assign({onClick:this.handleFeedbackClick,className:"link feedback-link",role:"link"},{children:this.context.locale.t(f.Z.FEEDBACK)}),void 0),!e&&t&&(0,l.jsx)("span",{children:" | "},void 0),!e&&(0,l.jsx)("span",Object.assign({onClick:this.handleHelpClick,className:"link",role:"link"},{children:this.context.locale.t(f.Z.HELP)}),void 0),!e&&(0,l.jsx)("span",{children:" | "},void 0),!e&&(0,l.jsx)("span",Object.assign({onClick:this.handleTermsClick,className:"link",role:"link"},{children:this.context.locale.t(f.Z.TERMS)}),void 0),!e&&this.getFooterLogo()]}),void 0)}};Yt.contextType=m.I,Yt=Kt([I.Z],Yt);const qt=Yt;var Zt,$t=i(98811),Qt=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.FILTER=1]="FILTER"}(Zt||(Zt={}));let Xt=class Checkbox extends r.Component{constructor(e){super(e),this.onChange=e=>{this.props.stopPropagation&&e.stopPropagation(),this.setState((e=>({checkedValue:!e.checkedValue})),(()=>{this.props.onChange&&this.props.onChange(this.checkboxElement,...this.props.onChangeArgs||[])}))},this.setCheckboxRef=e=>{this.checkboxElement=e},this.state={checkedValue:e.checked}}UNSAFE_componentWillReceiveProps(e){this.setState({checkedValue:e.checked})}render(){const{checkboxStyle:e=Zt.DEFAULT,className:t,dataValue:i,enabled:n,error:s,helpText:r,id:o,label:a}=this.props,{checkedValue:c}=this.state,h=!n;return(0,l.jsxs)("div",Object.assign({ref:this.setCheckboxRef,id:o,role:"checkbox","aria-checked":c?"true":"false","aria-disabled":h,"data-value":i,className:d()("checkbox-element",`checkbox-style-${Zt[e].toLowerCase()}`,{checked:c,disabled:h,error:s},t),onClick:this.onChange},{children:[e!==Zt.FILTER&&(0,l.jsx)("div",{className:"checkbox icon-checkmark"},void 0),(0,l.jsx)("div",Object.assign({className:"checkbox-text"},{children:a}),void 0),r&&(0,l.jsx)("span",Object.assign({className:"help-text"},{children:r}),void 0)]}),void 0)}};Xt.defaultProps={enabled:!0,error:!1},Xt=Qt([I.Z],Xt);var Jt,ei=i(81507),ti=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e[e.OUTLINED=0]="OUTLINED"}(Jt||(Jt={}));const ii=function*(){let e=0;for(;;)yield e++}();let ni=class Textarea extends r.Component{constructor(e){super(e),this.onInput=e=>{if(this.props.onInput){const t=e.target;this.props.onInput(t.value)}},this.onKeyPress=e=>{e.stopPropagation();const t=e.which||e.keyCode,i=[ei.R.RETURN];if("keydown"===e.type&&!i.includes(t))return!1;const n=e.target;switch(this.props.maxLength&&n.value.length>this.props.maxLength&&e.preventDefault(),t){case ei.R.RETURN:e.shiftKey||(e.preventDefault(),this.blur(),this.props.onDone(n.value))}return!1},this.stopPropagation=e=>e.stopPropagation(),this.onFocus=e=>{this.context.messageBus.broadcast(new nt.SN(this.input,!0)),this.props.onFocus&&this.props.onFocus(e),this.setState({isFocused:!0})},this.onBlur=e=>{this.context.messageBus.broadcast(new nt.SN(this.input,!1)),this.props.onBlur&&this.props.onBlur(e),this.setState({isFocused:!1})},this.setRef=e=>this.input=e,this.instanceId=`textarea-${ii.next().value}`,this.state={currentText:e.text,isFocused:!1}}componentDidMount(){this.props.focusOnMount&&this.input&&this.input.focus(),this.props.scrollIntoViewOnMount&&this.input&&this.input.scrollIntoView()}componentWillUnmount(){this.input&&this.input.blur()}UNSAFE_componentWillReceiveProps(e){e.text!==this.props.text&&this.setState({currentText:e.text})}getText(){return this.input?this.input.value:""}focus(){this.input.focus()}blur(){this.input.blur()}render(){const{placeholder:e,tabIndex:t,maxLength:i,inputStyle:n=Jt.OUTLINED,label:s,name:r,readOnly:o,rows:a}=this.props,{currentText:c,isFocused:h}=this.state,u=r||this.instanceId;return(0,l.jsxs)("div",Object.assign({className:d()("textarea-container",`textarea-style-${Jt[n].toLowerCase()}`,{focused:h,readonly:o})},{children:[s&&(0,l.jsx)("label",Object.assign({className:"label",htmlFor:u},{children:s}),void 0),(0,l.jsx)("textarea",{className:"textarea",value:c,ref:this.setRef,name:u,placeholder:e,maxLength:i,onInput:this.onInput,onKeyPress:this.onKeyPress,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,onBlur:this.onBlur,onFocus:this.onFocus,rows:a,tabIndex:t,readOnly:o},void 0)]}),void 0)}};ni.contextType=m.I,ni=ti([I.Z],ni);const si=ni;class ButtonGroup_ButtonGroup extends r.Component{render(){const{children:e,className:t}=this.props;return(0,l.jsx)("div",Object.assign({className:d()("button-group",t)},{children:e}),void 0)}}var ri;!function(e){e[e.Disappointed=0]="Disappointed",e[e.Unsatisfied=1]="Unsatisfied",e[e.Neutral=2]="Neutral",e[e.Satisfied=3]="Satisfied",e[e.Happy=4]="Happy"}(ri||(ri={}));const{MODEL_RATING:oi}=f.Z.WORKSHOP,ai={HAPPINESS:"happiness",QUALITY:"quality",NAVIGATION:"navigation",FEEDBACK:"feedback"},li=ai.HAPPINESS,ci={[ai.HAPPINESS]:oi.HAPPINESS_TITLE,[ai.QUALITY]:oi.QUALITY_ISSUES_TITLE,[ai.NAVIGATION]:oi.NAVIGATION_ISSUES_TITLE,[ai.FEEDBACK]:oi.FEEDBACK_TITLE},di={[ai.HAPPINESS]:oi.HAPPINESS_BODY},hi={[ai.QUALITY]:[{text:oi.QUALITY_ISSUES_LIGHTING,value:"lighting"},{text:oi.QUALITY_ISSUES_3D_MESH,value:"3d_mesh"},{text:oi.QUALITY_ISSUES_COLORING,value:"coloring"},{text:oi.QUALITY_ISSUES_IMAGE_QUALITY,value:"image_quality"}],[ai.NAVIGATION]:[{text:oi.NAVIGATION_ISSUES_BLOCKED_DOORWAYS,value:"blocked_doorways"},{text:oi.NAVIGATION_ISSUES_OBSTRUCTIONS,value:"obstructions"},{text:oi.NAVIGATION_ISSUES_MISALIGNED_SCANS,value:"misaligned_scans"},{text:oi.NAVIGATION_ISSUES_FLOOR_SEPARATION,value:"floor_separation"},{text:oi.NAVIGATION_ISSUES_DISAPPEARING_FLOORS,value:"disappearing_floors"}]},ui=[{value:1,altText:f.Z.REUSABLES.EMOJI_ALT_DISAPPOINTED,icon:ri.Disappointed},{value:2,altText:f.Z.REUSABLES.EMOJI_ALT_UNSATISFIED,icon:ri.Unsatisfied},{value:3,altText:f.Z.REUSABLES.EMOJI_ALT_NEUTRAL,icon:ri.Neutral},{value:4,altText:f.Z.REUSABLES.EMOJI_ALT_SATISFIED,icon:ri.Satisfied},{value:5,altText:f.Z.REUSABLES.EMOJI_ALT_HAPPY,icon:ri.Happy}];var pi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let mi=class RatingIcon extends r.Component{render(){switch(this.props.icon){case ri.Disappointed:return(0,l.jsxs)("svg",Object.assign({width:"29",height:"29",viewBox:"0 0 29 29",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.5 28C21.9557 28 28 21.9557 28 14.5C28 7.04503 21.9557 1 14.5 1C7.04506 1 1 7.04506 1 14.5C1 21.9557 7.04503 28 14.5 28ZM14.5 29C22.508 29 29 22.508 29 14.5C29 6.49278 22.508 0 14.5 0C6.49278 0 0 6.49278 0 14.5C0 22.508 6.49278 29 14.5 29Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M9.26389 16.1111C10.3761 16.1111 11.2778 14.8488 11.2778 13.2917C11.2778 11.7345 10.3761 10.4722 9.26389 10.4722C8.15165 10.4722 7.25 11.7345 7.25 13.2917C7.25 14.8488 8.15165 16.1111 9.26389 16.1111Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M19.7361 16.1111C20.8484 16.1111 21.75 14.8488 21.75 13.2917C21.75 11.7345 20.8484 10.4722 19.7361 10.4722C18.6239 10.4722 17.7222 11.7345 17.7222 13.2917C17.7222 14.8488 18.6239 16.1111 19.7361 16.1111Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M4.83253 9.66666C4.66497 9.66666 4.495 9.6143 4.35 9.50555C3.99394 9.23891 3.92225 8.73383 4.18889 8.37777C6.81661 4.87361 10.324 4.83333 10.4722 4.83333C10.9169 4.83333 11.2778 5.19422 11.2778 5.63888C11.2778 6.08274 10.9193 6.44283 10.4754 6.44444C10.3506 6.44605 7.60122 6.51372 5.47778 9.34444C5.31989 9.5555 5.07742 9.66666 4.83253 9.66666ZM24.1675 9.66666C23.9218 9.66666 23.6809 9.5555 23.5222 9.34444C21.3956 6.50808 18.6397 6.44605 18.5229 6.44444C18.0799 6.43961 17.7222 6.07711 17.7246 5.63486C17.7271 5.19099 18.0847 4.83333 18.5278 4.83333C18.676 4.83333 22.1826 4.87361 24.8111 8.37777C25.0786 8.73383 25.0061 9.23891 24.65 9.50555C24.505 9.6143 24.3358 9.66666 24.1675 9.66666V9.66666ZM18.9185 22.4581C18.9096 22.4226 17.9961 18.9306 14.5 18.9306C11.0039 18.9306 10.0904 22.4226 10.0815 22.4581C10.0388 22.6297 10.117 22.8053 10.2684 22.8963C10.4199 22.9865 10.6172 22.9656 10.7485 22.848C10.7558 22.8415 11.5646 22.1528 14.5 22.1528C17.3919 22.1528 18.2192 22.8214 18.2507 22.848C18.3272 22.9205 18.4271 22.9583 18.5278 22.9583C18.5954 22.9583 18.6639 22.9414 18.7259 22.9068C18.8838 22.8166 18.9628 22.6337 18.9185 22.4581V22.4581Z",fill:"#222222"},void 0)]}),void 0);case ri.Unsatisfied:return(0,l.jsxs)("svg",Object.assign({width:"30",height:"29",viewBox:"0 0 30 29",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.125 28C22.5808 28 28.625 21.9558 28.625 14.5C28.625 7.04416 22.5808 1 15.125 1C7.66916 1 1.625 7.04416 1.625 14.5C1.625 21.9558 7.66916 28 15.125 28ZM29.625 14.5C29.625 22.5081 23.1331 29 15.125 29C7.11687 29 0.625 22.5081 0.625 14.5C0.625 6.49187 7.11687 0 15.125 0C23.1331 0 29.625 6.49187 29.625 14.5Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M21.1546 22.0553C21.1183 21.9111 20.2137 18.5278 15.125 18.5278C10.0355 18.5278 9.13167 21.9111 9.09542 22.0553C9.05111 22.2301 9.13006 22.4114 9.28633 22.5016C9.44342 22.591 9.63997 22.5644 9.76967 22.4395C9.78497 22.4242 11.3437 20.9444 15.125 20.9444C18.9063 20.9444 20.4658 22.4242 20.4803 22.4387C20.5577 22.5153 20.6608 22.5555 20.7639 22.5555C20.8316 22.5555 20.9 22.5386 20.9621 22.504C21.1199 22.4138 21.1989 22.2309 21.1546 22.0553Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M10.2917 13.6944C11.4039 13.6944 12.3055 12.4321 12.3055 10.875C12.3055 9.31787 11.4039 8.05556 10.2917 8.05556C9.17942 8.05556 8.27777 9.31787 8.27777 10.875C8.27777 12.4321 9.17942 13.6944 10.2917 13.6944Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M19.9583 13.6944C21.0706 13.6944 21.9722 12.4321 21.9722 10.875C21.9722 9.31787 21.0706 8.05556 19.9583 8.05556C18.8461 8.05556 17.9444 9.31787 17.9444 10.875C17.9444 12.4321 18.8461 13.6944 19.9583 13.6944Z",fill:"#222222"},void 0)]}),void 0);case ri.Neutral:return(0,l.jsxs)("svg",Object.assign({width:"30",height:"29",viewBox:"0 0 30 29",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.75 28C22.2057 28 28.25 21.9557 28.25 14.5C28.25 7.04503 22.2057 1 14.75 1C7.29506 1 1.25 7.04506 1.25 14.5C1.25 21.9557 7.29503 28 14.75 28ZM14.75 29C22.758 29 29.25 22.508 29.25 14.5C29.25 6.49278 22.758 0 14.75 0C6.74278 0 0.25 6.49278 0.25 14.5C0.25 22.508 6.74278 29 14.75 29Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M9.51389 16.1111C10.6261 16.1111 11.5278 14.8488 11.5278 13.2917C11.5278 11.7345 10.6261 10.4722 9.51389 10.4722C8.40165 10.4722 7.5 11.7345 7.5 13.2917C7.5 14.8488 8.40165 16.1111 9.51389 16.1111Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M19.9861 16.1111C21.0984 16.1111 22 14.8488 22 13.2917C22 11.7345 21.0984 10.4722 19.9861 10.4722C18.8739 10.4722 17.9722 11.7345 17.9722 13.2917C17.9722 14.8488 18.8739 16.1111 19.9861 16.1111Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M20.3889 20.9444H9.11111C8.66645 20.9444 8.30556 20.5844 8.30556 20.1389C8.30556 19.6934 8.66645 19.3333 9.11111 19.3333H20.3889C20.8344 19.3333 21.1944 19.6934 21.1944 20.1389C21.1944 20.5844 20.8344 20.9444 20.3889 20.9444Z",fill:"#222222"},void 0)]}),void 0);case ri.Satisfied:return(0,l.jsxs)("svg",Object.assign({width:"30",height:"29",viewBox:"0 0 30 29",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15.375 28C22.8308 28 28.875 21.9558 28.875 14.5C28.875 7.04416 22.8308 1 15.375 1C7.91916 1 1.875 7.04416 1.875 14.5C1.875 21.9558 7.91916 28 15.375 28ZM29.875 14.5C29.875 22.5081 23.3831 29 15.375 29C7.36687 29 0.875 22.5081 0.875 14.5C0.875 6.49187 7.36687 0 15.375 0C23.3831 0 29.875 6.49187 29.875 14.5Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M9.34541 19.028C9.38166 19.1722 10.2863 22.5555 15.375 22.5555C20.4645 22.5555 21.3683 19.1722 21.4046 19.028C21.4489 18.8532 21.3699 18.672 21.2137 18.5817C21.0566 18.4923 20.86 18.5189 20.7303 18.6438C20.715 18.6591 19.1563 20.1389 15.375 20.1389C11.5937 20.1389 10.0342 18.6591 10.0197 18.6446C9.94233 18.568 9.83922 18.5278 9.73611 18.5278C9.66844 18.5278 9.59997 18.5447 9.53794 18.5793C9.38005 18.6695 9.30111 18.8524 9.34541 19.028V19.028Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M10.5417 13.6944C11.6539 13.6944 12.5556 12.4321 12.5556 10.875C12.5556 9.31787 11.6539 8.05556 10.5417 8.05556C9.42943 8.05556 8.52778 9.31787 8.52778 10.875C8.52778 12.4321 9.42943 13.6944 10.5417 13.6944Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M20.2083 13.6944C21.3206 13.6944 22.2222 12.4321 22.2222 10.875C22.2222 9.31787 21.3206 8.05556 20.2083 8.05556C19.0961 8.05556 18.1944 9.31787 18.1944 10.875C18.1944 12.4321 19.0961 13.6944 20.2083 13.6944Z",fill:"#222222"},void 0)]}),void 0);case ri.Happy:return(0,l.jsxs)("svg",Object.assign({width:"30",height:"29",viewBox:"0 0 30 29",fill:"none",xmlns:"http://www.w3.org/2000/svg"},{children:[(0,l.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M15 28C22.4558 28 28.5 21.9558 28.5 14.5C28.5 7.04416 22.4558 1 15 1C7.54416 1 1.5 7.04416 1.5 14.5C1.5 21.9558 7.54416 28 15 28ZM29.5 14.5C29.5 22.5081 23.0081 29 15 29C6.99187 29 0.5 22.5081 0.5 14.5C0.5 6.49187 6.99187 0 15 0C23.0081 0 29.5 6.49187 29.5 14.5Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M8.97042 19.028C9.00667 19.1722 9.9113 22.5555 15 22.5555C20.0895 22.5555 20.9933 19.1722 21.0296 19.028C21.0739 18.8532 20.9949 18.672 20.8387 18.5817C20.6816 18.4923 20.485 18.5189 20.3553 18.6438C20.34 18.6591 18.7813 20.1389 15 20.1389C11.2187 20.1389 9.65917 18.6591 9.64467 18.6446C9.56733 18.568 9.46422 18.5278 9.36111 18.5278C9.29344 18.5278 9.22497 18.5447 9.16294 18.5793C9.00505 18.6695 8.92611 18.8524 8.97042 19.028V19.028Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M15 17.6006C12.6107 17.6006 11.0246 17.3218 9.06388 16.9408C8.61519 16.8554 7.74438 16.9408 7.74438 18.2603C7.74438 20.8985 10.7757 24.1965 15 24.1965C19.2244 24.1965 22.2557 20.8985 22.2557 18.2603C22.2557 16.9408 21.3841 16.8546 20.9362 16.9408C18.9754 17.3218 17.3901 17.6006 15 17.6006Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M10.1667 13.6944C11.2789 13.6944 12.1806 12.4321 12.1806 10.875C12.1806 9.31787 11.2789 8.05556 10.1667 8.05556C9.05443 8.05556 8.15278 9.31787 8.15278 10.875C8.15278 12.4321 9.05443 13.6944 10.1667 13.6944Z",fill:"#222222"},void 0),(0,l.jsx)("path",{d:"M19.8333 13.6944C20.9456 13.6944 21.8472 12.4321 21.8472 10.875C21.8472 9.31787 20.9456 8.05556 19.8333 8.05556C18.7211 8.05556 17.8194 9.31787 17.8194 10.875C17.8194 12.4321 18.7211 13.6944 19.8333 13.6944Z",fill:"#222222"},void 0)]}),void 0)}}};mi=pi([I.Z],mi);const{MODEL_RATING:fi}=f.Z.WORKSHOP,gi=Object.values(ai);class ModelRatingForm extends r.Component{constructor(e){super(e),this.submitCurrentRating=(e=!1)=>{const{currentQuestionId:t}=this.state;let i={};switch(t){case ai.QUALITY:i={quality:this.state.quality};break;case ai.NAVIGATION:i={navigation:this.state.navigation};break;case ai.FEEDBACK:i={feedback:this.state.feedback},this.resetValues()}i&&this.context.commandBinder.issueCommand(new Wt.M(i,e))},this.resetValues=()=>{this.setState({happiness:void 0,quality:void 0,navigation:void 0,feedback:void 0})},this.hasPerfectHappinessRating=()=>5===this.state.happiness,this.handleButtonClick=()=>{const{currentQuestionId:e}=this.state;let t;switch(this.submitCurrentRating(e===ai.FEEDBACK),e){case ai.QUALITY:t=ai.NAVIGATION;break;case ai.NAVIGATION:t=ai.FEEDBACK}t&&this.setState({currentQuestionId:t})},this.handleHappinessClick=(e,t)=>{this.context.commandBinder.issueCommand(new Wt.M({happiness:t.value})),5!==t.value?this.setState({happiness:t.value,currentQuestionId:ai.QUALITY}):this.submitCurrentRating(!0)},this.handleCheckboxChange=(e,t,i)=>{const n=i.value,s={},r=(this.state[t]||[]).slice();r.includes(n)?r.splice(r.indexOf(n),1):r.push(n),s[t]=r,this.setState(s)},this.handleFeedbackChange=e=>{this.setState({feedback:e})},this.handleClose=()=>{this.context.commandBinder.issueCommand(new Wt.m(!1))},this.renderProgress=()=>{const{locale:e}=this.context,{currentQuestionId:t}=this.state;if(!t)return null;if(t===ai.HAPPINESS||this.hasPerfectHappinessRating())return;const i=gi.indexOf(t);return(0,l.jsx)("span",Object.assign({className:"model-rating-progress"},{children:e.t(fi.PROGRESS,{"current-question-number":i,"max-question-number":gi.length-1})}),void 0)},this.state={currentQuestionId:li}}componentWillUnmount(){this.submitCurrentRating(),this.context.commandBinder.issueCommand(new Wt.m(!1))}renderCurrentQuestion(){const{locale:e}=this.context,{currentQuestionId:t}=this.state;if(t===ai.FEEDBACK)return(0,l.jsx)("div",Object.assign({className:"question-type text-entry"},{children:(0,l.jsx)(si,{text:this.state.feedback||"",label:e.t(fi.FEEDBACK_LABEL),onInput:this.handleFeedbackChange,onDone:this.handleFeedbackChange,maxLength:200,rows:3,focusOnMount:!0,scrollIntoViewOnMount:!0},void 0)}),void 0);if(t===ai.HAPPINESS)return(0,l.jsx)("div",Object.assign({className:"question-type emoji-select"},{children:(0,l.jsx)(ButtonGroup_ButtonGroup,{children:ui.map((e=>(0,l.jsx)(w.zx,Object.assign({buttonState:this.state.happiness===e.value?w.BN.ACTIVE:w.BN.ENABLED,buttonStyle:w.ZJ.PLAIN,buttonSize:w.qE.SMALL,onClick:this.handleHappinessClick,onClickArgs:[e]},{children:(0,l.jsx)(mi,{icon:e.icon},void 0)}),e.value)))},void 0)}),void 0);if(t===ai.QUALITY||t===ai.NAVIGATION){const i=(t===ai.QUALITY?this.state.quality:this.state.navigation)||[],n=hi[t];return(0,l.jsx)("div",Object.assign({className:"question-type multi-select"},{children:n.map((n=>(0,l.jsx)(Xt,{enabled:!0,checkboxStyle:Zt.FILTER,onChange:this.handleCheckboxChange,onChangeArgs:[t,n],checked:i.includes(n.value),label:e.t(n.text)},n.text)))}),void 0)}return null}render(){const{locale:e}=this.context,{currentQuestionId:t}=this.state,i=t===li,n=ci[t],s=di[t],r=t===ai.FEEDBACK?fi.SAVE:fi.NEXT;return(0,l.jsxs)("div",Object.assign({className:d()("model-rating-dialog",{"in-progress":!i})},{children:[(0,l.jsx)(te.P,{onClose:this.handleClose,closeOnMouseDown:!0},void 0),(0,l.jsxs)("div",Object.assign({className:"model-rating-form"},{children:[(0,l.jsxs)("div",Object.assign({className:"model-rating-question"},{children:[(0,l.jsx)("h3",Object.assign({className:"question-title"},{children:e.t(n)}),void 0),s&&(0,l.jsx)("p",Object.assign({className:"question-body"},{children:e.t(s)}),void 0),this.renderCurrentQuestion()]}),void 0),(0,l.jsxs)("footer",Object.assign({className:"model-rating-footer"},{children:[(0,l.jsx)("div",{children:t!==ai.HAPPINESS&&(0,l.jsx)(w.zx,Object.assign({buttonStyle:w.ZJ.SECONDARY,buttonState:w.BN.ENABLED,onClick:this.handleButtonClick,onClickArgs:[t]},{children:e.t(r)}),void 0)},void 0),this.renderProgress()]}),void 0)]}),void 0)]}),void 0)}}ModelRatingForm.contextType=m.I;var vi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let yi=class ModelRatingDialog extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.bindings=[],this.handleDialogVisibilityChange=e=>{this.setState({isVisible:e})},this.state={initializing:!0,isVisible:!1}}componentDidMount(){const{market:e}=this.context.engine;e.waitForData($t.P).then((e=>{this.isUnmounting||(this.bindings.push(e.onDialogVisibleChanged(this.handleDialogVisibilityChange)),this.setState({initializing:!1}))}))}componentWillUnmount(){this.isUnmounting=!0,this.bindings.forEach((e=>e.cancel()))}render(){const{initializing:e,isVisible:t}=this.state;return t&&!e?(0,l.jsx)(ModelRatingForm,{},void 0):null}};yi.contextType=m.I,yi=vi([I.Z],yi);var bi=i(87220);class BottomUi extends r.Component{constructor(e,t){super(e,t),this.isUnmounting=!1,this.touchDevice=(0,E.Jm)(),this.bindings=[],this.viewmodeToClass={[y.BD.INSIDE]:"inside",[y.BD.OUTSIDE]:"outside",[y.BD.DOLLHOUSE]:"dollhouse",[y.BD.FLOORPLAN]:"floorplan",[y.BD.TRANSITIONING]:"transitioning"},this.onBriefHLR=()=>{this.setState((e=>({briefHlr:!e.briefHlr})))},this.onViewingControlsToggle=({show:e})=>{this.setState({autohide:!e})},this.updateViewportSize=()=>{this.isUnmounting||this.setState({viewportHeight:this.context.mainDiv.offsetHeight})},this.isReelEnabled=()=>this.state.viewportHeight>=400&&(0,Me.BO)(this.context.settings),this.isTourEnabled=()=>(0,Me.O8)(this.context.settings),this.isFloorsEnabled=()=>{const{settings:e}=this.context,t=e.tryGetProperty(Ee.ws,!0),i=e.tryGetProperty(_.gx.FloorSelect,!0);return t&&i},this.onToggleHLR=e=>{this.isReelEnabled()&&this.props.tourState.totalSteps>0&&this.setState({reelOpen:e})},this.toggleShareModal=()=>{const e=this.props.openModal===Te.P.SHARE;this.context.analytics.track("showcase_gui",{gui_action:"click_share_button"}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.SHARE,!e))},this.renderHighlightReelControls=()=>{const{totalSteps:e,tourPlaying:t}=this.props.tourState,i=this.isReelEnabled()&&e>0,n=this.isTourEnabled()&&e>0;return(0,l.jsxs)("div",Object.assign({className:"highlight-tour-controls"},{children:[i&&(0,l.jsx)(Pe,{reelOpen:this.state.reelOpen,onToggleHLR:this.onToggleHLR,reelEnabled:i},void 0),n&&(0,l.jsx)(U,{tourEmpty:!1,tourPlaying:t},void 0)]}),"highlight_reel_controls")},this.renderModeControls=()=>{const{unaligned:e,viewmode:t}=this.props;return(0,l.jsx)(ModeControls,{unaligned:e,viewmode:t},"mode_controls")},this.renderFloorPlanControls=()=>{const{viewmode:e}=this.props;return(0,l.jsx)(FloorControls,{viewmode:e,iconStyle:!0},"floor_controls")},this.renderNotesModeButton=()=>{const{openTool:e}=this.props;return(0,l.jsx)(at,{tooltipTimeout:this.touchDevice?1e3:void 0,openTool:e},"notes_mode_button")},this.renderMeasurementModeButton=()=>{const{openTool:e}=this.props;return(0,l.jsx)(ut,{tooltipTimeout:this.touchDevice?1e3:void 0,openTool:e},"measurement_mode_button")},this.renderHighlightReel=e=>{const{totalSteps:t,tourPlaying:i,highlights:n,activeStep:s,transition:r}=this.props.tourState,{reelOpen:o,briefHlr:a}=this.state;return(0,l.jsx)(Ye,{transition:r,activeStep:s,highlights:n,tourPlaying:i,totalSteps:t,reelOpen:o&&e,briefHlr:a,onBriefHLR:this.onBriefHLR,onToggleHLR:this.onToggleHLR},void 0)},this.renderFooter=e=>{const{reelOpen:t}=this.state,{openTool:i,openModal:n,tourState:s}=this.props,{totalSteps:r,tourPlaying:o,activeStep:a}=s,c=null!==i;return(0,l.jsxs)("div",Object.assign({className:"footer-ui"},{children:[!i&&(0,l.jsx)($e,{activeStep:a,tourPlaying:o,totalSteps:r,reelOpen:t,onToggleHLR:this.onToggleHLR},void 0),!c&&(0,l.jsx)(qt,{openModal:n,modelRatingEnabled:e},void 0)]}),void 0)},this.renderLeftControls=()=>{const e=[],{unaligned:t,measurementsModeEnabled:i,notesEnabled:n,openTool:s}=this.props,{totalSteps:r}=this.props.tourState,o=this.isReelEnabled()&&r>0;return(this.isTourEnabled()&&r>0||o)&&!s&&e.push(this.renderHighlightReelControls()),e.push(this.renderModeControls()),this.isFloorsEnabled()&&e.push(this.renderFloorPlanControls()),n&&!t&&e.push(this.renderNotesModeButton()),i&&!t&&e.push(this.renderMeasurementModeButton()),e},this.renderRightControls=()=>{const e=[],{vrEnabled:t,openModal:i,shareEnabled:n}=this.props,s=(0,E.O6)();e.push((0,l.jsx)("span",{className:"divider"},"divider_1"));const r=this.context.locale.t(f.Z.SOCIAL_SHARING);return n&&e.push((0,l.jsx)(T.hU,Object.assign({onClick:this.toggleShareModal,ariaLabel:r},{children:(0,l.jsx)(x.oO,Object.assign({content:r,position:x.lZ.UP_LEFT,tooltipTimeout:this.touchDevice?1e3:void 0},{children:(0,l.jsx)("span",{className:"icon icon-share"},void 0)}),void 0)}),"toggle_share_modal")),t&&e.push((0,l.jsx)(_e,{open:i===Te.P.VR_SELECT},"vr_modal_controls")),s&&e.push((0,l.jsx)(FullscreenControls,{},"fullscreen_controls")),e},this.state={reelOpen:!1,briefHlr:!1,viewportHeight:t.mainDiv.offsetHeight,autohide:!1},this.onResize=(0,Je.D)(this.updateViewportSize,250)}componentDidMount(){const{messageBus:e}=this.context;this.onBriefHLR(),window.addEventListener("resize",this.onResize),this.bindings.push(e.subscribe(Oe.ps,this.onViewingControlsToggle))}componentWillUnmount(){this.isUnmounting=!0,this.bindings.map((e=>e.cancel())),window.removeEventListener("resize",this.onResize)}render(){const{tourState:e,viewmode:t,openModal:i,openTool:n}=this.props,{tourPlaying:s,tourEnded:r,totalSteps:o}=e,{reelOpen:a,autohide:c}=this.state,{settings:h}=this.context,u=this.viewmodeToClass[t]||"",m=this.isReelEnabled()&&o>0,f=m&&!n&&!i,g=n!==p.w1.MEASUREMENTS,v=h.tryGetProperty(bi.i,!1),y={"reel-open":f&&a,"modal-open":!!i,"tour-playing":s,autohide:c},b={"faded-out":!!i&&!n};return(0,l.jsxs)("div",Object.assign({id:"bottom-ui",className:d()("bottom-ui",y,u)},{children:[(0,l.jsx)(PauseButton,{tourPlaying:s,tourEnded:r},void 0),(0,l.jsxs)("div",Object.assign({className:d()("bottom-controls",b)},{children:[(0,l.jsxs)(Gt,Object.assign({className:"controls"},{children:[this.renderLeftControls(),g&&this.renderRightControls()]}),void 0),v&&(0,l.jsx)(yi,{},void 0)]}),void 0),m&&this.renderHighlightReel(f),this.renderFooter(v)]}),void 0)}}BottomUi.contextType=m.I;var Si=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ei=class TitleBar extends r.Component{constructor(){super(...arguments),this.handleTitleClick=()=>{const{commandBinder:e,analytics:t}=this.context;e.issueCommand(new it.tT(p.w1.SUMMARY,!0)),t.track("showcase_gui",{gui_action:"click_model_title",interaction_source:"gui"})}}getFilteredValue(e,t,i,n){return!this.context.settings.tryGetProperty(t,i)||n&&!this.props.brandingEnabled?"":e}render(){const{locale:e}=this.context,{modelDetails:t}=this.props,{name:i,presentedBy:n}=t,s=this.getFilteredValue(i,_.gx.DetailsModelName,!0,!1),r=this.getFilteredValue(n,_.gx.PresentedBy,!1,!0),o=!!r;return(0,l.jsx)("div",Object.assign({id:"model-title",onClick:this.handleTitleClick,role:"button"},{children:(0,l.jsx)(x.oO,Object.assign({content:s,position:x.lZ.DOWN},{children:(0,l.jsx)("div",Object.assign({id:"main-title-wrapper"},{children:(0,l.jsxs)("div",Object.assign({className:"main-title"},{children:[o&&(0,l.jsx)("div",Object.assign({className:"co-brand"},{children:(0,l.jsxs)("span",Object.assign({className:"title",id:"cobrandTitle"},{children:[e.t(f.Z.PRESENTED_BY),r]}),void 0)}),void 0),(0,l.jsxs)("div",Object.assign({id:"gui-name",className:d()({titleText:!0,noCoBrand:!r})},{children:[(0,l.jsx)("span",{className:"icon icon-location"},void 0),s]}),void 0)]}),void 0)}),void 0)}),void 0)}),void 0)}};Ei.contextType=m.I,Ei=Si([I.Z],Ei);const Ti=Ei,{TOOLS:wi}=f.Z;function xi(e){const{activeTool:t}=e,{commandBinder:i,analytics:n,editMode:s}=(0,r.useContext)(m.I),o=be(),a=t===p.w1.SEARCH,c=(0,E.Jm)();return(0,l.jsx)("span",Object.assign({className:"search-mode-button"},{children:(0,l.jsx)(T.hU,Object.assign({onClick:()=>{i.issueCommand(new it.tT(p.w1.SEARCH,!a));const e=s?"workshop_gui":"showcase_gui";n.track(e,{gui_action:"click_search_button",interaction_source:"gui",tool:"search"})},buttonStyle:T.Dd.OVERLAY,buttonState:a?w.BN.ACTIVE:w.BN.ENABLED},{children:(0,l.jsx)(x.oO,Object.assign({content:o.t(wi.SEARCH),position:x.lZ.DOWN,tooltipTimeout:c?1e3:void 0},{children:(0,l.jsx)("span",{className:"icon icon-magnifying-glass"},void 0)}),void 0)}),void 0)}),void 0)}function _i(){const e=le(),[t,i]=(0,r.useState)(!!e&&e.showFloorSelection);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=e.onShowFloorSelectionChanged(i);return i(e.showFloorSelection),()=>t.cancel()}),[e]),t}function Mi(e,t){const{settings:i}=(0,r.useContext)(m.I),[n,s]=(0,r.useState)(i.tryGetProperty(e,t));return(0,r.useEffect)((()=>{if(!e)return s(t),()=>{};const n=()=>{s(i.tryGetProperty(e,t))},r=i.onPropertyChanged(e,n);return n(),()=>r.cancel()}),[i,e,t]),n}var Oi=i(69808);function Ai(){const{editMode:e}=(0,r.useContext)(m.I),t=function(e){const{toolsData:t}=(0,r.useContext)(m.I),[i,n]=(0,r.useState)(t.getTool(e));return(0,r.useEffect)((()=>{const i=()=>{n(t.getTool(e))},s=t.onToolsLoadedChanged(i);return i(),()=>s.cancel()}),[t,e]),i}(p.w1.SEARCH),i=Mi(Oi.B,!1),n=Mi(_.gx.SpaceSearch,!1);return i&&t&&(e||n)}function Ci(e){const t=!_i(),i=Ai(),n=function(){const e=Mi(zt.Zz,!0),t=Mi(_.gx.DetailsModelName,!0);return e&&t}();if(!i&&!n)return null;const{activeTool:s,brandingEnabled:r,hideSearchButton:o,modelDetails:a,showing:c,tourState:h}=e,u=d()({"faded-out":!c||h.tourPlaying||!t});return(0,l.jsxs)("div",Object.assign({id:"top-ui",className:u},{children:[i&&!o&&(0,l.jsx)(xi,{activeTool:s},void 0),n&&a&&(0,l.jsx)(Ti,{modelDetails:a,brandingEnabled:!!r},void 0)]}),void 0)}var Pi=i(23502),Di=i(44060),Ni=i(39504),Ii=i(58626),Li=i(96909),Ri=i(51153),ki=i(46610),Ui=i(34986);const Bi=new S.Z("embedly");class InvalidImageEmbed{constructor(e){this.msg=e}}class InvalidHtmlError{constructor(e){this.msg=e}}class UnsupportedTypeError{constructor(e){this.msg=e}}const Fi="Instagram",Vi="Flickr";class Embedly{constructor(e,t){this.key=e,this.queue=t,this.embedEndpoint="https://api.embed.ly/1/oembed",this.imageEndpoint="https://i.embed.ly/1/display/resize",this.saveProvidersForScripts=[Vi,Fi]}static clearCache(){Embedly.embedCache={},Embedly.imageCache={}}async getType(e){const t=await this.fetchFromCache(e);if(t)return t.type;try{const t=await this.getEmbedDetails(e);if(t.type===Ui.z.rich||t.type===Ui.z.video)return t.type}catch(e){if(401!==e.status_code&&404!==e.status_code&&501!==e.status_code&&!(e instanceof InvalidImageEmbed))return Ui.z.error}try{return await this.getImageDetails(e),Ui.z.photo}catch(e){}return Ui.z.error}async fetchFromCache(e){const t=await this.getDisplayUrl(e),i=Embedly.imageCache[t];if(i)return i;const n=await this.getOEmbedUrl(e),s=Embedly.embedCache[n];return s||null}async getMediaDetails(e,t){switch(e){case Ui.z.photo:return this.getImageDetails(t);case Ui.z.rich:case Ui.z.video:return this.getEmbedDetails(t)}throw Error("unsupported media type")}async getOEmbedUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&maxwidth=${t}&maxheight=${t}`;return`${this.embedEndpoint}?key=${this.key}&url=${encodeURIComponent(e)}${i}`}async getEmbedDetails(e){const t=await this.getOEmbedUrl(e);return Embedly.embedCache[t]?Promise.resolve(Embedly.embedCache[t]):this.loadEmbed(t)}async getDisplayUrl(e){const t=Math.max(window.screen.height,window.screen.width),i=`&url=${encodeURIComponent(e)}&width=${t}&height=${t}`;return`${this.imageEndpoint}?key=${this.key}${i}`}async getImageDetails(e){const t=await this.getDisplayUrl(e);return Embedly.imageCache[t]?Promise.resolve(Embedly.imageCache[t]):this.loadImage(t)}loadEmbed(e){return this.queue.get(e,{responseType:"json"}).then((t=>this.validateAndCacheEmbed(e,t)))}loadImage(e){return new Promise(((t,i)=>this.queue.get(e,{responseType:"arraybuffer"}).then((t=>this.validateAndCacheImage(e,t))).then(t).catch(i)))}validateAndCacheEmbed(e,t){const i=!!(!t.html||!t.html.match(/<script/i))||this.saveProvidersForScripts.includes(t.provider_name);if(!(t.type!==Ui.z.photo||t.html&&i))throw new InvalidImageEmbed('image can\'t be used as a "rich" type');if(!t||t.type===Ui.z.rich&&(!t.html||!i))throw new InvalidHtmlError("missing html or html contains Javascript");switch(t.type){case Ui.z.photo:t.html&&(t.type=Ui.z.rich);break;case Ui.z.rich:case Ui.z.video:break;case Ui.z.link:{const e="not supporting link types because of existing link functionality";throw Bi.debug(e),new UnsupportedTypeError(e)}default:{const e=`Did the OEmbed format extend?! Unknown type: ${t.type}`;throw Bi.debug(e),new UnsupportedTypeError(e)}}const n=(void 0===t.height||void 0===t.width)&&t.thumbnail_width&&t.thumbnail_height,s=n?t.thumbnail_width:t.width,r=n?t.thumbnail_height:t.height,o=t.provider_name,a={width:s,height:r,embedlyResponse:{html:t.html,src:t.url,provider:o},type:t.type};return Embedly.embedCache[e]=a,a}validateAndCacheImage(e,t){return new Promise(((i,n)=>{t||n("Embedly: got an empty response when requesting image");const s=new Uint8Array(t),r=new Blob([s]),o=new Image;o.addEventListener("load",(t=>function(t){const n=t.target,s={width:n.naturalWidth,height:n.naturalHeight,embedlyResponse:{url:a,src:e},type:Ui.z.photo};Embedly.imageCache[e]=s,i(s)}(t)));const a=URL.createObjectURL(r);o.src=a}))}}Embedly.embedCache={},Embedly.imageCache={};const Hi=310;var ji=i(91466);class OpenLinkEditorMessage extends ji.v{constructor(e=!1){super(),this.urlFocus=e}}class CloseLinkEditorMessage extends ji.v{}var Gi,zi=i(44574),Wi=i(86010),Ki=i(17141);!function(e){e[e.NOT_READY=1]="NOT_READY",e[e.CUED=2]="CUED",e[e.PLAYING=3]="PLAYING",e[e.PAUSED=4]="PAUSED"}(Gi||(Gi={}));var Yi=i(53931),qi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Zi=new S.Z("mattertag-media");let $i=class MattertagMedia extends r.Component{constructor(e){super(e),this.playerControls=null,this.handleClick=()=>{this.props.mediaType===Ui.z.photo&&this.props.onClickImage&&this.props.onClickImage()},this.onPlayerLoaded=e=>{this.playerControls=e,e.play()},this.setupPlayerControls=e=>{let t=Gi.NOT_READY;const i=()=>{t=Gi.CUED,this.onPlayerLoaded(a)},n=()=>{t=Gi.PLAYING},s=()=>{t=Gi.PAUSED},r=()=>{};try{e.on("ready",i),e.on("play",n),e.on("pause",s),e.on("ended",r)}catch(e){Zi.debug(e)}const o=(0,E.tq)(),a={play:()=>{if(e&&t!==Gi.NOT_READY&&!o)try{e.play()}catch(e){Zi.error(e)}},pause:()=>{if(e&&t!==Gi.NOT_READY)try{e.pause()}catch(e){Zi.debug(e)}}}},this.setEmbedContentRef=e=>{e&&!this.iframe&&this.createEmbed(e)},this.setContainerRef=e=>{this.mediaContainer=e,this.updateMaxDims()},this.updateMaxDims=()=>{if(this.mediaContainer&&this.props.mediaAspectRatio&&this.props.mediaType===Ui.z.video){const e=this.mediaContainer.getBoundingClientRect();this.setState({maxWidth:e.width,maxHeight:e.height})}},this.mediaStyles=()=>{const{width:e,height:t,mediaPayload:i,mediaType:n,mediaAspectRatio:s}=this.props,{maxWidth:r,maxHeight:o}=this.state,a={};if(i)switch(n){case Ui.z.photo:a.backgroundImage=i.url?`url('${i.url}')`:"none";case Ui.z.rich:void 0!==e&&(a.width=`${e}px`),void 0!==t&&(a.height=`${t}px`,i.provider===Fi?a.height=`${t+54}px`:a.height=`${t}px`);break;case Ui.z.video:if(void 0!==e&&void 0!==t){const i=(0,Yi.lZ)(e,t);a.width=`${e}px`,a.height=`${i}px`}else if(r&&o&&void 0!==s){const e=Math.min(o,(0,Yi.lZ)(r,r/s)),t=e*s;a.width=`${t}px`,a.height=`${e}px`}}return a},this.state={maxWidth:0,maxHeight:0}}componentDidMount(){this.props.mediaAspectRatio&&this.props.mediaType===Ui.z.video&&(window.addEventListener("resize",this.updateMaxDims),this.updateMaxDims())}componentWillUnmount(){this.props.mediaAspectRatio&&this.props.mediaType===Ui.z.video&&window.removeEventListener("resize",this.updateMaxDims)}UNSAFE_componentWillReceiveProps(e){e.mediaPayload!==this.props.mediaPayload&&this.iframe&&this.iframe.parentNode&&(this.iframe.parentNode.removeChild(this.iframe),this.iframe=null),this.playerControls&&this.props.closing!==e.closing&&(e.closing?this.playerControls.pause():this.playerControls.play())}createEmbed(e){const{mediaType:t,mediaPayload:i,width:n,height:s}=this.props,{html:r,provider:o,src:a}=i,l=document.createElement("div");l.innerHTML=r;let c=l.firstChild;if("iframe"!==c.tagName.toLowerCase()){if(c=document.createElement("iframe"),!("srcdoc"in c))return Zi.warn(`Browser does not support srcdoc, refusing to embed ${r}`),void(this.iframe=null);let e,t;void 0!==n&&(c.width=n.toString()),void 0!==s&&(c.height=s.toString()),c.setAttribute("allow","encrypted-media; autoplay; fullscreen"),c.classList.add("tag-iframe-sandbox","loading"),c.onload=()=>c.classList.remove("loading"),e=o===Vi&&void 0!==a?`<img src=${a} />`:r,t=o===Fi?"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img { display: block; max-width: 100%; height: auto; border: 0; }\n            iframe { display: block; max-width: 100%; border: 0; }\n          </style>\n        ":"\n          <style>\n            html, body { padding: 0; margin: 0; border: 0; }\n            img, iframe { display: block; max-width: 100%; height: auto; border: 0; }\n          </style>\n        ";const i=t.replace(/\s+/g," ");c.srcdoc=`<!doctype html>${i}${e}`}else{const e=c.style;e.maxWidth="100%",e.maxHeight="100%",e.minWidth="",e.minHeight=""}if(t===Ui.z.video&&c.src)try{const e=new Ki.Player(c);c.addEventListener("load",(()=>this.setupPlayerControls(e)))}catch(e){Zi.error(e)}this.iframe=c,e.appendChild(c)}render(){const{mediaPayload:e,mediaType:t}=this.props;if(!e)return null;const i=d()({"tag-image":t===Ui.z.photo,"tag-embed":t===Ui.z.rich,"tag-video":t===Ui.z.video}),n=e&&e.html?(0,l.jsx)("div",{className:"tag-embed-content",ref:this.setEmbedContentRef},void 0):null;return(0,l.jsx)("div",Object.assign({ref:this.setContainerRef,className:"tag-media-content",onClick:this.handleClick},{children:(0,l.jsx)("div",Object.assign({className:i,style:this.mediaStyles()},{children:n}),void 0)}),void 0)}};$i=qi([I.Z],$i);const Qi=$i;var Xi=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ji=class TextInput extends r.Component{constructor(e){super(e),this.touchDevice=(0,E.Jm)(),this.isUnmounting=!1,this.handleOutsideClick=e=>{if(!this.state.editing||!this.input.current)return;const t=this.getTextString(this.input.current.value,this.props.defaultText);this.stopEditing(t,!0)},this.stopEditing=(e,t=!0)=>{this.setState({editing:!1}),t&&this.props.text!==e?(this.setState({currentText:e}),this.props.onEdited&&this.props.onEdited(e)):this.props.onCancelEditing&&this.props.onCancelEditing()},this.stopPropagation=e=>{e.stopPropagation()},this.onBlur=()=>{this.input.current&&this.context.engine.broadcast(new nt.SN(this.input.current,!1))},this.onFocus=()=>{this.input.current&&this.context.engine.broadcast(new nt.SN(this.input.current,!0))},this.startEditing=e=>{clearTimeout(this.startEditingTimeout),this.startEditingTimeout=window.setTimeout((()=>{if(!this.input.current||this.isUnmounting)return;e&&e.stopPropagation();const{onStartEditing:t,autoSelect:i,defaultText:n}=this.props,{currentText:s}=this.state;this.setState({editing:!0}),t&&t(),this.input.current.focus(),(i||n&&this.input.current.select&&s===n)&&this.input.current.select()}),0)},this.onKeyPress=e=>{var t;if(e.stopPropagation(),this.props.onKeyPress&&this.props.onKeyPress(e))return;const i=e.which||e.keyCode;if(!("keydown"===e.type&&i!==ei.R.TAB||i!==ei.R.RETURN&&i!==ei.R.TAB||e.shiftKey)){e.preventDefault(),null===(t=this.input.current)||void 0===t||t.blur(),this.setState({editing:!1});const i=this.getTextString(e.target.value,this.props.defaultText);this.props.onEdited&&this.props.onEdited(i)}},this.onInput=e=>{const t=e.target.value;this.setState({currentText:t}),this.props.onInput&&this.props.onInput(t)},this.state={editing:!1,currentText:this.props.text},this.input=(0,r.createRef)()}componentDidMount(){this.input.current&&(this.props.closeOnFocusOut&&this.input.current.addEventListener("focusout",this.handleOutsideClick),(this.props.editing||this.props.autofocus)&&this.startEditing())}componentWillUnmount(){this.isUnmounting=!0,this.input.current&&(this.props.closeOnFocusOut&&this.input.current.removeEventListener("focusout",this.handleOutsideClick),this.input.current.blur())}UNSAFE_componentWillReceiveProps(e){if(e.editing&&!this.props.editing&&this.startEditing(),e.text!==this.props.text){const t=this.getTextString(e.text,e.defaultText);this.setState({currentText:t})}}componentDidUpdate(e,t){this.input.current&&(!t.editing&&this.state.editing?this.input.current.focus():t.editing&&!this.state.editing&&this.input.current.blur())}getTextString(e,t){return""===e&&void 0!==t?t:e}setCurrentText(e){this.setState({currentText:e}),this.focusInput(),this.props.onEdited&&this.props.onEdited(e)}getCurrentText(){return this.state.currentText}focusInput(){this.input.current&&this.input.current.focus()}getFractionalCounter(){if(this.props.maxLength&&this.props.fractionalCounter)return`${this.state.currentText.length}/${this.props.maxLength}`}render(){const{editing:e,currentText:t}=this.state,{hint:i,isDisabled:n,placeholder:s,noFocusedPlaceholder:o,clickToEdit:a,maxLength:c,tabIndex:h,textarea:u,readOnlyText:p,autocapitalize:m,fractionalCounter:f,showUnderline:g,className:v}=this.props,y=!(t||!s||e&&o),b=y?s:void 0,S=!1!==a?this.startEditing:void 0,E=(0,l.jsx)("div",Object.assign({className:"current-text",onClick:S,"data-hint":i},{children:t||s||""}),void 0);return(0,l.jsxs)("div",Object.assign({className:d()("modifiable-text",v,{editing:e,"fractional-counter":f,default:!t,"has-hint":!!i,"has-placeholder":y}),"data-hint":i,"data-fractional-counter":this.getFractionalCounter()},{children:[u?(0,l.jsx)(Scrollbars,Object.assign({name:"text-input",singleScrollDirection:F.vertical,forceHidden:!1},{children:E}),void 0):E,(0,r.createElement)(u?"textarea":"input",{ref:this.input,className:d()("inputDiv",{editing:e}),type:"text",value:t,placeholder:b,maxLength:c,onInput:this.onInput,onClick:this.props.propagateMouseEvent?void 0:this.stopPropagation,onKeyPress:this.onKeyPress,disabled:n,readOnly:this.props.readOnlyMode,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,tabIndex:h,autoCapitalize:m,onBlur:this.touchDevice?this.onBlur:void 0,onFocus:this.touchDevice?this.onFocus:void 0}),p&&(0,l.jsx)("div",Object.assign({className:"read-only-text"},{children:p}),void 0),g&&(0,l.jsx)("div",{className:"editable-line"},void 0)]}),void 0)}};Ji.contextType=m.I,Ji=Xi([I.Z],Ji);const en=Ji;var tn=i(44283),nn=new RegExp("^(?:(?:(?:https?|ftp):)?\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!(?:10|127)(?:\\.\\d{1,3}){3})(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z0-9\\u00a1-\\uffff][a-z0-9\\u00a1-\\uffff_-]{0,62})?[a-z0-9\\u00a1-\\uffff]\\.)+(?:[a-z\\u00a1-\\uffff]{2,}\\.?))(?::\\d{2,5})?(?:[/?#]\\S*)?$","i");const sn=e=>(e=>nn.test(e))(e)&&/^https?:\/\//.test(e);function rn(e,t,i){const n=Math.ceil(t/2);return i(e)?t<=1?e:rn(e+n,n,i):0===e?-1:rn(Math.max(0,e-n),n,i)}function on(e,t){if(e<0)return-1;if(t(e))return e;const i=Math.ceil(e/2);return rn(e-i,i,t)}const{MATTERTAGS:an}=f.Z.WORKSHOP;class EditableDescription extends r.Component{constructor(e){super(e),this.textParser=new Wi.v({links:!0}),this.inputDiv=(0,r.createRef)(),this.getInputDiv=()=>this.inputDiv.current,this.hasTextSelected=()=>this.range&&this.range.startOffset!==this.range.endOffset,this.onSelectionChange=()=>{const e=this.getCurrentSelection();e&&(this.range=e.cloneRange())},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.prepareLinkSelection=()=>{const e=this.getAnchorFromSelection();let t=null;const i=window.getSelection();return i&&(e||this.range||!this.inputDiv.current?(this.addFauxHighlight(),e||(t=this.range?this.range.toString():i.toString())):(this.inputDiv.current.focus(),i.selectAllChildren(this.inputDiv.current),i.collapseToEnd(),this.range=i.getRangeAt(0),t=this.range.toString())),e||(t||"")},this.onMouseDown=e=>{e.stopPropagation(),this.removeFauxHighlight(),this.range=null},this.onKeyDown=e=>{const t=e.which||e.keyCode;return e.stopPropagation(),t===ei.R.ESCAPE?this.props.onNavigationKey(e):t===ei.R.RETURN||t===ei.R.TAB?(e.shiftKey||(e.preventDefault(),this.finalizeInput()),this.props.onNavigationKey(e)):void 0},this.onKeyPress=e=>{const{maxLength:t}=this.props;if(t&&this.range&&this.inputDiv&&this.inputDiv.current){const[i,n]=this.textParser.getHTMLWithoutSelection(this.inputDiv.current,this.range),s=this.getTextInsertion(e,i,n);this.textParser.serializeHTMLToMarkdown(`${i}${s}${n}`).length>t&&e.preventDefault()}},this.onInput=()=>{this.props.updateLength()},this.onPaste=e=>{e.preventDefault();const{maxLength:t}=this.props,i=(e.clipboardData||window.clipboardData).getData("text/plain");if(t){if(this.inputDiv.current&&this.range){const[e,n]=this.textParser.getHTMLWithoutSelection(this.inputDiv.current,this.range),s=s=>this.textParser.serializeHTMLToMarkdown(`${e}${i.slice(0,s)}${n}`).length<=t,r=on(i.length,s);if(r>=0){const e=i.slice(0,r);document.execCommand("insertHTML",!1,e)}}}else document.execCommand("insertHTML",!1,i)},this.onFocus=e=>{this.inputDiv.current&&(this.context.messageBus.broadcast(new nt.SN(this.inputDiv.current,!0)),this.props.onFocus&&this.props.onFocus())},this.onBlur=()=>{this.inputDiv.current&&(this.context.messageBus.broadcast(new nt.SN(this.inputDiv.current,!1)),this.props.onBlur&&this.props.onBlur(),this.finalizeInput())};const t=new tn.gm((()=>({})),(e=>document.addEventListener("selectionchange",e)),(e=>document.removeEventListener("selectionchange",e)));this.selectionSubscription=t.createSubscription(this.onSelectionChange)}componentDidMount(){const{description:e,onLinkClick:t}=this.props,i=this.getInputDiv();this.textParser.deserialize(e,!0,t).forEach((e=>{null==i||i.appendChild(e)})),this.selectionSubscription.renew(),setTimeout((()=>{this.props.updateLength()}),0)}componentDidUpdate(e){e.description!==this.props.description&&this.props.updateLength()}componentWillUnmount(){var e;this.selectionSubscription.cancel(),null===(e=this.inputDiv.current)||void 0===e||e.blur()}shouldComponentUpdate(){return!1}getCurrentSelection(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.inputDiv.current&&(this.inputDiv.current===t.commonAncestorContainer||this.inputDiv.current.compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY))return t}return null}linkify(e,t){const{descriptionLength:i,maxLength:n}=this.props,s=`link_${Date.now()}`,r=this.createAnchor(e,t);r.id=s;const o=this.textParser.serializeHTMLToMarkdown(r.outerHTML);if(n&&o.length+i>n)return this.context.locale.t(an.LINK_EDITOR_MAX_LENGTH_TIP);this.execCommand("backColor","transparent"),this.execCommand("insertHTML",r.outerHTML);const a=document.getElementById(s);return a&&(a.onclick=this.props.onLinkClick),!1}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!sn(i)&&this.execCommand("insertText",i))}updateLink(e,t,i){const{descriptionLength:n,maxLength:s,updateLength:r}=this.props,{serializeHTMLToMarkdown:o}=this.textParser,a=this.createAnchor(t,i),l=o(a.outerHTML),c=o(e.outerHTML);return n+(l.length-c.length)>s?this.context.locale.t(an.LINK_EDITOR_MAX_LENGTH_TIP):(e.href=a.href,e.text=a.text,e.setAttribute("data-value",i),r(),!1)}createAnchor(e,t){const i=document.createElement("a");return i.href=t,i.text=this.textParser.sanitizeText(e),i.classList.add(Wi.o.LINK),i.setAttribute("data-value",t),i}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}getAnchorFromSelection(){const e=this.getCurrentSelection();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.inputDiv.current)return null;t=t.parentNode}return t||null}finalizeInput(){var e;this.props.onFinalizeInput(),null===(e=this.inputDiv.current)||void 0===e||e.blur()}getTextInsertion(e,t,i){if((e.which||e.keyCode)!==ei.R.RETURN)return e.key;const n=t.slice(-1),s=i.slice(0,1);return"\n"===n||"\n"===s?"\n":"\n\n"}render(){return(0,l.jsx)("div",{ref:this.inputDiv,className:"inputDiv","data-placeholder":this.props.placeholder,onMouseDown:this.onMouseDown,onKeyDown:this.onKeyDown,onKeyPress:this.onKeyPress,onPaste:this.onPaste,contentEditable:!0,onInput:this.onInput,onFocus:this.onFocus,onBlur:this.onBlur},void 0)}}EditableDescription.contextType=m.I;var ln=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let cn=class TextInputBox extends r.Component{constructor(e){super(e),this.onInput=e=>{if(this.props.onInput){const t=e.target;this.props.onInput(t.value)}},this.onKeyPress=e=>{e.stopPropagation();const t=e.which||e.keyCode,i=[ei.R.TAB,ei.R.RETURN,ei.R.ESCAPE];if("keydown"===e.type&&!i.includes(t))return!1;const n=e.target;switch(this.props.maxLength&&n.value.length>this.props.maxLength&&e.preventDefault(),t){case ei.R.ESCAPE:this.props.onCancel&&this.props.onCancel();break;case ei.R.TAB:case ei.R.RETURN:e.shiftKey||(e.preventDefault(),this.blur())}return!1},this.stopPropagation=e=>e.stopPropagation(),this.onFocus=e=>{this.context.messageBus.broadcast(new nt.SN(this.input,!0)),this.props.onFocus&&this.props.onFocus(e)},this.onBlur=e=>{this.context.messageBus.broadcast(new nt.SN(this.input,!1));const t=e.target;this.props.onDone(t.value)},this.setRef=e=>this.input=e,this.state={currentText:e.text}}componentWillUnmount(){this.input&&this.input.blur()}componentDidMount(){this.props.focusOnMount&&this.focus()}UNSAFE_componentWillReceiveProps(e){e.text!==this.props.text&&this.setState({currentText:e.text})}getText(){return this.input?this.input.value:""}focus(){this.input.focus()}blur(){this.input.blur()}scrollIntoView(e){this.input.scrollIntoView(e)}render(){const{placeholder:e,tabIndex:t,maxLength:i,type:n,className:s}=this.props,{currentText:r}=this.state;return(0,l.jsx)("div",Object.assign({className:d()("text-field",s)},{children:(0,l.jsx)("input",{ref:this.setRef,className:"text-input-box",type:n||"text",value:r,placeholder:e,maxLength:i,onInput:this.onInput,onKeyPress:this.onKeyPress,onKeyDown:this.onKeyPress,onKeyUp:this.stopPropagation,onBlur:this.onBlur,onFocus:this.onFocus,tabIndex:t},void 0)}),void 0)}};cn.contextType=m.I,cn=ln([I.Z],cn);const dn=cn,{MATTERTAGS:hn}=f.Z.WORKSHOP;class LinkEditor extends r.Component{constructor(e){super(e),this.elementRef=(0,r.createRef)(),this.urlInputRef=(0,r.createRef)(),this.textInputRef=(0,r.createRef)(),this.open=e=>{this.elementRef.current&&this.elementRef.current.classList.add("open"),this.focus(e.urlFocus)},this.close=()=>{this.urlInputRef.current&&this.urlInputRef.current.blur(),this.textInputRef.current&&this.textInputRef.current.blur(),this.setState({currentText:"",currentUrl:"",validUrl:!0,errorMessage:void 0}),this.elementRef.current&&this.elementRef.current.classList.remove("open")},this.onEditedUrl=e=>{const{validUrl:t,currentText:i}=this.state;if(!t)return;const n=""!==i?i:e,s=this.props.onSaveLink(n,e);this.setState({errorMessage:s})},this.onInputUrl=e=>{this.setState({validUrl:sn(e),currentUrl:e,errorMessage:void 0})},this.onEditedText=e=>{this.focus(!0)},this.onInputText=e=>{this.setState({currentText:e,errorMessage:void 0})},this.onApply=e=>{this.state.currentUrl&&this.onEditedUrl(this.state.currentUrl)},this.onClose=e=>{this.close(),this.props.onCancel()},this.onPreviewUrl=()=>{this.state.validUrl&&window.open(this.state.currentUrl,"_blank")},this.stopPropagation=e=>{e.stopPropagation()},this.state={currentUrl:e.linkUrl,currentText:e.linkText,validUrl:!0,errorMessage:void 0}}componentDidMount(){this.context.messageBus.subscribe(OpenLinkEditorMessage,this.open),this.context.messageBus.subscribe(CloseLinkEditorMessage,this.close)}componentWillUnmount(){this.close(),this.context.messageBus.unsubscribe(OpenLinkEditorMessage,this.open),this.context.messageBus.unsubscribe(CloseLinkEditorMessage,this.close)}componentDidUpdate(e){this.props.linkUrl!==e.linkUrl&&this.setState({currentUrl:this.props.linkUrl}),this.props.linkText!==e.linkText&&this.setState({currentText:this.props.linkText})}focus(e=!1){e?this.urlInputRef.current&&this.urlInputRef.current.focus():this.textInputRef.current&&this.textInputRef.current.focus()}renderButtons(){const{locale:e}=this.context,{validUrl:t,currentUrl:i}=this.state,{onRemoveLink:n,linkText:s,linkUrl:r}=this.props,o=""!==s&&""!==r,a=!i||!t?w.BN.DISABLED:w.BN.ENABLED,c=e.t(hn.LINK_EDITOR_APPLY_CTA),d=e.t(hn.LINK_EDITOR_REMOVE_TIP);return(0,l.jsxs)("div",Object.assign({className:"popover-footer"},{children:[this.renderValidationMessage(),o&&(0,l.jsx)(T.hU,{iconClass:"icon-delete",buttonStyle:T.Dd.CLEAR,tooltipMsg:d,tooltipPosition:x.lZ.UP,onClick:n},void 0),(0,l.jsx)(w.zx,Object.assign({className:"button-inline",buttonStyle:w.ZJ.CLEAR,buttonSize:w.qE.SMALL,buttonState:a,onClick:this.onApply},{children:c}),void 0)]}),void 0)}renderValidationMessage(){const{locale:e}=this.context,{linkText:t,linkUrl:i}=this.props,{validUrl:n,currentUrl:s,errorMessage:r}=this.state,o=""===t&&""===i&&""===s;return r?(0,l.jsx)("div",Object.assign({className:"popover-message popover-message-error"},{children:r}),void 0):!n&&s?(0,l.jsx)("div",Object.assign({className:"popover-message popover-message-error"},{children:e.t(hn.LINK_EDITOR_INVALID_TIP)}),void 0):(0,l.jsx)("div",Object.assign({className:"popover-message"},{children:o&&e.t(hn.LINK_EDITOR_TIP_TEXT)}),void 0)}render(){const{locale:e}=this.context,{validUrl:t,currentText:i,currentUrl:n}=this.state,s=e.t(hn.LINK_EDITOR_TEXT_LABEL),r=e.t(hn.LINK_EDITOR_URL_LABEL),o=e.t(hn.LINK_EDITOR_PREVIEW_TIP);return(0,l.jsxs)("div",Object.assign({ref:this.elementRef,className:"annotation-popup link-editor",onClick:this.stopPropagation},{children:[(0,l.jsxs)("div",Object.assign({className:"popover-header"},{children:[(0,l.jsx)("div",Object.assign({className:"popover-label"},{children:s}),void 0),(0,l.jsx)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.onClose},void 0)]}),void 0),(0,l.jsx)(dn,{ref:this.textInputRef,text:i,className:"text-field-dark",onDone:this.onEditedText,onInput:this.onInputText},void 0),(0,l.jsxs)("div",Object.assign({className:"url-field"},{children:[(0,l.jsx)("div",Object.assign({className:"popover-label"},{children:r}),void 0),(0,l.jsx)(dn,{ref:this.urlInputRef,text:n,type:"url",className:"text-field-dark",placeholder:"https://",onDone:this.onEditedUrl,onInput:this.onInputUrl},void 0),t&&n&&(0,l.jsx)(T.hU,{className:"preview-link",iconClass:"icon-ext-link",buttonStyle:T.Dd.PLAIN,tooltipMsg:o,tooltipPosition:x.lZ.UP,onClick:this.onPreviewUrl},void 0)]}),void 0),this.renderButtons()]}),void 0)}}LinkEditor.contextType=m.I;var un=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{MATTERTAGS:pn}=f.Z.WORKSHOP;let mn=class EditableBillboardText extends r.Component{constructor(e){super(e),this.textParser=new Wi.v({links:!0}),this.editableDescriptionRef=(0,r.createRef)(),this.linkElement=null,this.onLabelEdit=e=>{const{manager:t,id:i,onEdited:n}=this.props;t.setLabel(i,e).then(n)},this.onLabelKeyPress=e=>{if(e.keyCode===ei.R.ESCAPE)return this.props.onNavigationKey(e);if(e.stopPropagation(),e.keyCode===ei.R.TAB){const e=this.editableDescriptionRef.current;if(e){const t=e.getInputDiv();t&&t.focus()}}return!1},this.updateDescriptionLength=()=>{const e=this.editableDescriptionRef.current;if(!e)return;const t=e.getInputDiv();if(!t)return;const i=this.textParser.serialize(t).length;this.props.onDescriptionInput(0===i),this.setState({descriptionLength:i})},this.onDescriptionEdited=()=>{const e=this.editableDescriptionRef.current;if(!e)return;const t=e.getInputDiv();if(t){const{manager:e,id:i,onEdited:n}=this.props,s=this.textParser.serialize(t);e.setDescription(i,s).then(n)}},this.onLabelFocus=()=>{this.closePopover()},this.onDescriptionFocus=()=>{this.setState({editingDescription:!0})},this.onDescriptionBlur=()=>{this.setState({editingDescription:!1})},this.closePopover=()=>{this.setState({linkUrl:"",linkText:""}),this.linkElement=null,this.props.onClosePopover()},this.linkClicked=e=>{if(e.preventDefault(),this.props.linkEditorOpen)this.closePopover();else{e.stopPropagation(),this.linkElement=e.target;const{href:t,text:i}=this.linkElement;this.setState({linkUrl:t,linkText:i}),this.props.onClickLink()}},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{let i;const n=this.editableDescriptionRef.current;if(this.linkElement&&n?""!==t?i=n.updateLink(this.linkElement,e,t):n.unlink(this.linkElement):n&&(i=n.linkify(e,t)),i&&"string"==typeof i)return i;this.closePopover(),this.onDescriptionEdited()},this.state={editingDescription:!1,descriptionLength:0,linkUrl:"",linkText:""}}prepareNewLinkSelection(){const e=this.editableDescriptionRef.current;if(!e)return!1;const t=e.prepareLinkSelection();let i,n;return"string"==typeof t?(this.linkElement=null,i="",n=t):(this.linkElement=t,i=t.href,n=t.text),this.setState({linkUrl:i,linkText:n}),""!==n&&""===i}render(){const{locale:e}=this.context,{linkUrl:t,linkText:i,editingDescription:n,descriptionLength:s}=this.state,{label:r,linkEditorOpen:o,onNavigationKey:a,description:c}=this.props,h=`${s}/${Di.Us}`,u=e.t(pn.TITLE_PLACEHOLDER),p=e.t(pn.DESCRIPTION_PLACEHOLDER);return(0,l.jsxs)("div",Object.assign({className:"editable-text-content"},{children:[(0,l.jsx)("div",Object.assign({className:"mattertag-label-editor"},{children:(0,l.jsx)(en,{text:r,placeholder:u,onEdited:this.onLabelEdit,onInput:this.onLabelEdit,onKeyPress:this.onLabelKeyPress,maxLength:60,closeOnFocusOut:!0,textarea:!0,fractionalCounter:!0,onStartEditing:this.onLabelFocus},void 0)}),void 0),(0,l.jsx)("div",Object.assign({className:"editable-tag-description"},{children:(0,l.jsx)("div",Object.assign({className:d()("modifiable-text fractional-counter",{editing:n||o,empty:0===s}),"data-fractional-counter":h},{children:(0,l.jsx)(EditableDescription,{ref:this.editableDescriptionRef,maxLength:Di.Us,descriptionLength:s,placeholder:p,description:c,updateLength:this.updateDescriptionLength,onFinalizeInput:this.onDescriptionEdited,onNavigationKey:a,onLinkClick:this.linkClicked,onFocus:this.onDescriptionFocus,onBlur:this.onDescriptionBlur},void 0)}),void 0)}),void 0),(0,l.jsx)(LinkEditor,{linkUrl:t,linkText:i,onCancel:this.closePopover,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink},void 0)]}),void 0)}};mn.contextType=m.I,mn=un([I.A],mn);var fn=i(70655),gn=function(e){return(Array.isArray(e)?e:[e]).filter((function(e){return!!e})).map((function(e){return"mdc-theme--"+e.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()}))}))},vn=r.forwardRef((function(e,t){var i=e.tag,n=void 0===i?"div":i,s=(e.theme,e.element),o=(0,fn._T)(e,["tag","theme","element"]),a=s?s.props(o):o,l=s?yn(t,s.setRef):t;return r.createElement(n,(0,fn.pi)({},a,{ref:l}))})),yn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var i,n;try{for(var s=(0,fn.XA)(e),r=s.next();!r.done;r=s.next()){var o=r.value;"function"==typeof o?o(t):o&&"current"in o&&(o.current=t)}}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}}},bn=function(e,t){"function"==typeof e?e(t):e&&"current"in e&&(e.current=t)};function Sn(e){var t=r.forwardRef(e),i=function(e,t){return r.createElement(r.Fragment,null)};return i.displayName=e.constructor.name||"RMWCComponent",t.displayName=i.displayName,t}var En={blur:"onBlur",cancel:"onCancel",click:"onClick",close:"onClose",contextmenu:"onContextMenu",copy:"onCopy",cut:"onCut",auxclick:"onAuxClick",doubleclick:"onDoubleClick",dragend:"onDragEnd",dragstart:"onDragStart",drop:"onDrop",focus:"onFocus",input:"onInput",invalid:"onInvalid",keydown:"onKeyDown",keypress:"onKeyPress",keyup:"onKeyUp",mousedown:"onMouseDown",mouseup:"onMouseUp",paste:"onPaste",pause:"onPause",play:"onPlay",pointercancel:"onPointerCancel",pointerdown:"onPointerDown",pointerup:"onPointerUp",ratechange:"onRateChange",reset:"onReset",seeked:"onSeeked",submit:"onSubmit",touchcancel:"onTouchCancel",touchend:"onTouchEnd",touchstart:"onTouchStart",volumechange:"onVolumeChange",abort:"onAbort",animationend:"onAnimationEnd",animationiteration:"onAnimationIteration",animationstart:"onAnimationStart",canplay:"onCanPlay",canplaythrough:"onCanPlayThrough",drag:"onDrag",dragenter:"onDragEnter",dragexit:"onDragExit",dragleave:"onDragLeave",dragover:"onDragOver",durationchange:"onDurationChange",emptied:"onEmptied",encrypted:"onEncrypted",ended:"onEnded",error:"onError",gotpointercapture:"onGotPointerCapture",load:"onLoad",loadeddata:"onLoadedData",loadedmetadata:"onLoadedMetadata",loadstart:"onLoadStart",lostpointercapture:"onLostPointerCapture",mousemove:"onMouseMove",mouseout:"onMouseOut",mouseover:"onMouseOver",playing:"onPlaying",pointermove:"onPointerMove",pointerout:"onPointerOut",pointerover:"onPointerOver",progress:"onProgress",scroll:"onScroll",seeking:"onSeeking",stalled:"onStalled",suspend:"onSuspend",timeupdate:"onTimeUpdate",toggle:"onToggle",touchmove:"onTouchMove",transitionend:"onTransitionEnd",waiting:"onWaiting",wheel:"onWheel",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",pointerenter:"onPointerEnter",pointerleave:"onPointerLeave",change:"onChange",select:"onSelect",beforeinput:"onBeforeInput",compositionend:"onCompositionEnd",compositionstart:"onCompositionStart",compositionupdate:"onCompositionUpdate"},Tn=function(e){return En[e]||e},wn=function(){function e(e){this._classes=new Set,this._events={},this._style={},this._props={},this._ref=null,this._onChange=null,this._onChange=e,this.onChange=this.onChange.bind(this),this.addClass=this.addClass.bind(this),this.removeClass=this.removeClass.bind(this),this.hasClass=this.hasClass.bind(this),this.setProp=this.setProp.bind(this),this.getProp=this.getProp.bind(this),this.removeProp=this.removeProp.bind(this),this.setStyle=this.setStyle.bind(this),this.addEventListener=this.addEventListener.bind(this),this.removeEventListener=this.removeEventListener.bind(this),this.setRef=this.setRef.bind(this)}return e.prototype.onChange=function(){this._onChange&&this._onChange()},e.prototype.destroy=function(){var e=this;this._onChange=null,this._events={},this._style={},this._props={},this._classes=new Set,setTimeout((function(){e._ref=null}))},e.prototype.addClass=function(e){this._classes.has(e)||(this._classes.add(e),this.onChange())},e.prototype.removeClass=function(e){this._classes.has(e)&&(this._classes.delete(e),this.onChange())},e.prototype.hasClass=function(e){return this._classes.has(e)},e.prototype.setProp=function(e,t,i){void 0===i&&(i=!1),this._props[e]!==t&&(this._props[e]=t,!i&&this.onChange())},e.prototype.getProp=function(e){return this._props[e]},e.prototype.removeProp=function(e){void 0!==this._props[e]&&(delete this._props[e],this.onChange())},e.prototype.props=function(e){var t=this,i=e.className,n=void 0===i?"":i,s=e.style,r=void 0===s?{}:s,o=Object.entries(e).reduce((function(e,i){var n=(0,fn.CR)(i,2),s=n[0],r=n[1],o=t._events[s];if("function"==typeof r&&"function"==typeof o){e[s]=function(e){return o(e),r(e)}}return e}),(0,fn.pi)({},this._events)),a=d()(n,(0,fn.fl)(this._classes)),l=(0,fn.pi)((0,fn.pi)({},this._style),r);return(0,fn.pi)((0,fn.pi)((0,fn.pi)((0,fn.pi)({},e),this._props),o),{style:l,className:a})},e.prototype.setStyle=function(e,t){e=e.startsWith("--")?e:e.replace(/(-[a-z])/g,(function(e){return e.toUpperCase().replace("-","")})),this._style[e]!==t&&(this._style[e]=t,this.onChange())},e.prototype.addEventListener=function(e,t){var i=Tn(e);this._events[i]!==t&&(this._events[i]=t,this.onChange())},e.prototype.removeEventListener=function(e,t){var i=Tn(e);this._events[i]&&(delete this._events[i],this.onChange())},e.prototype.setRef=function(e){e&&(this._ref=e)},Object.defineProperty(e.prototype,"ref",{get:function(){return this._ref},enumerable:!1,configurable:!0}),e}(),xn=function(e){return function(t,i,n){var s;void 0===n&&(n=!1),s=new CustomEvent(t,{detail:i,bubbles:n}),Object.defineProperty(s,"target",{value:i,writable:!1}),Object.defineProperty(s,"currentTarget",{value:i,writable:!1});var r=t;return e[r]&&e[r](s),s}},_n={bottom:0,height:0,left:0,right:0,top:0,width:0},Mn={animation:{prefixed:"-webkit-animation",standard:"animation"},transform:{prefixed:"-webkit-transform",standard:"transform"},transition:{prefixed:"-webkit-transition",standard:"transition"}},On={animationend:{cssProperty:"animation",prefixed:"webkitAnimationEnd",standard:"animationend"},animationiteration:{cssProperty:"animation",prefixed:"webkitAnimationIteration",standard:"animationiteration"},animationstart:{cssProperty:"animation",prefixed:"webkitAnimationStart",standard:"animationstart"},transitionend:{cssProperty:"transition",prefixed:"webkitTransitionEnd",standard:"transitionend"}};function An(e){return Boolean(e.document)&&"function"==typeof e.document.createElement}var Cn=function(){function e(e){void 0===e&&(e={}),this.adapter_=e}return Object.defineProperty(e,"cssClasses",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"strings",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"numbers",{get:function(){return{}},enumerable:!0,configurable:!0}),Object.defineProperty(e,"defaultAdapter",{get:function(){return{}},enumerable:!0,configurable:!0}),e.prototype.init=function(){},e.prototype.destroy=function(){},e}();var Pn={ACTIVE:"mdc-slider--active",DISABLED:"mdc-slider--disabled",DISCRETE:"mdc-slider--discrete",FOCUS:"mdc-slider--focus",HAS_TRACK_MARKER:"mdc-slider--display-markers",IN_TRANSIT:"mdc-slider--in-transit",IS_DISCRETE:"mdc-slider--discrete"},Dn={ARIA_DISABLED:"aria-disabled",ARIA_VALUEMAX:"aria-valuemax",ARIA_VALUEMIN:"aria-valuemin",ARIA_VALUENOW:"aria-valuenow",CHANGE_EVENT:"MDCSlider:change",INPUT_EVENT:"MDCSlider:input",PIN_VALUE_MARKER_SELECTOR:".mdc-slider__pin-value-marker",STEP_DATA_ATTR:"data-step",THUMB_CONTAINER_SELECTOR:".mdc-slider__thumb-container",TRACK_MARKER_CONTAINER_SELECTOR:".mdc-slider__track-marker-container",TRACK_SELECTOR:".mdc-slider__track"},Nn={PAGE_FACTOR:4},In=["mousedown","pointerdown","touchstart"],Ln=["mouseup","pointerup","touchend"],Rn={mousedown:"mousemove",pointerdown:"pointermove",touchstart:"touchmove"},kn="ArrowDown",Un="ArrowLeft",Bn="ArrowRight",Fn="ArrowUp",Vn="End",Hn="Home",jn="PageDown",Gn="PageUp",zn=function(e){function t(i){var n=e.call(this,fn.pi({},t.defaultAdapter,i))||this;return n.savedTabIndex_=NaN,n.active_=!1,n.inTransit_=!1,n.isDiscrete_=!1,n.hasTrackMarker_=!1,n.handlingThumbTargetEvt_=!1,n.min_=0,n.max_=100,n.step_=0,n.value_=0,n.disabled_=!1,n.preventFocusState_=!1,n.thumbContainerPointerHandler_=function(){return n.handlingThumbTargetEvt_=!0},n.interactionStartHandler_=function(e){return n.handleDown_(e)},n.keydownHandler_=function(e){return n.handleKeydown_(e)},n.focusHandler_=function(){return n.handleFocus_()},n.blurHandler_=function(){return n.handleBlur_()},n.resizeHandler_=function(){return n.layout()},n}return fn.ZT(t,e),Object.defineProperty(t,"cssClasses",{get:function(){return Pn},enumerable:!0,configurable:!0}),Object.defineProperty(t,"strings",{get:function(){return Dn},enumerable:!0,configurable:!0}),Object.defineProperty(t,"numbers",{get:function(){return Nn},enumerable:!0,configurable:!0}),Object.defineProperty(t,"defaultAdapter",{get:function(){return{hasClass:function(){return!1},addClass:function(){},removeClass:function(){},getAttribute:function(){return null},setAttribute:function(){},removeAttribute:function(){},computeBoundingRect:function(){return{top:0,right:0,bottom:0,left:0,width:0,height:0}},getTabIndex:function(){return 0},registerInteractionHandler:function(){},deregisterInteractionHandler:function(){},registerThumbContainerInteractionHandler:function(){},deregisterThumbContainerInteractionHandler:function(){},registerBodyInteractionHandler:function(){},deregisterBodyInteractionHandler:function(){},registerResizeHandler:function(){},deregisterResizeHandler:function(){},notifyInput:function(){},notifyChange:function(){},setThumbContainerStyleProperty:function(){},setTrackStyleProperty:function(){},setMarkerValue:function(){},setTrackMarkers:function(){},isRTL:function(){return!1}}},enumerable:!0,configurable:!0}),t.prototype.init=function(){var e=this;this.isDiscrete_=this.adapter_.hasClass(Pn.IS_DISCRETE),this.hasTrackMarker_=this.adapter_.hasClass(Pn.HAS_TRACK_MARKER),In.forEach((function(t){e.adapter_.registerInteractionHandler(t,e.interactionStartHandler_),e.adapter_.registerThumbContainerInteractionHandler(t,e.thumbContainerPointerHandler_)})),this.adapter_.registerInteractionHandler("keydown",this.keydownHandler_),this.adapter_.registerInteractionHandler("focus",this.focusHandler_),this.adapter_.registerInteractionHandler("blur",this.blurHandler_),this.adapter_.registerResizeHandler(this.resizeHandler_),this.layout(),this.isDiscrete_&&0===this.getStep()&&(this.step_=1)},t.prototype.destroy=function(){var e=this;In.forEach((function(t){e.adapter_.deregisterInteractionHandler(t,e.interactionStartHandler_),e.adapter_.deregisterThumbContainerInteractionHandler(t,e.thumbContainerPointerHandler_)})),this.adapter_.deregisterInteractionHandler("keydown",this.keydownHandler_),this.adapter_.deregisterInteractionHandler("focus",this.focusHandler_),this.adapter_.deregisterInteractionHandler("blur",this.blurHandler_),this.adapter_.deregisterResizeHandler(this.resizeHandler_)},t.prototype.setupTrackMarker=function(){this.isDiscrete_&&this.hasTrackMarker_&&0!==this.getStep()&&this.adapter_.setTrackMarkers(this.getStep(),this.getMax(),this.getMin())},t.prototype.layout=function(){this.rect_=this.adapter_.computeBoundingRect(),this.updateUIForCurrentValue_()},t.prototype.getValue=function(){return this.value_},t.prototype.setValue=function(e){this.setValue_(e,!1)},t.prototype.getMax=function(){return this.max_},t.prototype.setMax=function(e){if(e<this.min_)throw new Error("Cannot set max to be less than the slider's minimum value");this.max_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(Dn.ARIA_VALUEMAX,String(this.max_)),this.setupTrackMarker()},t.prototype.getMin=function(){return this.min_},t.prototype.setMin=function(e){if(e>this.max_)throw new Error("Cannot set min to be greater than the slider's maximum value");this.min_=e,this.setValue_(this.value_,!1,!0),this.adapter_.setAttribute(Dn.ARIA_VALUEMIN,String(this.min_)),this.setupTrackMarker()},t.prototype.getStep=function(){return this.step_},t.prototype.setStep=function(e){if(e<0)throw new Error("Step cannot be set to a negative number");this.isDiscrete_&&("number"!=typeof e||e<1)&&(e=1),this.step_=e,this.setValue_(this.value_,!1,!0),this.setupTrackMarker()},t.prototype.isDisabled=function(){return this.disabled_},t.prototype.setDisabled=function(e){this.disabled_=e,this.toggleClass_(Pn.DISABLED,this.disabled_),this.disabled_?(this.savedTabIndex_=this.adapter_.getTabIndex(),this.adapter_.setAttribute(Dn.ARIA_DISABLED,"true"),this.adapter_.removeAttribute("tabindex")):(this.adapter_.removeAttribute(Dn.ARIA_DISABLED),isNaN(this.savedTabIndex_)||this.adapter_.setAttribute("tabindex",String(this.savedTabIndex_)))},t.prototype.handleDown_=function(e){var t=this;if(!this.disabled_){this.preventFocusState_=!0,this.setInTransit_(!this.handlingThumbTargetEvt_),this.handlingThumbTargetEvt_=!1,this.setActive_(!0);var i=function(e){t.handleMove_(e)},n=Rn[e.type],s=function(){t.handleUp_(),t.adapter_.deregisterBodyInteractionHandler(n,i),Ln.forEach((function(e){return t.adapter_.deregisterBodyInteractionHandler(e,s)}))};this.adapter_.registerBodyInteractionHandler(n,i),Ln.forEach((function(e){return t.adapter_.registerBodyInteractionHandler(e,s)})),this.setValueFromEvt_(e)}},t.prototype.handleMove_=function(e){e.preventDefault(),this.setValueFromEvt_(e)},t.prototype.handleUp_=function(){this.setActive_(!1),this.adapter_.notifyChange()},t.prototype.getClientX_=function(e){return e.targetTouches&&e.targetTouches.length>0?e.targetTouches[0].clientX:e.clientX},t.prototype.setValueFromEvt_=function(e){var t=this.getClientX_(e),i=this.computeValueFromClientX_(t);this.setValue_(i,!0)},t.prototype.computeValueFromClientX_=function(e){var t=this.max_,i=this.min_,n=(e-this.rect_.left)/this.rect_.width;return this.adapter_.isRTL()&&(n=1-n),i+n*(t-i)},t.prototype.handleKeydown_=function(e){var t=this.getKeyId_(e),i=this.getValueForKeyId_(t);isNaN(i)||(e.preventDefault(),this.adapter_.addClass(Pn.FOCUS),this.setValue_(i,!0),this.adapter_.notifyChange())},t.prototype.getKeyId_=function(e){return e.key===Un||37===e.keyCode?Un:e.key===Bn||39===e.keyCode?Bn:e.key===Fn||38===e.keyCode?Fn:e.key===kn||40===e.keyCode?kn:e.key===Hn||36===e.keyCode?Hn:e.key===Vn||35===e.keyCode?Vn:e.key===Gn||33===e.keyCode?Gn:e.key===jn||34===e.keyCode?jn:""},t.prototype.getValueForKeyId_=function(e){var t=this,i=t.max_,n=t.min_,s=t.step_||(i-n)/100;switch(this.adapter_.isRTL()&&(e===Un||e===Bn)&&(s=-s),e){case Un:case kn:return this.value_-s;case Bn:case Fn:return this.value_+s;case Hn:return this.min_;case Vn:return this.max_;case Gn:return this.value_+s*Nn.PAGE_FACTOR;case jn:return this.value_-s*Nn.PAGE_FACTOR;default:return NaN}},t.prototype.handleFocus_=function(){this.preventFocusState_||this.adapter_.addClass(Pn.FOCUS)},t.prototype.handleBlur_=function(){this.preventFocusState_=!1,this.adapter_.removeClass(Pn.FOCUS)},t.prototype.setValue_=function(e,t,i){if(void 0===i&&(i=!1),e!==this.value_||i){var n=this.min_,s=this.max_,r=e===n||e===s;this.step_&&!r&&(e=this.quantize_(e)),e<n?e=n:e>s&&(e=s),e=e||0,this.value_=e,this.adapter_.setAttribute(Dn.ARIA_VALUENOW,String(this.value_)),this.updateUIForCurrentValue_(),t&&(this.adapter_.notifyInput(),this.isDiscrete_&&this.adapter_.setMarkerValue(e))}},t.prototype.quantize_=function(e){return Math.round(e/this.step_)*this.step_},t.prototype.updateUIForCurrentValue_=function(){var e=this,t=this,i=t.max_,n=t.min_,s=(t.value_-n)/(i-n),r=s*this.rect_.width;this.adapter_.isRTL()&&(r=this.rect_.width-r);var o=function(e,t){if(An(e)&&t in Mn){var i=e.document.createElement("div"),n=Mn[t],s=n.standard,r=n.prefixed;return s in i.style?s:r}return t}(window,"transform"),a=function(e,t){if(An(e)&&t in On){var i=e.document.createElement("div"),n=On[t],s=n.standard,r=n.prefixed;return n.cssProperty in i.style?s:r}return t}(window,"transitionend");if(this.inTransit_){var l=function(){e.setInTransit_(!1),e.adapter_.deregisterThumbContainerInteractionHandler(a,l)};this.adapter_.registerThumbContainerInteractionHandler(a,l)}requestAnimationFrame((function(){e.adapter_.setThumbContainerStyleProperty(o,"translateX("+r+"px) translateX(-50%)"),e.adapter_.setTrackStyleProperty(o,"scaleX("+s+")")}))},t.prototype.setActive_=function(e){this.active_=e,this.toggleClass_(Pn.ACTIVE,this.active_)},t.prototype.setInTransit_=function(e){this.inTransit_=e,this.toggleClass_(Pn.IN_TRANSIT,this.inTransit_)},t.prototype.toggleClass_=function(e,t){t?this.adapter_.addClass(e):this.adapter_.removeClass(e)},t}(Cn);var Wn=function(e){var t=(0,r.useRef)(),i=(0,r.useRef)(),n=function(e){var t=e.foundation,i=e.props,n=e.elements,s=e.api,o=(0,fn.CR)((0,r.useState)(0),2)[1],a=(0,r.useRef)(i);a.current=i;var l=(0,r.useMemo)((function(){return Object.keys(n).reduce((function(e,t){return e[t]=new wn((function(){o((function(e){return e+1}))})),e}),{})}),[]),c=(0,r.useMemo)((function(){var e=t((0,fn.pi)((0,fn.pi)({},l),{getProps:function(){return a.current},emit:function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return xn(a.current).apply(void 0,(0,fn.fl)(e))}}));return s&&bn(a.current.apiRef,s((0,fn.pi)({foundation:e},l))),e}),[]);return(0,r.useEffect)((function(){var e=c;return e.init(),s&&bn(a.current.apiRef,s((0,fn.pi)({foundation:e},l))),bn(a.current.foundationRef,e),function(){e.destroy(),bn(a.current.apiRef,null),bn(a.current.foundationRef,null),Object.values(l).map((function(e){return e.destroy()})),a.current={}}}),[c,l]),(0,fn.pi)({foundation:c},l)}({props:e,elements:{rootEl:!0,thumbContainerEl:!0,sliderPinEl:!0},foundation:function(e){var n,r,o,a=e.rootEl,l=e.thumbContainerEl,c=e.sliderPinEl,d=e.emit;return new zn({hasClass:function(e){return a.hasClass(e)},addClass:function(e){return a.addClass(e)},removeClass:function(e){return a.removeClass(e)},getAttribute:function(e){return a.getProp(e)},setAttribute:(n=function(e,t){return a.setProp(e,t)},r=300,function(){var e=this,t=arguments,i=function(){o=null,n.apply(e,t)};null!==o&&clearTimeout(o),o=setTimeout(i,r)}),removeAttribute:function(e){return a.removeProp(e)},computeBoundingRect:function(){return a.ref?a.ref.getBoundingClientRect():_n},getTabIndex:function(){return a.ref?a.ref.tabIndex:0},registerInteractionHandler:function(e,t){a.addEventListener(e,t)},deregisterInteractionHandler:function(e,t){a.removeEventListener(e,t)},registerThumbContainerInteractionHandler:function(e,t){l.addEventListener(e,t)},deregisterThumbContainerInteractionHandler:function(e,t){l.removeEventListener(e,t)},registerBodyInteractionHandler:function(e,t){document.body&&document.body.addEventListener(e,t)},deregisterBodyInteractionHandler:function(e,t){document.body&&document.body.removeEventListener(e,t)},registerResizeHandler:function(e){window.addEventListener("resize",e)},deregisterResizeHandler:function(e){window.removeEventListener("resize",e)},notifyInput:function(){d("onInput",{value:s.getValue()})},notifyChange:function(){d("onChange",{value:s.getValue()})},setThumbContainerStyleProperty:function(e,t){l.setStyle(e,t)},setTrackStyleProperty:function(e,i){var n;null===(n=t.current)||void 0===n||n.style.setProperty(e,i)},setMarkerValue:function(e){c.setProp("value",e)},setTrackMarkers:function(e,t,n){var s,r=e.toLocaleString(),o="linear-gradient(to right, currentColor 2px, transparent 0) "+("0 center / calc((100% - 2px) / "+("(("+t.toLocaleString()+" - "+n.toLocaleString()+") / "+r+")")+") 100% repeat-x");null===(s=i.current)||void 0===s||s.style.setProperty("background",o)},isRTL:function(){return!!a.ref&&"rtl"===getComputedStyle(a.ref).direction}})}}),s=n.foundation,o=(0,fn._T)(n,["foundation"]);return(0,r.useEffect)((function(){void 0!==e.max&&s.setMax(+e.max)}),[e.max,s]),(0,r.useEffect)((function(){void 0!==e.min&&s.setMin(+e.min)}),[e.min,s]),(0,r.useEffect)((function(){var t=void 0!==e.value?Number(e.value):s.getValue(),i=s.getMin(),n=s.getMax();t<i&&(console.warn("Attempted to set slider to "+t+" which is less than min: "+i),t=i),t>n&&(console.warn("Attempted to set slider to "+t+" which is greater than max: "+n),t=n),s.setValue(t)}),[e.value,s]),(0,r.useEffect)((function(){void 0!==e.step&&s.setStep(+e.step)}),[e.step,s]),(0,r.useEffect)((function(){void 0!==e.disabled&&s.setDisabled(e.disabled)}),[e.disabled,s]),(0,r.useEffect)((function(){void 0!==e.discrete&&(s.isDiscrete_=e.discrete),e.discrete&&0===s.getStep()&&s.setStep(1)}),[e.discrete,s]),(0,r.useEffect)((function(){var t=s.hasTrackMarker_;void 0!==e.displayMarkers&&e.displayMarkers!==t&&(s.hasTrackMarker_=e.displayMarkers,window.requestAnimationFrame((function(){return s.setupTrackMarker()})))}),[e.displayMarkers,s]),(0,r.useEffect)((function(){var e=s.handleDown_.bind(s);s.handleDown_=function(t){t.persist(),e(t)}}),[s]),(0,fn.pi)({setTrackRef:function(e){return t.current=e},setTrackMarkerContainerRef:function(e){return i.current=e}},o)},Kn=r.memo(r.forwardRef((function(e,t){return r.createElement("div",{ref:t,className:"mdc-slider__track"})}))),Yn=r.memo(r.forwardRef((function(e,t){return r.createElement("div",{ref:t,className:"mdc-slider__track-marker-container"})}))),qn=r.memo((function(e){var t=e.value;return r.createElement("div",{className:"mdc-slider__pin"},r.createElement("span",{className:"mdc-slider__pin-value-marker"},t))})),Zn=r.memo((function(){return r.createElement("svg",{className:"mdc-slider__thumb",width:"21",height:"21"},r.createElement("circle",{cx:"10.5",cy:"10.5",r:"7.875"}))})),$n=r.memo((function(){return r.createElement("div",{className:"mdc-slider__focus-ring"})})),Qn=Sn((function(e,t){var i=Wn(e),n=i.rootEl,s=i.thumbContainerEl,o=i.sliderPinEl,a=i.setTrackRef,l=i.setTrackMarkerContainerRef,c=e.value,h=(e.min,e.max),u=e.discrete,p=e.displayMarkers,m=e.step,f=e.disabled,g=(e.onChange,e.onInput,e.children),v=(e.foundationRef,(0,fn._T)(e,["value","min","max","discrete","displayMarkers","step","disabled","onChange","onInput","children","foundationRef"])),y=function(e,t){return d().apply(void 0,(0,fn.fl)([e.className],e.theme?gn(e.theme):[],"function"==typeof t?t(e):t))}(e,["mdc-slider",{"mdc-slider--discrete":u,"mdc-slider--display-markers":p&&u}]),b=m?{"data-step":m}:{};return p&&!u&&console.warn("The 'displayMarkers' prop on rmwc Slider will\n        only work in conjunction with the 'discrete' prop"),r.createElement(vn,(0,fn.pi)({tabIndex:0,role:"slider","aria-valuemax":h,"aria-valuenow":c,"aria-label":"Select Value"},f?{"aria-disabled":f}:{},b,v,{ref:t,element:n,className:y}),r.createElement("div",{className:"mdc-slider__track-container"},r.createElement(Kn,{ref:a}),p&&r.createElement(Yn,{ref:l})),r.createElement(vn,{element:s,className:"mdc-slider__thumb-container"},u&&r.createElement(qn,{value:o.getProp("value")}),r.createElement(Zn,null),r.createElement($n,null)),g)}));i(85925);let Xn=0;class SliderWithTooltip extends r.Component{constructor(e){super(e),this.mdcRef=(0,r.createRef)(),this.setValue=e=>{this.setState({value:e})},this.onSliderInput=e=>{var t;const i=e.detail.value;this.layoutRecalculated||(null===(t=this.mdcRef.current)||void 0===t||t.layout(),this.layoutRecalculated=!0),this.setState({value:i}),this.props.onInput&&this.props.onInput(i)},this.onSliderChange=e=>{const t=e.detail.value;this.setState({value:t}),this.props.onChange&&this.props.onChange(t)},this.getLeftOffset=()=>100*(this.state.value-this.props.min)/(this.props.max-this.props.min)+"%",this.getSliderId=()=>`slider-with-tooltip-${this.id}`,this.getStyleElement=()=>`#${this.getSliderId()} .mdc-slider__thumb-container {\n        left: ${this.getLeftOffset()}\n    }`,this.getDisplayValue=e=>{const{formatNumbers:t,units:i}=this.props;return(t?t(e):e)+(i||"")},this.setActive=e=>()=>this.setState({active:e}),this.hasChanged=()=>{this.setState({hasChanged:!1})},this.onMouseDown=e=>{this.props.onInputStart&&this.props.onInputStart()},this.onEventMouseUp=e=>{this.props.onInputEnd&&this.props.onInputEnd()},this.onMouseUp=e=>{this.props.onInputEnd&&this.props.onInputEnd()},this.id=Xn++,this.state={value:void 0!==e.initialValue?e.initialValue:(e.max+e.min)/2,active:!1,hasChanged:!1},this.setActiveSlider=this.setActive(!0),this.setInactiveSlider=this.setActive(!1)}componentDidMount(){document.addEventListener("mouseup",this.onEventMouseUp),document.addEventListener("mouseleave",this.onEventMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onEventMouseUp),document.removeEventListener("mouseleave",this.onEventMouseUp)}componentDidUpdate(e,t){t.value!==this.state.value&&(clearTimeout(this.hasChangedTimeout),this.setState({hasChanged:!0}),this.hasChangedTimeout=window.setTimeout(this.hasChanged,450))}render(){const{width:e,displayBounds:t,min:i,max:n,discrete:s,tooltipPosition:r}=this.props,{active:o,hasChanged:a,value:c}=this.state,h={left:this.getLeftOffset()};return(0,l.jsxs)("div",Object.assign({id:this.getSliderId(),className:d()("slider-with-tooltip",{displayBounds:t}),style:{width:`${e}px`},onMouseEnter:this.setActiveSlider,onMouseLeave:this.setInactiveSlider},{children:[r===Jn.UP&&(0,l.jsx)("div",{className:d()("slider-tooltip",{active:o||a}),"data-balloon":this.getDisplayValue(c),"data-balloon-pos":Jn.UP,style:h},void 0),t&&(0,l.jsx)("div",Object.assign({className:"min-amount"},{children:this.getDisplayValue(i)}),void 0),(0,l.jsx)(Qn,{discrete:s,min:i,max:n,value:c,onInput:this.onSliderInput,onChange:this.onSliderChange,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,foundationRef:this.mdcRef},void 0),t&&(0,l.jsx)("div",Object.assign({className:"max-amount"},{children:this.getDisplayValue(n)}),void 0),(0,l.jsx)("style",{dangerouslySetInnerHTML:{__html:this.getStyleElement()}},void 0),r===Jn.DOWN&&(0,l.jsx)("div",{className:d()("slider-tooltip",{active:o||a}),"data-balloon":this.getDisplayValue(c),"data-balloon-pos":Jn.DOWN,style:h},void 0)]}),void 0)}}var Jn;!function(e){e.UP="up",e.DOWN="down"}(Jn||(Jn={}));const es=e=>{let t="";t+=Math.floor(e)+"'";const i=Math.floor(e%1*12);return i<10&&(t+="0"),t+=i+"''",t};var ts=i(48711),is=i(51058);const{MATTERTAGS:ns}=f.Z.WORKSHOP;class StemSlider extends r.Component{constructor(e){super(e),this.sliderRef=(0,r.createRef)(),this.setStemValue=(e,t=!0)=>{const i=t?(0,ts._F)(e):e;if(i!==this.props.stemHeight){const{manager:e,sid:t,onEdited:n}=this.props;e.setStemHeight(t,i).then(n)}},this.onClickReset=()=>{const e=this.sliderRef.current;e&&(this.setStemValue(this.state.originalStemHeight,!1),e.setValue((0,ts.zy)(this.state.originalStemHeight)))},this.onToggleStemVisibility=()=>{const{manager:e,sid:t,stemVisible:i,onEdited:n}=this.props;e.setStemVisibility(t,!i).then(n)},this.stopPropagation=e=>{e.stopPropagation()},this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(_.gx.Units,is.M.IMPERIAL)})},this.formatStemHeight=e=>{if(this.state.units===is.M.IMPERIAL)return es(e);return`${Math.round(100*(0,ts._F)(e))/100}m`},this.state={originalStemHeight:e.stemHeight,units:is.M.IMPERIAL}}componentDidMount(){const e=this.sliderRef.current;e&&e.setValue((0,ts.zy)(this.props.stemHeight)),this.context.settings.onPropertyChanged(_.gx.Units,this.updateUnits),this.updateUnits()}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(_.gx.Units,this.updateUnits)}render(){const{locale:e}=this.context,{stemVisible:t,stemHeight:i}=this.props,{originalStemHeight:n}=this.state,s=n!==i,r=e.t(ns.STEM_SLIDER_RESET_CTA),o=e.t(ns.SHOW_STEM_LABEL);return(0,l.jsxs)("div",Object.assign({className:"editable-popover stem-popover",onClick:this.stopPropagation},{children:[(0,l.jsx)(SliderWithTooltip,{ref:this.sliderRef,discrete:!1,min:0,max:9,initialValue:(0,ts.zy)(n),onInput:this.setStemValue,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:Jn.DOWN},void 0),(0,l.jsx)("div",Object.assign({className:d()("link-btn","popover-btn","stem-slider-reset",{disabled:!s}),onClick:this.onClickReset},{children:r}),void 0),(0,l.jsx)("hr",{},void 0),(0,l.jsxs)("div",Object.assign({className:"stem-checkbox",onClick:this.onToggleStemVisibility},{children:[(0,l.jsx)("div",{className:d()("checkbox icon-checkmark",{checked:t})},void 0),(0,l.jsx)("div",Object.assign({className:"checkbox-text"},{children:o}),void 0)]}),void 0)]}),void 0)}}StemSlider.contextType=m.I;var ss=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let rs=class ColorPicker extends r.Component{constructor(e){super(e),this.clickColor=e=>{const t=e.currentTarget;if(t&&t.getAttribute){const i=t.dataset.value;i&&(e.stopPropagation(),this.props.onColorPicked(i),this.setState({activeColor:i}))}},this.renderColorSwatch=e=>{const{activeColor:t}=this.state,i={backgroundColor:e},n=d()({"color-swatch":!0,"icon-checkmark":!0,active:e===t});return(0,l.jsx)("div",{className:n,style:i,"data-value":e,onClick:this.clickColor},e)},this.state={activeColor:e.defaultColor||""}}UNSAFE_componentWillReceiveProps(e){e.defaultColor&&!this.state.activeColor&&this.setState({activeColor:e.defaultColor})}render(){const{colors:e}=this.props;return(0,l.jsx)("div",Object.assign({className:"color-picker"},{children:e.map((e=>this.renderColorSwatch(e)))}),void 0)}};rs=ss([I.Z],rs);const os=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];class DiscColorPicker extends r.Component{constructor(e){super(e),this.handleColorPicked=e=>{const{manager:t,sid:i,onEdited:n}=this.props;t.setColor(i,e).then(n)},this.stopPropagation=e=>{e.stopPropagation()}}render(){const{color:e}=this.props;return(0,l.jsx)("div",Object.assign({className:"editable-popover color-editor",onClick:this.stopPropagation},{children:(0,l.jsx)(rs,{colors:os,defaultColor:e,onColorPicked:this.handleColorPicked},void 0)}),void 0)}}const{MATTERTAGS:as}=f.Z.WORKSHOP;var ls;!function(e){e[e.NONE=0]="NONE",e[e.INVALID_URL_SYNTAX=1]="INVALID_URL_SYNTAX",e[e.LOADING=2]="LOADING",e[e.LOADED=3]="LOADED",e[e.ERROR=4]="ERROR"}(ls||(ls={}));class MediaLinkInput extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.onInput=e=>{const t=sn(e)?ls.NONE:ls.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=()=>{this.applyDisabled||this.onChangeMedia(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onChangeMedia=async e=>{const{sid:t,mediaSrc:i,onEdited:n,manager:s}=this.props;if(e!==i){const i=await this.loadMedia(e);if(i!==Ui.z.error){if(await s.setEmbed(t,e,i),this.isUnmounting)return;this.setState({validationPhase:ls.LOADED}),n()}else{if(this.isUnmounting)return;this.setState({validationPhase:ls.ERROR})}}else this.props.onCancel()},this.loadMedia=async e=>{let t=Ui.z.none;return this.setState({validationPhase:ls.NONE}),e&&(this.setState({validationPhase:ls.LOADING}),t=await this.props.embedlyValidator.getType(e)),t},this.state={currentUrl:e.mediaSrc,validationPhase:this.getInitialValidationPhase()}}componentWillUnmount(){this.isUnmounting=!0}getInitialValidationPhase(){return this.props.mediaType===Ui.z.error?ls.ERROR:this.props.mediaSrc?ls.LOADED:ls.NONE}UNSAFE_componentWillReceiveProps(e){this.props.mediaSrc!==e.mediaSrc&&this.setState({currentUrl:e.mediaSrc})}render(){const{locale:e}=this.context,{onCancel:t}=this.props,{currentUrl:i}=this.state,n=e.t(as.MEDIA_LINK_LABEL),s=e.t(as.MEDIA_LINK_SUPPORTED_FORMATS_LINK);return(0,l.jsxs)("div",Object.assign({className:"annotation-popup open media-editor",onClick:this.stopPropagation},{children:[(0,l.jsxs)("div",Object.assign({className:"popover-header"},{children:[(0,l.jsxs)("div",Object.assign({className:"popover-label"},{children:[n,(0,l.jsx)("a",Object.assign({className:"link",target:"_blank",href:MediaLinkInput.supportPage},{children:s}),void 0)]}),void 0),(0,l.jsx)(te.P,{buttonStyle:te.A.LIGHT,onClose:t},void 0)]}),void 0),(0,l.jsx)(dn,{text:i,type:"url",className:"text-field-dark",placeholder:"https://",onDone:this.onChangeMedia,onInput:this.onInput},void 0),this.renderPopoverFooter()]}),void 0)}get applyDisabled(){const{mediaSrc:e}=this.props,{validationPhase:t,currentUrl:i}=this.state;return t===ls.ERROR||t===ls.LOADING||t===ls.INVALID_URL_SYNTAX&&""!==i||i===e&&""===i}renderPopoverFooter(){const{locale:e}=this.context,t=this.applyDisabled?w.BN.DIMMED:w.BN.ENABLED,i=e.t(as.MEDIA_LINK_APPLY_CTA);return(0,l.jsxs)("div",Object.assign({className:"popover-footer"},{children:[this.renderValidationMessage(),(0,l.jsx)(w.zx,Object.assign({className:"button-inline",buttonStyle:w.ZJ.CLEAR,buttonSize:w.qE.SMALL,buttonState:t,onClick:this.onApply},{children:i}),void 0)]}),void 0)}renderValidationMessage(){const{locale:e}=this.context;switch(this.state.validationPhase){case ls.ERROR:return(0,l.jsxs)("div",Object.assign({className:"popover-message popover-message-error"},{children:[e.t(as.MEDIA_LINK_ERROR_MESSAGE),(0,l.jsx)("a",Object.assign({className:"link",target:"_blank",href:MediaLinkInput.supportPage},{children:e.t(as.MEDIA_LINK_HELP_LINK)}),void 0)]}),void 0);case ls.LOADING:return(0,l.jsx)("div",Object.assign({className:"popover-message"},{children:e.t(as.MEDIA_LINK_LOADING_MESSAGE)}),void 0);case ls.INVALID_URL_SYNTAX:if(""!==this.state.currentUrl)return(0,l.jsx)("div",Object.assign({className:"popover-message popover-message-error"},{children:e.t(as.MEDIA_LINK_INVALID_URL_MESSAGE)}),void 0)}return(0,l.jsx)("div",{className:"popover-message"},void 0)}}MediaLinkInput.contextType=m.I,MediaLinkInput.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post";var cs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{MATTERTAGS:ds}=f.Z.WORKSHOP;var hs;!function(e){e.COLOR="color",e.STEM="stem",e.MEDIA="media",e.LINK="text-link"}(hs||(hs={}));let us=class EditableBillboardContent extends r.Component{constructor(e){super(e),this.textParser=new Wi.v({links:!0}),this.getColorStyle=()=>{const e=this.props.getSavedData().color;if(e)return{backgroundColor:e}},this.toggleVisibility=()=>{const{id:e,manager:t}=this.props;this.closePopover();const i=this.state.currentValues.visible;t.setVisibility(e,!i).then(this.onEdited)},this.onEdited=()=>{const e=this.props.getSavedData();e&&this.setState({currentValues:e,tagEmpty:this.props.manager.isTagEmpty(this.props.id)})},this.onMediaEdited=()=>{this.onEdited(),this.closePopover()},this.onMediaCancel=()=>{this.closePopover()},this.cancelEdits=()=>{this.props.manager.revertChanges()},this.doneEditing=()=>{const{manager:e,id:t}=this.props;e.saveMattertag(t)},this.onAddLinkClicked=e=>{if(e.stopPropagation(),this.state.popover===hs.LINK)this.closePopover();else if(this.state.linkCount<5){const e=this.billboardText.prepareNewLinkSelection();this.openLinkEditor(e)}},this.onClickLink=()=>{this.openLinkEditor(!1)},this.onDescriptionInput=e=>{const t=this.props.getSavedData(),i=(0,Ue.Yv)(t.label)&&(0,Ue.Yv)(t.mediaSrc)&&e;this.updateLinkCount(this.props.description),this.setState({tagEmpty:i})},this.onNavigationKey=e=>{e.keyCode===ei.R.ESCAPE&&this.cancelEdits()},this.billboardClick=e=>{e.stopPropagation();const{popover:t}=this.state;t===hs.LINK||t===hs.MEDIA||this.closePopover()},this.closePopover=()=>{const{popover:e}=this.state;null!==e&&this.setPopover(e,!1)},this.setBillboardTextRef=e=>{this.billboardText=e};const t=e.getSavedData();this.state={popover:null,linkCount:0,currentValues:Object.assign({},t),tagEmpty:e.manager.isTagEmpty(e.id)},this.clickColor=this.clickMenuIcon.bind(this,hs.COLOR),this.clickStem=this.clickMenuIcon.bind(this,hs.STEM),this.clickMedia=this.clickMenuIcon.bind(this,hs.MEDIA)}componentDidMount(){this.context.analytics.track("workshop_gui",{gui_action:"mattertag_editor_opened",tool:"mattertags"}),this.updateLinkCount(this.props.description)}componentDidUpdate(e,t){const i=this.props.manager.dataMap.mattertagsViewData.toolState;t.tagEmpty&&!this.state.tagEmpty&&i===Ii.rI.PLACED&&this.props.manager.dataMap.mattertagsViewData.setToolState(Ii.rI.EDITING),this.updateLinkCount(this.props.description)}setPopover(e,t){const i=this.state.popover,n=t?e:null;i!==n&&i===hs.LINK&&this.context.messageBus.broadcast(new CloseLinkEditorMessage),this.setState({popover:n})}openLinkEditor(e){this.setPopover(hs.LINK,!0),this.context.messageBus.broadcast(new OpenLinkEditorMessage(e))}updateLinkCount(e){let t=0;const i=this.textParser.parse(e);for(const e of i)e.blockType===zi.C.LINK&&t++;this.setState({linkCount:t})}clickMenuIcon(e,t){t.stopPropagation(),this.setPopover(e,this.state.popover!==e)}render(){const{locale:e}=this.context,{tagEmpty:t,popover:i}=this.state,n=null!==i,s=i===hs.LINK||i===hs.MEDIA,r=e.t(ds.EDIT_BILLBOARD_CANCEL_CTA),o=e.t(ds.EDIT_BILLBOARD_DONE_CTA);return(0,l.jsxs)("div",Object.assign({className:d()("editable-billboard-body",{"popover-open":n,"url-popover-open":s}),onClick:this.billboardClick},{children:[(0,l.jsxs)("div",Object.assign({className:"editable-billboard-content",onClick:this.billboardClick},{children:[this.renderTextContent(),this.renderMattertagMedia(),this.renderActivePopover()]}),void 0),(0,l.jsxs)("div",Object.assign({className:"billboard-footer",onClick:this.billboardClick},{children:[this.renderMenuItems(),(0,l.jsxs)("div",Object.assign({className:"billboard-cta"},{children:[(0,l.jsx)(w.zx,Object.assign({buttonStyle:w.ZJ.CLEAR,buttonSize:w.qE.SMALL,className:"button-inline",onClick:this.cancelEdits},{children:r}),void 0),(0,l.jsx)(w.zx,Object.assign({className:"button-inline",buttonStyle:w.ZJ.CLEAR,buttonSize:w.qE.SMALL,buttonState:t?w.BN.DISABLED:w.BN.ENABLED,onClick:this.doneEditing},{children:o}),void 0)]}),void 0)]}),void 0)]}),void 0)}renderActivePopover(){const{id:e,manager:t}=this.props,{popover:i,currentValues:n}=this.state,{stemVisible:s,stemHeight:r,color:o,mediaSrc:a,mediaType:c}=n;switch(i){case hs.STEM:return(0,l.jsx)(StemSlider,{sid:e,stemVisible:s,stemHeight:r,onEdited:this.onEdited,manager:t},void 0);case hs.COLOR:return(0,l.jsx)(DiscColorPicker,{sid:e,color:o,onEdited:this.onEdited,manager:t},void 0);case hs.MEDIA:return(0,l.jsx)(MediaLinkInput,{sid:e,mediaSrc:a,mediaType:c,embedlyValidator:this.props.embedlyValidator,onEdited:this.onMediaEdited,onCancel:this.onMediaCancel,manager:t},void 0);default:return null}}renderMenuItems(){const{locale:e}=this.context,{manager:t,id:i,fullSized:n}=this.props,{popover:s,currentValues:r,linkCount:o}=this.state,{visible:a}=r,c=t.isNewTag(i),h=s===hs.COLOR,u=s===hs.STEM,p=s===hs.MEDIA,m=s===hs.LINK,f=o<5,g=e.t(f?ds.LINK_TOOLTIP_MESSAGE:ds.LINK_DISABLED_TOOLTIP_MESSAGE),v=n?x.lZ.UP:x.lZ.DOWN,y=m?w.BN.ACTIVE:f?w.BN.ENABLED:w.BN.DIMMED;return(0,l.jsxs)("div",Object.assign({className:"billboard-menu"},{children:[(0,l.jsx)(T.hU,{iconClass:"icon-link",className:d()("billboard-menu-item","add-link"),buttonState:y,buttonStyle:T.Dd.CLEAR,onClick:this.onAddLinkClicked,tooltipMsg:m?void 0:g,tooltipPosition:v},void 0),(0,l.jsx)(T.hU,Object.assign({className:d()("billboard-menu-item","color"),buttonStyle:T.Dd.CLEAR,buttonState:h?w.BN.ACTIVE:w.BN.ENABLED,onClick:this.clickColor,tooltipMsg:h?void 0:e.t(ds.COLOR_TOOLTIP_MESSAGE),tooltipPosition:v},{children:(0,l.jsx)("span",{className:"color-dot",style:this.getColorStyle()},void 0)}),void 0),(0,l.jsx)(T.hU,{iconClass:"icon-stem-height",className:d()("billboard-menu-item","stem"),buttonStyle:T.Dd.CLEAR,buttonState:u?w.BN.ACTIVE:w.BN.ENABLED,onClick:this.clickStem,tooltipMsg:u?void 0:e.t(ds.STEM_TOOLTIP_MESSAGE),tooltipPosition:v},void 0),(0,l.jsx)(T.hU,{iconClass:"icon-media-mix",className:d()("billboard-menu-item","media"),buttonStyle:T.Dd.CLEAR,buttonState:p?w.BN.ACTIVE:w.BN.ENABLED,onClick:this.clickMedia,tooltipMsg:p?void 0:e.t(ds.MEDIA_TOOLTIP_MESSAGE),tooltipPosition:v},void 0),!c&&(0,l.jsx)(T.hU,{iconClass:a?"icon-eye-hide":"icon-eye-show",className:"billboard-menu-item",buttonStyle:T.Dd.CLEAR,onClick:this.toggleVisibility,tooltipMsg:e.t(a?ds.HIDE_TOOLTIP_MESSAGE:ds.SHOW_TOOLTIP_MESSAGE),tooltipPosition:v},void 0)]}),void 0)}renderTextContent(){const{popover:e}=this.state,{id:t,label:i,description:n,manager:s}=this.props,r=e===hs.LINK;return(0,l.jsx)(mn,{id:t,ref:this.setBillboardTextRef,label:i,description:n,linkEditorOpen:r,onClickLink:this.onClickLink,onClosePopover:this.closePopover,onDescriptionInput:this.onDescriptionInput,onNavigationKey:this.onNavigationKey,onEdited:this.onEdited,manager:s},void 0)}renderMattertagMedia(){const{id:e,mediaType:t,closing:i,media:{hasMedia:n,mediaPayload:s},mediaAspectRatio:r}=this.props;return n?s?(0,l.jsx)(Qi,{mediaPayload:s,mediaType:t,mediaAspectRatio:r,closing:i},e):(0,l.jsx)("div",Object.assign({className:"loadingSpinner"},{children:(0,l.jsx)("div",{className:"gui-spinner-icon"},void 0)}),void 0):null}};us.contextType=m.I,us=cs([I.Z],us);var ps=i(85861);class MouseThrough extends r.Component{constructor(e){super(e),this.mouseThroughElementRef=(0,r.createRef)(),this.eventsToSend={[MouseThrough.SendEvent.HOVER]:!1,[MouseThrough.SendEvent.CLICK]:!1,[MouseThrough.SendEvent.BUTTON]:!1},this.onHoverEvent=e=>{switch(e.type){case"mousemove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"mouseenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"mouseleave":this.props.onMouseLeave&&this.props.onMouseLeave(e);break;case"pointermove":this.props.onMouseMove&&this.props.onMouseMove(e);break;case"pointerenter":this.props.onMouseEnter&&this.props.onMouseEnter(e);break;case"pointerleave":this.props.onMouseLeave&&this.props.onMouseLeave(e)}this.eventsToSend[MouseThrough.SendEvent.HOVER]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.isValidTarget=e=>{const t=this.mouseThroughElementRef.current;return!!t&&(e===t||this.props.includeChildrenEvents&&e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINS)},this.onClick=e=>{this.props.onClick&&this.props.onClick(e),this.eventsToSend[MouseThrough.SendEvent.CLICK]&&this.isValidTarget(e.target)&&(this.sendEventThrough("mousedown",e),window.setTimeout((()=>this.sendEventThrough("mouseup",e)),0))},this.onButtonEvent=e=>{switch(e.type){case"pointerdown":this.props.onPointerDown&&this.props.onPointerDown(e);break;case"pointerup":this.props.onPointerUp&&this.props.onPointerUp(e)}this.eventsToSend[MouseThrough.SendEvent.BUTTON]&&this.isValidTarget(e.target)&&this.sendEventThrough(e.type,e)},this.onClick=this.onClick.bind(this),this.target=e.clickTarget||document.getElementsByTagName("canvas")[0],this.registerEvents()}UNSAFE_componentWillReceiveProps(e){(0,ps.NK)(this.props.sendEvents,e.sendEvents)&&this.registerEvents()}render(){return(0,l.jsx)("div",Object.assign({id:this.props.id,ref:this.mouseThroughElementRef,className:this.props.className,style:this.props.style||{},onMouseEnter:this.onHoverEvent,onMouseLeave:this.onHoverEvent,onMouseMove:this.onHoverEvent,onPointerEnter:this.onHoverEvent,onPointerLeave:this.onHoverEvent,onPointerMove:this.onHoverEvent,onMouseDown:this.onButtonEvent,onMouseUp:this.onButtonEvent,onPointerDown:this.onButtonEvent,onPointerUp:this.onButtonEvent,onClick:this.onClick},{children:this.props.children}),void 0)}registerEvents(){this.props.sendEvents.length&&(this.eventsToSend[MouseThrough.SendEvent.CLICK]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.CLICK)>-1,this.eventsToSend[MouseThrough.SendEvent.HOVER]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.HOVER)>-1,this.eventsToSend[MouseThrough.SendEvent.BUTTON]=this.props.sendEvents.indexOf(MouseThrough.SendEvent.BUTTON)>-1)}sendEventThrough(e,t){const i=t.nativeEvent;let n;try{n=window.PointerEvent?new PointerEvent(e,i):new MouseEvent(e,i)}catch(t){n=document.createEvent("MouseEvents");const s=i.view;if(!s)return;n.initMouseEvent(e,i.bubbles,i.cancelable,s,i.detail,i.screenX,i.screenY,i.clientX,i.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,i.button,i.relatedTarget)}this.target.dispatchEvent(n)}}!function(e){let t;!function(e){e[e.HOVER=1]="HOVER",e[e.CLICK=2]="CLICK",e[e.BUTTON=3]="BUTTON"}(t=e.SendEvent||(e.SendEvent={}))}(MouseThrough||(MouseThrough={}));var ms=i(90756),fs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let gs=class MattertagDescription extends r.Component{constructor(e){super(e),this.formatLink=(e,t)=>vs(e,t,!1),this.linkClicked=e=>t=>{t.preventDefault(),this.props.onLinkClick(e);const{link:i}=e;if(void 0===i)return;switch(i.type){case ms.U.NAVIGATION:i.navigationData&&this.props.linkHandler.handler.openLink({pose:i.navigationData,fullLink:i.url});break;case ms.U.MODEL:try{const e=new URL(i.url);this.props.linkHandler.handler.openLink({modelId:e.searchParams.get("m")||""})}catch(e){}break;case ms.U.EXT_LINK:this.context.messageBus.broadcast(new ki.Ik(i.url)),this.props.linkHandler.handler.openLink(i.url)}}}render(){const{description:e,parsedDescription:t}=this.props;let i=e;return t&&t.length>0&&(i=ys(t,this.formatLink,this.linkClicked)),i?(0,l.jsx)("div",Object.assign({className:"tag-description"},{children:i}),void 0):null}};gs.contextType=m.I,gs=fs([I.Z],gs);const vs=(e,t,i)=>{if(!e.link)return null;const n=e.link,s=n.type===ms.U.NAVIGATION?"Link to position within this model":"Link to external web site";return(0,l.jsxs)("a",Object.assign({className:"link-url",contentEditable:i,href:n.url,onClick:t(e)},{children:[n.label,(0,l.jsx)("i",{className:"icon-ext-link",title:s},void 0)]}),n.label)},ys=(e,t,i)=>e.map((e=>{switch(e.type){case Ui.z.link:if(e.link)return t(e,i);case Ui.z.text:return(e.text||"").replace("&zwnj;","")}return null}));var bs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ss=class MattertagTextContent extends r.Component{constructor(e){super(e),this.scrollbarsRef=(0,r.createRef)(),this.state={height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:z.None},this.onScrollPositionChange=()=>{const e=this.scrollbarsRef.current;if(!e||this.state.determiningScrollability)return;const t=e.scrollPosition.vertical;this.setState({scrollClass:t})}}UNSAFE_componentWillReceiveProps(e){e.tagWidth!==this.props.tagWidth&&this.setState({height:null,scrollable:!0,determiningScrollability:!0})}componentDidMount(){this.determineScrollability()}componentDidUpdate(){this.state.determiningScrollability&&this.determineScrollability()}determineScrollability(){const e=this.textContainer&&this.textContainer.querySelector(".tag-description");let t={determiningScrollability:!1};if(this.props.description&&e){const i=this.props.mediaTag?65:159;if(e.scrollHeight>i+12){const e=this.textContainer&&this.textContainer.querySelector(".tag-label"),n=this.props.label?i+e.scrollHeight-5:i;t=Object.assign(Object.assign({},t),{height:n,scrollable:!0,scrollClass:z.Beginning})}else t=Object.assign(Object.assign({},t),{height:null,scrollable:!1,scrollClass:z.None})}this.setState(t)}render(){const{label:e,description:t,parsedDescription:i,onLinkClick:n}=this.props;if(e||t||i){const s=d()({"tag-text-content":!0,noScroll:!this.state.height||!this.state.scrollable,[this.state.scrollClass]:!0});return(0,l.jsx)("div",Object.assign({className:s,style:{height:this.state.scrollable&&this.state.height||"auto"},ref:e=>{this.textContainer=e}},{children:(0,l.jsxs)(Scrollbars,Object.assign({name:"mattertag-text-content",forceHidden:!1,waitToUpdate:this.state.determiningScrollability,singleScrollDirection:F.vertical,ref:this.scrollbarsRef,onScrollPositionChange:this.onScrollPositionChange},{children:[e&&(0,l.jsx)("div",Object.assign({className:"tag-label",onClick:this.onBoundClick},{children:(0,l.jsx)("span",{children:e},void 0)}),void 0),(0,l.jsx)(gs,{description:t,parsedDescription:i,onLinkClick:n,linkHandler:this.props.linkHandler},void 0)]}),void 0)}),void 0)}return null}};Ss=bs([I.Z],Ss);const Es=Ss;class CustomWidgetFrame extends r.Component{constructor(){super(...arguments),this.elementRef=(0,r.createRef)()}shouldComponentUpdate(){return!1}componentDidMount(){const e=this.elementRef.current;e&&this.props.widget.frame.mount(e)}componentWillUnmount(){this.elementRef.current&&this.props.widget.frame.unmount()}render(){const{width:e,height:t}=this.props.widget.size,i={};return e&&t&&(i.width=e+"px",i.height=t+"px"),(0,l.jsx)("div",{className:"custom-widget-container",style:i,ref:this.elementRef},void 0)}}var Ts=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ws=class ReadonlyBillboardContent extends r.Component{constructor(e){super(e),this.clickBillboard=()=>{this.props.onClickBillboard()},this.onClickImage=()=>{this.props.allowTagOverlay?this.props.onOpenOverlay():this.props.onClickBillboard()}}render(){const{media:e,style:t,selected:i,allowTagOverlay:n,label:s,description:r,parsedDescription:o}=this.props;return(0,l.jsxs)("div",Object.assign({className:d()("billboard-body",{expandable:n}),onClick:this.clickBillboard},{children:[(0,l.jsxs)("div",Object.assign({className:"billboard-content",style:t.bodyStyle},{children:[(0,l.jsx)(Es,{label:s,description:r,parsedDescription:o,tagWidth:t.width,imgHeight:t.height,mediaTag:e.hasMedia,onLinkClick:this.props.onLinkClick,linkHandler:this.props.linkHandler},void 0),this.renderMattertagMedia(),this.renderCustomWidget()]}),void 0),!i&&(0,l.jsx)(MouseThrough,{sendEvents:[MouseThrough.SendEvent.BUTTON],className:"hover-arrow"},void 0)]}),void 0)}renderMattertagMedia(){const{id:e,allowTagOverlay:t,mediaType:i,style:{width:n,height:s,closing:r},media:{hasMedia:o,mediaPayload:a}}=this.props;return o?a?(0,l.jsx)(Qi,{mediaPayload:a,mediaType:i,width:n,height:s,onClickImage:t?this.onClickImage:void 0,closing:r},e):(0,l.jsx)("div",Object.assign({className:"loadingSpinner"},{children:(0,l.jsx)("div",{className:"gui-spinner-icon"},void 0)}),void 0):null}renderCustomWidget(){if(this.props.customWidget)return(0,l.jsx)(CustomWidgetFrame,{widget:this.props.customWidget},void 0)}};ws=Ts([I.A],ws);var xs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let _s=class MattertagOverlay extends r.Component{constructor(e){super(e),this.scrollbarsRef=(0,r.createRef)(),this.toggleCollapseText=()=>{this.setState((e=>({collapsed:!e.collapsed})))},this.onScrollPositionChange=()=>{const e=this.scrollbarsRef.current;if(!e||this.state.determiningScrollability)return;const t=e.scrollPosition.vertical;this.setState({scrollClass:t})},this.updateScrollAndCollapse=()=>{const e=this.textContainer?this.textContainer.scrollHeight:0,t=this.textContainer&&this.textContainer.querySelector(".tag-description");let i={determiningScrollability:!1};if(e){const n=Math.max(e-41-this.state.overlayHeight,0),s=n>0,r=e-n,o=t&&t.scrollHeight-n,a=s?z.Beginning:z.None,l=t&&e>41;i=Object.assign(Object.assign({},i),{height:r,scrollable:s,descriptionHeight:o,scrollClass:a,collapsible:l})}this.setState(i)},this.updateOverlayDimensions=()=>{const{label:e,description:t,maxWidth:i,maxHeight:n,mediaAspectRatio:s}=this.props,r=i-24,o=n-24-(e||t?41:0),a=s<r/o;this.setState({overlayWidth:a?o*s:r,overlayHeight:a?o:r/s})},this.stopPropagation=e=>{e.stopPropagation()},this.state={overlayWidth:0,overlayHeight:0,collapsible:!!(e.description&&e.description.length>0),collapsed:!1,height:null,descriptionHeight:0,scrollable:!1,determiningScrollability:!1,scrollClass:z.None}}componentDidMount(){this.updateOverlayDimensions(),this.updateScrollAndCollapse()}componentDidUpdate(e,t){const i=e.mediaAspectRatio!==this.props.mediaAspectRatio,n=e.maxWidth!==this.props.maxWidth,s=e.maxHeight!==this.props.maxHeight;(i||n||s)&&(this.setState({determiningScrollability:!0,scrollable:!1,scrollClass:z.None,height:0}),window.requestAnimationFrame((()=>{this.updateOverlayDimensions(),this.updateScrollAndCollapse()})))}render(){const{mediaPayload:e,mediaType:t,closing:i}=this.props,{overlayWidth:n,overlayHeight:s,collapsible:r}=this.state;return(0,l.jsx)("div",Object.assign({className:"billboard-body",onClick:this.stopPropagation},{children:(0,l.jsxs)("div",Object.assign({className:d()("billboard-content",{collapsible:r})},{children:[this.renderOverlayText(),(0,l.jsx)(Qi,{mediaPayload:e,mediaType:t,width:n,height:s,closing:i},void 0)]}),void 0)}),void 0)}renderOverlayText(){const{label:e,description:t,parsedDescription:i,onLinkClick:n,closeImageOverlay:s}=this.props,{collapsible:r,collapsed:o,descriptionHeight:a,scrollable:c,height:h,determiningScrollability:u,scrollClass:p}=this.state,m=u||o?void 0:{maxHeight:h+"px"},f={};return t&&h&&c&&(f.height=a+"px",f.overflow="hidden"),(0,l.jsxs)("div",Object.assign({className:d()("tag-text-content",{collapsed:o,noScroll:!h||!c}),style:m,ref:e=>{this.textContainer=e}},{children:[e&&(0,l.jsx)("div",Object.assign({className:"tag-label",onClick:this.toggleCollapseText},{children:(0,l.jsx)("div",Object.assign({className:"labelText"},{children:e}),void 0)}),void 0),t&&(0,l.jsx)("div",Object.assign({style:f,className:d()(p,"wrappedDesc")},{children:(0,l.jsx)(Scrollbars,Object.assign({name:"mattertag-overlay-text",forceHidden:!1,waitToUpdate:u,singleScrollDirection:F.vertical,ref:this.scrollbarsRef,onScrollPositionChange:this.onScrollPositionChange},{children:(0,l.jsx)("div",{children:(0,l.jsx)(gs,{description:t,parsedDescription:i,onLinkClick:n,linkHandler:this.props.linkHandler},void 0)},void 0)}),void 0)}),void 0),(0,l.jsxs)("div",Object.assign({className:"buttons"},{children:[r&&(0,l.jsx)(T.hU,{className:d()("tag-button","tag-collapse-button"),iconClass:"icon-dpad-down",onClick:this.toggleCollapseText},void 0),(0,l.jsx)(T.hU,{className:"tag-button",iconClass:"icon-close",onClick:s},void 0)]}),void 0)]}),void 0)}};_s.contextType=m.I,_s=xs([I.Z],_s);const Ms=_s;class FullSizeOnSmallScreens extends r.Component{constructor(e){super(e),this.onResize=()=>{this.adjustSizing(this.props)},this.adjustSizing=(e=this.props,t=!0)=>{const i=FullSizeOnSmallScreens.isFullSized(e.editing);i!==this.state.fullSized&&(this.context.messageBus.broadcast(new Oe.Zi(i)),t&&this.setState({fullSized:i}))},this.state={fullSized:!1}}static isFullSized(e){return e&&(window.innerWidth<=700||window.innerHeight<=600)}componentDidMount(){window.addEventListener("resize",this.onResize),this.adjustSizing(this.props)}componentDidUpdate(){this.adjustSizing(this.props)}render(){const e=d()({"full-size-on-small-screens":this.state.fullSized,"floating-on-normal-screens":!this.state.fullSized});return(0,l.jsx)("div",Object.assign({className:e},{children:this.props.children}),void 0)}componentWillUnmount(){this.adjustSizing({editing:!1},!1),window.removeEventListener("resize",this.onResize)}}FullSizeOnSmallScreens.contextType=m.I;var Os,As=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Cs=new S.Z("billboard");var Ps;!function(e){e[e.NOT_LOADED=0]="NOT_LOADED",e[e.LOADING=1]="LOADING",e[e.LOADED=2]="LOADED",e[e.FAILED=3]="FAILED",e[e.ENABLED=4]="ENABLED"}(Ps||(Ps={}));let Ds=Os=class Billboard extends r.Component{constructor(e,t){super(e,t),this.linkCount=0,this.linksClicked=[],this.linkEditorOpened=()=>this.setState({expanded:!0}),this.linkEditorClosed=()=>this.setState({expanded:!1}),this.getSavedData=()=>{const{label:e,description:t,mediaSrc:i,mediaType:n,stemVisible:s,enabled:r}=this.props.tag,{stemHeight:o,color:a}=this.props.view;return{visible:r,color:a,label:e,description:t,stemHeight:o,mediaSrc:i,mediaType:n,stemVisible:s}},this.updateBillboardSize=()=>{const{mediaWidth:e,mediaHeight:t}=this.state,{tag:i}=this.props;if(i.mediaType===Ui.z.photo||i.mediaType===Ui.z.rich||i.mediaType===Ui.z.video){const n=this.getDimensionsForMedia(i.mediaType,e,t);this.setState(Object.assign({},n))}},this.closeImageOverlay=()=>{const{overlay:e,toggleImageOverlay:t,tag:i}=this.props;e&&t(i.sid,!1)},this.onOpenOverlay=()=>{const{toggleImageOverlay:e,allowTagOverlay:t,tag:i}=this.props;t&&e(i.sid,!0)},this.onBillboardClicked=()=>{const{manager:e,toolOpen:t,tag:i,selected:n}=this.props;t&&e&&!n&&e.selectMattertag(i.sid)},this.setBillboardRef=e=>{this.billboardRef=e},this.updateTagDirection=()=>{const{direction:e}=this.state,{getTagContainer:t,tag:i}=this.props,{navigating:n,navigatingPosition:s,position:r,onTagDirectionChanged:o}=this.props.view,a=t();if(!a)return;const[l,c]=[a.offsetWidth,a.offsetHeight];let d;d=n&&s?Os.getTagDirection(s.x,s.y,l,c):r?Os.getTagDirection(r.x,r.y,l,c):Os.getTagDirection(0,0,l,c),d!==e&&(o(i.sid,d),this.setState({direction:d}))},this.onLinkClick=e=>{if(void 0===e.link)return;-1===this.linksClicked.indexOf(e.link)&&this.linksClicked.push(e.link);const t=e.link.type;this.linkCount++,this.context.analytics.track("click_mattertag_link",{link_type:t,link_count:this.linkCount,links_clicked:this.linksClicked.length})};const i=this.getDimensionsForMedia(e.tag.mediaType,1024,1024),n=t.settings.getProperty(Di.lc);this.embedly=new Embedly(n,t.queue),this.state={width:i.width,height:190,expanded:!1,mediaWidth:0,mediaHeight:0,mediaPayload:null,landscape:!1,active:!1,mediaLoadingState:e.mediaEnabled?Ps.NOT_LOADED:Ps.ENABLED,savedData:this.getSavedData(),direction:void 0};const s=e.tag,r=new tn.gm((()=>({})),(e=>{s.onPropertyChanged("mediaSrc",e),s.onPropertyChanged("mediaType",e)}),(e=>{s.removeOnPropertyChanged("mediaSrc",e),s.removeOnPropertyChanged("mediaType",e)}));this.tagOnChangedSub=r.createSubscription((()=>{this.loadMedia(!0)}),!1)}componentDidMount(){const{view:e,manager:t}=this.props;this.updateTagDirection(),this.loadMedia(),!e.located||e.navigating&&!e.navigatingPosition||this.setState({active:!0}),window.addEventListener("resize",this.updateBillboardSize),t&&(this.context.messageBus.subscribe(OpenLinkEditorMessage,this.linkEditorOpened),this.context.messageBus.subscribe(CloseLinkEditorMessage,this.linkEditorClosed)),this.tagOnChangedSub.renew()}componentWillUnmount(){this.tagOnChangedSub.cancel(),window.removeEventListener("resize",this.updateBillboardSize),this.props.manager&&(this.context.messageBus.unsubscribe(OpenLinkEditorMessage,this.linkEditorOpened),this.context.messageBus.unsubscribe(CloseLinkEditorMessage,this.linkEditorClosed))}componentDidUpdate(e,t){const{manager:i,editing:n,tag:s,view:r,overlay:o}=this.props,{active:a}=this.state;if(i===e.manager||e.manager||(this.context.messageBus.subscribe(OpenLinkEditorMessage,this.linkEditorOpened),this.context.messageBus.subscribe(CloseLinkEditorMessage,this.linkEditorClosed)),n===e.editing&&o===e.overlay||this.updateBillboardSize(),r.closeTheTag||s&&s.mediaSrc!==e.tag.mediaSrc&&this.loadMedia(!0),a||e.view.navigatingPosition===r.navigatingPosition||this.updateTagDirection(),r.closeTheTag)a&&this.setState({active:!1});else if(a||!r.located||r.navigating&&!r.navigatingPosition||this.setState({active:!0}),n&&(!e.editing||null===this.state.savedData)){const e=this.getSavedData();e&&this.setState({savedData:e})}}loadMedia(e=!1){const{mediaType:t,mediaSrc:i}=this.props.tag,{mediaLoadingState:n}=this.state;if(Os.isMediaTag(t)&&(e||![Ps.LOADING,Ps.FAILED,Ps.ENABLED].includes(n)))return this.setState({mediaLoadingState:Ps.LOADING}),this.embedly.getMediaDetails(t,i).then((e=>{if(e&&this.billboardRef){const i=this.getDimensionsForMedia(t,e.width,e.height);this.setState(Object.assign(Object.assign({},i),{mediaWidth:e.width,mediaHeight:e.height,mediaPayload:e.embedlyResponse,mediaLoadingState:Ps.LOADED}))}})).catch((e=>{if(Cs.debug(e),this.billboardRef){const e=this.getDimensionsForMedia(Ui.z.text,1024,1024);this.setState(Object.assign(Object.assign({},e),{mediaLoadingState:Ps.FAILED}))}}))}getDimensionsForMedia(e,t,i){if(e===Ui.z.text||e===Ui.z.none||e===Ui.z.error)return{width:298,height:0,landscape:!1};const{getTagContainer:n,editing:s,overlay:r}=this.props;let o=t,a=i;const l=Math.max(t,1)/Math.max(i,1),c=n();if(c)if(r)o=c.offsetWidth,a=c.offsetHeight;else{const i=e===Ui.z.photo;let n;n=s?i?150:340:80;const r=c.offsetWidth-100,d=c.offsetHeight-n;o=i?l>1?Math.max(Math.min(t,400,r),Hi):Math.max(Math.min(t,300),200):Math.max(Math.min(t,350,r),Hi),a=o/l,a>d&&(a=d,o=a*l)}return{width:o,height:a,landscape:l>1}}render(){const{overlay:e,editing:t,view:i,tag:n}=this.props,{closeTheTag:s}=i,{sid:r,mediaType:o,label:a,description:c}=n,{landscape:h,mediaLoadingState:u,active:p,direction:m,expanded:f}=this.state,g=Os.isMediaTag(o)&&u!==Ps.FAILED&&u!==Ps.ENABLED,v=u===Ps.LOADING&&o===Ui.z.photo,y=t||e?void 0:this.getTagPositionStyle(),b=t||e||!m?void 0:"tag"+m.trim().replace(/([A-Z])/g,"-$1").replace(/[-_\s]+/g,"-").toLowerCase();const S=this.isImageTag(),E=g&&o===Ui.z.video,T=g&&(o===Ui.z.rich||v),w=E||T||S,x=a.length>0||c.length>0;return(0,l.jsx)(FullSizeOnSmallScreens,Object.assign({editing:t},{children:(0,l.jsx)("div",Object.assign({className:d()("tag-position",{"billboard-standard-view":!t&&!e,"billboard-overlay":e,"billboard-editing":t,"media-only-mattertag":!x&&w,"media-mattertag":w,"video-mattertag":E,"embed-mattertag":T,"image-mattertag":S,"link-popover-expanded":f}),style:y},{children:(0,l.jsx)("div",Object.assign({className:d()("tag-wrapper",{active:!s&&p})},{children:(0,l.jsx)("div",Object.assign({ref:this.setBillboardRef,className:d()("tag-container",[b],{"media-landscape":w&&h,"media-portrait":w&&!h}),onClick:this.closeImageOverlay},{children:this.renderBillboard(g)}),void 0)}),void 0)}),r)}),void 0)}renderBillboard(e){const{mediaPayload:t,width:i,height:n,savedData:s,mediaWidth:r,mediaHeight:o}=this.state,{overlay:a,selected:c,view:d,tag:h,allowTagOverlay:u}=this.props,p=o>0?r/o:void 0;if(a&&p){const{label:e,description:s,parsedDescription:r,mediaType:o}=h;return(0,l.jsx)(Ms,{label:e,description:s,parsedDescription:r,mediaPayload:t,mediaType:o,maxWidth:i,maxHeight:n,mediaAspectRatio:p,closing:d.closeTheTag,closeImageOverlay:this.closeImageOverlay,onLinkClick:this.onLinkClick,linkHandler:this.props.linkHandler},void 0)}{const{sid:r}=h,o={mediaPayload:t,hasMedia:e},a=e&&!t?{width:i+"px"}:{},{editing:m,manager:f}=this.props;if(m&&f){const e=FullSizeOnSmallScreens.isFullSized(m);return(0,l.jsx)(us,{id:r,getSavedData:this.getSavedData,manager:f,fullSized:e,mediaAspectRatio:p,media:o,mediaType:h.mediaType,closing:d.closeTheTag,label:h.label,description:h.description,originalValues:s,embedlyValidator:this.embedly},void 0)}{const e={width:i,height:n,bodyStyle:a,closing:d.closeTheTag};return(0,l.jsx)(ws,{id:r,allowTagOverlay:u,selected:c,style:e,onClickBillboard:this.onBillboardClicked,onOpenOverlay:this.onOpenOverlay,onLinkClick:this.onLinkClick,linkHandler:this.props.linkHandler,media:o,mediaType:h.mediaType,mediaSrc:h.mediaSrc,label:h.label,parsedDescription:h.parsedDescription,description:h.description,customWidget:h.widgetFrame},void 0)}}}isImageTag(){const{tag:e}=this.props;return this.state.mediaLoadingState!==Ps.FAILED&&this.state.mediaLoadingState!==Ps.ENABLED&&e.mediaType===Ui.z.photo}getTagPositionStyle(){const{view:e}=this.props;if(e.located){const{position:t}=e;return{transform:`translate(${t?t.x:0}px, ${t?t.y:0}px)`}}return{pointerEvents:"none",visibility:"hidden"}}static isMediaTag(e){return e===Ui.z.photo||e===Ui.z.video||e===Ui.z.rich}};Ds.contextType=m.I,Ds.getTagDirection=(e,t,i,n)=>{const s=.2,r=1-(e+1)/(i=i||window.innerWidth)*2,o=1-(t+1)/(n=n||window.innerHeight)*2,a=o<-.2?0:o<s?1:2,l=r<-.2?2:r<s?1:0,c=Math.max(e,i-e);let d;return d=0===l?1===a?Ii.Pg.RIGHT:0===a?Ii.Pg.RIGHT_UP:Ii.Pg.RIGHT_DOWN:2===l?1===a?Ii.Pg.LEFT:0===a?Ii.Pg.LEFT_UP:Ii.Pg.LEFT_DOWN:1===a&&c>Hi?r<0?Ii.Pg.RIGHT:Ii.Pg.LEFT:2===a?Ii.Pg.DOWN:Ii.Pg.UP,Cs.debug(`Selected ${d} for [${e}, ${t}] in ${i}x${n} (${l}, ${a})`),d},Ds=Os=As([I.Z],Ds);Ds.getTagDirection;var Ns,Is=i(60225),Ls=i(40698),Rs=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ks=Ns=class CircularProgressBar extends r.Component{constructor(e){super(e),this.strokePattern=[0,100],this.strokeOffset=0,this.innerRadius=15.92,this.strokeWidth=1,this.drawRadius=this.innerRadius+this.strokeWidth/2,this.updateSvgAttributes(e),this.elementId=this.props.id||"circle-progress-"+Ns.id++}UNSAFE_componentWillReceiveProps(e){this.updateSvgAttributes(e)}updateSvgAttributes(e){this.strokeWidth=e.barWidth||this.strokeWidth,this.innerRadius=e.innerRadius||this.innerRadius,this.drawRadius=this.innerRadius+this.strokeWidth/2;const t=2*this.drawRadius*Math.PI;this.strokeOffset=t*(e.startPosition||this.strokeOffset),this.strokePattern[0]=t*(0,Ne.uZ)(e.progress,0,100)/100,this.strokePattern[1]=t-this.strokePattern[0]}render(){const{progressColor:e}=this.props,t=2*(this.innerRadius+this.strokeWidth),i=t/2;return(0,l.jsxs)("svg",Object.assign({id:this.elementId,className:d()("circular-progress",this.props.className),viewBox:`${-i} ${-i} ${t} ${t}`},{children:[(0,l.jsx)("circle",{className:"bar-bg",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),strokeDasharray:`${this.strokePattern[1]} ${this.strokePattern[0]}`,strokeDashoffset:this.strokeOffset-this.strokePattern[0],strokeWidth:this.strokeWidth,fill:"none"},void 0),(0,l.jsx)("circle",{className:e?void 0:"progress",cx:"0",cy:"0",r:this.drawRadius,transform:"rotate(-90) "+(this.props.ccw?"scale(-1 1)":""),strokeDasharray:`${this.strokePattern[0]} ${this.strokePattern[1]}`,strokeWidth:this.strokeWidth,stroke:e,fill:"none"},void 0),this.props.children]}),void 0)}};ks.id=0,ks=Ns=Rs([I.Z],ks);class Tags extends r.Component{constructor(e){super(e),this.tagsRootRef=(0,r.createRef)(),this.bindings=[],this.isUnmounting=!1,this.onUpdateSelectedTag=()=>{this.isUnmounting||this.setState({selectedTag:this.mattertagsViewData.selectedTag,overlay:!1})},this.onUpdateToolState=()=>!this.isUnmounting&&this.setState({toolState:this.mattertagsViewData.toolState}),this.onUpdateScreenPosition=()=>!this.isUnmounting&&this.setState({screenPosition:this.mattertagsViewData.screenPosition}),this.onUpdateProgress=()=>!this.isUnmounting&&this.setState({creationProgress:this.mattertagsViewData.progress}),this.onUpdateBillboards=()=>!this.isUnmounting&&this.setState({billboards:this.mattertagsViewData.activeBillboards.keys}),this.toggleImageOverlay=async(e,t)=>{if(!this.isUnmounting&&(this.props.allowTagOverlay||!t))if(this.setState({overlay:t}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.MATTERTAG_PHOTO,t)),t){this.context.messageBus.broadcast(new ki.dJ(e,Ri.V.OVERLAY));const t=e!==this.state.selectedTag?Be.n.Interpolate:Be.n.Instant,i=this.mattertagsData.getTag(e);this.context.commandBinder.issueCommand(new Is.Y(i.sid,t))}else this.closeBillboard(e)},this.getTagContainer=()=>this.tagsRootRef.current,this.state={billboards:[],selectedTag:null,overlay:!1,toolState:Ii.rI.CLOSED,creationProgress:0,screenPosition:null}}componentDidMount(){const e=this.context.market;Promise.all([e.waitForData(Ls.n),e.waitForData(Ii.P5),this.context.engine.getModuleBySymbol(Li.y.DEEP_LINKS)]).then((([e,t,i])=>{this.init(e,t,i)}))}init(e,t,i){this.isUnmounting||(this.mattertagsData=e,this.mattertagsViewData=t,this.linkHandler=i,this.bindings.push(this.mattertagsViewData.onSelectedTagChanged(this.onUpdateSelectedTag),this.mattertagsViewData.onChanged(this.onUpdateBillboards),this.mattertagsViewData.onToolStateChanged(this.onUpdateToolState)),this.context.editMode&&this.bindings.push(this.mattertagsViewData.onScreenPositionChanged(this.onUpdateScreenPosition),this.mattertagsViewData.onProgressChanged(this.onUpdateProgress)),this.setState({selectedTag:this.mattertagsViewData.selectedTag,toolState:this.mattertagsViewData.toolState,screenPosition:this.mattertagsViewData.screenPosition,creationProgress:this.mattertagsViewData.progress,billboards:this.mattertagsViewData.activeBillboards.keys}))}componentWillUnmount(){this.isUnmounting=!0,this.bindings.forEach((e=>{e.cancel()})),this.bindings.length=0}componentDidUpdate(e){const{allowTagOverlay:t,toolOpen:i}=this.props;if(this.context.editMode&&(t!==e.allowTagOverlay||i!==e.toolOpen)){const e=this.mattertagsViewData&&this.mattertagsViewData.openTag;e&&(this.state.overlay?t||this.toggleImageOverlay(e,!1):this.closeBillboard(e))}}closeBillboard(e){this.mattertagsViewData.closeBillboard(e)}renderBillboards(){const{settings:e}=this.context,{overlay:t,selectedTag:i,toolState:n,billboards:s}=this.state,{toolOpen:r,manager:o,allowTagOverlay:a}=this.props,c=[],d=n===Ii.rI.CREATING||n===Ii.rI.PRESSING||n===Ii.rI.PLACING,h=!(!r||n!==Ii.rI.EDITING&&n!==Ii.rI.PLACED);return d||s.forEach((n=>{const s=i===n,d=h&&s,u=this.mattertagsViewData.getViewData(n),p=this.mattertagsData.getTag(n),m=e.tryGetProperty(zt.sX,!1),f=d||!m;!p||u.closeTheTag&&d||c.push((0,l.jsx)(Ds,{editing:d,selected:s,overlay:t,allowTagOverlay:a,toolOpen:r,view:u,tag:p,manager:o,mediaEnabled:f,toggleImageOverlay:this.toggleImageOverlay,getTagContainer:this.getTagContainer,linkHandler:this.linkHandler},`billboard-${n}`))})),c}renderProgressCircle(){const{mobile:e}=this.props,{creationProgress:t,screenPosition:i,toolState:n}=this.state;if(!(n===Ii.rI.PRESSING&&t>0&&e)||!i)return null;const s={left:i.x-Tags.creationButtonRadius/2+"px",top:i.y-Tags.creationButtonRadius/2+"px"};return(0,l.jsx)("div",Object.assign({className:"point-button-wrapper",style:s},{children:(0,l.jsx)(ks,Object.assign({className:d()({complete:1===t,reset:0===t}),progress:100*t,innerRadius:Tags.creationButtonRadius,barWidth:Tags.progressBarThickness},{children:(0,l.jsx)("circle",{className:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"},void 0)}),void 0)}),void 0)}render(){if(!this.mattertagsData||!this.mattertagsViewData)return null;const{toolOpen:e}=this.props,{toolState:t}=this.state,i=!(!e||t!==Ii.rI.EDITING&&t!==Ii.rI.PLACED);return(0,l.jsxs)("div",Object.assign({className:d()("overlay-layer","tags-layer",{"tag-editable":e,"tags-layer-editing":i,"tags-layer-displaying":!i}),ref:this.tagsRootRef},{children:[this.renderProgressCircle(),this.renderBillboards()]}),void 0)}}Tags.contextType=m.I,Tags.creationButtonRadius=132,Tags.progressBarThickness=8;var Us=i(74371),Bs=i(59088),Fs=i(15982),Vs=i(2212),Hs=i(88814),js=i(68576),Gs=i(90454),zs=i(76896);class RoomLabel extends r.Component{constructor(e){super(e)}render(){const{sid:e,position:t,text:i,readOnlyText:n,rotation:s,visible:r}=this.props,o={left:t.x+"px",top:t.y+"px",transform:s?`translate(-50%, -50%) rotate(${s}deg) `:"translate(-50%, -50%)"},a=n?`${i} ${n}`:i;return r?(0,l.jsx)("div",Object.assign({id:e,className:"label",style:o},{children:(0,l.jsx)("span",{children:a},void 0)}),void 0):null}}const Ws=new S.Z("label-ui");class LabelLayerComponent extends r.Component{constructor(e){super(e),this.subscriptions=[],this.reusableVector=new Vs.Vector3,this.isUnmounting=!1,this.inFloorPlan=e=>e===y.BD.FLOORPLAN,this.onCameraUpdate=()=>{this.inFloorPlan(this.props.viewmode)&&this.updateLabelPositions()},this.onViewTransitionStart=()=>{this.setState({inModeTransition:!0})},this.onViewTransitionEnd=async e=>{this.inFloorPlan((0,y.ty)(e.toMode))&&(this.setState({inModeTransition:!1}),this.updateLabelPositions())},this.updateFloorState=()=>{this.isUnmounting||this.setState({topMostFloorId:this.floorsViewData.topFloorId})},this.updateLabelPositions=async()=>{const e={};for(const t of this.labelData.getCollection()){this.reusableVector.set(t.position.x,t.position.y,t.position.z);const i=await this.context.commandBinder.issueCommand(new Fs.b({worldPosition:this.reusableVector}));e[t.sid]=Object.assign({screenPosition:i},t)}this.isUnmounting||this.setState({labelPositions:e})},this.startMoveToFloor=()=>{this.setState({movingToFloor:!0})},this.endMoveToFloor=e=>{this.setState({movingToFloor:!1})},this.state={labelPositions:{},topMostFloorId:null,inModeTransition:!1,movingToFloor:!1}}async componentDidMount(){const e=this.context.messageBus;try{if(this.floorsViewData=await this.context.market.waitForData(v.c),this.isUnmounting)return;const e=this.floorsViewData.onChanged(this.updateFloorState);if(this.subscriptions.push(e),this.updateFloorState(),this.labelData=await this.context.market.waitForData(Us.D),this.isUnmounting)return}catch(e){Ws.debug(e)}this.updateLabelPositions();const t=await this.context.market.waitForData(Bs.M_);this.isUnmounting||(this.subscriptions.push(t.onChanged(this.onCameraUpdate),e.subscribe(Gs.S,this.startMoveToFloor),e.subscribe(zs.P,this.endMoveToFloor),e.subscribe(js.Z,this.onViewTransitionStart),e.subscribe(Hs.Z,this.onViewTransitionEnd)),this.subscriptions.forEach((e=>e.renew())))}componentWillUnmount(){this.isUnmounting=!0,this.subscriptions.forEach((e=>e.cancel()))}renderLabel(e){const{currentFloorId:t}=this.props,{topMostFloorId:i,labelPositions:n,movingToFloor:s}=this.state,{floorId:r,screenPosition:o,text:a,visible:c,sid:d,rotation:h}=n[e],u=s?null:t;return(0,l.jsx)(RoomLabel,{position:o,rotation:h,text:a,visible:(!u&&i===r||u===r)&&c,sid:d},d)}render(){const{inModeTransition:e,labelPositions:t}=this.state,{viewmode:i}=this.props;if(!this.inFloorPlan(i)||e)return null;const n=[];return Object.keys(t).forEach((e=>{n.push(this.renderLabel(e))})),(0,l.jsx)("div",Object.assign({className:"overlay-layer labels-layer"},{children:n}),void 0)}}LabelLayerComponent.contextType=m.I;const Ks=ue(LabelLayerComponent);var Ys=i(42835),qs=i(32025),Zs=i(6460),$s=i(19980),Qs=i(91028),Xs=i(90662),Js=i(92824);const er=oe(Js.X);function tr(e,t){return t?t.getNoteView(e):null}var ir=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let nr=class Badge extends r.Component{constructor(e){super(e)}render(){const{iconClass:e,label:t,badgeStyle:i,onClick:n}=this.props;return(0,l.jsxs)("span",Object.assign({className:d()("badge",{clickable:!!n}),style:i,onClick:n},{children:[e&&(0,l.jsx)("span",{className:`icon badge-icon ${e}`},void 0),t&&(0,l.jsx)("span",Object.assign({className:"badge-label"},{children:t}),void 0)]}),void 0)}};function sr({comment:e,noteView:t}){const i=t?t.created:e.created,{userData:n}=(0,r.useContext)(m.I),s=t?t.user.email:e.user.email,o=n.getUserDisplay(s),a=o.color,c=t?t.comments.length-1:0,d=1===c?`${c} reply`:`${c} replies`,h=""===e.text&&!(e.attachments.length>0)?"Original content was deleted":i.toLocaleString();return(0,l.jsxs)("header",Object.assign({className:"note-header"},{children:[(0,l.jsx)(nr,{label:o.initials,badgeStyle:{color:a,borderColor:a}},void 0),(0,l.jsxs)("div",Object.assign({className:"note-details"},{children:[(0,l.jsx)("span",Object.assign({className:"note-user"},{children:o.name}),void 0),c>0&&(0,l.jsx)("span",Object.assign({className:"note-summary-info note-replies"},{children:d}),void 0),(0,l.jsx)("div",Object.assign({className:"note-subheader"},{children:h}),void 0)]}),void 0)]}),void 0)}nr=ir([I.Z],nr);var rr=i(95836),or=i(96168),ar=i(85004),lr=i(97807);function cr(e,t,i,n){let s=e,r=t;if(i&&s>i){const e=i/s;s*=e,r&&(r*=e)}if(r&&n&&r>n){const e=n/r;s*=e,r*=e}return{width:s,height:r}}class OEmbedTextComponent extends r.Component{constructor(e){super(e)}render(){const{cover:e,data:t,onClick:i,style:n}=this.props,s=d()("oembed","oembed-text",{"oembed-text--cover":e}),r=t.provider_name?`${t.provider_name} content`:"Embedded content",o=t.author_name?`from ${t.author_name}`:"";return(0,l.jsxs)("div",Object.assign({className:s,style:n,onClick:i},{children:[t.title&&(0,l.jsx)("h3",{children:t.title},void 0),(0,l.jsx)("p",{children:`${r} ${o}`},void 0)]}),void 0)}}const dr=["soundcloud","spotify"];class OEmbedThumbnailComponent extends r.Component{constructor(e){super(e)}getAttributes(){const{data:e}=this.props;let t=e.thumbnail_url,i=e.thumbnail_width,n=e.thumbnail_height;return(!t||!i||!n)&&e.type===lr.ht.PHOTO&&(t=e.url,i=e.width,n=e.height),{url:t,width:i,height:n}}render(){const{cover:e,maxHeight:t,maxWidth:i,data:n,disabled:s,onClick:r,style:o}=this.props,{url:a,width:c,height:h}=this.getAttributes();if(!a||!c||!h)return(0,l.jsx)(OEmbedTextComponent,Object.assign({},this.props),void 0);const u=function(e,t){return e<128||t<128}(c,h),p=!s&&function(e){const t=(e.provider_name||"").toLowerCase();return e.type===lr.ht.VIDEO?"giphy"!==t:!(e.type!==lr.ht.RICH||!dr.includes(t))}(n),m=d()("oembed","oembed-thumbnail",{"oembed-thumbnail--cover":e,"oembed-thumbnail--cover--icon":e&&u}),f=Object.assign(Object.assign({},o),{backgroundImage:`url('${a}')`});if(!e){const{width:e,height:n}=cr(c,h,i,t);f.width=`${e}px`,f.height=`${n}px`}return e&&u&&(f.maxWidth=1.5*c+"px"),(0,l.jsx)("div",Object.assign({className:m,style:f,onClick:s?void 0:r},{children:p&&(0,l.jsx)(T.hU,{className:"oembed-thumbnail__cta",iconClass:"icon-play-unicode",buttonStyle:T.Dd.OVERLAY,buttonSize:w.qE.LARGE},void 0)}),void 0)}}class OEmbedPhotoComponent extends r.Component{constructor(e){super(e)}render(){const{data:e,cover:t,maxWidth:i,maxHeight:n,onClick:s,style:r}=this.props,o=d()("oembed","oembed-photo",{"oembed-photo--cover":t});if(t){const t=Object.assign(Object.assign({},r),{backgroundImage:`url('${e.url}')`});return(0,l.jsx)("div",{className:o,style:t,onClick:s},void 0)}if(!i&&!n)return(0,l.jsx)("img",{className:o,src:e.url,style:r,onClick:s},void 0);const{width:a,height:c}=cr(e.width,e.height,i,n);return(0,l.jsx)("img",{className:o,src:e.url,style:r,onClick:s,width:a,height:c},void 0)}}const hr={flickr:!0,instagram:!0},ur="oembed-iframe--loading",pr=/^<iframe.*>.*<\/iframe>$/;function mr(e,t,i,n){const{html:s}=e;let r;var o,a;o=s,r=pr.test(o)?function(e){const t=document.createElement("div");return t.innerHTML=e,t.firstChild}(s):function(e){const t=document.createElement("iframe");return t.setAttribute("allow","encrypted-media; autoplay; fullscreen"),t.srcdoc=`<!doctype html>${e}`,t}(s),r.src||void 0!==(a=e.provider_name)&&hr[a.toLowerCase()]?r.setAttribute("sandbox","allow-scripts allow-same-origin allow-popups allow-presentation"):r.setAttribute("sandbox","allow-same-origin"),r.classList.add("oembed-iframe",ur),r.onload=t;const{width:l,height:c}=cr(e.width,e.height,i,n);return r.width=`${l}`,c&&(r.height=`${c}`),r}const fr=new S.Z("oembed-video");class OEmbedVideoComponent extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.saveRef=e=>{this.ref=e,this.iframe||this.createEmbed()},this.createEmbed=()=>{if(!this.ref)return;const{data:e,maxWidth:t,maxHeight:i}=this.props;this.iframe=mr(e,this.onIFrameLoad,t,i),this.ref.innerHTML="",this.ref.appendChild(this.iframe)},this.onIFrameLoad=async()=>{if(this.iframe){this.iframe.classList.remove(ur);try{if(this.player=await function(e){const t=new Ki.Player(e);return new Promise(((e,i)=>{t.on("ready",(()=>{e(t)}))}))}(this.iframe),this.isUnmounting)return;(0,E.tq)()||this.player.play()}catch(e){fr.warn("unable to autoplay video"),fr.warn(e)}}}}componentWillUnmount(){this.isUnmounting=!0}componentDidUpdate(e){e.data.html!==this.props.data.html&&this.iframe&&(this.iframe.remove(),delete this.iframe,this.createEmbed())}render(){const{cover:e,loading:t,onClick:i,style:n}=this.props;return e?(0,l.jsx)(OEmbedThumbnailComponent,Object.assign({},this.props),void 0):(0,l.jsx)("div",Object.assign({className:"oembed oembed-video",style:n,ref:this.saveRef,onClick:i},{children:!this.iframe&&t}),void 0)}}class OEmbedRichComponent extends r.Component{constructor(e){super(e),this.saveRef=e=>{this.ref=e,this.iframe||this.createEmbed()},this.createEmbed=()=>{if(!this.ref)return;const{data:e,maxWidth:t,maxHeight:i}=this.props;this.iframe=mr(e,this.onIFrameLoad,t,i),this.ref.innerHTML="",this.ref.appendChild(this.iframe)},this.onIFrameLoad=()=>{this.iframe&&(this.props.data.height||(this.stopHeightCheck=function(e,t){let i,n=t;const s=()=>{e(),n*=1.5,i=window.setTimeout(s,n)};return i=window.setTimeout(s,n),()=>window.clearTimeout(i)}(this.checkHeight,100)),this.iframe.classList.remove(ur))},this.checkHeight=()=>{if(!this.iframe)return;const e=function(e){var t;const i=null===(t=e.contentWindow)||void 0===t?void 0:t.document;if(!i)return;const n=i.body,s=i.documentElement;return Math.max(n.scrollHeight,n.offsetHeight,s.clientHeight,s.scrollHeight,s.offsetHeight)}(this.iframe),t=e?`${e}`:"";t&&(this.iframe.height=t)}}componentDidUpdate(e){e.data.html!==this.props.data.html&&this.iframe&&(this.iframe.remove(),delete this.iframe,this.createEmbed())}componentWillUnmount(){this.stopHeightCheck&&this.stopHeightCheck()}render(){const{cover:e,loading:t,onClick:i,style:n}=this.props;return e?(0,l.jsx)(OEmbedThumbnailComponent,Object.assign({},this.props),void 0):(0,l.jsx)("div",Object.assign({className:"oembed oembed-rich",style:n,ref:this.saveRef,onClick:i},{children:!this.iframe&&t}),void 0)}}function gr({loading:e}){return e?(0,l.jsx)("div",Object.assign({className:"oembed oembed-loading"},{children:e}),void 0):null}class OEmbedComponent extends r.Component{constructor(e){super(e)}render(){const{cover:e,data:t,maxHeight:i,maxWidth:n,onClick:s,disabled:r,thumbnail:o,style:a}=this.props,c=(0,l.jsx)(gr,{loading:this.props.loading},void 0);if(!t)return c;const d={cover:e,onClick:s,maxHeight:i,maxWidth:n,style:a};return o?(0,l.jsx)(OEmbedThumbnailComponent,Object.assign({data:t,disabled:r},d),void 0):t.type===lr.ht.PHOTO?(0,l.jsx)(OEmbedPhotoComponent,Object.assign({data:t},d),void 0):t.type===lr.ht.VIDEO?(0,l.jsx)(OEmbedVideoComponent,Object.assign({data:t,loading:c},d),void 0):t.type===lr.ht.RICH?(0,l.jsx)(OEmbedRichComponent,Object.assign({data:t,loading:c},d),void 0):null}}var vr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let yr=class EmbeddedMedia extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.state={embed:null}}componentDidMount(){this.getEmbeddedMedia()}componentWillUnmount(){this.isUnmounting=!0}componentDidUpdate(e){this.props.attachment.id!==e.attachment.id&&this.getEmbeddedMedia()}async getEmbeddedMedia(){const{attachment:e}=this.props,{commandBinder:t}=this.context,i=await t.issueCommand(new or.st(e));this.isUnmounting||this.setState({attachmentId:e.id,embed:i})}render(){const{cover:e,thumbnail:t,disabled:i,maxWidth:n,maxHeight:s,style:r}=this.props,{embed:o}=this.state,a=o&&this.state.attachmentId===this.props.attachment.id,c=(0,l.jsx)("div",{className:"gui-spinner-icon"},void 0);return(0,l.jsx)(OEmbedComponent,{data:a&&null!=o?o:void 0,style:r,loading:c,thumbnail:t,cover:e,disabled:i,maxWidth:n,maxHeight:s},void 0)}};yr.contextType=m.I,yr=vr([I.Z],yr);var br=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Sr=class Image extends r.Component{constructor(e){super(e),this.clickImage=e=>{this.props.onClick&&this.props.onClick(e,this.props.id)}}render(){const{className:e,onClick:t,url:i,cover:n,style:s}=this.props,r={"image-cover":!!n};if(e&&Object.assign(r,{[e]:!0}),n){const e=Object.assign(Object.assign({},s),{backgroundImage:i?`url('${i}')`:"none"});return(0,l.jsx)("div",{className:d()("image",r),style:e,onClick:t?this.clickImage:void 0},void 0)}return(0,l.jsx)("img",{className:d()("image",r),src:i,style:s,onClick:t?this.clickImage:void 0},void 0)}};Sr=br([I.Z],Sr);var Er=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{ATTACHMENTS:Tr}=f.Z.SHOWCASE;let wr=class UploadedMedia extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.state={mediaUrl:""}}componentDidMount(){this.loadMedia()}componentWillUnmount(){this.isUnmounting=!0}componentDidUpdate(e){e.attachment.id!==this.props.attachment.id&&this.loadMedia()}getImageUrl(){const{attachment:e,cover:t,smartWidth:i,smartHeight:n}=this.props,{mediaUrl:s}=this.state;if(!(0,rr.lV)(e))return null;if(!t||void 0===i||void 0===n||!(0,rr.Uq)(e))return s;const r=-1!==s.indexOf("?");return`${s}${r?"&":"?"}height=${n}&crop=${i}:${n},smart`}async loadMedia(){const{attachment:e,thumbnail:t}=this.props,i=t&&e.thumbnailUrl?e.thumbnailUrl:e.url,n=await i.get();this.isUnmounting||this.setState({mediaUrl:n})}render(){const{attachment:e,cover:t,inline:i,style:n}=this.props,{id:s,category:r,filename:o,bytes:a}=e;if(r!==ar.G.UPLOAD)return null;const c=this.getImageUrl();if(c)return(0,l.jsx)(Sr,{id:s,url:c,cover:t,style:n,className:"attachment-view"},void 0);{const{mediaUrl:e}=this.state,t=this.context.locale.t(Tr.DOWNLOAD_TOOLTIP),s=a?(0,rr.VV)(a):"";return(0,l.jsxs)("div",Object.assign({className:d()("attachment-view","attachment-other",{inline:i}),style:n},{children:[!i&&(0,l.jsx)("div",{className:"icon icon-file"},void 0),(0,l.jsxs)("div",Object.assign({className:"attachment-label"},{children:[(0,l.jsx)("div",Object.assign({className:"file-label"},{children:o}),void 0),s&&!i&&(0,l.jsx)("div",Object.assign({className:"size-label"},{children:s}),void 0)]}),void 0),!i&&e&&(0,l.jsx)("a",Object.assign({className:"link download-link","data-balloon":t,"data-balloon-pos":"down",href:e,download:!0},{children:(0,l.jsx)("span",{className:"icon-download"},void 0)}),void 0)]}),void 0)}}};wr.contextType=m.I,wr=Er([I.Z],wr);var xr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let _r=class Attachment extends r.Component{constructor(e){super(e),this.removeAttachment=e=>{const{canDelete:t,attachment:i}=this.props;e.stopPropagation(),t&&(this.trackEvent("click_remove_attachment"),this.context.commandBinder.issueCommand(new or.$T(i)))},this.onClick=e=>{this.props.onClick&&this.props.onClick(e,this.props.attachment.id)}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachment:e,onClick:t,inline:i,canDelete:n,hero:s}=this.props,r={clickable:!!t,inline:!!i,hero:!!s};return(0,l.jsxs)("div",Object.assign({className:d()("attachment",r),onClick:this.onClick},{children:[this.renderMedia(),n&&(0,l.jsx)(T.hU,{iconClass:"icon-close",className:"attachment-delete",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.SMALL,tooltipMsg:"Delete",tooltipPosition:x.lZ.DOWN_LEFT,onClick:this.removeAttachment,dataValue:e.id},void 0)]}),void 0)}renderMedia(){const{attachment:e,thumbnail:t,inline:i,style:n,cover:s,maxWidth:r,maxHeight:o,smartWidth:a,smartHeight:c}=this.props,d={attachment:e,thumbnail:t,cover:s};return e.category===ar.G.UPLOAD?(0,l.jsx)(wr,Object.assign({},d,{inline:i,smartWidth:a,smartHeight:c,style:n}),void 0):(0,l.jsx)(yr,Object.assign({},d,{disabled:i,maxWidth:r,maxHeight:o,style:n}),void 0)}};_r.contextType=m.I,_r=xr([I.Z],_r);var Mr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Or=class AttachmentCarousel extends r.Component{constructor(e){super(e),this.onNext=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const n=i+1<t.length?i+1:0;this.trackEvent("notes_viewer_next"),this.setState({index:n})},this.onPrev=e=>{const{attachments:t}=this.props,{index:i}=this.state;e.stopPropagation();const n=i>0?i-1:t.length-1;this.trackEvent("notes_viewer_prev"),this.setState({index:n})},this.state={index:e.startIndex}}UNSAFE_componentWillReceiveProps(e){this.setState({index:e.startIndex})}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachments:e,onClick:t,smartWidth:i,smartHeight:n}=this.props,{index:s}=this.state,r=e[s];if(!r)return null;const o=e.length>1,a=void 0!==i&&void 0!==n;return(0,l.jsxs)("div",Object.assign({className:"attachment-carousel"},{children:[(0,l.jsx)("div",Object.assign({className:"attachment-carousel-view"},{children:(0,l.jsx)(_r,{attachment:r,onClick:t,cover:a,smartWidth:i,smartHeight:n,thumbnail:!1},void 0)}),void 0),o&&(0,l.jsx)(T.hU,{className:d()("modal-nav","modal-prev"),iconClass:"icon-dpad-left",onClick:this.onPrev},void 0),o&&(0,l.jsx)(T.hU,{className:d()("modal-nav","modal-next"),iconClass:"icon-dpad-right",onClick:this.onNext},void 0)]}),void 0)}};Or.contextType=m.I,Or=Mr([I.Z],Or);function Ar(e){const{attachments:t}=e,{analytics:i,editMode:n}=(0,r.useContext)(m.I);if(!(t.length>0))return null;const s=t.filter(rr.lV);if(0===s.length)return null;return(0,l.jsx)(Or,{attachments:s,startIndex:0,onClick:(t,s)=>{const r=n?"workshop_gui":"showcase_gui";i.track(r,{gui_action:"notes_preview_click_attachment",tool:"notes"}),t.stopPropagation(),e.onClick(s)},smartWidth:318,smartHeight:130},void 0)}var Cr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Pr=class TextBox extends r.Component{constructor(e){super(e),this.textElement=(0,r.createRef)(),this.editing=!1,this.isUnmounting=!1,this.stopPropagation=e=>e.stopPropagation(),this.onPaste=e=>{if(!e.clipboardData||!this.textElement.current)return;const{maxLength:t,textParser:i}=this.props,n=e.clipboardData.getData("text/plain");if(e.preventDefault(),t){const e=this.getSelectionRange();if(!e)return;const[s,r]=i.getHTMLWithoutSelection(this.textElement.current,e),o=e=>i.serializeHTMLToMarkdown(`${s}${n.slice(0,e)}${r}`).length<=t,a=on(n.length,o);if(a>=0){const e=n.slice(0,a);document.execCommand("insertHTML",!1,e)}}else document.execCommand("insertHTML",!1,n)},this.onKeyDown=e=>{if(!this.textElement.current)return;const{maxLength:t,onKeyDown:i,textParser:n}=this.props,s=this.getSelectionRange();if(t&&s){const[i,r]=n.getHTMLWithoutSelection(this.textElement.current,s),o=this.getTextInsertion(e,i,r);if(n.serializeHTMLToMarkdown(`${i}${o}${r}`).length>t)return e.preventDefault(),void e.stopPropagation()}(e.which||e.keyCode)===ei.R.RETURN&&(e.shiftKey||e.altKey)?document.execCommand("insertText",!1,"\n"):i&&i(e)},this.onMouseDown=e=>{const{onClick:t,clickToEdit:i,readonly:n}=this.props;(this.editing||i)&&t&&(e.stopPropagation(),t(e),this.editing||n||this.toggleEditing(!0))},this.onFocus=e=>{this.textElement.current&&(this.context.messageBus.broadcast(new nt.SN(this.textElement.current,!0)),this.props.onFocus&&this.props.onFocus(e))},this.onBlur=e=>{this.textElement.current&&(this.context.messageBus.broadcast(new nt.SN(this.textElement.current,!1)),this.props.onBlur&&this.props.onBlur(e))}}componentDidMount(){this.replaceTextContent(this.props.text)}componentWillUnmount(){this.isUnmounting=!0,this.textElement.current&&this.textElement.current.blur()}componentDidUpdate(e){const{text:t,active:i}=this.props;t===e.text&&i===e.active||this.replaceTextContent(t)}shouldComponentUpdate(){return!1}getTextElement(){return this.textElement.current}getPlainText(){var e;return(null===(e=this.textElement.current)||void 0===e?void 0:e.innerText)||""}focus(){this.editing&&this.textElement.current&&this.textElement.current.focus()}toggleEditing(e){clearTimeout(this.toggleEditingTimeout),this.toggleEditingTimeout=window.setTimeout((()=>{this.textElement.current&&!this.isUnmounting&&(this.editing!==e&&(this.editing=e,this.textElement.current.contentEditable=e?"true":"false",e?this.textElement.current.classList.add("editing"):this.textElement.current.classList.remove("editing")),e?this.textElement.current.focus():this.textElement.current.blur())}),0)}replaceTextContent(e){clearTimeout(this.replaceTextContentTimeout),this.replaceTextContentTimeout=window.setTimeout((()=>{if(!this.textElement.current||this.isUnmounting)return;for(;this.textElement.current.firstChild;)this.textElement.current.removeChild(this.textElement.current.firstChild);const t=document.createDocumentFragment(),{textParser:i,markers:n,onClickAnchor:s,active:r,readonly:o,maxLength:a,clickableLinks:l}=this.props,c=void 0!==l?l:!r,d=i.deserialize(e,c,s,n);let h=0;!d.every((e=>{var i;const n=(null===(i=e.textContent)||void 0===i?void 0:i.length)||0;if(o&&a&&h+n>a){if("#text"===e.nodeName){const i=e.textContent||"";e.textContent=i.substring(0,a-h),t.appendChild(e)}return!1}return!o&&r&&"A"===e.nodeName&&(e.contentEditable="true"),h+=n,t.appendChild(e),!0}))&&t.appendChild(document.createTextNode("...")),this.textElement.current.appendChild(t),this.focus()}),0)}getSelectionRange(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0);if(this.textElement.current&&(this.textElement.current===t.commonAncestorContainer||this.textElement.current.compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY))return t}return null}getTextInsertion(e,t,i){if((e.which||e.keyCode)!==ei.R.RETURN)return e.key;const n=t.slice(-1),s=i.slice(0,1);return"\n"===n||"\n"===s?"\n":"\n\n"}render(){const{placeholder:e,tabIndex:t,onInput:i,readonly:n}=this.props;return(0,l.jsx)("div",{ref:this.textElement,className:"text-box-text",role:"textbox",draggable:!1,spellCheck:!0,contentEditable:!1,placeholder:e,onMouseDown:this.onMouseDown,onKeyDown:n?void 0:this.onKeyDown,onKeyUp:n?void 0:this.stopPropagation,onFocus:n?void 0:this.onFocus,onBlur:n?void 0:this.onBlur,onInput:n?void 0:i,onPaste:n?void 0:this.onPaste,tabIndex:t},void 0)}};Pr.contextType=m.I,Pr=Cr([I.A],Pr);const Dr=Pr;function Nr(e){return e?e.getTextParser():null}function Ir(e){e.stopPropagation()}function Lr({text:e}){const t=function(){const e=er(),[t,i]=(0,r.useState)(Nr(e));return(0,r.useEffect)((()=>(t||i(Nr(e)),()=>{})),[e]),t}();return(0,l.jsx)("div",Object.assign({className:d()("note-post",{"note-summary-info":!e})},{children:e&&t&&(0,l.jsx)(Dr,{text:e,textParser:t,maxLength:150,onClickAnchor:Ir,readonly:!0},void 0)}),void 0)}function Rr(e){const{previewId:t}=e,i=function(){const e=er(),[t,i]=(0,r.useState)(e?e.focusedComment:null);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=e.onFocusedCommentChanged(i);return i(e.focusedComment),()=>t.cancel()}),[e]),t}(),n=function(e){const t=er(),[i,n]=(0,r.useState)(tr(e,t));return(0,r.useEffect)((()=>(i&&i.id===e||n(tr(e,t)),()=>{})),[e,t]),i}(t);if(!n)return null;const s=n.comments.get(0),o=s&&s.attachments.length>0,a=n.comments.length>0,c=d()("annotation-preview-contents","note-preview-contents",{"viewable-media":o});return(0,l.jsxs)("div",Object.assign({className:c,onClick:t=>{t.stopPropagation(),e.onClick()}},{children:[s&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(Ar,{attachments:s.attachments.values(),onClick:e.onClick},void 0),(0,l.jsx)(sr,{noteView:n,comment:s},void 0),(0,l.jsx)(Lr,{text:s.text},void 0)]},void 0),i&&i.id!==s.id&&(0,l.jsxs)("div",Object.assign({className:"nested-comment-preview"},{children:[(0,l.jsx)(sr,{comment:i},void 0),(0,l.jsx)(Lr,{text:i.text},void 0)]}),void 0),a&&(0,l.jsx)("div",Object.assign({className:"link link-more"},{children:"Read more"}),void 0)]}),void 0)}var kr=i(65049),Ur=i(74886),Br=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Fr=class TagMedia extends r.Component{constructor(e){super(e),this.clickAttachment=(e,t)=>{const{attachments:i,onClick:n}=this.props;0!==i.length&&(e.stopPropagation(),n(e,t))}}getMediaDimensions(e){if(e.category!==ar.G.EXTERNAL)return{};const t=function(e){const{mediaType:t,width:i,height:n}=e;if(i&&n&&t===Ur.DD.IMAGE)return Math.max(i,1)/Math.max(n,1)<1?200:275;return 300}(e),i=function(e){const{mediaType:t,width:i,height:n}=e;if(i&&n&&t===Ur.DD.IMAGE)return Math.max(i,1)/Math.max(n,1)>=1?400:300;return 350}(e),{layerWidth:n,layerHeight:s}=this.props;if(void 0===n||void 0===s)return{maxWidth:i};let r=Math.min(i,.35*n);r=Math.max(r,t);return{maxWidth:r,maxHeight:.6*s,minWidth:t}}renderAttachment(e){const{maxWidth:t,maxHeight:i,minWidth:n}=this.getMediaDimensions(e),s={maxHeight:`${i}px`,maxWidth:`${t}px`,minWidth:`${n}px`};return(0,l.jsx)("div",Object.assign({className:"tag-media",style:s},{children:(0,l.jsx)(_r,{attachment:e,onClick:this.clickAttachment,maxWidth:t,maxHeight:i},void 0)}),void 0)}render(){const{attachments:e}=this.props;return 0===e.length?null:1===e.length?this.renderAttachment(e[0]):(0,l.jsx)("div",Object.assign({className:"tag-media"},{children:(0,l.jsx)(Or,{attachments:e,startIndex:0,onClick:this.clickAttachment,smartWidth:318,smartHeight:130},void 0)}),void 0)}};Fr=Br([I.Z],Fr);var Vr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{ATTACHMENTS:Hr}=f.Z.SHOWCASE;let jr=class PendingUpload extends r.Component{constructor(e){super(e),this.onRemoveFailed=e=>{const{id:t,error:i}=this.props;i&&(e.stopPropagation(),this.context.commandBinder.issueCommand(new or.Rh(t)))}}renderError(e){let t=x.ig.SMALL;const i=this.context.locale;let n=i.t(Hr.ERROR_UPLOAD_FAIL);switch(e){case Ur.kV.FILE_TOO_LARGE:n=i.t(Hr.ERROR_FILE_TOO_LARGE);break;case Ur.kV.EMPTY_FILE:n=i.t(Hr.ERROR_EMPTY_FILE);break;case Ur.kV.OVER_QUOTA:n=i.t(Hr.ERROR_OVER_QUOTA),t=x.ig.MEDIUM;break;case Ur.kV.PERMISSION_DENIED:n=i.t(Hr.ERROR_PERMISSION_DENIED)}const s=this.context.locale.t(Hr.REMOVE_TOOLTIP);return(0,l.jsxs)("div",Object.assign({className:"upload-status"},{children:[(0,l.jsx)(x.oO,Object.assign({className:"upload-error-message",content:n,position:x.lZ.DOWN,tooltipWidth:t,showOnClick:!0},{children:(0,l.jsx)("span",{className:"icon icon-error"},void 0)}),void 0),(0,l.jsx)(T.hU,{iconClass:"icon-close",className:"attachment-delete",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.SMALL,tooltipMsg:s,tooltipPosition:x.lZ.DOWN_LEFT,onClick:this.onRemoveFailed},void 0)]}),void 0)}renderInProgress(){const{progress:e}=this.props;return(0,l.jsx)("div",Object.assign({className:"upload-status"},{children:(0,l.jsx)(ks,{progress:e,innerRadius:20,barWidth:4},void 0)}),void 0)}render(){const{className:e,error:t}=this.props,i={"upload-error":!!t};return(0,l.jsx)("div",Object.assign({className:d()("attachment","attachment-upload",i,e)},{children:t?this.renderError(t):this.renderInProgress()}),void 0)}};jr.contextType=m.I,jr=Vr([I.Z],jr);var Gr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let zr=class AnnotationAttachments extends r.Component{constructor(e){super(e),this.onViewAttachment=(e,t)=>{if(this.props.onViewAttachment)this.props.onViewAttachment(e,t);else{const{attachments:e}=this.props;if(e.length){this.trackEvent("click_view_attachment");const i=e.filter((e=>(0,rr.lV)(e)));i.length>0&&this.context.commandBinder.issueCommand(new or.xW(!0,i,t))}}},this.renderAttachment=(e,t)=>{const{inline:i,canDelete:n,attachments:s}=this.props,r=s.length,o=!i&&(1===r||0===t&&r>2),a=!!i||!o,c=(0,rr.fy)(!!i,o),d=!i&&(0,rr.lV)(e)?this.onViewAttachment:void 0;return(0,l.jsx)(_r,{attachment:e,inline:!!i,canDelete:!!n,hero:o,cover:!0,onClick:d,thumbnail:a,smartWidth:c.width,smartHeight:c.height},e.id)},this.renderPendingUpload=e=>(0,l.jsx)(jr,{id:e.id,className:"inline",progress:e.progress,error:e.error},e.id)}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}render(){const{attachments:e,uploads:t,failures:i,inline:n,children:s}=this.props;return(0,l.jsxs)("div",Object.assign({className:d()("annotation-attachments",{"annotation-attachments-inline":!!n})},{children:[e.map(this.renderAttachment),t&&t.map(this.renderPendingUpload),i&&i.map(this.renderPendingUpload),s]}),void 0)}};zr.contextType=m.I,zr=Gr([I.Z],zr);var Wr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Kr=class ViewOnlyAnnotation extends r.Component{constructor(e){super(e),this.onClickAnchor=e=>{const t=e.target,i=t.dataset.blocktype;if(e.stopPropagation(),i){const{annotationType:e,annotationId:n}=this.props,s={blockType:i,text:t.innerText,value:t.dataset.value,id:t.dataset.id};this.context.messageBus.broadcast(new Qs.iP(e,n,s))}}}renderAttachments(e){if(0===e.length)return null;const{onViewAttachment:t}=this.props;return(0,l.jsx)(zr,{attachments:e,onViewAttachment:t},void 0)}render(){const{text:e,textParser:t,title:i,edited:n,attachments:s,maxLength:r}=this.props;return(0,l.jsxs)("div",Object.assign({className:"annotation-box"},{children:[i&&(0,l.jsx)("div",Object.assign({className:"annotation-title"},{children:i}),void 0),(0,l.jsx)("div",Object.assign({className:"annotation-text-box"},{children:(0,l.jsx)(Dr,{text:e,textParser:t,onClickAnchor:this.onClickAnchor,maxLength:r,readonly:!0},void 0)}),void 0),n&&(0,l.jsx)("div",Object.assign({className:"annotation-edited"},{children:"(edited)"}),void 0),s&&this.renderAttachments(s)]}),void 0)}};Kr.contextType=m.I,Kr=Wr([I.Z],Kr);var Yr=i(73272),qr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Zr=class UrlLinkCopy extends r.Component{constructor(e){super(e),this.copiedTimeout=0,this.onCopyLink=async e=>{if(e.stopPropagation(),this.state.linkCopied)return;window.clearTimeout(this.copiedTimeout);const t=this.createLinkToAsset(),i=document.createElement("input");i.type="text",i.value=t,document.body.appendChild(i),i.select(),document.execCommand("copy"),document.body.removeChild(i),this.setState({linkCopied:!0}),this.copiedTimeout=window.setTimeout((()=>{this.setState({linkCopied:!1})}),2500)},this.state={linkCopied:!1}}componentWillUnmount(){window.clearTimeout(this.copiedTimeout)}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}createLinkToAsset(){const{urlParamValue:e,urlParamKey:t}=this.props;this.trackEvent("click_copy_link");const i=Yr.K.removeNavigationKeys();i.set(t,e);const n=i.toString();return`${window.location.origin}${window.location.pathname}?${n}`}render(){if(this.state.linkCopied){const e=this.context.locale.t(f.Z.SHARE_COPIED);return(0,l.jsx)("div",Object.assign({className:"url-link-copied"},{children:e}),void 0)}{const{buttonStyle:e,buttonSize:t}=this.props,i=this.context.locale.t(f.Z.COPY_LINK);return(0,l.jsx)(T.hU,{iconClass:"icon-link",className:"url-link-copy-btn",buttonStyle:e,buttonSize:t,buttonState:w.BN.ENABLED,tooltipMsg:i,tooltipPosition:x.lZ.DOWN,onClick:this.onCopyLink},void 0)}}};Zr.contextType=m.I,Zr=qr([I.Z],Zr);var $r,Qr=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{TAGS:Xr}=f.Z.SHOWCASE;let Jr=$r=class TagPreviewer extends r.Component{constructor(e){super(e),this.textParser=new Wi.v({links:!0}),this.openAttachment=(e,t)=>{this.trackEvent("tags_preview_click_attachment"),this.props.onClick(t)},this.onClickTag=e=>{e.stopPropagation(),this.props.onClick()},this.onDockTag=e=>{e.stopPropagation(),this.context.commandBinder.issueCommand(new kr.lt(this.props.previewId,Be.n.Interpolate,!0))},this.state={tagView:null}}componentDidMount(){this.updateTagView()}componentDidUpdate(e){e.previewId!==this.props.previewId&&this.updateTagView()}updateTagView(){const{previewId:e}=this.props,{toolsData:t}=this.context,i=t.getTool(p.w1.TAGS);if(i){const t=i.manager.dataMap.tagsViewData;if(!t)return;const n=t.getTagView(e);this.setState({tagView:n})}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"mattertags"})}renderWidgetFrame(e){const{widgetFrame:t}=e;return t?(0,l.jsx)(CustomWidgetFrame,{widget:t},void 0):null}render(){const{tagView:e}=this.state;if(!e)return null;const{locale:t,editMode:i}=this.context,{layerWidth:n,layerHeight:s,toolPanelLayout:r}=this.props,{id:o,label:a,attachments:c,description:h}=e,u=(0,rr.Ug)(c),m=u.length>0,f=h.length>$r.MAX_TAG_LENGTH,g=t.t(Xr.READ_MORE_MESSAGE),v=r===p.wS.BOTTOM_PANEL||r===p.wS.NARROW,y=i?"Edit tag":"Dock",b=i?"icon-toggle-pencil":"icon-chevron-right",S=a?(0,l.jsx)("div",Object.assign({className:"tag-preview-title"},{children:a}),void 0):null,E=h?(0,l.jsx)("div",Object.assign({className:"tag-preview-description"},{children:(0,l.jsx)(Kr,{text:h,textParser:this.textParser,annotationType:Zs.J.TAG,annotationId:o,maxLength:$r.MAX_TAG_LENGTH},void 0)}),void 0):null,w=S||E||null,_=d()("annotation-preview-contents","tag-preview-contents",{"viewable-media":m,"media-only":!w});return(0,l.jsxs)("div",Object.assign({className:_,onClick:this.onClickTag},{children:[(0,l.jsx)(Fr,{attachments:u,layerWidth:n,layerHeight:s,onClick:this.openAttachment},void 0),(0,l.jsxs)("header",Object.assign({className:"tag-preview-header"},{children:[w,(0,l.jsxs)("div",Object.assign({className:"tag-preview-actions"},{children:[(0,l.jsx)(Zr,{urlParamKey:"tag",urlParamValue:e.id,buttonStyle:T.Dd.CLEAR},void 0),!v&&(0,l.jsx)(T.hU,{iconClass:b,buttonStyle:T.Dd.CLEAR,onClick:this.onDockTag,tooltipMsg:y,tooltipPosition:x.lZ.DOWN},void 0)]}),void 0)]}),void 0),a&&E,f&&(0,l.jsx)("div",Object.assign({className:"tag-preview-footer"},{children:(0,l.jsx)("span",Object.assign({className:"link link-more"},{children:g}),void 0)}),void 0),this.renderWidgetFrame(e)]}),void 0)}};Jr.contextType=m.I,Jr.MAX_TAG_LENGTH=100,Jr=$r=Qr([I.Z],Jr);var eo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let to=class AnnotationsLayer extends r.Component{constructor(e){super(e),this.bindings=[],this.isUnmounting=!1,this.clickOuterAnnotation=()=>{const{currentAnnotation:e,previewType:t}=this.state;e&&(t!==io.SELECTED?t!==io.FOCUS||e.annotationType!==Zs.J.TAG||this.context.editMode?this.dockAnnotation():this.selectAnnotation():this.closeAnnotation())},this.onClickNote=async e=>{this.trackEvent("click_note_preview"),this.clickInnerAnnotation(e)},this.onClickTag=e=>{this.trackEvent("click_tag_preview"),this.clickInnerAnnotation(e)},this.onResize=e=>{e.forEach((e=>{const t=e.target;t.classList.contains("annotation-preview")&&"hidden"!==t.style.visibility||this.updatePositioning(!0)}))},this.onScreenPositionChanged=()=>{this.updatePositioning(!1)},this.updateCurrentAnnotation=()=>{const{selectedAnnotation:e,focusedAnnotation:t,dockedAnnotation:i}=this.viewData;t?(this.setState({currentAnnotation:t,previewType:io.FOCUS}),this.updatePositioning(!0)):e?(this.setState({currentAnnotation:e,previewType:io.SELECTED}),this.updatePositioning(!0)):i?this.setState({currentAnnotation:null,previewType:io.DOCKED,previewDirection:null}):this.setState({currentAnnotation:null,previewType:io.NONE,previewDirection:null})},this.updatePositioning=e=>{if(!(this.pinsViewData&&this.layer&&this.preview&&this.state.currentAnnotation))return;const t=this.pinsViewData.screenPosition;if(t){if(e){const e=t.x,i=t.y;this.updatePreviewDirection(e,i)}this.setState({screenPosition:t,layerWidth:this.layer.offsetWidth,layerHeight:this.layer.offsetHeight})}},this.updatePreviewDirection=(e,t)=>{if(!this.layer||!this.preview)return;const{layerWidth:i,layerHeight:n,previewDirection:s}=this.state,{offsetWidth:r,offsetHeight:o}=this.preview;if(!(i&&n&&r&&o))return;let a=s;const l=t<o,c=t>n-o,d=e<r,h=e>i-r;l&&c?a=h&&!d?Ys.Od.LEFT:Ys.Od.RIGHT:l?a=d?Ys.Od.DOWN_RIGHT:h?Ys.Od.DOWN_LEFT:Ys.Od.DOWN:c?a=d?Ys.Od.UP_RIGHT:h?Ys.Od.UP_LEFT:Ys.Od.UP:d&&h?a=l?Ys.Od.DOWN:Ys.Od.UP:d?a=Ys.Od.RIGHT:h?a=Ys.Od.LEFT:null===a&&(a=Ys.Od.RIGHT),a!==s&&this.setState({previewDirection:a})},this.setLayerRef=e=>{this.layer=e,e&&(this.resizeObserver.observe(e),this.updatePositioning(!0))},this.setPreviewRef=e=>{this.preview=e,e&&(this.resizeObserver.observe(e),this.updatePositioning(!0))},this.state={currentAnnotation:null,previewType:io.NONE,screenPosition:null,previewDirection:null,layerWidth:0,layerHeight:0},this.resizeObserver=new Lt(this.onResize)}componentDidMount(){const{market:e}=this.context;Promise.all([e.waitForData($s.A),e.waitForData(qs.B)]).then((([e,t])=>{this.isUnmounting||(this.viewData=e,this.pinsViewData=t,this.bindings.push(e.onChanged(this.updateCurrentAnnotation),t.onScreenPositionChanged(this.onScreenPositionChanged)),this.isUnmounting||this.updateCurrentAnnotation())}))}componentWillUnmount(){this.isUnmounting=!0;for(const e of this.bindings)e.cancel();this.resizeObserver&&this.resizeObserver.disconnect()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}async clickInnerAnnotation(e){const{currentAnnotation:t}=this.state;if(t){const{messageBus:i}=this.context,{id:n,annotationType:s}=t;e&&!this.viewData.dockedAnnotation||this.dockAnnotation(),e&&i.broadcast(new Qs.qk(s,n,e))}}dockAnnotation(){const{currentAnnotation:e}=this.state;if(!e)return;const{commandBinder:t}=this.context;this.trackEvent(`dock_${e.annotationType}`),t.issueCommand(new Xs.bd(e.id,e.annotationType))}selectAnnotation(){const{currentAnnotation:e}=this.state;if(!e)return;const{commandBinder:t}=this.context;this.trackEvent(`select_${e.annotationType}`),t.issueCommand(new Xs.oM(e.id,e.annotationType))}closeAnnotation(){const{currentAnnotation:e}=this.state;if(!e)return;const{commandBinder:t}=this.context;this.trackEvent(`close_${e.annotationType}`),t.issueCommand(new Xs.Aj(e.id,e.annotationType))}getPreviewPositioning(){const{screenPosition:e,previewDirection:t}=this.state;if(e){let i="",n=e.x;switch(t){case Ys.Od.UP:i="translate(-50%, -100%)";break;case Ys.Od.DOWN:i="translateX(-50%)";break;case Ys.Od.LEFT:i="translate(-100%, -50%)";break;case Ys.Od.RIGHT:i="translateY(-50%)";break;case Ys.Od.UP_LEFT:n+=50,i="translate(-100%, -100%)";break;case Ys.Od.UP_RIGHT:i="translate(-50px, -100%)";break;case Ys.Od.DOWN_LEFT:n+=50,i="translate(-100%, 5px)";break;case Ys.Od.DOWN_RIGHT:i="translate(-50px, 5px)"}return{top:`${e.y}px`,left:`${n}px`,visibility:null===t?"hidden":"",transform:i}}return{}}render(){const{openModal:e,newTagsEnabled:t,notesEnabled:i,toolPanelLayout:n}=this.props;if(e)return null;const{currentAnnotation:s,previewDirection:r,layerWidth:o,layerHeight:a}=this.state,c=a-100,h=t&&s&&s.annotationType===Zs.J.TAG,u=i&&s&&s.annotationType===Zs.J.NOTE;return(0,l.jsx)("div",Object.assign({ref:this.setLayerRef,className:"annotations-preview-layer"},{children:s&&(h||u)&&(0,l.jsxs)("div",Object.assign({ref:this.setPreviewRef,className:d()("annotation-preview",`annotation-preview-${r}`,{"tag-preview":!!h,"note-preview":!!u}),style:this.getPreviewPositioning(),onClick:this.clickOuterAnnotation},{children:[h&&(0,l.jsx)(Jr,{previewId:s.id,onClick:this.onClickTag,toolPanelLayout:n,layerWidth:o,layerHeight:c},void 0),u&&(0,l.jsx)(Rr,{previewId:s.id,onClick:this.onClickNote},void 0)]}),void 0)}),void 0)}};var io;to.contextType=m.I,to=eo([I.Z],to),function(e){e.NONE="none",e.DOCKED="docked",e.FOCUS="focus",e.SELECTED="selected"}(io||(io={}));var no=i(28470),so=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{ATTACHMENTS:ro}=f.Z.SHOWCASE;let oo=class AttachmentViewer extends r.Component{constructor(e){super(e),this.bindings=[],this.onKey=async e=>{const{attachments:t,attachmentIndex:i}=this.state,n=t.length;let s=-1;switch(e.keyCode){case ei.R.ESCAPE:this.closeAttachmentViewer();break;case ei.R.LEFTARROW:s=i-1,s<0&&(s=n-1);break;case ei.R.RIGHTARROW:s=i+1,s>=n&&(s=0)}-1!==s&&this.setState({attachmentIndex:s}),e.stopPropagation()},this.closeAttachmentViewer=()=>{this.state.open&&this.context.commandBinder.issueCommand(new or.xW(!1))},this.onModalToggled=e=>{e.modal!==Te.P.ATTACHMENT||e.open||this.closeAttachmentViewer()},this.onViewerClosed=()=>{this.state.open&&(document.removeEventListener("keydown",this.onKey,{capture:!0}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.ATTACHMENT,!1)),this.setState({open:!1}))},this.onViewAttachments=e=>{const{attachments:t,attachmentId:i}=e,n=t.findIndex((e=>e.id===i));t.length>0&&-1!==n&&(this.state.open||(document.addEventListener("keydown",this.onKey,{capture:!0}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.ATTACHMENT,!0)),this.setState({open:!0})),this.setState({attachments:t,attachmentIndex:n}))},this.state={open:!1,attachmentIndex:-1,attachments:[]}}componentDidMount(){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(no.O,this.onViewAttachments),e.subscribe(no.Rd,this.onViewerClosed),e.subscribe(nt.nV,this.onModalToggled))}componentWillUnmount(){for(const e of this.bindings)e.cancel();document.removeEventListener("keydown",this.onKey,{capture:!0})}render(){const{open:e,attachments:t,attachmentIndex:i}=this.state,n=this.context.locale.t(ro.CLOSE_TOOLTIP);return(0,l.jsxs)("div",Object.assign({className:d()("overlay-layer","attachment-overlay",{open:e})},{children:[e&&(0,l.jsx)("div",Object.assign({className:"overlay-close"},{children:(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.OVERLAY,tooltipMsg:n,tooltipPosition:x.lZ.DOWN,onClick:this.closeAttachmentViewer},void 0)}),void 0),e&&(0,l.jsx)(Or,{attachments:t,startIndex:i},void 0)]}),void 0)}};oo.contextType=m.I,oo=so([I.Z],oo);var ao=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let lo=class LoadIndicator extends r.Component{constructor(e){super(e)}render(){const{showing:e}=this.props;return(0,l.jsx)(Re,Object.assign({open:e,className:d()("load-indicator",{"fade-in":e,"fade-out":!e})},{children:(0,l.jsx)("div",Object.assign({className:"center-container"},{children:(0,l.jsx)(ks,{progress:33,barWidth:4,progressColor:"#ffffff"},void 0)}),void 0)}),void 0)}};lo=ao([I.Z],lo);const co=lo,ho=oe(u.pu);function uo(e){const{commandBinder:t}=(0,r.useContext)(m.I),i=function(){const e=ho(),[t,i]=(0,r.useState)(e?e.phase:null);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=e.onPropertyChanged("phase",i);return i(e.phase),()=>t.cancel()}),[e]),t}(),n=function(){const e=pe(),[t,i]=(0,r.useState)(e?e.name:"");return(0,r.useEffect)((()=>(e&&i(e.name),()=>{})),[e]),t}(),s=_i();if(i!==u.nh.PLAYING)return null;const o=d()("floor-container",{"faded-out":!s});return(0,l.jsxs)("div",Object.assign({className:o},{children:[(0,l.jsx)("div",Object.assign({className:"floor-title"},{children:(0,l.jsx)("div",Object.assign({className:"h4"},{children:n||""}),void 0)}),void 0),(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.CLEAR,buttonSize:w.qE.STANDARD,tooltipPosition:x.lZ.DOWN_RIGHT,onClick:()=>{t.issueCommand(new fe.Vw(null,!1))}},void 0)]}),void 0)}var po=i(91302);class OverlayUi extends r.Component{constructor(e){super(e),this.propertiesToRefreshUi=[Di.re,et.Mp,Pi.Nj,_.gx.Labels,Ee.Q5,Pi.Cu,Ee.gu],this.bindings=[],this.inTransition=!1,this.newTagsEnabled=!1,this.notesEnabled=!1,this.onLoadSpinnerMessage=e=>{this.setState({loadSpinnerOn:e.isOpen})},this.onLoadSpinnerSuppressMessage=e=>{this.setState({loadSpinnerSuppress:e.suppress})},this.refreshVisibility=()=>{const e=this.context.settings;this.setState({floorNameOn:e.tryGetProperty(Ee.gu,!0),labelsOn:e.tryGetProperty(Pi.Nj,!1)&&e.tryGetProperty(_.gx.Labels,!1)&&!e.tryGetProperty(Pi.Cu,!1)&&!this.inTransition,mattertagsOn:e.tryGetProperty(Di.re,!1),notesOn:e.tryGetProperty(et.Mp,!1),roomBasedNav:e.tryGetProperty(Ee.Q5,!1)})},this.state={floorNameOn:!1,mattertagsOn:!1,labelsOn:!1,notesOn:!1,loadSpinnerOn:!1,loadSpinnerSuppress:!1,roomBasedNav:!1}}componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.refreshVisibility);const e=()=>{this.inTransition=!0},t=()=>{this.inTransition=!1,this.refreshVisibility()};this.bindings.push(this.context.messageBus.subscribe(js.Z,e),this.context.messageBus.subscribe(Hs.Z,t),this.context.messageBus.subscribe(Gs.S,e),this.context.messageBus.subscribe(zs.P,t),this.context.messageBus.subscribe(nt.Z_,this.onLoadSpinnerMessage),this.context.messageBus.subscribe(nt.bN,this.onLoadSpinnerSuppressMessage),this.context.messageBus.subscribe(po.oR,(()=>this.setState({loadSpinnerSuppress:!0}))),this.context.messageBus.subscribe(po.NR,(()=>this.setState({loadSpinnerSuppress:!1})))),this.refreshVisibility(),this.newTagsEnabled=this.context.settings.tryGetProperty(Ni.R,!1),this.notesEnabled=this.context.settings.tryGetProperty(et.IA,!1)}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.refreshVisibility);this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}render(){const{floorNameOn:e,labelsOn:t,mattertagsOn:i,notesOn:n,roomBasedNav:s,loadSpinnerOn:r,loadSpinnerSuppress:o}=this.state,{mobile:a,viewmode:c,openModal:d,activeTool:h,tourPlaying:u,toolPanelLayout:p}=this.props,m=r&&!o,f=i&&this.newTagsEnabled,g=n&&this.notesEnabled,v=g||f;return(0,l.jsxs)("div",Object.assign({className:"overlay-ui"},{children:[v&&(0,l.jsx)(oo,{},void 0),v&&(0,l.jsx)(to,{notesEnabled:g,newTagsEnabled:f,toolPanelLayout:p,openModal:d,activeTool:h},void 0),i&&!this.newTagsEnabled&&(0,l.jsx)(Tags,{tourPlaying:u,toolOpen:!1,mobile:a,allowTagOverlay:!0},void 0),t&&(0,l.jsx)(Ks,{viewmode:c},void 0),s&&e&&(0,l.jsx)(uo,{},void 0),(0,l.jsx)(co,{showing:m},void 0)]}),void 0)}}OverlayUi.contextType=m.I;var mo=i(3184),fo=i(7677);const go={"en-US":"./terms/terms-en-US.html",es:"./terms/terms-es-MX.html",fr:"./terms/terms-fr-FR.html",de:"./terms/terms-de-DE.html",ru:"./terms/terms-ru-RU.html",ja:"./terms/terms-ja-JP.html","zh-CN":"./terms/terms-zh-CN.html","zh-TW":"./terms/terms-zh-TW.html",ko:"./terms/terms-ko-KR.html",nl:"./terms/terms-nl-NL.html",it:"./terms/terms-it-IT.html",pt:"./terms/terms-pt-BR.html"};class Terms extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.onScrollPositionChange=()=>{this.scrollbars&&this.setState({scrollClass:this.scrollbars.scrollPosition.vertical})},this.onClose=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.TERMS,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.state={termsText:"",showing:!1,scrollClass:z.None}}async componentDidMount(){const e=function(e){if((0,fo.y)(e)&&e in go)return go[e]}(this.context.locale?this.context.locale.languageCode:mo.k$);let t="";if(e)try{t=await this.context.queue.get(e)}catch(e){t=this.context.locale.t(f.Z.TERMS_FAIL)}else t=this.context.locale.t(f.Z.TERMS_FAIL);window.requestAnimationFrame((()=>{this.isUnmounting||this.setState({showing:!0,termsText:t})}))}componentWillUnmount(){this.isUnmounting=!0}componentDidUpdate(e){this.state.termsText!==e.termsText&&(this.termsTextDiv.innerHTML=this.state.termsText,[].slice.call(this.termsTextDiv.querySelectorAll("a")).forEach((e=>{e.setAttribute("target","_blank"),e.classList.add("link")})))}render(){const{showing:e,scrollClass:t}=this.state;return(0,l.jsxs)("div",Object.assign({className:d()("modal","terms-modal",{"faded-in":e,[t]:!0}),onClick:this.stopPropagation},{children:[(0,l.jsx)("div",Object.assign({id:"terms-wrapper"},{children:(0,l.jsx)(Scrollbars,Object.assign({name:"terms",ref:e=>this.scrollbars=e,onScrollPositionChange:this.onScrollPositionChange,forceHidden:De(window)},{children:(0,l.jsx)("div",{ref:e=>this.termsTextDiv=e,id:"terms-text"},void 0)}),void 0)}),void 0),(0,l.jsx)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.onClose},void 0)]}),void 0)}}Terms.contextType=m.I;var vo=i(7855),yo=i(42472),bo=i(1630),So=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Eo=new S.Z("vr-select");let To=class VrModal extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.stopPropagation=e=>{e.stopPropagation()},this.renderHeadsetHeader=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case vo.bk.unsupported:case vo.bk.webxr:return(0,l.jsxs)("div",Object.assign({className:"headset-header dark"},{children:[(0,l.jsxs)("span",Object.assign({className:"headset-titles"},{children:[(0,l.jsx)("h2",{children:e.t(f.Z.VR_RECOMMENDED)},void 0),(0,l.jsx)("h1",{children:e.t(f.Z.VR_QUEST)},void 0)]}),void 0),(0,l.jsx)("img",{className:"headset-quest",src:i(49529),height:200,width:342},void 0)]}),void 0);default:return null}},this.renderBodyText=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state;switch(t){case vo.bk.unsupported:case vo.bk.webxr:return(0,l.jsx)("div",{children:(0,l.jsx)("p",{children:e.t(f.Z.VR_SUPPORTS)},void 0)},void 0);default:return null}},this.getFooterButtons=()=>{const{locale:e}=this.context,{vrPlatform:t}=this.state,i=[];i.push((0,l.jsx)(w.zx,Object.assign({buttonStyle:w.ZJ.OUTLINE,className:d()("button-inline","cancel"),onClick:this.onLearnMoreClicked},{children:e.t(f.Z.VR_LEARN_MORE_CAPS)}),"learn-more"));return t===vo.bk.webxr&&i.push((0,l.jsx)(w.zx,Object.assign({buttonState:w.BN.ENABLED,className:d()("button-inline","confirm"),onClick:this.onActionClicked},{children:e.t(f.Z.VR_ENTER)}),"enter-vr")),i},this.closeModal=()=>{this.context.commandBinder.issueCommand(new we.Bz(Te.P.VR_SELECT,!1))},this.onCloseClicked=()=>{this.trackEvent("vr_modal_close"),this.closeModal()},this.onActionClicked=()=>{switch(this.state.vrPlatform){case vo.bk.webxr:this.startWebXR(),this.closeModal()}},this.onLearnMoreClicked=()=>{window.open("https://support.matterport.com/hc/en-us/articles/360050098973-Exploring-Matterport-Spaces-in-VR-","_blank"),this.trackEvent("vr_learn_more")},this.startWebXR=()=>{this.context.commandBinder.issueCommand(new bo.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else Eo.error("requestPresent Failed"),this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{Eo.error("requestPresent Failed:",e);const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){yo.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState(),this.trackEvent("click_vr_button")}componentWillUnmount(){this.isUnmounting=!0,yo.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}render(){const{isMobile:e}=this.props,{locale:t}=this.context,i=d()("vr-modal","modal","full-modal",{mobile:e,desktop:!e});return(0,l.jsxs)("dialog",Object.assign({className:i,onClick:this.stopPropagation},{children:[(0,l.jsxs)("header",Object.assign({className:"modal-header"},{children:[(0,l.jsx)("div",Object.assign({className:"modal-title"},{children:t.t(f.Z.VR_VIEW_SPACE)}),void 0),(0,l.jsx)(te.P,{onClose:this.onCloseClicked},void 0)]}),void 0),this.renderHeadsetHeader(),(0,l.jsx)("div",Object.assign({className:"modal-body"},{children:this.renderBodyText()}),void 0),(0,l.jsx)("div",Object.assign({className:"modal-footer"},{children:this.getFooterButtons()}),void 0)]}),void 0)}async updatePlatformState(){const e=await(0,vo.pl)();this.isUnmounting||(this.setState({vrPlatform:e}),Eo.debug(this.state))}trackEvent(e,t){let i={gui_action:e};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};To.contextType=m.I,To=So([I.Z],To);const wo=To;class CtaSmall extends r.Component{render(){const{isMobile:e}=this.props,{locale:t}=this.context;return(0,l.jsx)("div",Object.assign({className:"cta"},{children:(0,l.jsx)("h1",Object.assign({className:d()({mobile:e})},{children:t.t(e?f.Z.MOBILE_SHORT_CTA:f.Z.DESKTOP_SHORT_CTA)}),void 0)}),void 0)}}CtaSmall.contextType=m.I;const xo={mouse:{click:i(41891),clickInside:i(70626),dragLeft:i(73993),dragRight:i(26668),play:i(31891),positionLeft:i(82906),positionRight:i(64991),zoom:i(12136)},gesture:{drag:i(72145),dragTwoFinger:i(12742),pinch:i(5435),position:i(67649),positionTwoFinger:i(2433),tap:i(24367),tapInside:i(90619),play:i(94874)},keyboard:{all:i(76064),inside:i(64549),leftRight:i(81202),spaceBar:i(71002),upDown:i(42135),zoom:i(26407)},moreHelp:{view360:i(86533),mattertag:i(14653)}},{HELP:_o}=f.Z.SHOWCASE;class CtaDesktop extends r.Component{constructor(){super(...arguments),this.keys={header:f.Z.DESKTOP_SHORT_CTA,move:f.Z.MOVE,inside:f.Z.INSIDE,rotate:f.Z.ROTATE,play:f.Z.PLAY,zoom:f.Z.ZOOM},this.clickInside={Icon:xo.mouse.clickInside,Label:this.keys.inside,FooterIcon:xo.keyboard.inside,Alt:_o.ALT_MOUSE_CLICKINSIDE,FooterAlt:_o.ALT_KEYBOARD_INSIDE},this.clickMove={Icon:xo.mouse.positionRight,Label:this.keys.move,FooterIcon:"",Alt:_o.ALT_MOUSE_POSITIONRIGHT},this.moveUpDown={Icon:xo.mouse.click,Label:this.keys.move,FooterIcon:xo.keyboard.upDown,Alt:_o.ALT_MOUSE_CLICK,FooterAlt:_o.ALT_KEYBOARD_UPDOWN},this.play={Icon:xo.mouse.play,Label:this.keys.play,FooterIcon:null,Alt:_o.ALT_MOUSE_PLAY},this.zoom={Icon:xo.mouse.zoom,Label:this.keys.zoom,FooterIcon:xo.keyboard.zoom,Alt:_o.ALT_MOUSE_ZOOM,FooterAlt:_o.ALT_KEYBOARD_ZOOM},this.dragMove={Icon:xo.mouse.positionLeft,Label:this.keys.move,FooterIcon:null,Alt:_o.ALT_MOUSE_POSITIONLEFT},this.dragRotateLeft={Icon:xo.mouse.dragLeft,Label:this.keys.rotate,FooterIcon:xo.keyboard.leftRight,Alt:_o.ALT_MOUSE_DRAGLEFT,FooterAlt:_o.ALT_KEYBOARD_LEFTRIGHT},this.dragRotateRight={Icon:xo.mouse.dragRight,Label:this.keys.rotate,FooterIcon:xo.keyboard.leftRight,Alt:_o.ALT_MOUSE_DRAGRIGHT,FooterAlt:_o.ALT_KEYBOARD_LEFTRIGHT},this.left=this.clickInside,this.center=this.clickMove,this.right=this.play}render(){const{viewmode:e}=this.props,{locale:t}=this.context;return this.configureViewmodeSpecifics(e),(0,l.jsxs)("div",Object.assign({className:d()({cta:!0})},{children:[(0,l.jsx)("h1",{children:t.t(this.keys.header)},void 0),(0,l.jsx)("h2",{children:t.t(this.left.Label)},void 0),(0,l.jsx)("img",{src:this.left.Icon,alt:this.left.Alt},void 0),this.left.FooterIcon?(0,l.jsx)("hr",{},void 0):(0,l.jsx)("span",{},void 0),this.left.FooterIcon?(0,l.jsx)("img",{className:"footer-icon",src:this.left.FooterIcon,alt:this.left.FooterAlt},void 0):(0,l.jsx)("span",{},void 0),(0,l.jsx)("h2",{children:t.t(this.center.Label)},void 0),(0,l.jsx)("img",{src:this.center.Icon,alt:this.center.Alt},void 0),this.center.FooterIcon?(0,l.jsx)("hr",{},void 0):(0,l.jsx)("span",{},void 0),this.center.FooterIcon?(0,l.jsx)("img",{className:"footer-icon",src:this.center.FooterIcon,alt:this.center.FooterAlt},void 0):(0,l.jsx)("span",{},void 0),(0,l.jsx)("h2",{children:t.t(this.right.Label)},void 0),(0,l.jsx)("img",{src:this.right.Icon,alt:this.right.Alt},void 0),this.right.FooterIcon?(0,l.jsx)("hr",{},void 0):(0,l.jsx)("span",{},void 0),this.right.FooterIcon?(0,l.jsx)("img",{className:"footer-icon",src:this.right.FooterIcon,alt:this.right.FooterAlt},void 0):(0,l.jsx)("span",{},void 0)]}),void 0)}configureViewmodeSpecifics(e){switch(e){case y.BD.INSIDE:this.left=this.dragRotateLeft,this.center=this.moveUpDown,this.right=this.props.isHelpCta?this.zoom:this.play;break;case y.BD.OUTSIDE:case y.BD.DOLLHOUSE:this.left=this.dragRotateLeft,this.center=this.clickMove,this.right=this.clickInside;break;case y.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.dragRotateRight,this.right=this.clickInside}}}CtaDesktop.contextType=m.I;const{HELP:Mo}=f.Z.SHOWCASE;class CtaMobile extends r.Component{constructor(){super(...arguments),this.keys={shortCta:f.Z.MOBILE_SHORT_CTA,move:f.Z.MOVE,inside:f.Z.INSIDE,rotate:f.Z.ROTATE,play:f.Z.PLAY,zoom:f.Z.ZOOM},this.clickInside={Icon:xo.gesture.tapInside,Label:this.keys.inside,Alt:Mo.ALT_GESTURE_TAPINSIDE},this.clickMove={Icon:xo.gesture.tap,Label:this.keys.move,Alt:Mo.ALT_GESTURE_TAP},this.dragRotate={Icon:xo.gesture.drag,Label:this.keys.rotate,Alt:Mo.ALT_GESTURE_DRAG},this.dragMove={Icon:xo.gesture.position,Label:this.keys.move,Alt:Mo.ALT_GESTURE_POSITION},this.play={Icon:xo.gesture.play,Label:this.keys.play,Alt:Mo.ALT_GESTURE_PLAY},this.zoom={Icon:xo.gesture.pinch,Label:this.keys.zoom,Alt:Mo.ALT_GESTURE_PINCH},this.left=this.dragRotate,this.center=this.clickInside,this.right=this.play}render(){const e=d()({mobile:!0}),{viewmode:t}=this.props,{locale:i}=this.context;return this.configureViewmodeSpecifics(t),(0,l.jsxs)("div",Object.assign({className:d()({cta:!0,mobile:!0})},{children:[(0,l.jsx)("h1",Object.assign({className:e},{children:i.t(this.keys.shortCta)}),void 0),(0,l.jsx)("h2",Object.assign({className:e},{children:i.t(this.left.Label)}),void 0),(0,l.jsx)("img",{src:this.left.Icon},void 0),(0,l.jsx)("h2",Object.assign({className:e},{children:i.t(this.center.Label)}),void 0),(0,l.jsx)("img",{src:this.center.Icon},void 0),(0,l.jsx)("h2",Object.assign({className:e},{children:i.t(this.right.Label)}),void 0),(0,l.jsx)("img",{src:this.right.Icon},void 0)]}),void 0)}configureViewmodeSpecifics(e){switch(e){case y.BD.INSIDE:this.left=this.dragRotate,this.center=this.clickMove,this.right=this.props.isHelpCta?this.zoom:this.play;break;case y.BD.DOLLHOUSE:case y.BD.OUTSIDE:this.left=this.dragRotate,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play;break;case y.BD.FLOORPLAN:this.left=this.dragMove,this.center=this.clickInside,this.right=this.props.isHelpCta?this.zoom:this.play}}}CtaMobile.contextType=m.I;var Oo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Ao=new S.Z("cta");var Co,Po;!function(e){e[e.NONE=0]="NONE",e[e.LARGE=1]="LARGE",e[e.SMALL=2]="SMALL"}(Co||(Co={})),function(e){e[e.HELP=0]="HELP",e[e.TOUR=1]="TOUR"}(Po||(Po={}));let Do=class Cta extends r.Component{constructor(e){super(e),this.styles=[Co.NONE],this.bindings=[],this.handleInteraction=()=>{this.props.showCta&&(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.CTA,!1)))},this.onTourStopped=()=>{this.state.ctaSource!==Po.TOUR||this.state.seenCta||(this.setState({seenCta:!0}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.CTA,!0)))},this.onTourStarted=()=>{this.state.ctaSource===Po.HELP&&2===this.styles.length&&this.setState({ctaSource:Po.TOUR,seenCta:!1,style:this.styles[1]}),this.props.showCta&&this.context.commandBinder.issueCommand(new we.Bz(Te.P.CTA,!1))},this.state={ctaSource:Po.TOUR,seenCta:!1,style:this.styles[0]}}componentDidMount(){const{canvas:e}=this.props,{messageBus:t,settings:i}=this.context;try{e&&(e.addEventListener("mousedown",this.handleInteraction),e.addEventListener("pointerdown",this.handleInteraction),e.addEventListener("touchstart",this.handleInteraction)),this.bindings.push(t.subscribe(po.NR,this.onTourStopped),t.subscribe(po.Mt,this.onTourStopped),t.subscribe(po.oR,this.onTourStarted))}catch(e){Ao.debug(e)}let n=this.state.ctaSource;const s=parseInt(i.tryGetProperty("tourcta",1),10);!isNaN(s)&&s in Co&&(this.styles[0]=s,n=Po.TOUR);const r=i.tryGetProperty("help",0);!isNaN(r)&&r in Co&&r!==Co.NONE&&(this.styles[0]===Co.NONE?this.styles[0]=r:this.styles.unshift(r),n=Po.HELP),this.styles[0]!==Co.NONE&&this.setState({style:this.styles[0],ctaSource:n})}componentWillUnmount(){const{canvas:e}=this.props;e&&(e.removeEventListener("mousedown",this.handleInteraction),e.removeEventListener("pointerdown",this.handleInteraction),e.removeEventListener("touchstart",this.handleInteraction)),this.bindings.forEach((e=>e.cancel()))}renderCtaStyle(){const{isMobile:e,viewmode:t}=this.props,{style:i,ctaSource:n}=this.state;switch(i){case Co.NONE:return null;case Co.SMALL:return(0,l.jsx)(CtaSmall,{isMobile:e},void 0);case Co.LARGE:return e?(0,l.jsx)(CtaMobile,{isMobile:e,viewmode:t,isHelpCta:n===Po.HELP},void 0):(0,l.jsx)(CtaDesktop,{viewmode:t,isHelpCta:n===Po.HELP},void 0)}}render(){const{showCta:e,isMobile:t}=this.props,{style:i,ctaSource:n}=this.state,s={ctaContainer:!0,mobile:t,showMessage:e,small:i===Co.SMALL,helpCta:n===Po.HELP};return(0,l.jsx)("div",Object.assign({id:"cta-container",className:d()(s)},{children:this.renderCtaStyle()}),void 0)}};Do.contextType=m.I,Do=Oo([I.Z],Do);const No=Do;var Io,Lo,Ro,ko,Uo,Bo;!function(e){e[e.navigation=0]="navigation",e[e.moreHelp=1]="moreHelp"}(Io||(Io={})),function(e){e.left="left",e.middle="middle",e.right="right"}(Lo||(Lo={})),function(e){e.topInfo="topInfo",e.bigImage="bigImage",e.bottomInfo="bottomInfo",e.keyboard="keyboard"}(Ro||(Ro={})),function(e){e.desktop="desktop",e.mobile="mobile"}(ko||(ko={})),function(e){e.hlr="hlr",e.dollhouse="dollhouse",e.floors="floors",e.mattertag="mattertag",e.floorplan="floorplan",e.tour="tour",e.inside="inside",e.vr="vr",e.view360="view360",e.fullscreen="fullscreen"}(Uo||(Uo={})),function(e){e.landscape="landscape",e.portrait="portrait"}(Bo||(Bo={}));const{HELP:Fo}=f.Z.SHOWCASE,Vo={[ko.desktop]:{[Lo.left]:{[Ro.topInfo]:"HELP_DESKTOP_PANORAMA_1A",[Ro.bottomInfo]:"HELP_DESKTOP_PANORAMA_1B",[Ro.bigImage]:{img:xo.mouse.dragLeft,alt:Fo.ALT_MOUSE_DRAGLEFT},[Ro.keyboard]:{img:xo.keyboard.leftRight,alt:Fo.ALT_KEYBOARD_LEFTRIGHT}},[Lo.middle]:{[Ro.topInfo]:"HELP_DESKTOP_PANORAMA_2A",[Ro.bottomInfo]:"HELP_DESKTOP_PANORAMA_2B",[Ro.bigImage]:{img:xo.mouse.click,alt:Fo.ALT_MOUSE_CLICK},[Ro.keyboard]:{img:xo.keyboard.upDown,alt:Fo.ALT_KEYBOARD_UPDOWN}},[Lo.right]:{[Ro.topInfo]:"HELP_DESKTOP_PANORAMA_3A",[Ro.bottomInfo]:"HELP_DESKTOP_PANORAMA_3B",[Ro.bigImage]:{img:xo.mouse.zoom,alt:Fo.ALT_MOUSE_ZOOM},[Ro.keyboard]:{img:xo.keyboard.zoom,alt:Fo.ALT_KEYBOARD_ZOOM}}},[ko.mobile]:{[Lo.left]:{[Ro.topInfo]:"HELP_MOBILE_PANORAMA_1",[Ro.bigImage]:{img:xo.gesture.drag,alt:Fo.ALT_GESTURE_DRAG}},[Lo.middle]:{[Ro.topInfo]:"HELP_MOBILE_PANORAMA_2",[Ro.bigImage]:{img:xo.gesture.tap,alt:Fo.ALT_GESTURE_TAP}},[Lo.right]:{[Ro.topInfo]:"HELP_MOBILE_3",[Ro.bigImage]:{img:xo.gesture.pinch,alt:Fo.ALT_GESTURE_PINCH}}}},Ho={[ko.desktop]:{[Lo.left]:{[Ro.topInfo]:"HELP_DESKTOP_DOLLHOUSE_1A",[Ro.bottomInfo]:"HELP_DESKTOP_DOLLHOUSE_1B",[Ro.bigImage]:{img:xo.mouse.dragLeft,alt:Fo.ALT_MOUSE_DRAGLEFT},[Ro.keyboard]:{img:xo.keyboard.all,alt:Fo.ALT_KEYBOARD_ALL}},[Lo.middle]:{[Ro.topInfo]:"HELP_DESKTOP_DOLLHOUSE_2A",[Ro.bigImage]:{img:xo.mouse.positionRight,alt:Fo.ALT_MOUSE_POSITIONRIGHT}},[Lo.right]:{[Ro.topInfo]:"HELP_DESKTOP_DOLLHOUSE_3A",[Ro.bigImage]:{img:xo.mouse.zoom,alt:Fo.ALT_MOUSE_ZOOM}}},[ko.mobile]:{[Lo.left]:{[Ro.topInfo]:"HELP_MOBILE_DOLLHOUSE_1",[Ro.bigImage]:{img:xo.gesture.drag,alt:Fo.ALT_GESTURE_DRAG}},[Lo.middle]:{[Ro.topInfo]:"HELP_MOBILE_DOLLHOUSE_2",[Ro.bigImage]:{img:xo.gesture.positionTwoFinger,alt:Fo.ALT_GESTURE_POSITIONTWOFINGER}},[Lo.right]:{[Ro.topInfo]:"HELP_MOBILE_3",[Ro.bigImage]:{img:xo.gesture.pinch,alt:Fo.ALT_GESTURE_PINCH}}}},jo={[ko.desktop]:{[Lo.left]:{[Ro.topInfo]:"HELP_DESKTOP_FLOORPLAN_1A",[Ro.bigImage]:{img:xo.mouse.positionLeft,alt:Fo.ALT_MOUSE_POSITIONLEFT}},[Lo.middle]:{[Ro.topInfo]:"HELP_DESKTOP_FLOORPLAN_2A",[Ro.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_2B",[Ro.bigImage]:{img:xo.mouse.dragRight,alt:Fo.ALT_MOUSE_DRAGRIGHT},[Ro.keyboard]:{img:xo.keyboard.leftRight,alt:Fo.ALT_KEYBOARD_LEFTRIGHT}},[Lo.right]:{[Ro.topInfo]:"HELP_DESKTOP_FLOORPLAN_3A",[Ro.bottomInfo]:"HELP_DESKTOP_FLOORPLAN_3B",[Ro.bigImage]:{img:xo.mouse.zoom,alt:Fo.ALT_MOUSE_ZOOM},[Ro.keyboard]:{img:xo.keyboard.upDown,alt:Fo.ALT_KEYBOARD_UPDOWN}}},[ko.mobile]:{[Lo.left]:{[Ro.topInfo]:"HELP_MOBILE_FLOORPLAN_1",[Ro.bigImage]:{img:xo.gesture.position,alt:Fo.ALT_GESTURE_POSITION}},[Lo.middle]:{[Ro.topInfo]:"HELP_MOBILE_FLOORPLAN_2",[Ro.bigImage]:{img:xo.gesture.dragTwoFinger,alt:Fo.ALT_GESTURE_DRAGTWOFINGER}},[Lo.right]:{[Ro.topInfo]:"HELP_MOBILE_3",[Ro.bigImage]:{img:xo.gesture.pinch,alt:Fo.ALT_GESTURE_PINCH}}}},Go=JSON.parse(JSON.stringify(Vo));Go.desktop.middle={[Ro.topInfo]:"HELP_DESKTOP_360_2A",[Ro.bottomInfo]:"HELP_DESKTOP_360_2B",[Ro.bigImage]:{img:xo.mouse.clickInside,alt:Fo.ALT_MOUSE_CLICKINSIDE},[Ro.keyboard]:{img:xo.keyboard.inside,alt:Fo.ALT_KEYBOARD_INSIDE}},Go.mobile.middle={[Ro.topInfo]:"HELP_MOBILE_360_2",[Ro.bigImage]:{img:xo.gesture.tapInside,alt:Fo.ALT_GESTURE_TAPINSIDE}};const zo={INSIDE:Vo,OUTSIDE:Go,FLOORPLAN:jo,DOLLHOUSE:Ho};var Wo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ko=class NavigationTab extends r.Component{constructor(e){super(e),this.state={overflow:!1}}UNSAFE_componentWillReceiveProps(e){(this.navigationDiv&&this.navigationDiv.clientHeight||0)/(this.navigationDiv.parentElement&&this.navigationDiv.parentElement.clientHeight||1)>.7&&this.setState({overflow:!0})}getAssetObj(e){switch(e){case this.props.Modes.DOLLHOUSE:return zo.DOLLHOUSE[this.props.device];case this.props.Modes.FLOORPLAN:return zo.FLOORPLAN[this.props.device];case this.props.Modes.OUTSIDE:return zo.OUTSIDE[this.props.device];case this.props.Modes.INSIDE:default:return zo.INSIDE[this.props.device]}}buildRows(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in Ro){const n=[],s=[];for(const t in Lo)if(n.push(this.wrapAsset(e,t,i,!1)),i===Ro.bigImage){const n=!e[t][Ro.bottomInfo];s.push((0,l.jsx)("div",Object.assign({className:d()(t,"column",{noDivider:n})},{children:(0,l.jsx)("hr",{},void 0)}),`${i}_${t}_divider_row`))}t.push((0,l.jsx)("div",Object.assign({className:d()(i,"row")},{children:n}),`${i}_vertical_row`))}return t}buildMobilePortrait(){const e=this.getAssetObj(this.props.viewmode),t=[];for(const i in e)for(const n in e[i])t.push(this.wrapAsset(e,i,n,!0));return t}wrapAsset(e,t,i,n){const s=e[t][i],r=i===Ro.bigImage||i===Ro.keyboard,o=s?s.img:void 0,a=s&&s.alt?this.context.locale.t(s.alt):void 0,c=(0,l.jsx)("img",{src:o,alt:a},void 0);return(0,l.jsx)("div",Object.assign({className:n?d()(i,"row"):d()(t,"column")},{children:s&&r?c:s&&this.context.locale.t(s)}),`wrapped_asset_${t}_${i}`)}render(){const e=this.props.device===ko.mobile&&this.props.orientation===$.i5.PORTRAIT,t=d()({navigation:!0,small:this.state.overflow,[this.props.viewmode]:!0});return(0,l.jsx)("div",Object.assign({className:t,ref:e=>{this.navigationDiv=e}},{children:e?(0,l.jsx)(Scrollbars,Object.assign({name:"navigation",forceHidden:!1},{children:(0,l.jsx)("div",Object.assign({className:"nav-wrapper"},{children:this.buildMobilePortrait()}),void 0)}),void 0):this.buildRows()}),void 0)}};Ko.contextType=m.I,Ko=Wo([I.Z],Ko);const Yo=Ko,qo={[Uo.hlr]:{[Ro.topInfo]:"HELP_MORE_HLR_A",[Ro.bigImage]:"icon-hlr",[Ro.bottomInfo]:"HELP_DESKTOP_MORE_HLR_B"},[Uo.dollhouse]:{[Ro.topInfo]:"HELP_MORE_DOLLHOUSE_A",[Ro.bigImage]:"icon-dollhouse",[Ro.bottomInfo]:"HELP_MOBILE_MORE_DOLLHOUSE_B"},[Uo.floors]:{[Ro.topInfo]:"HELP_MORE_FLOORS_A",[Ro.bigImage]:"icon-floor-controls",[Ro.bottomInfo]:"HELP_DESKTOP_MORE_FLOORS_B"},[Uo.mattertag]:{[Ro.topInfo]:"HELP_MORE_MATTERTAG_A",[Ro.bigImage]:xo.moreHelp.mattertag,[Ro.bottomInfo]:"HELP_MOBILE_MORE_MATTERTAG_B"},[Uo.tour]:{[Ro.topInfo]:"HELP_MORE_TOUR_A",[Ro.bigImage]:"icon-play",[Ro.bottomInfo]:"HELP_DESKTOP_MORE_TOUR_B"},[Uo.inside]:{[Ro.topInfo]:"HELP_MORE_INSIDE_A",[Ro.bigImage]:"icon-panorama",[Ro.bottomInfo]:"HELP_MOBILE_MORE_INSIDE_B"},[Uo.vr]:{[Ro.topInfo]:"HELP_MORE_VR_A",[Ro.bigImage]:"icon-vr",[Ro.bottomInfo]:"HELP_MOBILE_MORE_VR_B"},[Uo.view360]:{[Ro.topInfo]:"HELP_MORE_360_A",[Ro.bigImage]:xo.moreHelp.view360,[Ro.bottomInfo]:"HELP_MOBILE_MORE_360_B"},[Uo.floorplan]:{[Ro.topInfo]:"HELP_MORE_FLOORPLAN_A",[Ro.bigImage]:"icon-floorplan",[Ro.bottomInfo]:"HELP_MOBILE_FLOORPLAN_B"}},Zo=JSON.parse(JSON.stringify(qo));Zo[Uo.fullscreen]={[Ro.topInfo]:"HELP_MORE_FULLSCREEN_A",[Ro.bigImage]:"icon-fullscreen",[Ro.bottomInfo]:"HELP_DESKTOP_MORE_FULLSCREEN_B"},Zo[Uo.dollhouse][Ro.bottomInfo]="HELP_DESKTOP_MORE_DOLLHOUSE_B",Zo[Uo.mattertag][Ro.bottomInfo]="HELP_DESKTOP_MORE_MATTERTAG_B",Zo[Uo.inside][Ro.bottomInfo]="HELP_DESKTOP_MORE_INSIDE_B",Zo[Uo.vr][Ro.bottomInfo]="HELP_DESKTOP_MORE_VR_B",Zo[Uo.view360][Ro.bottomInfo]="HELP_DESKTOP_MORE_360_B",Zo[Uo.floorplan][Ro.bottomInfo]="HELP_DESKTOP_FLOORPLAN_B";const $o={[ko.desktop]:Zo,[ko.mobile]:qo},Qo=[Ro.topInfo,Ro.bigImage,Ro.bottomInfo];class MoreHelpTab extends r.Component{constructor(e){super(e),this.scrollbarsRef=(0,r.createRef)()}componentDidMount(){const e=this.scrollbarsRef.current;e&&e.scrollTo({x:0,y:0})}buildInstructions(){const e=[],t=this.props.device===ko.desktop?5:this.props.orientation===$.i5.LANDSCAPE?3:2,i=Object.keys($o[this.props.device]);for(let n=0;n<i.length;n+=t){for(const s of Qo){const r=[];for(let e=0;e<t;e++){if(n+e>=i.length)continue;const t=$o[this.props.device][i[n+e]][s],o=d()(s,i[n+e],{noAsset:!t}),a=`${n}_${s}_${e}`;switch(s){case Ro.topInfo:r.push((0,l.jsx)("div",Object.assign({className:o},{children:this.context.locale.t(t)}),`${a}_top_info`));break;case Ro.bigImage:r.push((0,l.jsx)("div",Object.assign({className:o},{children:t.indexOf(".png")>-1?(0,l.jsx)("img",{src:t},void 0):(0,l.jsx)("span",Object.assign({className:t},{children:"floors"===i[n+e]?(0,l.jsx)("span",{children:"2"},void 0):null}),void 0)}),`${a}_big_img`));break;case Ro.bottomInfo:r.push((0,l.jsx)("div",Object.assign({className:o},{children:this.context.locale.t(t)}),`${a}_bottom_info`))}}e.push((0,l.jsx)("div",Object.assign({className:d()("innerRow",s)},{children:r}),`${n}_${s}_top_info`))}e.push((0,l.jsx)("div",{className:"rowPadding"},`${n}_row_padding`))}return e.pop(),e}render(){return(0,l.jsx)("div",Object.assign({className:d()("more-help-wrapper",this.props.device)},{children:(0,l.jsx)(Scrollbars,Object.assign({name:"more-help-wrapper",ref:this.scrollbarsRef,forceHidden:!1},{children:(0,l.jsx)("div",Object.assign({className:d()("more-help")},{children:this.buildInstructions()}),void 0)}),void 0)}),void 0)}}MoreHelpTab.contextType=m.I;var Xo=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Jo=class Help extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.setOrientation=e=>{const{orientation:t}=e;this.setState({orientation:t})},this.handleTabClick=e=>()=>{this.setState({tab:e})},this.closeHelp=()=>{this.setState({showing:!1}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.device=this.props.isMobile?ko.mobile:ko.desktop,this.state={showing:!1,tab:Io.navigation,orientation:(0,$.T8)().orientation},this.orientationSubscription=(0,$.kp)($.g_.ORIENTATION_CHANGED,this.setOrientation)}componentDidMount(){this.orientationSubscription.renew(),window.requestAnimationFrame((()=>{this.isUnmounting||this.setState({showing:!0})}))}componentWillUnmount(){this.isUnmounting=!0,this.orientationSubscription.cancel()}render(){const{showing:e,tab:t,orientation:i}=this.state;return(0,l.jsxs)("div",Object.assign({id:"help-modal",className:d()(this.device,{"faded-in":e}),onClick:this.stopPropagation},{children:[(0,l.jsxs)("div",Object.assign({className:d()("tabs",t)},{children:[(0,l.jsx)("div",Object.assign({className:d()("navigation-tab",{active:t===Io.navigation}),onClick:this.handleTabClick(Io.navigation)},{children:(0,l.jsx)("span",{children:this.context.locale.t(f.Z.HELP_NAVIGATION_TAB)},void 0)}),void 0),(0,l.jsx)("div",Object.assign({className:d()("more-help-tab",{active:t===Io.moreHelp}),onClick:this.handleTabClick(Io.moreHelp)},{children:(0,l.jsx)("span",{children:this.context.locale.t(f.Z.HELP_MORE_HELP_TAB)},void 0)}),void 0)]}),void 0),t===Io.navigation&&(0,l.jsx)(Yo,{device:this.device,Modes:this.props.allModes,viewmode:this.props.viewmode,orientation:i},void 0),t===Io.moreHelp&&(0,l.jsx)(MoreHelpTab,{device:this.device,orientation:i},void 0),(0,l.jsx)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.closeHelp},void 0)]}),void 0)}};Jo.contextType=m.I,Jo=Xo([I.Z],Jo);const ea=Jo;var ta,ia=i(8445);!function(e){e.MAIL="mail",e.PINTEREST="pinterest",e.LINKEDIN="linkedin",e.TWITTER="twitter",e.FACEBOOK="facebook",e.COPYLINK="copylink",e.NATIVE="native"}(ta||(ta={}));const{FACEBOOK:na,TWITTER:sa,MAIL:ra,PINTEREST:oa,LINKEDIN:aa,COPYLINK:la,NATIVE:ca}=ta,da={[ra]:"em",[oa]:"pn",[aa]:"ln",[sa]:"tw",[na]:"fb",[la]:"cp",[ca]:"os"},ha={[na]:{width:626,height:436},[sa]:{width:550,height:440},[oa]:{width:750,height:749},[aa]:{width:550,height:453},[la]:{},[ra]:{},[ca]:{}},ua=async(e,t=!0)=>{let i;const n=await e.engine.getModuleBySymbol(Li.y.DEEP_LINKS),s=["ref","gclid","fbclid","cloudEdit","back","note","comment","apiHost","applicationKey","host","sdkKey","tag"],r=e=>!s.includes(e);return i=t?n.creator.createDeepLink({paramFilter:r}):n.creator.createLink({paramFilter:r}),i.searchParams.forEach(((e,t)=>{(s.includes(t)||0===t.indexOf("utm_"))&&i.searchParams.delete(t)})),decodeURIComponent(i.href)},pa=e=>new URLSearchParams(e).toString(),ma=(e,t,i)=>{const n=e.replace("?",`?ref=${da[na]}&`);return`http://www.facebook.com/sharer.php?${pa({display:"popup",u:n})}`},fa=(e,t,i)=>{const n=e.replace("?",`?ref=${da[sa]}&`),s={text:i.t(f.Z.SHARED_MESSAGE_HASHTAG,{title:t,url:n,hashtag:"#Matterport"})};return`http://twitter.com/intent/tweet?${pa(s)}`},ga=(e,t,i)=>{const n=e.replace("?",`?ref=${da[ra]}&`),s={subject:i.t(f.Z.SHARED_TITLE,{title:t}),body:i.t(f.Z.SHARED_MESSAGE,{title:t,url:n})};return`mailto:?${pa(s)}`},va=(e,t,i,n)=>{const s={url:e.replace("?",`?ref=${da[oa]}&`),media:i,description:n.t(f.Z.SHARED_TITLE,{title:t})};return`http://pinterest.com/pin/create/link/?${pa(s)}`},ya=(e,t,i)=>{const n=e.replace("?",`?ref=${da[aa]}&`);return`https://www.linkedin.com/shareArticle?${pa({mini:"true",url:n})}`},ba=(e,t,i,n)=>({[na]:ma(e),[sa]:fa(e,t,n),[ra]:ga(e,t,n),[oa]:va(e,t,i,n),[aa]:ya(e),[la]:e,[ca]:e});var Sa=i(75892);const Ea=new S.Z("share-modal");class ShareModal extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.copyURL=()=>{const{deeplink:e}=this.state;this.urlInputRef.select(),document.execCommand("copy"),window.getSelection().removeAllRanges(),this.urlInputRef.blur(),this.setState({copied:!0}),this.context.analytics.track("showcase_share_action",{channel:ta.COPYLINK,pano_id:this.sweepData.currentSweep,deeplink:e}),window.setTimeout((()=>{this.setState({copied:!1})}),2500)},this.toggleDeeplinks=()=>{const{deeplink:e}=this.state;this.setState({deeplink:!e})},this.close=()=>{this.context.commandBinder.issueCommand(new we.Bz(Te.P.SHARE,!1))},this.openShareWindow=e=>{const{urls:t,deeplink:i,deeplinkUrls:n}=this.state,{width:s,height:r}=ha[e],o=i?n[e]:t[e];let a;if(s&&r){a="top="+(window.screenY+(window.innerHeight-r)/2)+",left="+(window.screenX+(window.innerWidth-s)/2)+",width="+s+",height="+r}this.context.analytics.track("showcase_share_action",{channel:e,pano_id:this.sweepData.currentSweep,deeplink:i}),window.open(o,"",a)},this.openWebShareApi=e=>{if(!navigator.share)return;const{excerpt:t,title:i,urls:n,deeplinkUrls:s}=this.state,r={url:e?s[ta.COPYLINK]:n[ta.COPYLINK],text:t,title:i};Ea.debug("Launching Web Share API",r),navigator.share(r),this.context.analytics.track("showcase_share_action",{channel:ta.NATIVE,pano_id:this.sweepData.currentSweep,deeplink:e})},this.onWebShareClick=()=>{this.openWebShareApi(!1)},this.onWebShareDeeplinkClick=()=>{this.openWebShareApi(!0)},this.stopPropagation=e=>e.stopPropagation(),this.setUrlInputRef=e=>{this.urlInputRef=e},this.state={urls:{},deeplinkUrls:{},title:"",excerpt:"",image:"",copied:!1,deeplink:!1,webShareEnabled:(0,E.J1)()},this.openFacebook=this.openShareWindow.bind(this,ta.FACEBOOK),this.openTwitter=this.openShareWindow.bind(this,ta.TWITTER),this.openPinterest=this.openShareWindow.bind(this,ta.PINTEREST),this.openLinkedIn=this.openShareWindow.bind(this,ta.LINKEDIN),this.openEmail=this.openShareWindow.bind(this,ta.MAIL)}async componentDidMount(){const{market:e}=this.context,[t,i]=await Promise.all([e.waitForData(ia.T),e.waitForData(Sa.Z)]);this.sweepData=i;const n=t.model,s=`${window.location.origin}/api/v1/player/models/${n.sid}/thumb`,r=n.details.name;this.isUnmounting||this.setState({title:r,image:s},this.updateUrls)}componentWillUnmount(){this.isUnmounting=!0}async updateUrls(){const{title:e,image:t}=this.state,[i,n]=await Promise.all([ua(this.context,!1),ua(this.context,!0)]),s=ba(i,e,t,this.context.locale),r=ba(n,e,t,this.context.locale);Ea.debug("Social Share URLs:",s),Ea.debug("Social Share URLs, with current location",r),this.isUnmounting||this.setState({urls:s,deeplinkUrls:r})}renderWebShareDialog(){return(0,l.jsxs)("div",Object.assign({className:"share-controls"},{children:[(0,l.jsx)(w.zx,Object.assign({className:"share-modal-button",buttonStyle:w.ZJ.PRIMARY,onClick:this.onWebShareDeeplinkClick},{children:this.context.locale.t(f.Z.SHARE_CURRENT_LOCATION)}),void 0),(0,l.jsx)(w.zx,Object.assign({className:"share-modal-button",buttonStyle:w.ZJ.OUTLINE,onClick:this.onWebShareClick},{children:this.context.locale.t(f.Z.SHARE_DEFAULT_LOCATION)}),void 0)]}),void 0)}renderShareDialog(){const{copied:e,deeplink:t,urls:i,deeplinkUrls:n}=this.state,s=t?n[ta.COPYLINK]:i[ta.COPYLINK],r=this.sweepData&&this.sweepData.isSweepDisabled(),o=r?this.context.locale.t(f.Z.SHARE_ERROR_SWEEP_DISABLED):void 0;return(0,l.jsxs)("div",Object.assign({className:"share-controls"},{children:[(0,l.jsxs)("div",Object.assign({className:"social-icons"},{children:[(0,l.jsx)(T.hU,{onClick:this.openFacebook,iconClass:"icon-facebook",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.LARGE},void 0),(0,l.jsx)(T.hU,{onClick:this.openTwitter,iconClass:"icon-twitter",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.LARGE},void 0),(0,l.jsx)(T.hU,{onClick:this.openLinkedIn,iconClass:"icon-linkedin",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.LARGE},void 0),(0,l.jsx)(T.hU,{onClick:this.openPinterest,iconClass:"icon-pinterest",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.LARGE},void 0),(0,l.jsx)(T.hU,{onClick:this.openEmail,iconClass:"icon-email",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.LARGE},void 0)]}),void 0),(0,l.jsxs)("div",Object.assign({className:"input-group"},{children:[(0,l.jsx)("input",{className:"input",type:"text",value:s||"",ref:this.setUrlInputRef,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,readOnly:!0},void 0),(0,l.jsx)(x.oO,Object.assign({content:e?this.context.locale.t(f.Z.SHARE_COPIED):this.context.locale.t(f.Z.COPY_URL),position:x.lZ.UP,tooltipTimeout:2e3},{children:(0,l.jsx)("button",Object.assign({className:"input-addon",onClick:this.copyURL},{children:this.context.locale.t(f.Z.COPY)}),void 0)}),void 0)]}),void 0),(0,l.jsx)(Xt,{dataValue:"deeplink",checked:t,enabled:!r,error:r,helpText:o,label:this.context.locale.t(f.Z.SHARE_LINK_TO_LOCATION),onChange:this.toggleDeeplinks},void 0)]}),void 0)}render(){const{webShareEnabled:e}=this.state,t=d()("modal","share-modal","modal-dialog",{"share-dialog":!e,"web-share-dialog":e}),i=e?this.renderWebShareDialog():this.renderShareDialog();return(0,l.jsxs)("dialog",Object.assign({open:!0,className:t,onClick:this.stopPropagation},{children:[(0,l.jsxs)("header",Object.assign({className:"modal-header"},{children:[(0,l.jsx)("div",Object.assign({className:"modal-title"},{children:this.context.locale.t(f.Z.SHARE_MODAL_TITLE)}),void 0),(0,l.jsx)(te.P,{onClose:this.close},void 0)]}),void 0),(0,l.jsx)("div",Object.assign({className:"modal-body"},{children:i}),void 0)]}),void 0)}}ShareModal.contextType=m.I;class MeasurementModeHelp extends r.Component{constructor(e,t){super(e),this.closeModal=()=>{this.context.commandBinder.issueCommand(new we.Bz(Te.P.MEASUREMENT_HELP,!1))},this.stopPropagation=e=>{e.stopPropagation()},this.locale={headerString:t.locale.t(f.Z.MEASUREMENT_MODE),subHeaderString:t.locale.t(f.Z.MEASUREMENT_HELP_MODAL_SUB_HEADER),body1String:t.locale.t(f.Z.MEASUREMENT_HELP_MODAL_BODY_1),body2String:t.locale.t(f.Z.MEASUREMENT_HELP_MODAL_BODY_2)}}render(){const{headerString:e,subHeaderString:t,body1String:i,body2String:n}=this.locale,{mobile:s}=this.props;return(0,l.jsxs)("div",Object.assign({className:d()("modal","full-modal","measurement-mode-help-modal",{mobile:s}),onClick:this.stopPropagation},{children:[(0,l.jsxs)("header",Object.assign({className:"modal-header"},{children:[(0,l.jsx)("div",Object.assign({className:"modal-title"},{children:e}),void 0),(0,l.jsx)(te.P,{onClose:this.closeModal},void 0)]}),void 0),(0,l.jsx)("div",Object.assign({className:"modal-subheader"},{children:t}),void 0),(0,l.jsxs)("div",Object.assign({className:"modal-body"},{children:[(0,l.jsx)("p",Object.assign({className:"modal-paragraph"},{children:i}),void 0),(0,l.jsx)("p",Object.assign({className:"modal-paragraph"},{children:n}),void 0)]}),void 0)]}),void 0)}}MeasurementModeHelp.contextType=m.I;const{NOTES:Ta}=f.Z.SHOWCASE;class NotesIntro extends r.Component{constructor(){super(...arguments),this.onClose=()=>{this.context.commandBinder.issueCommand(new we.Bz(Te.P.NOTES_INTRO,!1))},this.stopPropagation=e=>{e.stopPropagation()}}componentDidMount(){this.context.settings.setLocalStorageProperty(tt.F.NotesIntroModalSeen,!0)}renderHeader(){return(0,l.jsxs)("div",Object.assign({className:"notes-intro-header"},{children:[(0,l.jsxs)("div",{children:["Welcome to the ",(0,l.jsx)("div",Object.assign({className:"h4"},{children:"Notes Beta"}),void 0)]},void 0),(0,l.jsxs)("div",Object.assign({className:"note-badges"},{children:[(0,l.jsx)(nr,{badgeStyle:{backgroundColor:"#E993A7"},iconClass:"icon-comment"},void 0),(0,l.jsx)(nr,{badgeStyle:{backgroundColor:"#6140B0"},iconClass:"icon-comment"},void 0),(0,l.jsx)(nr,{badgeStyle:{backgroundColor:"#385DFF"},iconClass:"icon-comment"},void 0)]}),void 0)]}),void 0)}render(){const{locale:e}=this.context;return(0,l.jsxs)("dialog",Object.assign({className:"modal full-modal notes-intro open",onClick:this.stopPropagation,onPointerDown:this.stopPropagation,onPointerUp:this.stopPropagation},{children:[(0,l.jsxs)("header",Object.assign({className:"modal-header"},{children:[(0,l.jsx)("div",Object.assign({className:"modal-title"},{children:e.t(Ta.MODAL_TITLE)}),void 0),(0,l.jsx)(te.P,{onClose:this.onClose},void 0)]}),void 0),this.renderHeader(),(0,l.jsx)("div",Object.assign({className:"modal-body"},{children:(0,l.jsx)("div",Object.assign({className:"modal-content"},{children:e.t(Ta.MODAL_COPY)}),void 0)}),void 0),(0,l.jsx)("div",Object.assign({className:"modal-footer"},{children:(0,l.jsx)("div",Object.assign({className:"modal-buttons"},{children:(0,l.jsx)(w.zx,Object.assign({buttonSize:w.qE.LARGE,onClick:this.onClose},{children:e.t(Ta.MODAL_CTA)}),void 0)}),void 0)}),void 0)]}),void 0)}}NotesIntro.contextType=m.I;class Link extends r.Component{render(){const{className:e,href:t,children:i,onClick:n}=this.props;return(0,l.jsx)("a",Object.assign({className:d()("link",{className:e}),href:t,target:"_blank",onClick:n},{children:i}),void 0)}}var wa;!function(e){e.HandsRaised="hands-raised"}(wa||(wa={}));const xa=new Map;xa.set(wa.HandsRaised,{alt:"Hands Raised",json:i(22016),fallback:i(63064)});var _a=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ma=class Lottie extends r.Component{constructor(e){super(e),this.lottieTargetRef=(0,r.createRef)(),this.isUnmounting=!1,this.loadLottie=async()=>this.lottieLib?this.lottieLib:await i.e(932).then(i.t.bind(i,11248,23)),this.updateAnimation=async()=>{const{animation:e,loop:t=!1}=this.props;let i;this.setState({fallbackActive:!1});try{i=await this.loadLottie()}catch(e){if(this.isUnmounting)return;return void this.setState({fallbackActive:!0})}const n=xa.get(e);if(i&&n&&this.lottieTargetRef.current){const e=i.loadAnimation({loop:t,container:this.lottieTargetRef.current,renderer:"svg",autoplay:!1,animationData:n.json});e.addEventListener("data_failed",(()=>{this.isUnmounting||this.setState({fallbackActive:!0})})),setTimeout((()=>{this.isUnmounting||e.play()}),50)}},this.renderFallback=()=>{const{animation:e}=this.props,t=xa.get(e);return t?(0,l.jsx)("img",{className:"lottie-fallback",src:t.fallback,alt:t.alt},void 0):null},this.state={fallbackActive:!1}}componentDidMount(){this.updateAnimation()}componentDidUpdate(e){e.animation===this.props.animation&&e.loop===this.props.loop||this.updateAnimation()}componentWillUnmount(){this.isUnmounting=!0}render(){return(0,l.jsxs)("div",Object.assign({className:"lottie"},{children:[(0,l.jsx)("div",{className:"lottie-animation",ref:this.lottieTargetRef},void 0),this.state.fallbackActive&&this.renderFallback()]}),void 0)}};Ma=_a([I.Z],Ma);const Oa=Ma,{MODEL_RATING:Aa}=f.Z.WORKSHOP;class ModelRatingThankYou extends r.Component{constructor(){super(...arguments),this.onClose=()=>{this.context.commandBinder.issueCommand(new we.Bz(Te.P.RATING_THANK_YOU,!1))},this.stopPropagation=e=>{e.stopPropagation()}}render(){const{locale:e}=this.context;return(0,l.jsxs)("dialog",Object.assign({className:"modal model-rating-thank-you open",onClick:this.stopPropagation,onPointerDown:this.stopPropagation,onPointerUp:this.stopPropagation},{children:[(0,l.jsx)(te.P,{onClose:this.onClose},void 0),(0,l.jsx)("h4",{children:e.t(Aa.THANK_YOU_HEADING)},void 0),(0,l.jsx)(Oa,{animation:wa.HandsRaised},void 0),(0,l.jsx)("p",Object.assign({className:"p4"},{children:e.t(Aa.THANK_YOU_BODY)}),void 0),(0,l.jsxs)("small",Object.assign({className:"model-rating-cta"},{children:[e.t(Aa.THANK_YOU_CTA),"",(0,l.jsx)(Link,Object.assign({href:"//matterport.com/resources/support",onClick:this.onClose},{children:e.t(Aa.THANK_YOU_CTA_LINK_TEXT)}),void 0)]}),void 0)]}),void 0)}}ModelRatingThankYou.contextType=m.I;class Modals extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.closeModal=()=>{this.context.commandBinder.issueCommand(new we.rE)},this.mobile=(0,E.tq)(),this.state={modelDetails:void 0}}componentDidMount(){this.context.market.waitForData(ia.T).then((e=>{this.isUnmounting||this.setState({modelDetails:e.model.details})}))}componentWillUnmount(){this.isUnmounting=!0}render(){const{openModal:e,viewmode:t,glCanvas:i}=this.props,{modelDetails:n}=this.state;if(!n)return null;const s=e===Te.P.SHARE,r=e===Te.P.TERMS,o=e===Te.P.HELP,a=e===Te.P.CTA,c=e===Te.P.NOTES_INTRO,h=e===Te.P.MEASUREMENT_HELP,u=e===Te.P.VR_SELECT,p=e===Te.P.RATING_THANK_YOU,m=r||o,f=s||m||h||c||p||u&&!!n;return(0,l.jsxs)("div",Object.assign({id:"showcase-modals"},{children:[(0,l.jsxs)(Re,Object.assign({className:d()("modal-background",{"modal-background":!0,"dark-modal-background":m,open:f}),open:f,selectChild:!0,childKey:e||void 0,onClick:this.closeModal},{children:[(0,l.jsx)(ShareModal,{},Te.P.SHARE),(0,l.jsx)(MeasurementModeHelp,{mobile:this.mobile},Te.P.MEASUREMENT_HELP),c&&(0,l.jsx)(NotesIntro,{},Te.P.NOTES_INTRO),n&&(0,l.jsx)(wo,{isMobile:this.mobile,modelDetails:n},Te.P.VR_SELECT),r&&(0,l.jsx)(Terms,{},Te.P.TERMS),o&&(0,l.jsx)(ea,{isMobile:this.mobile,viewmode:t,allModes:y.BD},Te.P.HELP),p&&(0,l.jsx)(ModelRatingThankYou,{},Te.P.RATING_THANK_YOU)]}),void 0),(0,l.jsx)(No,{canvas:i,isMobile:this.mobile,viewmode:t,showCta:a},void 0)]}),void 0)}}Modals.contextType=m.I;var Ca=i(97251),Pa=i(69941),Da=i(66049),Na=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ia=class Toastr extends r.Component{constructor(e){super(e),this.getInitialState=()=>({messagePhraseKey:"",active:!1,ctaPhraseKey:"",timeout:0,multiline:!1,dismissesOnAction:!1,actionHandler:()=>{}}),this.triggerAction=e=>{e.stopPropagation(),this.state.actionHandler&&this.state.actionHandler(),this.state.dismissesOnAction&&this.hide()},this.hide=async()=>{window.clearTimeout(this.timeout),this.setState({active:!1})},this.show=async e=>{const t=Object.assign(this.getInitialState(),e,{active:!0});this.setState(t),window.clearTimeout(this.timeout),t.timeout>0&&(this.timeout=window.setTimeout((()=>{this.setState({active:!1})}),t.timeout))},this.state=this.getInitialState()}componentDidMount(){this.context.commandBinder.addBinding(Da.L,this.show),this.context.commandBinder.addBinding(Da.Q,this.hide)}componentWillUnmount(){window.clearTimeout(this.timeout),this.context.commandBinder.removeBinding(Da.L,this.show),this.context.commandBinder.removeBinding(Da.Q,this.hide)}render(){const{locale:e}=this.context,t=this.props.className||"",{active:i,multiline:n,messagePhraseKey:s,ctaPhraseKey:r,dismissesOnAction:o}=this.state,a={active:i,multiline:n},c=s?e.t(s):null,h=r?e.t(r):null;return(0,l.jsx)("div",Object.assign({className:"toastr-wrapper",onClick:o?this.hide:void 0},{children:(0,l.jsxs)("div",Object.assign({className:d()("toastr-contents",`${t}`,a)},{children:[(0,l.jsx)("div",Object.assign({className:"toastr-text"},{children:c}),void 0),h&&(0,l.jsx)("a",Object.assign({className:"link",onClick:this.triggerAction},{children:h}),void 0)]}),void 0)}),void 0)}};Ia.contextType=m.I,Ia=Na([I.A],Ia);var La=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{PANELS:Ra}=f.Z;let ka=class Panels extends r.Component{constructor(e){super(e),this.bindings=[],this.onToggleCollapse=e=>{this.setState({collapsed:e.collapsed})},this.toggleSidePanel=()=>{const{activeTool:e,toolPanelLayout:t}=this.props;e&&t===p.wS.SIDE_PANEL&&this.context.commandBinder.issueCommand(new it.zK(!this.state.collapsed))},this.isPanelOpen=e=>{const{children:t}=this.props;return!(!t||!Array.isArray(t))&&t.some((t=>t&&t.key===e))},this.state={collapsed:!1}}componentDidMount(){this.bindings.push(this.context.engine.subscribe(Oe.U7,this.onToggleCollapse))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){const{sidePanelCollapsible:i,toolPanelLayout:n}=this.props,{collapsed:s}=this.state;s&&!i&&e.toolPanelLayout!==p.wS.SIDE_PANEL&&n===p.wS.SIDE_PANEL&&this.context.commandBinder.issueCommand(new it.zK(!1))}getPanelTool(){const{activeTool:e}=this.props;if(!e)return null;const t=this.context.toolsData.getTool(e);return t&&t.panel?e:null}renderSideToggle(){const{locale:e}=this.context,{sidePanelCollapsible:t,toolPanelLayout:i}=this.props;if(!(i===p.wS.SIDE_PANEL)||!t)return null;const{collapsed:n}=this.state,s=n?e.t(Ra.EXPAND_PANEL):e.t(Ra.COLLAPSE_PANEL),r=n?"icon-dpad-left":"icon-dpad-right";return(0,l.jsx)("div",Object.assign({className:"panel-track"},{children:(0,l.jsx)("div",Object.assign({className:"panel-track-thumb","data-balloon":s,"data-balloon-pos":"left",onClick:this.toggleSidePanel},{children:(0,l.jsx)("span",{className:`icon ${r}`},void 0)}),void 0)}),void 0)}render(){const{children:e,className:t}=this.props,{collapsed:i}=this.state,n=this.getPanelTool(),s=this.isPanelOpen(n),r={"panel-open":s&&!i,"panel-collapsed":s&&i},o=this.renderSideToggle();return(0,l.jsx)(Re,Object.assign({className:d()("panels",r,t),open:s,firstChild:o||void 0,selectChild:!0,childKey:n||void 0},{children:e}),void 0)}};ka.contextType=m.I,ka=La([I.Z],ka);const Ua=(()=>{let e=0;return function(t,i){window.clearTimeout(e);const n=t.classList;switch(i){case p.wS.NORMAL:n.remove("narrow-layout"),n.contains("side-panel")?e=window.setTimeout((()=>{n.remove("side-panel")}),900):n.remove("bottom-panel");break;case p.wS.NARROW:n.add("narrow-layout"),n.contains("bottom-panel")?e=window.setTimeout((()=>{n.remove("bottom-panel")}),900):n.remove("side-panel");break;case p.wS.SIDE_PANEL:n.add("side-panel"),n.remove("bottom-panel","narrow-layout");break;case p.wS.BOTTOM_PANEL:n.remove("side-panel"),n.add("narrow-layout","bottom-panel")}}})();var Ba=i(67799),Fa=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Va=class TagViewPanel extends r.Component{constructor(e){super(e),this.textParser=new Wi.v({links:!0}),this.onViewAttachment=(e,t)=>{const{tagView:i}=this.props,n=i.attachments;if(n.length>0){const e=n.filter((e=>(0,rr.lV)(e)));e.length>0&&this.context.commandBinder.issueCommand(new or.xW(!0,e,t))}}}renderWidgetFrame(){const{widgetFrame:e}=this.props.tagView;return e?(0,l.jsx)(CustomWidgetFrame,{widget:e},void 0):null}renderMedia(){const{tagView:e,toolPanelLayout:t}=this.props,{attachments:i}=e,n=i.filter(rr.lV),s=t===p.wS.SIDE_PANEL?Ba.LH:void 0;if(1===n.length){const e=n[0];return(0,l.jsx)("div",Object.assign({className:"tag-attachments"},{children:(0,l.jsx)(_r,{attachment:e,onClick:this.onViewAttachment,style:{maxWidth:"100%"}},void 0)}),void 0)}return(0,l.jsx)(Fr,{attachments:i,layerWidth:s,onClick:this.onViewAttachment},void 0)}render(){const{tagView:e}=this.props,{id:t,description:i,label:n,attachments:s}=e,r=s.length>0;return(0,l.jsxs)("div",Object.assign({className:d()("tag-view-panel",{"viewable-media":r})},{children:[r&&this.renderMedia(),(0,l.jsx)(Kr,{text:i,title:n,textParser:this.textParser,annotationType:Zs.J.TAG,annotationId:t,attachments:[],onViewAttachment:this.onViewAttachment},void 0),this.renderWidgetFrame()]}),void 0)}};Va.contextType=m.I,Va=Fa([I.Z],Va);var Ha,ja=i(36169),Ga=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.CENTER="center",e.TOP="top"}(Ha||(Ha={}));let za=class Scroller extends r.Component{constructor(e){super(e),this.usePointerEvents=window.PointerEvent,this.scrollerRef=(0,r.createRef)(),this.trackRef=(0,r.createRef)(),this.thumbRef=(0,r.createRef)(),this.focusedSelector=null,this.listening=!1,this.startY=0,this.onThumb=!1,this.scrollTop=0,this.isUnmounting=!1,this.handleResize=()=>{this.isUnmounting||(this.computeStateValues(),this.focusedSelector&&this.scrollToSelector(this.focusedSelector))},this.handleWheelEvent=e=>{this.props.disabled||(this.onThumb=!1,this.focusedSelector=null,this.scrollBy(e.deltaY))},this.handleEvent=e=>{if(this.scrollerRef.current&&!this.props.disabled){this.scrollVelocityPixelsMS=0;if("mousedown"===e.type||"pointerdown"===e.type||"touchstart"===e.type){const t=e.target;this.onThumb=t&&t.classList.contains("scroller-thumb")}this.focusedSelector=null,this.inputFilter.handleEvent(e)}},this.handlePressStart=e=>{this.onThumb?this.startY=this.getThumbTop():this.startY=this.getScrollTop()},this.handlePressMove=e=>{const{trackHeight:t,contentsHeight:i}=this.state;let n;this.onThumb?(n=(this.startY-e.y)/t,this.scrollToPercent(n)):(n=(e.y+this.startY)/i,this.scrollToPercent(n))},this.handleDragStart=()=>{},this.handleDragEnd=(e,t)=>{this.scrollVelocityPixelsMS=e.y/t,this.lastScrollTimeMS=void 0,Math.abs(this.scrollVelocityPixelsMS)<1?this.scrollVelocityPixelsMS=0:this.animateScroll()},this.onTrackClick=e=>{const t=this.trackRef.current;if(e.target!==t||!t)return;const i=this.getThumbHeight(),n=this.getThumbTop(),s=t.getBoundingClientRect().top,r=this.state.trackHeight;let o;o=e.clientY<s+n?Math.max(0,(n-i)/r):Math.min(r,(n+i)/r),this.scrollToPercent(o)},this.scrollToPercent=e=>{this.isOverflowing()&&this.scrollerRef.current&&!isNaN(e)&&this.setScrollPosition(Math.max(Math.min(1,e)*this.state.contentsHeight,0))},this.scrollBy=e=>{this.isOverflowing()&&this.scrollerRef.current&&!isNaN(e)&&this.setScrollPosition(Math.max(this.scrollerRef.current.scrollTop+e,0))},this.computeStateValues=()=>{if(this.props.disabled)return;const e=this.scrollerRef.current,t=this.trackRef.current,i=Number(e&&e.clientHeight)||1,n=Number(t&&t.clientHeight)||i,s=Number(this.contents&&this.contents.clientHeight)||1,r=Number(this.contents&&this.contents.offsetTop)||0;this.debouncedSetState({scrollerHeight:i,contentsHeight:s,trackHeight:n,offsetTop:r})},this.debouncedSetState=e=>{new URL(`${document.location}`).searchParams.get("temp-disable-debounce-scroll")?this.setState(e):(cancelAnimationFrame(this.rAFHandle),this.rAFHandle=requestAnimationFrame((()=>{this.isUnmounting||this.setState(e)})))},this.setContentsRef=e=>{e?(this.contents=e,this.resizeObserver.observe(this.contents)):this.contents&&this.resizeObserver.unobserve(this.contents)},this.state={scrollerHeight:1,contentsHeight:1,trackHeight:1,offsetTop:0},this.resizeObserver=new Lt(this.handleResize),this.resizeSubscription=(0,$.kp)($.g_.RESIZE,this.handleResize),this.inputFilter=new InputFilter({handlePressStart:this.handlePressStart,handlePressMove:this.handlePressMove,handleDragStart:this.handleDragStart,handleDragEnd:this.handleDragEnd})}componentDidMount(){this.toggleEventHandling(!0),this.computeStateValues()}componentWillUnmount(){this.isUnmounting=!0,this.toggleEventHandling(!1),this.resizeObserver&&this.resizeObserver.disconnect()}componentDidUpdate(e,t){this.scrollerRef.current&&e.disabled!==this.props.disabled&&(this.props.disabled?this.toggleEventHandling(!1):this.toggleEventHandling(!0))}resetScrollTop(){this.focusedSelector=null,this.setScrollPosition(0)}getScroller(){return this.scrollerRef.current}getScrollHeight(){return Number(this.contents&&this.contents.clientHeight)||0}scrollToElement(e,t=Ha.CENTER){const i=this.scrollerRef.current;if(!e||!i)return;if(!(e.compareDocumentPosition(i)&Node.DOCUMENT_POSITION_CONTAINS))return;if(!this.isOverflowing())return;const{contentsHeight:n,scrollerHeight:s,offsetTop:r}=this.state;let o=e.offsetTop,a=e;for(;a.parentElement&&(a=a.parentElement,o+=a.offsetTop,a.offsetParent!==this.contents););let l=r+o;t===Ha.CENTER&&(l+=e.offsetHeight/2-s/2),l=Math.max(Math.min(n,l),0);const c=i.scrollTop,d=l-c;let h=0;const u=e=>{h||(h=e);const t=e-h,n=Math.min(t/500,1);i.scrollTo(0,c+d*n),t<500?window.requestAnimationFrame(u):this.setScrollPosition(l)};window.requestAnimationFrame(u)}scrollToSelector(e){const t=this.scrollerRef.current;if(!t)return;const i=t.querySelector(e);i?(this.focusedSelector=e,this.scrollToElement(i)):this.focusedSelector=null}setScrollPosition(e){const t=this.scrollerRef.current;if(t){const i=t.scrollTop;t.scrollTop=e,this.scrollTop=this.getScrollTop(),this.props.onScrolled&&i!==this.scrollTop&&this.props.onScrolled();const n=this.thumbRef.current;n&&(n.style.height=`${this.getThumbHeight()}px`,n.style.top=`${this.getThumbTop()}px`)}}toggleEventHandling(e){const t=this.scrollerRef.current,i=this.handleEvent,n=ja.h?{passive:!0}:void 0;!this.listening&&e&&t?(this.resizeSubscription.renew(),t.addEventListener("wheel",this.handleWheelEvent,n),this.usePointerEvents?(t.addEventListener("pointerdown",i,n),window.addEventListener("pointermove",i,n),window.addEventListener("pointerup",i,n)):(t.addEventListener("touchstart",i,n),t.addEventListener("mousedown",i,n),window.addEventListener("mousemove",i,n),window.addEventListener("mouseleave",i,n),window.addEventListener("mouseup",i,n),window.addEventListener("touchmove",i,n),window.addEventListener("touchend",i,n),window.addEventListener("touchcancel",i,n))):this.listening&&!e&&t&&(this.resizeSubscription.cancel(),t.removeEventListener("wheel",this.handleWheelEvent),this.usePointerEvents?(t.removeEventListener("pointerdown",i),window.removeEventListener("pointermove",i),window.removeEventListener("pointerup",i)):(t.removeEventListener("touchstart",i),t.removeEventListener("mousedown",i),window.removeEventListener("mousemove",i),window.removeEventListener("mouseleave",i),window.removeEventListener("mouseup",i),window.removeEventListener("touchmove",i),window.removeEventListener("touchend",i),window.removeEventListener("touchcancel",i)))}animateScroll(){window.requestAnimationFrame((e=>{void 0===this.lastScrollTimeMS&&(this.lastScrollTimeMS=e);let t=e-this.lastScrollTimeMS;if(t>0){this.scrollBy(this.scrollVelocityPixelsMS*t);const e=this.scrollVelocityPixelsMS>0?-1:1;for(;t>0;)this.scrollVelocityPixelsMS+=this.scrollVelocityPixelsMS*this.scrollVelocityPixelsMS*.01*e,t-=1}Math.abs(this.scrollVelocityPixelsMS)>.001&&this.animateScroll()}))}getThumbTop(){const{contentsHeight:e,trackHeight:t}=this.state;return Math.min(this.scrollTop/e*t,t-this.getThumbHeight())}getThumbHeight(){const{scrollerHeight:e,contentsHeight:t,trackHeight:i}=this.state;return e/t*i}getScrollTop(){return this.scrollerRef.current?this.scrollerRef.current.scrollTop:0}isOverflowing(){const{contentsHeight:e,scrollerHeight:t,offsetTop:i}=this.state;return e+i>t}renderTrack(){const e={height:`${this.getThumbHeight()}px`,top:`${this.getThumbTop()}px`};return(0,l.jsx)("div",Object.assign({ref:this.trackRef,className:"scroller-track",onClick:this.onTrackClick},{children:(0,l.jsx)("div",{ref:this.thumbRef,className:"scroller-thumb",style:e,onPointerDown:this.usePointerEvents?this.handleEvent:void 0,onMouseDown:this.usePointerEvents?void 0:this.handleEvent,onTouchStart:this.usePointerEvents?void 0:this.handleEvent},void 0)}),void 0)}render(){const{children:e,className:t,hideThumb:i,disabled:n}=this.props,s=!n&&this.isOverflowing();return(0,l.jsxs)("div",Object.assign({className:d()("scroller-container",t)},{children:[(0,l.jsx)("div",Object.assign({className:"scroller-scroller",ref:this.scrollerRef},{children:(0,l.jsx)("div",Object.assign({className:"scroller-contents",ref:this.setContentsRef},{children:e}),void 0)}),void 0),!i&&s&&this.renderTrack()]}),void 0)}};za=Ga([I.Z],za);class DetailPanel extends r.Component{constructor(e){super(e),this.touchDevice=(0,E.Jm)(),this.bindings=[],this.handleTextBoxFocus=e=>{this.setState({textFocused:e.focused})},this.setScrollerRef=e=>{e&&(this.scroller=e)},this.state={textFocused:!1}}componentDidMount(){if(this.touchDevice){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(nt.SN,this.handleTextBoxFocus))}}componentWillUnmount(){this.bindings.map((e=>e.cancel()))}isPanelFitting(){const e=this.scroller&&this.scroller.getScroller();if(!e)return!1;return this.scroller.getScrollHeight()<=(window.visualViewport?window.visualViewport.height:window.innerHeight)-e.getBoundingClientRect().top}resetScrollTop(){this.scroller&&this.scroller.resetScrollTop()}scrollToSelector(e){this.scroller&&this.scroller.scrollToSelector(e)}render(){const{open:e,overPanel:t,className:i,children:n,onScrolled:s,toolPanelLayout:r,scrollingDisabled:o}=this.props,{textFocused:a}=this.state,c=r===p.wS.BOTTOM_PANEL,h=this.touchDevice&&a&&c,u=c,m={open:e,"over-panel":t,"sticky-header":!h,"detail-panel-align-top":h&&!this.isPanelFitting()};return(0,l.jsx)("div",Object.assign({className:d()("detail-panel",m,i)},{children:(0,l.jsx)(za,Object.assign({ref:this.setScrollerRef,hideThumb:u,disabled:o,onScrolled:s},{children:n}),void 0)}),void 0)}}DetailPanel.contextType=m.I;var Wa=i(51627);(0,r.createContext)({intersectionRef:null,GroupRenderer:()=>null,ItemRenderer:()=>null,itemRendererProps:{},toggleGroup:()=>{},isCollapsed:()=>!1});function Ka({name:e,style:t,size:i,className:n}){const s=d()("nova-icon",`icon-${e}`,n,{[`nova-icon-${i}`]:void 0!==i});return(0,l.jsx)("span",{className:s,style:t},void 0)}var Ya;function qa(e){if(null==e)return window;if("[object Window]"!==e.toString()){var t=e.ownerDocument;return t&&t.defaultView||window}return e}function Za(e){return e instanceof qa(e).Element||e instanceof Element}function $a(e){return e instanceof qa(e).HTMLElement||e instanceof HTMLElement}function Qa(e){return"undefined"!=typeof ShadowRoot&&(e instanceof qa(e).ShadowRoot||e instanceof ShadowRoot)}!function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large"}(Ya||(Ya={}));var Xa=Math.max,Ja=Math.min,el=Math.round;function tl(e,t){void 0===t&&(t=!1);var i=e.getBoundingClientRect(),n=1,s=1;if($a(e)&&t){var r=e.offsetHeight,o=e.offsetWidth;o>0&&(n=el(i.width)/o||1),r>0&&(s=el(i.height)/r||1)}return{width:i.width/n,height:i.height/s,top:i.top/s,right:i.right/n,bottom:i.bottom/s,left:i.left/n,x:i.left/n,y:i.top/s}}function il(e){var t=qa(e);return{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function nl(e){return e?(e.nodeName||"").toLowerCase():null}function sl(e){return((Za(e)?e.ownerDocument:e.document)||window.document).documentElement}function rl(e){return tl(sl(e)).left+il(e).scrollLeft}function ol(e){return qa(e).getComputedStyle(e)}function al(e){var t=ol(e),i=t.overflow,n=t.overflowX,s=t.overflowY;return/auto|scroll|overlay|hidden/.test(i+s+n)}function ll(e,t,i){void 0===i&&(i=!1);var n,s,r=$a(t),o=$a(t)&&function(e){var t=e.getBoundingClientRect(),i=el(t.width)/e.offsetWidth||1,n=el(t.height)/e.offsetHeight||1;return 1!==i||1!==n}(t),a=sl(t),l=tl(e,o),c={scrollLeft:0,scrollTop:0},d={x:0,y:0};return(r||!r&&!i)&&(("body"!==nl(t)||al(a))&&(c=(n=t)!==qa(n)&&$a(n)?{scrollLeft:(s=n).scrollLeft,scrollTop:s.scrollTop}:il(n)),$a(t)?((d=tl(t,!0)).x+=t.clientLeft,d.y+=t.clientTop):a&&(d.x=rl(a))),{x:l.left+c.scrollLeft-d.x,y:l.top+c.scrollTop-d.y,width:l.width,height:l.height}}function cl(e){var t=tl(e),i=e.offsetWidth,n=e.offsetHeight;return Math.abs(t.width-i)<=1&&(i=t.width),Math.abs(t.height-n)<=1&&(n=t.height),{x:e.offsetLeft,y:e.offsetTop,width:i,height:n}}function dl(e){return"html"===nl(e)?e:e.assignedSlot||e.parentNode||(Qa(e)?e.host:null)||sl(e)}function hl(e){return["html","body","#document"].indexOf(nl(e))>=0?e.ownerDocument.body:$a(e)&&al(e)?e:hl(dl(e))}function ul(e,t){var i;void 0===t&&(t=[]);var n=hl(e),s=n===(null==(i=e.ownerDocument)?void 0:i.body),r=qa(n),o=s?[r].concat(r.visualViewport||[],al(n)?n:[]):n,a=t.concat(o);return s?a:a.concat(ul(dl(o)))}function pl(e){return["table","td","th"].indexOf(nl(e))>=0}function ml(e){return $a(e)&&"fixed"!==ol(e).position?e.offsetParent:null}function fl(e){for(var t=qa(e),i=ml(e);i&&pl(i)&&"static"===ol(i).position;)i=ml(i);return i&&("html"===nl(i)||"body"===nl(i)&&"static"===ol(i).position)?t:i||function(e){var t=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&$a(e)&&"fixed"===ol(e).position)return null;for(var i=dl(e);$a(i)&&["html","body"].indexOf(nl(i))<0;){var n=ol(i);if("none"!==n.transform||"none"!==n.perspective||"paint"===n.contain||-1!==["transform","perspective"].indexOf(n.willChange)||t&&"filter"===n.willChange||t&&n.filter&&"none"!==n.filter)return i;i=i.parentNode}return null}(e)||t}var gl="top",vl="bottom",yl="right",bl="left",Sl="auto",El=[gl,vl,yl,bl],Tl="start",wl="end",xl="viewport",_l="popper",Ml=El.reduce((function(e,t){return e.concat([t+"-"+Tl,t+"-"+wl])}),[]),Ol=[].concat(El,[Sl]).reduce((function(e,t){return e.concat([t,t+"-"+Tl,t+"-"+wl])}),[]),Al=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function Cl(e){var t=new Map,i=new Set,n=[];function s(e){i.add(e.name),[].concat(e.requires||[],e.requiresIfExists||[]).forEach((function(e){if(!i.has(e)){var n=t.get(e);n&&s(n)}})),n.push(e)}return e.forEach((function(e){t.set(e.name,e)})),e.forEach((function(e){i.has(e.name)||s(e)})),n}var Pl={placement:"bottom",modifiers:[],strategy:"absolute"};function Dl(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return!t.some((function(e){return!(e&&"function"==typeof e.getBoundingClientRect)}))}function Nl(e){void 0===e&&(e={});var t=e,i=t.defaultModifiers,n=void 0===i?[]:i,s=t.defaultOptions,r=void 0===s?Pl:s;return function(e,t,i){void 0===i&&(i=r);var s,o,a={placement:"bottom",orderedModifiers:[],options:Object.assign({},Pl,r),modifiersData:{},elements:{reference:e,popper:t},attributes:{},styles:{}},l=[],c=!1,d={state:a,setOptions:function(i){var s="function"==typeof i?i(a.options):i;h(),a.options=Object.assign({},r,a.options,s),a.scrollParents={reference:Za(e)?ul(e):e.contextElement?ul(e.contextElement):[],popper:ul(t)};var o=function(e){var t=Cl(e);return Al.reduce((function(e,i){return e.concat(t.filter((function(e){return e.phase===i})))}),[])}(function(e){var t=e.reduce((function(e,t){var i=e[t.name];return e[t.name]=i?Object.assign({},i,t,{options:Object.assign({},i.options,t.options),data:Object.assign({},i.data,t.data)}):t,e}),{});return Object.keys(t).map((function(e){return t[e]}))}([].concat(n,a.options.modifiers)));return a.orderedModifiers=o.filter((function(e){return e.enabled})),a.orderedModifiers.forEach((function(e){var t=e.name,i=e.options,n=void 0===i?{}:i,s=e.effect;if("function"==typeof s){var r=s({state:a,name:t,instance:d,options:n}),o=function(){};l.push(r||o)}})),d.update()},forceUpdate:function(){if(!c){var e=a.elements,t=e.reference,i=e.popper;if(Dl(t,i)){a.rects={reference:ll(t,fl(i),"fixed"===a.options.strategy),popper:cl(i)},a.reset=!1,a.placement=a.options.placement,a.orderedModifiers.forEach((function(e){return a.modifiersData[e.name]=Object.assign({},e.data)}));for(var n=0;n<a.orderedModifiers.length;n++)if(!0!==a.reset){var s=a.orderedModifiers[n],r=s.fn,o=s.options,l=void 0===o?{}:o,h=s.name;"function"==typeof r&&(a=r({state:a,options:l,name:h,instance:d})||a)}else a.reset=!1,n=-1}}},update:(s=function(){return new Promise((function(e){d.forceUpdate(),e(a)}))},function(){return o||(o=new Promise((function(e){Promise.resolve().then((function(){o=void 0,e(s())}))}))),o}),destroy:function(){h(),c=!0}};if(!Dl(e,t))return d;function h(){l.forEach((function(e){return e()})),l=[]}return d.setOptions(i).then((function(e){!c&&i.onFirstUpdate&&i.onFirstUpdate(e)})),d}}var Il={passive:!0};function Ll(e){return e.split("-")[0]}function Rl(e){return e.split("-")[1]}function kl(e){return["top","bottom"].indexOf(e)>=0?"x":"y"}function Ul(e){var t,i=e.reference,n=e.element,s=e.placement,r=s?Ll(s):null,o=s?Rl(s):null,a=i.x+i.width/2-n.width/2,l=i.y+i.height/2-n.height/2;switch(r){case gl:t={x:a,y:i.y-n.height};break;case vl:t={x:a,y:i.y+i.height};break;case yl:t={x:i.x+i.width,y:l};break;case bl:t={x:i.x-n.width,y:l};break;default:t={x:i.x,y:i.y}}var c=r?kl(r):null;if(null!=c){var d="y"===c?"height":"width";switch(o){case Tl:t[c]=t[c]-(i[d]/2-n[d]/2);break;case wl:t[c]=t[c]+(i[d]/2-n[d]/2)}}return t}var Bl={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Fl(e){var t,i=e.popper,n=e.popperRect,s=e.placement,r=e.variation,o=e.offsets,a=e.position,l=e.gpuAcceleration,c=e.adaptive,d=e.roundOffsets,h=e.isFixed,u=o.x,p=void 0===u?0:u,m=o.y,f=void 0===m?0:m,g="function"==typeof d?d({x:p,y:f}):{x:p,y:f};p=g.x,f=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),b=bl,S=gl,E=window;if(c){var T=fl(i),w="clientHeight",x="clientWidth";if(T===qa(i)&&"static"!==ol(T=sl(i)).position&&"absolute"===a&&(w="scrollHeight",x="scrollWidth"),T=T,s===gl||(s===bl||s===yl)&&r===wl)S=vl,f-=(h&&E.visualViewport?E.visualViewport.height:T[w])-n.height,f*=l?1:-1;if(s===bl||(s===gl||s===vl)&&r===wl)b=yl,p-=(h&&E.visualViewport?E.visualViewport.width:T[x])-n.width,p*=l?1:-1}var _,M=Object.assign({position:a},c&&Bl),O=!0===d?function(e){var t=e.x,i=e.y,n=window.devicePixelRatio||1;return{x:el(t*n)/n||0,y:el(i*n)/n||0}}({x:p,y:f}):{x:p,y:f};return p=O.x,f=O.y,l?Object.assign({},M,((_={})[S]=y?"0":"",_[b]=v?"0":"",_.transform=(E.devicePixelRatio||1)<=1?"translate("+p+"px, "+f+"px)":"translate3d("+p+"px, "+f+"px, 0)",_)):Object.assign({},M,((t={})[S]=y?f+"px":"",t[b]=v?p+"px":"",t.transform="",t))}var Vl={left:"right",right:"left",bottom:"top",top:"bottom"};function Hl(e){return e.replace(/left|right|bottom|top/g,(function(e){return Vl[e]}))}var jl={start:"end",end:"start"};function Gl(e){return e.replace(/start|end/g,(function(e){return jl[e]}))}function zl(e,t){var i=t.getRootNode&&t.getRootNode();if(e.contains(t))return!0;if(i&&Qa(i)){var n=t;do{if(n&&e.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function Wl(e){return Object.assign({},e,{left:e.x,top:e.y,right:e.x+e.width,bottom:e.y+e.height})}function Kl(e,t){return t===xl?Wl(function(e){var t=qa(e),i=sl(e),n=t.visualViewport,s=i.clientWidth,r=i.clientHeight,o=0,a=0;return n&&(s=n.width,r=n.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=n.offsetLeft,a=n.offsetTop)),{width:s,height:r,x:o+rl(e),y:a}}(e)):Za(t)?function(e){var t=tl(e);return t.top=t.top+e.clientTop,t.left=t.left+e.clientLeft,t.bottom=t.top+e.clientHeight,t.right=t.left+e.clientWidth,t.width=e.clientWidth,t.height=e.clientHeight,t.x=t.left,t.y=t.top,t}(t):Wl(function(e){var t,i=sl(e),n=il(e),s=null==(t=e.ownerDocument)?void 0:t.body,r=Xa(i.scrollWidth,i.clientWidth,s?s.scrollWidth:0,s?s.clientWidth:0),o=Xa(i.scrollHeight,i.clientHeight,s?s.scrollHeight:0,s?s.clientHeight:0),a=-n.scrollLeft+rl(e),l=-n.scrollTop;return"rtl"===ol(s||i).direction&&(a+=Xa(i.clientWidth,s?s.clientWidth:0)-r),{width:r,height:o,x:a,y:l}}(sl(e)))}function Yl(e,t,i){var n="clippingParents"===t?function(e){var t=ul(dl(e)),i=["absolute","fixed"].indexOf(ol(e).position)>=0&&$a(e)?fl(e):e;return Za(i)?t.filter((function(e){return Za(e)&&zl(e,i)&&"body"!==nl(e)})):[]}(e):[].concat(t),s=[].concat(n,[i]),r=s[0],o=s.reduce((function(t,i){var n=Kl(e,i);return t.top=Xa(n.top,t.top),t.right=Ja(n.right,t.right),t.bottom=Ja(n.bottom,t.bottom),t.left=Xa(n.left,t.left),t}),Kl(e,r));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function ql(e){return Object.assign({},{top:0,right:0,bottom:0,left:0},e)}function Zl(e,t){return t.reduce((function(t,i){return t[i]=e,t}),{})}function $l(e,t){void 0===t&&(t={});var i=t,n=i.placement,s=void 0===n?e.placement:n,r=i.boundary,o=void 0===r?"clippingParents":r,a=i.rootBoundary,l=void 0===a?xl:a,c=i.elementContext,d=void 0===c?_l:c,h=i.altBoundary,u=void 0!==h&&h,p=i.padding,m=void 0===p?0:p,f=ql("number"!=typeof m?m:Zl(m,El)),g=d===_l?"reference":_l,v=e.rects.popper,y=e.elements[u?g:d],b=Yl(Za(y)?y:y.contextElement||sl(e.elements.popper),o,l),S=tl(e.elements.reference),E=Ul({reference:S,element:v,strategy:"absolute",placement:s}),T=Wl(Object.assign({},v,E)),w=d===_l?T:S,x={top:b.top-w.top+f.top,bottom:w.bottom-b.bottom+f.bottom,left:b.left-w.left+f.left,right:w.right-b.right+f.right},_=e.modifiersData.offset;if(d===_l&&_){var M=_[s];Object.keys(x).forEach((function(e){var t=[yl,vl].indexOf(e)>=0?1:-1,i=[gl,vl].indexOf(e)>=0?"y":"x";x[e]+=M[i]*t}))}return x}function Ql(e,t,i){return Xa(e,Ja(t,i))}function Xl(e,t,i){return void 0===i&&(i={x:0,y:0}),{top:e.top-t.height-i.y,right:e.right-t.width+i.x,bottom:e.bottom-t.height+i.y,left:e.left-t.width-i.x}}function Jl(e){return[gl,yl,vl,bl].some((function(t){return e[t]>=0}))}var ec=Nl({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(e){var t=e.state,i=e.instance,n=e.options,s=n.scroll,r=void 0===s||s,o=n.resize,a=void 0===o||o,l=qa(t.elements.popper),c=[].concat(t.scrollParents.reference,t.scrollParents.popper);return r&&c.forEach((function(e){e.addEventListener("scroll",i.update,Il)})),a&&l.addEventListener("resize",i.update,Il),function(){r&&c.forEach((function(e){e.removeEventListener("scroll",i.update,Il)})),a&&l.removeEventListener("resize",i.update,Il)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(e){var t=e.state,i=e.name;t.modifiersData[i]=Ul({reference:t.rects.reference,element:t.rects.popper,strategy:"absolute",placement:t.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(e){var t=e.state,i=e.options,n=i.gpuAcceleration,s=void 0===n||n,r=i.adaptive,o=void 0===r||r,a=i.roundOffsets,l=void 0===a||a,c={placement:Ll(t.placement),variation:Rl(t.placement),popper:t.elements.popper,popperRect:t.rects.popper,gpuAcceleration:s,isFixed:"fixed"===t.options.strategy};null!=t.modifiersData.popperOffsets&&(t.styles.popper=Object.assign({},t.styles.popper,Fl(Object.assign({},c,{offsets:t.modifiersData.popperOffsets,position:t.options.strategy,adaptive:o,roundOffsets:l})))),null!=t.modifiersData.arrow&&(t.styles.arrow=Object.assign({},t.styles.arrow,Fl(Object.assign({},c,{offsets:t.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-placement":t.placement})},data:{}},{name:"applyStyles",enabled:!0,phase:"write",fn:function(e){var t=e.state;Object.keys(t.elements).forEach((function(e){var i=t.styles[e]||{},n=t.attributes[e]||{},s=t.elements[e];$a(s)&&nl(s)&&(Object.assign(s.style,i),Object.keys(n).forEach((function(e){var t=n[e];!1===t?s.removeAttribute(e):s.setAttribute(e,!0===t?"":t)})))}))},effect:function(e){var t=e.state,i={popper:{position:t.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(t.elements.popper.style,i.popper),t.styles=i,t.elements.arrow&&Object.assign(t.elements.arrow.style,i.arrow),function(){Object.keys(t.elements).forEach((function(e){var n=t.elements[e],s=t.attributes[e]||{},r=Object.keys(t.styles.hasOwnProperty(e)?t.styles[e]:i[e]).reduce((function(e,t){return e[t]="",e}),{});$a(n)&&nl(n)&&(Object.assign(n.style,r),Object.keys(s).forEach((function(e){n.removeAttribute(e)})))}))}},requires:["computeStyles"]},{name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(e){var t=e.state,i=e.options,n=e.name,s=i.offset,r=void 0===s?[0,0]:s,o=Ol.reduce((function(e,i){return e[i]=function(e,t,i){var n=Ll(e),s=[bl,gl].indexOf(n)>=0?-1:1,r="function"==typeof i?i(Object.assign({},t,{placement:e})):i,o=r[0],a=r[1];return o=o||0,a=(a||0)*s,[bl,yl].indexOf(n)>=0?{x:a,y:o}:{x:o,y:a}}(i,t.rects,r),e}),{}),a=o[t.placement],l=a.x,c=a.y;null!=t.modifiersData.popperOffsets&&(t.modifiersData.popperOffsets.x+=l,t.modifiersData.popperOffsets.y+=c),t.modifiersData[n]=o}},{name:"flip",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,n=e.name;if(!t.modifiersData[n]._skip){for(var s=i.mainAxis,r=void 0===s||s,o=i.altAxis,a=void 0===o||o,l=i.fallbackPlacements,c=i.padding,d=i.boundary,h=i.rootBoundary,u=i.altBoundary,p=i.flipVariations,m=void 0===p||p,f=i.allowedAutoPlacements,g=t.options.placement,v=Ll(g),y=l||(v===g||!m?[Hl(g)]:function(e){if(Ll(e)===Sl)return[];var t=Hl(e);return[Gl(e),t,Gl(t)]}(g)),b=[g].concat(y).reduce((function(e,i){return e.concat(Ll(i)===Sl?function(e,t){void 0===t&&(t={});var i=t,n=i.placement,s=i.boundary,r=i.rootBoundary,o=i.padding,a=i.flipVariations,l=i.allowedAutoPlacements,c=void 0===l?Ol:l,d=Rl(n),h=d?a?Ml:Ml.filter((function(e){return Rl(e)===d})):El,u=h.filter((function(e){return c.indexOf(e)>=0}));0===u.length&&(u=h);var p=u.reduce((function(t,i){return t[i]=$l(e,{placement:i,boundary:s,rootBoundary:r,padding:o})[Ll(i)],t}),{});return Object.keys(p).sort((function(e,t){return p[e]-p[t]}))}(t,{placement:i,boundary:d,rootBoundary:h,padding:c,flipVariations:m,allowedAutoPlacements:f}):i)}),[]),S=t.rects.reference,E=t.rects.popper,T=new Map,w=!0,x=b[0],_=0;_<b.length;_++){var M=b[_],O=Ll(M),A=Rl(M)===Tl,C=[gl,vl].indexOf(O)>=0,P=C?"width":"height",D=$l(t,{placement:M,boundary:d,rootBoundary:h,altBoundary:u,padding:c}),N=C?A?yl:bl:A?vl:gl;S[P]>E[P]&&(N=Hl(N));var I=Hl(N),L=[];if(r&&L.push(D[O]<=0),a&&L.push(D[N]<=0,D[I]<=0),L.every((function(e){return e}))){x=M,w=!1;break}T.set(M,L)}if(w)for(var R=function(e){var t=b.find((function(t){var i=T.get(t);if(i)return i.slice(0,e).every((function(e){return e}))}));if(t)return x=t,"break"},k=m?3:1;k>0;k--){if("break"===R(k))break}t.placement!==x&&(t.modifiersData[n]._skip=!0,t.placement=x,t.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}},{name:"preventOverflow",enabled:!0,phase:"main",fn:function(e){var t=e.state,i=e.options,n=e.name,s=i.mainAxis,r=void 0===s||s,o=i.altAxis,a=void 0!==o&&o,l=i.boundary,c=i.rootBoundary,d=i.altBoundary,h=i.padding,u=i.tether,p=void 0===u||u,m=i.tetherOffset,f=void 0===m?0:m,g=$l(t,{boundary:l,rootBoundary:c,padding:h,altBoundary:d}),v=Ll(t.placement),y=Rl(t.placement),b=!y,S=kl(v),E="x"===S?"y":"x",T=t.modifiersData.popperOffsets,w=t.rects.reference,x=t.rects.popper,_="function"==typeof f?f(Object.assign({},t.rects,{placement:t.placement})):f,M="number"==typeof _?{mainAxis:_,altAxis:_}:Object.assign({mainAxis:0,altAxis:0},_),O=t.modifiersData.offset?t.modifiersData.offset[t.placement]:null,A={x:0,y:0};if(T){if(r){var C,P="y"===S?gl:bl,D="y"===S?vl:yl,N="y"===S?"height":"width",I=T[S],L=I+g[P],R=I-g[D],k=p?-x[N]/2:0,U=y===Tl?w[N]:x[N],B=y===Tl?-x[N]:-w[N],F=t.elements.arrow,V=p&&F?cl(F):{width:0,height:0},H=t.modifiersData["arrow#persistent"]?t.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},j=H[P],G=H[D],z=Ql(0,w[N],V[N]),W=b?w[N]/2-k-z-j-M.mainAxis:U-z-j-M.mainAxis,K=b?-w[N]/2+k+z+G+M.mainAxis:B+z+G+M.mainAxis,Y=t.elements.arrow&&fl(t.elements.arrow),q=Y?"y"===S?Y.clientTop||0:Y.clientLeft||0:0,Z=null!=(C=null==O?void 0:O[S])?C:0,$=I+K-Z,Q=Ql(p?Ja(L,I+W-Z-q):L,I,p?Xa(R,$):R);T[S]=Q,A[S]=Q-I}if(a){var X,J="x"===S?gl:bl,ee="x"===S?vl:yl,te=T[E],ie="y"===E?"height":"width",ne=te+g[J],se=te-g[ee],re=-1!==[gl,bl].indexOf(v),oe=null!=(X=null==O?void 0:O[E])?X:0,ae=re?ne:te-w[ie]-x[ie]-oe+M.altAxis,le=re?te+w[ie]+x[ie]-oe-M.altAxis:se,ce=p&&re?function(e,t,i){var n=Ql(e,t,i);return n>i?i:n}(ae,te,le):Ql(p?ae:ne,te,p?le:se);T[E]=ce,A[E]=ce-te}t.modifiersData[n]=A}},requiresIfExists:["offset"]},{name:"arrow",enabled:!0,phase:"main",fn:function(e){var t,i=e.state,n=e.name,s=e.options,r=i.elements.arrow,o=i.modifiersData.popperOffsets,a=Ll(i.placement),l=kl(a),c=[bl,yl].indexOf(a)>=0?"height":"width";if(r&&o){var d=function(e,t){return ql("number"!=typeof(e="function"==typeof e?e(Object.assign({},t.rects,{placement:t.placement})):e)?e:Zl(e,El))}(s.padding,i),h=cl(r),u="y"===l?gl:bl,p="y"===l?vl:yl,m=i.rects.reference[c]+i.rects.reference[l]-o[l]-i.rects.popper[c],f=o[l]-i.rects.reference[l],g=fl(r),v=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,y=m/2-f/2,b=d[u],S=v-h[c]-d[p],E=v/2-h[c]/2+y,T=Ql(b,E,S),w=l;i.modifiersData[n]=((t={})[w]=T,t.centerOffset=T-E,t)}},effect:function(e){var t=e.state,i=e.options.element,n=void 0===i?"[data-popper-arrow]":i;null!=n&&("string"!=typeof n||(n=t.elements.popper.querySelector(n)))&&zl(t.elements.popper,n)&&(t.elements.arrow=n)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]},{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(e){var t=e.state,i=e.name,n=t.rects.reference,s=t.rects.popper,r=t.modifiersData.preventOverflow,o=$l(t,{elementContext:"reference"}),a=$l(t,{altBoundary:!0}),l=Xl(o,n),c=Xl(a,s,r),d=Jl(l),h=Jl(c);t.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:d,hasPopperEscaped:h},t.attributes.popper=Object.assign({},t.attributes.popper,{"data-popper-reference-hidden":d,"data-popper-escaped":h})}}]}),tc=i(69590),ic=i.n(tc),nc=function(e){return e.reduce((function(e,t){var i=t[0],n=t[1];return e[i]=n,e}),{})},sc="undefined"!=typeof window&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,rc=[];const oc=({children:e,offset:t=[0,8],placement:i="top",strategy:n="absolute",target:s,title:o,trigger:a="hover"})=>{const[c,d]=(0,r.useState)(null),[h,u]=(0,r.useState)(null),[p,m]=(0,r.useState)("static"===a),{styles:f,attributes:g}=function(e,t,i){void 0===i&&(i={});var n=r.useRef(null),s={onFirstUpdate:i.onFirstUpdate,placement:i.placement||"bottom",strategy:i.strategy||"absolute",modifiers:i.modifiers||rc},o=r.useState({styles:{popper:{position:s.strategy,left:"0",top:"0"},arrow:{position:"absolute"}},attributes:{}}),a=o[0],l=o[1],c=r.useMemo((function(){return{name:"updateState",enabled:!0,phase:"write",fn:function(e){var t=e.state,i=Object.keys(t.elements);l({styles:nc(i.map((function(e){return[e,t.styles[e]||{}]}))),attributes:nc(i.map((function(e){return[e,t.attributes[e]]})))})},requires:["computeStyles"]}}),[]),d=r.useMemo((function(){var e={onFirstUpdate:s.onFirstUpdate,placement:s.placement,strategy:s.strategy,modifiers:[].concat(s.modifiers,[c,{name:"applyStyles",enabled:!1}])};return ic()(n.current,e)?n.current||e:(n.current=e,e)}),[s.onFirstUpdate,s.placement,s.strategy,s.modifiers,c]),h=r.useRef();return sc((function(){h.current&&h.current.setOptions(d)}),[d]),sc((function(){if(null!=e&&null!=t){var n=(i.createPopper||ec)(e,t,d);return h.current=n,function(){n.destroy(),h.current=null}}}),[e,t,i.createPopper]),{state:h.current?h.current.state:null,styles:a.styles,attributes:a.attributes,update:h.current?h.current.update:null,forceUpdate:h.current?h.current.forceUpdate:null}}(s,c,{placement:i,strategy:n,modifiers:[{name:"arrow",options:{element:h,padding:4}},{name:"offset",options:{offset:t}}]}),v=()=>{m(!0)},y=()=>{m(!1)};return(0,r.useEffect)((()=>{if(s&&"hover"===a)return s.addEventListener("mouseenter",v),s.addEventListener("mouseleave",y),()=>{s.removeEventListener("mouseenter",v),s.removeEventListener("mouseleave",y)}}),[s,a]),p?(0,l.jsxs)("div",Object.assign({className:"nova-tooltip",ref:d,role:"tooltip",style:f.popper},g.popper,{children:[o||e,(0,l.jsx)("div",{className:"nova-tooltip-arrow",ref:u,style:f.arrow},void 0)]}),void 0):null};var ac,lc,cc;function dc({ariaLabel:e,children:t,className:i,disabled:n=!1,icon:s,label:o,onClick:a,size:c,theme:h="light",tooltip:u,tooltipOptions:p={},variant:m}){const[f,g]=(0,r.useState)(null),v=void 0===o&&void 0===t,y=d()(i,"mp-nova-btn",{[`mp-nova-btn-${m}`]:void 0!==m},{[`mp-nova-btn-${h}`]:void 0!==h},{[`mp-nova-btn-${c}`]:void 0!==c},{"mp-nova-btn-icon":v});return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsxs)("button",Object.assign({"aria-label":e||o,className:y,onClick:a,disabled:n,ref:u?g:null},{children:[s&&(0,l.jsx)(Ka,{name:s},void 0),void 0!==o?o:t]}),void 0),u&&(0,l.jsx)(oc,Object.assign({target:f,title:u},p),void 0)]},void 0)}!function(e){e.PRIMARY="primary",e.SECONDARY="secondary",e.TERTIARY="tertiary",e.FAB="fab"}(ac||(ac={})),function(e){e.SMALL="small",e.LARGE="large"}(lc||(lc={})),function(e){e.i360="360",e.Arrows="arrows",e.Attach="attach",e.Back="back",e.Blocked="blocked",e.BlurOutline="blur-outline",e.BrushOutline="brush-outline",e.Checkmark="checkmark",e.ChevronLeft="chevron-left",e.ChevronRight="chevron-right",e.Close="close",e.CommentOutline="comment-outline",e.Comment="comment",e.Delete="delete",e.Dock="dock",e.Dollhouse="dollhouse",e.Download="download",e.DpadDown="dpad-down",e.DpadLeft="dpad-left",e.DpadRight="dpad-right",e.DpadUp="dpad-up",e.DragEdit="drag-edit",e.DrawLines="draw-lines",e.Email="email",e.Error="error",e.EscapeKey="escape-key",e.ExtLink="ext-link",e.EyeHide="eye-hide",e.EyeShow="eye-show",e.Facebook="facebook",e.File="file",e.FingerDrag="finger-drag",e.FloorControlsAll="floor-controls-all",e.FloorControls="floor-controls",e.Floorplan="floorplan",e.FullscreenExit="fullscreen-exit",e.Fullscreen="fullscreen",e.Fullscreen2="fullscreen2",e.Help="help",e.HlrBadge="hlr-badge",e.Hlr="hlr",e.Info="info",e.Link="link",e.Linkedin="linkedin",e.List="list",e.Location="location",e.MagnifyingGlass="magnifying-glass",e.MediaMix="media-mix",e.MeshTrim="mesh-trim",e.Mesh="mesh",e.Minus="minus",e.MoreVert="more-vert",e.Notes="notes",e.PanoramaDisable="panorama-disable",e.Panorama="panorama",e.PaperClip="paper-clip",e.PauseOutline="pause-outline",e.Pause="pause",e.Photo_2d="photo-2d",e.Photo_360="photo-360",e.PhotoAdd="photo-add",e.Pin="pin",e.Pinterest="pinterest",e.PlayUnicode="play-unicode",e.Play="play",e.Plus="plus",e.Position_3d="position-3d",e.PressHold="press-hold",e.Question="question",e.Reorder="reorder",e.Reply="reply",e.Revert="revert",e.RotateLeft="rotate-left",e.RotateRight="rotate-right",e.Rotate="rotate",e.Rotation_3d="rotation-3d",e.Scale_3d="scale-3d",e.Settings="settings",e.Share="share",e.SimpleTag="simple-tag",e.Snap="snap",e.StartLocation="start-location",e.StemHeight="stem-height",e.TapeMeasure="tape-measure",e.TogglePencil="toggle-pencil",e.Toolbar_360View="toolbar-360-view",e.ToolbarEditVr="toolbar-edit-vr",e.ToolbarHlr="toolbar-hlr",e.ToolbarLabels="toolbar-labels",e.ToolbarMattertags="toolbar-mattertags",e.ToolbarMeasurements="toolbar-measurements",e.ToolbarMoreHoriz="toolbar-more-horiz",e.ToolbarPhotos="toolbar-photos",e.ToolbarScanMgmt="toolbar-scan-mgmt",e.ToolbarStartLocation="toolbar-start-location",e.Transitions="transitions",e.TrimKeep="trim-keep",e.TrimRemove="trim-remove",e.Twitter="twitter",e.User="user",e.Vr="vr",e.ZoomReset="zoom-reset"}(cc||(cc={}));const hc={[cc.i360]:"61697",[cc.Arrows]:"61698",[cc.Attach]:"61699",[cc.Back]:"61700",[cc.Blocked]:"61701",[cc.BlurOutline]:"61702",[cc.BrushOutline]:"61703",[cc.Checkmark]:"61704",[cc.ChevronLeft]:"61705",[cc.ChevronRight]:"61706",[cc.Close]:"61707",[cc.CommentOutline]:"61708",[cc.Comment]:"61709",[cc.Delete]:"61710",[cc.Dock]:"61711",[cc.Dollhouse]:"61712",[cc.Download]:"61713",[cc.DpadDown]:"61714",[cc.DpadLeft]:"61715",[cc.DpadRight]:"61716",[cc.DpadUp]:"61717",[cc.DragEdit]:"61718",[cc.DrawLines]:"61719",[cc.Email]:"61720",[cc.Error]:"61721",[cc.EscapeKey]:"61722",[cc.ExtLink]:"61723",[cc.EyeHide]:"61724",[cc.EyeShow]:"61725",[cc.Facebook]:"61726",[cc.File]:"61727",[cc.FingerDrag]:"61728",[cc.FloorControlsAll]:"61729",[cc.FloorControls]:"61730",[cc.Floorplan]:"61731",[cc.FullscreenExit]:"61732",[cc.Fullscreen]:"61733",[cc.Fullscreen2]:"61734",[cc.Help]:"61735",[cc.HlrBadge]:"61736",[cc.Hlr]:"61737",[cc.Info]:"61738",[cc.Link]:"61739",[cc.Linkedin]:"61740",[cc.List]:"61741",[cc.Location]:"61742",[cc.MagnifyingGlass]:"61743",[cc.MediaMix]:"61744",[cc.MeshTrim]:"61745",[cc.Mesh]:"61746",[cc.Minus]:"61747",[cc.MoreVert]:"61748",[cc.Notes]:"61749",[cc.PanoramaDisable]:"61750",[cc.Panorama]:"61751",[cc.PaperClip]:"61752",[cc.PauseOutline]:"61753",[cc.Pause]:"61754",[cc.Photo_2d]:"61755",[cc.Photo_360]:"61756",[cc.PhotoAdd]:"61757",[cc.Pin]:"61758",[cc.Pinterest]:"61759",[cc.PlayUnicode]:"61760",[cc.Play]:"61761",[cc.Plus]:"61762",[cc.Position_3d]:"61763",[cc.PressHold]:"61764",[cc.Question]:"61765",[cc.Reorder]:"61766",[cc.Reply]:"61767",[cc.Revert]:"61768",[cc.RotateLeft]:"61769",[cc.RotateRight]:"61770",[cc.Rotate]:"61771",[cc.Rotation_3d]:"61772",[cc.Scale_3d]:"61773",[cc.Settings]:"61774",[cc.Share]:"61775",[cc.SimpleTag]:"61776",[cc.Snap]:"61777",[cc.StartLocation]:"61778",[cc.StemHeight]:"61779",[cc.TapeMeasure]:"61780",[cc.TogglePencil]:"61781",[cc.Toolbar_360View]:"61782",[cc.ToolbarEditVr]:"61783",[cc.ToolbarHlr]:"61784",[cc.ToolbarLabels]:"61785",[cc.ToolbarMattertags]:"61786",[cc.ToolbarMeasurements]:"61787",[cc.ToolbarMoreHoriz]:"61788",[cc.ToolbarPhotos]:"61789",[cc.ToolbarScanMgmt]:"61790",[cc.ToolbarStartLocation]:"61791",[cc.Transitions]:"61792",[cc.TrimKeep]:"61793",[cc.TrimRemove]:"61794",[cc.Twitter]:"61795",[cc.User]:"61796",[cc.Vr]:"61797",[cc.ZoomReset]:"61798"};Object.keys(hc).sort(((e,t)=>e.localeCompare(t)));let uc=Ac();const pc=e=>xc(e,uc);let mc=Ac();pc.write=e=>xc(e,mc);let fc=Ac();pc.onStart=e=>xc(e,fc);let gc=Ac();pc.onFrame=e=>xc(e,gc);let vc=Ac();pc.onFinish=e=>xc(e,vc);let yc=[];pc.setTimeout=(e,t)=>{let i=pc.now()+t,n=()=>{let e=yc.findIndex((e=>e.cancel==n));~e&&yc.splice(e,1),Tc-=~e?1:0},s={time:i,handler:e,cancel:n};return yc.splice(bc(i),0,s),Tc+=1,_c(),s};let bc=e=>~(~yc.findIndex((t=>t.time>e))||~yc.length);pc.cancel=e=>{fc.delete(e),gc.delete(e),uc.delete(e),mc.delete(e),vc.delete(e)},pc.sync=e=>{wc=!0,pc.batchedUpdates(e),wc=!1},pc.throttle=e=>{let t;function i(){try{e(...t)}finally{t=null}}function n(...e){t=e,pc.onStart(i)}return n.handler=e,n.cancel=()=>{fc.delete(i),t=null},n};let Sc="undefined"!=typeof window?window.requestAnimationFrame:()=>{};pc.use=e=>Sc=e,pc.now="undefined"!=typeof performance?()=>performance.now():Date.now,pc.batchedUpdates=e=>e(),pc.catch=console.error,pc.frameLoop="always",pc.advance=()=>{"demand"!==pc.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):Oc()};let Ec=-1,Tc=0,wc=!1;function xc(e,t){wc?(t.delete(e),e(0)):(t.add(e),_c())}function _c(){Ec<0&&(Ec=0,"demand"!==pc.frameLoop&&Sc(Mc))}function Mc(){~Ec&&(Sc(Mc),pc.batchedUpdates(Oc))}function Oc(){let e=Ec;Ec=pc.now();let t=bc(Ec);t&&(Cc(yc.splice(0,t),(e=>e.handler())),Tc-=t),fc.flush(),uc.flush(e?Math.min(64,Ec-e):16.667),gc.flush(),mc.flush(),vc.flush(),Tc||(Ec=-1)}function Ac(){let e=new Set,t=e;return{add(i){Tc+=t!=e||e.has(i)?0:1,e.add(i)},delete:i=>(Tc-=t==e&&e.has(i)?1:0,e.delete(i)),flush(i){t.size&&(e=new Set,Tc-=t.size,Cc(t,(t=>t(i)&&e.add(t))),Tc+=e.size,t=e)}}}function Cc(e,t){e.forEach((e=>{try{t(e)}catch(e){pc.catch(e)}}))}const Pc={arr:Array.isArray,obj:e=>!!e&&"Object"===e.constructor.name,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,und:e=>void 0===e};const Dc=(e,t)=>e.forEach(t);function Nc(e,t,i){if(Pc.arr(e))for(let n=0;n<e.length;n++)t.call(i,e[n],`${n}`);else for(const n in e)e.hasOwnProperty(n)&&t.call(i,e[n],n)}const Ic=e=>Pc.und(e)?[]:Pc.arr(e)?e:[e];const Lc=()=>"undefined"==typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent);let Rc,kc,Uc=null,Bc=!1,Fc=function(){};var Vc=Object.freeze({__proto__:null,get createStringInterpolator(){return Rc},get to(){return kc},get colors(){return Uc},get skipAnimation(){return Bc},get willAdvance(){return Fc},assign:e=>{e.to&&(kc=e.to),e.now&&(pc.now=e.now),void 0!==e.colors&&(Uc=e.colors),null!=e.skipAnimation&&(Bc=e.skipAnimation),e.createStringInterpolator&&(Rc=e.createStringInterpolator),e.requestAnimationFrame&&pc.use(e.requestAnimationFrame),e.batchedUpdates&&(pc.batchedUpdates=e.batchedUpdates),e.willAdvance&&(Fc=e.willAdvance),e.frameLoop&&(pc.frameLoop=e.frameLoop)}});const Hc=new Set;let jc=[],Gc=[],zc=0;const Wc={get idle(){return!Hc.size&&!jc.length},start(e){zc>e.priority?(Hc.add(e),pc.onStart(Kc)):(Yc(e),pc(Zc))},advance:Zc,sort(e){if(zc)pc.onFrame((()=>Wc.sort(e)));else{const t=jc.indexOf(e);~t&&(jc.splice(t,1),qc(e))}},clear(){jc=[],Hc.clear()}};function Kc(){Hc.forEach(Yc),Hc.clear(),pc(Zc)}function Yc(e){jc.includes(e)||qc(e)}function qc(e){jc.splice(function(e,t){const i=e.findIndex(t);return i<0?e.length:i}(jc,(t=>t.priority>e.priority)),0,e)}function Zc(e){const t=Gc;for(let i=0;i<jc.length;i++){const n=jc[i];zc=n.priority,n.idle||(Fc(n),n.advance(e),n.idle||t.push(n))}return zc=0,Gc=jc,Gc.length=0,jc=t,jc.length>0}const $c="[-+]?\\d*\\.?\\d+",Qc=$c+"%";function Xc(...e){return"\\(\\s*("+e.join(")\\s*,\\s*(")+")\\s*\\)"}const Jc=new RegExp("rgb"+Xc($c,$c,$c)),ed=new RegExp("rgba"+Xc($c,$c,$c,$c)),td=new RegExp("hsl"+Xc($c,Qc,Qc)),id=new RegExp("hsla"+Xc($c,Qc,Qc,$c)),nd=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,sd=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,rd=/^#([0-9a-fA-F]{6})$/,od=/^#([0-9a-fA-F]{8})$/;function ad(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}function ld(e,t,i){const n=i<.5?i*(1+t):i+t-i*t,s=2*i-n,r=ad(s,n,e+1/3),o=ad(s,n,e),a=ad(s,n,e-1/3);return Math.round(255*r)<<24|Math.round(255*o)<<16|Math.round(255*a)<<8}function cd(e){const t=parseInt(e,10);return t<0?0:t>255?255:t}function dd(e){return(parseFloat(e)%360+360)%360/360}function hd(e){const t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function ud(e){const t=parseFloat(e);return t<0?0:t>100?1:t/100}function pd(e){let t=function(e){let t;return"number"==typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=rd.exec(e))?parseInt(t[1]+"ff",16)>>>0:Uc&&void 0!==Uc[e]?Uc[e]:(t=Jc.exec(e))?(cd(t[1])<<24|cd(t[2])<<16|cd(t[3])<<8|255)>>>0:(t=ed.exec(e))?(cd(t[1])<<24|cd(t[2])<<16|cd(t[3])<<8|hd(t[4]))>>>0:(t=nd.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=od.exec(e))?parseInt(t[1],16)>>>0:(t=sd.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=td.exec(e))?(255|ld(dd(t[1]),ud(t[2]),ud(t[3])))>>>0:(t=id.exec(e))?(ld(dd(t[1]),ud(t[2]),ud(t[3]))|hd(t[4]))>>>0:null}(e);return null===t?e:(t=t||0,`rgba(${(4278190080&t)>>>24}, ${(16711680&t)>>>16}, ${(65280&t)>>>8}, ${(255&t)/255})`)}const md=(e,t,i)=>{if(Pc.fun(e))return e;if(Pc.arr(e))return md({range:e,output:t,extrapolate:i});if(Pc.str(e.output[0]))return Rc(e);const n=e,s=n.output,r=n.range||[0,1],o=n.extrapolateLeft||n.extrapolate||"extend",a=n.extrapolateRight||n.extrapolate||"extend",l=n.easing||(e=>e);return e=>{const t=function(e,t){for(var i=1;i<t.length-1&&!(t[i]>=e);++i);return i-1}(e,r);return function(e,t,i,n,s,r,o,a,l){let c=l?l(e):e;if(c<t){if("identity"===o)return c;"clamp"===o&&(c=t)}if(c>i){if("identity"===a)return c;"clamp"===a&&(c=i)}if(n===s)return n;if(t===i)return e<=t?n:s;t===-1/0?c=-c:i===1/0?c-=t:c=(c-t)/(i-t);c=r(c),n===-1/0?c=-c:s===1/0?c+=n:c=c*(s-n)+n;return c}(e,r[t],r[t+1],s[t],s[t+1],l,o,a,n.map)}};function fd(){return(fd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}const gd=Symbol.for("FluidValue.get"),vd=Symbol.for("FluidValue.observers"),yd=e=>Boolean(e&&e[gd]),bd=e=>e&&e[gd]?e[gd]():e;function Sd(e,t){let i=e[vd];i&&i.forEach((e=>{!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}class FluidValue{constructor(e){if(this[gd]=void 0,this[vd]=void 0,!e&&!(e=this.get))throw Error("Unknown getter");Ed(this,e)}}const Ed=(e,t)=>xd(e,gd,t);function Td(e,t){if(e[gd]){let i=e[vd];i||xd(e,vd,i=new Set),i.has(t)||(i.add(t),e.observerAdded&&e.observerAdded(i.size,t))}return t}function wd(e,t){let i=e[vd];if(i&&i.has(t)){const n=i.size-1;n?i.delete(t):e[vd]=null,e.observerRemoved&&e.observerRemoved(n,t)}}const xd=(e,t,i)=>Object.defineProperty(e,t,{value:i,writable:!0,configurable:!0}),_d=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Md=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,Od=new RegExp(`(${_d.source})(%|[a-z]+)`,"i"),Ad=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Cd=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Pd=e=>{const[t,i]=Dd(e);if(!t||Lc())return e;const n=window.getComputedStyle(document.documentElement).getPropertyValue(t);if(n)return n.trim();if(i&&i.startsWith("--")){const t=window.getComputedStyle(document.documentElement).getPropertyValue(i);return t||e}return i&&Cd.test(i)?Pd(i):i||e},Dd=e=>{const t=Cd.exec(e);if(!t)return[,];const[,i,n]=t;return[i,n]};let Nd;const Id=(e,t,i,n,s)=>`rgba(${Math.round(t)}, ${Math.round(i)}, ${Math.round(n)}, ${s})`,Ld=e=>{Nd||(Nd=Uc?new RegExp(`(${Object.keys(Uc).join("|")})(?!\\w)`,"g"):/^\b$/);const t=e.output.map((e=>bd(e).replace(Cd,Pd).replace(Md,pd).replace(Nd,pd))),i=t.map((e=>e.match(_d).map(Number))),n=i[0].map(((e,t)=>i.map((e=>{if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]})))).map((t=>md(fd({},e,{output:t}))));return e=>{var i;const s=!Od.test(t[0])&&(null==(i=t.find((e=>Od.test(e))))?void 0:i.replace(_d,""));let r=0;return t[0].replace(_d,(()=>`${n[r++](e)}${s||""}`)).replace(Ad,Id)}},Rd="react-spring: ",kd=e=>{const t=e;let i=!1;if("function"!=typeof t)throw new TypeError(`${Rd}once requires a function parameter`);return(...e)=>{i||(t(...e),i=!0)}},Ud=kd(console.warn);kd(console.warn);function Bd(e){return Pc.str(e)&&("#"==e[0]||/\d/.test(e)||!Lc()&&Cd.test(e)||e in(Uc||{}))}const Fd=e=>(0,r.useEffect)(e,Vd),Vd=[];function Hd(){const e={current:!0,unmount:()=>()=>{e.current=!1}};return e}const jd="undefined"!=typeof window&&window.document&&window.document.createElement?r.useLayoutEffect:r.useEffect,Gd=Symbol.for("Animated:node"),zd=e=>e&&e[Gd],Wd=(e,t)=>{return i=e,n=Gd,s=t,Object.defineProperty(i,n,{value:s,writable:!0,configurable:!0});var i,n,s},Kd=e=>e&&e[Gd]&&e[Gd].getPayload();class Animated{constructor(){this.payload=void 0,Wd(this,this)}getPayload(){return this.payload||[]}}class react_spring_animated_esm_AnimatedValue extends Animated{constructor(e){super(),this.done=!0,this.elapsedTime=void 0,this.lastPosition=void 0,this.lastVelocity=void 0,this.v0=void 0,this.durationProgress=0,this._value=e,Pc.num(this._value)&&(this.lastPosition=this._value)}static create(e){return new react_spring_animated_esm_AnimatedValue(e)}getPayload(){return[this]}getValue(){return this._value}setValue(e,t){return Pc.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}reset(){const{done:e}=this;this.done=!1,Pc.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}class react_spring_animated_esm_AnimatedString extends react_spring_animated_esm_AnimatedValue{constructor(e){super(0),this._string=null,this._toString=void 0,this._toString=md({output:[e,e]})}static create(e){return new react_spring_animated_esm_AnimatedString(e)}getValue(){let e=this._string;return null==e?this._string=this._toString(this._value):e}setValue(e){if(Pc.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!super.setValue(e))return!1;this._string=null}return!0}reset(e){e&&(this._toString=md({output:[this.getValue(),e]})),this._value=0,super.reset()}}const Yd={dependencies:null};class AnimatedObject extends Animated{constructor(e){super(),this.source=e,this.setValue(e)}getValue(e){const t={};return Nc(this.source,((i,n)=>{var s;(s=i)&&s[Gd]===s?t[n]=i.getValue(e):yd(i)?t[n]=bd(i):e||(t[n]=i)})),t}setValue(e){this.source=e,this.payload=this._makePayload(e)}reset(){this.payload&&Dc(this.payload,(e=>e.reset()))}_makePayload(e){if(e){const t=new Set;return Nc(e,this._addToPayload,t),Array.from(t)}}_addToPayload(e){Yd.dependencies&&yd(e)&&Yd.dependencies.add(e);const t=Kd(e);t&&Dc(t,(e=>this.add(e)))}}class AnimatedArray extends AnimatedObject{constructor(e){super(e)}static create(e){return new AnimatedArray(e)}getValue(){return this.source.map((e=>e.getValue()))}setValue(e){const t=this.getPayload();return e.length==t.length?t.map(((t,i)=>t.setValue(e[i]))).some(Boolean):(super.setValue(e.map(qd)),!0)}}function qd(e){return(Bd(e)?react_spring_animated_esm_AnimatedString:react_spring_animated_esm_AnimatedValue).create(e)}function Zd(){return(Zd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}const $d=(e,t)=>{const i=!Pc.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,r.forwardRef)(((n,s)=>{const o=(0,r.useRef)(null),a=i&&(0,r.useCallback)((e=>{o.current=function(e,t){e&&(Pc.fun(e)?e(t):e.current=t);return t}(s,e)}),[s]),[l,c]=function(e,t){const i=new Set;Yd.dependencies=i,e.style&&(e=Zd({},e,{style:t.createAnimatedStyle(e.style)}));return e=new AnimatedObject(e),Yd.dependencies=null,[e,i]}(n,t),d=function(){const e=(0,r.useState)()[1],t=(0,r.useState)(Hd)[0];return Fd(t.unmount),()=>{t.current&&e({})}}(),h=()=>{const e=o.current;if(i&&!e)return;!1===(!!e&&t.applyAnimatedValues(e,l.getValue(!0)))&&d()},u=new PropsObserver(h,c),p=(0,r.useRef)();jd((()=>{const e=p.current;p.current=u,Dc(c,(e=>Td(e,u))),e&&(Dc(e.deps,(t=>wd(t,e))),pc.cancel(e.update))})),(0,r.useEffect)(h,[]),Fd((()=>()=>{const e=p.current;Dc(e.deps,(t=>wd(t,e)))}));const m=t.getComponentProps(l.getValue());return r.createElement(e,Zd({},m,{ref:a}))}))};class PropsObserver{constructor(e,t){this.update=e,this.deps=t}eventObserved(e){"change"==e.type&&pc.write(this.update)}}const Qd=Symbol.for("AnimatedComponent"),Xd=e=>Pc.str(e)?e:e&&Pc.str(e.displayName)?e.displayName:Pc.fun(e)&&e.name||null;function Jd(){return(Jd=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}const eh=1.70158,th=1.525*eh,ih=eh+1,nh=2*Math.PI/3,sh=2*Math.PI/4.5,rh=e=>{const t=7.5625,i=2.75;return e<1/i?t*e*e:e<2/i?t*(e-=1.5/i)*e+.75:e<2.5/i?t*(e-=2.25/i)*e+.9375:t*(e-=2.625/i)*e+.984375};Jd({},{tension:170,friction:26},{mass:1,damping:1,easing:{linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>1-(1-e)*(1-e),easeInOutQuad:e=>e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2,easeInCubic:e=>e*e*e,easeOutCubic:e=>1-Math.pow(1-e,3),easeInOutCubic:e=>e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1-Math.pow(1-e,4),easeInOutQuart:e=>e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1-Math.pow(1-e,5),easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>0===e?0:Math.pow(2,10*e-10),easeOutExpo:e=>1===e?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2,easeInCirc:e=>1-Math.sqrt(1-Math.pow(e,2)),easeOutCirc:e=>Math.sqrt(1-Math.pow(e-1,2)),easeInOutCirc:e=>e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2,easeInBack:e=>ih*e*e*e-eh*e*e,easeOutBack:e=>1+ih*Math.pow(e-1,3)+eh*Math.pow(e-1,2),easeInOutBack:e=>e<.5?Math.pow(2*e,2)*(7.189819*e-th)/2:(Math.pow(2*e-2,2)*((th+1)*(2*e-2)+th)+2)/2,easeInElastic:e=>0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*nh),easeOutElastic:e=>0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*nh)+1,easeInOutElastic:e=>0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*sh)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*sh)/2+1,easeInBounce:e=>1-rh(1-e),easeOutBounce:rh,easeInOutBounce:e=>e<.5?(1-rh(1-2*e))/2:(1+rh(2*e-1))/2}.linear,clamp:!1});Error;Error;const oh=e=>e instanceof FrameValue;let ah=1;class FrameValue extends FluidValue{constructor(...e){super(...e),this.id=ah++,this.key=void 0,this._priority=0}get priority(){return this._priority}set priority(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}get(){const e=zd(this);return e&&e.getValue()}to(...e){return Vc.to(this,e)}interpolate(...e){return Ud(`${Rd}The "interpolate" function is deprecated in v9 (use "to" instead)`),Vc.to(this,e)}toJSON(){return this.get()}observerAdded(e){1==e&&this._attach()}observerRemoved(e){0==e&&this._detach()}_attach(){}_detach(){}_onChange(e,t=!1){Sd(this,{type:"change",parent:this,value:e,idle:t})}_onPriorityChange(e){this.idle||Wc.sort(this),Sd(this,{type:"priority",parent:this,priority:e})}}Symbol.for("SpringPhase");function lh(e,t){if(null==e)return{};var i,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(s[i]=e[i]);return s}const ch=["children"],dh=e=>{let{children:t}=e,i=lh(e,ch);const n=(0,r.useContext)(hh),s=i.pause||!!n.pause,o=i.immediate||!!n.immediate;i=function(e,t){const[i]=(0,r.useState)((()=>({inputs:t,result:e()}))),n=(0,r.useRef)(),s=n.current;let o=s;o?Boolean(t&&o.inputs&&function(e,t){if(e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}(t,o.inputs))||(o={inputs:t,result:e()}):o=i;return(0,r.useEffect)((()=>{n.current=o,s==i&&(i.inputs=i.result=void 0)}),[o]),o.result}((()=>({pause:s,immediate:o})),[s,o]);const{Provider:a}=hh;return r.createElement(a,{value:i},t)},hh=(uh=dh,ph={},Object.assign(uh,r.createContext(ph)),uh.Provider._context=uh,uh.Consumer._context=uh,uh);var uh,ph;dh.Provider=hh.Provider,dh.Consumer=hh.Consumer;let mh;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(mh||(mh={}));class Interpolation extends FrameValue{constructor(e,t){super(),this.key=void 0,this.idle=!0,this.calc=void 0,this._active=new Set,this.source=e,this.calc=md(...t);const i=this._get(),n=function(e){const t=zd(e);return t?t.constructor:Pc.arr(e)?AnimatedArray:Bd(e)?react_spring_animated_esm_AnimatedString:react_spring_animated_esm_AnimatedValue}(i);Wd(this,n.create(i))}advance(e){const t=this._get();(function(e,t){if(Pc.arr(e)){if(!Pc.arr(t)||e.length!==t.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==t[i])return!1;return!0}return e===t})(t,this.get())||(zd(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&gh(this._active)&&vh(this)}_get(){const e=Pc.arr(this.source)?this.source.map(bd):Ic(bd(this.source));return this.calc(...e)}_start(){this.idle&&!gh(this._active)&&(this.idle=!1,Dc(Kd(this),(e=>{e.done=!1})),Vc.skipAnimation?(pc.batchedUpdates((()=>this.advance())),vh(this)):Wc.start(this))}_attach(){let e=1;Dc(Ic(this.source),(t=>{yd(t)&&Td(t,this),oh(t)&&(t.idle||this._active.add(t),e=Math.max(e,t.priority+1))})),this.priority=e,this._start()}_detach(){Dc(Ic(this.source),(e=>{yd(e)&&wd(e,this)})),this._active.clear(),vh(this)}eventObserved(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=Ic(this.source).reduce(((e,t)=>Math.max(e,(oh(t)?t.priority:0)+1)),0))}}function fh(e){return!1!==e.idle}function gh(e){return!e.size||Array.from(e).every(fh)}function vh(e){e.idle||(e.idle=!0,Dc(Kd(e),(e=>{e.done=!0})),Sd(e,{type:"idle",parent:e}))}Vc.assign({createStringInterpolator:Ld,to:(e,t)=>new Interpolation(e,t)});Wc.advance;function yh(e,t){if(null==e)return{};var i,n,s={},r=Object.keys(e);for(n=0;n<r.length;n++)i=r[n],t.indexOf(i)>=0||(s[i]=e[i]);return s}const bh=["style","children","scrollTop","scrollLeft"],Sh=/^--/;function Eh(e,t){return null==t||"boolean"==typeof t||""===t?"":"number"!=typeof t||0===t||Sh.test(e)||wh.hasOwnProperty(e)&&wh[e]?(""+t).trim():t+"px"}const Th={};let wh={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0};const xh=["Webkit","Ms","Moz","O"];wh=Object.keys(wh).reduce(((e,t)=>(xh.forEach((i=>e[((e,t)=>e+t.charAt(0).toUpperCase()+t.substring(1))(i,t)]=e[t])),e)),wh);const _h=["x","y","z"],Mh=/^(matrix|translate|scale|rotate|skew)/,Oh=/^(translate)/,Ah=/^(rotate|skew)/,Ch=(e,t)=>Pc.num(e)&&0!==e?e+t:e,Ph=(e,t)=>Pc.arr(e)?e.every((e=>Ph(e,t))):Pc.num(e)?e===t:parseFloat(e)===t;class AnimatedStyle extends AnimatedObject{constructor(e){let{x:t,y:i,z:n}=e,s=yh(e,_h);const r=[],o=[];(t||i||n)&&(r.push([t||0,i||0,n||0]),o.push((e=>[`translate3d(${e.map((e=>Ch(e,"px"))).join(",")})`,Ph(e,0)]))),Nc(s,((e,t)=>{if("transform"===t)r.push([e||""]),o.push((e=>[e,""===e]));else if(Mh.test(t)){if(delete s[t],Pc.und(e))return;const i=Oh.test(t)?"px":Ah.test(t)?"deg":"";r.push(Ic(e)),o.push("rotate3d"===t?([e,t,n,s])=>[`rotate3d(${e},${t},${n},${Ch(s,i)})`,Ph(s,0)]:e=>[`${t}(${e.map((e=>Ch(e,i))).join(",")})`,Ph(e,t.startsWith("scale")?1:0)])}})),r.length&&(s.transform=new FluidTransform(r,o)),super(s)}}class FluidTransform extends FluidValue{constructor(e,t){super(),this._value=null,this.inputs=e,this.transforms=t}get(){return this._value||(this._value=this._get())}_get(){let e="",t=!0;return Dc(this.inputs,((i,n)=>{const s=bd(i[0]),[r,o]=this.transforms[n](Pc.arr(s)?s:i.map(bd));e+=" "+r,t=t&&o})),t?"none":e}observerAdded(e){1==e&&Dc(this.inputs,(e=>Dc(e,(e=>yd(e)&&Td(e,this)))))}observerRemoved(e){0==e&&Dc(this.inputs,(e=>Dc(e,(e=>yd(e)&&wd(e,this)))))}eventObserved(e){"change"==e.type&&(this._value=null),Sd(this,e)}}const Dh=["scrollTop","scrollLeft"];Vc.assign({batchedUpdates:o.unstable_batchedUpdates,createStringInterpolator:Ld,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199}});((e,{applyAnimatedValues:t=(()=>!1),createAnimatedStyle:i=(e=>new AnimatedObject(e)),getComponentProps:n=(e=>e)}={})=>{const s={applyAnimatedValues:t,createAnimatedStyle:i,getComponentProps:n},r=e=>{const t=Xd(e)||"Anonymous";return(e=Pc.str(e)?r[e]||(r[e]=$d(e,s)):e[Qd]||(e[Qd]=$d(e,s))).displayName=`Animated(${t})`,e};return Nc(e,((t,i)=>{Pc.arr(e)&&(i=Xd(t)),r[i]=r(t)})),{animated:r}})(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],{applyAnimatedValues:function(e,t){if(!e.nodeType||!e.setAttribute)return!1;const i="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,n=t,{style:s,children:r,scrollTop:o,scrollLeft:a}=n,l=yh(n,bh),c=Object.values(l),d=Object.keys(l).map((t=>i||e.hasAttribute(t)?t:Th[t]||(Th[t]=t.replace(/([A-Z])/g,(e=>"-"+e.toLowerCase())))));void 0!==r&&(e.textContent=r);for(let t in s)if(s.hasOwnProperty(t)){const i=Eh(t,s[t]);Sh.test(t)?e.style.setProperty(t,i):e.style[t]=i}d.forEach(((t,i)=>{e.setAttribute(t,c[i])})),void 0!==o&&(e.scrollTop=o),void 0!==a&&(e.scrollLeft=a)},createAnimatedStyle:e=>new AnimatedStyle(e),getComponentProps:e=>yh(e,Dh)}).animated;var Nh=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ih=class ListNavigation extends r.Component{constructor(){super(...arguments),this.onGotoNext=()=>{const e=this.getNextIndex();-1!==e&&this.props.onNavigate(e)},this.onGotoPrev=()=>{const e=this.getPrevIndex();-1!==e&&this.props.onNavigate(e)}}getNextIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t+1<e?t+1:i?0:-1}getPrevIndex(){const{total:e,index:t,wrapAround:i}=this.props;return t>0?t-1:i?e-1:-1}render(){const{total:e,index:t,disabled:i,overlay:n}=this.props;if(e<2||-1===t)return null;const s=n?"dark":"light",r=n?lc.SMALL:lc.LARGE,o=`${t+1} of ${e}`;return(0,l.jsxs)("div",Object.assign({className:"list-nav"},{children:[(0,l.jsx)(dc,{icon:"dpad-left",variant:ac.TERTIARY,size:r,disabled:i,theme:s,onClick:this.onGotoPrev},void 0),(0,l.jsx)("span",Object.assign({className:"list-nav-label"},{children:o}),void 0),(0,l.jsx)(dc,{icon:"dpad-right",variant:ac.TERTIARY,size:r,disabled:i,theme:s,onClick:this.onGotoNext},void 0)]}),void 0)}};Ih=Nh([I.Z],Ih);var Lh=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Rh=class TagsNavigationBar extends r.Component{constructor(e){super(e),this.bindings=[],this.isUnmounting=!1,this.updateListIndex=()=>{this.isUnmounting||this.setState({listIndex:this.tagsViewData.listIndex,navigating:!1})},this.updateOpenTag=()=>{this.isUnmounting||this.setState({openTagView:this.tagsViewData.openTagView})},this.updateTags=()=>{this.isUnmounting||this.setState({numTags:this.tagsViewData.tagViewList.values().length})},this.onNavigateList=e=>{const t=this.tagsViewData.getCurrentTagViewByIndex(e);if(!t)return;this.setState({listIndex:e,navigating:!0});const{openTagView:i}=this.state,{toolPanelLayout:n}=this.props,s=i?n===p.wS.BOTTOM_PANEL?Be.n.Instant:Be.n.FadeToBlack:Be.n.Interpolate;this.context.commandBinder.issueCommand(new kr.lt(t.id,s,null))},this.state={openTagView:null,listIndex:-1,numTags:0,navigating:!1}}componentDidMount(){const{market:e}=this.context;Promise.all([e.waitForData(Wa.n)]).then((e=>{[this.tagsViewData]=e,this.bindings.push(this.tagsViewData.onListIndexChanged(this.updateListIndex),this.tagsViewData.onOpenTagViewChanged(this.updateOpenTag),this.tagsViewData.tagViewList.onChanged(this.updateTags)),this.updateOpenTag(),this.updateTags(),this.updateListIndex()}))}componentWillUnmount(){this.isUnmounting=!0;for(const e of this.bindings)e.cancel()}render(){const{overlay:e}=this.props,{openTagView:t,listIndex:i,numTags:n,navigating:s}=this.state;return t&&n>1?(0,l.jsx)(Ih,{index:i,total:n,disabled:s,overlay:e,wrapAround:!0,onNavigate:this.onNavigateList},void 0):null}};Rh.contextType=m.I,Rh=Lh([I.Z],Rh);var kh=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Uh=class TagsPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.closeTagsPanel=()=>{this.context.commandBinder.issueCommand(new it.tT(p.w1.TAGS,!1))},this.onUndockTag=()=>{const{tagView:e}=this.state;e&&this.context.commandBinder.issueCommand(new kr.lt(e.id,null,!1))},this.updateCurrentTag=async()=>{const{openTagView:e}=this.props.manager.dataMap.tagsViewData;this.setState({tagView:e})},this.state={tagView:null}}componentDidMount(){const{tagsViewData:e}=this.props.manager.dataMap;this.bindings.push(e.onOpenTagViewChanged(this.updateCurrentTag)),this.updateCurrentTag()}componentWillUnmount(){for(const e of this.bindings)e.cancel()}render(){const{tagView:e}=this.state;if(!e)return null;const{toolPanelLayout:t}=this.props,i=t===p.wS.BOTTOM_PANEL||t===p.wS.NARROW;return(0,l.jsxs)(DetailPanel,Object.assign({className:"tags-panel",open:!0,overPanel:!1,toolPanelLayout:t,scrollingDisabled:!1},{children:[(0,l.jsxs)("div",Object.assign({className:"detail-panel-header"},{children:[!i&&(0,l.jsx)(T.hU,{iconClass:"icon-chevron-left",buttonStyle:T.Dd.PLAIN,onClick:this.onUndockTag,tooltipMsg:"Undock",tooltipPosition:x.lZ.DOWN},void 0),(0,l.jsx)(Rh,{toolPanelLayout:t},void 0),(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.PLAIN,onClick:this.closeTagsPanel},void 0)]}),void 0),(0,l.jsx)(Va,{tagView:e,toolPanelLayout:t},void 0)]}),void 0)}};Uh.contextType=m.I,Uh=kh([I.Z],Uh);var Bh=i(48470),Fh=i(8752),Vh=i(2904),Hh=i(94536),jh=i(15881),Gh=i(67166),zh=i(22151),Wh=i(91735),Kh=i(7683),Yh=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let qh=class SmartTextEditor extends r.Component{constructor(e){super(e),this.emailMention=!1,this.wordToken=null,this.endTokens={"@":[","," ","!","?","/",";",":","(",")"],"#":[","," ",".","!","?","/",";",":"]},this.wordElement=null,this.linkElement=null,this.onClickAnchor=e=>{const t=e.target,i=t.dataset.blocktype;this.props.active?(e.preventDefault(),i===zi.C.LINK&&this.prepareLinkForEdit(t)):i&&this.props.onClickBlock({blockType:i,text:t.innerText,value:t.dataset.value,id:t.dataset.id})},this.onSelectionChange=()=>{const e=this.getCurrentRange();if(e){this.range=e.cloneRange();const t=this.wordElement&&null===this.wordElement.parentElement,i=!!this.wordElement&&this.wordElement!==this.getAnchorFromSelection();(t||i)&&this.wordElement&&(this.wordElement.classList.add("link-annotation-active"),this.endWordMatching()),this.insertFocusNodeIfNeeded()}},this.addFauxHighlight=()=>{this.execCommand("backColor","#ff315840")},this.removeFauxHighlight=()=>{this.execCommand("backColor","transparent")},this.isEmailMention=(e="")=>e.lastIndexOf("@")>0,this.onInput=e=>{var t;const i=e.nativeEvent,n=i.inputType,s=n.startsWith("insert"),r="insertLineBreak"===n,o=i.data,a=this.startTokens;e.stopPropagation();const{isLinkNode:l,isSpecialNode:c,anchorNode:d}=this.tryGetAnchorNode();if(a.length&&!l&&!r){let r=o&&o.length>0?o.charAt(o.length-1):"";const l=this.getTextElement(),h=((null==l?void 0:l.innerText)||"").trim().length;if(l&&n.startsWith("delete")&&0===h&&(l.innerHTML=""),this.updateWordElement(i,c,d),!this.wordToken&&a.includes(r)?(e.preventDefault(),this.wordToken=r,this.emailMention=!1,this.createWordElement(r),this.updateSuggestions()):!this.wordToken&&o&&o.length>1&&a.includes(o[0])&&(e.preventDefault(),this.wordToken=o[0],r=o[o.length-1],this.emailMention=this.isEmailMention(o),this.createWordElement(o),this.updateSuggestions()),this.wordToken&&this.wordElement){const i=this.wordElement.textContent||"",n=this.getMatches(i),o=n.length,a=null===(t=this.endTokens[this.wordToken])||void 0===t?void 0:t.includes(r);1===o&&this.sanitizeForSearch(i)===this.sanitizeForSearch(n[0].text)&&s?(e.preventDefault(),this.chooseMatch(n[0].text,n[0].value,n[0].id)):a&&"#"===this.wordToken?(e.preventDefault(),this.finishWordElement(!0)):a&&"@"===this.wordToken?(e.preventDefault(),this.emailMention?this.finishWordElement(!0):0===o&&this.clearWordElement()):"@"===this.wordToken?(this.updateUserMatches(),this.isEmailMention(i)&&(this.wordElement.classList.add("link-annotation-active"),this.emailMention=!0)):this.filterSuggestions()}}this.props.onInput(this.getMarkdown())},this.updateUserMatches=(0,Je.D)((()=>this.fetchUserMatches()),350),this.onClickMatch=e=>{const t=e.currentTarget;if(t){const i=t.dataset.value,n=t.dataset.id,s=t.dataset.text||t.innerText;e.stopPropagation(),e.preventDefault(),this.chooseMatch(s,i,n)}},this.onHoverMatch=e=>{const t=e.currentTarget;if(t){const e=parseInt(t.dataset.index||"0",10);this.setState({activeMatch:e})}},this.onClick=e=>{const{active:t,clickToEdit:i,onStartEditing:n}=this.props;t?(this.removeFauxHighlight(),this.range=null):i&&n&&n(e)},this.onBlur=()=>{this.endWordMatching(),this.setState({sortedSuggestions:[]})},this.onDone=()=>{const{onDoneEditing:e}=this.props;e?e():this.toggleEditing(!1)},this.onKeyDown=e=>{const{onCancelEditing:t}=this.props,{matches:i,activeMatch:n}=this.state;e.stopPropagation(),this.range||(this.range=this.getCurrentRange());switch(e.which||e.keyCode){case ei.R.ESCAPE:return void(t&&t());case ei.R.TAB:case ei.R.RETURN:if(i.length&&n>-1)e.preventDefault(),this.chooseMatch(i[n].text,i[n].value,i[n].id);else{const{isSpecialNode:t,anchorNode:i}=this.tryGetAnchorNode();t&&i&&this.range&&(e.preventDefault(),this.insertAndFocusCharacter(i,!1,"\n")),this.wordToken&&(e.preventDefault(),this.finishWordElement(!1,!0)),e.shiftKey||(e.preventDefault(),this.onDone())}return;case ei.R.DOWNARROW:return void(i.length&&(e.preventDefault(),this.setState((e=>{const t=(e.activeMatch+1)%i.length;return this.ensureActiveMatchIsVisible(t),{activeMatch:t}}))));case ei.R.UPARROW:return void(i.length&&(e.preventDefault(),this.setState((e=>{const t=0===e.activeMatch?i.length-1:e.activeMatch-1;return this.ensureActiveMatchIsVisible(t),{activeMatch:t}}))));case ei.R.B:case ei.R.I:case ei.R.U:if(e.ctrlKey||e.metaKey)return void e.preventDefault();break;case ei.R.BACKSPACE:case ei.R.SHIFT:case ei.R.CONTROL:case ei.R.ALT:case ei.R.LEFTARROW:case ei.R.RIGHTARROW:case ei.R.DELETE:return}},this.saveRef=e=>{this.textBox=e},this.bindSuggestionMenuRef=e=>{this.suggestionMenuRef=e},this.state={activeMatch:-1,matches:[],sortedSuggestions:[]}}componentDidMount(){this.props.active&&this.toggleEditing(!0)}componentWillUnmount(){this.toggleEditing(!1),this.wordElement=null}componentDidUpdate(e,t){const{active:i}=this.props;i!==e.active&&this.toggleEditing(i)}toggleEditing(e){this.textBox&&this.textBox.toggleEditing(e),this.endWordMatching(),this.setState({sortedSuggestions:[]}),e?document.addEventListener("selectionchange",this.onSelectionChange):document.removeEventListener("selectionchange",this.onSelectionChange)}ensureActiveMatchIsVisible(e){if(!this.suggestionMenuRef)return;const{scrollTop:t,offsetHeight:i}=this.suggestionMenuRef,n=this.suggestionMenuRef.querySelector(`[data-index="${e}"]`);if(!n)return;const{offsetTop:s,offsetHeight:r}=n,o=t>s;if(t+i<s+r||o){const e=o;n.scrollIntoView(e)}}getTextElement(){var e;return null===(e=this.textBox)||void 0===e?void 0:e.getTextElement()}focus(){this.textBox&&this.textBox.focus()}getMarkdown(){const e=this.getTextElement();return e?this.props.textParser.serialize(e):""}hasTextSelected(){return!(!this.range||this.range.startOffset===this.range.endOffset)}prepareLinkForEdit(e){const t=e||this.getAnchorFromSelection();let i="";const n=window.getSelection();if(n)if(t||this.range)this.addFauxHighlight(),t||(i=this.range?this.range.toString():n.toString());else{this.textBox.focus();const e=this.getTextElement();e&&n.selectAllChildren(e),n.collapseToEnd(),this.range=n.getRangeAt(0),i=this.range.toString()}this.linkElement=t;const s=t?t.innerText:i,r=t?t.dataset.value||t.href:"";this.props.onClickBlock({blockType:zi.C.LINK,text:s,value:r})}saveLink(e,t){this.linkElement?""!==t?(this.linkElement.text=e,this.linkElement.href=t,this.linkElement.setAttribute("data-value",t)):this.unlink(this.linkElement):this.linkify(e,t)}linkify(e,t){this.removeFauxHighlight(),this.execCommand("createLink",t);let i=this.getAnchorFromSelection();!i&&this.range&&(i=document.createElement("a"),i.href=t,this.range.insertNode(i)),i&&(i.text=e,i.className=`link-annotation ${Wi.o.LINK}`,i.setAttribute("data-blocktype",zi.C.LINK),i.setAttribute("data-value",t),i.onclick=this.onClickAnchor,this.insertAndFocusCharacter(i))}insertAndFocusCharacter(e,t=!1,i=""){if(this.range=this.getCurrentRange(),this.range){const n=document.createTextNode(i),s=t?"setStartBefore":"setStartAfter",r=t?"setEndBefore":"setEndAfter";this.range[s](e),this.range[r](e),this.range.insertNode(n),this.range.selectNodeContents(n),""!==i&&this.range.collapse(!1),this.applyRange()}}unlink(e){const t=e.parentNode,i=e.textContent;t&&(t.removeChild(e),i&&!sn(i)&&this.execCommand("insertText",i))}execCommand(e,t){this.range&&(this.applyRange(),document.execCommand(e,!1,t),this.onSelectionChange())}applyRange(){if(this.range){const e=window.getSelection();e&&(e.removeAllRanges(),e.addRange(this.range))}}getAnchorFromSelection(){const e=this.getCurrentRange();if(!e)return null;let t=e.commonAncestorContainer;for(;t&&"A"!==t.nodeName;){if(t===this.getTextElement())return null;t=t.parentNode}return t||null}insertFocusNodeIfNeeded(){var e,t;const i=window.getSelection();if(!i||!this.range)return;const{anchorNode:n,isLinkNode:s}=this.tryGetAnchorNode();if(n){const r=null!==(t=null===(e=n.textContent)||void 0===e?void 0:e.length)&&void 0!==t?t:0,o=0===i.focusOffset&&r>0,a=null===n.nextSibling&&r===i.focusOffset&&s;(o||a)&&this.insertAndFocusCharacter(n,o)}}getCurrentRange(){const e=window.getSelection();if(e&&e.rangeCount>0){const t=e.getRangeAt(0),i=this.getTextElement();if(i&&(i===t.commonAncestorContainer||i.compareDocumentPosition(t.commonAncestorContainer)&Node.DOCUMENT_POSITION_CONTAINED_BY))return t}return null}sortWords(e){return e.sort(((e,t)=>e.text.toLowerCase()<t.text.toLowerCase()?-1:1))}tryGetAnchorNode(){var e;const t=this.getAnchorFromSelection();if(t&&t instanceof HTMLAnchorElement){const i=null===(e=t.dataset)||void 0===e?void 0:e.blocktype,n=i===zi.C.USER||i===zi.C.HASH,s=i===zi.C.LINK;return{isSpecialNode:n,isLinkNode:s,anchorNode:n||s?t:null}}return{isSpecialNode:!1,isLinkNode:!1,anchorNode:null}}updateWordElement(e,t,i){const n=e.inputType.startsWith("delete"),s=window.getSelection(),r=this.startTokens;if(!this.wordElement||this.wordElement.parentElement){if(t&&i&&i.parentElement&&s){const e=i.textContent||"";if(!r.includes(e[0]||""))return void this.clearWordElement();const t=e.substr(0,s.focusOffset),o=s&&s.focusOffset<e.length,a=n||o;if(this.wordElement=i,this.wordToken=t[0],this.emailMention=this.isEmailMention(t),this.updateSuggestions(),this.range=this.getCurrentRange(),a&&this.range){this.range.selectNode(i);const n=this.range.extractContents();if(n&&n.firstElementChild&&n.firstElementChild instanceof HTMLElement){const i=e.substring(t.length),s=document.createTextNode(i);n.firstElementChild.innerText=t,n.firstElementChild.classList.remove("link-annotation-active"),n.firstElementChild.removeAttribute("data-value"),n.firstElementChild.removeAttribute("data-id"),n.appendChild(s),this.range.insertNode(n),this.range.setStartBefore(s),this.range.setEndBefore(s),this.range.collapse(!1),this.range.selectNodeContents(this.wordElement),this.range.collapse(!1),this.applyRange()}}}}else this.endWordMatching()}get startTokens(){const{hashtags:e,userMentions:t}=this.props,i=[];return t&&i.push("@"),e&&i.push("#"),i}fetchUserMatches(){const e=this.wordElement?this.wordElement.textContent:null;if(this.props.active&&this.wordToken&&e){const t=this.sanitizeForSearch(e,!0);this.context.commandBinder.issueCommand(new Kh.V1(t)).then((()=>{this.updateSuggestions()}))}}filterSuggestions(){const{wordToken:e,wordElement:t}=this;if(e&&t&&t.textContent){const e=this.sanitizeForSearch(t.textContent),i=this.getMatches(e),n=i.length>0?0:-1;this.setState({matches:i,activeMatch:n})}}sanitizeForSearch(e="",t){if(!this.wordToken)return e;let i=(e.startsWith(this.wordToken)?e.substr(1):e).toLowerCase().trim().replace(/\s\s+/g," ");if(t){const e=/([^\s]+)/.exec(i);i=e&&e[0]||""}return i}getMatches(e){const{sortedSuggestions:t=[]}=this.state,i=this.sanitizeForSearch(e)||"";return 0===i.length?t:t.filter((e=>{let t=0===this.sanitizeForSearch(e.text).indexOf(i);return!t&&"@"===this.wordToken&&e.value&&(t=0===this.sanitizeForSearch(e.value).indexOf(i)),t}))}chooseMatch(e,t,i){const n=this.wordElement;if(n){const s=this.wordToken&&!e.startsWith(this.wordToken)?this.wordToken:"";n.innerHTML=`${s}${e}`,n.classList.add("link-annotation-active"),t&&n.setAttribute("data-value",t),i&&n.setAttribute("data-id",i),this.finishWordElement(!1,!0),this.props.onInput(this.getMarkdown())}}updateSuggestions(){const{wordToken:e}=this,{hashtags:t,userMentions:i}=this.props;let n=[];if("#"===e&&t)n=this.sortWords(t.map((e=>({text:e,blockType:zi.C.HASH}))));else if("@"===e&&i){const e=this.context.userData.getKnownUsers();n=this.sortWords(e.map((e=>({text:e.name,id:e.id,value:e.email,blockType:zi.C.USER}))))}this.setState({sortedSuggestions:n},this.filterSuggestions)}endWordMatching(){this.setState({matches:[],activeMatch:-1}),this.wordToken=null,this.wordElement=null,this.emailMention=!1}createWordElement(e){const t=window.getSelection(),i=this.range;if(!i||!t||!this.wordToken)return;const n=document.createElement("a");n.removeAttribute("href"),n.innerText=e,"#"===this.wordToken?(n.className=`link-annotation ${Wi.o.HASH}`,n.setAttribute("data-blocktype",zi.C.HASH)):"@"===this.wordToken&&(n.className=`link-annotation ${Wi.o.USER}`,n.setAttribute("data-blocktype",zi.C.USER));const s=i.startContainer,r=i.startOffset,o=i.endOffset+e.length,a=Math.max(0,(s.textContent||"").length);try{i.setStart(s,Math.min(r,a)),i.setEnd(s,Math.min(o,a))}catch(e){i.selectNodeContents(s)}i.deleteContents(),i.insertNode(n),i.selectNodeContents(n),i.collapse(!1),this.applyRange(),this.wordElement=n}clearWordElement(){const e=this.range,t=window.getSelection();e&&t&&this.wordElement&&this.wordToken&&(this.stripAnchorFromNode(this.wordElement),this.endWordMatching())}stripAnchorFromNode(e){const t=this.range;if(!t)return;const i=e.textContent;if(this.textBox.focus(),t.selectNode(e),t.deleteContents(),t.collapse(!1),i){const e=document.createTextNode(i);t.insertNode(e),t.selectNodeContents(e),t.collapse(!1)}this.applyRange()}isValidSpecialWord(e,t){return 0!==this.sanitizeForSearch(t).length||(this.clearWordElement(),!1)}finishWordElement(e,t){const{range:i,wordElement:n,wordToken:s}=this,r=window.getSelection();if(!(i&&r&&n&&s))return;n.contentEditable="true",n.classList.add("link-annotation-active");let o="";const a=n.textContent;if(this.isValidSpecialWord(s,a||"")){if(e&&a&&a.length>1?(o=a.charAt(a.length-1),n.textContent=a.slice(0,-1)):t&&(o=" "),this.textBox.focus(),i.setStartAfter(n),o){const e=document.createTextNode(o);i.insertNode(e),i.selectNodeContents(e),i.collapse(!1)}this.applyRange(),this.endWordMatching()}else this.clearWordElement()}renderMatch(e,t){const{activeMatch:i}=this.state,n=t===i,s=e.blockType===zi.C.USER,r=s&&e.value?this.context.userData.getUserDisplay(e.value):null,o=s?e.value:void 0,a=`${e.text}-${t}`;return(0,l.jsxs)("div",Object.assign({className:d()("suggestion",{selected:n}),onMouseDown:this.onClickMatch,onMouseEnter:this.onHoverMatch,"data-value":e.value,"data-id":e.id,"data-text":e.text,"data-index":t},{children:[s&&r&&(0,l.jsx)(nr,{badgeStyle:{color:r.color,borderColor:r.color,backgroundColor:"transparent"},label:r.initials},void 0),(0,l.jsx)("span",Object.assign({className:"suggestion-text"},{children:e.text}),void 0),o&&(0,l.jsxs)("p",Object.assign({className:"suggestion-hint"},{children:["(",o,")"]}),void 0)]}),a)}renderMatches(){if(!this.props.active)return null;const{matches:e}=this.state,t=e.length>0;return(0,l.jsx)("div",Object.assign({className:d()("suggestion-menu",{open:t}),ref:this.bindSuggestionMenuRef},{children:t&&e.map(((e,t)=>this.renderMatch(e,t)))}),void 0)}render(){const{text:e,textParser:t,clickToEdit:i,placeholder:n,tabIndex:s,maxLength:r,className:o,active:a}=this.props;return(0,l.jsxs)("div",Object.assign({className:d()("smart-text-box",o)},{children:[(0,l.jsx)(Dr,{ref:this.saveRef,text:e,textParser:t,active:a,placeholder:n,tabIndex:s,clickToEdit:i&&!a,maxLength:r,onClick:this.onClick,onInput:this.onInput,onKeyDown:this.onKeyDown,onBlur:this.onBlur,onClickAnchor:this.onClickAnchor},void 0),this.renderMatches()]}),void 0)}};qh.contextType=m.I,qh=Yh([I.A],qh);var Zh=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let $h=class FileUpload extends r.Component{constructor(e){super(e),this.handleUpload=e=>{const t=e.target;if(!t)return;const i=t.files;i&&this.props.onUpload(i),t.value=""}}render(){const{accept:e,id:t,multi:i,enabled:n,children:s,className:r}=this.props,o=`file-upload-${t}`;return(0,l.jsxs)("div",Object.assign({className:d()("file-upload-button",r)},{children:[(0,l.jsx)("label",Object.assign({htmlFor:o},{children:s}),void 0),n&&(0,l.jsx)("input",{type:"file",className:"file-input",id:o,accept:e,multiple:!!i,onChange:this.handleUpload},void 0)]}),void 0)}};$h=Zh([I.Z],$h);var Qh=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Xh=class FileDropZone extends r.Component{constructor(e){super(e),this.active=!1,this.dropZone=null,this.onDragOver=e=>{e.dataTransfer&&e.dataTransfer.types&&e.dataTransfer.types.includes("Files")&&(e.preventDefault(),e.stopPropagation(),this.activate())},this.onDrop=e=>{e.preventDefault(),e.stopPropagation(),e.dataTransfer&&e.dataTransfer.files&&this.props.onDropped(e.dataTransfer.files),this.deactivate()},this.onDragEnd=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.onDragLeave=e=>{e.preventDefault(),e.stopPropagation(),this.deactivate()},this.setDropZoneRef=e=>{this.dropZone=e}}activate(){!this.active&&this.dropZone&&(this.props.onActivate&&this.props.onActivate(!0),this.active=!0,this.dropZone.classList.add("active"))}deactivate(){this.active&&this.dropZone&&(this.active=!1,this.dropZone.classList.remove("active"),this.props.onDone&&this.props.onDone())}render(){const{className:e,children:t,disabled:i}=this.props;return(0,l.jsxs)("div",Object.assign({className:e,onDragEnter:i?void 0:this.onDragOver,onDragLeave:i?void 0:this.onDragLeave,onDragOver:i?void 0:this.onDragOver,onDragEnd:i?void 0:this.onDragEnd,onDrop:i?void 0:this.onDrop},{children:[(0,l.jsxs)("div",Object.assign({className:"file-drop-zone",ref:this.setDropZoneRef},{children:[(0,l.jsx)("span",{className:"icon icon-attach"},void 0),(0,l.jsx)("label",{children:"Upload file"},void 0)]}),void 0),t]}),void 0)}};Xh=Qh([I.Z],Xh);class OpenMediaEmbedPopupMessage extends ji.v{}class CloseMediaEmbedPopupMessage extends ji.v{}var Jh,eu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{EMBED:tu}=f.Z.WORKSHOP;var iu;!function(e){e.NONE="none",e.INVALID_URL_SYNTAX="invalid",e.LOADING="loading",e.LOADED="loaded",e.ERROR="error"}(iu||(iu={}));let nu=Jh=class MediaEmbedEditor extends r.Component{constructor(e){super(e),this.inputRef=(0,r.createRef)(),this.isUnmounting=!1,this.onInput=e=>{const t=sn(e)?iu.NONE:iu.INVALID_URL_SYNTAX;this.setState({validationPhase:t,currentUrl:e})},this.onApply=()=>{this.isDisabled()||this.onDoneEditing(this.state.currentUrl)},this.stopPropagation=e=>{e.stopPropagation()},this.onDoneEditing=async e=>{const{onEmbed:t,url:i}=this.props;if(e&&e!==i)try{const i=await this.loadMedia(e);if(this.isUnmounting)return;i?(this.setState({validationPhase:iu.LOADED,error:void 0}),t(i)):this.onEmbedError(e)}catch(t){if(this.isUnmounting)return;this.onEmbedError(e,t)}},this.loadMedia=async e=>{const{parentId:t,parentType:i}=this.props;return this.setState({validationPhase:iu.LOADING}),this.context.commandBinder.issueCommand(new or.wu(t,i,e))},this.state={currentUrl:e.url||"",validationPhase:iu.NONE,error:void 0}}componentWillUnmount(){this.isUnmounting=!0,this.setState({currentUrl:"",validationPhase:iu.NONE,error:void 0})}componentDidUpdate(e){const{url:t}=this.props;t!==e.url&&this.setState({currentUrl:t||"",validationPhase:iu.NONE,error:void 0})}focus(){this.inputRef.current&&this.inputRef.current.focus()}onEmbedError(e,t){this.setState({error:t,validationPhase:iu.ERROR,currentUrl:e})}isDisabled(){const{validationPhase:e,currentUrl:t}=this.state;return e===iu.ERROR||e===iu.LOADING||e===iu.INVALID_URL_SYNTAX&&""!==t||""===t}renderError(){const{locale:e}=this.context,{error:t}=this.state;let i=e.t(tu.ERROR_MESSAGE);return t instanceof lr.HF?i=e.t(tu.PROVIDER_NOT_SUPPORTED_MESSAGE):t instanceof lr.t1&&(i=e.t(tu.LINK_TYPE_NOT_SUPPORTED_MESSAGE)),(0,l.jsxs)("div",Object.assign({className:"popover-message popover-message-error"},{children:[i,(0,l.jsx)("a",Object.assign({className:"link",target:"_blank",rel:"noreferrer",href:Jh.supportPage},{children:e.t(tu.HELP_CTA)}),void 0)]}),void 0)}renderHelpMessage(){const{locale:e}=this.context,{currentUrl:t,validationPhase:i}=this.state;switch(i){case iu.ERROR:return this.renderError();case iu.LOADING:return(0,l.jsx)("div",Object.assign({className:"popover-message"},{children:e.t(tu.LOADING_MESSAGE)}),void 0);case iu.INVALID_URL_SYNTAX:if(""!==t)return(0,l.jsx)("div",Object.assign({className:"popover-message popover-message-error"},{children:e.t(tu.INVALID_URL_MESSAGE)}),void 0)}return(0,l.jsx)("div",Object.assign({className:"popover-message"},{children:(0,l.jsx)("a",Object.assign({className:"link",target:"_blank",href:Jh.supportPage},{children:e.t(tu.SUPPORTED_FORMATS_MESSAGE)}),void 0)}),void 0)}render(){const{locale:e}=this.context,{className:t}=this.props,{currentUrl:i}=this.state,n=this.isDisabled()?w.BN.DISABLED:w.BN.ENABLED;return(0,l.jsxs)("div",Object.assign({className:"media-embed-editor",onClick:this.stopPropagation},{children:[(0,l.jsx)(dn,{ref:this.inputRef,text:i,type:"url",className:d()(t),placeholder:"https://",onDone:this.onDoneEditing,onInput:this.onInput},void 0),(0,l.jsxs)("div",Object.assign({className:"popover-footer"},{children:[this.renderHelpMessage(),(0,l.jsx)(w.zx,Object.assign({className:"button-inline embed-apply-btn",buttonStyle:w.ZJ.CLEAR,buttonSize:w.qE.SMALL,buttonState:n,onClick:this.onApply},{children:e.t(tu.APPLY_CTA)}),void 0)]}),void 0)]}),void 0)}};nu.contextType=m.I,nu.supportPage="https://support.matterport.com/hc/en-us/articles/115006363868-Add-Multimedia-to-a-Mattertag-Post",nu=Jh=eu([I.Z],nu);var su=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{EMBED:ru}=f.Z.WORKSHOP;let ou=class MediaEmbedPopup extends r.Component{constructor(e){super(e),this.popupRef=(0,r.createRef)(),this.embedRef=(0,r.createRef)(),this.open=()=>{this.popupRef.current&&this.popupRef.current.classList.add("open"),this.focus()},this.close=()=>{this.popupRef.current&&this.popupRef.current.classList.remove("open")},this.stopPropagation=e=>{e.stopPropagation()}}componentDidMount(){this.context.messageBus.subscribe(OpenMediaEmbedPopupMessage,this.open),this.context.messageBus.subscribe(CloseMediaEmbedPopupMessage,this.close)}componentWillUnmount(){this.close(),this.context.messageBus.unsubscribe(OpenMediaEmbedPopupMessage,this.open),this.context.messageBus.unsubscribe(CloseMediaEmbedPopupMessage,this.close)}focus(){this.embedRef.current&&this.embedRef.current.focus()}render(){const{locale:e}=this.context,{onCancel:t,onEmbed:i,parentId:n,parentType:s}=this.props;return(0,l.jsxs)("div",Object.assign({ref:this.popupRef,className:"annotation-popup",onClick:this.stopPropagation},{children:[(0,l.jsxs)("div",Object.assign({className:"popover-header"},{children:[(0,l.jsx)("div",Object.assign({className:"popover-label"},{children:e.t(ru.MEDIA_LINK_LABEL)}),void 0),(0,l.jsx)(te.P,{buttonStyle:te.A.LIGHT,onClose:t},void 0)]}),void 0),(0,l.jsx)(nu,{ref:this.embedRef,parentId:n,parentType:s,className:"text-field-dark",onEmbed:i},void 0)]}),void 0)}};ou.contextType=m.I,ou=su([I.Z],ou);var au=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{ANNOTATIONS:lu}=f.Z.SHOWCASE;var cu;!function(e){e.EMBED="embed",e.LINK="link"}(cu||(cu={}));let du=class Annotation extends r.Component{constructor(e){super(e),this.uploadTooltipTimeout=0,this.bindings=[],this.isUnmounting=!1,this.getAttachmentsState=()=>{if(!this.attachmentsData)return;const{active:e,parentId:t,parentType:i}=this.props;if(!e)return;return{pendingAttachments:this.attachmentsData.getPendingAttachmentsForAsset(t,i),removedAttachments:this.attachmentsData.getRemovedAttachmentsForAsset(t,i),failures:this.attachmentsData.failures.values,uploads:this.attachmentsData.uploads.values}},this.updateAttachments=()=>{const e=this.getAttachmentsState();e&&this.setState(e)},this.cancelEdits=()=>{this.props.onCancelEditing&&this.props.onCancelEditing()},this.saveEdits=()=>{this.onDoneEditing()},this.onDoneEditing=()=>{const{onDoneEditing:e}=this.props;if(e){const t=this.getMarkdown();e(t,""===t&&0===this.getAttachmentCount())}},this.onInput=e=>{this.setState({textChanged:e.trim()!==this.props.text})},this.setPopupEditor=(e,t)=>{t?this.setState({popup:e}):e===this.state.popup&&this.setState({popup:null})},this.openLinkEditor=()=>{!(this.state.popup===cu.LINK)&&this.textEditor&&(this.trackEvent("annotation_open_link_editor"),this.textEditor.prepareLinkForEdit())},this.onClickBlock=e=>{const{active:t,annotationType:i,annotationId:n}=this.props;if(e.blockType===zi.C.LINK&&t){this.setState({selectedBlock:e}),this.setPopupEditor(cu.LINK,!0);const t=""!==e.text;this.context.messageBus.broadcast(new OpenLinkEditorMessage(t))}else t||this.context.messageBus.broadcast(new Qs.iP(i,n,e))},this.closeLinkEditor=()=>{this.context.messageBus.broadcast(new CloseLinkEditorMessage),this.setPopupEditor(cu.LINK,!1),this.setState({selectedBlock:null})},this.toggleEmbedEditor=()=>{this.state.popup!==cu.EMBED?(this.trackEvent("annotation_open_embed_editor"),this.setPopupEditor(cu.EMBED,!0),this.context.messageBus.broadcast(new OpenMediaEmbedPopupMessage)):this.closeEmbedEditor()},this.closeEmbedEditor=()=>{this.setPopupEditor(cu.EMBED,!1),this.context.messageBus.broadcast(new CloseMediaEmbedPopupMessage)},this.onRemoveLink=()=>{this.onSaveLink("","")},this.onSaveLink=(e,t)=>{const{popup:i}=this.state;i===cu.LINK&&this.textEditor&&(this.setState({textChanged:!0}),this.textEditor.saveLink(e,t),this.closeLinkEditor())},this.onClickFileInput=()=>{const{active:e,onClickToEdit:t}=this.props;this.isAtMaxAttachments()?(window.clearTimeout(this.uploadTooltipTimeout),this.setState({showUploadTooltip:!0}),this.uploadTooltipTimeout=window.setTimeout((()=>{this.setState({showUploadTooltip:!1})}),2500)):!e&&t&&t()},this.onFileUpload=e=>{const{parentId:t,parentType:i}=this.props,n=Array.from(e),s=this.getAttachmentCount();e.length+s>Wh.yk&&n.splice(Wh.yk-s),this.context.commandBinder.issueCommand(new or.It(t,i,n)),this.edit()},this.onDrop=e=>{this.trackEvent("attachment_drag_and_dropped"),this.onFileUpload(e)},this.onFilesChosen=e=>{this.trackEvent("annotation_files_chosen"),this.onFileUpload(e)},this.dropActivated=()=>{const{active:e,creating:t,onClickToEdit:i}=this.props;t&&!e&&i&&i()},this.setTextEditorRef=e=>this.textEditor=e,this.state={textChanged:!1,selectedBlock:null,showUploadTooltip:!1,pendingAttachments:[],removedAttachments:[],uploads:[],failures:[],popup:null}}componentDidMount(){this.context.market.waitForData(zh.b).then((e=>{this.attachmentsData=e,this.bindings.push(this.attachmentsData.onChanged(this.updateAttachments)),this.isUnmounting||this.updateAttachments()}))}componentWillUnmount(){this.isUnmounting=!0,window.clearTimeout(this.uploadTooltipTimeout);for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){const{active:i,parentId:n,parentType:s}=this.props;e.active&&!i?this.setState({textChanged:!1,pendingAttachments:[],removedAttachments:[],uploads:[],failures:[],popup:null}):n===e.parentId&&s===e.parentType||this.updateAttachments()}edit(){this.textEditor&&this.textEditor.toggleEditing(!0)}focus(){this.textEditor&&this.textEditor.focus()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}getMarkdown(){let e;return e=this.textEditor?this.textEditor.getMarkdown():this.props.text,e.trim()}getAttachmentCount(){const{attachments:e}=this.props,{pendingAttachments:t,removedAttachments:i,uploads:n}=this.state;return e.length+t.length+n.length-i.length}isAtMaxAttachments(){return this.getAttachmentCount()>=Wh.yk}inEmptyState(){const{active:e,text:t}=this.props;return!e&&""===t.trim()&&0===this.getAttachmentCount()}renderButtonBar(){const{active:e,creating:t,parentId:i}=this.props;if(!e)return null;const{pendingAttachments:n,removedAttachments:s,textChanged:r,uploads:o,showUploadTooltip:a}=this.state,c=this.isAtMaxAttachments(),d=r||s.length>0||n.length>0,h=o.length>0,u=!c&&!h,p=d&&e&&!h?w.BN.ENABLED:w.BN.DISABLED,m=c?w.BN.DIMMED:h?w.BN.DISABLED:w.BN.ENABLED,f=this.context.locale.t(c?lu.MAX_ATTACHMENTS_TOOLTIP:lu.UPLOAD_TOOLTIP,Wh.yk),g=this.context.locale.t(c?lu.MAX_ATTACHMENTS_TOOLTIP:lu.EMBED_TOOLTIP,Wh.yk),v=this.context.locale.t(t?lu.ADD_CTA:lu.SAVE_CTA),y=this.context.locale.t(lu.LINK_TOOLTIP),b=this.context.locale.t(lu.CANCEL_CTA);return(0,l.jsxs)("div",Object.assign({className:"annotation-button-bar"},{children:[(0,l.jsxs)("div",Object.assign({className:"annotation-editors"},{children:[(0,l.jsx)($h,Object.assign({id:`${i}-annotation`,multi:!0,enabled:u,onUpload:this.onFilesChosen},{children:(0,l.jsx)(T.hU,{iconClass:"icon-attach",buttonStyle:T.Dd.PLAIN,buttonState:m,onClick:this.onClickFileInput,tooltipMsg:f,tooltipPersist:a},void 0)}),void 0),(0,l.jsx)(T.hU,{iconClass:"icon-media-mix",buttonStyle:T.Dd.PLAIN,buttonState:m,tooltipMsg:g,onClick:this.toggleEmbedEditor},void 0),(0,l.jsx)(T.hU,{iconClass:"icon-link",buttonStyle:T.Dd.PLAIN,tooltipMsg:y,onClick:this.openLinkEditor},void 0)]}),void 0),(0,l.jsxs)("div",Object.assign({className:"annotation-cta-buttons"},{children:[(0,l.jsx)(w.zx,Object.assign({buttonStyle:w.ZJ.SECONDARY,buttonSize:w.qE.SMALL,className:"button-inline",buttonState:w.BN.ENABLED,onClick:this.cancelEdits},{children:b}),void 0),(0,l.jsx)(w.zx,Object.assign({className:"button-inline",buttonStyle:w.ZJ.SECONDARY,buttonSize:w.qE.SMALL,buttonState:p,onClick:this.saveEdits},{children:v}),void 0)]}),void 0)]}),void 0)}renderAttachments(){const{attachments:e,active:t,onViewAttachment:i}=this.props,{uploads:n,failures:s,pendingAttachments:r}=this.state,o=this.attachmentsData?e.filter((e=>!this.attachmentsData.removals.get(e.id))):e;return r.forEach((e=>o.push(e))),(0,l.jsx)(zr,{canDelete:t,inline:t,attachments:o,uploads:n,failures:s,onViewAttachment:i},void 0)}renderSmartEditor(){const{placeholder:e,hashtags:t,text:i,creating:n,textParser:s,active:r,maxLength:o,tabIndex:a,annotationType:c,onClickToEdit:d}=this.props,h=c===Zs.J.NOTE,u=this.inEmptyState()&&h,p=u&&!n?this.context.locale.t(lu.CONTENT_DELETED):e,m=u&&p?"placeholder":void 0;return(0,l.jsx)(qh,{ref:this.setTextEditorRef,textParser:s,className:m,text:i,active:!!r,clickToEdit:!!d,placeholder:p,onClickBlock:this.onClickBlock,onStartEditing:r?void 0:d,onDoneEditing:this.onDoneEditing,onCancelEditing:this.cancelEdits,onInput:this.onInput,tabIndex:a,maxLength:o,hashtags:t||[],userMentions:h},void 0)}render(){const{className:e,creating:t,active:i,parentId:n,parentType:s,annotationType:r,onClickToEdit:o,edited:a,title:c}=this.props,{uploads:h,selectedBlock:u}=this.state,p=this.getAttachmentCount()<Wh.yk,m=!(h.length>0)&&(i||t)&&p,f=r===Zs.J.NOTE,g=this.inEmptyState()&&!t&&f,v=!i&&a&&!g,y={annotating:i,"editor-box":i||!!o,"annotation-emptied":g};let b="",S="";return u&&u.blockType===zi.C.LINK&&(b=u.text,S=u.value||""),(0,l.jsxs)(Xh,Object.assign({className:"annotation-box",onDropped:this.onDrop,disabled:!m,onActivate:this.dropActivated},{children:[c,(0,l.jsxs)("div",Object.assign({className:d()("annotation-text-box",y,e)},{children:[this.renderSmartEditor(),i&&this.renderAttachments(),i&&this.renderButtonBar()]}),void 0),v&&(0,l.jsx)("div",Object.assign({className:"annotation-edited"},{children:"(edited)"}),void 0),!i&&!t&&this.renderAttachments(),i&&!!n&&(0,l.jsx)(ou,{parentId:n,parentType:s,onEmbed:this.closeEmbedEditor,onCancel:this.closeEmbedEditor},void 0),i&&!!n&&(0,l.jsx)(LinkEditor,{linkText:b,linkUrl:S,onCancel:this.closeLinkEditor,onSaveLink:this.onSaveLink,onRemoveLink:this.onRemoveLink},void 0)]}),void 0)}};du.contextType=m.I,du=au([I.Z],du);var hu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let uu=class OptionsMenu extends r.Component{constructor(e){super(e),this.popupMenuRef=(0,r.createRef)(),this.isUnmounting=!1,this.popupOpened=e=>{if(this.isUnmounting)return;const{assetId:t}=this.props;e.id!==t&&this.setState({open:!1})},this.toggleMenu=e=>{if(e.stopPropagation(),!this.popupMenuRef.current)return;const t=e.clientY+this.popupMenuRef.current.offsetHeight+ne.POPUP_OFFSET>window.innerHeight?J.BOTTOM_RIGHT:J.TOP_RIGHT;this.setState((e=>{const i=!e.open;return i&&this.context.messageBus.broadcast(new nt.nZ(this.props.assetId)),{arrowPosition:t,open:i}}))},this.closeMenu=()=>{this.setState({open:!1})},this.clickMenu=e=>{e.stopPropagation(),this.setState({open:!1})},this.state={open:!1,arrowPosition:J.TOP_RIGHT}}componentDidMount(){this.context.messageBus.subscribe(nt.nZ,this.popupOpened)}componentWillUnmount(){this.isUnmounting=!0,this.context.messageBus.unsubscribe(nt.nZ,this.popupOpened)}renderMenu(){const{children:e}=this.props,{open:t}=this.state;return(0,l.jsx)("div",Object.assign({ref:this.popupMenuRef,className:"tooltip-menu",onClick:this.clickMenu},{children:t&&e}),void 0)}render(){const{assetId:e}=this.props,{open:t,arrowPosition:i}=this.state;return(0,l.jsx)(T.hU,Object.assign({buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.SMALL,iconClass:"icon-more-vert item-more-options",dataValue:e,onClick:this.toggleMenu},{children:(0,l.jsx)(ne,{open:t,onClose:this.closeMenu,message:this.renderMenu(),arrowPos:i,bodyClassName:"item-tooltip"},void 0)}),void 0)}};uu.contextType=m.I,uu=hu([I.Z],uu);var pu=i(61481),mu=i(80161),fu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{INVITE_USER:gu,INVITE_BUTTON:vu,INVITE_USERS:yu,INVITE_VISIBLE_MSG:bu}=f.Z.USERS;let Su=class UserInviteCard extends r.Component{constructor(e){super(e),this.onInviteUsers=()=>{this.props.onInviteUsers(this.props.invitees)}}render(){const{invitees:e}=this.props;if(0===e.length)return null;const{locale:t}=this.context;let i;const n=t.t(vu,e.length);i=1===e.length?t.t(gu,{email:e[0]}):t.t(yu,{emails:e.join(", ")});const s=t.t(bu);return(0,l.jsxs)("div",Object.assign({className:"user-invite-card"},{children:[(0,l.jsxs)("div",Object.assign({className:"user-invite-info"},{children:[(0,l.jsx)("span",{className:"icon icon-eye-show"},void 0),(0,l.jsx)("span",Object.assign({className:""},{children:s}),void 0)]}),void 0),(0,l.jsx)("p",Object.assign({className:"user-invite-msg"},{children:i}),void 0),(0,l.jsx)(w.zx,Object.assign({onClick:this.onInviteUsers,buttonStyle:w.ZJ.TERTIARY,className:d()("button-inline","user-invite-button")},{children:n}),void 0)]}),void 0)}};Su.contextType=m.I,Su=fu([I.Z],Su);var Eu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{INVITE_VISIBLE_MSG:Tu,INVITE_USER_FAILED:wu,INVITE_USERS_FAILED:xu}=f.Z.USERS;let _u=class UserInviteError extends r.Component{constructor(e){super(e)}render(){const{failedEmails:e}=this.props,{locale:t}=this.context;if(0===e.length)return null;let i;i=1===e.length?t.t(wu,{email:e[0]}):t.t(xu,{failedEmails:e.join(", ")});const n=t.t(Tu);return(0,l.jsxs)("div",Object.assign({className:"user-invite-card"},{children:[(0,l.jsxs)("div",Object.assign({className:"user-invite-info"},{children:[(0,l.jsx)("span",{className:"icon icon-eye-show"},void 0),(0,l.jsx)("span",Object.assign({className:""},{children:n}),void 0)]}),void 0),(0,l.jsx)("p",Object.assign({className:"user-invite-msg"},{children:i}),void 0)]}),void 0)}};_u.contextType=m.I,_u=Eu([I.Z],_u);var Mu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{UNKNOWN_USER:Ou,UNKNOWN_USERS:Au,INVITE_VISIBLE_MSG:Cu}=f.Z.USERS;let Pu=class UnknownEmailCard extends r.Component{render(){const{locale:e}=this.context,{emails:t}=this.props;if(0===t.length)return null;let i;i=1===t.length?e.t(Ou,{email:t[0]}):e.t(Au,{emails:t.join(", ")});const n=e.t(Cu);return(0,l.jsxs)("div",Object.assign({className:"user-invite-card"},{children:[(0,l.jsxs)("div",Object.assign({className:"user-invite-info"},{children:[(0,l.jsx)("span",{className:"icon icon-eye-show"},void 0),(0,l.jsx)("span",Object.assign({className:""},{children:n}),void 0)]}),void 0),(0,l.jsx)("p",Object.assign({className:"user-invite-msg"},{children:i}),void 0)]}),void 0)}};Pu.contextType=m.I,Pu=Mu([I.Z],Pu);var Du=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Nu=class UnknownUserMention extends r.Component{constructor(e){super(e),this.inviteUsers=async e=>{if(0===e.length)return;const{noteId:t,message:i}=this.props;await this.context.commandBinder.issueCommand(new Kh.JB(e,i,et.AT,t))}}getInvitees(){const{userMentions:e}=this.props,t=[];return e.forEach((e=>{(e.userStatus===pu.J.MENTIONED||e.userStatus===pu.J.KNOWN&&e.modelAccess===mu.x.PUBLIC)&&t.push(e.email)})),t}getFailedEmails(){const{userMentions:e}=this.props,t=[];return e.forEach((e=>{e.userStatus===pu.J.FAILED&&t.push(e.email)})),t}render(){const{expires:e,noteId:t}=this.props;if((new Date).getTime()>e)return null;const{userData:i}=this.context,n=i.isInviter(),s=this.getInvitees(),r=this.getFailedEmails();return(0,l.jsxs)("div",Object.assign({className:"user-mentions-unknown"},{children:[n&&s.length>0&&(0,l.jsx)(Su,{invitees:s,modelAccess:et.AT,noteId:t,onInviteUsers:this.inviteUsers},void 0),!n&&s.length>0&&(0,l.jsx)(Pu,{emails:s},void 0),r.length>0&&(0,l.jsx)(_u,{failedEmails:r},void 0)]}),void 0)}};Nu.contextType=m.I,Nu=Du([I.Z],Nu);var Iu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{NOTES:Lu}=f.Z.SHOWCASE;let Ru=class Comment extends r.Component{constructor(e){super(e),this.editComment=()=>{const{comment:e}=this.props;this.trackEvent("notes_click_edit_comment"),this.context.commandBinder.issueCommand(new Vh.x4(e.id)),this.annotation&&this.annotation.edit()},this.deleteComment=()=>{const{noteId:e,comment:t}=this.props;this.trackEvent("notes_click_delete_comment"),this.context.commandBinder.issueCommand(new Vh.mH(e,t.id))},this.saveChanges=(e,t)=>{const{comment:i,noteId:n,onCancel:s}=this.props;t?(this.trackEvent("notes_delete_empty_comment"),this.context.commandBinder.issueCommand(new Vh.mH(n,i.id)),s()):this.context.commandBinder.issueCommand(new Vh.Uw(n,i.id,e))},this.setAnnotationRef=e=>{this.annotation=e}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"notes"})}getUnknownMentions(){const{manager:e,comment:t,userMentionMap:i}=this.props;return e.dataMap.notesViewData.getCommentUserMentions(t.text,i)}renderAnnotation(e){const{comment:t,attachments:i,hashtags:n,active:s,onViewAttachment:r,manager:o,noteId:a,onCancel:c,toolPanelLayout:d}=this.props,{text:h,edited:u,id:p}=t;return e?(0,l.jsx)(du,{ref:this.setAnnotationRef,text:h,textParser:o.getTextParser(),hashtags:n,annotationType:Zs.J.NOTE,annotationId:a,parentType:Gh.u.COMMENT,parentId:p,attachments:i,active:s,edited:u,creating:!1,toolPanelLayout:d,onViewAttachment:r,onDoneEditing:this.saveChanges,onCancelEditing:c,maxLength:et.Ko},p):(0,l.jsx)(Kr,{text:h,textParser:o.getTextParser(),annotationType:Zs.J.NOTE,annotationId:a,attachments:i,edited:u,onViewAttachment:r},void 0)}render(){const{comment:e,active:t,noteId:i,manager:n}=this.props,{user:s,created:r,id:o,text:a}=e,{userData:c}=this.context,h=(0,Hh.C)(c,Zs.J.NOTE,s),u=(0,Hh.K)(c,Zs.J.NOTE,s),p=e.modified.getTime()+60*et.E8*1e3,m=c.getUserDisplay(s.email),f=m.color,g=n.getTextParser().getPlainText(a),v=this.getUnknownMentions();return(0,l.jsxs)("div",Object.assign({className:d()("comment",{active:t}),"data-id":o},{children:[(0,l.jsxs)("div",Object.assign({className:"note-header comment-header"},{children:[(0,l.jsx)(nr,{badgeStyle:{color:f,borderColor:f},label:m.initials},void 0),(0,l.jsxs)("div",Object.assign({className:"note-details"},{children:[(0,l.jsx)("span",Object.assign({className:"note-user"},{children:m.name}),void 0),(0,l.jsx)("div",Object.assign({className:"note-subheader"},{children:r.toLocaleString()}),void 0)]}),void 0),!t&&(h||u)&&(0,l.jsxs)(uu,Object.assign({assetId:o},{children:[h&&(0,l.jsx)("div",Object.assign({className:"tpMsg",onClick:this.editComment},{children:this.context.locale.t(Lu.EDIT_LIST_ITEM_OPTION_CTA)}),void 0),u&&(0,l.jsx)("div",Object.assign({className:"tpMsg",onClick:this.deleteComment},{children:this.context.locale.t(Lu.DELETE_LIST_ITEM_OPTION_CTA)}),void 0)]}),void 0)]}),void 0),this.renderAnnotation(h),h&&(0,l.jsx)(Nu,{noteId:i,message:g,userMentions:v,expires:p},void 0)]}),void 0)}};Ru.contextType=m.I,Ru=Iu([I.Z],Ru);var ku=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{NOTES:Uu}=f.Z.SHOWCASE;let Bu=class ReplyBox extends r.Component{constructor(e){super(e),this.startReply=()=>{this.trackEvent("notes_click_new_comment"),this.context.commandBinder.issueCommand(new Vh.x4(this.props.replyId))},this.onDone=(e,t)=>{const{replyId:i,noteId:n,onCancel:s,onReply:r}=this.props;t?s():r(n,i,e)}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"notes"})}render(){const{hashtags:e,replyId:t,noteId:i,active:n,onCancel:s,toolPanelLayout:r,manager:o}=this.props;return(0,l.jsx)(du,{className:"reply-box",textParser:o.getTextParser(),annotationType:Zs.J.NOTE,annotationId:i,parentType:Gh.u.COMMENT,parentId:t,attachments:[],active:n,edited:!1,creating:!0,text:"",hashtags:e,toolPanelLayout:r,placeholder:this.context.locale.t(Uu.REPLY_PLACEHOLDER),onClickToEdit:this.startReply,onDoneEditing:this.onDone,onCancelEditing:s,maxLength:et.Ko},void 0)}};Bu.contextType=m.I,Bu=ku([I.Z],Bu);var Fu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{NOTES:Vu}=f.Z.SHOWCASE;let Hu=class NoteHeader extends r.Component{constructor(e){super(e),this.editNote=()=>{this.trackEvent("notes_click_edit_note"),this.props.onEditNote()},this.deleteNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_delete_note"),this.context.commandBinder.issueCommand(new Vh.sG(e.id))},this.resolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_resolve_note"),this.context.commandBinder.issueCommand(new Vh.yp(e.id,!0))},this.unresolveNote=()=>{const{note:e}=this.props;this.trackEvent("notes_click_unresolve_note"),this.context.commandBinder.issueCommand(new Vh.yp(e.id,!1))}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"notes"})}render(){const{note:e,creatingNote:t,active:i,onCancelNote:n}=this.props,{userData:s}=this.context,r=(0,Hh.C)(s,Zs.J.NOTE,e.user),o=s.getUserDisplay(e.user.email),a=o.color,c=!t&&!i,d=c&&(0,Hh.K)(s,Zs.J.NOTE,e.user),h=c&&!e.resolved,u=c&&e.resolved,p=!t&&(r||u||d),m=this.context.locale.t(Vu.MARK_AS_RESOLVED),f=this.context.locale.t(Vu.EDIT),g=this.context.locale.t(Vu.UNRESOLVE),v=this.context.locale.t(Vu.DELETE);return(0,l.jsxs)("header",Object.assign({className:"note-header"},{children:[(0,l.jsx)(nr,{badgeStyle:{color:a,borderColor:a},label:o.initials},void 0),(0,l.jsxs)("div",Object.assign({className:"note-details"},{children:[(0,l.jsx)("span",Object.assign({className:"note-user"},{children:o.name}),void 0),(0,l.jsx)("div",Object.assign({className:"note-subheader"},{children:e.created.toLocaleString()}),void 0)]}),void 0),t&&(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.PLAIN,tooltipMsg:this.context.locale.t(Vu.CANCEL),tooltipPosition:x.lZ.DOWN,onClick:n},void 0),h&&(0,l.jsx)(T.hU,{iconClass:"icon-checkmark",buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.SMALL,buttonState:w.BN.ENABLED,tooltipMsg:m,tooltipPosition:x.lZ.DOWN,onClick:this.resolveNote},void 0),c&&(0,l.jsx)(Zr,{urlParamKey:"note",urlParamValue:e.id,buttonStyle:T.Dd.SOCIAL,buttonSize:w.qE.SMALL},void 0),p&&(0,l.jsxs)(uu,Object.assign({assetId:e.id},{children:[r&&(0,l.jsx)("div",Object.assign({className:"tpMsg",onClick:this.editNote},{children:f}),void 0),u&&(0,l.jsx)("div",Object.assign({className:"tpMsg",onClick:this.unresolveNote},{children:g}),void 0),d&&(0,l.jsx)("div",Object.assign({className:"tpMsg",onClick:this.deleteNote},{children:v}),void 0)]}),void 0)]}),void 0)}};Hu.contextType=m.I,Hu=Fu([I.Z],Hu);var ju=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Gu=class NotePost extends r.Component{constructor(e){super(e),this.bindings=[],this.startEditing=()=>{const e=this.props.manager.dataMap.notesViewData.activeNotation;this.annotation&&e===this.props.note.id&&this.annotation.edit()},this.saveNoteChanges=async(e,t)=>{const{note:i,manager:n,onCancel:s}=this.props;t?s():n.dataMap.notesViewData.isNewNote?await this.context.commandBinder.issueCommand(new Vh.FB(e)):await this.context.commandBinder.issueCommand(new Vh.kd(i.id,e))},this.onEditNote=()=>{var e;const{note:t}=this.props,i=null===(e=t.comments.get(0))||void 0===e?void 0:e.id;i&&this.context.commandBinder.issueCommand(new Vh.x4(i))},this.onFocusPin=()=>{this.props.manager.dataMap.notesViewData.isNewNote&&this.startEditing()},this.setAnnotationRef=e=>{this.annotation=e}}componentDidMount(){const{messageBus:e}=this.context;this.bindings.push(e.subscribe(Bh.cd,this.onFocusPin))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e){this.props.active&&!e.active&&this.startEditing()}getExpirationTime(e){return e.modified.getTime()+60*et.E8*1e3}getUnknownMentions(e){const{manager:t,userMentionMap:i}=this.props;return t.dataMap.notesViewData.getCommentUserMentions(e.text,i)}renderUserMentionCards(){const{manager:e,note:t}=this.props,i=t.comments.get(0);if(!i)return null;const n=e.getTextParser().getPlainText(i.text),s=this.getExpirationTime(i),r=this.getUnknownMentions(i);return 0===r.length?null:(0,l.jsx)(Nu,{message:n,noteId:t.id,expires:s,userMentions:r},void 0)}renderAnnotation(e){const{note:t,creatingNote:i,attachments:n,hashtags:s,active:r,onViewAttachment:o,manager:a,onCancel:c,toolPanelLayout:d}=this.props,h=a.getTextParser(),u=t.comments.get(0),p=(null==u?void 0:u.text)||"",m=(null==u?void 0:u.edited)||!1;if(e){const e=(null==u?void 0:u.id)||t.id;return(0,l.jsx)(du,{ref:this.setAnnotationRef,textParser:h,annotationId:t.id,annotationType:Zs.J.NOTE,parentId:e,parentType:Gh.u.COMMENT,attachments:n,active:r,edited:m,creating:i,text:p,hashtags:s,placeholder:"Add your message",toolPanelLayout:d,onViewAttachment:o,onDoneEditing:this.saveNoteChanges,onCancelEditing:c,maxLength:et.TM},void 0)}return(0,l.jsx)(Kr,{text:p,textParser:h,annotationType:Zs.J.NOTE,annotationId:t.id,attachments:n,edited:m,onViewAttachment:o},void 0)}render(){const{note:e,creatingNote:t,onCancel:i,active:n}=this.props,{userData:s}=this.context,r=e.comments.get(0),o=e.user.id===s.getCurrentUserId(),a=!!o&&s.isCommenter();return(0,l.jsxs)("div",Object.assign({className:"note-post"},{children:[(0,l.jsx)(Hu,{note:e,active:n,creatingNote:t,onEditNote:this.onEditNote,onCancelNote:i},void 0),this.renderAnnotation(a),!t&&r&&o&&this.renderUserMentionCards()]}),void 0)}};Gu.contextType=m.I,Gu=ju([I.Z],Gu);var zu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Wu=class ButtonWithIcon extends r.Component{constructor(e){super(e)}render(){const{onClick:e,label:t,icon:i,buttonSize:n,buttonStyle:s,buttonState:r,className:o}=this.props;return(0,l.jsxs)(w.zx,Object.assign({className:d()("button-with-icon",o),buttonSize:n,buttonStyle:s,buttonState:r,onClick:e},{children:[(0,l.jsx)("span",{className:d()("icon",i)},void 0),t]}),void 0)}};Wu=zu([I.Z],Wu);const{NOTES:Ku}=f.Z.SHOWCASE;class NoteWidget extends r.Component{constructor(e){super(e),this.bindings=[],this.cancelTimeout=0,this.updateListIndex=()=>{const e=this.props.manager.dataMap.notesViewData.listIndex;this.setState({listIndex:e,navigating:!1})},this.updateAttachments=()=>{const{note:e,manager:t}=this.props,i=e?t.dataMap.notesViewData.getNoteAttachments(e.id):[];this.setState({attachments:i})},this.updateHashtags=()=>{const{hashtagData:e}=this.props.manager.dataMap;this.setState({hashtags:e.getHashtags()})},this.updateActiveNotation=()=>{const{notesViewData:e}=this.props.manager.dataMap;this.setState({activeNotation:e.activeNotation})},this.updateUserMentionMap=()=>{this.setState({userMentionMap:this.context.userData.getUsersWhoMayNeedAccess()})},this.updateToolAssetAccess=()=>{this.setState({toolAccess:this.context.toolsData.toolAccess})},this.closeNotesMode=()=>{this.context.commandBinder.issueCommand(new it.tT(p.w1.NOTES,!1))},this.cancelNoteChanges=()=>{const{note:e,manager:t}=this.props,{activeNotation:i}=this.state;window.clearTimeout(this.cancelTimeout),t.dataMap.notesViewData.isNewNote?this.setState({cancellingCreation:!0},(()=>{this.closeNote(),this.cancelTimeout=window.setTimeout((()=>{this.setState({cancellingCreation:!1})}),500)})):e&&i&&this.cancelCommentChanges()},this.cancelCommentChanges=()=>{this.context.commandBinder.issueCommand(new Vh.oH)},this.closeNote=()=>{this.props.manager.dataMap.notesViewData.isNewNote?this.context.commandBinder.issueCommand(new Vh.gc):this.context.commandBinder.issueCommand(new Vh._N)},this.addReply=(e,t,i)=>{this.context.commandBinder.issueCommand(new Vh.Df(e,i,t)),this.setState({replyId:this.getReplyId()})},this.cancelReply=()=>{this.cancelCommentChanges(),this.setState({replyId:this.getReplyId()})},this.onViewAttachment=(e,t)=>{const{attachments:i}=this.state;if(i.length){this.trackEvent("notes_click_view_attachment");const e=i.filter((e=>(0,rr.lV)(e)));e.length>0&&this.context.commandBinder.issueCommand(new or.xW(!0,e,t))}},this.onNavigateList=async e=>{const t=this.props.noteListViews[e];if(!t)return;this.setState({listIndex:e,navigating:!0}),this.context.commandBinder.issueCommand(new or.xW(!1));const i=t.assetType===jh.h.COMMENT;await this.context.commandBinder.issueCommand(new Vh.Zd(t.id,i,!1)),i&&await this.context.messageBus.broadcast(new st.JL(t.id))},this.state={activeNotation:null,listIndex:-1,replyId:this.getReplyId(),toolAccess:p.X$.SCENE,hashtags:[],attachments:[],userMentionMap:{},cancellingCreation:!1,navigating:!1}}componentDidMount(){const{hashtagData:e,notesViewData:t}=this.props.manager.dataMap,{toolsData:i,userData:n}=this.context;this.bindings.push(i.onToolAssetAccessChanged(this.updateToolAssetAccess),e.onChanged(this.updateHashtags),t.onActiveNotationChanged(this.updateActiveNotation),t.onListIndexChanged(this.updateListIndex),n.onUsersChanged(this.updateUserMentionMap)),this.updateToolAssetAccess(),this.updateHashtags(),this.updateActiveNotation(),this.updateListIndex(),this.updateUserMentionMap()}componentWillUnmount(){window.clearTimeout(this.cancelTimeout);for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){var i;const{note:n}=this.props;e.note!==n&&(this.updateAttachments(),(null===(i=e.note)||void 0===i?void 0:i.id)!==(null==n?void 0:n.id)&&n&&(window.clearTimeout(this.cancelTimeout),this.setState({replyId:this.getReplyId()})),this.handleMissingNotation())}shouldComponentUpdate(){return!this.state.cancellingCreation}getReplyId(){return this.props.note?(0,Ue.O1)(11):null}handleMissingNotation(){const{note:e,manager:t,creatingNote:i}=this.props,{activeNotation:n,replyId:s}=this.state;if(i||!n)return;const{notesViewData:r}=t.dataMap;if(e){const t=e.id;n===t||n===s||r.getComment(t,n)||r.setActiveNotation(null)}else r.setActiveNotation(null)}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"notes"})}getCommentAttachments(e){return this.state.attachments.filter((t=>t.parentId===e))}renderReplyBox(){const{note:e,toolPanelLayout:t,manager:i}=this.props,{activeNotation:n,hashtags:s,replyId:r}=this.state;if(!e||!r)return null;const o=n===r;return o||null===n?(0,l.jsx)(Bu,{replyId:r,noteId:e.id,active:o,hashtags:s,manager:i,toolPanelLayout:t,onCancel:this.cancelReply,onReply:this.addReply},void 0):null}renderComments(){const{note:e,toolPanelLayout:t,manager:i}=this.props;if(!e)return null;const{activeNotation:n,hashtags:s,userMentionMap:r}=this.state;return(0,l.jsx)("div",Object.assign({className:"note-comments"},{children:e.comments.map(((o,a)=>{if(0===a)return null;const c=this.getCommentAttachments(o.id);return(0,l.jsx)(Ru,{active:n===o.id,manager:i,noteId:e.id,comment:o,attachments:c,hashtags:s,userMentionMap:r,toolPanelLayout:t,onCancel:this.cancelCommentChanges,onViewAttachment:this.onViewAttachment},o.id)}))}),void 0)}renderNoteNavHeader(){const{noteListViews:e,creatingNote:t,note:i,toolPanelLayout:n}=this.props;if(t||!i)return null;const{toolAccess:s,activeNotation:r,listIndex:o,navigating:a}=this.state,c=e.length,d=!t&&!r&&c>1&&-1!==o,h=n===p.wS.SIDE_PANEL,u=s===p.X$.SCENE,m=s===p.X$.LIST||!u&&h,f=this.context.locale.t(m?Ku.NAV_BACK:Ku.NAV_CLOSE),g=m?"icon-back":"icon-close",v=m||!u?this.closeNote:this.closeNotesMode;return(0,l.jsxs)("div",Object.assign({className:"detail-panel-header"},{children:[(0,l.jsx)(Wu,{label:f,className:"return-btn",icon:g,buttonSize:w.qE.SMALL,buttonStyle:w.ZJ.TOOLBAR,onClick:v},void 0),d&&(0,l.jsx)(Ih,{index:o,total:c,disabled:a,wrapAround:!0,onNavigate:this.onNavigateList},void 0)]}),void 0)}render(){var e,t;const{manager:i,note:n,toolPanelLayout:s,notesPhase:r,creatingNote:o}=this.props,{activeNotation:a,hashtags:c,userMentionMap:h}=this.state,{userData:u}=this.context,p=u.isCommenter(),m=null===(t=null===(e=null==n?void 0:n.comments)||void 0===e?void 0:e.get(0))||void 0===t?void 0:t.id,f=!!a&&(a===m||o),g={annotating:!!a,creating:o},v=m?this.getCommentAttachments(m):[];return(0,l.jsxs)("div",Object.assign({className:d()("note-widget",g)},{children:[this.renderNoteNavHeader(),n&&(0,l.jsx)(Gu,{active:f,manager:i,note:n,notesPhase:r,creatingNote:o,attachments:v,hashtags:c,userMentionMap:h,toolPanelLayout:s,onCancel:this.cancelNoteChanges,onViewAttachment:this.onViewAttachment},void 0),!o&&this.renderComments(),!o&&p&&this.renderReplyBox()]}),void 0)}}NoteWidget.contextType=m.I;var Yu=i(38321);class StemEditor extends r.Component{constructor(e){super(e),this.sliderRef=(0,r.createRef)(),this.stemLengthUpdating=(e,t=!0)=>{const i=t?(0,ts._F)(e):e;i!==this.props.stemLength&&this.props.onLengthUpdate(i)},this.saveStemLength=(e,t=!0)=>{const i=t?(0,ts._F)(e):e;this.props.onLengthChanged(i)},this.onChangeStemEnabled=()=>{this.props.onStemEnabledChanged(!this.props.stemEnabled)},this.stopPropagation=e=>e.stopPropagation(),this.updateUnits=()=>{this.setState({units:this.context.settings.tryGetProperty(_.gx.Units,is.M.IMPERIAL)})},this.formatStemHeight=e=>{if(this.state.units===is.M.IMPERIAL)return es(e);return`${Math.round(100*(0,ts._F)(e))/100}m`},this.state={units:is.M.IMPERIAL}}componentDidMount(){this.updateUnits(),this.sliderRef.current&&this.sliderRef.current.setValue((0,ts.zy)(this.props.stemLength)),this.context.settings.onPropertyChanged(_.gx.Units,this.updateUnits)}componentWillUnmount(){this.context.settings.removeOnPropertyChanged(_.gx.Units,this.updateUnits)}UNSAFE_componentWillReceiveProps(e){e.stemLength!==this.props.stemLength&&this.sliderRef.current&&this.sliderRef.current.setValue((0,ts.zy)(e.stemLength))}render(){const{stemEnabled:e,stemLength:t}=this.props;return(0,l.jsxs)("div",Object.assign({className:"stem-editor",onClick:this.stopPropagation},{children:[(0,l.jsx)("div",Object.assign({className:"stem-slider"},{children:(0,l.jsx)(SliderWithTooltip,{ref:this.sliderRef,discrete:!1,min:.1,max:9,initialValue:(0,ts.zy)(t),onChange:this.saveStemLength,onInput:this.stemLengthUpdating,displayBounds:!0,width:150,formatNumbers:this.formatStemHeight,tooltipPosition:Jn.DOWN},void 0)}),void 0),(0,l.jsx)(Xt,{enabled:!0,checked:e,label:"Show Stem",onChange:this.onChangeStemEnabled},void 0)]}),void 0)}}StemEditor.contextType=m.I;var qu=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Zu=class PinAssetEditor extends r.Component{constructor(e){super(e),this.closePinAssetEditor=e=>{e&&e.stopPropagation(),this.props.onClose()},this.handleColorPicked=e=>{this.trackEvent("pin_change_color"),this.props.onSave({color:e})},this.saveStemEnabled=e=>{this.trackEvent(e?"pin_show_stem":"pin_hide_stem"),this.props.onSave({stemEnabled:e})},this.saveStemLength=e=>{this.trackEvent("pin_change_stem_height"),this.props.onSave({stemLength:e})},this.previewStemLength=e=>{const{id:t,pinType:i}=this.props;this.context.commandBinder.issueCommand(new Yu.tE(t,i,{stemLength:e}))},this.stopPropagation=e=>{e.stopPropagation()}}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e})}renderStemEditor(){const{pin:e}=this.props;return(0,l.jsx)(StemEditor,{stemLength:e.stemLength,stemEnabled:e.stemEnabled,onLengthUpdate:this.previewStemLength,onLengthChanged:this.saveStemLength,onStemEnabledChanged:this.saveStemEnabled},void 0)}render(){const{toolPanelLayout:e,open:t,pin:i,colors:n}=this.props,s=e===p.wS.BOTTOM_PANEL;return t||s?(0,l.jsxs)("div",Object.assign({className:d()("pin-tool-editor",{"tool-popup":!s,open:s&&t}),onClick:this.stopPropagation},{children:[(0,l.jsxs)("div",Object.assign({className:"tool-editor-title"},{children:[(0,l.jsx)("span",{children:"Color & Stem"},void 0),(0,l.jsx)(te.P,{buttonStyle:te.A.LIGHT,onClose:this.closePinAssetEditor,hideTooltip:!0},void 0)]}),void 0),(0,l.jsx)(rs,{colors:n,defaultColor:i.color,onColorPicked:this.handleColorPicked},void 0),this.renderStemEditor()]}),void 0):null}};Zu.contextType=m.I,Zu=qu([I.Z],Zu);var $u=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Qu=class NoteDetailsPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.onCommentFocus=e=>{this.toolPanel.scrollToSelector(`[data-id='${e.commentId}']`)},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new Vh.df(!1))},this.savePinAppearance=e=>{const{note:t}=this.props;t&&this.context.commandBinder.issueCommand(new Vh.oE(t.id,e))},this.setToolPanelRef=e=>{e&&(this.toolPanel=e)}}componentDidMount(){this.bindings.push(this.context.messageBus.subscribe(st.JL,this.onCommentFocus))}componentWillUnmount(){for(const e of this.bindings)e.cancel()}componentDidUpdate(e){var t,i;this.toolPanel&&(e.notesPhase!==Fh.U.EDITING&&this.props.notesPhase===Fh.U.EDITING||(null===(t=e.note)||void 0===t?void 0:t.id)!==(null===(i=this.props.note)||void 0===i?void 0:i.id)||e.modalOpen&&!this.props.modalOpen)&&this.toolPanel.resetScrollTop()}render(){const{note:e,noteListViews:t,notesPhase:i,closing:n,creatingNote:s,modalOpen:r,toolPanelLayout:o,manager:a}=this.props,c=!!e&&(0,Hh.C)(this.context.userData,Zs.J.NOTE,e.user),d=i===Fh.U.EDITING,h=o===p.wS.BOTTOM_PANEL,u=!(!e||n||h&&r),m=d&&h;return(0,l.jsxs)(DetailPanel,Object.assign({ref:this.setToolPanelRef,open:u,overPanel:!0,toolPanelLayout:o,scrollingDisabled:m},{children:[(0,l.jsx)(NoteWidget,{manager:a,note:e,toolPanelLayout:o,notesPhase:i,creatingNote:s,noteListViews:t},void 0),e&&h&&c&&(0,l.jsx)(Zu,{id:e.id,pin:e,pinType:Ys.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,colors:et.ZP.colors,open:d,toolPanelLayout:o},e.id)]}),void 0)}};Qu.contextType=m.I,Qu=$u([I.Z],Qu);var Xu=i(84834);const Ju=({children:e,className:t=""})=>{if(!e)return null;const i=d()("list-panel-title",t);return(0,l.jsx)("div",Object.assign({className:i},{children:e}),void 0)};class ListPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.updateCollapsedState=()=>{this.setState({collapsedToBottom:this.context.toolsData.isPanelCollapsedToBottom()})},this.onToggleBottomCollapsed=e=>{const{collapsedToBottom:t,collapsing:i}=this.state;e&&e.stopPropagation(),i||(this.context.commandBinder.issueCommand(new it.zK(!t)),t||(this.setState({collapsing:!0}),window.setTimeout((()=>{this.setState({collapsing:!1})}),500)))},this.state={collapsedToBottom:e.toolPanelLayout===p.wS.BOTTOM_PANEL,collapsing:!1}}componentDidMount(){this.bindings.push(this.context.messageBus.subscribe(Oe.U7,this.updateCollapsedState)),this.updateCollapsedState()}componentWillUnmount(){this.bindings.forEach((e=>e.cancel()))}render(){const{active:e,toolPanelLayout:t,children:i,title:n,onClose:s,className:r,subheader:o,footer:a,subheaderCollapsedHeight:c}=this.props,{collapsedToBottom:h,collapsing:u}=this.state,m=t===p.wS.BOTTOM_PANEL,f=m&&h&&!u,g={active:e,collapsed:f},v=f?"icon-dpad-up":"icon-dpad-down",y=t===p.wS.BOTTOM_PANEL&&c&&h?{height:c+Ba.c9}:void 0;return(0,l.jsxs)("div",Object.assign({className:d()("list-panel",g,r),style:y},{children:[(n||s)&&(0,l.jsxs)("div",Object.assign({className:"list-panel-header",onClick:m?this.onToggleBottomCollapsed:void 0},{children:[n&&(0,l.jsx)(Ju,{children:n},void 0),(0,l.jsxs)("div",{children:[m&&(0,l.jsx)(T.hU,{iconClass:v,buttonStyle:T.Dd.PLAIN,onClick:this.onToggleBottomCollapsed},void 0),s&&(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.PLAIN,onClick:s},void 0)]},void 0)]}),void 0),c?o:!f&&(o||null),!f&&i,!f&&(a||null)]}),void 0)}}ListPanel.contextType=m.I;var ep=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let tp=class Accordions extends r.Component{constructor(e){super(e)}render(){const{children:e,className:t}=this.props,i=t||"";return(0,l.jsx)("div",Object.assign({className:d()("accordion-list",[i])},{children:e}),void 0)}};tp=ep([I.Z],tp);var ip=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let np=class AccordionHeader extends r.Component{constructor(e){super(e)}render(){const{label:e,onToggle:t,children:i,className:n}=this.props;return(0,l.jsxs)("div",Object.assign({className:d()("accordion-header",n),onClick:t||void 0},{children:[i,(0,l.jsx)("span",Object.assign({className:"accordion-header-label"},{children:e}),void 0),!!t&&(0,l.jsx)("button",{className:"icon accordion-icon accordion-toggle-icon"},void 0)]}),void 0)}};np=ip([I.Z],np);var sp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let rp=class AccordionGroup extends r.Component{constructor(e){super(e),this.toggleGroup=()=>{this.state.expanded?this.animateCollapseGroup():this.animateExpandGroup();const{id:e,onExpandChange:t}=this.props;t&&t(e,this.state.expanded)};const t=!e.header||!!e.open;this.state={expanded:t,showChildren:t};const{id:i,onExpandChange:n}=this.props;n&&n(i,this.state.expanded)}componentDidUpdate(e){!e.open&&this.props.open&&this.animateExpandGroup(),e.open&&!this.props.open&&this.animateCollapseGroup()}componentWillUnmount(){void 0!==this.timeout&&window.clearTimeout(this.timeout)}animateExpandGroup(){this.setState({showChildren:!0},(()=>{this.timeout=window.setTimeout((()=>{delete this.timeout,this.setState({expanded:!0})}))}))}animateCollapseGroup(){this.setState({expanded:!1},(()=>{this.timeout=window.setTimeout((()=>{delete this.timeout,this.state&&!this.state.expanded&&this.setState({showChildren:!1})}),Ba.g)}))}renderContents(){const{children:e,emptyMessage:t,doubleLine:i,naturalHeight:n}=this.props,{expanded:s,showChildren:r}=this.state,o=i?60:40,a=e&&Array.isArray(e)&&e.length||0,c=a>0;let d;d=s?c?a*o+"px":`${o}px`:"0";const h=n?void 0:{height:`${d}`},u=c?e:(0,l.jsx)("p",Object.assign({className:"hint accordion-empty-message"},{children:t||""}),void 0);return(0,l.jsx)("div",Object.assign({className:"accordion-contents",style:h},{children:r&&u}),void 0)}renderHeader(){const{header:e,collapsible:t}=this.props,{expanded:i}=this.state,n="string"==typeof e?e:void 0;if(n)return(0,l.jsx)(np,{label:n,expanded:i,onToggle:t?this.toggleGroup:void 0},void 0);if(void 0!==e){const t=e;return(0,r.cloneElement)(t,{expanded:i,onToggle:this.toggleGroup})}return null}render(){const{doubleLine:e}=this.props,{expanded:t}=this.state;return(0,l.jsxs)("div",Object.assign({className:d()("accordion-group",{expanded:t,collapsed:!t,"double-line":e}),"aria-expanded":t?"true":"false"},{children:[this.renderHeader(),this.renderContents()]}),void 0)}};rp=sp([I.Z],rp);class AccordionOptionsButton extends r.Component{constructor(e){super(e),this.popupMenuRef=(0,r.createRef)(),this.isUnmounting=!1,this.popupOpened=e=>{if(this.isUnmounting)return;const{id:t}=this.props;e.id!==t&&this.setState({open:!1})},this.toggleMenu=e=>{if(e.stopPropagation(),!this.popupMenuRef.current)return;const t=e.clientY+this.popupMenuRef.current.offsetHeight+ne.POPUP_OFFSET>window.innerHeight?J.BOTTOM_RIGHT:J.TOP_RIGHT;this.setState((e=>{const i=!e.open;return i&&this.context.messageBus.broadcast(new nt.nZ(this.props.id)),{arrowPosition:t,open:i}}))},this.onClose=()=>{this.setState({open:!1})},this.state={open:!1,arrowPosition:J.TOP_RIGHT}}componentDidMount(){this.context.messageBus.subscribe(nt.nZ,this.popupOpened)}componentWillUnmount(){this.isUnmounting=!0,this.context.messageBus.unsubscribe(nt.nZ,this.popupOpened)}renderMenu(){const{menu:e,closeOnMenuItemClick:t}=this.props,{locale:i}=this.context;return(0,l.jsx)("div",Object.assign({className:"tooltip-menu"},{children:e.map((([e,n])=>(0,l.jsx)("div",Object.assign({className:"tpMsg",onClick:e=>{e.stopPropagation(),n(),t&&this.onClose()}},{children:i.t(e)}),e)))}),void 0)}render(){const{arrowPosition:e,open:t}=this.state,{id:i,disabled:n}=this.props;return(0,l.jsx)(T.hU,Object.assign({dataValue:i,className:"accordion-options-button",buttonStyle:T.Dd.PLAIN,buttonState:!0===n?w.BN.DISABLED:void 0,iconClass:"accordion-icon icon-more-vert item-more-options",onClick:this.toggleMenu},{children:(0,l.jsx)("div",Object.assign({className:"accordion-options-button__tooltip-container",ref:this.popupMenuRef},{children:(0,l.jsx)(ne,{open:t,onClose:this.onClose,message:this.renderMenu(),arrowPos:e,bodyClassName:"item-tooltip"},void 0)}),void 0)}),void 0)}}AccordionOptionsButton.contextType=m.I;var op=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let ap=class AccordionItem extends r.Component{constructor(e){super(e),this.onClick=e=>{const t=e.target;this.props.onSelect&&!t.classList.contains("icon-more-vert")&&this.props.onSelect(this.props.sid)}}render(){const{enabled:e,selected:t,children:i,className:n}=this.props,s=d()("accordion-item",{"accordion-item-disabled":!e,"accordion-item-selected":t},n);return(0,l.jsx)("div",Object.assign({className:s,onClick:this.onClick},{children:i}),void 0)}};ap=op([I.Z],ap);const{NOTES:lp}=f.Z.SHOWCASE;var cp;!function(e){e.TODAY="TODAY",e.YESTERDAY="YESTERDAY",e.THIS_WEEK="THIS_WEEK",e.ONE_WEEK_AGO="ONE_WEEK_AGO",e.TWO_WEEKS_AGO="TWO_WEEKS_AGO",e.THREE_WEEKS_AGO="THREE_WEEKS_AGO",e.OLDER="OLDER"}(cp||(cp={}));class NotesList extends r.Component{constructor(e){super(e),this.bindings=[],this.transitionTimeout=0,this.updateNoteFilter=()=>{const e=this.props.manager.dataMap.notesViewData;this.setState({filter:e.notesFilter})},this.transitionNoteOut=e=>{const{filter:t}=this.state,i=e.resolved&&t===Xu.$.OPEN?e.id:null;this.setState({filteringOutId:i}),window.clearTimeout(this.transitionTimeout),i&&(this.transitionTimeout=window.setTimeout((()=>{this.setState({filteringOutId:null})}),Ba.g))},this.updateNoteGroups=()=>{const e=this.getSortedNoteGroups();this.setState({listGroups:e})},this.onSelectListItem=e=>{this.trackEvent("notes_list_open_note");const[t,i]=e.split("-"),n=t===jh.h.COMMENT;this.openListItem(i,n,!1)},this.editNote=e=>{this.trackEvent("notes_list_edit_note"),this.openListItem(e.id,!1,!0)},this.deleteNote=e=>{this.trackEvent("notes_list_delete_note"),this.context.commandBinder.issueCommand(new Vh.sG(e.id))},this.openNotesIntro=e=>{e.stopPropagation(),this.context.commandBinder.issueCommand(new we.Bz(Te.P.NOTES_INTRO,!0))},this.onFilterChange=e=>{if(e){const t=e;this.trackEvent("notes_list_change_filter"),this.props.manager.dataMap.notesViewData.setNotesFilter(t)}},this.onCloseLayer=async e=>{e&&e.stopPropagation(),await this.context.commandBinder.issueCommand(new it.tT(p.w1.NOTES,!1))},this.getMenuOptions=(e,t,i)=>{const n=[];if(t){const t=()=>this.editNote(e);n.push([lp.EDIT_LIST_ITEM_OPTION_CTA,t])}if(i){const t=()=>this.deleteNote(e);n.push([lp.DELETE_LIST_ITEM_OPTION_CTA,t])}return n},this.state={listGroups:{},filter:Xu.$.OPEN,filteringOutId:null}}componentDidMount(){const{notesViewData:e}=this.props.manager.dataMap,{messageBus:t}=this.context;this.bindings.push(e.onNotesFilterChanged(this.updateNoteFilter),t.subscribe(st.hY,this.transitionNoteOut)),this.textParser=new Wi.v({links:!0,hashtags:!0,users:this.context.userData}),this.updateNoteGroups(),this.updateNoteFilter()}componentWillUnmount(){window.clearTimeout(this.transitionTimeout);for(const e of this.bindings)e.cancel()}componentDidUpdate(e,t){e.noteListViews===this.props.noteListViews&&t.filter===this.state.filter&&e.searchBlock===this.props.searchBlock||this.updateNoteGroups()}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"notes"})}getSortedNoteGroups(){const e={};return this.props.noteListViews.forEach((t=>{const i=this.getDateBucket(t.createdTime);e[i]||(e[i]={dateBucket:i,items:[]}),e[i].items.push(t)})),e}getDateBucket(e){const t=new Date(e),i=new Date;i.setHours(0,0,0,0),t.setHours(0,0,0,0);const n=(i.getTime()-t.getTime())/864e5;if(0===n)return cp.TODAY;if(1===n)return cp.YESTERDAY;if(n<7)return cp.THIS_WEEK;const s=Math.floor(n/7);return 1===s?cp.ONE_WEEK_AGO:2===s?cp.TWO_WEEKS_AGO:3===s?cp.THREE_WEEKS_AGO:cp.OLDER}openListItem(e,t,i){this.context.commandBinder.issueCommand(new Vh.Zd(e,t,i))}getEmptyMessage(){const{searchBlock:e}=this.props,{filter:t}=this.state;return this.context.locale.t(e?lp.NO_MATCHES:t===Xu.$.OPEN?lp.HAVE_NONE_OPEN:t===Xu.$.RESOLVED?lp.HAVE_NONE_RESOLVED:lp.HAVE_NONE)}getAnnotationText(e){let t=e.text;if(""===t){const i=e.numAttachments,n=e.numComments-1;i>0?t=this.context.locale.t(lp.NUM_ATTACHMENTS,i):0===n&&(t=this.context.locale.t(lp.CONTENT_DELETED))}return t}getListTitle(){const{noteListViews:e,searchBlock:t}=this.props,i=e.length,n=this.context.locale.t(t?lp.RESULTS:lp.NOTES,i);return(0,l.jsxs)("div",{children:[n,(0,l.jsx)("span",Object.assign({className:"word-badge"},{children:"Beta"}),void 0),(0,l.jsx)(T.hU,{iconClass:"icon-question",buttonStyle:T.Dd.PLAIN,onClick:this.openNotesIntro},void 0)]},void 0)}renderAnnotationSummary(e){const t=this.getAnnotationText(e);return(0,l.jsx)("div",Object.assign({className:d()("note-text",{"note-summary-info":!e.text})},{children:(0,l.jsx)(Dr,{text:t,textParser:this.textParser,clickableLinks:!1,readonly:!0},void 0)}),void 0)}renderItem(e,t){const{filteringOutId:i}=this.state,{searchBlock:n}=this.props,{id:s,user:r,color:o,assetType:a,numComments:c}=e,h=`${a}-${s}`,{userData:u}=this.context,p=(0,Hh.C)(u,Zs.J.NOTE,e.user),m=(0,Hh.K)(u,Zs.J.NOTE,e.user),f=this.getMenuOptions(e,p,m),g=r?u.getUserDisplay(r.email):null,v=c-1,y=this.context.locale.t(lp.REPLIES,v),b=d()("note-header",{"accordion-item-with-options":f.length,"accordion-item-closing":s===i});return(0,l.jsxs)(ap,Object.assign({sid:h,className:b,enabled:!0,selected:!1,onSelect:this.onSelectListItem},{children:[(0,l.jsx)(nr,{badgeStyle:{backgroundColor:o,borderColor:o},iconClass:"icon-comment"},void 0),(0,l.jsxs)("div",Object.assign({className:"note-details"},{children:[g&&(0,l.jsx)("span",Object.assign({className:"note-user"},{children:g.name}),void 0),v>0&&!n&&(0,l.jsx)("span",Object.assign({className:"note-summary-info note-replies"},{children:y}),void 0),this.renderAnnotationSummary(e)]}),void 0),!n&&f.length>0&&(0,l.jsx)(AccordionOptionsButton,{id:s,menu:f},void 0)]}),h)}renderGroups(){const{listGroups:e,filteringOutId:t}=this.state,i=[];for(const n in e){const s=e[n];i.push((0,l.jsx)(rp,Object.assign({id:n,header:this.context.locale.t(lp[s.dateBucket]),open:!0,doubleLine:!0,naturalHeight:!!t},{children:s.items.map(((e,t)=>this.renderItem(e,t)))}),n))}return i}renderFilter(){const{filter:e}=this.state,t=[{text:this.context.locale.t(lp.FILTER_UNRESOLVED),value:Xu.$.OPEN,selected:e===Xu.$.OPEN},{text:this.context.locale.t(lp.FILTER_RESOLVED),value:Xu.$.RESOLVED,selected:e===Xu.$.RESOLVED},{text:this.context.locale.t(lp.FILTER_ALL),value:Xu.$.ALL,selected:e===Xu.$.ALL}];return(0,l.jsx)("div",Object.assign({className:"list-menu note-filter"},{children:(0,l.jsx)(SelectMenu,{className:"filter-note-select",menuStyle:se.DROPDOWN,onChange:this.onFilterChange,options:t},void 0)}),void 0)}renderNotesAndComments(){const{noteListViews:e}=this.props;if(0===e.length){const e=this.getEmptyMessage();return(0,l.jsx)("div",Object.assign({className:"empty-message"},{children:e}),void 0)}return(0,l.jsx)(tp,{children:this.renderGroups()},void 0)}renderFeedbackLink(){return(0,l.jsx)("div",Object.assign({className:"feedback"},{children:(0,l.jsxs)("a",Object.assign({className:"link",href:"https://forms.gle/LkkQ1kphFKGtBFfUA",target:"_blank"},{children:[this.context.locale.t(lp.FEEDBACK),(0,l.jsx)("span",{className:"icon icon-comment-outline"},void 0)]}),void 0)}),void 0)}renderSearchHeader(){const{searchBlock:e,onCancelSearch:t}=this.props;return e?(0,l.jsxs)("div",Object.assign({className:"list-search"},{children:[(0,l.jsx)("span",Object.assign({className:"search-term"},{children:e.text}),void 0),(0,l.jsx)(w.zx,Object.assign({buttonStyle:w.ZJ.PLAIN,onClick:t},{children:"Clear"}),void 0)]}),void 0):null}renderSubheader(){return(0,l.jsxs)("div",Object.assign({className:"list-subheaders"},{children:[this.renderSearchHeader(),this.renderFilter()]}),void 0)}render(){const{active:e,toolPanelLayout:t,searchBlock:i}=this.props,n=!!i&&i.blockType===zi.C.USER,s=!!i&&i.blockType===zi.C.HASH;return(0,l.jsx)(ListPanel,Object.assign({active:e,className:"annotations-list-panel",title:this.getListTitle(),subheader:this.renderSubheader(),toolPanelLayout:t,onClose:this.onCloseLayer},{children:(0,l.jsxs)("div",Object.assign({className:d()("list-contents","annotations-list",{"search-results-user":n,"search-results-hash":s})},{children:[this.renderNotesAndComments(),this.renderFeedbackLink()]}),void 0)}),void 0)}}NotesList.contextType=m.I;var dp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let hp=class NotesPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.detailPanelClosedTimeout=0,this.updateListViews=()=>{const e=this.props.manager.dataMap.notesViewData.noteListViews;this.setState({noteListViews:e.values()})},this.updateNotesPhase=()=>{this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.pinPlaced=e=>{e.pinType===Ys.Er.NOTE&&this.startOpeningNoteWidget()},this.startClosingDetailPanel=()=>{this.state.detailPanelClosing||(this.setState({detailPanelClosing:!0}),this.detailPanelClosedTimeout=window.setTimeout((()=>{this.setState({currentNote:null,detailPanelClosing:!1})}),Ba.El))},this.updateCurrentNote=async()=>{const{currentNote:e}=this.state,{notesPhase:t,openNoteView:i}=this.props.manager.dataMap.notesViewData;window.clearTimeout(this.detailPanelClosedTimeout),t===Fh.U.CREATING?(null==e?void 0:e.id)!==(null==i?void 0:i.id)&&this.startClosingDetailPanel():!e&&i?this.startOpeningNoteWidget():e&&!i?this.startClosingDetailPanel():this.setState({currentNote:i})},this.updateSearchTerm=()=>{const e=this.props.manager.dataMap.notesViewData;this.setState({searchBlock:e.searchBlock})},this.onCancelSearch=()=>{this.context.commandBinder.issueCommand(new Vh.av)},this.state={detailPanelClosing:!1,noteListViews:[],notesPhase:Fh.U.CLOSED,currentNote:null,searchBlock:null}}componentDidMount(){const{notesViewData:e}=this.props.manager.dataMap,{messageBus:t}=this.context;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onOpenNoteViewChanged(this.updateCurrentNote),e.noteListViews.onChanged(this.updateListViews),e.onSearchBlockChanged(this.updateSearchTerm),t.subscribe(Bh.b0,this.pinPlaced)),this.updateListViews(),this.updateCurrentNote(),this.updateNotesPhase(),this.updateSearchTerm()}componentWillUnmount(){window.clearTimeout(this.detailPanelClosedTimeout);for(const e of this.bindings)e.cancel()}startOpeningNoteWidget(){const e=this.props.manager.dataMap.notesViewData;window.clearTimeout(this.detailPanelClosedTimeout),this.setState({currentNote:e.openNoteView,detailPanelClosing:!1})}render(){const{toolPanelLayout:e,manager:t,modalOpen:i}=this.props,{notesViewData:n}=t.dataMap,{detailPanelClosing:s,searchBlock:r,noteListViews:o,notesPhase:a,currentNote:c}=this.state,d=s||!c,h=n.isNewNote;return(0,l.jsxs)("div",Object.assign({className:"tool-panel notes-panel"},{children:[(0,l.jsx)(Qu,{manager:t,closing:s,note:c,modalOpen:i,toolPanelLayout:e,notesPhase:a,creatingNote:h,noteListViews:o},void 0),(0,l.jsx)(NotesList,{manager:t,active:d,toolPanelLayout:e,noteListViews:o,searchBlock:r,onCancelSearch:this.onCancelSearch},void 0)]}),void 0)}};hp.contextType=m.I,hp=dp([I.Z],hp);const up=ae("openNoteView",(function(){const e=er(),[t,i]=(0,r.useState)(e?e.openNoteView:null);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=e.onOpenNoteViewChanged(i);return i(e.openNoteView),()=>t.cancel()}),[e]),t}));var pp,mp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const{NOTES:fp}=f.Z.SHOWCASE;let gp=pp=class NotesOverlay extends r.Component{constructor(e){super(e),this.bindings=[],this.touchDevice=(0,E.Jm)(),this.showNudgeTimeout=0,this.dismissNudgeTimeout=0,this.isUnmounting=!1,this.updateNotesPhase=()=>{this.isUnmounting||this.setState({notesPhase:this.props.manager.dataMap.notesViewData.notesPhase})},this.updateActiveAnnotation=()=>{if(this.isUnmounting)return;const e=this.props.manager.dataMap.notesViewData.activeNotation;this.setState({activeNotation:e})},this.updateForPinChanges=()=>{if(this.isUnmounting)return;const e=this.props.manager.dataMap.pinsViewData;this.setState({pinEditorState:e.pinEditorState,creationProgress:e.progress,screenPosition:e.screenPosition,canPlace:e.canPlace,canAdd:e.canAdd})},this.showNudge=()=>{this.isUnmounting||(this.setState({showAddNudge:!0}),this.dismissNudgeTimeout=window.setTimeout(this.dismissNudge,pp.DISMISS_NUDGE_TIMEOUT))},this.dismissNudge=()=>{this.isUnmounting||(this.context.settings.setLocalStorageProperty(tt.F.NotesAddNudgeSeen,!0),this.setState({showAddNudge:!1}))},this.clickCTAButton=e=>{this.dismissNudge(),this.hasCancelCta()?(e.stopPropagation(),this.props.manager.dataMap.notesViewData.isNewNote&&this.context.commandBinder.issueCommand(new Vh.gc)):this.onStartAddingNote(e)},this.savePinAppearance=e=>{const{openNoteView:t}=this.props;t&&this.context.commandBinder.issueCommand(new Vh.oE(t.id,e))},this.onStartAddingNote=e=>{e.stopPropagation(),this.trackEvent("notes_overlay_click_add"),this.context.commandBinder.issueCommand(new Vh.VI)},this.deleteNote=()=>{const{openNoteView:e}=this.props;e&&(this.trackEvent("notes_overlay_click_delete"),this.context.commandBinder.issueCommand(new Vh.sG(e.id)))},this.closeEditor=()=>{this.context.commandBinder.issueCommand(new Vh.df(!1))},this.toggleColorPicker=e=>{e.stopPropagation();const{notesPhase:t}=this.state,i=t===Fh.U.EDITING;this.context.commandBinder.issueCommand(new Vh.df(!i)),this.setState({showAddNudge:!1})},this.state={showAddNudge:!1,notesPhase:Fh.U.CLOSED,pinEditorState:Ys.V8.IDLE,activeNotation:null,screenPosition:null,creationProgress:0,canPlace:!0,canAdd:!0}}componentDidMount(){const{notesViewData:e,pinsViewData:t}=this.props.manager.dataMap;this.bindings.push(e.onNotesPhaseChanged(this.updateNotesPhase),e.onActiveNotationChanged(this.updateActiveAnnotation),t.onChanged(this.updateForPinChanges)),this.setNudge(),this.updateNotesPhase(),this.updateForPinChanges(),this.updateActiveAnnotation()}componentDidUpdate(e){var t,i;(null===(t=e.openNoteView)||void 0===t?void 0:t.id)!==(null===(i=this.props.openNoteView)||void 0===i?void 0:i.id)&&this.dismissNudge()}componentWillUnmount(){this.isUnmounting=!0,window.clearTimeout(this.showNudgeTimeout),window.clearTimeout(this.dismissNudgeTimeout);for(const e of this.bindings)e.cancel()}setNudge(){this.context.settings.tryGetProperty(tt.F.NotesAddNudgeSeen,!1)||this.showNudgeTimeout||(this.showNudgeTimeout=window.setTimeout(this.showNudge,pp.SHOW_NUDGE_TIMEOUT))}trackEvent(e){const t=this.context.editMode?"workshop_gui":"showcase_gui";this.context.analytics.track(t,{gui_action:e,tool:"notes"})}hasCancelCta(){const{pinEditorState:e}=this.state;return e===Ys.V8.CREATING||e===Ys.V8.PLACING}renderOverlayMessage(){const{pinEditorState:e,canPlace:t}=this.state;if(e===Ys.V8.CREATING||!this.touchDevice&&e===Ys.V8.PLACING||!t){const e=this.context.locale.t(this.touchDevice?fp.OVERLAY_ADD_TOUCH:fp.OVERLAY_ADD_CLICK),i=this.context.locale.t(this.touchDevice?fp.OVERLAY_PLACE_TOUCH:fp.OVERLAY_PLACE_CLICK),n=t?e:i;return(0,l.jsxs)("div",Object.assign({className:"overlay-message"},{children:[(0,l.jsx)("div",{className:"icon icon-notes"},void 0),(0,l.jsx)("span",Object.assign({className:"message"},{children:n}),void 0)]}),void 0)}return null}renderProgressCircle(){const{creationProgress:e,screenPosition:t,pinEditorState:i}=this.state;if(!(i===Ys.V8.PRESSING&&e>0&&this.touchDevice)||!t)return null;const n={left:t.x-pp.PROGRESS_RADIUS/2+"px",top:t.y-pp.PROGRESS_RADIUS/2+"px"};return(0,l.jsx)("div",Object.assign({className:"point-button-wrapper",style:n},{children:(0,l.jsx)(ks,Object.assign({progress:100*e,innerRadius:pp.PROGRESS_RADIUS,barWidth:pp.PROGRESS_WIDTH},{children:(0,l.jsx)("circle",{className:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"},void 0)}),void 0)}),void 0)}renderTopBar(e){const{notesPhase:t}=this.state,{openNoteView:i,toolPanelLayout:n,manager:s}=this.props,{notesViewData:r}=s.dataMap,o=n===p.wS.SIDE_PANEL,a=r.isNewNote;if(o||a)return this.renderOverlayMessage();if(i&&e){const e=t!==Fh.U.OPENING&&!!i,n=t===Fh.U.EDITING?w.BN.ACTIVE:e?w.BN.ENABLED:w.BN.DISABLED;return(0,l.jsx)("div",Object.assign({className:"overlay-bar overlay-top-right"},{children:(0,l.jsx)(T.hU,{iconClass:"icon-stem-height",buttonStyle:T.Dd.OVERLAY,buttonState:n,onClick:this.toggleColorPicker},void 0)}),void 0)}return null}renderCta(e){const{showAddNudge:t,canAdd:i}=this.state,n=this.hasCancelCta(),s=i?w.BN.ENABLED:w.BN.DISABLED,r=!i||t?void 0:this.context.locale.t(n?fp.CANCEL_TOOLTIP:fp.ADD_TOOLTIP);return(0,l.jsx)(T.hU,Object.assign({className:"overlay-cta-btn",buttonStyle:T.Dd.PRIMARY,buttonState:s,tooltipMsg:r,tooltipPosition:e,onClick:this.clickCTAButton},{children:(0,l.jsx)("div",Object.assign({className:d()("overlay-cta-rotate-btn",{"overlay-cta-cancel":n})},{children:(0,l.jsx)("span",{className:"icon icon-plus"},void 0)}),void 0)}),void 0)}renderActionBar(e){const{openNoteView:t}=this.props,{showAddNudge:i,notesPhase:n,activeNotation:s,pinEditorState:r}=this.state;if(n===Fh.U.CLOSED||s)return null;const{toolPanelLayout:o}=this.props,a=r===Ys.V8.CREATING||r===Ys.V8.PLACING,c=n===Fh.U.EDITING,h=n===Fh.U.OPENING,u=o===p.wS.SIDE_PANEL,m=this.context.locale.t(fp.COLOR_STEM_TOOLTIP),f=this.context.locale.t(fp.DELETE_TOOLTIP);if(u){const n=!a&&!h&&!!t,s=c?w.BN.ACTIVE:n?w.BN.ENABLED:w.BN.DISABLED;return(0,l.jsxs)("div",Object.assign({className:"overlay-cta"},{children:[e&&(0,l.jsx)(T.hU,{className:d()("overlay-cta-button-outer","overlay-cta-button-outer-left"),iconClass:"icon-stem-height",buttonStyle:T.Dd.OVERLAY,buttonState:s,tooltipMsg:m,tooltipPosition:x.lZ.DOWN,onClick:this.toggleColorPicker},void 0),(0,l.jsx)(ne,{className:"tooltip-simple-medium",open:i,message:(0,l.jsx)("span",{children:this.context.locale.t(fp.ADD_CTA_TOOLTIP)},void 0),arrowPos:J.BOTTOM_CENTER},void 0),this.renderCta(x.lZ.DOWN),e&&(0,l.jsx)(T.hU,{className:"overlay-cta-button-outer",buttonStyle:T.Dd.OVERLAY,iconClass:"icon-delete",tooltipMsg:f,tooltipPosition:x.lZ.DOWN,buttonState:n?w.BN.ENABLED:w.BN.DISABLED,onClick:this.deleteNote},void 0)]}),void 0)}return(0,l.jsx)("div",Object.assign({className:"overlay-cta"},{children:this.renderCta(x.lZ.UP)}),void 0)}render(){const{toolPanelLayout:e,openModal:t,openNoteView:i}=this.props;if(t)return null;const{notesPhase:n}=this.state,{userData:s}=this.context,r=s.isCommenter(),o=!!i&&(0,Hh.C)(s,Zs.J.NOTE,i.user),a=n===Fh.U.EDITING,c=e===p.wS.SIDE_PANEL;return(0,l.jsxs)("div",Object.assign({className:"overlay"},{children:[this.renderTopBar(o),r&&this.renderActionBar(o),i&&c&&o&&(0,l.jsx)(Zu,{pin:i,id:i.id,pinType:Ys.Er.NOTE,onSave:this.savePinAppearance,onClose:this.closeEditor,open:a,colors:et.ZP.colors,toolPanelLayout:e},void 0),this.renderProgressCircle()]}),void 0)}};gp.contextType=m.I,gp.PROGRESS_RADIUS=132,gp.PROGRESS_WIDTH=8,gp.SHOW_NUDGE_TIMEOUT=5e3,gp.DISMISS_NUDGE_TIMEOUT=5e3,gp=pp=mp([I.Z],gp);const vp=up(gp);var yp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let bp=class TagsOverlay extends r.Component{constructor(e){super(e)}render(){const{toolPanelLayout:e,openModal:t}=this.props;return t||e===p.wS.SIDE_PANEL||e===p.wS.BOTTOM_PANEL?null:(0,l.jsx)("div",Object.assign({className:"overlay"},{children:(0,l.jsx)("div",Object.assign({className:"overlay-top-center tags-navigation-bar"},{children:(0,l.jsx)("div",Object.assign({className:"overlay-info"},{children:(0,l.jsx)(Rh,{toolPanelLayout:e,overlay:!0},void 0)}),void 0)}),void 0)}),void 0)}};bp=yp([I.Z],bp);var Sp=i(60725),Ep=i(58878),Tp=i(62518),wp=i(41911);var xp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let _p=class SettingsBox extends r.Component{constructor(){super(...arguments),this.stopClickPropagation=e=>{e.stopPropagation()}}render(){const{children:e,open:t,className:i,close:n,arrowPosition:s}=this.props,r=(0,l.jsx)("div",Object.assign({className:"settings-container settings-box",onClick:this.stopClickPropagation,onMouseDown:this.stopClickPropagation},{children:e}),void 0);return(0,l.jsx)(ne,{open:t,message:r,className:i,arrowPos:s,onClose:n},void 0)}};_p=xp([I.Z],_p);var Mp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Op=class SettingsToggle extends r.Component{render(){const{label:e,children:t,className:i}=this.props;return(0,l.jsxs)("div",Object.assign({className:d()("settings-toggle",i)},{children:[e&&(0,l.jsx)("div",Object.assign({className:"settings-label"},{children:e}),void 0),t]}),void 0)}};Op=Mp([I.Z],Op);var Ap=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Cp=class Toggle extends r.Component{constructor(e,t){super(e),this.onClick=()=>{this.props.enabled&&this.props.onToggle()},this.locale={onSettingString:t.locale.t(f.Z.ON),offSettingString:t.locale.t(f.Z.OFF)};const i=Math.max(this.props.toggleTime||300);this.trackTransitionStyle={transition:`backgroundColor ${i}ms`},this.thumbTransitionStyle={transition:`backgroundColor ${i}ms, left ${i}ms`}}render(){const{id:e,toggled:t,enabled:i,onOffLabel:n,className:s}=this.props,r=t?this.locale.onSettingString:this.locale.offSettingString;return(0,l.jsxs)("div",Object.assign({className:d()("reusable-toggle",s,{"toggle-on":t,enabled:i}),id:e,onClick:this.onClick},{children:[n&&(0,l.jsx)("span",Object.assign({className:"toggle-label"},{children:r}),void 0),(0,l.jsx)("div",{style:this.trackTransitionStyle,className:"track"},void 0),(0,l.jsx)("div",{style:this.thumbTransitionStyle,className:"thumb"},void 0)]}),void 0)}};Cp.contextType=m.I,Cp=Ap([I.Z],Cp);var Pp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Dp=class RadioButton extends r.Component{constructor(e){super(e),this.onChange=e=>{this.props.onChange(e)}}render(){const{id:e,name:t,value:i,checked:n,children:s,enabled:r}=this.props,o=!r;return(0,l.jsxs)("div",Object.assign({className:d()("radio-element","radio-button",{disabled:o})},{children:[(0,l.jsx)("input",{type:"radio",id:e,name:t,value:i,checked:n,onChange:this.onChange},void 0),(0,l.jsx)("label",Object.assign({htmlFor:e},{children:s}),void 0)]}),void 0)}};Dp=Pp([I.Z],Dp);var Np=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let Ip=class MeasurementSettings extends r.Component{constructor(e,t){super(e),this.propertiesToRefreshUi=[tt.F.UnitType,tt.F.MeasurementSnapping,tt.F.MeasurementContinuousLines],this.close=()=>{this.setState({settingsOpen:!1})},this.updatePerSettings=()=>{this.setState({units:this.context.settings.tryGetProperty(tt.F.UnitType,is.M.METRIC),snapping:this.context.settings.tryGetProperty(tt.F.MeasurementSnapping,!1),continuousLines:this.context.settings.tryGetProperty(tt.F.MeasurementContinuousLines,!1)})},this.toggleUnits=()=>{const e=this.state.units!==is.M.METRIC?is.M.METRIC:is.M.IMPERIAL;this.context.settings.setLocalStorageProperty(tt.F.UnitType,e)},this.toggleSnapping=()=>{const e=this.state.snapping;this.context.settings.setLocalStorageProperty(tt.F.MeasurementSnapping,!e)},this.toggleOpen=e=>{e.stopPropagation();const{onToggle:t}=this.props;t&&t(e,!this.state.settingsOpen),this.setState((e=>({settingsOpen:!e.settingsOpen})))},this.toggleContinuousLines=()=>{const e=this.state.continuousLines;this.context.settings.setLocalStorageProperty(tt.F.MeasurementContinuousLines,!e)},this.locale={continuousLinesString:t.locale.t(f.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(f.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(f.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(f.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(f.Z.MEASUREMENT_METRIC),settingsString:t.locale.t(f.Z.MEASUREMENT_SETTINGS),closeString:t.locale.t(f.Z.CLOSE)},this.state={settingsOpen:!1,units:is.M.METRIC,snapping:!1,continuousLines:!1}}async componentDidMount(){for(const e of this.propertiesToRefreshUi)this.context.settings.onPropertyChanged(e,this.updatePerSettings);this.updatePerSettings()}componentWillUnmount(){for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.updatePerSettings)}render(){const{iconButtonStyle:e}=this.props,{settingsOpen:t}=this.state,{settingsString:i}=this.locale,n=e||T.Dd.OVERLAY;return(0,l.jsx)(T.hU,Object.assign({className:"measurement-settings-btn",buttonStyle:n,iconClass:"icon-settings",buttonState:t?w.BN.ACTIVE:w.BN.ENABLED,onClick:this.toggleOpen,tooltipMsg:!t&&i||void 0,tooltipPosition:x.lZ.DOWN},{children:this.renderSettingsPopup()}),void 0)}renderSettingsPopup(){const{settingsOpen:e,units:t,snapping:i,continuousLines:n}=this.state,{continuousLinesString:s,snappingString:r,unitsString:o,imperialString:a,metricString:c}=this.locale,d=t===is.M.METRIC;return(0,l.jsxs)(_p,Object.assign({className:"measurement-settings-popup",arrowPosition:J.TOP_RIGHT,open:e,close:this.close},{children:[(0,l.jsx)(Op,Object.assign({label:r},{children:(0,l.jsx)(Cp,{onToggle:this.toggleSnapping,enabled:!0,onOffLabel:!0,toggled:i},void 0)}),void 0),(0,l.jsx)(Op,Object.assign({label:s},{children:(0,l.jsx)(Cp,{onToggle:this.toggleContinuousLines,enabled:!0,onOffLabel:!0,toggled:n},void 0)}),void 0),(0,l.jsx)(Op,Object.assign({label:o,className:"units-setting"},{children:(0,l.jsxs)("div",Object.assign({className:"radio-group radio-buttons"},{children:[(0,l.jsx)(Dp,Object.assign({name:"unit",value:is.M.IMPERIAL,id:"unit-imperial",enabled:!0,checked:!d,onChange:this.toggleUnits},{children:a}),void 0),(0,l.jsx)(Dp,Object.assign({name:"unit",value:is.M.METRIC,id:"unit-metric",enabled:!0,checked:d,onChange:this.toggleUnits},{children:c}),void 0)]}),void 0)}),void 0)]}),void 0)}};Ip.contextType=m.I,Ip=Np([I.Z],Ip);const Lp={[Sp.au.CREATING]:!0,[Sp.au.CONFIRMING_POINT]:!0},Rp={[Sp.au.IDLE]:!0,[Sp.au.CREATING]:!0,[Sp.au.CREATING_NEXT_POINT]:!0},kp=(Sp.au.CREATING,Sp.au.CONFIRMING_POINT,{[Sp.au.IDLE]:!0,[Sp.au.CREATING]:!0,[Sp.au.CREATING_NEXT_POINT]:!0}),Up="measurement-mode-add-tooltip",Bp="measurement-mode-desktop-help",Fp="measurement-mode-mobile-help";var Vp,Hp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let jp=Vp=class MeasurementsOverlay extends r.Component{constructor(e,t){super(e),this.bindings=[],this.measurementSettingsRef=(0,r.createRef)(),this.propertiesToRefreshUi=[tt.F.UnitType,tt.F.MeasurementSnapping,tt.F.MeasurementContinuousLines,Up,Bp,Fp],this.isUnmounting=!1,this.onMeasurementModeDataChanged=()=>{const{measurementModeData:e}=this.props.manager.dataMap,t=e.selectedGroupInfo,i=e.phase,n=e.pressProgress>=.95?1:e.pressProgress;i===Sp.au.CLOSED?(this.closeMeasurementHelpModal(),this.dismissAddTooltip()):i===Sp.au.IDLE&&this.updateAddTooltipVisibility(),this.setState({phase:i,pressProgress:n,selectedGroup:t,pointPosition:e.pointPosition})},this.updatePerSettings=()=>{const e=this.context.settings;this.setState({units:e.tryGetProperty(tt.F.UnitType,is.M.METRIC),snapping:e.tryGetProperty(tt.F.MeasurementSnapping,!1),continuousLines:e.tryGetProperty(tt.F.MeasurementContinuousLines,!1),addTooltipShown:e.tryGetProperty(Up,!1),desktopHelpShown:e.tryGetProperty(Bp,!1),mobileHelpShown:e.tryGetProperty(Fp,!1)})},this.updateAddTooltipVisibility=()=>{this.state.addTooltipShown||this.context.editMode||this.isUnmounting||(this.setState({showAddTooltip:!0}),window.clearTimeout(this.startAddingTooltip),this.startAddingTooltip=window.setTimeout((()=>{this.dismissAddTooltip()}),Vp.START_ADDING_TOOLTIP_TIMEOUT))},this.dismissAddTooltip=()=>{this.isUnmounting||(this.setState({showAddTooltip:!1}),this.context.settings.setProperty(Up,!0))},this.getOverlayComponents=()=>{const{mobile:e,openModal:t}=this.props,{mobileHelpShown:i,desktopHelpShown:n,phase:s}=this.state,{editMode:r}=this.context,o=t===Te.P.MEASUREMENT_HELP,{closeString:a,helpString:c}=this.locale,h=r?"overlay-top-center":"overlay-bar",u=s!==Sp.au.IDLE&&s!==Sp.au.CLOSED,p=[(0,l.jsxs)("div",Object.assign({className:d()(h,{"active-phase":u})},{children:[!r&&(0,l.jsx)("div",{className:"overlay-bar-filler"},void 0),(0,l.jsx)("div",Object.assign({className:"overlay-bar-center"},{children:this.renderOverlayInfo()}),void 0),!r&&(0,l.jsxs)("div",Object.assign({className:"overlay-bar-right"},{children:[(0,l.jsx)(T.hU,{className:"measurement-help-btn",buttonStyle:T.Dd.OVERLAY,iconClass:"icon-help",buttonState:o?w.BN.ACTIVE:w.BN.ENABLED,onClick:this.toggleHelpOpen,tooltipMsg:!o&&c||void 0,tooltipPosition:x.lZ.DOWN},void 0),(0,l.jsx)(Ip,{ref:this.measurementSettingsRef,onToggle:this.settingsToggled},void 0),(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.OVERLAY,tooltipMsg:a,tooltipPosition:x.lZ.DOWN,onClick:this.onCloseMeasurementTool},void 0)]}),void 0)]}),"top-bar")];if(!n||!i){const t=e?this.getMobileHelp():this.getDesktopHelp();p.push(t)}return p},this.getMobileHelp=()=>{const{phase:e}=this.state,{pressHoldStart:t,pressHoldEnd:i,dragEdit:n}=this.locale.mobileHelp;let s,r;switch(e){case Sp.au.CREATING_NEXT_POINT:s=(0,l.jsx)("div",{className:"icon icon-drag-edit"},void 0),r=(0,l.jsx)("span",Object.assign({className:"message"},{children:i}),void 0);break;case Sp.au.EDITING:case Sp.au.POINT_PLACED:s=(0,l.jsx)("div",{className:"icon icon-finger-drag"},void 0),r=(0,l.jsx)("span",Object.assign({className:"message"},{children:n}),void 0);break;case Sp.au.CREATING:s=(0,l.jsx)("div",{className:"icon icon-press-hold"},void 0),r=(0,l.jsx)("span",Object.assign({className:"message"},{children:t}),void 0)}return(0,l.jsxs)("div",Object.assign({className:"overlay-message"},{children:[s,r]}),"mobile-help")},this.getDesktopHelp=()=>{const{phase:e,selectedGroup:t}=this.state,{clickAnywhereString:n,escapeString:s}=this.locale.desktopHelp;let r,o;switch(e){case Sp.au.CREATING:r=(0,l.jsx)("div",{className:"icon icon-draw-lines"},void 0),o=(0,l.jsx)("span",Object.assign({className:"message"},{children:n}),void 0);break;case Sp.au.CREATING_NEXT_POINT:t&&t.count>=3&&(r=(0,l.jsx)("div",Object.assign({className:"escape-key"},{children:(0,l.jsx)("img",{src:i(78899)},void 0)}),void 0),o=(0,l.jsx)("span",Object.assign({className:"message escape-message"},{children:s}),void 0))}return(0,l.jsxs)("div",Object.assign({className:"overlay-message"},{children:[r,o]}),"desktop-help")},this.clickCTAButton=e=>{const{phase:t}=this.state;t===Sp.au.IDLE?this.onStartPointPlacement(e):this.onStopPointPlacement(e)},this.onDeleteMeasurement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new Ep.Ev)},this.onStartPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new Tp.c),this.dismissAddTooltip()},this.onStopPointPlacement=e=>{e&&e.stopPropagation(),this.context.commandBinder.issueCommand(new wp.B)},this.onCloseMeasurementTool=async e=>{e&&e.stopPropagation(),this.closeMeasurementHelpModal(),await this.context.commandBinder.issueCommand(new it.tT(p.w1.MEASUREMENTS,!1));const t=this.measurementSettingsRef.current;t&&t.close(),this.dismissAddTooltip()},this.settingsToggled=(e,t)=>{e.stopPropagation(),t&&this.closeMeasurementHelpModal()},this.toggleHelpOpen=e=>{const{openModal:t}=this.props,i=t===Te.P.MEASUREMENT_HELP;e.stopPropagation();const n=this.measurementSettingsRef.current;n&&n.close(),i||this.context.analytics.track("showcase_gui",{gui_action:"measure_mode_help_clicked",tool:"measurements"}),this.context.commandBinder.issueCommand(new we.Bz(Te.P.MEASUREMENT_HELP,!i))},this.locale={startAddingString:t.locale.t(f.Z.MEASUREMENT_START_ADDING),continuousLinesString:t.locale.t(f.Z.MEASUREMENT_CONTINUOUS_LINES),snappingString:t.locale.t(f.Z.MEASUREMENT_SNAPPING),unitsString:t.locale.t(f.Z.MEASUREMENT_UNITS),imperialString:t.locale.t(f.Z.MEASUREMENT_IMPERIAL),metricString:t.locale.t(f.Z.MEASUREMENT_METRIC),desktopHelp:{clickAnywhereString:t.locale.t(f.Z.MEASUREMENT_HELP_CLICK_ANYWHERE),escapeString:t.locale.t(f.Z.MEASUREMENT_HELP_ESCAPE)},mobileHelp:{pressHoldStart:t.locale.t(f.Z.MEASUREMENT_HELP_PRESS_START),dragEdit:t.locale.t(f.Z.MEASUREMENT_HELP_DRAG_EDIT),pressHoldEnd:t.locale.t(f.Z.MEASUREMENT_HELP_PRESS_END)},helpString:t.locale.t(f.Z.HELP),closeString:t.locale.t(f.Z.CLOSE)},this.state={units:is.M.METRIC,snapping:!1,continuousLines:!1,phase:Sp.au.CLOSED,selectedGroup:null,pressProgress:0,pointPosition:null,showAddTooltip:!1,desktopHelpShown:!1,mobileHelpShown:!1,addTooltipShown:!1}}async componentDidMount(){const{measurementModeData:e}=this.props.manager.dataMap;this.bindings.push(e.onChanged(this.onMeasurementModeDataChanged),e.onDataChanged(this.onMeasurementModeDataChanged));for(const e of this.propertiesToRefreshUi)this.bindings.push(this.context.settings.onPropertyChanged(e,this.updatePerSettings));this.onMeasurementModeDataChanged(),this.updatePerSettings()}componentWillUnmount(){this.isUnmounting=!0;for(const e of this.bindings)e.cancel()}componentDidUpdate(){const{mobile:e}=this.props,{continuousLines:t,selectedGroup:i}=this.state;if(e)this.isCheckVisible()&&this.context.settings.setProperty(Fp,!0);else if(null!==i){const e=i.count;(t?e>3:2===e)&&this.context.settings.setProperty(Bp,!0)}}renderProgressCircle(){const{mobile:e}=this.props,{pressProgress:t,pointPosition:i,phase:n}=this.state;if(!e||null===i||t<=0||!Lp[n])return null;const s={left:i.x-Vp.pointButtonRadius/2+"px",top:i.y-Vp.pointButtonRadius/2+"px"};return(0,l.jsx)("div",Object.assign({className:"point-button-wrapper",style:s},{children:(0,l.jsx)(ks,Object.assign({className:d()({complete:1===t,reset:0===t}),progress:100*t,innerRadius:Vp.pointButtonRadius,barWidth:Vp.pressProgressBarThickness},{children:(0,l.jsx)("circle",{className:"point",cx:"0",cy:"0",r:"22",transform:"rotate(-90)",fill:"#fff"},void 0)}),void 0)}),void 0)}renderOverlayInfo(){const{selectedGroup:e,units:t}=this.state;if(null===e)return null;const i=e.info.text?` ${e.info.text}`:"",n=`${((e,t)=>{if(t===is.M.METRIC)return`${e.toFixed(2)}m`;const{feet:i,inches:n}=(0,ts.XJ)(e);return i>0?`${i}' ${n}"`:`${n}"`})(e.length,t)} ${i}`;return(0,l.jsx)("div",Object.assign({className:"overlay-info"},{children:n}),void 0)}render(){return(0,l.jsxs)("div",Object.assign({className:"overlay measurements-overlay"},{children:[this.getOverlayComponents(),this.renderProgressCircle(),this.renderOverlayCta()]}),void 0)}hasCancelCta(){if(this.isCheckVisible())return!1;const{phase:e,selectedGroup:t}=this.state,i=e===Sp.au.CREATING&&(!t||0===t.count),n=e===Sp.au.CREATING_NEXT_POINT&&!!t&&2===t.count;return i||n}isCheckVisible(){const{phase:e,continuousLines:t}=this.state;return this.isCompleteMeasurement()&&(t?e===Sp.au.CREATING_NEXT_POINT:e===Sp.au.CREATING)}isCompleteMeasurement(){const{continuousLines:e,selectedGroup:t}=this.state;if(null===t)return!1;const i=t.count;return e?i>2:2===i}renderOverlayCta(){const{startAddingString:e}=this.locale,{mobile:t,unaligned:i}=this.props,{phase:n,showAddTooltip:s,selectedGroup:r}=this.state,o=n===Sp.au.EDITING,a=r&&r.count>0&&(t?!!Rp[n]:!!kp[n])?w.BN.ENABLED:w.BN.DISABLED,c=this.isCheckVisible()?"icon-checkmark":"icon-plus",h=i||o?w.BN.DISABLED:w.BN.ENABLED,u=d()("overlay-cta-btn",{"overlay-cta-cancel":this.hasCancelCta()});return(0,l.jsxs)("div",Object.assign({className:"overlay-cta"},{children:[(0,l.jsx)(ne,{className:"tooltip-simple-medium",open:s,message:(0,l.jsx)("span",{children:e},void 0),arrowPos:J.BOTTOM_CENTER},void 0),(0,l.jsx)(T.hU,{className:u,iconClass:c,buttonStyle:T.Dd.PRIMARY,buttonState:h,onClick:this.clickCTAButton},void 0),(0,l.jsx)(T.hU,{className:"overlay-cta-button-outer",buttonStyle:T.Dd.OVERLAY,iconClass:"icon-delete",buttonState:a,onClick:this.onDeleteMeasurement},void 0)]}),void 0)}closeMeasurementHelpModal(){const{openModal:e}=this.props;e===Te.P.MEASUREMENT_HELP&&this.context.commandBinder.issueCommand(new we.Bz(e,!1))}};jp.contextType=m.I,jp.pointButtonRadius=132,jp.pressProgressBarThickness=8,jp.START_ADDING_TOOLTIP_TIMEOUT=5e3,jp=Vp=Hp([I.Z],jp);var Gp=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};let zp=class VrEnterButtonControls extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.startWebXR=()=>{this.context.commandBinder.issueCommand(new bo.j({type:"immersive-vr",features:["local-floor"]})).then((e=>{if(e){this.trackEvent("vr_enter_app");const t=()=>{this.trackEvent("vr_exit_app"),e.removeEventListener("end",t)};e.addEventListener("end",t)}else this.trackEvent("vr_present_error"),this.updatePlatformState()})).catch((e=>{const t=e?{message:e.message||"",name:e.name||""}:void 0;this.trackEvent("vr_present_error",t)}))},this.state={vrPlatform:null}}async componentDidMount(){yo.Z.apiExists()&&navigator.xr.addEventListener("ondevicechange",this.updatePlatformState),await this.updatePlatformState()}componentWillUnmount(){this.isUnmounting=!0,yo.Z.apiExists()&&navigator.xr.removeEventListener("ondevicechange",this.updatePlatformState)}async updatePlatformState(){const e=await(0,vo.pl)();this.isUnmounting||this.setState({vrPlatform:e})}render(){return this.state.vrPlatform===vo.bk.webxr?this.renderOverlayCta():null}renderOverlayCta(){const{locale:e}=this.context;return(0,l.jsx)("div",Object.assign({id:"vr-overlay-layer",className:"overlay"},{children:(0,l.jsx)("div",Object.assign({className:"overlay-cta"},{children:(0,l.jsx)(w.zx,Object.assign({buttonSize:w.qE.LARGE,buttonState:w.BN.ENABLED,buttonStyle:w.ZJ.OVERLAY,className:d()("inline-block","confirm"),onClick:this.startWebXR},{children:e.t(f.Z.VR_ENTER)}),void 0)}),void 0)}),void 0)}trackEvent(e,t){let i={gui_action:e};i=Object.assign(i,t),this.context.analytics.track("showcase_gui",i)}};zp.contextType=m.I,zp=Gp([I.Z],zp);var Wp=i(62644),Kp=i(69617);const Yp=oe(Kp.r);const qp=["<mark>","</mark>"];function Zp(e){return e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}function $p(e,t){const[i,n]=qp,s=`${i}|${n}`;let r=!1;if(e.match(new RegExp(s))&&(e=e.replace(new RegExp(`(${s})`,"g"),((e,t)=>t.split("").join(""))),r=!0),t){let s;s=r?t.split("").map(Zp).join("[]?"):Zp(t),e=e.replace(new RegExp(`(${s})`,"gi"),((e,t)=>`${i}${t}${n}`))}return e}const Qp=$p;function Xp(e,t){return $p(function(e,t){var i;const n=e.toLowerCase(),[s,r,o]=[n.indexOf(t),e.length,(null===(i=n.match(new RegExp(`${Zp(t)}`,"g")))||void 0===i?void 0:i.length)||1];let a=e,l=s;if(r>20&&l>0){if(1===o){const e=Math.floor((20-t.length)/2);e>0&&l>e&&(l-=e)}a=`...${a.substr(l)}`,a.length<20&&(l-=20-a.length,l>0&&(a=`...${e.substr(l)}`))}return a}(e,t),t)}function Jp(e){const{item:t,searchText:i}=e,n=function(){const e=Yp(),[t,i]=(0,r.useState)(e?e.getSelectedSearchResult():null);return(0,r.useEffect)((()=>{if(!e)return()=>{};const t=e.selectedSearchResult.onChanged(i);return i(e.getSelectedSearchResult()),()=>t.cancel()}),[e]),t}(),s=t.id,o=t.color,a=!!n&&s===n.id;let c=t.title;c&&(c=Qp(c,i));let d=t.description;d&&(d=Xp(d,i));return(0,l.jsxs)(ap,Object.assign({sid:s,enabled:!0,selected:a,onSelect:()=>{e.onSelect(),t.onSelect()}},{children:[(0,l.jsx)(nr,{badgeStyle:void 0!==o?{background:o,borderColor:o}:{},iconClass:t.icon},void 0),(0,l.jsxs)("div",Object.assign({className:"item-details"},{children:[c&&(0,l.jsx)("div",Object.assign({className:"item-header"},{children:(0,l.jsx)(Dr,{text:c,textParser:t.textParser,markers:qp,readonly:!0},void 0)}),void 0),d&&(0,l.jsx)("div",Object.assign({className:"item-description"},{children:(0,l.jsx)(Dr,{text:d,textParser:t.textParser,markers:qp,readonly:!0},void 0)}),void 0)]}),void 0),(0,l.jsx)(T.hU,{buttonStyle:T.Dd.PLAIN},void 0)]}),s)}const{SEARCH:em}=f.Z.SHOWCASE;class SearchPanelList extends r.Component{groupItems(){const{grouping:e}=this.props;switch(e){case nm.TYPE:return this.groupByType();case nm.FLOOR:return this.groupByFloor();default:return this.groupByType()}}groupByType(){const{searchResults:e}=this.props,t={};for(const i of e){const e=i.groupPhraseKey,n=this.context.locale.t(e);e in t||(t[e]={header:n,items:[]}),t[e].items.push(this.renderItem(i))}return t}groupByFloor(){const{searchResults:e,floorsViewData:t}=this.props,i={};for(const n of e){const e=n.floorId,s=t.getFloorName(e);e in i||(i[e]={header:s,items:[]}),i[e].items.push(this.renderItem(n))}return i}renderItem(e){return(0,l.jsx)(Jp,{item:e,onSelect:this.props.onSelect,searchText:this.props.searchText},e.id)}render(){const e=[];for(const[t,i]of Object.entries(this.groupItems())){const n=0===i.items.length,{header:s,items:r}=i;e.push((0,l.jsx)(rp,Object.assign({id:t,header:`${s} (${r.length})`,open:!0,doubleLine:!0,collapsible:!n,emptyMessage:this.context.locale.t(em.EMPTY_LIST_MESSAGE)},{children:i.items}),t))}return(0,l.jsx)(tp,{children:e},void 0)}}SearchPanelList.contextType=m.I;const tm=ce(SearchPanelList);var im=i(67790);var nm,sm=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.TYPE="type",e.FLOOR="floor"}(nm||(nm={}));const{SEARCH:rm}=f.Z.SHOWCASE;let om=class SearchPanel extends r.Component{constructor(e){super(e),this.bindings=[],this.setTextInputRef=e=>this.textInputRef=e,this.focus=()=>{this.textInputRef&&!(0,E.Jm)()&&this.textInputRef.focus()},this.onTransitionEnd=e=>{const{active:t}=e,{collapsedToBottom:i}=this.state,{toolPanelLayout:n}=this.props;!t||n!==p.wS.SIDE_PANEL&&i||this.focus()},this.searchResultsOnChange=e=>{this.setState({searchResults:e.getResults(),validationError:e.getValidationError(),searchText:e.getQuery(),isAdvancedQuery:e.getIsAdvancedQuery()})},this.updateCollapsedState=()=>{this.setState({collapsedToBottom:this.context.toolsData.isPanelCollapsedToBottom()})},this.sendQuery=async e=>{this.context.commandBinder.issueCommand(new Wp.HA(e))},this.onDone=e=>{this.state.collapsedToBottom&&this.context.commandBinder.issueCommand(new it.zK(!1)),this.focused=!1},this.selectItem=()=>{this.props.toolPanelLayout===p.wS.BOTTOM_PANEL&&this.context.commandBinder.issueCommand(new it.zK(!0))},this.toggleHelp=()=>{this.setState({isHelpVisible:!this.state.isHelpVisible})},this.onCloseLayer=async e=>{e&&e.stopPropagation(),await this.context.commandBinder.issueCommand(new it.tT(p.w1.SEARCH,!1))},this.onClearSearch=()=>{this.sendQuery(""),this.focus()},this.onShareSearch=()=>{const{searchText:e}=this.state,t=encodeURIComponent(e),i=new URLSearchParams(window.location.search);i.set("q",t);const n=window.location.href.replace(/\?.*?(?=(#|$))/,`?${i}`),s=document.createElement("input");document.body.appendChild(s),s.value=n,s.select(),document.execCommand("copy"),document.body.removeChild(s),this.setState({linkCopied:!0},(()=>{this.shareTimeout=window.setTimeout((()=>{this.setState({linkCopied:!1})}),2500)}))},this.scrollToInputOnResize=()=>{this.focused&&this.state.collapsedToBottom&&(0,E.Jm)()&&this.textInputRef.scrollIntoView()},this.onFocus=()=>this.focused=!0,this.renderShareButton=()=>{const{toolPanelLayout:e}=this.props,{collapsedToBottom:t,linkCopied:i}=this.state;let n;return n=i?(0,l.jsx)("span",Object.assign({className:"link-copied"},{children:this.context.locale.t(f.Z.SHARE_COPIED)}),void 0):(0,l.jsx)(T.hU,Object.assign({onClick:this.onShareSearch,buttonStyle:T.Dd.PLAIN,buttonSize:w.qE.SMALL},{children:e!==p.wS.SIDE_PANEL&&t?(0,l.jsx)("span",{className:"icon icon-share"},void 0):(0,l.jsx)(x.oO,Object.assign({content:this.context.locale.t(f.Z.COPY_URL),position:x.lZ.DOWN,tooltipTimeout:2e3},{children:(0,l.jsx)("span",{className:"icon icon-share"},void 0)}),void 0)}),void 0),n},this.onGroupingChange=e=>{if(e){const t=e;this.setState({grouping:t})}},this.state={active:!0,collapsedToBottom:!1,searchText:"",searchResults:[],validationError:null,isAdvancedQuery:!1,grouping:nm.TYPE,linkCopied:!1,isHelpVisible:!1}}componentDidMount(){const{engine:e}=this.context;this.bindings.push(e.subscribe(im.a,this.scrollToInputOnResize),e.subscribe(Oe.rh,this.onTransitionEnd),e.subscribe(Oe.U7,this.updateCollapsedState)),e.market.waitForData(Kp.r).then((e=>{this.searchResultsOnChange(e),this.bindings.push(e.onChanged(this.searchResultsOnChange))})),this.updateCollapsedState()}componentWillUnmount(){window.clearTimeout(this.shareTimeout),this.bindings.forEach((e=>e.cancel()))}renderSearchResults(){const{searchResults:e,grouping:t,searchText:i}=this.state;return this.state.searchResults.length>0?(0,l.jsx)(tm,{searchText:i,searchResults:e,onSelect:this.selectItem,grouping:t},void 0):this.renderEmptyMessage()}renderEmptyMessage(){return(0,l.jsx)("p",Object.assign({className:"search-empty-message"},{children:"No matches found"}),void 0)}renderSubheader(){const{locale:e}=this.context,{collapsedToBottom:t,validationError:i,isAdvancedQuery:n,isHelpVisible:s}=this.state,r=!t;return(0,l.jsxs)("div",Object.assign({className:"list-subheaders"},{children:[this.renderSearchHeader(),i&&(0,l.jsx)("div",Object.assign({className:"search-validation-error"},{children:e.t(rm.VALIDATION_MESSAGE)}),void 0),n&&(0,l.jsxs)("div",Object.assign({className:"search-advanced-hint"},{children:[(0,l.jsx)("span",Object.assign({className:"search-advanced-label"},{children:e.t(rm.ADVANCED_SEARCH_TITLE)}),void 0),(0,l.jsxs)("a",Object.assign({className:"link",onClick:this.toggleHelp},{children:[e.t(rm.ADVANCED_SEARCH_HELP_BUTTON),(0,l.jsx)(ne,{open:s,message:(0,l.jsx)("p",{children:e.t(rm.ADVANCED_SEARCH_INSTRUCTIONS)},void 0),tooltipId:"search-advanced-help-tooltip",className:"search-advanced-help",arrowPos:J.TOP_RIGHT,onClose:this.toggleHelp},void 0)]}),void 0)]}),void 0),r&&this.renderGroupingsMenu()]}),void 0)}renderSearchHeader(){const{searchText:e,validationError:t}=this.state;return(0,l.jsxs)("div",Object.assign({className:d()("list-search",!!t&&"has-validation-msg")},{children:[(0,l.jsx)("span",{className:d()("search-header-icon","icon","icon-magnifying-glass",{"search-header-icon-active":""!==e})},void 0),(0,l.jsx)(dn,{text:e,onInput:this.sendQuery,onDone:this.onDone,placeholder:"Search space",onFocus:this.onFocus,ref:this.setTextInputRef,focusOnMount:!0},void 0),""!==e&&(0,l.jsxs)("div",Object.assign({className:"search-header-button-container"},{children:[(0,l.jsx)(w.zx,Object.assign({onClick:this.onClearSearch,buttonStyle:w.ZJ.PLAIN,buttonSize:w.qE.STANDARD},{children:this.context.locale.t(rm.CLEAR_SEARCH).toLocaleUpperCase()}),void 0),this.renderShareButton()]}),void 0)]}),void 0)}renderGroupingsMenu(){const{grouping:e}=this.state,{locale:t}=this.context,i=[{text:t.t(rm.GROUP_TYPE),value:nm.TYPE,selected:e===nm.TYPE},{text:t.t(rm.GROUP_FLOOR),value:nm.FLOOR,selected:e===nm.FLOOR}];return(0,l.jsxs)("div",Object.assign({className:"list-menu groupings search-groupings"},{children:[(0,l.jsx)("span",Object.assign({className:"groupings-label"},{children:t.t(rm.GROUP_BY).toLocaleUpperCase()}),void 0),(0,l.jsx)(SelectMenu,{className:"groupings-search-select",menuStyle:se.DROPDOWN,onChange:this.onGroupingChange,options:i},void 0)]}),void 0)}getListTitle(){const{searchResults:e}=this.state,t=e.length;return this.context.locale.t(rm.ITEMS,t)}render(){const{active:e}=this.state,{toolPanelLayout:t}=this.props;return(0,l.jsx)("div",Object.assign({className:"tool-panel search-panel"},{children:(0,l.jsx)(ListPanel,Object.assign({active:e,toolPanelLayout:t,title:this.getListTitle(),onClose:this.onCloseLayer,subheader:this.renderSubheader(),subheaderCollapsedHeight:Ba._U},{children:(0,l.jsx)(SingleScrollbar,Object.assign({direction:F.vertical},{children:(0,l.jsx)("div",Object.assign({className:"list-contents"},{children:this.renderSearchResults()}),void 0)}),void 0)}),void 0)}),void 0)}};om.contextType=m.I,om=sm([I.Z],om);const am=(lm=om,cm=Ai,e=>cm()?(0,l.jsx)(lm,Object.assign({},e),void 0):null);var lm,cm,dm=i(18469);const{SUMMARY:hm}=f.Z.SHOWCASE,um=Ba.MN/1.6;class SummaryContent extends r.Component{constructor(e){super(e),this.getImageURL=e=>{const t=new URL(e);return t.searchParams.set("width",String(Ba.MN)),t.searchParams.delete("height"),t.searchParams.delete("fit"),t.searchParams.set("crop","16:10"),t.searchParams.set("dpr",String(window.devicePixelRatio)),t.href},this.onExternalLinkClicked=e=>{this.context.analytics.track("showcase_share_origin_link_clicked")},this.state={thumbnail:void 0}}componentDidMount(){const{market:e}=this.context.engine;e.waitForData(dm.O).then((e=>{e.thumb&&e.thumb.get().then((e=>{try{this.setState({thumbnail:this.getImageURL(e)})}catch(e){this.setState({thumbnail:void 0})}}))}))}getFilteredValue(e,t,i,n){return!this.context.settings.tryGetProperty(t,i)||n&&!this.props.brandingEnabled?"":e}render(){const{modelDetails:e,showExternalUrl:t}=this.props,{thumbnail:i}=this.state,{locale:n}=this.context,{name:s,presentedBy:r,summary:o,formattedAddress:a,contact:c,externalUrl:d}=e,h=t?d:"",u=this.getFilteredValue(s,_.gx.DetailsModelName,!0,!1),p=this.getFilteredValue(o,_.gx.DetailsSummary,!1,!1),m=this.getFilteredValue(a,_.gx.DetailsAddress,!1,!1),g=this.getFilteredValue(r,_.gx.PresentedBy,!1,!0),v=this.getFilteredValue(c.name,_.gx.DetailsName,!1,!0),y=this.getFilteredValue(c.email,_.gx.DetailsEmail,!1,!0),b=this.getFilteredValue(c.phone,_.gx.DetailsPhone,!1,!0),S=this.getFilteredValue(c.formattedPhone,_.gx.DetailsPhone,!1,!0),E=S||b;return(0,l.jsx)("div",Object.assign({className:"summary-content"},{children:(0,l.jsxs)(SingleScrollbar,Object.assign({direction:F.vertical},{children:[i?(0,l.jsx)("img",{className:"summary-image",width:Ba.MN,height:um,src:i,alt:`Photo of "${u}"`},void 0):null,(0,l.jsxs)("div",Object.assign({className:"summary-text-content"},{children:[u&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",Object.assign({className:"section-header"},{children:n.t(hm.LABEL_LOCATION)}),void 0),(0,l.jsx)("div",Object.assign({className:"location"},{children:u}),void 0)]},void 0),m&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",Object.assign({className:"section-header"},{children:n.t(hm.LABEL_ADDRESS)}),void 0),(0,l.jsx)("div",Object.assign({className:"section-body"},{children:m}),void 0)]},void 0),g&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",Object.assign({className:"section-header"},{children:this.context.locale.t(f.Z.PRESENTED_BY)}),void 0),(0,l.jsx)("div",Object.assign({className:"section-body"},{children:g}),void 0)]},void 0),(v||b||y)&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",Object.assign({className:"section-header"},{children:n.t(hm.LABEL_CONTACT)}),void 0),(0,l.jsxs)("div",Object.assign({className:"section-body"},{children:[v&&(0,l.jsx)("div",{children:v},void 0),y&&(0,l.jsx)("div",{children:(0,l.jsx)("a",Object.assign({className:"link",href:"mailto:"+y},{children:y}),void 0)},void 0),E&&(0,l.jsx)("div",{children:E},void 0)]}),void 0)]},void 0),p&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",Object.assign({className:"section-header"},{children:n.t(hm.LABEL_INFORMATION)}),void 0),(0,l.jsx)("div",Object.assign({className:"section-body"},{children:p}),void 0)]},void 0),h&&(0,l.jsxs)("div",{children:[(0,l.jsx)("div",Object.assign({className:"section-header"},{children:n.t(hm.LABEL_LEARN_MORE)}),void 0),(0,l.jsxs)("div",Object.assign({className:"external-link-wrapper"},{children:[(0,l.jsx)("i",Object.assign({className:"icon-ext-link"},{children:" "}),void 0),(0,l.jsx)("a",Object.assign({className:"section-body link",onClick:this.onExternalLinkClicked,href:h,target:"_blank",rel:"noopener"},{children:h}),void 0)]}),void 0)]},void 0)]}),void 0)]}),void 0)}),void 0)}}SummaryContent.contextType=m.I;const{SUMMARY:pm}=f.Z.SHOWCASE;class SummaryPanel extends r.Component{constructor(){super(...arguments),this.handleCloseClick=()=>{const{commandBinder:e}=this.context;e.issueCommand(new it.tT(p.w1.SUMMARY,!1))}}render(){const{modelDetails:e,brandingEnabled:t,showExternalUrl:i}=this.props,{locale:n}=this.context;return(0,l.jsxs)("div",Object.assign({className:"summary-panel list-panel active"},{children:[(0,l.jsxs)("div",Object.assign({className:"summary-panel-header list-panel-header"},{children:[(0,l.jsx)(Ju,Object.assign({className:"summary-panel-title"},{children:n.t(pm.HEADING)}),void 0),(0,l.jsx)("div",{children:(0,l.jsx)(T.hU,{iconClass:"icon-close",buttonStyle:T.Dd.PLAIN,onClick:this.handleCloseClick},void 0)},void 0)]}),void 0),(0,l.jsx)(SummaryContent,{modelDetails:e,brandingEnabled:t,showExternalUrl:i},void 0)]}),void 0)}}SummaryPanel.contextType=m.I;const mm=new S.Z("showcase-ui"),fm=(0,ke.FU)();class ShowcaseUi extends r.Component{constructor(e,t){super(e,t),this.bindings=[],this.mobile=(0,E.tq)(),this.propertiesToRefreshUi=[_.gx.Measurements,_.gx.DetailsModelName,Ee.ws,_.gx.FloorSelect],this.isUnmounting=!1,this.initialToolLoaded=!1,this.getModeChange=e=>({viewmode:(0,y.ty)(e.toMode)}),this.updateToolPanelLayout=()=>{const{toolsData:e,mainDiv:t}=this.context,i=e.toolPanelLayout;this.setState({toolPanelLayout:i}),Ua(t,i)},this.showHelpOnPlaying=e=>{e.phase===u.nh.PLAYING&&(this.context.commandBinder.issueCommand(new we.Bz(Te.P.CTA,!0)),this.context.messageBus.unsubscribe(h.LZ,this.showHelpOnPlaying))},this.updateTools=()=>{const{toolsData:e}=this.context,{toolsLoaded:t}=this.state;e.toolsMap.length>0&&!t&&this.setState({toolsLoaded:!0}),this.initialToolLoaded||this.showInitialTool()},this.updatePerSettings=()=>{this.setState({measurementsModeEnabled:this.isMeasurementsEnabled(),notesEnabled:this.isNotesEnabled(),newTagsEnabled:this.isNewTagsEnabled()})},this.updateTourState=()=>{this.tourData&&this.setState({tourState:this.tourData.getCurrentTourState()})},this.isVrButtonEnabled=()=>(0,vo.hX)(this.context.settings),this.updateActiveTool=()=>{const{tourState:e}=this.state,{toolsData:t,commandBinder:i,mainDiv:n}=this.context,s=t.activeToolName;this.setState({activeTool:s}),window.clearTimeout(this.panelCloseTimeout),s?n.classList.add("tool-open"):this.panelCloseTimeout=window.setTimeout((()=>{n.classList.remove("tool-open")}),400),s&&e.tourPlaying&&i.issueCommand(new b.vy,!1)},this.openModalChanged=()=>{const{toolsData:e,commandBinder:t,mainDiv:i}=this.context,{tourState:n}=this.state,s=e.openModal;s?i.classList.add("modal-open"):i.classList.remove("modal-open"),s&&n.tourPlaying&&t.issueCommand(new b.vy,!1),this.setState({openModal:s})},this.renderLeftPanels=()=>{const{modelDetails:e,brandingEnabled:t,toolPanelLayout:i,activeTool:n,showExternalUrl:s}=this.state;return(0,l.jsxs)(ka,Object.assign({activeTool:n,sidePanelCollapsible:!1,toolPanelLayout:i,className:"side-panel-left"},{children:[!!e&&(0,l.jsx)(SummaryPanel,{modelDetails:e,brandingEnabled:t,showExternalUrl:s},p.w1.SUMMARY),(0,l.jsx)(am,{toolPanelLayout:i},p.w1.SEARCH)]}),void 0)},this.glCanvas=document.getElementsByClassName("webgl-canvas")[0],this.state={viewmode:y.g,activeTool:null,openModal:null,toolsLoaded:!1,toolPanelLayout:t.toolsData.toolPanelLayout,tourState:{},modelDetails:null,measurementsModeEnabled:!1,notesEnabled:!1,newTagsEnabled:!1,vrEnabled:!1,brandingEnabled:!1,shareEnabled:!1,unaligned:!0,showExternalUrl:!1}}async componentDidMount(){const{settings:e,messageBus:t,market:i,toolsData:n}=this.context;for(const t of this.propertiesToRefreshUi)e.onPropertyChanged(t,this.updatePerSettings);try{this.cancelBindings(),this.bindings=[n.onToolsLoadedChanged(this.updateTools),n.onToolChanged(this.updateActiveTool),n.onOpenModalChanged(this.openModalChanged),n.onToolPanelLayoutChanged(this.updateToolPanelLayout),n.toolsMap.onChanged(this.updatePerSettings)],this.handleStartUpHelp();const[e,s,r,o]=await Promise.all([i.waitForData(ia.T),i.waitForData(g.O),i.waitForData(Sa.Z),i.waitForData(Pa.k)]);if(this.isUnmounting)return;this.bindings.push(t.subscribe(Hs.Z,(e=>this.setState(Object.assign(Object.assign({},this.getModeChange(e)),this.getUnalignedSweepState())))),t.subscribe(po.NR,this.updateTourState),t.subscribe(po.oR,this.updateTourState),t.subscribe(po.Vx,this.updateTourState),t.subscribe(po.Mt,this.updateTourState),t.subscribe(po.dW,this.updateTourState),o.getReel().onChanged(this.updateTourState),r.makeSweepChangeSubscription((()=>this.setState(this.getUnalignedSweepState()))));const a=(0,y.ty)(s.currentMode||ee.Ey.Panorama);this.tourData=o,this.sweepData=r,this.viewmodeData=s,this.setState(Object.assign({viewmode:a,modelDetails:e.model.details,brandingEnabled:this.isBrandingEnabled()&&!this.isMlsEnabled(),shareEnabled:this.isShareEnabled()&&!this.isMlsEnabled(),showExternalUrl:this.isBrandingEnabled()&&!this.isMlsEnabled(),vrEnabled:this.isVrButtonEnabled()},this.getUnalignedSweepState())),this.props.onAppReadyChanged(!0,!1)}catch(e){mm.debug(e)}this.updateTourState(),this.updateActiveTool(),this.updateTools(),this.updatePerSettings()}async componentWillUnmount(){this.isUnmounting=!0;for(const e of this.propertiesToRefreshUi)this.context.settings.removeOnPropertyChanged(e,this.updatePerSettings);this.cancelBindings(),this.props.onAppReadyChanged(!1,!1)}handleStartUpHelp(){const{settings:e,messageBus:t,commandBinder:i}=this.context,n=e.tryGetProperty("help",0);if(1===n||2===n){const n=1===e.tryGetProperty("ts",0),s=1===e.tryGetProperty("qs",0);n||(s?i.issueCommand(new we.Bz(Te.P.CTA,!0)):t.subscribe(h.LZ,this.showHelpOnPlaying))}}showInitialTool(){const{toolsData:e,settings:t}=this.context,i=t.tryGetProperty(Ni.R,!1),n=t.tryGetProperty(et.IA,!1),s=(0,Ca.u)(t,i,n);s&&e.hasTool(s)&&(this.initialToolLoaded=!0,window.setTimeout((()=>{(0,Ca.a)(s,this.context)}),750))}getUnalignedSweepState(){if(!this.sweepData||!this.viewmodeData)return{unaligned:this.state.unaligned};return{unaligned:this.viewmodeData.isInside()&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)}}cancelBindings(){for(const e of this.bindings)e.cancel()}isNotesEnabled(){const{settings:e,toolsData:t}=this.context;return e.tryGetProperty(et.IA,!1)&&!!t.getTool(p.w1.NOTES)}isNewTagsEnabled(){const{settings:e,toolsData:t}=this.context;return e.tryGetProperty(Ni.R,!1)&&!!t.getTool(p.w1.TAGS)}isMeasurementsEnabled(){const{settings:e,toolsData:t}=this.context;return e.tryGetProperty(_.gx.Measurements,!0)&&!!t.getTool(p.w1.MEASUREMENTS)}isShareEnabled(){const{settings:e}=this.context,t=e.tryGetProperty(zt.Yo,!1)&&e.tryGetProperty("is_public",!1),i=(0,E.SP)()&&"0"===fm.share;return t&&!i}isMlsEnabled(){return this.context.settings.tryGetProperty(zt.sX,!1)}isBrandingEnabled(){const{settings:e}=this.context;return e.tryGetProperty(zt.L,!0)}renderToolPanels(){const{notesEnabled:e,newTagsEnabled:t,activeTool:i,openModal:n,toolPanelLayout:s}=this.state;if(!e&&!t)return null;const{toolsData:r}=this.context,o=e&&r.getTool(p.w1.NOTES),a=t&&r.getTool(p.w1.TAGS);return(0,l.jsxs)(ka,Object.assign({activeTool:i,sidePanelCollapsible:!1,toolPanelLayout:s,className:"side-panel-right"},{children:[o&&(0,l.jsx)(hp,{manager:o.manager,modalOpen:!!n,toolPanelLayout:s},p.w1.NOTES),a&&(0,l.jsx)(Uh,{manager:a.manager,toolPanelLayout:s},p.w1.TAGS)]}),void 0)}renderToolOverlay(){const{toolsData:e}=this.context,{openModal:t,activeTool:i,unaligned:n,toolPanelLayout:s}=this.state,r=e.toolsMap.get(p.w1.MEASUREMENTS),o=e.toolsMap.get(p.w1.NOTES);return(0,l.jsxs)("div",Object.assign({className:"tool-overlay"},{children:[!i&&(0,l.jsx)(zp,{},void 0),i===p.w1.MEASUREMENTS&&r&&(0,l.jsx)(jp,{mobile:this.mobile,openModal:t,unaligned:n,manager:r.manager},void 0),i===p.w1.NOTES&&o&&(0,l.jsx)(vp,{openModal:t,toolPanelLayout:s,manager:o.manager},void 0),(0,l.jsx)(bp,{openModal:t,toolPanelLayout:s},void 0)]}),void 0)}render(){const{viewmode:e,unaligned:t,tourState:i,modelDetails:n,measurementsModeEnabled:s,notesEnabled:r,shareEnabled:o,brandingEnabled:a,vrEnabled:c,openModal:h,toolsLoaded:u,toolPanelLayout:m,activeTool:f}=this.state,g=f===p.w1.SEARCH;return(0,l.jsxs)("div",Object.assign({id:"gui",className:d()({"search-mode":g})},{children:[!!n&&(0,l.jsx)(Ci,{showing:!h&&!f,modelDetails:n,tourState:i,brandingEnabled:a,activeTool:f},void 0),(0,l.jsx)(Modals,{viewmode:e,glCanvas:this.glCanvas,openModal:h},void 0),(0,l.jsxs)("div",Object.assign({className:"showcase-ui-overlay"},{children:[this.renderLeftPanels(),(0,l.jsxs)("div",Object.assign({className:"scene-overlay"},{children:[(0,l.jsx)(OverlayUi,{viewmode:e,toolPanelLayout:m,activeTool:f,openModal:h,tourPlaying:i.tourPlaying,mobile:this.mobile},void 0),u&&this.renderToolOverlay(),(0,l.jsx)(BottomUi,{openModal:h,openTool:f,unaligned:t,viewmode:e,tourState:i,measurementsModeEnabled:s,notesEnabled:r,shareEnabled:o,vrEnabled:c,toolPanelLayout:m},void 0)]}),void 0),this.renderToolPanels(),(0,l.jsx)(Ia,{},void 0)]}),void 0)]}),void 0)}}ShowcaseUi.contextType=m.I;var gm,vm=i(33874),ym=i(24151),bm=i(23953),Sm=i(10882),Em=i(28963),Tm=i(66999),wm=i(40688),xm=i(52247),_m=i(13341),Mm=i(39712),Om=i(38003),Am=i(2782),Cm=i(17386);!function(e){e[e.CLOSE=0]="CLOSE",e[e.DISPLAY=1]="DISPLAY",e[e.UPDATE=2]="UPDATE"}(gm||(gm={}));class WorkshopModalCommand extends Cm.m{constructor(e,t){if(super(),e&&!t)throw new Error("Cannot open empty modal");this.payload={action:e,properties:t}}}WorkshopModalCommand.id="WORKSHOP_MODAL";var Pm=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};const Dm=new S.Z("workshop-modal");var Nm;!function(e){e[e.CONFIRM=0]="CONFIRM",e[e.CLOSE=1]="CLOSE"}(Nm||(Nm={}));const Im={message:"",title:"",modalClass:"",cancellable:!0,closeButton:!0,confirmDisabled:!1};let Lm=class WorkshopModal extends r.Component{constructor(e){super(e),this.isUnmounting=!1,this.handleModalCommand=async e=>{if(e.action===gm.DISPLAY){if(this.state.open){if(!this.state.cancellable)return Promise.reject("Cannot close non-cancellable modal");await this.close(Nm.CLOSE)}return this.openModal(e.properties)}if(e.action===gm.UPDATE)this.updateModal(e.properties);else{if(!this.state.open)return Promise.reject("Cannot cancel a closed modal");this.close(Nm.CLOSE)}return this.togglePromise},this.close=async e=>{await this.props.commandBinder.issueCommand(new Am.n(400,0)),this.promiseResolve(e),this.props.handleBlur(!1),this.isUnmounting||this.setState({open:!1})},this.stopPropagation=e=>{e.stopPropagation()},this.onCancel=e=>{e.stopPropagation(),this.close(Nm.CLOSE)},this.onConfirm=async e=>{e.stopPropagation(),this.close(Nm.CONFIRM)},this.state={open:!1}}async componentDidMount(){try{this.props.commandBinder.addBinding(WorkshopModalCommand,this.handleModalCommand)}catch(e){Dm.debug(e)}}async componentWillUnmount(){this.isUnmounting=!0;try{this.props.commandBinder.removeBinding(WorkshopModalCommand,this.handleModalCommand)}catch(e){Dm.debug(e)}}updateModal(e){this.isUnmounting||this.state.open&&this.setState(Object.assign({},e))}openModal(e){this.props.commandBinder.issueCommand(new Am.n(400,3)),this.props.handleBlur(!0);const t=Object.assign({},Im,e);return this.isUnmounting?this.promiseResolve(Nm.CLOSE):(this.setState(Object.assign({open:!0},t)),this.togglePromise=new Promise((e=>{this.promiseResolve=e}))),this.togglePromise}render(){const{locale:e}=this.context,{open:t,title:i,titleLocalizationOptions:n,message:s,messageLocalizationOptions:r,confirmPhraseKey:o,cancelPhraseKey:a,closeButton:c,modalClass:h,confirmDisabled:u}=this.state,p=h||"";let m=i;if("string"==typeof i){const t=void 0===n?{}:n,s=e.t(i,t);m=(0,l.jsx)("span",{children:s},void 0)}let f=s;if("string"==typeof s){const t=void 0===r?{}:r,i=e.t(s,t);f=(0,l.jsx)("p",Object.assign({className:"modal-message"},{children:i}),void 0)}return(0,l.jsx)(Re,Object.assign({open:t,className:d()("modal-background","workshop-modal-background",{open:t}),onClick:this.stopPropagation},{children:(0,l.jsxs)("dialog",Object.assign({className:`modal workshop-modal ${p}`},{children:[(0,l.jsxs)("header",Object.assign({className:"modal-header"},{children:[(0,l.jsx)("div",Object.assign({className:"modal-title"},{children:m}),void 0),c&&(0,l.jsx)(te.P,{onClose:this.onCancel},void 0)]}),void 0),(0,l.jsx)("div",Object.assign({className:"modal-body"},{children:f}),void 0),(0,l.jsxs)("div",Object.assign({className:"modal-footer"},{children:[a&&(0,l.jsx)(w.zx,Object.assign({buttonStyle:w.ZJ.OUTLINE,className:d()("button-inline","cancel"),onClick:this.onCancel},{children:e.t(a)}),void 0),o&&(0,l.jsx)(w.zx,Object.assign({buttonState:u?w.BN.DISABLED:w.BN.ENABLED,className:d()("button-inline","confirm"),onClick:this.onConfirm},{children:e.t(o)}),void 0)]}),void 0)]}),void 0)}),void 0)}};Lm.contextType=m.I,Lm=Pm([I.Z],Lm);const{ACCORDION:Rm,MODAL:km}=f.Z.WORKSHOP;function Um({itemTypePhraseKey:e,number:t}){const i=be(),n=i.t(e,t),s=i.t(Rm.BATCH_DELETE_MODAL_TITLE,{itemType:n});return(0,l.jsx)(l.Fragment,{children:s},void 0)}function Bm({itemTypePhraseKey:e,number:t}){const i=be(),n=i.t(e,t),s=i.t(Rm.BATCH_DELETE_MODAL_MESSAGE,{number:t,itemType:n});return(0,l.jsx)(l.Fragment,{children:s},void 0)}const{MEASUREMENTS:Fm}=f.Z.WORKSHOP;class MeasurementsManager{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[Tm.U]:!1,[Em.s]:!1,[Pi.Nj]:!1,[Di.re]:!1,[et.Mp]:!1},this.settingsToggler=new Sm.u(t,this.disabledAssets)}async activate(){if(!this.initialized){this.initialized=!0;const e=this.engine,[t,i,n,s]=await Promise.all([e.market.waitForData(Om.X),e.market.waitForData(v.c),e.market.waitForData(Sa.Z),e.market.waitForData(g.O)]);this.dataMap={measurementModeData:t,floorsViewData:i,sweepData:n,viewmodeData:s}}this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommandWhenBound(new wm.O(!0,!0))}async deactivate(){this.settingsToggler.toggle(!1),this.dataMap.measurementModeData.setSelectedGroupIndex(-1),await this.engine.commandBinder.issueCommand(new wm.O(!1))}in360view(){const e=this.dataMap.sweepData.currentSweep?this.dataMap.sweepData.currentSweep:"";return this.dataMap.viewmodeData.isInside()&&this.dataMap.sweepData.isSweepUnaligned(e)}getSelectedMeasurement(){return this.dataMap.measurementModeData.selectedGroupSid}renameMeasurement(e,t){return this.engine.commandBinder.issueCommand(new xm.R(e,t))}setMeasurementVisibility(e,...t){return this.engine.commandBinder.issueCommand(new _m.W(e,...t))}async batchDeleteMeasurement(e){const t=((e,t)=>({title:(0,l.jsx)(Um,{number:e,itemTypePhraseKey:t},void 0),message:(0,l.jsx)(Bm,{number:e,itemTypePhraseKey:t},void 0),cancellable:!0,cancelPhraseKey:km.NO,confirmPhraseKey:km.YES}))(e.length,Fm.TYPE);return await this.engine.commandBinder.issueCommand(new WorkshopModalCommand(gm.DISPLAY,t))!==Nm.CLOSE&&(this.engine.commandBinder.issueCommand(new Ep.JM(...e)),!0)}async deleteMeasurement(e){await this.engine.commandBinder.issueCommand(new Ep.JM(e))}async toggleSelected(e){await this.engine.commandBinder.issueCommand(new Mm.t(e))}}var Vm=i(39950);class NotesManager{constructor(e,t){this.engine=e,this.initialized=!1,this.disabledAssets={[Tm.U]:!1,[Pi.Nj]:!1,[Em.s]:!1,[Di.re]:!1},this.settingsToggler=new Sm.u(t,this.disabledAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(Js.X),e.waitForData(Vm.c),e.waitForData(zh.b),e.waitForData($s.A),e.waitForData(qs.B)]).then((([e,t,i,n,s])=>(this.dataMap={notesViewData:e,hashtagData:t,attachmentsData:i,annotationsViewData:n,pinsViewData:s},!0)))}async activate(){this.initialized||(this.initialized=!0,await this.initPromise),this.settingsToggler.toggle(!0),await this.engine.commandBinder.issueCommand(new Vh.yK(!0))}async deactivate(){await this.engine.commandBinder.issueCommand(new Vh.yK(!1)),this.settingsToggler.toggle(!1)}getTextParser(){return this.dataMap.notesViewData.getTextParser()}}const{MATTERTAGS:Hm,MODAL:jm}=f.Z.WORKSHOP;class TagsManager{constructor(e,t){this.engine=e,this.initialized=!1,this.bindings=[],this.textParser=new Wi.v({links:!0}),this.disabledEditorAssets={[Tm.U]:!1,[Pi.Nj]:!1,[Em.s]:!1,[et.Mp]:!1},this.settingsToggler=new Sm.u(t,this.disabledEditorAssets),this.initPromise=this.init()}async init(){const e=this.engine.market;return Promise.all([e.waitForData(Wa.n),e.waitForData(zh.b),e.waitForData(v.c),e.waitForData($s.A),e.waitForData(qs.B)]).then((([e,t,i,n,s])=>(this.dataMap={tagsViewData:e,attachmentsData:t,floorsViewData:i,annotationsViewData:n,pinsViewData:s},!0)))}async activate(){const e=this.engine;if(this.initialized)for(const e of this.bindings)e.renew();else this.initialized=!0,await this.initPromise;this.settingsToggler.toggle(!0),await e.commandBinder.issueCommand(new kr.yU(!0))}async deactivate(){this.settingsToggler.toggle(!1),await this.engine.commandBinder.issueCommand(new kr.yU(!1))}isNewTag(){return this.dataMap.tagsViewData.isNewTag}async confirmAndDeleteTag(e){const t=((e=1)=>({title:Hm.DELETE_MATTERTAGS_MODAL_TITLE,titleLocalizationOptions:e,message:Hm.DELETE_MATTERTAGS_MODAL_MESSAGE,messageLocalizationOptions:e,cancellable:!0,cancelPhraseKey:jm.NO,confirmPhraseKey:jm.YES}))();if(await this.engine.commandBinder.issueCommand(new WorkshopModalCommand(gm.DISPLAY,t))!==Nm.CLOSE)return this.deleteTag(e)}closeTag(){return this.engine.commandBinder.issueCommand(new kr.xb)}deleteTag(e){return this.engine.commandBinder.issueCommand(new kr.T3(e))}setTagVisibility(e,t){this.engine.commandBinder.issueCommand(new kr.bg(e,t))}}const{TOOLS:Gm}=f.Z;class ShowcaseGui extends a.Y{constructor(){super(),this.name="showcase-gui-module",this.loadUi=this.loadUi.bind(this)}async init(e,t){this.engine=t,[this.settingsData,this.toolsData]=await Promise.all([t.market.waitForData(vm.e),t.market.waitForData(ym.t)])}async loadUi(e,t,i,n,s,a,l,c,d,h,u,p){this.container=a;const f={editMode:!1,locale:e,analytics:t,settings:i,toolsData:this.toolsData,userData:n,mainDiv:s,engine:l,messageBus:c,market:d,commandBinder:h,queue:p};(0,o.render)((0,r.createElement)(m.I.Provider,{value:f},[(0,r.createElement)(ShowcaseUi,{key:"showcase-ui",onAppReadyChanged:u})]),a),this.initializeTools()}async unloadUi(){return!!this.container&&(0,o.unmountComponentAtNode)(this.container)}initializeTools(){const e=[new bm.U({id:p.w1.NOTES,namePhraseKey:Gm.NOTES,panel:!0,icon:"icon-comment-outline",analytic:"notes_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(et.IA,!1),hidesAppBar:!0,manager:new NotesManager(this.engine,this.settingsData)}),new bm.U({id:p.w1.MEASUREMENTS,namePhraseKey:Gm.MEASUREMENTS,panel:!1,icon:"icon-tape-measure",analytic:"measure_mode",toolbar:!1,dimmed:!1,enabled:this.settingsData.tryGetProperty(_.gx.Measurements,!0),manager:new MeasurementsManager(this.engine,this.settingsData)}),new bm.U({id:p.w1.SUMMARY,namePhraseKey:Gm.SUMMARY,panel:!0,panelLeft:!0,analytic:"summary_panel",toolbar:!1,dimmed:!1,enabled:!0,hidesAppBar:!0,manager:{activate:async()=>{},deactivate:async()=>{}}})];this.settingsData.tryGetProperty(Ni.R,!1)&&e.push(new bm.U({id:p.w1.TAGS,namePhraseKey:Gm.TAGS,panel:!0,icon:"icon-toolbar-mattertags",analytic:"mattertag",toolbar:!1,dimmed:!1,enabled:!0,hidesAppBar:!0,manager:new TagsManager(this.engine,this.settingsData)})),this.engine.commandBinder.issueCommand(new it.MV(e))}}},23503:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LoadingGui});var n=i(47724),s=i(8150),r=i(21479),o=i(8445),a=i(41452),l=i(13789),c=i(60771),d=i(17597),h=i(10757),u=i(64185),p=i(90831),m=i(91466);class ShowcaseExpansionMessage extends m.v{constructor(e){super(),this.expanded=e}}var f=i(93331);class ProgressRadial{constructor(e){this.lastProgress=0,this.currentProgress=0,this.webpackChunks=[],this.meshAlloc={alloc:2e6,loaded:0},this.showingProgress=!1,this.progressElm=document.getElementById("bar"),window.addEventListener("WebpackChunkProgress",this.onWebpackChunkProgress.bind(this)),this.engine=e,this.meshProgressBinding=this.onMeshLoadProgress.bind(this),this.engine.subscribe(f.Z,this.meshProgressBinding)}showProgress(){this.showingProgress=!0,this.setProgress(this.currentProgress)}setDone(){this.currentProgress=100,this.setProgress(this.currentProgress),this.engine.unsubscribe(f.Z,this.meshProgressBinding)}setProgress(e){if(!this.progressElm||isNaN(e))return;this.lastProgress=Math.max(this.lastProgress,e),e=this.lastProgress;const t=Number.parseFloat(this.progressElm.getAttribute("r")||"0"),i=Math.PI*(2*t),n=(100-(e=Math.max(Math.min(e,100),0)))/100*i;this.progressElm.style.strokeDashoffset=n.toString(10)}calcProgress(){let e=0,t=0;this.webpackChunks.forEach((i=>{e+=i.loaded,t+=i.total})),e+=this.meshAlloc.loaded,t+=this.meshAlloc.alloc,this.currentProgress=75*Math.min(e/t,1),this.showingProgress&&this.setProgress(this.currentProgress)}onWebpackChunkProgress(e){this.webpackChunks[e.chunkID]?this.webpackChunks[e.chunkID].loaded=e.loaded:this.webpackChunks[e.chunkID]={loaded:e.loaded,total:e.total},this.calcProgress()}onMeshLoadProgress(e){this.meshAlloc.loaded=e.loaded/e.total*this.meshAlloc.alloc,this.calcProgress()}}var g=i(17386);class ShowcaseStartCommand extends g.m{}ShowcaseStartCommand.id="SHOWCASE_START";class ShowcaseStopCommand extends g.m{}ShowcaseStopCommand.id="SHOWCASE_STOP";class ShowcaseReadyCommand extends g.m{}ShowcaseReadyCommand.id="SHOWCASE_READY";class StartApplicationCommand extends g.m{constructor(e){super(),this.payload={startup:e}}}StartApplicationCommand.id="START_APPLICATION";class ExpandIframeCommand extends g.m{constructor(e){super(),this.payload={expand:e}}}ExpandIframeCommand.id="EXPAND_APP";var v=i(25138),y=i(33874),b=i(18654);class LoadingGui extends n.Y{constructor(){super(...arguments),this.name="loading-ui",this.playPromise=new u.Q,this.resolvePlayPromise=async(e,t)=>{if(this.config.allowPlayInIframe||!this.config.startNewTab){if((0,c.yL)())if(t&&(this.config.allowPlayInIframe||1===(0,d.eY)("expand",0)))this.toggleIframeExpansion(!0);else if(!this.config.allowPlayInIframe){const e=(0,d.kD)();t&&e.set("edit","1"),e.set("back","1"),e.delete("cloudEdit");const i=e.toString(),n=`${window.location.origin}${window.location.pathname}?${i}`;try{return void(window.top.location.href=n)}catch(e){this.log.debug("Couldn't set top window location; was Showcase sandboxed?"),this.log.debug(e)}}t&&this.settings.setProperty("quickstart",!0),e&&(this.config.noUi||(this.playIcon.classList.add("hidden"),this.progressUI.showProgress()),this.playPromise.resolve())}else{const e=(0,b.m5)(window.location.href);window.open(e,"_blank")}},this.toggleIframeExpansion=e=>{const t=e?new ShowcaseStartCommand:new ShowcaseStopCommand;this.engine.commandBinder.issueCommand(t),this.engine.broadcast(new ShowcaseExpansionMessage(e))},this.onAppPhaseChangeMessage=async e=>{e.phase!==r.nh.STARTING&&e.phase!==r.nh.PLAYING&&e.phase!==r.nh.ERROR||(this.progressUI.setDone(),this.config.quickstart?this.showQuickstartUI():this.uiRoot.classList.add("faded-out"),this.engine.unsubscribe(s.LZ,this.onAppPhaseChangeMessage))}}async init(e,t){this.engine=t,this.config=e,this.locale=await t.getModule(a.default),this.settings=await t.market.waitForData(y.e);const i=await t.market.waitForData(o.T);this.model=i.model.details,this.bindings.push(t.commandBinder.addBinding(StartApplicationCommand,(async e=>{this.resolvePlayPromise(e.startup,!0)})),t.commandBinder.addBinding(ExpandIframeCommand,(async e=>{this.toggleIframeExpansion(e.expand)}))),e.noUi||(this.bindings.push(this.settings.onPropertyChanged(v.DU,(()=>this.renderTitle())),this.settings.onPropertyChanged(v.L,(()=>this.renderBranding())),this.settings.onPropertyChanged(v.sX,(()=>this.renderBranding())),t.subscribe(s.LZ,this.onAppPhaseChangeMessage)),this.progressUI=new ProgressRadial(t),this.loadUi(),this.getLoadingElements(),this.renderSplashScreen())}get waitForPlaying(){return this.playPromise.nativePromise()}loadUi(){if(this.uiRoot=document.getElementById("loading-gui"),!this.uiRoot)throw Error("Loading GUI root not found");this.uiRoot.classList.remove("hidden"),this.config.quickstart&&(this.uiRoot.style.pointerEvents="none")}getPresentationOptions(){const{hideTitle:e,hideBranding:t,quickstart:i}=this.config,n=!i&&(void 0!==e?!e:this.settings.tryGetProperty(v.DU,!0)),s=this.settings.tryGetProperty(v.sX,!1),r=this.settings.tryGetProperty(v.L,!0);return{title:n,presentedBy:void 0!==t?!t:r&&!s}}getLoadingElements(){this.presentedBy=document.getElementById("loading-presented-by"),this.poweredBy=document.getElementById("loading-powered-by"),this.mpLogo=document.getElementById("loading-mp-logo"),this.mpLogo.src=p,this.mpLogo.alt=this.locale.t(l.Z.ALT_MATTERPORT_LOGO),this.circleLoader=document.getElementById("circleLoader"),this.nameHeader=document.getElementById("loading-header"),this.background=document.getElementById("loading-background"),this.tint=document.getElementById("tint"),this.playIcon=document.getElementById("showcase-play")}addCobrand(){var e;if(null===(e=this.model)||void 0===e?void 0:e.presentedBy){const e=this.presentedBy.querySelector(".loading-label");e&&(e.textContent=this.locale.t(l.Z.PRESENTED_BY_CAPS));const t=this.presentedBy.querySelector(".subheader");t&&(t.textContent=this.model.presentedBy),this.presentedBy.classList.remove("hidden")}}hidePlayButtonUI(){this.background.style.backgroundImage="none",this.presentedBy.style.transition="none",this.presentedBy.classList.remove("faded-in"),this.poweredBy.style.transition="none",this.poweredBy.classList.remove("faded-in"),this.nameHeader.classList.add("hidden"),this.tint.classList.add("hidden"),this.circleLoader.classList.add("hidden"),this.uiRoot.classList.add("quickstart")}async showQuickstartUI(){this.background.classList.add("faded-out"),await(0,h.gw)(500),this.presentedBy.style.transition="",this.presentedBy.classList.add("faded-in"),this.poweredBy.style.transition="",this.poweredBy.classList.add("faded-in"),await(0,h.gw)(2500),this.presentedBy.classList.remove("faded-in"),this.poweredBy.classList.remove("faded-in"),this.uiRoot.classList.add("faded-out")}showLoadingUI(e){const t=document.createAttribute("data-status");t.value=this.locale.t(l.Z.LOADING);const i=document.getElementById("loader-cont");i.attributes.setNamedItem(t),i.classList.add(this.locale.languageCode),i.classList.add("loading"),e.classList.add("faded-out"),this.presentedBy.classList.add("faded-in")}renderTitle(){const{title:e}=this.getPresentationOptions();this.nameHeader.classList.toggle("hidden",!e)}renderBranding(){const{presentedBy:e}=this.getPresentationOptions();e?this.addCobrand():this.presentedBy.classList.add("hidden")}renderSplashScreen(){this.renderTitle(),this.renderBranding(),this.config.hidePoweredBy&&this.poweredBy.classList.add("hidden"),this.nameHeader.textContent=this.model.name,this.poweredBy.classList.add("faded-in"),this.tint.classList.add("faded-in");const e=document.getElementById("play-prompt");this.playPromise.then((()=>{this.config.quickstart?this.hidePlayButtonUI():this.showLoadingUI(e)})),this.config.autoplay?(this.progressUI.showProgress(),this.playPromise.resolve()):(e.classList.remove("hidden"),e.innerText=this.locale.t(l.Z.EXPLORE_3D_SPACE),this.playIcon.classList.remove("hidden"),this.uiRoot.addEventListener("click",(()=>this.resolvePlayPromise(!0,!1)))),this.renderBackground(),this.config.allowPlayInIframe||window.scrollTo(0,0)}renderBackground(){const e=window.devicePixelRatio||1,t=Math.max(window.innerWidth,400);this.background.style.backgroundImage=`url(${this.config.baseUrl}/api/v1/player/models/${this.config.modelId}/thumb?width=${t}&dpr=${e}&disable=upscale)`}}},19917:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>QuickMenus});var n=i(47724),s=i(96909),r=i(77719),o=i(59088),a=i(75892),l=i(10613),c=i(45870),d=i(62881),h=i(66999),u=i(77037),p=i(20601),m=i(33874),f=i(81507),g=i(28963),v=i(44060),y=i(55461);class QuickMenus extends n.Y{constructor(){super(...arguments),this.name="quick-menus"}async init(e,t){this.settingsModule=await t.getModuleBySymbol(s.y.SETTINGS),this.scanInfoDataModule=await t.getModuleBySymbol(s.y.SCAN_INFO),this.settingsGui=this.settingsModule.getSettingsGui();const i=await t.getModuleBySymbol(s.y.DEEP_LINKS),n=await t.market.waitForData(a.Z),b=await t.market.waitForData(m.e),S=await t.market.waitForData(o.M_);this.uIndex=this.settingsGui.addPanel("Link to location",[f.R.U],{allowSubGroups:!1,width:400,ratio:90});const E=[38,38,40,40,37,39,37,39,66,65,f.R.O];this.oIndex=this.settingsGui.addPanel("Scan Info",E,{allowSubGroups:!1,width:400,ratio:75}),this.pIndex=this.settingsGui.addPanel("Quick settings",[f.R.P],{allowSubGroups:!1}),this.settingsGui.loadPromise.then((()=>{this.settingsGui.addControl(this.uIndex,"","Link",{}),this.settingsGui.addButton(this.uIndex,"","Copy to clipboard",(()=>{const e=document.createElement("input");e.type="text",e.value=this.buildLink(i),document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e)})),this.settingsGui.toggle(this.uIndex),this.settingsGui.addControl(this.oIndex,"","Scan ID",{}),this.settingsGui.addControl(this.oIndex,"","Anchor ID",{}),this.settingsGui.addControl(this.oIndex,"","Created",{}),this.settingsGui.addControl(this.oIndex,"","Time of Day",{}),this.settingsGui.addControl(this.oIndex,"","Alignment",{}),this.settingsGui.addControl(this.oIndex,"","Options",{}),this.settingsGui.addControl(this.oIndex,"","Camera",{}),this.settingsGui.addControl(this.oIndex,"","Camera Types",{}),this.settingsGui.addControl(this.oIndex,"","Sensor Serials",{}),this.settingsGui.addControl(this.oIndex,"","Serial Number",{}),this.settingsGui.addControl(this.oIndex,"","Mount Calibration",{}),this.settingsGui.addControl(this.oIndex,"","Software Version",{}),this.settingsGui.addButton(this.oIndex,"","Copy Scan ID",(async()=>{if(n.currentSweep){const e=await this.scanInfoDataModule.getScanInfo(n.currentSweep);if(e){const t=document.createElement("input");t.type="text",t.value=e.id,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t)}}})),this.settingsGui.addButton(this.oIndex,"","Download Scan",(async()=>{if(n.currentSweep){const e=await this.scanInfoDataModule.getScanDownloadURL(n.currentSweep);e&&window.open(e)}})),this.settingsGui.toggle(this.oIndex);const e=c.WI*(180/Math.PI)*60;this.settingsGui.addControl(this.pIndex,"",h.U,!0),this.settingsGui.addControl(this.pIndex,"",g.s,!0),this.settingsGui.addControl(this.pIndex,"",v.re,!0),this.settingsGui.addControl(this.pIndex,"",y.b,!0),this.settingsGui.addSlider(this.pIndex,"",d.lookAccelerationKey,e,.25,10,2),this.settingsGui.addSlider(this.pIndex,"",r.baseTransitionSpeedKey,l.Z.camera.baseTransitionTime,1,5e3,0);const t=b.tryGetProperty(u.EU,u.Im);this.settingsGui.addSlider(this.pIndex,"",u.WQ,(0,p.JG)(t),.5,10,2),this.settingsGui.toggle(this.pIndex),this.settingsModule.registerSetting("Quick settings",d.lookAccelerationKey,e,!1),this.settingsModule.registerSetting("Quick settings",r.baseTransitionSpeedKey,l.Z.camera.baseTransitionTime,!1),this.settingsGui.onToggle(this.uIndex,(e=>{e&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(i))})),this.settingsGui.onToggle(this.oIndex,(e=>{e&&this.refreshScanInfo(n)})),S.pose.onChanged((()=>{this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.uIndex)&&this.settingsGui.updateSetting(this.uIndex,"Link",this.buildLink(i)),this.settingsGui.isLoaded&&this.settingsGui.isVisible(this.oIndex)&&this.refreshScanInfo(n)})),b.onPropertyChanged(u.WQ,(e=>{b.setProperty(u.EU,(0,p.HG)(e))}))}))}refreshScanInfo(e){e.currentSweep?this.scanInfoDataModule.getScanInfo(e.currentSweep).then((e=>{this.updateScanInfo(e)})):this.updateScanInfo(void 0)}updateScanInfo(e){this.settingsGui.updateSetting(this.oIndex,"Scan ID",e?e.id:""),this.settingsGui.updateSetting(this.oIndex,"Anchor ID",e?e.anchorId:""),this.settingsGui.updateSetting(this.oIndex,"Created",e?e.created:""),this.settingsGui.updateSetting(this.oIndex,"Time of Day",e?e.timeOfDay:""),this.settingsGui.updateSetting(this.oIndex,"Alignment",e?e.alignment:""),this.settingsGui.updateSetting(this.oIndex,"Options",e?JSON.stringify(e.options):""),this.settingsGui.updateSetting(this.oIndex,"Camera",e?`${e.camera.vendor} ${e.camera.model}`:""),this.settingsGui.updateSetting(this.oIndex,"Camera Types",e?JSON.stringify(e.camera.cameraTypes):""),this.settingsGui.updateSetting(this.oIndex,"Sensor Serials",e?JSON.stringify(e.camera.sensorSerialNumbers):""),this.settingsGui.updateSetting(this.oIndex,"Serial Number",e?e.camera.serialNumber:""),this.settingsGui.updateSetting(this.oIndex,"Mount Calibration",e?e.camera.mountCalibrationVersion:""),this.settingsGui.updateSetting(this.oIndex,"Software Version",e?e.camera.softwareVersion:"")}buildLink(e){return decodeURIComponent(e.creator.createDeepLink().href)}}},80100:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseAnalytics});var n=i(47724),s=i(96909),r=i(58851),o=i(69669),a=i(67838),l=i(42238),c=i(14973),d=i(60771),h=i(17597),u=i(82702);const p=e=>`${e}_3.0`,m=()=>{try{return Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){return""}},f=()=>{const e=(new l.UAParser).getResult();let t=e.os.name,i=e.browser.name;const n=Object.assign({},e.device);return d._1()&&(t="iPadOS",n.vendor="Apple",n.model="iPad",n.type="tablet","Safari"===i&&(i="Mobile Safari")),{browser:{name:i,major:e.browser.major,version:e.browser.version,language:navigator.language||"",languages:navigator.languages?navigator.languages.join(", "):""},os:{name:t,version:e.os.version},device:{vendor:n.vendor,model:n.model,type:n.type}}};function g(e,t){return{app:{name:p(t),version:"3.1.63.0-125-g1fd7fd3bed"},locale:e,screen:{width:window.screen.width,height:window.screen.height,density:window.devicePixelRatio},timezone:m(),location:{}}}const v=a.K.Logging;var y=i(46114),b=i(19047);class InteractionmodeAnalytics{constructor(){this.handlers=[{msgType:y.m,func:(e,t,i)=>{const n=i.tryGetData(b.Z);n&&e.track("interaction_mode_changed",{interaction_mode_prev:t.fromMode,interaction_mode:t.mode,interaction_source:n.source})}}]}}var S,E=i(29397),T=i(85895),w=i(69941),x=i(35026);function _(e,t){switch(e){case x.z9.ALIGNED:return 1;case x.z9.UNALIGNED:return 2}switch(t){case x.hU.MANUAL:return 3}return 0}!function(e){e.USER="self-guided",e.TOUR="tour"}(S||(S={}));class CameraDataAnalytics{constructor(){this.startLoadTime=Date.now(),this.endLoadTime=Date.now(),this.panosViewed=0,this.handlers=[{msgType:E.Z,func:(e,t,i)=>{this.onMoveToSweepBegin(t.timestamp)}},{msgType:T.Z,func:(e,t,i)=>{const n=i.tryGetData(b.Z),s=i.tryGetData(w.k);this.endLoadTime=Date.now();const r=this.endLoadTime-this.startLoadTime;e.track("pano_viewed",{pano_id:t.toSweep,pano_view_count:++this.panosViewed,alignment_type:_(t.alignmentType,t.placementType),navigation_source:s&&s.tourPlaying?S.TOUR:S.USER,interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode,load_time:r/1e3})}}]}onMoveToSweepBegin(e){this.startLoadTime=e}}var M=i(88814);class ViewmodeAnalytics{constructor(){this.handlers=[{msgType:M.Z,func:(e,t,i)=>{const n=i.tryGetData(b.Z),s={view_mode:t.toMode};n&&(s.interaction_source=n.source,s.interaction_mode=n.mode),e.track("mode_changed",s)}}]}}var O=i(51153),A=i(76896),C=i(91466);class SweepFloorOverrideMessage extends C.v{constructor(e,t,i){super(),this.sweep=e,this.from=t,this.to=i}}var P=i(26627);const D=(e,t)=>{const i=t.tryGetData(P.i);if(!e||!i)return-1;return i.getFloor(e).index};class FloorChangeAnalytics{constructor(){this.handlers=[{msgType:A.P,func:(e,t,i)=>{const n=i.tryGetData(b.Z);e.track("floor_changed",{floor_id:t.floorName,interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode})}},{msgType:SweepFloorOverrideMessage,func:(e,t,i)=>{const n=i.tryGetData(b.Z);e.track("sweep_floor_fixup",{sweep_index:t.sweep.index,sweep_alignment:t.sweep.alignmentType,sweep_placement:t.sweep.placementType,sweep_floor_from:D(t.from,i),sweep_floor_to:D(t.to,i),interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode})}}]}}var N=i(24285),I=i(75892);class ZoomAnalytics{constructor(){this.firstZoom=!0,this.fromZoom=1,this.toZoom=1,this.handlers=[{msgType:N.Z,func:(e,t,i)=>{this.analytics||(this.analytics=e);const n=i.tryGetData(I.Z);n&&n.currentSweep!==this.currentPano&&(this.firstZoom=!0,this.currentPano=n.currentSweep,this.fromZoom=1),this.toZoom=t.zoomLevel,clearTimeout(this.sendTimeout),this.sendTimeout=window.setTimeout(this.trackZoomEvent.bind(this),150)}}]}trackZoomEvent(){const e=this.firstZoom?"initial":"followup";this.analytics.track("zoom_"+e,{from:this.fromZoom,to:this.toZoom,pano:this.currentPano}),this.firstZoom=!1,this.fromZoom=this.toZoom}}var L=i(8150),R=i(21479),k=i(32770);class TimingData extends k.V{constructor(){super(...arguments),this.name="timing",this.modelLoadingStartTime=0,this.waitingStartTime=0,this.appPlayingTime=0,this.appStartedTime=0}get totalTimeToAppStarting(){let e=this.appStartedTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}get totalTimeToAppPlaying(){let e=this.appPlayingTime-performance.timing.navigationStart;return this.modelLoadingStartTime&&this.waitingStartTime&&(e-=this.modelLoadingStartTime-this.waitingStartTime),e}}var U=i(88512),B=i(3248);const F=new U.Z("showcase-session"),V=new TimingData;class ShowcaseSessionAnalytics{constructor(e,t){this.analytics=e,this.engine=t,this.handlers=[{msgType:L.LZ,func:async(e,t,i)=>{var n,r;switch(t.phase){case R.nh.WAITING:V.waitingStartTime=Date.now(),V.commit(),e.track("impression",{url_params:d.UD(),visible:!0});break;case R.nh.LOADING:V.modelLoadingStartTime=Date.now(),V.commit();break;case R.nh.STARTING:{V.appStartedTime=Date.now(),V.commit(),F.info("First render, model loaded "+V.totalTimeToAppStarting/1e3);const t=this.engine.market.tryGetData(B.af);this.renderer=await this.engine.getModuleBySymbol(s.y.WEBGL_RENDERER);const i=this.renderer.getCapabilities(),n={has_hlr:!t||t.options.highlight_reel,duration:Date.now()-V.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gl_v2:i.gl_v2,gl_max_textures:i.gl_max_textures,gl_max_texture_size:i.gl_max_texture_size,gl_max_cubemap_size:i.gl_max_cubemap_size,gl_instancing:i.gl_instancing,gl_oes_texture_float:i.gl_oes_texture_float,gl_oes_texture_half_float:i.gl_oes_texture_half_float,gl_depth_texture:i.gl_depth_texture,gl_draw_buffers:i.gl_draw_buffers,gl_oes_fbo_render_mip_map:i.gl_oes_fbo_render_mip_map,gl_shader_texture_lod:i.gl_shader_texture_lod,gl_oes_vertex_array_obj:i.gl_oes_vertex_array_obj,gl_ovr_multi_view:i.gl_ovr_multi_view,gl_color_buffer_float:i.gl_color_buffer_float,gl_astc_supported:i.gl_astc_supported,gl_etc1_supported:i.gl_etc1_supported,gl_etc2_supported:i.gl_etc2_supported,gl_dxt_supported:i.gl_dxt_supported,gl_bptc_supported:i.gl_bptc_supported,gl_pvrtc_supported:i.gl_pvrtc_supported};e.track("model_loaded",n);break}case R.nh.PLAYING:V.appPlayingTime=Date.now(),V.commit(),F.info("Playing, session started "+V.totalTimeToAppPlaying/1e3),e.track("session_started"),window.addEventListener("unload",this.sessionEnded),e.track("load_times",{time_to_app_start:V.totalTimeToAppStarting,time_to_app_playing:V.totalTimeToAppPlaying});break;case R.nh.ERROR:{const t=await i.waitForData(R.pu),{error:s}=t,o=s&&s.name?s.name:s&&s.constructor?s.constructor.name:null,a=s?s.message:null,l=s&&s.stack?s.stack.split("\n"):[],c=l.length>=2?l[1].match(/\s+at\s+([^\s]+)/):null,d=!!(0,h.eY)("oops",""),u=null!==(r=null===(n=this.renderer)||void 0===n?void 0:n.estimatedGPUMemoryAllocated())&&void 0!==r?r:-1,p={error_dialog:"oops",error_type:o||"",exception:{message:`${o}: ${a}`,function:c?c[1]:null,stack:l.slice(1,5).join("\n")},duration:Date.now()-V.modelLoadingStartTime,duration_from_navigation_start:Date.now()-performance.timing.navigationStart,gpu_memory:u<0?void 0:u,mock_error:d};e.track("error_displayed",p);break}}}}],this.sessionEnded=()=>{this.analytics.trackAsync("session_ended",{duration:Date.now()-V.appPlayingTime})}}dispose(){window.removeEventListener("unload",this.sessionEnded)}}var H=i(68576),j=i(10757),G=i(58232),z=i(5087),W=i(35597),K=i(64323);const Y=new U.Z("/index.js");let q,Z=0,$=1/0,Q=null,X=null,J=window.devicePixelRatio||1;const ee={},te=new G.P(1e3),ie=new G.P(1e3);class RenderingPerformanceAnalytics{constructor(e){this.engine=e,this.handlers=[{msgType:H.Z,func:(e,t,i)=>{X!==R.nh.STARTING&&X!==R.nh.PLAYING||ne(e,z.Ey[t.toMode],1e4)}},{msgType:L.LZ,func:async(e,t,i)=>{const n=i.tryGetData(W.O);t.phase===R.nh.LOADING?ne(e,"Loading",6e4):t.phase===R.nh.STARTING?(q=await this.engine.getModuleBySymbol(s.y.WEBGL_RENDERER),ne(e,"Starting",6e4)):t.phase===R.nh.PLAYING&&n&&n.currentMode&&ne(e,z.Ey[n.currentMode],1e4),X=t.phase}},{msgType:K.V,func:(e,t,i)=>{J=t.pixelRatio}}]}}function ne(e,t,i){t!==Q&&(Q&&(re(e),se()),ee[t]||(Q=t,$=i,ee[Q]=!0))}const se=()=>{Q=null,te.clear(),ie.clear(),Z=0},re=e=>{const t=te.getList(),i=ie.getList();if(0!==t.length)try{const n=oe(t,i);e.track("performance",n)}catch(e){Y.warn("Could not send performance metrics",e)}},oe=(e,t)=>{let i=0,n=0,s=0,r=0,o=0,a=0;for(const t of e)i+=t,t<0||(t<=16.7?n+=t:t<=33.3?s+=t:t<=100?r+=t:t<=1e3?o+=t:a+=t);if(i<=0)throw Error("No positive timings, cannot calculate performance data");const l=i/e.length;n/=i,s/=i,r/=i,o/=i,a/=i;let c=e.slice();const d=(0,j.Pe)(c,50),h=(0,j.Pe)(c,95,!1),u=c[c.length-1];let p,m,f,g,v;return t.length&&(c=t.slice(),g=(0,j.Pe)(c,50,!0),v=(0,j.Pe)(c,95,!1),f=Math.round((0,j.Y8)(t)),p=c[0],m=c[c.length-1]),{phase:Q,frame_delta:l,frame_delta_avg:l,frame_delta_median:d,frame_delta_95th:h,frame_delta_max:u,duration:i,time_60_fps:n,time_60_30_fps:s,time_30_10_fps:r,time_10_1_fps:o,time_1_0_fps:a,gpu_memory_min:p,gpu_memory_max:m,gpu_memory_avg:f,gpu_memory_median:g,gpu_memory_95th:v,pixel_ratio:J}};var ae=i(33874),le=i(21244),ce=i(27326);const de=(e,t)=>{const i=t.tryGetData(ce.c);if(!i)return-1;return(e?i.floors.getFloor(e):i.getHighestVisibleFloor()).index};class MeasurementAnalytics{constructor(){this.handlers=[{msgType:le.rf,func:(e,t,i)=>{const n={measure_sid:t.data.sid,start_position:t.data.startPosition,end_position:t.data.endPosition,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:de(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_segment_add",n)}},{msgType:le.u6,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:de(t.data.floorId,i),feature_type:t.data.featureType,measure_type:t.data.type,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_add",n)}},{msgType:le.ty,func:(e,t)=>{const i={measure_sid:t.sid,measure_text:t.text};e.track("measure_add_title",i)}},{msgType:le.mM,func:(e,t)=>{const i={measure_sid:t.sid,measure_old_text:t.oldText,measure_new_text:t.newText};e.track("measure_update_title",i)}},{msgType:le.$Z,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:de(t.data.floorId,i),measure_count:t.data.count,continuous:t.data.continuous};e.track("measure_remove",n)}},{msgType:le.av,func:(e,t,i)=>{const n={measure_sid:t.data.sid,length:t.data.totalLength,segments:t.data.segments,temporary:t.data.temporary,viewmode:t.data.viewmode,floor:de(t.data.floorId,i),feature_type:t.data.featureType,constraint_style:t.data.constraint,continuous:t.data.continuous};e.track("measure_update",n)}},{msgType:le.$n,func:(e,t)=>{const i=t.opened?"measure_mode_enter":"measure_mode_exit",n={viewmode:t.viewmode,measure_count:t.count};e.track(i,n)}},{msgType:le.ff,func:(e,t)=>{e.track("measure_cancelled",{})}}]}}var he=i(41452),ue=i(38587);class ActivityAnalytics{constructor(){this.handlers=[{msgType:ue.i,func:(e,t)=>{const i={duration_dollhouse:t.durationDollhouse,duration_floorplan:t.durationFloorplan,duration_inside:t.durationInside,duration:t.durationDollhouse+t.durationFloorplan+t.durationInside,main_mode:t.mainMode,bytes_downloaded:t.totalBytesDownloaded,tiles_downloaded:t.tilesDownloaded};e.track("activity_ping",i)}}]}}var pe,me=i(35003),fe=i(51869),ge=i(88727),ve=i(49340),ye=i(38022),be=i(3805),Se=i(50401);!function(e){e.UNINITIALIZED="uninitialized",e.INACTIVE="inactive",e.ACTIVE="active"}(pe||(pe={}));class ShowcaseActivityTracking{constructor(){this.name="activity-analytics",this._state=pe.UNINITIALIZED,this.activeModeMap=new Map,this.totalTilesDownloaded=0,this.onTileDownloaded=()=>{this.totalTilesDownloaded++}}async init(e,t,i){this.engine=e,this.requestQueue=i,[this.input,this.viewmodeData,this.applicationData]=await Promise.all([await e.getModuleBySymbol(s.y.INPUT),await e.market.waitForData(W.O),await e.market.waitForData(R.pu)]);const n=[],r=[me.R,fe._t,ge.e,ve.er,ye.G],o=()=>this.active=!0;this.applicationData.phase===R.nh.PLAYING?this._state=pe.INACTIVE:n.push(e.subscribe(L.LZ,(()=>{this.applicationData.phase===R.nh.PLAYING&&(this._state=pe.INACTIVE)}))),n.push(...(()=>{const e=[];return r.forEach((t=>{e.push(this.input.registerUnfilteredHandler(t,o))})),e})()),n.push(e.subscribe(M.Z,(e=>{const t=e.fromMode,i=e.toMode;t&&t!==z.Ey.Transition&&this.applicationData.phase===R.nh.PLAYING&&this.handleModeChange(t,i)}))),n.push(this.engine.subscribe(Se.o,this.onTileDownloaded)),t(n)}get active(){return this._state===pe.ACTIVE}set active(e){this._state!==pe.UNINITIALIZED&&(e&&this._state===pe.INACTIVE&&this.startActivityTimeout(),this._state=e?pe.ACTIVE:pe.INACTIVE)}handleModeChange(e,t){this.activeModeMap.has(t)?this.updateActivityTimeForMode(t,!0):this.activeModeMap.set(t,{previousTime:Date.now(),totalTimeinMS:0}),this.updateActivityTimeForMode(e)}updateActivityTimeForMode(e,t){const i=this.activeModeMap.get(e);if(void 0===i)return;const{previousTime:n,totalTimeinMS:s}=i;t?this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s}):this.activeModeMap.set(e,{previousTime:Date.now(),totalTimeinMS:s+(Date.now()-n)})}startActivityTimeout(){this.activeModeMap.set(z.Ey.Dollhouse,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(z.Ey.Floorplan,{previousTime:Date.now(),totalTimeinMS:0}),this.activeModeMap.set(z.Ey.Panorama,{previousTime:Date.now(),totalTimeinMS:0}),window.setTimeout(this.notifyActivityAnalytic.bind(this),ShowcaseActivityTracking.ACTIVITY_INTERVAL)}notifyActivityAnalytic(){if(this.viewmodeData.currentMode&&this.viewmodeData.currentMode!==z.Ey.Transition&&this.updateActivityTimeForMode(this.viewmodeData.currentMode),this.active){let e=0,t=z.Ey.Panorama;this.activeModeMap.forEach(((i,n)=>{i.totalTimeinMS>e&&(t=n,e=i.totalTimeinMS)})),this.active=!1;const[i,n,s]=[this.activeModeMap.get(z.Ey.Dollhouse),this.activeModeMap.get(z.Ey.Floorplan),this.activeModeMap.get(z.Ey.Panorama)].map((e=>e?e.totalTimeinMS:0));this.engine.broadcast(new ue.i(i,n,s,be.KP[t],this.requestQueue.totalBytesDownloaded,this.totalTilesDownloaded))}}}ShowcaseActivityTracking.ACTIVITY_INTERVAL=15e3;var Ee,Te=i(79548);!function(e){e.USER="self-guided",e.TOUR="tour"}(Ee||(Ee={}));class RoomDataAnalytics{constructor(){this.handlers=[{msgType:Te.D,func:(e,t,i)=>{const n=i.tryGetData(b.Z),s=i.tryGetData(w.k),r={room_id:t.roomId,room_index:t.meshSubgroup,room_type:t.roomType,viewmode:t.viewmode?be.KP[t.viewmode]:t.viewmode,room_visit_count:t.visitCount,room_count:t.roomCount,navigation_source:s&&s.tourPlaying?Ee.TOUR:Ee.USER,interaction_source:n?n.source:b.Z.defaultSource,interaction_mode:n?n.mode:b.Z.defaultMode};e.track("room_visited",r)}}]}}var we=i(25643);class ShowcaseLabelAnalytics{constructor(){this.handlers=[{msgType:we.V,func:(e,t,i)=>{e.track("internal_warning",{warningType:"rtl_disabled_roomnav"})}}]}}var xe=i(62627);const _e=e=>e.sort(((e,t)=>e.localeCompare(t)));class ModelRatingAnalytics{constructor(){this.handlers=[{msgType:xe.E,func:(e,t)=>{const{happiness:i,quality:n,navigation:s,feedback:r}=t.rating,o={};i&&(o.happiness=+i),(s&&s.length>0||n&&n.length>0)&&(o.issue_types=function(e=[],t=[]){const i=[];return _e(t).forEach((e=>i.push(`navigation-${e.trim()}`))),_e(e).forEach((e=>i.push(`quality-${e.trim()}`))),i.join(",")}(n||[],s||[])),r&&r.length>0&&(o.feedback=r),Object.keys(o).length>0&&e.track("model_rated",o)}}]}}class ShowcaseAnalytics extends n.Y{constructor(){super(...arguments),this.name="showcase-analytics",this.loaded=!1,this.handlers=[],this.track=(e,t)=>{this.analytics.track(e,t)}}async init(e,t){this.analytics=await t.getModuleBySymbol(s.y.ANALYTICS),this.apiClient=(await t.getModule(r.default)).getApi();const i=await t.market.waitForData(ae.e),n=await t.getModule(he.default);this.addMessageHandlers(this.analytics,t),this.context=function(e,t,i){const n=g(t,i);return(0,c.Z)(e).then((e=>{n.location={city:e.city,country:e.country_name,region:e.region}})),n}(e.apiQueue,n.languageCode,e.appName),this.options=Object.assign(Object.assign({mds_enabled:!0},{model_id:(0,h.eY)("model")||(0,h.eY)("m")||"",start_source:(0,h.eY)("play",!1)?"autoplay":d.yL()?"click":"fullpage",autoplay:(0,h.eY)("play",!1)||!d.yL(),quickstart:1===(0,h.eY)("qust",0)||1===(0,h.eY)("qs",0),language_tag:(0,h.eY)("lang",null),is_mobile:d.tq(),iframe:d.yL(),aspect_ratio:d.dy(),session_id:(0,u.D)(),window:{height:window.innerHeight,width:window.innerWidth},platform:f()}),e.additionalValues),this.activityTracking=new ShowcaseActivityTracking,this.activityTracking.init(t,this.registerBindings.bind(this),e.apiQueue);const o=await this.createAnalyticsConfigs(e,i);this.analytics.load(o,e.analyticsQueue,this.options,this.context,this.apiClient.user).then((()=>{this.loaded=!0}))}addMessageHandlers(e,t){this.addMessageHandler(new ShowcaseSessionAnalytics(e,t),t),this.addMessageHandler(new ViewmodeAnalytics,t),this.addMessageHandler(new CameraDataAnalytics,t),this.addMessageHandler(new InteractionmodeAnalytics,t),this.addMessageHandler(new FloorChangeAnalytics,t),this.addMessageHandler(new O.s,t),this.addMessageHandler(new ZoomAnalytics,t),this.addMessageHandler(new MeasurementAnalytics,t),this.addMessageHandler(new RenderingPerformanceAnalytics(t),t),this.addMessageHandler(new ActivityAnalytics,t),this.addMessageHandler(new RoomDataAnalytics,t),this.addMessageHandler(new ShowcaseLabelAnalytics,t),this.addMessageHandler(new ModelRatingAnalytics,t)}addMessageHandler(e,t){this.handlers.push(e),e.handlers.forEach(((e,i)=>{this.bindings.push(t.subscribe(e.msgType,(i=>{e.func(this.analytics,i,t.market)})))}))}registerBindings(e){this.bindings.push(...e)}async createAnalyticsConfig(e,t){if(((e,t)=>{const i=Object.keys(e);for(const n of i)if(e[n]===t)return!0;return!1})(a.K,e)){const{apiClient:i}=this,n=o.H[e],s=null!==n.key?await i.getAppKey(t,n.key):null,r=null!==n.url?await i.getAppKey(t,n.url):null;if(null===n.key||null!==s&&null===n.url||null!==r)return{provider:e,token:s,url:r}}return null}async createAnalyticsConfigs(e,t){const i=e.appName,n=void 0!==e.provider?e.provider:await this.apiClient.getAppKey(i,"analytics_provider"),s=[];if(!n)return s;const r=n.split(",");for(const e of r){const t=await this.createAnalyticsConfig(e,i);null!==t?s.push(t):this.log.warn(`Failed to set up ${e}, token/url required but not found in config`)}return s.length<1&&s.push({provider:v,token:null,url:null}),s}onUpdate(e){this.loaded&&((e,t)=>{var i;if(!Q)return;te.push(t);const n=null!==(i=null==q?void 0:q.estimatedGPUMemoryAllocated())&&void 0!==i?i:-1;n>-1&&ie.push(n),Z+=t,Z>=$&&(re(e),se())})(this.analytics,e)}dispose(e){super.dispose(e);for(const e of this.handlers)e.dispose&&e.dispose();this.handlers=[]}getSessionId(){return this.options.session_id||""}}},38587:(e,t,i)=>{"use strict";i.d(t,{i:()=>ActivityPingMessage});var n=i(91466);class ActivityPingMessage extends n.v{constructor(e,t,i,n,s,r){super(),this.durationDollhouse=e,this.durationFloorplan=t,this.durationInside=i,this.mainMode=n,this.totalBytesDownloaded=s,this.tilesDownloaded=r}}},32086:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseHotkeys});var n=i(96909),s=i(88727),r=i(81507),o=i(3805),a=i(47724),l=i(88216),c=i(35597),d=i(5087),h=i(33874),u=i(2388),p=i(59088);class ShowcaseHotkeys extends a.Y{constructor(){super(...arguments),this.name="showcase-hotkeys",this.inputCommandMap={[l.M.PRESSED]:{[r.R.ONE]:()=>(this.viewmodeData.currentMode===d.Ey.Panorama&&(this.settings.setProperty(u.Lp,!1),this.currentView=0),this.switchToMode(o.BD.INSIDE)),[r.R.TWO]:()=>this.switchToMode(o.BD.DOLLHOUSE),[r.R.THREE]:()=>this.switchToMode(o.BD.FLOORPLAN),[r.R.ZERO]:()=>{const e=this.currentView++%this.meshViews.length;return this.meshViews[e]()}}},this.currentView=0,this.meshViews=[()=>(this.settings.setProperty(u.Lp,!1),this.switchToMode(o.BD.MESH)),()=>(this.settings.setProperty(u.Lp,!0),this.switchToMode(o.BD.MESH)),()=>(this.settings.setProperty(u.Lp,!0),this.switchToMode(o.BD.INSIDE)),()=>(this.settings.setProperty(u.Lp,!1),this.switchToMode(o.BD.INSIDE))]}async init(e,t){const i=await t.getModuleBySymbol(n.y.INPUT);[this.viewmodeData,this.settings,this.cameraData]=await Promise.all([t.market.waitForData(c.O),t.market.waitForData(h.e),t.market.waitForData(p.M_)]),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),i.registerHandler(s.e,(async e=>{this.inputCommandMap[e.state]&&this.inputCommandMap[e.state][e.key]&&await this.inputCommandMap[e.state][e.key]()}))}async switchToMode(e){const{currentMode:t}=this.viewmodeData;if(t!==d.Ey.Transition){const i=(0,d.Bw)(t)&&(e===o.BD.MESH||e===o.BD.INSIDE)?this.cameraData.pose.rotation:void 0;await this.issueCommand(new o._i(e,void 0,{rotation:i}))}}}},64147:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcasePasswordModule});var n=i(67294),s=i(73935),r=i(47724),o=i(69759),a=i(18349),l=i(41452),c=i(85893),d=i(94184),h=i.n(d),u=i(13789),p=i(25813),m=i(90831);class PoweredBy extends n.Component{render(){const{attributionLinkText:e,attributionLinkUrl:t}=this.props,{locale:i}=this.context;return(0,c.jsxs)("div",Object.assign({className:"powered-by"},{children:[(0,c.jsx)("p",Object.assign({className:"powered-by-label"},{children:i.t(u.Z.POWERED_BY)}),void 0),(0,c.jsx)("img",{className:"powered-by-logo",alt:"Matterport",src:m,width:"150",height:"32"},void 0),t&&(0,c.jsx)("a",Object.assign({href:t,className:"powered-by-link"},{children:e||t}),void 0)]}),void 0)}}PoweredBy.contextType=p.I;var f=i(88512),g=i(24877),v=i(31102);class InvalidPasswordException extends v.y{constructor(e="Invalid password"){super(e),this.name="InvalidPassword"}}class TooManyAttemptsException extends v.y{constructor(e="Too many attempts, please try again in a few minutes"){super(e),this.name="TooManyAttempts"}}const y=new f.Z("showcase-password");class ShowcasePasswordUi extends n.Component{constructor(e){super(e),this.isUnmounting=!1,this.onInputChange=e=>{const{name:t,value:i}=e.target;"password"===t&&this.setState({password:i,hasError:!1})},this.onSubmit=async e=>{e.preventDefault(),this.setState({formEnabled:!1}),await this.authenticate(),this.isUnmounting||this.setState({formEnabled:!0})},this.state={formEnabled:!0,hasError:!1,tooManyAttempts:!1,password:""}}componentWillUnmount(){this.isUnmounting=!0}async authenticate(){const{authenticate:e}=this.props,{password:t}=this.state;y.debug("Validating password input...");const i=await e(t).catch((e=>(e instanceof TooManyAttemptsException&&this.setState({hasError:!0,tooManyAttempts:!0}),!1)));this.isUnmounting||this.setState({hasError:!i})}stopPropagation(e){e.stopPropagation()}renderLockout(){const{locale:e}=this.context;return(0,c.jsxs)("div",Object.assign({className:"sc-password-modal sc-password-lockout"},{children:[(0,c.jsx)("header",Object.assign({className:"modal-header"},{children:(0,c.jsx)("h1",Object.assign({className:"modal-title"},{children:e.t(u.Z.SC_LOCKOUT_TITLE)}),void 0)}),void 0),(0,c.jsx)("p",Object.assign({className:"modal-body"},{children:e.t(u.Z.SC_LOCKOUT_MESSAGE)}),void 0)]}),void 0)}renderLoginForm(){const{hasError:e,password:t,formEnabled:i}=this.state,{locale:n}=this.context;return(0,c.jsxs)("div",Object.assign({className:"sc-password-modal sc-password-login"},{children:[(0,c.jsx)("header",Object.assign({className:"modal-header"},{children:(0,c.jsx)("h1",Object.assign({className:"modal-title"},{children:n.t(u.Z.SC_PASSWORD_TITLE)}),void 0)}),void 0),(0,c.jsxs)("div",Object.assign({className:"modal-body"},{children:[(0,c.jsxs)("form",Object.assign({onSubmit:this.onSubmit,className:"sc-password-form"},{children:[(0,c.jsx)("input",{type:"password",name:"password",placeholder:n.t(u.Z.SC_PASSWORD_PLACEHOLDER),onInput:this.onInputChange,onKeyDown:this.stopPropagation,onKeyPress:this.stopPropagation,onKeyUp:this.stopPropagation,disabled:!i,value:t,className:h()("sc-password-input",{error:e}),autoComplete:"on"},void 0),(0,c.jsx)("button",Object.assign({type:"submit",disabled:!i,className:"sc-password-submit"},{children:n.t(u.Z.SC_PASSWORD_SUBMIT)}),void 0)]}),void 0),e&&(0,c.jsxs)("p",Object.assign({className:"help-text error"},{children:[(0,c.jsx)("span",{className:"icon icon-error"},void 0),n.t(u.Z.SC_PASSWORD_INVALID)]}),void 0),!e&&(0,c.jsx)("p",{className:"help-text"},void 0)]}),void 0)]}),void 0)}render(){const{hasError:e,tooManyAttempts:t}=this.state,i=e&&t?this.renderLockout():this.renderLoginForm();return(0,c.jsxs)("div",Object.assign({className:"sc-password-ui",style:{backgroundImage:`url(${g})`}},{children:[(0,c.jsx)("div",Object.assign({className:"sc-password-content"},{children:i}),void 0),(0,c.jsx)("footer",Object.assign({className:"sc-password-footer"},{children:(0,c.jsx)(PoweredBy,{},void 0)}),void 0)]}),void 0)}}ShowcasePasswordUi.contextType=p.I;var b=i(15030),S=i(92839);class ShowcasePasswordModule extends r.Y{constructor(){super(...arguments),this.name="showcase-password",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t;const i=e.baseUrl||window.location.origin;this.auth=new o.L(i)}showPasswordScreen(){this.loadUi()}hidePasswordScreen(){this.unloadUi()}async loadUi(){const{container:e}=this.config,t=await this.engine.getModule(l.default),i=Object.assign(Object.assign({},S.O),{locale:t});this.reactContainer=document.createElement("div"),this.reactContainer.id="showcase-password-container",e.appendChild(this.reactContainer);const r=(0,n.createElement)(p.I.Provider,{value:i},[(0,n.createElement)(ShowcasePasswordUi,{key:"showcase-password",authenticate:e=>this.authenticate(e)})]);(0,s.render)(r,this.reactContainer)}async unloadUi(){if(this.reactContainer){const e=(0,s.unmountComponentAtNode)(this.reactContainer);return this.reactContainer.remove(),delete this.reactContainer,e}return!1}async authenticate(e){const{modelId:t}=this.config;if(!await this.auth.authenticate(t,e)){switch(this.engine.broadcast(new b.s(this.auth.errorType)),this.auth.errorType){case a.s.INVALID_CREDENTIALS:throw new InvalidPasswordException;case a.s.TOO_MANY_ATTEMPTS:throw new TooManyAttemptsException}return!1}return this.log.debug("Password authentication was successful"),this.engine.broadcast(new b.L),!0}}},15030:(e,t,i)=>{"use strict";i.d(t,{L:()=>PasswordAuthenticationSuccess,s:()=>PasswordAuthenticationFail});var n=i(91466);class PasswordAuthenticationSuccess extends n.v{}class PasswordAuthenticationFail extends n.v{constructor(e){super(),this.errorType=e}}},30075:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseSettings});var n,s,r,o=i(47724),a=i(96909),l=i(33874),c=i(3248),d=i(3506),h=i(31278),u=i(94474),p=i(88512),m=i(16047);!function(e){e.BLACK="black",e.GREY="grey",e.WHITE="white"}(n||(n={})),function(e){e.DISABLED="disabled",e.MEASURE="measure",e.MEASURE_AND_VIEW="measureAndView"}(s||(s={})),function(e){e.metric="metric",e.imperial="imperial"}(r||(r={}));var f=i(51058),g=i(52599),v=i(54243);const y=new p.Z("mds-player-options-deserializer"),b={[m.Y.LEFT]:g.kw.Left,[m.Y.RIGHT]:g.kw.Right,[m.Y.AUTO]:g.kw.Auto},S={[n.BLACK]:v.z.black,[n.GREY]:v.z.grey,[n.WHITE]:v.z.white};class MdsPlayerOptionsDeserializer{deserialize(e){if(!e||!this.validate(e))return y.debug("Deserialized invalid options data from MDS",e),null;const t=(e.publication||{}).options||{},i=e.options,n=b[i.tourPanDirection],o={address:t.address,contact_email:t.contactEmail,contact_name:t.contactName,contact_phone:t.contactPhone,dollhouse:i.dollhouseEnabled,external_url:t.externalUrl,floor_plan:i.floorplanEnabled,floor_select:i.floorSelectEnabled,highlight_reel:i.highlightReelEnabled,labels:i.labelsEnabled,labels_dh:i.dollhouseLabelsEnabled,model_name:t.modelName,model_summary:t.modelSummary,presented_by:t.presentedBy,measurements:i.measurements!==s.DISABLED,measurements_saved:i.measurements===s.MEASURE_AND_VIEW,unit_type:i.unitType===r.imperial?f.M.IMPERIAL:f.M.METRIC,background_color:S[i.backgroundColor],tour_buttons:i.tourButtonsEnabled,fast_transitions:i.tourFastTransitionsEnabled,transition_speed:i.tourTransitionSpeed,transition_time:i.tourTransitionTime,pan_speed:i.tourPanSpeed,dollhouse_pan_speed:i.tourDollhousePanSpeed,zoom_duration:i.tourZoomDuration,pan_angle:i.tourPanAngle,pan_direction:n,space_search:i.spaceSearchEnabled};return new c.af(o)}validate(e){return["id","options","publication"].every((t=>t in e))}}var E;!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DEFAULT="default"}(E||(E={}));var T=i(71918);const w=(0,T.S)(b),x=(0,T.S)(S);class MdsPlayerOptionsSerializer{serialize(e){const t={},i=e.options||{};if(void 0!==i.dollhouse&&(t.dollhouseOverride=i.dollhouse?E.ENABLED:E.DISABLED),void 0!==i.floor_plan&&(t.floorplanOverride=i.floor_plan?E.ENABLED:E.DISABLED),void 0!==i.floor_select&&(t.floorSelectOverride=i.floor_select?E.ENABLED:E.DISABLED),void 0!==i.space_search&&(t.spaceSearchOverride=i.space_search?E.ENABLED:E.DISABLED),void 0!==i.labels&&(t.labelsOverride=i.labels?E.ENABLED:E.DISABLED),void 0!==i.labels_dh&&(t.dollhouseLabelsOverride=i.labels_dh?E.ENABLED:E.DISABLED),void 0!==i.highlight_reel&&(t.highlightReelOverride=i.highlight_reel?E.ENABLED:E.DISABLED),void 0!==i.background_color&&(t.backgroundColor={set:x[i.background_color]||n.BLACK}),void 0!==i.unit_type){const e=i.unit_type===f.M.METRIC?r.metric:r.imperial;t.unitType={set:e}}if(void 0!==i.measurements||void 0!==i.measurements_saved){const e=i.measurements&&i.measurements_saved?s.MEASURE_AND_VIEW:i.measurements?s.MEASURE:s.DISABLED;t.measurements={set:e}}void 0!==i.tour_buttons&&(t.tourButtonsOverride=i.tour_buttons?E.ENABLED:E.DISABLED),void 0!==i.fast_transitions&&(t.tourFastTransitionsOverride=i.fast_transitions?E.ENABLED:E.DISABLED),void 0!==i.pan_angle&&(t.tourPanAngle={set:i.pan_angle}),void 0!==i.pan_direction&&(t.tourPanDirection={set:w[i.pan_direction]}),void 0!==i.pan_speed&&(t.tourPanSpeed={set:i.pan_speed}),void 0!==i.transition_speed&&(t.tourTransitionSpeed={set:i.transition_speed}),void 0!==i.transition_time&&(t.tourTransitionTime={set:i.transition_time}),void 0!==i.zoom_duration&&(t.tourZoomDuration={set:i.zoom_duration}),void 0!==i.dollhouse_pan_speed&&(t.tourDollhousePanSpeed={set:i.dollhouse_pan_speed});const o={};return void 0!==i.presented_by&&(o.presentedByOverride=i.presented_by?E.ENABLED:E.DISABLED),void 0!==i.contact_email&&(o.contactEmailOverride=i.contact_email?E.ENABLED:E.DISABLED),void 0!==i.contact_name&&(o.contactNameOverride=i.contact_name?E.ENABLED:E.DISABLED),void 0!==i.contact_phone&&(o.contactPhoneOverride=i.contact_phone?E.ENABLED:E.DISABLED),void 0!==i.external_url&&(o.externalUrlOverride=i.external_url?E.ENABLED:E.DISABLED),void 0!==i.model_name&&(o.modelNameOverride=i.model_name?E.ENABLED:E.DISABLED),void 0!==i.model_summary&&(o.modelSummaryOverride=i.model_summary?E.ENABLED:E.DISABLED),void 0!==i.address&&(o.addressOverride=i.address?E.ENABLED:E.DISABLED),{options:t,publication:{options:o}}}}var _=i(91985);const M=new p.Z("mds-player-options-store");class MdsPlayerOptionsStore extends u.u{constructor(){super(...arguments),this.serializer=new MdsPlayerOptionsSerializer,this.deserializer=new MdsPlayerOptionsDeserializer,this.prefetchKey="data.model.publication.options"}async read(e={}){const t={modelId:this.getViewId()};return this.query(_.GetModelOptions,t,e).then((e=>{var t;return this.deserializer.deserialize(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)}))}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(_.PatchModel,{modelId:t,patch:i}).then((e=>{M.debug(e)}))}}var O=i(57938),A=i(39729),C=i(99252),P=i(38420),D=i(48602),N=i(50988);class ShowcaseSettings extends o.Y{constructor(){super(...arguments),this.name="showcase-settings",this.updateTransitionType=(e,t,i)=>{const n=e.options.fast_transitions?h.n.FadeToBlack:h.n.Interpolate;t.hasProperty(d.gj)?t.setProperty(d.gj,n):i.registerSetting("player_options",d.gj,n)}}async init(e,t){const{readonly:i,baseUrl:n}=e;this.engine=t,this.store=new MdsPlayerOptionsStore({readonly:i,baseUrl:n});const[s,r,o,d]=await Promise.all([t.getModuleBySymbol(a.y.SETTINGS),t.market.waitForData(l.e),t.getModule(C.F),this.store.read()]);this.playerOptionsData=d||new c.af,t.market.register(this,c.af,this.playerOptionsData);for(const e in c.gx){const t=c.gx[e],i=this.playerOptionsData.options[t];if(s.hasProperty(t)){const e=s.getProperty(t);s.updateSetting(t,i&&e),this.log.debug(`Updated player_options setting ${t} = ${i&&e}`)}else s.registerSetting("player_options",t,i),this.log.debug(`Registered player_options setting ${t} = ${i}`)}if(this.updateTransitionType(this.playerOptionsData,r,s),this.bindings.push(r.onPropertyChanged(c.gx.InstantTransitions,(()=>this.updateTransitionType(this.playerOptionsData,r,s)))),!i){this.bindings.push(o.onSave((()=>this.save()),{dataType:P.g.SETTINGS}));const e=await t.market.waitForData(D.Q);e.setRevertableType(P.g.SETTINGS),e.setPublishableType(P.g.SETTINGS),this.monitor=new O.u(this.playerOptionsData,{aggregationType:A.E.NextFrame},this.engine),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new N.VQ({dataTypes:[P.g.SETTINGS]}))))}}async save(){if(!this.store||!this.monitor)return void this.log.warn("Settings changes will NOT be saved");const e=this.monitor.getDiffRecord(),t=e.options;return t&&(t&&void 0===t.measurements&&void 0!==t.measurements_saved&&(t.measurements=this.playerOptionsData.options.measurements),t&&void 0!==t.measurements&&void 0===t.measurements_saved&&(t.measurements_saved=this.playerOptionsData.options.measurements_saved),void 0!==(null==t?void 0:t.floor_select)&&(t.floor_select=this.playerOptionsData.options.floor_select),void 0!==(null==t?void 0:t.labels_dh)&&(t.labels_dh=this.playerOptionsData.options.labels_dh),void 0===t.presented_by&&void 0===t.contact_email&&void 0===t.contact_name&&void 0===t.contact_phone&&void 0===t.external_url&&void 0===t.model_name&&void 0===t.model_summary&&void 0===t.address||(t.presented_by=this.playerOptionsData.options.presented_by,t.contact_email=this.playerOptionsData.options.contact_email,t.contact_name=this.playerOptionsData.options.contact_name,t.contact_phone=this.playerOptionsData.options.contact_phone,t.external_url=this.playerOptionsData.options.external_url,t.model_name=this.playerOptionsData.options.model_name,t.model_summary=this.playerOptionsData.options.model_summary,t.address=this.playerOptionsData.options.address)),this.monitor.clearDiffRecord(),this.store.update(e)}}},55402:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ShowcaseStart});var n=i(2212),s=i(47724),r=i(96909),o=i(75892),a=i(5087),l=i(93263),c=i(31278),d=i(35026),h=i(10757),u=i(33874),p=i(95877),m=i(17386);class FlyInCommand extends m.m{constructor(e){super(),this.payload={pose:e}}}var f=i(3248),g=i(19674),v=i(2240),y=i(64185),b=i(2725),S=i(30075),E=i(84842),T=i(44382);class ShowcaseStart extends s.Y{constructor(){super(...arguments),this.name="showcase-start",this.firstRenderPromise=new y.Q,this.flyInPromise=new y.Q,this.handleFlyIn=(e,t,i)=>(this.renderer.startRender(!1),this.doStandardStart(e,t,i,!0).catch((()=>this.renderer.startRender(!0))))}async init(e,t){const[i,n]=await Promise.all([t.market.waitForData(u.e),t.getModule(p.default)]);[this.sweepData,this.sweepModule,this.cameraModule,this.renderer]=await Promise.all([t.market.waitForData(o.Z),t.getModule(v.default),t.getModuleBySymbol(r.y.CAMERA),t.getModuleBySymbol(r.y.WEBGL_RENDERER)]);const s=i.tryGetProperty("quickstart",!1),a=n.getStartingPose();return(s?this.doQuickStart(a,t):this.doStandardStart(a,t,i,!1)).then((()=>this.flyInPromise.resolve())),this.bindings.push(t.commandBinder.addBinding(FlyInCommand,(async e=>{this.handleFlyIn(e.pose||n.getStartingPose(),t,i)}))),this.waitForFirstRender}get waitForFirstRender(){return this.firstRenderPromise.nativePromise()}get waitForFlyin(){return this.flyInPromise.nativePromise()}async doQuickStart(e,t){const i=this.sweepData.getStartSweep(e),n=i&&i.id,s=await t.getModule(l.default);return await s.switchToMode(e.mode,c.n.Instant,{sweepID:n,position:e.camera.position||i&&i.position,rotation:e.camera.rotation,zoom:-1!==e.camera.zoom?e.camera.zoom:void 0}),t.broadcast(new E.bN(!1)),e.mode!==a.Ey.Dollhouse&&e.mode!==a.Ey.Floorplan||e.floorVisibility&&await t.commandBinder.issueCommandWhenBound(new b.h9(e.floorVisibility.lastIndexOf(1),!0,0)),this.renderBeforeStarting(t)}async doStandardStart(e,t,i,s){var o;const[d]=await Promise.all([t.getModule(l.default)]);await t.getModule(S.default);const u=i.checkUrlParam("dh",0,1)||!i.tryGetProperty(f.gx.Dollhouse,!0),p=i.checkUrlParam("fp",0,1)||!i.tryGetProperty(f.gx.FloorPlan,!0);e&&(e.mode===a.Ey.Dollhouse&&u||e.mode===a.Ey.Floorplan&&p||e.mode===a.Ey.Panorama&&!e.pano)&&(e=null);const m=!e||e&&(e.mode===a.Ey.Dollhouse||e.mode===a.Ey.Floorplan),v=!e||e&&!this.is360Pano(e)&&(0,a.Bw)(e.mode)&&!u,y=e?e.mode:a.Ey.Panorama,w=this.sweepData.getStartSweep(e),x=w&&w.id,_=this.sweepData.getFirstSweep();let M=_&&_.rotation;if((null===(o=null==e?void 0:e.camera)||void 0===o?void 0:o.rotation)&&!(0,T.mB)(e.camera.rotation)&&(M=e.camera.rotation),M&&y!==a.Ey.Floorplan&&(M=(0,g.Z)(M)),v){await t.getModuleBySymbol(r.y.MODEL_MESH);const i=d.getFlyinEndPose({sweepID:x,position:e?e.camera.position:void 0,rotation:M}),o=d.getFlyinStartPose(i,s?new n.Vector3(0,0,0):void 0);t.broadcast(new E.bN(!0));const u=x?this.sweepModule.activateSweep({sweepId:x}):Promise.resolve();return await d.switchToMode(a.Ey.Dollhouse,c.n.Instant,o),await this.renderBeforeStarting(t),await(0,h.gw)(750),await this.cameraModule.moveTo({transitionType:c.n.Interpolate,pose:i}).nativePromise(),await u,t.broadcast(new E.bN(!1)),d.switchToMode(y,c.n.Interpolate,{sweepID:x,rotation:M},l.DEFAULT_TRANSITION_TIME)}await d.switchToMode(y,c.n.Instant,{sweepID:x,position:e?e.camera.position:void 0,rotation:M,zoom:e&&-1!==e.camera.zoom?e.camera.zoom:void 0}),m&&e&&(e.floorVisibility?await t.commandBinder.issueCommandWhenBound(new b.h9(e.floorVisibility.lastIndexOf(1),!0,0)):await t.commandBinder.issueCommandWhenBound(new b.Vw(null))),await this.renderBeforeStarting(t)}is360Pano(e){if(e.pano.uuid){const t=this.sweepData.getSweep(e.pano.uuid);if(t)return t.alignmentType!==d.z9.ALIGNED}else{const e=this.sweepData.getFirstSweep();if(void 0!==e)return e.alignmentType!==d.z9.ALIGNED}return!1}async renderBeforeStarting(e){await this.renderer.renderOnce(),await e.getModuleBySymbol(r.y.LOADING_GUI),this.renderer.startRender(!0),this.firstRenderPromise.resolve()}}},36371:(e,t,i)=>{"use strict";i.d(t,{M:()=>Matrix});var n=i(2212);class ROMatrix{constructor(e){this.elements=[],e?(e=>void 0!==e.elements)(e)?this.elements=e.elements.slice():n.Matrix4.prototype.set.apply(this,e):n.Matrix4.prototype.set.apply(this,ROMatrix.identity)}equals(e){return n.Matrix4.prototype.equals.call(this,e)}clone(){return new ROMatrix(this)}}ROMatrix.identity=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];class Matrix extends ROMatrix{constructor(e){e instanceof Array||e?super(e):super(),this.threeMatrix=new n.Matrix4}set(e,t,i,s,r,o,a,l,c,d,h,u,p,m,f,g){return n.Matrix4.prototype.set.call(this,e,t,i,s,r,o,a,l,c,d,h,u,p,m,f,g),this}makeScale(e,t,i){return n.Matrix4.prototype.makeScale.call(this,e,t,i),this}copy(e){for(let t=0;t<this.elements.length;t++)this.elements[t]=e.elements[t];return this}clone(){return(new Matrix).copy(this)}transpose(){return n.Matrix4.prototype.transpose.call(this)}lookAt(e,t,i){return n.Matrix4.prototype.lookAt.call(this,e,t,i),this}setPosition(e){return n.Matrix4.prototype.setPosition.call(this,e.x,e.y,e.z),this}extractRotation(e){return n.Matrix4.prototype.extractRotation.call(this,e),this}makePerspective(e,t,i,s,r,o){return n.Matrix4.prototype.makePerspective.call(this,e,t,i,s,r,o),this}makePerspectiveFov(e,t,i=.1,s=1e3){const r=i*Math.tan(e*(Math.PI/180)/2),o=-r,a=r*t,l=-a;return n.Matrix4.prototype.makePerspective.call(this,l,a,r,o,i,s),this}makeOrthographic(e,t,i,s,r,o){return n.Matrix4.prototype.makeOrthographic.call(this,e,t,i,s,r,o),this}identity(){return this.set.apply(this,ROMatrix.identity)}makeRotationFromQuaternion(e){return n.Matrix4.prototype.makeRotationFromQuaternion.call(this,e),this}makeRotationFromEuler(e){return n.Matrix4.prototype.makeRotationFromEuler.call(this,e),this}getInverse(e){return n.Matrix4.prototype.copy.call(this,e),n.Matrix4.prototype.invert.call(this),this}premultiply(e){return n.Matrix4.prototype.premultiply.call(this,e),this}multiplyMatrices(e,t){return n.Matrix4.prototype.multiplyMatrices.call(this,e,t),this}scale(e){return n.Matrix4.prototype.scale.call(this,e),this}compose(e,t,i){return n.Matrix4.prototype.compose.call(this,e,t,i),this}asThreeMatrix4(){return this.threeMatrix.set(this.elements[0],this.elements[4],this.elements[8],this.elements[12],this.elements[1],this.elements[5],this.elements[9],this.elements[13],this.elements[2],this.elements[6],this.elements[10],this.elements[14],this.elements[3],this.elements[7],this.elements[11],this.elements[15])}}},68524:(e,t,i)=>{"use strict";i.d(t,{Z:()=>n});const n=Object.freeze({signedUrlDefaultExpireTime:24e4,signedUrlCheckInterval:1e4,signedUrlRefreshBuffer:15e3,visionTilingStartDate:new Date("8/26/2016"),visionTilingStartVersion:"1.1.407.13667",epsilon:1e-5,skyboxMeshGroup:"_group_skybox_",skysphereMeshGroup:"_group_skysphere_"})},17386:(e,t,i)=>{"use strict";i.d(t,{m:()=>Command});class Command{}},11554:(e,t,i)=>{"use strict";i.d(t,{B:()=>CommandBinder});var n=i(90933),s=i(64185);const r=new(i(88512).Z)("command-binder");class CommandBinder{constructor(){this.typeLookup=new n.cj,this.bindings={},this.queuedCommands={},this.hookedCommands={},this.resetHooks=()=>{this.hookedCommands={}},this.issueCommand=this.issueCommand.bind(this),this.issueCommandWhenBound=this.issueCommandWhenBound.bind(this)}addBinding(e,t){const i=this.typeLookup.getKeyByType(e,!0);if(this.bindings[i])throw Error(`Command ${i} already bound to a callback`);this.bindings[i]=t,this.callQueuedCommands(i);return{renew:()=>{this.bindings[i]!==t&&this.addBinding(e,t)},cancel:()=>this.removeBinding(e,t),active:this.bindings[i]===t}}removeBinding(e,t){const i=this.typeLookup.getKeyByType(e);if(!i)return void r.debug("Trying to unbind unbound command");this.bindings[i]===t?delete this.bindings[i]:r.debug("Trying to unbind unbound callback")}issueCommand(e,t=!0){const i=this.typeLookup.getKeyByInstance(e),n=this.bindings[i];return n?this.issueCommandHelper(e,i,n,t):Promise.reject("Command not bound: "+e.id)}issueCommandHelper(e,t,i,n=!0){return this.hookedCommands[t]&&!this.hookedCommands[t].resolving?this.issueHookCommand(e,t):i(e.payload)}issueCommandWhenBound(e){const t=new s.Q;return this.issueCommand(e).then((e=>t.resolve(e))).catch((i=>{const n=this.typeLookup.getKeyByInstance(e,!0);this.queuedCommands[n]||(this.queuedCommands[n]=[]),this.queuedCommands[n].push({command:e,deferred:t})})),t.nativePromise()}callQueuedCommands(e){const t=[];this.queuedCommands[e]&&(this.queuedCommands[e].forEach((e=>{t.push(this.issueCommand(e.command).then((t=>e.deferred.resolve(t))))})),Promise.all(t).then((()=>{delete this.queuedCommands[e]})))}hookCommand(e,t,i){const n=this.typeLookup.getKeyByType(e,!0);if(this.hookedCommands[n]){if(t&&null!==this.hookedCommands[n].preCommandCallback)throw Error(`Command ${e.name} has already been pre hooked`);if(!t&&null!==this.hookedCommands[n].postCommandCallback)throw Error(`Command ${e.name} has already been post hooked`)}else this.hookedCommands[n]={preCommandCallback:null,postCommandCallback:null,resolving:!1};t?this.hookedCommands[n].preCommandCallback=i:this.hookedCommands[n].postCommandCallback=i}async issueHookCommand(e,t){const i=this.hookedCommands[t],n=this.bindings[t],s=e.payload,r=i.preCommandCallback,o=i.postCommandCallback;try{r&&await r(s),i.resolving=!0;const a=await this.issueCommandHelper(e,t,n,!0);return i.resolving=!1,o&&await o(s),a}catch(e){throw Error(`Could not completely issueHookCommand - ${e}`)}}}},32770:(e,t,i)=>{"use strict";i.d(t,{V:()=>Data});var n=i(23573);class Data extends n.T{}},76701:(e,t,i)=>{"use strict";var n,s;i.d(t,{p3:()=>n,Jj:()=>NullGeneratorResult,M8:()=>WaitForPromiseGeneratorResult,ZP:()=>EngineGenerators}),function(e){e[e.None=0]="None",e[e.Duration=1]="Duration",e[e.Phase=2]="Phase",e[e.Promise=3]="Promise"}(n||(n={}));class EngineGeneratorResult{constructor(e){this.type=e}}class NullGeneratorResult extends EngineGeneratorResult{constructor(){super(n.None)}}class WaitDurationGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Duration),this.duration=e,this.startTime=Date.now()}}class WaitForPhaseGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Phase),this.phase=e}}!function(e){e[e.Pending=0]="Pending",e[e.Fulfilled=1]="Fulfilled",e[e.Rejected=2]="Rejected"}(s||(s={}));class WaitForPromiseGeneratorResult extends EngineGeneratorResult{constructor(e){super(n.Promise),this.promise=e,this.promiseState=s.Pending,e.then((()=>{this.promiseState=s.Fulfilled})).catch((()=>{this.promiseState=s.Rejected}))}}class EngineGenerator{constructor(e,t=!0){this.generator=e,t&&this.start()}start(){this.started||(this.iterator=this.generator()),this.started=!0}iterate(){const e=this.iterator.next();this.currentResult=e.value,e.done&&(this.started=!1)}}class EngineGenerators{constructor(){this.generators=[]}startGenerator(e){let t=this.generators.length;for(let i=0;i<this.generators.length;i++){this.generators[i].generator===e&&(t=i)}this.generators[t]=new EngineGenerator(e)}stopGenerator(e){for(const t of this.generators)t.generator===e&&(t.started=!1)}processGenerators(e,t){for(const i of this.generators)if(i.started)switch(e){case n.None:(!i.currentResult||i.currentResult instanceof NullGeneratorResult)&&i.iterate();break;case n.Phase:if(i.currentResult instanceof WaitForPhaseGeneratorResult){const e=i.currentResult;void 0!==t&&e.phase===t&&i.iterate()}break;case n.Promise:if(i.currentResult instanceof WaitForPromiseGeneratorResult){i.currentResult.promiseState===s.Fulfilled&&i.iterate()}break;case n.Duration:if(i.currentResult instanceof WaitDurationGeneratorResult){const e=i.currentResult;Date.now()-e.startTime>=e.duration&&i.iterate()}}}}},91466:(e,t,i)=>{"use strict";i.d(t,{v:()=>Message});class Message{constructor(){this.msgId=-1}setID(e){if(-1!==this.msgId)throw Error("Message.msgId can only be set once.");this.msgId=e}}},63432:(e,t,i)=>{"use strict";i.d(t,{Q:()=>a,Y:()=>MessageBus});var n=i(90933),s=i(88512),r=i(44283);const o=new s.Z("message-bus");var a;!function(e){e[e.PERMANENT=0]="PERMANENT",e[e.ONCE=1]="ONCE"}(a||(a={}));class MessageBus{constructor(){this.typeLookup=new n.cj,this.callbacks={},this.messageQueue=[],this.messageCount=0}subscribe(e,t,i=a.PERMANENT){return(0,r.k1)((()=>this._subscribe(e,t,i)),(()=>this.unsubscribe(e,t)),!0,(0,n.HS)(e))}_subscribe(e,t,i=a.PERMANENT){const n=this.typeLookup.getKeyByType(e,!0);this.callbacks[n]||(this.callbacks[n]=[]),this.callbacks[n].push({type:i,callback:t})}unsubscribe(e,t){const i=this.typeLookup.getKeyByType(e);i?this.unsubscribeByIndex(i,t):o.debug(`Message callback not bound for Type: ${e.name}`)}unsubscribeByIndex(e,t){const i=this.callbacks[e].findIndex((e=>e.callback===t));-1!==i?this.callbacks[e].splice(i,1):o.debug(`Message callback not bound for TypeIndex: ${e}`)}broadcast(e){if(e.setID(this.messageCount++),this.messageQueue.push(e),1===this.messageQueue.length){for(const e of this.messageQueue){const t=this.typeLookup.getKeyByInstance(e);if(!t)continue;const i=this.callbacks[t].slice();for(const n of i)n.callback(e),n.type===a.ONCE&&this.unsubscribeByIndex(t,n.callback)}this.messageQueue=[]}}}},47724:(e,t,i)=>{"use strict";i.d(t,{Y:()=>Module});var n=i(88512);class Module{constructor(){this.bindings=[]}init(e,t){return Promise.resolve()}onUpdate(e){}dispose(e){for(const e of this.bindings)e.cancel();this.bindings=[]}get log(){return this._logger||(this._logger=new n.Z(this.name||"module")),this._logger}}},84561:(e,t,i)=>{"use strict";i.d(t,{o:()=>RenderLayers});class RenderLayer{constructor(e){this._mask=e}get mask(){return this._mask}addLayers(e){this._mask|=e.mask}removeLayers(e){return this._mask&=~e.mask}clone(){return new RenderLayer(this._mask)}}class RenderLayers{constructor(){this.layerRegistry=[],this.unusedLayers=[];for(let e=1;e<32;e++)this.unusedLayers.push(e)}static get ALL(){return new RenderLayer(-1)}static get NONE(){return new RenderLayer(0)}static get DEFAULT(){return new RenderLayer(1)}claimLayer(e){const t=this.getLayer(e);if(t.mask)return t;if(0===this.unusedLayers.length)throw Error("All render layers have already been claimed");const i=this.unusedLayers[0];return this.layerRegistry[i]=e,this.unusedLayers.shift(),new RenderLayer(1<<i)}getLayer(e){const t=this.layerRegistry.indexOf(e);return-1!==t?new RenderLayer(1<<t):RenderLayers.NONE}disposeLayer(e){const t=this.layerRegistry.indexOf(e);-1!==t&&this.unusedLayers.push(t)}}},90933:(e,t,i)=>{"use strict";i.d(t,{z$:()=>n,oL:()=>s,HS:()=>r,cj:()=>TypeLookup});const n=e=>e.prototype.constructor.name,s=e=>e.constructor,r=e=>{if("string"==typeof e)return e;if(e&&e.name)return e.name;const t=e.toString();return t.substring(0,t.indexOf("\n")).split(" ")[1]};class TypeLookup{constructor(){this.typeLookupMap={}}getKey(e){return"string"==typeof e?e:e.name}addType(e){if(!e)throw Error("Cannot index undefined type");const t=this.getKey(e);if(this.typeLookupMap[t])throw Error(`Type ${t} already registered`);return this.typeLookupMap[t]=e,t}getKeyByType(e,t){if(!e)throw Error("Cannot index undefined type");const i=this.getKey(e);let n=this.typeLookupMap[i];return!n&&t&&(n=e,this.addType(n)),n?i:""}getKeyByInstance(e,t){if(!e)throw Error("Cannot index undefined data");const i=e.constructor.name;let n=this.typeLookupMap[i];return!n&&t&&(n=e.constructor,this.addType(n)),n?i:""}getTypeByKey(e){const t=this.typeLookupMap[e];if(!t)throw Error("Key not found");if("string"==typeof t)throw Error("non type keyed result not supported");return t}getKnownTypes(){return Object.values(this.typeLookupMap)}}},84303:(e,t,i)=>{"use strict";var n;i.d(t,{A:()=>n}),function(e){e[e.Begin=0]="Begin",e[e.Logic=1]="Logic",e[e.Render=2]="Render",e[e.End=3]="End"}(n||(n={}))},51198:(e,t,i)=>{"use strict";i.d(t,{k:()=>PlayerMovedMessage});var n=i(91466);class PlayerMovedMessage extends n.v{constructor(e,t){super(),this.x=e,this.y=t}}},67790:(e,t,i)=>{"use strict";i.d(t,{a:()=>PlayerResizedMessage});var n=i(91466);class PlayerResizedMessage extends n.v{constructor(e,t){super(),this.width=e,this.height=t}}},21479:(e,t,i)=>{"use strict";i.d(t,{nh:()=>n,Mx:()=>s,pu:()=>ApplicationData,RU:()=>a});var n,s,r=i(32770),o=i(11321);!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WAITING=1]="WAITING",e[e.LOADING=2]="LOADING",e[e.STARTING=3]="STARTING",e[e.PLAYING=4]="PLAYING",e[e.ERROR=5]="ERROR"}(n||(n={})),function(e){e.UNKNOWN="unknown",e.WEBVR="webvr",e.SHOWCASE="showcase",e.WORKSHOP="workshop"}(s||(s={}));class ApplicationData extends r.V{constructor(e,t=s.UNKNOWN){super(),this.name="app",this.phase=e,this.application=t,this.phaseTimes=(0,o.$)({[n.UNINITIALIZED]:0,[n.WAITING]:0,[n.LOADING]:0,[n.STARTING]:0,[n.PLAYING]:0,[n.ERROR]:0}),this.error=null}getName(){return this.application.toString()}getVersion(){return"3.1.63.0-125-g1fd7fd3bed"}}const a=()=>new ApplicationData(n.UNINITIALIZED)},36822:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>AppPhaseModule});var n=i(47724),s=i(21479),r=i(8150),o=i(54073),a=i(97325);class AppPhaseModule extends n.Y{constructor(){super(...arguments),this.name="app-phase"}async init(e,t){this.market=t.market,this.broadcast=t.broadcast.bind(t),this.tasks=e.tasks,this.appState=(0,s.RU)(),this.appState.phase=s.nh.UNINITIALIZED,this.appState.phaseTimes[s.nh.UNINITIALIZED]=Date.now(),this.appState.application=s.Mx.SHOWCASE,this.market.register(this,s.pu,this.appState),this.watchTasks(this.appState.phase),this.watchErrors(),this.updateAppHeaders(),this.bindings.push(this.appState.onPropertyChanged("application",(()=>this.updateAppHeaders())))}async watchTasks(e){if(e>=s.nh.PLAYING)return;const t=e+1;try{await Promise.all(this.tasks[t])}catch(e){this.error(e)}t===s.nh.PLAYING&&this.broadcast(new r.pB(this.appState.application)),this.appState.phase!==s.nh.ERROR&&e!==s.nh.ERROR&&(this.updateCurrentPhase(t),this.watchTasks(t))}async watchErrors(){try{await Promise.all(this.tasks[s.nh.ERROR])}catch(e){this.error(e)}}updateCurrentPhase(e){this.appState.phase=e,this.appState.phaseTimes[e]=Date.now(),this.log.info(`${JSON.stringify(this.appState)}`),this.appState.commit(),this.broadcast(new r.LZ(e))}error(e){this.appState.error=e,this.updateCurrentPhase(s.nh.ERROR)}updateActiveApp(e){this.appState.application=e,this.appState.commit(),this.broadcast(new r.bS(e))}getData(){return this.appState}updateAppHeaders(){(0,o.l)(this.appState.getName()),(0,a.t)(this.appState.getVersion())}}},8150:(e,t,i)=>{"use strict";i.d(t,{LZ:()=>AppPhaseChangeMessage,bS:()=>ApplicationChangeMessage,pB:()=>ApplicationLoadedMessage});var n=i(91466);class AppPhaseChangeMessage extends n.v{constructor(e){super(),this.phase=e}}class ApplicationChangeMessage extends n.v{constructor(e){super(),this.application=e}}class ApplicationLoadedMessage extends n.v{constructor(e){super(),this.application=e}}},40918:(e,t,i)=>{"use strict";i.d(t,{l:()=>SdkObservable,W:()=>SdkObserver});class SdkObservable{constructor(e,t,i){this.dependencies=e,this.subscriptionFactory=t,this.observers=new Set,this.currentData=i.create(),this.freshDataCache=i.create()}static async create(e,t,i){const n=await e.getDependencies();return new SdkObservable(n,t,i)}getData(){return this.currentData.data}subscribe(e){return this.addObserver(e),new class ObserverSubscription{constructor(e){this.sdkObservable=e,this.renew()}renew(){this.sdkObservable.addObserver(e)}cancel(){this.sdkObservable.removeObserver(e)}}(this)}addObserver(e){if(!this.observers.has(e)){class SdkObservableFacade{constructor(e){this.observable=e}onChanged(){this.observable.onChanged()}}this.observers.add(e),1===this.observers.size&&(this.currentData.update(...this.dependencies),this.changeSubscription=this.subscriptionFactory.create(new SdkObservableFacade(this),...this.dependencies)),e.dirty=!0}}removeObserver(e){0!==this.observers.size&&(this.observers.delete(e),0===this.observers.size&&this.changeSubscription.cancel())}onChanged(){if(this.freshDataCache.update(...this.dependencies),!this.currentData.equals(this.freshDataCache)){this.currentData.copy(this.freshDataCache);for(const e of this.observers)e.dirty=!0}}}class SdkObserver{constructor(){this.dirty=!1}}},13377:(e,t,i)=>{"use strict";i.d(t,{I:()=>SdkData});var n=i(32770);class SdkData extends n.V{constructor(){super(...arguments),this.name="sdk",this.applicationKey=null}}},75083:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Sdk:()=>Sdk,default:()=>Sdk});var n,s,r=i(47724),o=i(13377),a=i(52363);!function(e){e.EMBED="sdk.embed",e.BUNDLE="sdk.bundle"}(n||(n={})),function(e){e.CONNECTION="sdk.connection",e.DISCONNECT="sdk.disconnect",e.MESSAGED="sdk.messaged",e.SUBSCRIBED="sdk.subscribed",e.UNSUBSCRIBED="sdk.unsubscribed",e.OBSERVABLE_SUB="sdk.obs.subscribe",e.OBSERVABLE_UNSUB="sdk.obs.unsubscribe",e.COLLECTION_SUB="sdk.coll.subscribe",e.COLLECTION_UNSUB="sdk.coll.unsubscribe"}(s||(s={}));class AnalyticsProxy{constructor(e,t){this.analytics=e,this.sdkType=t,this.trackedEvents=new a.X}track(e,t,i){this.trackedEvents.has(e,t)||(this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({sdkType:this.sdkType},i)))}alwaysTrack(e,t,i){this.trackedEvents.add(e,t),this.analytics.track(e,Object.assign({sdkType:this.sdkType},i))}}class ClientCallAnalyticsHandler{constructor(e,t){this.analytics=e,this.getApplicationKey=t,this.messageType="client call"}onMessage(e,t){const{namespace:i,name:n}=e,s={applicationKey:this.getApplicationKey(),namespace:i,name:n,method:t.communicationMethod};this.analytics.track("sdk_call",i+n,s)}}var l=i(64185);class IdGenerator{constructor(){this.usedIds=new Set,this.usedIds.add(0)}generate(){let e;do{e=Math.floor(1e6*Math.random())}while(this.usedIds.has(e));return this.usedIds.add(e),e}isInUse(e){return this.usedIds.has(e)}}var c,d=i(90939);!function(e){e.POSTMESSAGE="postmessage",e.DIRECT="direct",e.WEBSOCKET="websocket"}(c||(c={}));var h,u,p,m=i(3560);class PostMessageConnectHandler{constructor(e,t,i,n){this.hostWindow=e,this.hostId=t,this.idGenerator=i,this.connectionReceiver=n,this.inFlightClients=new Set,this.connectionHandler=new d.TY(t,new d.R9(window)),this.connectionHandler.addObserver(new m.OR({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){if(this.inFlightClients.has(t.id))return;e=e||{},this.inFlightClients.add(t.id);const i=e&&e.bootstrapVersion?this.idGenerator.generate():t.id,n=this.hostId,s=t.source,r=this.hostWindow,o=new d.l(n,r,i,s).createMessenger();this.connectionReceiver.onConnectionReceived(t.origin,e.options,{id:i,messenger:o,communicationMethod:c.POSTMESSAGE},{accept(e,t){o.send(new m.U7(e,t,i,n,window.location.origin))},handshake(){o.send(new m.RS)},reject(e){o.send(new m.HX(e)),o.dispose()}},e.applicationKey)}}class DirectConnectHandler{constructor(e,t,i){this.hostId=e,this.idGenerator=t,this.connectionReceiver=i,this.hostNode=new d.Ej(window.location.origin),this.connectionHandler=new d.TY(e,new d.tY(this.hostNode)),this.connectionHandler.addObserver(new m.OR({onConnectionReceived:(e,t)=>this.onConnectionReceived(e,t)}))}init(){this.connectionHandler.init()}dispose(){this.connectionHandler.dispose()}onConnectionReceived(e,t){const i=t.id,n=this.hostId,s=t.source,r=this.hostNode,o=s.origin,a=new d.UX(n,r,i,s).createMessenger(),l=new d.UX(n,r,i,s).createMessenger();this.connectionReceiver.onConnectionReceived(o,e.options,{id:i,messenger:a,communicationMethod:c.DIRECT},{accept(e,t){l.send(new m.U7(e,t,i,n,o)),l.dispose()},handshake(){l.send(new m.RS)},reject(e){l.send(new m.HX(e)),l.dispose()}})}connect(e,t){const i=this.idGenerator.generate(),n=this.hostId,s=new d.Ej(e),r=this.hostNode,o=new d.UX(i,s,n,r);return new Promise(((r,a)=>{const l=new d.UX(i,s,n,this.hostNode).createMessenger();l.init();const c=new class ConnectResponseHandler{accept(t,i,n,s,a){r({targetOrigin:e,sourceId:t,targetId:s,scriptUrl:i,serializedInterface:n,messengerFactory:o}),l.dispose()}reject(e){a(e),l.dispose()}};l.addObserver(new m.fE(c)),l.addObserver(new m.MJ(c)),l.send(new m.HE("direct",t))}))}}!function(e){e.EVENT="postmessage.event",e.RESPONSE="postmessage.response",e.OBSERVATION="postmessage.observation",e.COLLECTION_UPDATE="collection.updated",e.PRIVATE_MESSAGE="private.message"}(h||(h={})),function(e){e.ITEM_ADDED="collection.item.added",e.ITEM_REMOVED="collection.item.removed",e.ITEM_UPDATED="collection.item.updated",e.COLL_UPDATED="collection.coll.updated"}(u||(u={}));!function(e){e.DISCONNECT="sdk.client.disconnect",e.ACTION="postmessage.action",e.EVENT_SUB="postmessage.subscribe",e.EVENT_UNSUB="postmessage.unsubscribe",e.OBSERVABLE_SUB="postmessage.observe",e.OBSERVABLE_UNSUB="postmessage.unobserve",e.COLLECTION_SUB="collection.sub",e.COLLECTION_UNSUB="collection.unsub",e.PRIVATE_MESSAGE="private.message"}(p||(p={}));var f=i(51522);Math.PI;f.AR.Mode.DOLLHOUSE,new Float32Array(16);var g=i(40732);g.h.Success,f.kJ.AStarStatus.SUCCESS,g.h.NoPath,f.kJ.AStarStatus.NO_PATH,g.h.Timeout,f.kJ.AStarStatus.TIMEOUT;Symbol.iterator;var v;i(24344),i(94326);!function(e){e.map=new Map}(v||(v={}));i(60402);class ResponseMessage{constructor(e,t,i,n){this.type=h.RESPONSE,this.payload={uid:e,message:t,success:i,error:n}}}class EventMessage{constructor(e,t){this.type=h.EVENT,this.payload={eventType:e,eventData:t}}}class ObservationMessage{constructor(e,t){this.type=h.OBSERVATION,this.payload={observableKey:e,observableData:t}}}class CollectionItemAddedMessage{constructor(e,t,i,n){this.type=h.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class CollectionItemRemovedMessage{constructor(e,t,i){this.type=h.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i}}}class CollectionItemUpdatedMessage{constructor(e,t,i,n){this.type=h.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t,collectionIndex:i,item:n}}}class CollectionUpdatedMessage{constructor(e,t){this.type=h.COLLECTION_UPDATE,this.payload={operation:e,collectionKey:t}}}class PrivateMessage_PrivateMessage{constructor(e,t){this.type=h.PRIVATE_MESSAGE,this.payload={messageType:e,messagePayload:t}}}class FunctionCallMessageObserver{constructor(e,t){this.receiver=e,this.clientInfo=t,this.messageType=p.ACTION}notify(e){this.receiver.onActionReceived(e,this.clientInfo)}}class EventSubscribeMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.EVENT_SUB}notify(e){this.observer.onEventSubReceived(e,this.clientInfo)}}class EventUnsubscribeMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.EVENT_UNSUB}notify(e){this.observer.onEventUnsubReceived(e,this.clientInfo)}}class ObservableSubMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.OBSERVABLE_SUB}notify(e){this.observer.onObservableSubReceived(e,this.clientInfo)}}class ObservableUnsubMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.OBSERVABLE_UNSUB}notify(e){this.observer.onObservableUnsubReceived(e,this.clientInfo)}}class CollectionSubMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.COLLECTION_SUB}notify(e){this.observer.onCollectionSubReceived(e,this.clientInfo)}}class CollectionUnsubMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.COLLECTION_UNSUB}notify(e){this.observer.onCollectionUnsubReceived(e,this.clientInfo)}}class PrivateMessageObserver_PrivateMessageObserver{constructor(e,t){this.observer=e,this.clientInfo=t,this.messageType=p.PRIVATE_MESSAGE}notify(e){this.observer.onPrivateMessageReceived(e,this.clientInfo)}}var y=i(40918),b=i(96909);const S=new(i(88512).Z)("sdk");class Sdk extends r.Y{constructor(){super(...arguments),this.name="sdk",this.hostId=Math.floor(1e6*Math.random()),this.triedLoadingInterface=!1,this.connectionHandlers=[],this.clientInterface={functions:{},commands:{},enums:{},observables:{},collections:{}},this.clientConnections=new Map,this.eventToClientSubMap=new a.X,this.clientToEventSubMap=new a.X,this.observableToClientSubMap=new a.X,this.clientToObservableSubMap=new Map,this.collectionToClientSubMap=new a.X,this.clientToCollectionSubMap=new Map,this.privateMessageHandlers=new a.X,this.valueToClientInterface={},this.commandCreators={},this.commands={},this.asyncCommands={},this.observables={},this.collections={},this.firstTimeCollectionSubs=new a.X}async init(e,t){this.config=e,this.applicationKey=e.applicationKey,this.validationUrl=e.validationUrl,this.facade=new Sdk.MessengerHostFacade(this),this.clientIdGenerator=new IdGenerator,this.directConnectHandler=new DirectConnectHandler(this.hostId,this.clientIdGenerator,this.facade),this.connectionHandlers.push(new PostMessageConnectHandler(window,this.hostId,this.clientIdGenerator,this.facade),this.directConnectHandler),this.analytics=new AnalyticsProxy(await t.getModuleBySymbol(b.y.ANALYTICS),n.BUNDLE),this.clientFilter=e.clientFilter||(()=>!0),this.issueCommand=t.commandBinder.issueCommand.bind(t.commandBinder),this.interfacePromise=new l.Q,this.getClientScriptUrl=e.getClientScriptUrl,this.requestQueue=e.queue,this.data=new o.I,t.market.register(this,o.I,this.data),this.addPrivateMessageHandler(new ClientCallAnalyticsHandler(this.analytics,(()=>this.applicationKey))),this.enableHandshaking()}dispose(){for(const e of this.connectionHandlers)e.dispose();this.clearInterface()}connect(e,t={}){return this.directConnectHandler.connect(e,t)}enableHandshaking(){for(const e of this.connectionHandlers)e.init()}async setupInterface(){if(!this.triedLoadingInterface)try{this.triedLoadingInterface=!0,await this.config.setupExternalSdk(this),this.interfacePromise.resolve()}catch(e){this.interfacePromise.reject(e.message)}}clearInterface(){this.clientInterface.functions={},this.clientInterface.commands={},this.clientInterface.enums={},this.clientInterface.observables={},this.clientInterface.collections={},this.commandCreators={}}onUpdate(){for(const[,e]of this.clientToObservableSubMap)for(const[t,[i,n]]of e)i.dirty&&(this.notifyObservableUpdate(t,n.getData()),i.dirty=!1);for(const[,e]of this.clientToCollectionSubMap)for(const[t,[,i]]of e)i.dirty&&this.notifyCollectionUpdates(t,i.readDiff())}addCommandCreator(e,t){const i=this.getInterfaceIndex(e);this.clientInterface.functions.hasOwnProperty(i)&&S.debug(`Overwriting ${i} function in sdk interface`),this.clientInterface.functions[i]=e,this.commandCreators[i]=t}addEnumToInterface(e){const t=this.getInterfaceIndex(e);if(this.clientInterface.functions.hasOwnProperty(t)&&S.debug(`Overwriting ${t} enum in sdk interface`),this.clientInterface.enums[t]=Object.assign(Object.assign({},e),{values:Object.assign({},e.values)}),"Event"===e.name){const t=Object.keys(e.values);for(const i in t){this.valueToClientInterface;const n=e.values[t[i]];this.valueToClientInterface.hasOwnProperty(n)?S.warn(`Duplicate event detected for ${JSON.stringify(e)}`):this.valueToClientInterface[n]=e}}}async addCommandToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCommand(i,t),this.clientInterface.commands[i]=e}async addAsyncCommandToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCommand(i,t,!0),this.clientInterface.commands[i]=e}async addCommand(e,t,i=!1){this.clientInterface.commands.hasOwnProperty(e);const n=this;return i?(this.asyncCommands[e]=t,{dispose(){delete n.asyncCommands[e]}}):(this.commands[e]=await t,{dispose(){delete n.commands[e]}})}addObservableToInterface(e,t){const i=this.getInterfaceIndex(e);this.addObservable(i,t),this.clientInterface.observables[i]=Object.assign({},e)}addObservable(e,t){this.clientInterface.observables.hasOwnProperty(e),this.observables[e]=t;const i=this;return{dispose(){i.removeObservable(e)}}}removeObservable(e){var t;delete this.observables[e];for(const i of this.observableToClientSubMap.getValuesAtKey(e))null===(t=this.clientToObservableSubMap.get(i.id))||void 0===t||t.delete(e);this.observableToClientSubMap.removeKey(e)}addCollectionToInterface(e,t){const i=this.getInterfaceIndex(e);this.addCollection(i,t),this.clientInterface.collections[i]=Object.assign({},e)}addCollection(e,t){this.clientInterface.collections.hasOwnProperty(e),this.collections[e]=t;const i=this;return{dispose(){i.removeCollection(e)}}}removeCollection(e){var t;delete this.collections[e];for(const i of this.collectionToClientSubMap.getValuesAtKey(e))null===(t=this.clientToCollectionSubMap.get(i.id))||void 0===t||t.delete(e);this.collectionToClientSubMap.removeKey(e)}addPrivateMessageHandler(e){const{privateMessageHandlers:t}=this;return t.add(e.messageType,e),{dispose(){t.remove(e.messageType,e)}}}getInterfaceIndex(e){let t=`${e.name}`;return e.namespace&&(t=`${e.namespace}.${t}`),t}sendPrivateMessage(e,t){for(const[,i]of this.clientConnections)i.messenger.send(new PrivateMessage_PrivateMessage(e,t))}broadcast(e,t,i){for(const[,n]of this.clientConnections)if(t){const s=t(i);n.messenger.send(new EventMessage(e,s||[]))}else n.messenger.send(new EventMessage(e,[]))}notifyObservableUpdate(e,t){for(const i of this.observableToClientSubMap.getValuesAtKey(e))i.messenger.send(new ObservationMessage(e,t))}notifyCollectionUpdates(e,t){const{added:i,removed:n,updated:s}=t,r=i.size>0,o=n.size>0,a=s.size>0;for(const t of this.collectionToClientSubMap.getValuesAtKey(e)){const l=t.id;if(r)for(const[n,s]of i)t.messenger.send(new CollectionItemAddedMessage(u.ITEM_ADDED,e,n,s));if(o)for(const[i]of n)t.messenger.send(new CollectionItemRemovedMessage(u.ITEM_REMOVED,e,i));if(a)for(const[i,n]of s)t.messenger.send(new CollectionItemUpdatedMessage(u.ITEM_UPDATED,e,i,n));(r||o||a||this.firstTimeCollectionSubs.has(l,e))&&(t.messenger.send(new CollectionUpdatedMessage(u.COLL_UPDATED,e)),this.firstTimeCollectionSubs.remove(l,e))}}verifyConnection(e){const t={cache:!1,headers:{"X-Matterport-Application-Key":this.applicationKey,"X-Matterport-Referrer":e}};return this.requestQueue.get(this.validationUrl,t)}async onConnectionReceived(e,t,i,n,s){if(!this.clientFilter(e))return n.reject("Connection refused");this.applicationKey=s||this.applicationKey||null;try{await this.verifyConnection(e)}catch(e){return n.reject("key/referrer mismatch")}const r=async()=>{const s={enums:this.clientInterface.enums,functions:Object.assign(Object.assign({},this.clientInterface.functions),this.clientInterface.commands),observables:this.clientInterface.observables,collections:this.clientInterface.collections};this.config.onClientConnect(null==t?void 0:t.auth),this.onConnectionAccepted(e,i),n.accept(await this.getClientScriptUrl(),s)};n.handshake();try{await this.setupInterface(),await this.interfacePromise,await r(),this.data.atomic((()=>{this.data.applicationKey=this.applicationKey}))}catch(e){n.reject(e)}}onConnectionAccepted(e,t){const i=t.id,n=t.messenger,s={id:i,origin:e,communicationMethod:t.communicationMethod,messenger:n};this.clientConnections.set(i,s);const r=this.facade;n.addObserver(new FunctionCallMessageObserver(r,s)),n.addObserver(new EventSubscribeMessageObserver(r,s)),n.addObserver(new EventUnsubscribeMessageObserver(r,s)),n.addObserver(new ObservableSubMessageObserver(r,s)),n.addObserver(new ObservableUnsubMessageObserver(r,s)),n.addObserver(new CollectionSubMessageObserver(r,s)),n.addObserver(new CollectionUnsubMessageObserver(r,s)),n.addObserver(new PrivateMessageObserver_PrivateMessageObserver(r,s)),n.init(),this.trackSdkConnect(s)}onDisconnectReceived(e,t){const i=this.clientToEventSubMap.getValuesAtKey(t.id),n=this.clientToObservableSubMap.get(t.id)||[],s=this.clientToCollectionSubMap.get(t.id)||[];for(const e of i)this.eventToClientSubMap.remove(e,t);for(const[e]of n)this.observableToClientSubMap.remove(e,t);for(const[e]of s)this.collectionToClientSubMap.remove(e,t);this.clientToEventSubMap.removeKey(t.id),this.clientToObservableSubMap.delete(t.id),this.clientToCollectionSubMap.delete(t.id)}onActionReceived(e,t){if(this.tryActionThroughCommand(e,t))return;const i=this.commandCreators[e.targetFunction];i||t.messenger.send(new ResponseMessage(e.uid,{},!1,`${e.targetFunction} is not a valid command`)),this.trackSdkCall(e,t.id);try{this.issueCommand(i(e.params)).then((i=>t.messenger.send(new ResponseMessage(e.uid,i,!0,"")))).catch((i=>t.messenger.send(new ResponseMessage(e.uid,{},!1,i))))}catch(i){S.debug(i),t.messenger.send(new ResponseMessage(e.uid,{},!1,i.message))}}tryActionThroughCommand(e,t){if(this.tryActionThroughAsyncCommand(e,t))return!0;const i=this.commands[e.targetFunction];if(!i)return!!this.clientInterface.commands.hasOwnProperty(e.targetFunction)&&(t.messenger.send(new ResponseMessage(e.uid,{},!1,`${e.targetFunction} is not ready to be called`)),!0);this.trackSdkCall(e,t.id);try{i.exec(e.params,new ReturnObserver({onSuccess(i){t.messenger.send(new ResponseMessage(e.uid,i,!0,""))},onFail(i){t.messenger.send(new ResponseMessage(e.uid,{},!1,i))}}))}catch(i){S.debug(i),t.messenger.send(new ResponseMessage(e.uid,{},!1,i))}return!0}tryActionThroughAsyncCommand(e,t){const i=this.asyncCommands[e.targetFunction];return!!i&&(i.then((i=>{try{i.exec(e.params,new ReturnObserver({onSuccess(i){t.messenger.send(new ResponseMessage(e.uid,i,!0,""))},onFail(i){t.messenger.send(new ResponseMessage(e.uid,{},!1,i))}}))}catch(i){S.debug(i),t.messenger.send(new ResponseMessage(e.uid,{},!1,i))}})),!0)}onEventSubReceived(e,t){this.eventToClientSubMap.add(e.subscription,t),this.trackSdkEvent(s.SUBSCRIBED,e,t)}onEventUnsubReceived(e,t){this.eventToClientSubMap.remove(e.subscription,t),this.trackSdkEvent(s.UNSUBSCRIBED,e,t)}async onObservableSubReceived(e,t){const i=e.observableKey,n=this.observables[i];if(n){const r=await n;if(!this.observables[i])return;if(!this.observableToClientSubMap.has(i,t)){const n=new y.W,o=r.subscribe(n);this.observableToClientSubMap.add(i,t);const a=this.clientToObservableSubMap.get(t.id)||new Map;a.set(i,[n,r,o]),this.clientToObservableSubMap.set(t.id,a),this.trackClientObservableSub(s.OBSERVABLE_SUB,e,t)}}else S.error(i,"is not a valid, registered observable")}onObservableUnsubReceived(e,t){const i=e.observableKey;this.observableToClientSubMap.remove(i,t);const n=this.clientToObservableSubMap.get(t.id);if(n){const r=n.get(i);if(r){const[,,o]=r;o.cancel(),n.delete(i),this.trackClientObservableSub(s.OBSERVABLE_UNSUB,e,t)}}}async onCollectionSubReceived(e,t){const i=e.collectionKey,n=this.collections[i];if(n){const r=await n;if(!this.collections[i])return;if(!this.collectionToClientSubMap.has(i,t)){const n=r.subscribe(),o=[r,n];this.collectionToClientSubMap.add(i,t);const a=this.clientToCollectionSubMap.get(t.id)||new Map;a.set(i,o),this.clientToCollectionSubMap.set(t.id,a),this.firstTimeCollectionSubs.add(t.id,i),this.trackClientCollectionSub(s.COLLECTION_SUB,e,t)}}else S.error(i,"is not a valid, registered collection")}onCollectionUnsubReceived(e,t){const i=e.collectionKey;this.collectionToClientSubMap.remove(i,t);const n=this.clientToCollectionSubMap.get(t.id);if(n){const r=n.get(i);if(r){const[,o]=r;o.cancel(),n.delete(i),this.trackClientCollectionSub(s.COLLECTION_UNSUB,e,t)}}}onPrivateMessageReceived(e,t){const{messageType:i,messagePayload:n}=e;for(const e of this.privateMessageHandlers.getValuesAtKey(i))e.onMessage(n,t)}trackSdkConnect(e){if(!this.analytics)return;const t={origin:e.origin,applicationKey:this.applicationKey,method:e.communicationMethod};this.analytics.track("sdk_connect","connect",t)}trackSdkEvent(e,t,i){if(!this.analytics)return;const n=e===s.SUBSCRIBED?"on":"off",r=this.valueToClientInterface[t.subscription];if(!r)return;const o=Object.keys(r.values),a=o.find(((e,i)=>{const n=o[i];return r.values[n]===t.subscription}));if(!a)return;const l={origin:i.origin,applicationKey:this.applicationKey,name:n,namespace:r.namespace,eventType:a,count:this.eventToClientSubMap.valuesPerKey(t.subscription),method:i.communicationMethod};this.analytics.track("sdk_event",t.subscription,l)}trackSdkCall(e,t){const i=this.clientConnections.get(t);if(!i)return;const n=this.clientInterface.functions[e.targetFunction]||this.clientInterface.commands[e.targetFunction],s=Object.assign(Object.assign({origin:i.origin,applicationKey:this.applicationKey},n),{method:i.communicationMethod});this.analytics.track("sdk_call",e.targetFunction,s)}trackClientObservableSub(e,t,i){const n=e===s.OBSERVABLE_SUB,r=this.clientInterface.observables[t.observableKey],o=Object.assign(Object.assign({origin:i.origin,applicationKey:this.applicationKey},r),{is_collection:!1,action:n?"subscribe":"cancel",method:i.communicationMethod});this.analytics.track("sdk_subscribe",t.observableKey,o)}trackClientCollectionSub(e,t,i){const n=e===s.COLLECTION_SUB,r=this.clientInterface.collections[t.collectionKey],o=Object.assign(Object.assign({origin:i.origin,applicationKey:this.applicationKey},r),{is_collection:!0,action:n?"subscribe":"cancel",method:i.communicationMethod});this.analytics.track("sdk_subscribe",t.collectionKey,o)}}Sdk.MessengerHostFacade=class{constructor(e){this.messageHandler=e}onConnectionReceived(e,t,i,n,s){this.messageHandler.onConnectionReceived(e,t,i,n,s)}onDisconnectReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onDisconnectReceived(e,i)}onActionReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onActionReceived(e,i)}onEventSubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onEventSubReceived(e,i)}onEventUnsubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onEventUnsubReceived(e,i)}onObservableSubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onObservableSubReceived(e,i)}onObservableUnsubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onObservableUnsubReceived(e,i)}onCollectionSubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onCollectionSubReceived(e,i)}onCollectionUnsubReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onCollectionUnsubReceived(e,i)}onPrivateMessageReceived(e,t){const i=this.messageHandler.clientConnections.get(t.id);i&&this.messageHandler.onPrivateMessageReceived(e,i)}};class ReturnObserver{constructor(e){this.action=e}return(e){this.action.onSuccess(e)}throw(e){this.action.onFail(e)}}},55305:(e,t,i)=>{"use strict";var n;i.d(t,{F:()=>n}),function(e){e.UnitType="user_preference/unit_type",e.MeasurementSnapping="user_preference/measurement_snapping",e.MeasurementContinuousLines="user_preference/measurement_continuous",e.MeasurementUserNudgeSeen="user_preference/measurement_nudge",e.HighlightReelSettingsTab="user_preference/highlight_reel_settings_tab",e.NotesModeNudgeSeen="user_preference/notes_mode_nudge",e.NotesAddNudgeSeen="user_preference/notes_add_nudge",e.NotesIntroModalSeen="user_preference/notes_intro_seen",e.LastRatingPromptTime="user_preference/model_rating_last_prompt_time",e.TagsAddNudgeSeen="user_preference/tags_add_nudge"}(n||(n={}))},10882:(e,t,i)=>{"use strict";i.d(t,{u:()=>SettingsToggler});class SettingsToggler{constructor(e,t){this.settingsData=e,this.settings=t,this.cache={},this.toggle=e=>{e?this.apply():this.reset()}}apply(){this.cache={};for(const e of Object.keys(this.settings)){const t=this.settingsData.tryGetProperty(e,void 0);t!==this.settings[e]&&(this.cache[e]=t,this.settingsData.setProperty(e,this.settings[e]))}}reset(){for(const e of Object.keys(this.cache)){const t=this.cache[e];this.settingsData.setProperty(e,void 0!==t&&t)}this.cache={}}}},33874:(e,t,i)=>{"use strict";i.d(t,{e:()=>SettingsData});var n=i(32770),s=i(64781),r=i(98612);class SettingsData extends n.V{constructor(){super(...arguments),this.name="settings",this.properties=(0,s.q)()}setProperty(e,t){const i=this.properties.get(e);null!=t&&i===t||(this.properties.set(e,t),this.commit([e]))}notifyPropertyObserver(e,t){e(this.properties.get(t))}setLocalStorageProperty(e,t){(0,r.m8)(e,t),this.setProperty(e,t)}hasProperty(e){return this.properties.has(e)}tryGetProperty(e,t){return this.hasProperty(e)?this.properties.get(e):t}getProperty(e){if(this.hasProperty(e))return this.properties.get(e);throw new Error("SettingsData: "+e+" not found")}checkUrlParam(e,t,i=0){const n=this.tryGetProperty(e,i);return"number"==typeof n?n===t:parseInt(n,10)===t}iterate(e){for(const t of this.properties.keys)e(t,this.getProperty(t))}}},43993:(e,t,i)=>{"use strict";i.r(t),i.d(t,{SettingPersistence:()=>a,default:()=>SettingsModule});var n,s=i(2212),r=i(10757),o=i(64185);!function(e){e[e.Init=0]="Init",e[e.Loading=1]="Loading",e[e.Loaded=2]="Loaded"}(n||(n={}));class SettingsGUI{constructor(e){this.onChange=e,this.settings={},this.helperObject={colors:{},vectors:{},quaternions:{}},this.initPromise=new o.Q,this.loadState=n.Init,this.uninitError="ControlKit not yet initialized",this.lastKeys=[],this.lastKeysBufferLength=0,this.controlKit=void 0,this.updateRequired=!1,this.panels=[],this.onToggleCallbacks={},this.onKeyDown=e=>{this.lastKeys.unshift(e.keyCode),this.lastKeys.length>this.lastKeysBufferLength&&this.lastKeys.pop();for(let e=0;e<this.panels.length;e++){const t=this.panels[e].activationSequence;(0,r.Jq)(this.lastKeys,t)&&this.toggle(e)}},this.getPanelId=e=>{for(const t of this.panels)if(e===t.header)return t.index;return-1},this.getSubGroup=(e,t)=>{const i=this.panels[e];if(i.guiPanel||(i.guiPanel=i.makeGuiPanel()),!i.allowSubGroups)return i.guiPanel;let n=i.subGroups[t];return n||(n=i.guiPanel.addSubGroup({label:t,enable:!1}),i.subGroups[t]=n),n},this.addColor=(e,t,i,n)=>{this.updateHelperObject(t+i,n),e.addColor(this.helperObject.colors,t+i,{label:i,colorMode:"hex",onChange:e=>{this.settings[t+i].setHex(parseInt(e.substring(1),16));const n={};n[i]=this.settings[t+i],this.onChange(n)}})},this.addVector3=(e,t,i,n)=>{this.updateHelperObject(i,n);const r=e.addSubGroup({label:i}),o=["x","y","z"];for(const e in o)r.addNumberInput(this.helperObject.vectors[t+i],o[e],{label:o[e],onChange:()=>{this.settings[t+i]=new s.Vector3(this.helperObject.vectors[i].x,this.helperObject.vectors[i].y,this.helperObject.vectors[i].z);const e={};e[i]=this.settings[t+i],this.onChange(e)}})},this.addQuaternion=(e,t,i,n)=>{this.updateHelperObject(i,n);const r=e.addSubGroup({label:i}),o=["x","y","z","w"];for(const e in o){const n=i+o[e];r.addNumberInput(this.helperObject.quaternions[t+i],n,{label:o[e],onChange:()=>{this.settings[t+i]=new s.Quaternion(this.helperObject.quaternions[t+i].x,this.helperObject.quaternions[t+i].y,this.helperObject.quaternions[t+i].z,this.helperObject.quaternions[t+i].w);const e={};e[i]=this.settings[t+i],this.onChange(e)}})}}}init(){}async loadGuiPackage(){return this.loadState===n.Init&&(i.e(66).then(i.t.bind(i,94810,23)).then((e=>{const t=document.createElement("div");t.id="controlKitElement",(document.getElementById("control-kit-wrapper")||document.body).appendChild(t);const i=e=>e.stopPropagation();t.addEventListener("keydown",i),t.addEventListener("keyup",i),t.addEventListener("keypress",i),this.controlKit=new e.default({opacity:.9,enable:!1,parentDomElementId:"controlKitElement"}),this.controlKit.setShortcutEnable(""),this.controlKit.enable(),this.initPromise.resolve(),this.loadState=n.Loaded})),this.loadState=n.Loading),this.loadPromise}get loadPromise(){return this.initPromise.nativePromise()}get isLoaded(){return void 0!==this.controlKit}addPanel(e,t,i={}){for(void 0===i.width&&(i.width=250),void 0===i.allowSubGroups&&(i.allowSubGroups=!0),void 0===i.ratio&&(i.ratio=60),this.lastKeysBufferLength=Math.max(this.lastKeysBufferLength,t.length);this.lastKeysBufferLength>this.lastKeys.length;)this.lastKeys.unshift(-1);return this.panels.push({index:this.panels.length,header:e,guiPanel:null,makeGuiPanel:()=>this.controlKit.addPanel({label:e,align:"right",ratio:i.ratio,width:i.width}),subGroups:[],allowSubGroups:i.allowSubGroups,activationSequence:t.reverse()}),this.panels.length-1}isVisible(e){if(!this.controlKit)throw new Error(this.uninitError);return this.panels[e].guiPanel._enabled}toggle(e){this.controlKit?this.toggleVisibility(e):this.loadGuiPackage().then((()=>{this.toggleVisibility(e)}))}onToggle(e,t){this.onToggleCallbacks[e]||(this.onToggleCallbacks[e]=[]),this.onToggleCallbacks[e].push(t)}toggleVisibility(e){if(!this.controlKit)throw new Error(this.uninitError);const t=this.panels[e].guiPanel._enabled;if(t?this.panels[e].guiPanel.disable():this.panels[e].guiPanel.enable(),this.onToggleCallbacks[e])for(const i of this.onToggleCallbacks[e])i(!t)}dispose(){const e=document.getElementById("controlKit");e&&e.remove(),this.controlKit=void 0}activate(e){window.addEventListener("keydown",this.onKeyDown)}deactivate(e){this.controlKit&&this.controlKit.disable(),window.removeEventListener("keydown",this.onKeyDown)}render(){this.controlKit&&this.updateRequired&&(this.updateRequired=!1,this.controlKit.update())}updateSetting(e,t,i){if(!this.controlKit)throw new Error(this.uninitError);const n=e+t,s=this.settings[n];i&&"function"==typeof i.equals&&"function"==typeof i.copy&&s&&"function"==typeof s.equals&&"function"==typeof s.copy?i.equals(this.settings[n])||(this.settings[n].copy(i),this.updateHelperObject(n,i),this.updateRequired=!0):i!==this.settings[e+t]&&(this.settings[n]=i,this.updateRequired=!0)}getSetting(e,t){return this.settings[e+t]}isRegistered(e,t){return void 0!==this.settings[e+t]}addControl(e,t,i,n,r,o=2,a){if(!this.controlKit)throw new Error(this.uninitError);const l=this.getSubGroup(e,t),c=`${e}${i}`;this.settings[c]=n;let d=typeof n;if(("string"===d&&"true"===n||"false"===n)&&(d="boolean"),n instanceof s.Color)this.addColor(l,e,i,n);else if(n instanceof s.Vector3)this.addVector3(l,e,i,n);else if(n instanceof s.Quaternion)this.addQuaternion(l,e,i,n);else switch(d){case"string":Array.isArray(a)?(this.settings[c]={options:a,selected:n},l.addSelect(this.settings[c],"options",{target:"selected",label:i,onChange:e=>{const t={[i]:a[e]};this.onChange(t)}})):l.addStringInput(this.settings,e+i,{label:i,onChange:t=>{const n={};this.settings[e+i]=t,n[i]=this.settings[e+i],this.onChange(n)}});break;case"number":this.settings[`${e+i}_range`]=r||[0,10],l.addSlider(this.settings,e+i,`${e+i}_range`,{label:i,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)},dp:o});break;case"boolean":l.addCheckbox(this.settings,e+i,{label:i,ratio:10,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}});break;default:l.addStringOutput(this.settings,e+i,{label:i})}}addButton(e,t,i,n){if(!this.controlKit)throw new Error(this.uninitError);this.getSubGroup(e,t).addButton(i,n,{label:"none",ratio:100})}addSlider(e,t,i,n,s,r,o){if(!this.controlKit)throw new Error(this.uninitError);const a=this.getSubGroup(e,t);this.settings[e+i]=n,this.settings[e+i+"_range"]=[s,r],a.addSlider(this.settings,e+i,e+i+"_range",{label:i,dp:o,onChange:()=>{const t={};t[i]=this.settings[e+i],this.onChange(t)}})}updateHelperObject(e,t){t instanceof s.Color?this.helperObject.colors[e]="#"+t.getHexString():t instanceof s.Vector3?(this.helperObject.vectors[e]={},this.helperObject.vectors[e].x=t.x,this.helperObject.vectors[e].y=t.y,this.helperObject.vectors[e].z=t.z):t instanceof s.Quaternion&&(this.helperObject.quaternions[e]={},this.helperObject.quaternions[e].x=t.x,this.helperObject.quaternions[e].y=t.y,this.helperObject.quaternions[e].z=t.z,this.helperObject.quaternions[e].w=t.w)}}var a,l=i(47724),c=i(33874),d=i(60771),h=i(98612),u=i(17597);function p(e){if(""===e)return e;const t=+e;return isNaN(t)?e:t}!function(e){e[e.NONE=0]="NONE",e[e.LOCAL_STORAGE=1]="LOCAL_STORAGE"}(a||(a={}));class SettingsModule extends l.Y{constructor(){super(...arguments),this.name="settings",this.queuedControls=[],this.queuedButtons=[],this.secretWord=[38,38,40,40,37,39,37,39,66,65,72],this.panelID=-1,this.addPanel=(e,t,i)=>{const n=this.getPanelId(e);return-1===n?this.settingsGUI.addPanel(e,t,i):n},this.getPanelId=e=>this.settingsGUI.getPanelId(e)}async init(e,t){this.engine=t,this.settings=new c.e,this.engine.market.register(this,c.e,this.settings),e.useGUI&&(this.settingsGUI=new SettingsGUI((e=>{this.updateSettings(e)})),t.addComponent(this,this.settingsGUI),this.panelID=this.settingsGUI.addPanel("3.1.63.0-125-g1fd7fd3bed",this.secretWord));(0,u.kD)().forEach(((t,i)=>{let n=t;"string"==typeof n&&(n=p(n)),this.settings.setProperty(i,n),e.useGUI&&this.queuedControls.push({panelId:this.panelID,group:"Engine Config",settingName:i,value:n})})),e.useGUI&&this.settingsGUI.loadPromise.then((()=>{for(const e of this.queuedControls)this.settingsGUI.addControl(e.panelId,e.group,e.settingName,e.value,e.range,e.rangePrecision,e.options);for(const e of this.queuedButtons)this.settingsGUI.addButton(e.panelId,e.group,e.buttonName,e.callback);this.settingsGUI.toggle(this.panelID)}))}get settingsData(){return this.settings}get loadPromise(){return this.settingsGUI.loadPromise}getSettingsGui(){return this.settingsGUI}getMainPanelId(){return this.panelID}updateSetting(e,t,i=this.panelID){t&&t.clone&&"function"==typeof t.clone?this.settings.setProperty(e,t.clone()):this.settings.setProperty(e,t),this.settingsGUI&&this.settingsGUI.isLoaded&&this.settingsGUI.updateSetting(i,e,t)}updateSettings(e){for(const t in e)this.updateSetting(t,e[t])}registerSetting(e,t,i,n=!0,s=a.NONE,r,o=this.panelID,l=2,c){if(this.settingsGUI&&this.settingsGUI.isRegistered(o,t))return void this.log.warn(`Duplicate setting ${t} registered. Is a module being used twice?`);let d;d=i&&i.clone&&"function"==typeof i.clone?i.clone():i,this.settingsGUI&&n&&(this.settingsGUI.isLoaded?this.settingsGUI.addControl(o,e,t,d,r,l,c):this.queuedControls.push({panelId:o,group:e,settingName:t,value:i,range:r,rangePrecision:l,options:c}));const u=s===a.LOCAL_STORAGE?(0,h.fp)(t,i):i;this.updateSetting(t,u)}registerMenuEntry(e){const{header:t,setting:i,initialValue:n,persist:s,displayInUi:r,range:o,panel:a,onChange:l,rangePrecision:c,options:h,urlParam:m}=e;let f=n();const g=encodeURIComponent(i);if(m){const e=(0,u.eY)(g,null);null!==e&&(f="true"===e||"false"!==e&&p(e))}if(this.registerSetting(t,i,f,r,s,o,a,c,h),!l&&!m)return null;if(l&&l(f),m){const e=n(),t=t=>{const i=(0,u.kD)();i.has(g)&&t===e?i.delete(g):i.set(g,t),(0,d.Vf)(i.toString(),!0),l&&l(t)};return this.settings.onPropertyChanged(i,t)}return l?this.settings.onPropertyChanged(i,l):null}registerMenuButton(e){const{header:t,buttonName:i,panel:n,callback:s}=e;this.registerButton(t,i,s,n)}registerButton(e,t,i,n=this.panelID){this.settingsGUI&&(this.settingsGUI.isLoaded?this.settingsGUI.addButton(n,e,t,i):this.queuedButtons.push({panelId:n,group:e,buttonName:t,callback:i}))}hasProperty(e){return this.settings.hasProperty(e)}getProperty(e){return this.settings.getProperty(e)}tryGetProperty(e,t){return this.settings.tryGetProperty(e,t)}toggleMenu(){this.settingsGUI&&this.settingsGUI.toggle(0)}disposeGui(){this.settingsGUI.dispose()}}},39729:(e,t,i)=>{"use strict";var n;i.d(t,{E:()=>n}),function(e){e[e.Immediate=0]="Immediate",e[e.NextFrame=1]="NextFrame",e[e.Duration=2]="Duration",e[e.Manual=3]="Manual"}(n||(n={}))},71194:(e,t,i)=>{"use strict";i.d(t,{KI:()=>n,AQ:()=>ChangeRecord,Z8:()=>CollectionMonitor});var n,s=i(14063),r=i(39729),o=i(84303);!function(e){e.added="added",e.removed="removed",e.updated="updated"}(n||(n={}));class ChangeRecord{constructor(e,t,i){this.index=e,this.action=t,this.diff=i}}class CollectionMonitor{constructor(e,t){if(this.changedHandlers=[],this.awaitingInvoke=!1,this.diffRecord=[],this.targetMonitors={},this.triggerChangeHandlers=this.invokeChangeHandlers.bind(this),this.config=e,this.updatePhaseSync=t,this.config.aggregationType===r.E.NextFrame){if(!t)throw Error("UpdatePhaseSync required for NextFrame aggregation")}else if(this.config.aggregationType===r.E.Duration)throw Error("Aggregation Type not implemented")}hasDiffRecord(){return this.diffRecord.length>0}clearDiffRecord(){this.diffRecord=[];for(const e in this.targetMonitors){const t=this.targetMonitors[e];t.hasDiffRecord()&&t.clearDiffRecord()}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,s.b)(this.changedHandlers,e)}invokeCallbacks(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}invokeChangeHandlers(e){switch(this.config.aggregationType){case r.E.Immediate:this.invokeCallbacks(e);break;case r.E.NextFrame:this.awaitingInvoke||(this.awaitingInvoke=!0,this.updatePhaseSync.after(o.A.End).then((()=>{this.awaitingInvoke=!1,this.invokeCallbacks(e)})));break;case r.E.Manual:}}}},57361:(e,t,i)=>{"use strict";i.d(t,{c:()=>MapMonitor});var n=i(71194),s=i(57938),r=i(85861);class MapMonitor extends n.Z8{constructor(e,t,i){super(t,i),this.target=e;for(const n of e.keys){const r=e.get(n),o=new s.u(r,t,i);o.onChanged(this.triggerChangeHandlers),this.targetMonitors[n]=o}const o={onAdded:(e,o)=>{const a=new s.u(e,t,i);a.onChanged(this.triggerChangeHandlers),this.targetMonitors[o]=a;const l=this.diffRecord.findIndex((e=>e.index===o));-1!==l&&this.diffRecord.splice(l,1);const c=new n.AQ(o,n.KI.added,(0,r.p$)(e));-1===l&&this.diffRecord.push(c),this.triggerChangeHandlers(c)},onRemoved:(e,t)=>{delete this.targetMonitors[t];const i=this.diffRecord.findIndex((e=>e.index===t));-1!==i&&this.diffRecord.splice(i,1);const s=new n.AQ(t,n.KI.removed,(0,r.p$)(e));-1===i&&this.diffRecord.push(s),this.triggerChangeHandlers(s)}};this.target.onElementChanged(o)}commitChanges(){this.invokeCallbacks(this.getDiffRecord())}getDiffRecord(){const e=[];for(const t in this.targetMonitors){const i=this.targetMonitors[t];if(i.hasDiffRecord()){const s=i.getDiffRecord(),o=this.diffRecord.findIndex((e=>e.index===t));-1!==o?(0,r.TS)(this.diffRecord[o].diff,s):e.push(new n.AQ(t,n.KI.updated,s))}}return this.diffRecord.concat(e)}}},57938:(e,t,i)=>{"use strict";i.d(t,{u:()=>Monitor});var n=i(39729),s=i(85861),r=i(84303),o=i(14063);class Monitor{constructor(e,t,i){this.updatePhaseSync=i,this.target=e,this.clearDiffRecord(),this.target.onChanged((()=>{this.diffRecord=(0,s.br)(this.originalData,(0,s.p$)(this.target),t.shallow),this.handleAggregation()})),this.aggregationType=t.aggregationType,this.changedHandlers=[]}hasDiffRecord(){return Object.keys(this.diffRecord).length>0}getDiffRecord(){return this.diffRecord}clearDiffRecord(){this.originalData=(0,s.p$)(this.target),this.diffRecord={}}onChanged(e){this.changedHandlers.push(e)}removeOnChanged(e){(0,o.b)(this.changedHandlers,e)}commitChanges(){this.triggerChangeHandlers(this.diffRecord)}handleAggregation(){switch(this.aggregationType){case n.E.Immediate:this.triggerChangeHandlers(this.diffRecord);break;case n.E.NextFrame:if(!this.updatePhaseSync)throw new Error("handleAggregation() -> Next frame aggregation requested, but updatePhaseSync is null");this.nextFramePromise||(this.nextFramePromise=this.updatePhaseSync.after(r.A.Begin).then((()=>{this.triggerChangeHandlers(this.diffRecord)})).finally((()=>{this.nextFramePromise=void 0})));break;case n.E.Duration:throw new Error("AggregationType.Duration: Please implement me :)");case n.E.Manual:}}triggerChangeHandlers(e){if(this.changedHandlers.length>0)for(const t of this.changedHandlers)t(e)}}},66209:(e,t,i)=>{"use strict";i.d(t,{y:()=>Observable});var n=i(44283);class Observable{constructor(){this.isObservable=!0,this._dirtyObservable=!1,this._activeObservable=!0,this._observerNotifying=!1,this._changeObservers=new Set,this._parentObservables=new Set,this._childObservables=new Set,Object.defineProperties(this,{isObservable:{value:this.isObservable,writable:!1,enumerable:!1},_dirtyObservable:{value:this._dirtyObservable,enumerable:!1},_activeObservable:{value:this._activeObservable,enumerable:!1},_observerNotifying:{value:this._observerNotifying,enumerable:!1},_changeObservers:{value:this._changeObservers,writable:!1,enumerable:!1},_childObservables:{value:this._childObservables,writable:!1,enumerable:!1},_parentObservables:{value:this._parentObservables,writable:!1,enumerable:!1}})}onChanged(e){if(this._changeObservers.has(e))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,n.k1)((()=>this._changeObservers.add(e)),(()=>this.removeOnChanged(e)),!0)}removeOnChanged(e){this._changeObservers.delete(e)}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._changeObservers)this.notifyObserver(e);this._dirtyObservable=!1,this._observerNotifying=!1}}notifyObserver(e){e(void 0)}notifyDown(){for(const e of this._childObservables)e.notifyDown();this.notifyObservers()}notifyUp(){for(const e of this._parentObservables)e.notifyUp();this.notifyObservers()}setDirty(e=!0){this.setDirtyUp(),e&&this.notifyUp()}setDirtyUp(){if(!this._dirtyObservable){this._dirtyObservable=!0;for(const e of this._parentObservables)e.setDirtyUp()}}addChildObservable(e){Observable.isObservable(e)&&(this._childObservables.add(e),e._parentObservables.add(this))}removeChildObservables(e){Observable.isObservable(e)&&(this._childObservables.delete(e),e._parentObservables.delete(this))}atomic(e){if(!this._activeObservable)return e();try{this.setActive(!1),e()}finally{this.setActive(!0)}}setActive(e){const t=this._activeObservable;this._activeObservable=e,!t&&e&&this.notifyObservers();for(const t of this._childObservables)t.setActive(e)}deepCopy(){throw Error("deepCopy is only implemented in subclasses of Observable")}static isObservable(e){return e&&e.isObservable}}},75256:(e,t,i)=>{"use strict";i.d(t,{d:()=>ObservableArray,C:()=>r});var n=i(66209),s=i(85861);class ObservableArray extends n.y{constructor(){super(),this.isObservableArray=!0,this.elements=[]}push(e){return this.elements.push(e),this.addChildObservable(e),this.setDirty(),this.length}concat(e){const t=this.elements.length;this.elements=this.elements.concat(e);for(let e=t;e<this.elements.length;e++)this.addChildObservable(this.elements[e]);return this.setDirty(),this.length}replace(e){for(const e of this.elements)this.removeChildObservables(e);return this.elements=[],this.concat(e)}remove(e){if(e<0||e>=this.length)throw new Error(`Index ${e} not in range of ObservableArray`);const[t]=this.elements.splice(e,1);this.removeChildObservables(t),this.setDirty()}update(e,t){const i=this.elements[e];i!==t&&(this.elements[e]=t,this.removeChildObservables(i),this.addChildObservable(t),this.setDirty())}get length(){return this.elements.length}set length(e){if(e<this.elements.length){for(let t=this.elements.length-1;t>=e;t--){const e=this.elements[t];this.removeChildObservables(e)}this.elements.length=e,this.setDirty()}}values(){return[...this.elements]}filter(e){return this.elements.filter(e)}find(e){return this.elements.find(e)}*[Symbol.iterator](){for(const e of this.elements)yield e}map(e){return this.elements.map(e)}forEach(e){this.elements.forEach(e)}sort(e){this.elements.sort(e)}get(e){return this.elements[e]}findIndex(e){return this.elements.findIndex(e)}indexOf(e){return this.elements.indexOf(e)}splice(e,t,...i){let n;if(i.length){n=this.elements.splice(e,t,...i);for(const e of i)this.addChildObservable(e)}else n=this.elements.splice(e,t);for(const e of n)this.removeChildObservables(e);return this.setDirty(),n}insert(e,t){if(e>this.elements.length)throw new Error(`Tried to insert at index ${e} in an array that's only ${this.elements.length} long`);e!==this.elements.length?(this.elements.splice(e,0,t),this.addChildObservable(t),this.setDirty()):this.push(t)}shift(){const e=this.elements.shift();return e&&(this.removeChildObservables(e),this.setDirty()),e}move(e,t){if(t>this.elements.length-1)throw Error("Index to move to is out of bounds");const i=this.elements[e];this.elements.splice(e,1),this.elements.splice(t,0,i),this.setDirty()}onElementChanged(e){let t=this.elements.slice();return this.onChanged((()=>{for(const i in t){const n=parseInt(i,10);e.onRemoved&&void 0===this.get(n)&&e.onRemoved(t[n],n)}for(const i in this.elements){const s=parseInt(i,10),r=this.get(s);void 0===t[s]?e.onAdded&&e.onAdded(r,s):(n.y.isObservable(r)&&r._dirtyObservable||r!==t[s])&&(e.onUpdated?e.onUpdated(r,s):e.onRemoved&&null===r&&e.onRemoved(t[s],s))}t=this.elements.slice()}))}deepCopy(){return this.map((e=>(0,s.p$)(e)))}}const r=e=>{const t=new ObservableArray;return e&&t.concat(e),t}},64781:(e,t,i)=>{"use strict";i.d(t,{v:()=>ObservableMap,q:()=>o});var n=i(66209),s=i(85861);function r(e){return(0,s.hj)(e)?""+e:e}class ObservableMap extends n.y{constructor(){super(),this.map={},this._keysSet=new Set,this._keysList=[]}get keys(){return this._keysList.slice()}get values(){return this._keysList.map((e=>this.get(e)))}entries(){const e=[];for(const t in this.map)e.push([t,this.map[t]]);return e}get length(){return this._keysList.length}*[Symbol.iterator](){for(const e of this._keysList)yield this.get(e)}get(e){return this.map[e]}has(e){return void 0!==this.map[e]}set(e,t){e=r(e);this.map[e]!==t&&(this.removeChildObservables(this.map[e]),this.addChildObservable(t),this.map[e]=t,this._keysSet.has(e)||(this._keysList.push(e),this._keysSet.add(e)),this.setDirty())}clear(){if(this.length>0){for(const e in this.map)this.removeChildObservables(this.map[e]);this.map={},this._keysSet.clear(),this._keysList=[],this.setDirty()}}delete(e){e=r(e),this.removeChildObservables(this.map[e]);const t=this.map.hasOwnProperty(e);return delete this.map[e],t&&(this._keysSet.delete(e),this._keysList.splice(this._keysList.indexOf(e),1),this.setDirty()),t}onElementChanged(e){let t=Object.assign({},this.map);return this.onChanged((()=>{for(const i in t)e.onRemoved&&!this.has(i)&&e.onRemoved(t[i],i);for(const i of this._keysList){const s=this.get(i);void 0===t[i]?e.onAdded&&e.onAdded(s,i):(n.y.isObservable(s)&&s._dirtyObservable||s!==t[i])&&(e.onUpdated&&null!==s?e.onUpdated(s,i):e.onRemoved&&null===s&&e.onRemoved(t[i],i))}t=Object.assign({},this.map)}))}deepCopy(){const e={};for(const t of this._keysList)e[t]=(0,s.p$)(this.map[t]);return e}}const o=(e={})=>{const t=new ObservableMap;for(const i in e)t.set(i,e[i]);return t}},23573:(e,t,i)=>{"use strict";i.d(t,{T:()=>ObservableObject});var n=i(66209),s=i(85861),r=i(17597),o=i(88512),a=i(44283);const l=new o.Z("ObservableObject"),c=1===(0,r.eY)("debug",0);class ObservableObject extends n.y{constructor(){super(),this._propertyObservables={},this._valueCache={},this._dirtyKeys=new Set,Object.defineProperties(this,{_propertyObservables:{value:this._propertyObservables,writable:!1,enumerable:!1},_valueCache:{value:this._valueCache,writable:!1,enumerable:!1},_dirtyKeys:{value:this._dirtyKeys,writable:!1,enumerable:!1}}),c&&setTimeout((()=>{!function(e){const t={};for(const i in e)e.hasOwnProperty(i)&&(t[i]=e[i],e._valueCache[i]=e[i],Object.defineProperty(e,i,{get:()=>t[i],set:s=>{const r=e._valueCache[i];(r!==s||n.y.isObservable(r)&&r._dirtyObservable)&&h(e,i),t[i]=s},enumerable:!0}))}(this)}),1)}onPropertyChanged(e,t){if(this._propertyObservables[e]||(this._propertyObservables[e]=[]),-1!==this._propertyObservables[e].indexOf(t))throw new Error("This observer function is already observing this Observable, and double subscriptions are not supported.");return(0,a.k1)((()=>this._propertyObservables[e].push(t)),(()=>this.removeOnPropertyChanged(e,t)),!0,e)}removeOnPropertyChanged(e,t){const i=this._propertyObservables[e].indexOf(t);i>=0&&this._propertyObservables[e].splice(i,1)}commit(e=[]){for(const t of e)this._dirtyKeys.add(t);this.setDirtyUp(),this.notifyUp()}setDirtyUp(){for(const e in this){if(!this.hasOwnProperty(e))continue;const t=this._valueCache[e],i=this[e],s=typeof i,r="undefined"===s||"string"===s||"number"===s||"boolean"===s||null===i;if(this._propertyObservables[e]&&!r&&!n.y.isObservable(i))throw new Error(`Property ${e} has property listeners, but has a value that is not observable or a primitive!`);t!==i?(this.removeChildObservables(t),this.addChildObservable(i),this._valueCache[e]=i,this._dirtyKeys.add(e)):n.y.isObservable(t)&&t._dirtyObservable&&this._dirtyKeys.add(e)}super.setDirtyUp()}notifyObservers(){if(this._dirtyObservable&&!this._observerNotifying&&this._activeObservable){this._observerNotifying=!0;for(const e of this._dirtyKeys){for(const t of this._propertyObservables[e]||[])this.notifyPropertyObserver(t,e);c&&u(this,e)}this._observerNotifying=!1,this._dirtyKeys.clear()}super.notifyObservers()}notifyPropertyObserver(e,t){e(this._valueCache[t])}notifyObserver(e){e(this)}deepCopy(){const e={};for(const t in this)this.hasOwnProperty(t)&&(e[t]=(0,s.p$)(this[t]));return e}}const d=new Map;function h(e,t){d.has(e)||d.set(e,{});d.get(e)[t]=Error()}function u(e,t){if(d.has(e)){const i=d.get(e);i[t]&&delete i[t]}}if(c){const e=setInterval((()=>{(function(){for(const e of d.values())for(const t in e)return l.error(`ObservableObject property "${t}" was still dirty after one tick! Did you forget a .commit()?`),l.error("See stack trace of the property write below:"),l.error(e[t].stack),!0;return!1})()&&void 0!==e&&clearInterval(e)}),16)}},11321:(e,t,i)=>{"use strict";i.d(t,{$:()=>l});var n=i(66209),s=i(48715),r=i(85861);function o(e,t){const i=Object.getOwnPropertyNames(t);for(const n of i)void 0===e[n]&&("function"==typeof t[n]?Object.defineProperty(e,n,{value:t[n].bind(e)}):Object.defineProperty(e,n,{value:t[n],writable:!0}));null!==Object.getPrototypeOf(Object.getPrototypeOf(t))&&o(e,Object.getPrototypeOf(t))}var a=i(23573);const l=e=>{if(!e||0===Object.keys(e).length)throw new Error("createObservableProxy() only works on objects that has predefined keys. Did you mean createObservableMap or createObservableArray?");if(e instanceof a.T)throw new Error("Using ObservableProxy on an ObservableObject is a BUG!");if(e.isObservableProxy)return e;const t={},i=new n.y,l=Object.create(e);Object.defineProperties(l,{isObservableProxy:{value:!0},onPropertyChanged:{value:(e,i)=>t[e].onChanged(i)},removeOnPropertyChanged:{value:(e,i)=>t[e].removeOnChanged(i)},deepCopy:{value:()=>(0,r.p$)(e)}}),o(l,i);for(const i in e)if(e.hasOwnProperty(i)){const n=(0,s.Y)(e[i]);t[i]=n,l.addChildObservable(n),Object.defineProperty(l,i,{get:()=>e[i],set:n=>{e[i]=n,t[i].value=n},enumerable:!0})}return Object.seal(l),l}},48715:(e,t,i)=>{"use strict";i.d(t,{f:()=>ObservableValue,Y:()=>r});var n=i(66209),s=i(85861);class ObservableValue extends n.y{constructor(e){super(),this.value=e}notifyObserver(e){e(this.value)}get value(){return this._value}set value(e){this._value!==e&&(this.removeChildObservables(this._value),this.addChildObservable(e),this._value=e,this.setDirty())}deepCopy(){return(0,s.p$)(this._value)}}const r=e=>new ObservableValue(e)},61255:(e,t,i)=>{"use strict";i.d(t,{$:()=>PureObservable});class PureObservable{constructor(){this.observers=new Set}observe(e){this.observers.add(e);const t=this;return{renew(){t.observers.add(e)},cancel(){t.removeObserver(e)}}}removeObserver(e){this.observers.delete(e)}notify(){for(const e of this.observers)e.notify()}}},17490:(e,t,i)=>{"use strict";i.d(t,{V:()=>AggregateSubscription});class AggregateSubscription{constructor(...e){this.subs=e}renew(){for(const e of this.subs)e.renew()}cancel(){for(const e of this.subs)e.cancel()}}},44283:(e,t,i)=>{"use strict";i.d(t,{gm:()=>Catalog,ne:()=>DataCatalog,k1:()=>s});const n=new(i(88512).Z)("Subscription");class Catalog{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){return new Subscription((()=>this.registerSubscription(e)),(()=>this.unregisterSubscription(e)),t)}getData(){return this.watchedData()}}class DataCatalog{constructor(e,t,i){this.watchedData=e,this.registerSubscription=t,this.unregisterSubscription=i}createSubscription(e,t){const i=()=>e(this.watchedData());return new Subscription((()=>this.registerSubscription(i)),(()=>this.unregisterSubscription(i)),t)}getData(){return this.watchedData()}}class Subscription{constructor(e,t,i=!1,n=""){this.startSubscription=e,this.endSubscription=t,this.id=n,this.isSubbed=!1,i&&this.renew()}renew(){this.isSubbed?n.debugWarn(`Duplicate subscription renew ${this.id}`):(this.startSubscription(),this.isSubbed=!0)}cancel(){this.isSubbed&&(this.endSubscription(),this.isSubbed=!1)}get active(){return this.isSubbed}}function s(e,t,i=!0,n=""){return new Subscription(e,t,i,n)}},85861:(e,t,i)=>{"use strict";i.d(t,{p$:()=>s,TS:()=>r,br:()=>o,NK:()=>a,hj:()=>l});const n=e=>"propertyObservers"===e||"changeObservers"===e||"isObservable"===e||"childChangeFunctions"===e||"isObservableProxy"===e||"diffRoot"===e||"elementChangedHandlers"===e||"knownKeysMap"===e||"knownKeysList"===e||"isVector2"===e||"isVector3"===e||"isQuaternion"===e||"onPropertyChanged"===e||"removeOnPropertyChanged"===e||"onChanged"===e||"target"===e,s=(e,t=[])=>{if(void 0!==e){if(e in t)return{};if(e instanceof Date)return new Date(e);if(null===e)return null;if(e.deepCopy)return e.deepCopy();if(e.isQuaternion)return{x:e.x,y:e.y,z:e.z,w:e.w};if("object"==typeof e){const i=Array.isArray(e)||ArrayBuffer.isView(e)?[]:{};for(const r in e){if(n(r))continue;const o=e[r];o instanceof Date?i[r]=new Date(o):"function"!=typeof o&&(i[r]="object"==typeof o?s(o,t.concat(e)):o)}return i}return e}},r=(e,t)=>{for(const i in t){if("function"==typeof t[i])continue;if(n(i)&&!e.hasOwnProperty(i))continue;const o=t[i];if(e.hasOwnProperty(i)){const t=e[i];(null===t?null:typeof t)!==(null===o?null:typeof o)?e[i]=s(o):"object"==typeof t?t instanceof Date?e[i]=new Date(o):r(t,o):e[i]=o}else e[i]=s(o)}},o=(e,t,i=!1)=>{const n={};for(const s in e){const r=e[s],l=t[s];a(r,l)&&(void 0===r||void 0===l||typeof r!=typeof l||"object"!=typeof r?n[s]=l:Array.isArray(l)?a(r,l)&&(n[s]=l):n[s]=i?l:o(r,l))}for(const i in t)i in e||(n[i]=t[i]);return n},a=(e,t)=>{if(null===e||"object"!=typeof e)return e!==t;if(!t)return!0;for(const i in t)if(!(i in e))return!0;for(const i in e)if(a(e[i],t[i]))return!0;return!1};function l(e){return"number"==typeof e}},15881:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){e.NOTE="note",e.COMMENT="comment",e.MATTERTAG="mattertag"}(n||(n={}))},87068:(e,t,i)=>{"use strict";i.d(t,{I:()=>Color});var n=i(2212);class Color{}Color.MP_BRAND=new n.Color("rgb(255, 49, 88)"),Color.MATTERTAG_BLUE=new n.Color("rgb(3, 104, 125)"),Color.WHITE=new n.Color("rgb(255, 255, 255)"),Color.BLACK=new n.Color("rgb(0, 0, 0)"),Color.RED=new n.Color(16711680),Color.GREEN=new n.Color(65280),Color.BLUE=new n.Color(255),Color.YELLOW=new n.Color(16776960)},48277:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_X=0]="GL_TEXTURE_CUBE_MAP_POSITIVE_X",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_X=1]="GL_TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Y=2]="GL_TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y=3]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.GL_TEXTURE_CUBE_MAP_POSITIVE_Z=4]="GL_TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z=5]="GL_TEXTURE_CUBE_MAP_NEGATIVE_Z"}(n||(n={}));const s=n},48358:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e[e.boundingSkybox=-100]="boundingSkybox",e[e.default=0]="default",e[e.ghostFloor=3]="ghostFloor",e[e.panoMarker=4]="panoMarker",e[e.reticule=5]="reticule",e[e.grid=5]="grid",e[e.meshTrims=5]="meshTrims",e[e.pins360=6]="pins360",e[e.portals=9]="portals",e[e.rotators=10]="rotators",e[e.pins=14]="pins",e[e.pinSelectedHalo=15]="pinSelectedHalo",e[e.lines=20]="lines",e[e.endpoints=21]="endpoints",e[e.labels=22]="labels",e[e.gizmos=23]="gizmos",e[e.colorOverlay=1e3]="colorOverlay"}(n||(n={}))},44574:(e,t,i)=>{"use strict";var n;i.d(t,{C:()=>n}),function(e){e.TEXT="text",e.LINK="link",e.HASH="hash",e.USER="user"}(n||(n={}))},12216:(e,t,i)=>{"use strict";i.d(t,{f:()=>Vectors,e:()=>n});var n,s=i(2212);class Vectors{}Vectors.UP=new s.Vector3(0,1,0),Vectors.DOWN=new s.Vector3(0,-1,0),Vectors.LEFT=new s.Vector3(-1,0,0),Vectors.RIGHT=new s.Vector3(1,0,0),Vectors.FORWARD=new s.Vector3(0,0,-1),Vectors.BACK=new s.Vector3(0,0,1),Vectors.ZERO=new s.Vector3(0,0,0),Vectors.UNIT=new s.Vector3(1,1,1),Vectors.HORIZONTAL_PLANE=new s.Vector3(1,0,1),function(e){e.NONE="NONE",e.UP="UP",e.DOWN="DOWN",e.LEFT="LEFT",e.RIGHT="RIGHT",e.FORWARD="FORWARD",e.BACK="BACK",e.ZERO="ZERO",e.UNIT="UNIT",e.HORIZONTAL_PLANE="HORIZONTAL_PLANE"}(n||(n={}))},31102:(e,t,i)=>{"use strict";i.d(t,{y:()=>BaseException});var n=i(61645);class BaseException extends Error{constructor(e,t){super(e instanceof Error?e.message:e),this.name="BaseException",t&&(this.code=t),e instanceof Error&&(this.originalError=e,(0,n.Ad)(e)&&(this.isMock=!0))}}},46963:(e,t,i)=>{"use strict";i.d(t,{n:()=>NotImplementedError});var n=i(31102);class NotImplementedError extends n.y{constructor(e="Not implemented"){super(e),this.name="NotImplemented"}}},1030:(e,t,i)=>{"use strict";i.d(t,{Z:()=>OutOfRangeException});var n=i(31102);class OutOfRangeException extends n.y{constructor(e="Out of range"){super(e),this.name="OutOfRangeException"}}},61645:(e,t,i)=>{"use strict";function n(e){return!!(e&&e instanceof Error&&e.code)}function s(e){return!!(e&&e instanceof Error&&e.originalError)}function r(e){return!!(e&&e instanceof Error&&e.isMock)}function o(e){const t=[];let i=e;for(;i;)n(i)&&t.push(i.code),i=s(i)?i.originalError:void 0;return t}i.d(t,{bh:()=>n,Ad:()=>r,UX:()=>o})},92540:(e,t,i)=>{"use strict";i.d(t,{w:()=>ModelApiClient});var n=i(53204),s=i(70655),r=i(81707),o=i(80496);var a=i(71918),l=i(88512),c=i(90778),d=i(93863);var h=i(81063),u=i(32848);const p=new l.Z("model-api-client");class ModelApiClient{constructor(e={}){const t=e.baseUrl||window.location.origin,i=e.server||h.fH;this.graphUrl=e.url||`${t}${i}`,p.debug(`Initialized Model API client for ${this.graphUrl}`);const a=(0,n.createHttpLink)({uri:this.graphUrl}),l=(c=(e,{headers:t={}})=>((0,u.m)(this.graphUrl,t),{headers:t}),new r.i0((function(e,t){var i=(0,s._T)(e,[]);return new o.y$((function(n){var s;return Promise.resolve(i).then((function(t){return c(t,e.getContext())})).then(e.setContext).then((function(){s=t(e).subscribe({next:n.next.bind(n),error:n.error.bind(n),complete:n.complete.bind(n)})})).catch(n.error.bind(n)),function(){s&&s.unsubscribe()}}))})));var c;this.apollo=new n.fe({link:l.concat(a),cache:new n.h4})}async query(e,t,i={}){const n=Object.assign(Object.assign({errorPolicy:"all"},i),{query:e,variables:t,fetchPolicy:"no-cache"});return this.apollo.query(n).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new d.Zb(e,this.getApolloErrorCode(e))}))}async mutate(e,t,i={}){const n=Object.assign(Object.assign({errorPolicy:"all"},i),{mutation:e,variables:t});return this.apollo.mutate(n).then((e=>{const{data:t,errors:i}=e;return{data:t,errors:i}})).catch((e=>{throw p.error(e),new d.w0(e,this.getApolloErrorCode(e))}))}async upload(e,t,i,n){const s={};let r=0;(0,a.y)(i,((e,t,i)=>{if(e&&((n=e).filename&&n.blob&&n.blob instanceof Blob)){const n="file"+r++;s[n]=e,i[t]=`multipart:${n}`}var n}));const o=new FormData;for(const[e,t]of Object.entries(s))o.append(e,t.blob,t.filename);o.append("query",(0,c.S)(e)),o.append("operation",t),o.append("variables",JSON.stringify(i));const l=(0,u.m)(this.graphUrl,{});return this.uploadFormData(o,l,n).then((e=>{if(!ModelApiClient.isOk(e)){const t=ModelApiClient.getErrorCode(e)||"54200";throw new d.BR(ModelApiClient.getErrorMessage(e),t)}return e}))}getApolloErrorCode(e){var t;if(e instanceof n.cA){const i=null===(t=e.networkError)||void 0===t?void 0:t.statusCode;if(i)return`61${i}`}return"61000"}async uploadFormData(e,t,i){const n=new XMLHttpRequest;n.open("POST",this.graphUrl,!0),n.responseType="json",n.setRequestHeader("Accept","application/json"),i&&(n.upload.onprogress=i);for(const e in t)n.setRequestHeader(e,t[e]);return new Promise(((t,i)=>{n.onreadystatechange=()=>{4===n.readyState&&(200===n.status?t(n.response):0!==n.status&&i(new d.BR(`${n.status} ${n.statusText}`,`54${n.status}`)))},n.onerror=()=>{i(new d.BR("Network error","54002"))},n.send(e)}))}static isOk(e){return!(null==e?void 0:e.errors)||0===e.errors.length}static getErrorCode({errors:e}){var t;return(null==e?void 0:e.length)&&(null===(t=e[0].extensions)||void 0===t?void 0:t.code)||""}static getErrorMessage({errors:e}){let t="";return Array.isArray(e)&&e[0]&&(t=e[0].message||e[0].toString(),e.length>1&&(t+=` (+${e.length-1})`)),t}}ModelApiClient.version="2020.05.28"},93863:(e,t,i)=>{"use strict";i.d(t,{Zb:()=>MdsReadError,w0:()=>MdsWriteError,BR:()=>MdsUploadError});var n=i(31102);class MdsReadError extends n.y{constructor(e,t="62001"){super(e),this.name="MdsReadError",this.code=t}}class MdsWriteError extends n.y{constructor(e,t="63001"){super(e),this.name="MdsWriteError",this.code=t}}class MdsUploadError extends n.y{constructor(e,t="63002"){super(e),this.name="MdsUploadError",this.code=t}}},85004:(e,t,i)=>{"use strict";var n;i.d(t,{G:()=>n}),function(e){e.UPLOAD="upload",e.EXTERNAL="external"}(n||(n={}))},85876:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>n}),function(e){e.THUMBNAIL="thumbnail",e.REEL="reel"}(n||(n={}))},98649:(e,t,i)=>{"use strict";var n;i.d(t,{L:()=>n}),function(e){e.PHOTO="photo",e.VIDEO="video",e.RICH="rich"}(n||(n={}))},80161:(e,t,i)=>{"use strict";var n;i.d(t,{x:()=>n}),function(e){e.FULL="full",e.VIEWER="viewer",e.PUBLIC="public"}(n||(n={}))},16047:(e,t,i)=>{"use strict";var n;i.d(t,{Y:()=>n}),function(e){e.LEFT="left",e.RIGHT="right",e.AUTO="auto"}(n||(n={}))},936:(e,t,i)=>{"use strict";var n;i.d(t,{b:()=>n}),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(n||(n={}))},67166:(e,t,i)=>{"use strict";var n;i.d(t,{u:()=>n}),function(e){e.COMMENT="comment",e.MATTERTAG="mattertag"}(n||(n={}))},34031:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.PHOTO2D="photo2D",e.EQUIRECTANGULAR="equirectangular"}(n||(n={}))},76875:(e,t,i)=>{"use strict";var n;i.d(t,{w:()=>n}),function(e){e.PANORAMA="panorama",e.FLOORPLAN="floorplan",e.DOLLHOUSE="dollhouse",e.MESH="mesh"}(n||(n={}))},81063:(e,t,i)=>{"use strict";i.d(t,{fH:()=>n,wO:()=>s,AR:()=>r});const n="/api/mp/models/graph",s="/api/mp/attachments/graph",r="features/mds_prefetch"},67838:(e,t,i)=>{"use strict";var n;i.d(t,{K:()=>n}),function(e){e.Segment="segment",e.Logging="logging",e.Matterport="mp"}(n||(n={}))},69669:(e,t,i)=>{"use strict";i.d(t,{H:()=>f});var n=i(8243),s=i(67838),r=i(88512);const o=new r.Z("segment");const a=new r.Z("log-analytics");var l=i(82702),c=i(31879);var d=i(98612),h=i(18654);const u=new r.Z("mp-analytics"),p="ajs_anonymous_id",m="sc_anonymous_id";const f={[s.K.Segment]:{class:class SegmentAnalyticsProvider{constructor(e){this.token=e,this.endpointType=s.K.Segment,this.options={}}init(e,t){return this.setOptions(e),this.context=t,this.token?(window.analytics&&window.analytics.initialize&&(window.analytics=null),window.analytics||(0,n.SegmentBootstrap)(),window.analytics.load(this.token),new Promise(((e,t)=>{window.analytics.ready(e)}))):Promise.resolve()}identify(e){window.analytics.identify(e.id,{first_name:e.firstName,last_name:e.lastName,email:e.email})}track(e,t){r.Z.level>=3&&o.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);try{window.analytics.track(e,t,this.context)}catch(t){o.error(`Failed to send data to segment for ${e}`)}}trackAsync(e,t){if(t=t||{},navigator.sendBeacon)try{navigator.sendBeacon("https://api.segment.io/v1/t",JSON.stringify({event:e,anonymousId:window.analytics.user().anonymousId(),properties:Object.assign({data:t},this.options),writeKey:this.token,sentAt:Date.now(),type:"track",context:this.context}))}catch(e){o.error("Failed to send async segment request")}}setOptions(e){Object.assign(this.options,e)}},key:"segment_key",url:null},[s.K.Logging]:{class:class LoggingAnalyticsProvider{init(e,t){return a.debug("logging analytics to console",{options:e,context:t}),Promise.resolve()}identify(e){a.debug("identify as",e)}track(e,t){a.debug({eventName:e,data:t})}trackAsync(e,t){a.debug({eventName:e,data:t})}setOptions(e){a.debug("set options",e)}},key:null,url:null},[s.K.Matterport]:{class:class MatterportAnalyticsProvider{constructor(e,t,i){this.token=e,this.url=t,this.queue=i,this.options={},this.segmentStylePayload=(e,t,i)=>({timestamp:(0,c.U)(new Date),integrations:{},context:this.segmentStyleContext(i),properties:t,event:e,messageId:(0,l.D)(),anonymousId:this.anonymousId,type:"track",userId:this.user?this.user.id:null,sentAt:(0,c.U)(new Date)}),this.segmentStyleContext=e=>{const t={page:{path:window.location.pathname,referrer:(0,h.an)(),search:window.location.search,title:window.document.title,url:window.location.href},userAgent:navigator.userAgent,library:{name:"showcase",version:"1"},campaign:{}};return Object.assign(Object.assign({},e),t)};const n=(0,d.fp)(m);if(n)this.anonymousId=n;else{const e=function(e,t){const i=new RegExp(e+"=([^;]+)|$").exec(document.cookie);if(!i)return t;const n=i[1];return"boolean"==typeof t?"true"===n||"1"===n:"number"==typeof t?parseFloat(n):n}(p);this.anonymousId=e?e.replace(/%22/g,""):(0,l.D)(),(0,d.m8)(m,this.anonymousId)}this.headers={"X-API-Key":this.token,"Content-Type":"application/json",Accept:"application/json"}}init(e,t){return this.setOptions(e),this.context=t,u.debug("init",{options:this.options,context:this.segmentStyleContext(this.context)}),Promise.resolve()}identify(e){u.debug("identify as",e),this.user=e}track(e,t){r.Z.level>=3&&u.debug(e,t?JSON.stringify(t).replace('\\"','"'):t),t=Object.assign(t||{},this.options);const i=this.segmentStylePayload(e,t,this.context);this.queue.post(this.url,{body:i,headers:this.headers})}trackAsync(e,t){if(t=Object.assign(t||{},this.options),navigator.sendBeacon)try{const i=this.segmentStylePayload(e,t,this.context);navigator.sendBeacon(`${this.url}?api_key=${this.token}`,JSON.stringify(i))}catch(e){u.error("Failed to sendBeacon analytics request")}}setOptions(e){Object.assign(this.options,e)}},key:"analytics_mp_key",url:"analytics_mp_url"}}},54081:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Analytics:()=>AnalyticsModule,default:()=>h,useAnalytics:()=>d});var n=i(69669),s=i(47724),r=i(10757);class AnalyticsModule extends s.Y{constructor(){super(...arguments),this.name="analytics",this.endpoints=[],this.loaded=!1,this.bufferedData=[],this.options={},this.track=(e,t)=>this.loaded?(0,r.gw)(0).then((()=>{this.endpoints.forEach((i=>{i.track(e,t)}))})):(this.bufferedData.push({event:e,data:t}),Promise.resolve()),this.trackAsync=(e,t)=>{this.loaded?this.endpoints.forEach((i=>{i.trackAsync(e,t)})):this.bufferedData.push({event:e,data:t})}}async load(e,t,i,s,r){this.loaded=!1,Object.assign(this.options,i);for(const i of e){const{provider:e,token:o,url:a}=i;if(void 0===n.H[e])continue;const l=new(0,n.H[e].class)(o,a,t);await l.init(this.options,s),r&&r.loggedIn&&l.identify(r),this.endpoints.push(l),this.loaded=!0}return this.loaded&&this.flushBufferedData(),this.loaded}setOptions(e){Object.assign(this.options,e),this.endpoints.forEach((t=>{t.setOptions(e)}))}flushBufferedData(){for(const e of this.bufferedData)this.endpoints.forEach((t=>{t.track(e.event,e.data)}));this.bufferedData.length=0}}var o=i(96909),a=i(67294),l=i(25813);const c=new class AnalyticsQueue{constructor(){this.events=[],this.load=async(e,t,i,n,s)=>!0}track(e,t){return new Promise((i=>{this.events.push({event:e,payload:t,resolve:i})}))}trackAsync(e,t){this.track(e,t)}setOptions(){}};function d(){const e=function(e){const{engine:t}=(0,a.useContext)(l.I),[i,n]=(0,a.useState)();return(0,a.useEffect)((()=>{let i=!1;return t.getModuleBySymbol(e).then((async e=>{i||n(e)})),()=>{i=!0}}),[e,t]),i}(o.y.ANALYTICS);return(0,a.useEffect)((()=>(e&&c.events.length>0&&(c.events.forEach((t=>{e.track(t.event,t.payload).then((()=>t.resolve()))})),c.events.length=0),()=>{})),[e]),e||c}const h=AnalyticsModule},19980:(e,t,i)=>{"use strict";i.d(t,{A:()=>AnnotationsViewData});var n=i(32770),s=i(48715);class AnnotationsViewData extends n.V{constructor(){super(),this.name="annotations-view-data",this.dockedAnnotationObservable=(0,s.Y)(null),this.selectedAnnotationObservable=(0,s.Y)(null),this.focusedAnnotationObservable=(0,s.Y)(null)}setSelectedAnnotation(e,t){this.selectedAnnotationObservable.value=e&&t?{id:e,annotationType:t}:null}get selectedAnnotation(){return this.selectedAnnotationObservable.value}onSelectedAnnotationChanged(e){return this.selectedAnnotationObservable.onChanged(e)}setDockedAnnotation(e,t){this.dockedAnnotationObservable.value=e&&t?{id:e,annotationType:t}:null}get dockedAnnotation(){return this.dockedAnnotationObservable.value}setFocusedAnnotation(e,t){this.focusedAnnotationObservable.value=e&&t?{id:e,annotationType:t}:null}get focusedAnnotation(){return this.focusedAnnotationObservable.value}}},90662:(e,t,i)=>{"use strict";i.d(t,{bd:()=>DockAnnotationCommand,oM:()=>SelectAnnotationCommand,Kw:()=>PreviewAnnotationCommand,ew:()=>CloseAllAnnotationsCommand,Aj:()=>CloseAnnotationCommand});var n=i(17386);class DockAnnotationCommand extends n.m{constructor(e,t){super(),this.payload={id:e,annotationType:t}}}class SelectAnnotationCommand extends n.m{constructor(e,t){super(),this.payload={id:e,annotationType:t}}}class PreviewAnnotationCommand extends n.m{constructor(e,t){super(),this.payload={id:e,annotationType:t}}}class CloseAllAnnotationsCommand extends n.m{}class CloseAnnotationCommand extends n.m{constructor(e,t){super(),this.payload={id:e,annotationType:t}}}},6460:(e,t,i)=>{"use strict";var n;i.d(t,{J:()=>n}),function(e){e.NOTE="note",e.TAG="tag"}(n||(n={}))},21783:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AnnotationAttachmentClickedMessage:()=>s.qk,AnnotationBlockClickedMessage:()=>s.iP,AnnotationClosedMessage:()=>s.Ps,AnnotationOpeningMessage:()=>s.do,AnnotationType:()=>a.J,AnnotationsViewData:()=>r.A,CloseAllAnnotationsCommand:()=>o.ew,CloseAnnotationCommand:()=>o.Aj,DockAnnotationCommand:()=>o.bd,PreviewAnnotationCommand:()=>o.Kw,SelectAnnotationCommand:()=>o.oM,default:()=>l});var n=i(47724),s=i(91028),r=i(19980),o=i(90662);class AnnotationsModule extends n.Y{constructor(){super(...arguments),this.name="annotations",this.handleDockAnnotation=async e=>{const t=this.viewData,{dockedAnnotation:i}=t,{id:n,annotationType:r}=e;(null==i?void 0:i.id)!==n||(null==i?void 0:i.annotationType)!==r?(this.engine.broadcast(new s.do(r,n,!0)),t.atomic((()=>{t.setDockedAnnotation(n,r),t.setSelectedAnnotation(null),t.setFocusedAnnotation(null)}))):this.log.debug("Annotation is already docked")},this.handleSelectAnnotation=async e=>{const t=this.viewData,{selectedAnnotation:i}=t,{id:n,annotationType:r}=e;(null==i?void 0:i.id)!==n||(null==i?void 0:i.annotationType)!==r?(this.engine.broadcast(new s.do(r,n,!1)),t.atomic((()=>{t.setFocusedAnnotation(null),t.setDockedAnnotation(null),t.setSelectedAnnotation(n,r)}))):this.log.debug("Annotation is already selected")},this.handlePreviewAnnotation=async e=>{this.viewData.setFocusedAnnotation(e.id,e.annotationType)},this.handleClosingAllAnnotations=async e=>{const{selectedAnnotation:t,focusedAnnotation:i,dockedAnnotation:n}=this.viewData;i&&(this.viewData.setFocusedAnnotation(null),this.engine.broadcast(new s.Ps(i.annotationType,i.id))),t&&(this.viewData.setSelectedAnnotation(null),this.engine.broadcast(new s.Ps(t.annotationType,t.id))),n&&(this.viewData.setDockedAnnotation(null),this.engine.broadcast(new s.Ps(n.annotationType,n.id)))},this.handleCloseAnnotation=async e=>{const{selectedAnnotation:t,focusedAnnotation:i,dockedAnnotation:n}=this.viewData,{id:r,annotationType:o}=e;let a=!1;r===(null==i?void 0:i.id)&&o===(null==i?void 0:i.annotationType)&&(this.viewData.setFocusedAnnotation(null),a=!0),r===(null==t?void 0:t.id)&&o===(null==t?void 0:t.annotationType)&&(this.viewData.setSelectedAnnotation(null),a=!0),r===(null==n?void 0:n.id)&&o===(null==n?void 0:n.annotationType)&&(this.viewData.setDockedAnnotation(null),a=!0),a&&this.engine.broadcast(new s.Ps(o,r))}}async init(e,t){this.viewData=new r.A,this.engine=t,this.bindings.push(t.commandBinder.addBinding(o.bd,this.handleDockAnnotation),t.commandBinder.addBinding(o.oM,this.handleSelectAnnotation),t.commandBinder.addBinding(o.Kw,this.handlePreviewAnnotation),t.commandBinder.addBinding(o.Aj,this.handleCloseAnnotation),t.commandBinder.addBinding(o.ew,this.handleClosingAllAnnotations)),t.market.register(this,r.A,this.viewData)}dispose(e){this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],super.dispose(e)}onUpdate(){}}var a=i(6460);const l=AnnotationsModule},91028:(e,t,i)=>{"use strict";i.d(t,{do:()=>AnnotationOpeningMessage,Ps:()=>AnnotationClosedMessage,qk:()=>AnnotationAttachmentClickedMessage,iP:()=>AnnotationBlockClickedMessage});var n=i(91466);class AnnotationOpeningMessage extends n.v{constructor(e,t,i){super(),this.annotationType=e,this.id=t,this.docked=i}}class AnnotationClosedMessage extends n.v{constructor(e,t){super(),this.annotationType=e,this.id=t}}class AnnotationAttachmentClickedMessage extends n.v{constructor(e,t,i){super(),this.annotationType=e,this.id=t,this.attachmentId=i}}class AnnotationBlockClickedMessage extends n.v{constructor(e,t,i){super(),this.block=i,this.id=t,this.annotationType=e}}},94536:(e,t,i)=>{"use strict";i.d(t,{C:()=>r,K:()=>o});var n=i(6460);function s(e,t){return t===e.getCurrentUserId()}function r(e,t,i){if(t===n.J.NOTE){return e.isCommenter()&&!!i&&s(e,i.id)}return e.isEditor()}function o(e,t,i){if(t===n.J.NOTE){return e.isCommenter()&&!!i&&s(e,i.id)||e.isOrgAdmin()}return e.isEditor()}},99476:(e,t,i)=>{"use strict";var n;i.d(t,{X:()=>n}),function(e){e.ACCESS_TOKEN_REQUIRED="object.access.token.required",e.FORBIDDEN="spaces.public.access.password.forbidden",e.INVALID_PASSWORD="spaces.public.access.invalid_password",e.TOO_MANY_ATTEMPTS="spaces.public.access.too_many_attempts",e.UNAUTHORIZED="user.unauthorized"}(n||(n={}))},18349:(e,t,i)=>{"use strict";var n;i.d(t,{s:()=>n}),function(e){e.INVALID_CREDENTIALS="invalidcredentials",e.TOO_MANY_ATTEMPTS="toomanyattempts",e.UNKNOWN="unknown"}(n||(n={}))},69759:(e,t,i)=>{"use strict";i.d(t,{L:()=>MpPasswordAuthentication});var n=i(88512),s=i(18349),r=i(99476),o=i(32848);const a=new n.Z("mp-password-authentication");class MpPasswordAuthentication{constructor(e=window.location.origin){this.baseUrl=e,this.errorType=s.s.UNKNOWN}async authenticate(e,t){if(!e.match(/[a-zA-Z0-9]+/))return a.error(`Invalid Model ID ${e}`),!1;const i=`${this.baseUrl}/api/v2/models/${e}/public-access/`;return this.fetchToken(i,t).then((async e=>{let t={};return e&&(t=await e.json(),e.ok&&t.token)?(this.login(t.token),!0):(this.errorType=MpPasswordAuthentication.getErrorType(t.code),this.logout(),!1)}))}isAuthenticated(){return void 0!==MpPasswordAuthentication.token}login(e){MpPasswordAuthentication.token=e}logout(){MpPasswordAuthentication.token=void 0}getAuthorizationHeader(){return MpPasswordAuthentication.token?`Matterport-Object-Access ${MpPasswordAuthentication.token}`:""}async fetchToken(e,t){const i=JSON.stringify({password:t}),n={"Content-Type":"application/json"};return(0,o.m)(e,n),fetch(e,{method:"POST",cache:"no-cache",headers:n,body:i})}static getErrorType(e){switch(e){case r.X.TOO_MANY_ATTEMPTS:return s.s.TOO_MANY_ATTEMPTS;case r.X.INVALID_PASSWORD:return s.s.INVALID_CREDENTIALS}return s.s.UNKNOWN}}},89683:(e,t,i)=>{"use strict";i.d(t,{w:()=>MpSdkAuthentication});class MpSdkAuthentication{static setToken(e){MpSdkAuthentication.token="Bearer "+e}isAuthenticated(){return!!MpSdkAuthentication.token}authenticate(e){return!(!e||"string"!=typeof e)}getAuthorizationHeader(){return MpSdkAuthentication.token?MpSdkAuthentication.token:""}}},34369:(e,t,i)=>{"use strict";var n,s;i.d(t,{SL:()=>n,AB:()=>s,eE:()=>r,Qf:()=>o}),function(e){e.BASE="base",e.STANDARD="standard",e.HIGH="high",e.ULTRAHIGH="ultrahigh"}(n||(n={})),function(e){e[e.BASE=512]="BASE",e[e.STANDARD=1024]="STANDARD",e[e.HIGH=2048]="HIGH",e[e.ULTRAHIGH=4096]="ULTRAHIGH"}(s||(s={}));const r={[n.BASE]:s.BASE,[n.STANDARD]:s.STANDARD,[n.HIGH]:s.HIGH,[n.ULTRAHIGH]:s.ULTRAHIGH},o={[s.BASE]:n.BASE,[s.STANDARD]:n.STANDARD,[s.HIGH]:n.HIGH,[s.ULTRAHIGH]:n.ULTRAHIGH}},44110:(e,t,i)=>{"use strict";i.d(t,{m:()=>o});var n=i(48277),s=i(1030);const r={0:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y,1:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z,2:n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X,3:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z,4:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X,5:n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y},o=e=>{if(e<0||e>5)throw new s.Z("mapFaceToCubemapFace() -> face must be in the range [0, 5]");return r[e]}},3248:(e,t,i)=>{"use strict";i.d(t,{af:()=>PlayerOptionsData,gx:()=>n});var n,s=i(32770),r=i(23573),o=i(54243),a=i(51058),l=i(3506);class PlayerOptionsData extends s.V{constructor(e={}){super(),this.name="player-options",this.options=new PlayerOptions(e)}resetDefaultTourOptions(){this.options.fast_transitions=l.LI,this.options.transition_speed=l.p$,this.options.transition_time=l.rd,this.options.pan_speed=l.tu,this.options.dollhouse_pan_speed=l.nr,this.options.zoom_duration=l.we,this.options.pan_angle=l.Cj,this.options.pan_direction=l.y6,this.options.commit()}}class PlayerOptions extends r.T{constructor(e){super(),this.presented_by=!1,this.highlight_reel=!0,this.floor_plan=!0,this.tour_buttons=!0,this.labels=!0,this.labels_dh=!0,this.floor_select=!0,this.space_search=!0,this.measurements=!0,this.measurements_saved=!0,this.dollhouse=!0,this.contact_email=!1,this.address=!1,this.contact_name=!1,this.model_summary=!1,this.contact_phone=!1,this.model_name=!1,this.external_url=!1,this.unit_type=a.M.IMPERIAL,this.background_color=o.z.default,this.fast_transitions=l.LI,this.transition_speed=l.p$,this.transition_time=l.rd,this.pan_speed=l.tu,this.dollhouse_pan_speed=l.nr,this.zoom_duration=l.we,this.pan_angle=l.Cj,this.pan_direction=l.y6,e&&this.copy(e)}copy(e){this.presented_by=!!e.presented_by,this.highlight_reel=!!e.highlight_reel,this.floor_plan=!!e.floor_plan,this.tour_buttons=!!e.tour_buttons,this.labels=!!e.labels,this.space_search=!!e.space_search,this.dollhouse=!!e.dollhouse,this.fast_transitions=!!e.fast_transitions,this.contact_email=!!e.contact_email,this.address=!!e.address,this.contact_name=!!e.contact_name,this.model_summary=!!e.model_summary,this.contact_phone=!!e.contact_phone,this.model_name=!!e.model_name,this.external_url=!!e.external_url,void 0!==e.measurements&&(this.measurements=e.measurements),void 0!==e.labels_dh&&(this.labels_dh=e.labels_dh),void 0!==e.floor_select&&(this.floor_select=e.floor_select),void 0!==e.measurements_saved&&(this.measurements_saved=e.measurements_saved),void 0!==e.unit_type&&(this.unit_type=e.unit_type),void 0!==e.background_color&&void 0!==o.z[e.background_color]&&(this.background_color=e.background_color),void 0!==e.transition_speed&&(this.transition_speed=e.transition_speed),void 0!==e.transition_time&&(this.transition_time=e.transition_time),void 0!==e.pan_speed&&(this.pan_speed=e.pan_speed),void 0!==e.dollhouse_pan_speed&&(this.dollhouse_pan_speed=e.dollhouse_pan_speed),void 0!==e.zoom_duration&&(this.zoom_duration=e.zoom_duration),void 0!==e.pan_angle&&(this.pan_angle=e.pan_angle),void 0!==e.pan_direction&&(this.pan_direction=e.pan_direction)}}!function(e){e.PresentedBy="presented_by",e.HighlightReel="highlight_reel",e.FloorPlan="floor_plan",e.TourButtons="tour_buttons",e.Labels="labels",e.LabelsDollhouse="labels_dh",e.Measurements="measurements",e.FloorSelect="floor_select",e.SavedMeasurements="measurements_saved",e.Dollhouse="dollhouse",e.InstantTransitions="fast_transitions",e.TransitionSpeed="transition_speed",e.TransitionTime="transition_time",e.PanSpeed="pan_speed",e.DollhousePanSpeed="dollhouse_pan_speed",e.ZoomDuration="zoom_duration",e.PanAngle="pan_angle",e.PanDirection="pan_direction",e.Units="unit_type",e.DetailsEmail="contact_email",e.DetailsAddress="address",e.DetailsName="contact_name",e.DetailsSummary="model_summary",e.DetailsPhone="contact_phone",e.DetailsModelName="model_name",e.DetailsExternalUrl="external_url",e.BackgroundColor="background_color",e.SpaceSearch="space_search"}(n||(n={}))},76463:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SweepTextureLoader});var n=i(2212),s=i(88512),r=i(34369),o=i(10757);const a=new s.Z("api"),l={[r.SL.BASE]:256,[r.SL.STANDARD]:1024,[r.SL.HIGH]:2048,[r.SL.ULTRAHIGH]:4096};class SweepTextureLoader{constructor(e){this.urls=e,this.sweepCubeTextures={}}useTexture(e){const t=this.getTexture(e);if(!t)throw Error(`Texture for sweep ${e} not loaded before using`);return t}loadFace(e,t,i,s){return this.loadFaceImage(e,t,i,s).then((e=>{const t=new n.Texture(e);return t.needsUpdate=!0,t}))}load(e,t=r.SL.STANDARD){const i=this.sweepCubeTextures[e.id];if(i)return a.debug("Skipping load of pano, already loaded"),new Promise((function(e,t){e(i)}));const s=[2,4,0,5,1,3].map((i=>this.loadFaceImage(e,t,i))),o=Promise.all(s).then((t=>{const i=new n.CubeTexture(t);return i.flipY=!1,i.needsUpdate=!0,this.sweepCubeTextures[e.id]=i,i}));return o.catch((()=>{a.error(`Downloading cubemap for pano ${e.id} failed`)})),o}unload(e){var t;const i=this.sweepCubeTextures[e];if(!i)throw Error(`Texture for sweep ${e} not loaded before unloading`);i.dispose(),null===(t=i.images)||void 0===t||t.forEach((e=>{var t,i;null===(i=(t=e).close)||void 0===i||i.call(t)})),this.sweepCubeTextures[e]=null}unloadAll(e){const t=(0,o.ow)(e);for(const e of Object.keys(this.sweepCubeTextures))this.sweepCubeTextures[e]&&!t[e]&&this.unload(e)}async loadFaceImage(e,t,i,n){const s=l[t],r=await e.getFaceUrl(t,i);return this.urls.getImageBitmap(r,s,s,n)}getTexture(e){return this.sweepCubeTextures[e]}}},54243:(e,t,i)=>{"use strict";i.d(t,{K:()=>s,z:()=>r});const n={bgPrimary:"#0F1011",bgSecondary:"#1e2023",gridPrimary:"#2d3035",gridSecondary:"#171a1c"},s={black:n,grey:{bgPrimary:"#c9cbcc",bgSecondary:"#9d9d9e",gridPrimary:"#c9cbcc",gridSecondary:"#b0b1b1"},white:{bgPrimary:"#fcfdff",bgSecondary:"#ced0d3",gridPrimary:"#fcfdff",gridSecondary:"#e2e3e5"},default:n};var r;!function(e){e.black="black",e.grey="grey",e.white="white",e.default="black"}(r||(r={}))},68655:(e,t,i)=>{"use strict";i.d(t,{GT:()=>UnauthorizedException,V2:()=>ForbiddenException,TR:()=>NotFoundException});var n=i(31102);class ApiException extends n.y{constructor(e="Api Exception"){super(e),this.name="ApiException"}}class UnauthorizedException extends ApiException{constructor(e="Unauthorized"){super(e),this.name="Unauthorized"}}class ForbiddenException extends ApiException{constructor(e="Forbidden"){super(e),this.name="Forbidden"}}class NotFoundException extends ApiException{constructor(e="Not Found"){super(e),this.name="NotFound"}}},14973:(e,t,i)=>{"use strict";i.d(t,{Z:()=>s});var n=i(20331);async function s(e){return e.get("https://static.matterport.com/geoip/",{responseType:"json",priority:n.RequestPriority.LOW})}},35934:(e,t,i)=>{"use strict";i.d(t,{C:()=>r,P:()=>o});var n=i(43434);let s=null;const r=e=>{s=e},o=(e,t)=>(s&&(0,n.S)(e)&&(t["x-matterport-application-key"]=s),t)},54073:(e,t,i)=>{"use strict";i.d(t,{l:()=>r,I:()=>o});var n=i(43434);let s=null;const r=e=>{s=e},o=(e,t)=>(s&&(0,n.S)(e)&&(t["x-matterport-application-name"]=s),t)},97325:(e,t,i)=>{"use strict";i.d(t,{t:()=>r,X:()=>o});var n=i(43434);let s=null;const r=e=>{s=e},o=(e,t)=>(s&&(0,n.S)(e)&&(t["x-matterport-application-version"]=s),t)},32848:(e,t,i)=>{"use strict";i.d(t,{m:()=>u});var n=i(54073),s=i(97325),r=i(35934),o=i(69759),a=i(17597);class MpModelTokenAuthentication{constructor(){const e=(0,a.eY)("auth","");this.authenticate(e)}isAuthenticated(){return!!MpModelTokenAuthentication.token}authenticate(e){return!(!e||"string"!=typeof e)&&(MpModelTokenAuthentication.token=e.replace(","," "),!0)}getAuthorizationHeader(){return MpModelTokenAuthentication.token?MpModelTokenAuthentication.token:""}}var l=i(89683);const c=[new MpModelTokenAuthentication,new l.w,new o.L];var d=i(43434);const h=[(e,t,i=c)=>{const n=i.map((e=>e.getAuthorizationHeader())).find(Boolean);return n&&(0,d.S)(e)&&(t.authorization=n),t},n.I,s.X,r.P],u=(e,t,i=h)=>(i.forEach((i=>i(e,t))),t)},43434:(e,t,i)=>{"use strict";i.d(t,{S:()=>r});const n=["matterport.com","matterportvr.cn","localhost"],s=["/api/"],r=e=>{let t;try{t=new URL(e.toLowerCase())}catch(e){return!1}const{hostname:i,pathname:r}=t,o=n.some((e=>i===e||i.endsWith(`.${e}`))),a=s.some((e=>r.startsWith(e)));return o&&a}},58851:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ApiClient});var n=i(88512),s=i(20331),r=i(99476),o=i(68655);class Organization{constructor(e){this.blurEnabled=!1,e&&Object.assign(this,e)}}var a,l,c=i(14973),d=i(17597);!function(e){e.USER="user",e.ADMIN="admin"}(a||(a={}));class User{constructor(e){this.loggedIn=!1,this.flags=new Set,this.memberships=[],e&&Object.assign(this,e)}getFlags(e=""){if(this.memberships){const e=(0,d.eY)("organization","");for(const t of this.memberships)if(""===e||t.organizationId===e)for(const e of t.flags)this.flags.add(e)}const t=new Set;return this.flags.forEach((i=>{if(0===i.indexOf(e)){const n=i.replace(e,"");t.add(n)}})),t}hasFlag(e,t="showcase"){return this.getFlags().has(`${t}/${e}`)}isOrganizationAdmin(e){const t=this.getMembership(e);return!!(null==t?void 0:t.roles.includes(a.ADMIN))}getMembershipFlags(e){const t=this.getMembership(e);return t?t.flags:[]}getMembership(e){return this.memberships.find((t=>t.organizationId===e))}hasMembershipFlag(e,t){return this.getMembershipFlags(e).includes(t)}getMembershipFeature(e,t){const i=this.getMembership(e);return(null==i?void 0:i.features[t])||!1}hasMembership(e){return this.memberships.some((t=>t.organizationId===e))}}class Membership{constructor(e){this.features={},e&&Object.assign(this,e)}}!function(e){function t(e){return e.split(".").reduce(((e,t)=>{const i=parseInt(t,10);return isNaN(i)||e.push(i),e}),[])}function i(e,i){const n=t(e),s=t(i);for(let e=0;e<n.length;e++){if(e>=s.length)return 1;if(n[e]!==s[e])return n[e]>s[e]?1:-1}return s.length>n.length?-1:0}e.parse=t,e.gt=function(e,t){return 1===i(e,t)},e.lt=function(e,t){return-1===i(e,t)},e.eq=function(e,t){return 0===i(e,t)},e.compare=i}(l||(l={}));const h=new n.Z("user.serializers");function u(e,t="3.1.63.0-125-g1fd7fd3bed"){const i=[];for(let n of e){const e=n.match(/^.*\-(\d+(?:\.\d+)*)$/);if(e&&e[1]){if(n=n.replace(/-(\d+(?:\.\d+)*)$/,""),l.lt(t,e[1])){h.debug(`Dropping feature flag ${n}, version >= ${e[1]} required`);continue}h.debug(`Enabled versioned feature flag ${n}`)}i.push(n)}return i}var p=i(32848),m=i(60771);const f=new n.Z("ImageBitmapSupport"),g=(0,d.eY)("imageBitmap",null);let v=null;function y(){return"1"===g||(null===v&&function(){if(v=!1,(0,m.vU)()){const e=(0,m.rI)();e.major<=95&&(f.error(`Firefox/${e.major} issue, Disabling ImageBitmap support, upgrade to 96 for better performance.`),v=!0)}}(),!v&&("createImageBitmap"in window?"0"!==g:"1"===g))}const b=new n.Z("api"),S=Object.freeze({cacheClearTimeout:6e4});class Api{constructor(e=new s.RequestQueue,t=new s.RequestQueue,i={},n=window.location.origin){this.apiQueue=e,this.storeQueue=t,this.prefetchedData=i,this.baseUrl=n,this._configCache={},this._userCache={},this._organizationCache={},setTimeout((()=>{this.prefetchedData={}}),S.cacheClearTimeout)}async init(e){const t=[this.getUser().then((e=>this.user=e))];e&&t.push(this.getConfigs(e)),await Promise.all(t)}getOnStoreQueue(e,t={}){return this.get(e,t,this.storeQueue)}get(e,t={},i=this.apiQueue){const{headers:n={},prefetchFrom:s}=t;return s&&this.prefetchedData[s]?Promise.resolve(this.prefetchedData[s]):(t.headers=(0,p.m)(e,n),i.get(e,t).then((e=>{if(null===e)throw Error("Data from get was null, possibly unparsable JSON");return e})))}getImage(e,t){return this.getOnStoreQueue(e,Object.assign(Object.assign({},t),{responseType:"image"}))}async getImageBitmap(e,t,i,n={}){if(y()){const s=-1!==e.indexOf("?"),r=e+(s?"&":"?")+"imgopt=1",o=await this.getOnStoreQueue(r,Object.assign(Object.assign({},n),{responseType:"blob"}));return createImageBitmap(o,0,0,t,i,{imageOrientation:n.flipY?"flipY":"none"})}return this.getImage(e,n)}async getConfigs(e,t){if(e=e.toLowerCase(),!t&&this._configCache[e])return this._configCache[e];const i=t?{responseType:"json"}:{responseType:"json",prefetchFrom:"config"};let n={};const s=this.baseUrl+`/api/v1/config/${e}`;try{n=await this.get(s,i)}catch(e){b.warn(`Failed to load config from ${s}, ignoring`)}return t||(this._configCache[e]=n),n||{}}async getAppKey(e,t,i){if(""===e||""===t)return null;const n=await this.getConfigs(e,i);return n.hasOwnProperty(t)?n[t]:null}async getGeoIpLocation(){return(0,c.Z)(this.apiQueue)}async modelIsAccessible(e){var t,i;const n=`${this.baseUrl}/api/mp/models/graph`,s={"Content-Type":"application/graphql"};(0,p.m)(n,s);const r=await fetch(n,{method:"POST",mode:"cors",headers:s,body:`{ model(id: "${e}") { id } }`}),a=await r.json();if((null===(i=null===(t=null==a?void 0:a.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.id)!==e)throw new o.V2("Access denied (403)")}async modelExists(e,t={ignorePrefetch:!1}){if(e.length>20)return Promise.resolve(!0);const{ignorePrefetch:i}=t;if(!i&&this.prefetchedData&&this.prefetchedData.model){const{model:t}=this.prefetchedData;if(!t.sid&&t.has_public_access_password)throw new o.GT("Model requires a password");return t.sid===e}const n=`${this.baseUrl}/api/v2/models/${e}/`,s={"Content-Type":"application/json"};(0,p.m)(n,s);return fetch(n,{method:"GET",headers:s}).then((async e=>{if(e.ok)return!0;const t=await e.json().catch((e=>({})));if(t&&t.code===r.X.ACCESS_TOKEN_REQUIRED)throw new o.GT("Access token required (401)");if(403===e.status)throw new o.V2("Access denied (403)");throw new o.TR("Model not found (404)")}))}async getOrganization(e){if(e in this._organizationCache)return this._organizationCache[e];const t=`${this.baseUrl}/api/v2/organizations/${e}`,i=await this.get(t,{responseType:"json"}).catch((e=>{b.error(e)}));let n=null;return i&&(n=new Organization({id:i.sid,name:i.company_name||"",blurEnabled:!!i.manual_blur})),this._organizationCache[e]=n,n}async getUser(e){if(e&&e in this._userCache)return this._userCache[e];const t=`${this.baseUrl}/api/v2/users/${e||"current"}`,i=function(e){if(!e)return new User;const t=(e.memberships||[]).map((t=>new Membership({userId:e.user_sid,organizationId:t.organization_sid,name:t.name,flags:u(t.flags||[]),roles:t.roles||[],features:t.features||{}})));return new User({id:e.user_sid,firstName:e.first_name,lastName:e.last_name,email:e.email,loggedIn:e.is_authenticated,flags:new Set(u(e.flags)),memberships:t})}(await this.get(t,{responseType:"json"}).catch((e=>{b.error(e)})));return i.id&&(this._userCache[i.id]=i),i}}var E=i(47724);class ApiClient extends E.Y{constructor(){super(...arguments),this.name="api-client"}async init(e,t){this.api=new Api(e.apiQueue,e.storeQueue,e.prefetchedData,e.baseUrl),await this.api.init(e.preloadConfig)}getApi(){return this.api}}},3506:(e,t,i)=>{"use strict";i.d(t,{gj:()=>r,LI:()=>o,p$:()=>a,rd:()=>l,tu:()=>c,nr:()=>d,we:()=>h,Cj:()=>u,y6:()=>p});var n=i(52599),s=i(77037);const r="TransitionType",o=!0,a=s.Mk,l=s.mL,c=s.pn,d=s.su,h=s._c,u=s.BA,p=n.kw.Auto},86065:(e,t,i)=>{"use strict";i.d(t,{P:()=>Attachment});var n=i(23573),s=i(85004),r=i(74886);class Attachment extends n.T{constructor(e){super(),this.category=s.G.EXTERNAL,this.mediaType=r.DD.IMAGE,this.mimeType="",this.src="",this.height=0,this.width=0,e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.src=e.src,this.url=e.url,this.thumbnailUrl=e.thumbnailUrl,this.height=e.height,this.width=e.width,this.created=e.created,this.category=e.category,this.mediaType=e.mediaType,this.parentId=e.parentId||"",this.parentType=e.parentType,this.filename=e.filename,this.bytes=e.bytes,this.mimeType=e.mimeType||"",this}}},22151:(e,t,i)=>{"use strict";i.d(t,{b:()=>AttachmentsData});var n=i(32770),s=i(64781),r=i(86065);class AttachmentsData extends n.V{constructor(){super(),this.name="attachments-data",this.pendingAttachments=(0,s.q)(),this.removedAttachments=(0,s.q)(),this.currentUploads=(0,s.q)(),this.failedUploads=(0,s.q)()}iteratePending(e){for(const t of this.pendingAttachments)e(t)}iterateRemoved(e){for(const t of this.removedAttachments)e(t)}get pendings(){return this.pendingAttachments}get removals(){return this.removedAttachments}getPendingAttachment(e){return this.pendingAttachments.get(e)}getRemovedAttachment(e){return this.removedAttachments.get(e)}addPending(e){this.pendingAttachments.set(e.id,e)}removePendingAttachment(e){this.pendingAttachments.has(e)&&this.pendingAttachments.delete(e)}clearPending(){this.pendingAttachments.clear()}getPendingAttachmentsForAsset(e,t){const i=[];return this.iteratePending((n=>{n.parentType===t&&n.parentId===e&&i.push(n)})),i}getRemovedAttachmentsForAsset(e,t){const i=[];return this.iterateRemoved((n=>{n.parentType===t&&n.parentId===e&&i.push(n)})),i}markAttachmentForDelete(e){const t=new r.P(e);this.removedAttachments.set(t.id,t)}clearRemovals(){this.removedAttachments.clear()}get uploads(){return this.currentUploads}addUpload(e){this.uploads.set(e.id,e)}removeUpload(e){this.uploads.has(e)&&this.uploads.delete(e)}clearUploads(){this.uploads.clear()}get failures(){return this.failedUploads}addFailure(e){this.failures.set(e.id,e)}removeFailure(e){this.failures.has(e)&&this.failures.delete(e)}clearFailures(){this.failures.clear()}}},96168:(e,t,i)=>{"use strict";i.d(t,{wu:()=>EmbedMediaCommand,st:()=>LoadEmbeddedMediaCommand,It:()=>UploadAttachmentsCommand,iu:()=>ConfirmAttachmentChangesCommand,Ze:()=>CancelAttachmentChangesCommand,x9:()=>ResetAttachmentChangesCommand,xW:()=>AttachmentViewerCommand,$T:()=>RemoveAttachmentCommand,Rh:()=>RemoveFailureCommand});var n=i(17386);class EmbedMediaCommand extends n.m{constructor(e,t,i){super(),this.id="EMBED_MEDIA",this.payload={parentId:e,parentType:t,src:i}}}class LoadEmbeddedMediaCommand extends n.m{constructor(e){super(),this.id="LOAD_ATTACHMENT_EMBED",this.payload={attachment:e}}}class UploadAttachmentsCommand extends n.m{constructor(e,t,i){super(),this.id="UPLOAD_ATTACHMENTS",this.payload={parentId:e,parentType:t,files:i}}}class ConfirmAttachmentChangesCommand extends n.m{constructor(e,t,i){super(),this.id="CONFIRM_ATTACHMENT_CHANGES",this.payload={parentId:e,parentType:t,prevParentId:i}}}class CancelAttachmentChangesCommand extends n.m{constructor(){super(...arguments),this.id="CANCEL_ATTACHMENT_CHANGES"}}class ResetAttachmentChangesCommand extends n.m{constructor(){super()}}class AttachmentViewerCommand extends n.m{constructor(e,t,i){super(),this.payload={open:e,attachments:t,attachmentId:i}}}class RemoveAttachmentCommand extends n.m{constructor(e){super(),this.id="ATTACHMENT_REMOVE",this.payload={attachment:e}}}class RemoveFailureCommand extends n.m{constructor(e){super(),this.id="ATTACHMENT_REMOVE_FAILED_UPLOAD",this.payload={id:e}}}},74886:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{kV:()=>n,_V:()=>s,DD:()=>r}),function(e){e.FILE_TOO_LARGE="oversize",e.EMPTY_FILE="empty",e.OVER_QUOTA="overQuota",e.UPLOAD_FAILED="failed",e.PERMISSION_DENIED="permission"}(n||(n={})),function(e){e.EMBED_FAIL="embedFail",e.EMBED_SUCCESS="success"}(s||(s={})),function(e){e.IMAGE="image",e.PDF="pdf",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.TEXT="text",e.AUDIO="audio",e.MODEL="model",e.APPLICATION="application"}(r||(r={}))},4305:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Attachment:()=>o.P,AttachmentCategory:()=>a.G,AttachmentEmbedStatus:()=>l._V,AttachmentUploadDoneMessage:()=>c.RE,AttachmentUploadError:()=>l.kV,AttachmentUploadProgressMessage:()=>c.Vj,AttachmentViewerCommand:()=>_.xW,AttachmentsData:()=>x.b,AttachmentsStore:()=>AttachmentsStore,CancelAttachmentChangesCommand:()=>_.Ze,CloseAttachmentViewerMessage:()=>c.Rd,ConfirmAttachmentChangesCommand:()=>_.iu,EmbedMediaCommand:()=>_.wu,EmbeddingDoneMessage:()=>c.v8,ExternalAttachmentDeserializer:()=>m.d,ExternalAttachmentSerializer:()=>ExternalAttachmentSerializer,FileAttachmentDeserializer:()=>f.O,FileAttachmentStorage:()=>FileAttachmentStorage,FileUploadDeserializer:()=>FileUploadDeserializer,FileUploadSerializer:()=>FileUploadSerializer,LoadEmbeddedMediaCommand:()=>_.st,MediaType:()=>l.DD,RemoveAttachmentCommand:()=>_.$T,RemoveFailureCommand:()=>_.Rh,ResetAttachmentChangesCommand:()=>_.x9,UploadAttachmentsCommand:()=>_.It,ViewAttachmentsMessage:()=>c.O,default:()=>P});var n=i(47724),s=i(84933),r=i(67166),o=i(86065),a=i(85004),l=i(74886),c=i(28470),d=i(94474),h=i(36651),u=i(88512),p=i(95836);class ExternalAttachmentSerializer{constructor(){this.getAttachmentDetails=e=>e.mediaType?{mediaType:(0,p.m)(e.mediaType),srcUrl:e.src,thumbnailUrl:e.src,width:e.width,height:e.height}:null,this.validate=e=>!!e&&void 0!==e.mediaType}serialize(e){const t=this.getAttachmentDetails(e);return t&&this.validate(t)?t:null}}var m=i(45631),f=i(78230),g=i(70129),v=i(98443);const y=new u.Z("AttachmentsStore");class AttachmentsStore extends d.u{constructor(e){super(e),this.embedSerializer=new ExternalAttachmentSerializer,this.embedDeserializer=new m.d,this.fileDeserializer=new f.O}create(e){if(0===e.length)return Promise.resolve(null);const t=e[0].parentId,i=e[0].parentType;if(e.find((e=>e.parentId!==t||e.parentType!==i)))throw new Error("Cannot attach to different parents in one request");const n=this.getViewIdForParentType(i),s=[],o=[];let l,c;if(e.forEach((e=>{if(e.category===a.G.EXTERNAL){const t=this.embedSerializer.serialize(e);if(!t)throw y.error("Failure attaching external attachment:",e),new Error("Could not attach External Attachment");s.push(t)}else o.push(e.id)})),i!==r.u.COMMENT)throw new Error(`Cannot attach to attachment to a ${i}`);return l=g.AddCommentAttachments,c="addCommentAttachments",this.mutate(l,{modelId:n,parentId:t,externalAttachments:s,fileAttachments:o}).then((e=>{const t=[],i=(0,h.q)(e,`data.${c}.externalAttachments`);if(i&&Array.isArray(i))for(const e of i){const i=this.embedDeserializer.deserialize(e);i&&t.push(i)}const n=(0,h.q)(e,`data.${c}.fileAttachments`);if(n&&Array.isArray(n))for(const e of n){const i=this.fileDeserializer.deserialize(e);i&&t.push(i)}return t.reduce(((e,t)=>(e[t.id]=t,e)),{})}))}async remove(e){const{id:t,parentId:i,parentType:n}=e,s=this.getViewIdForParentType(n),r=await this.mutate(v.RemoveFileAttachment,{modelId:s,attachmentId:t,parentType:n,parentId:i}),o=(0,h.q)(r,"data.removeFileAttachment")||!1;return o||y.error("remove file attachment failed!"),o}async delete(e,t,i){const n=d.u.baseViewId;return Promise.all(e.map((e=>this.mutate(v.DeleteExternalAttachment,{modelId:n,attachmentId:e,parentType:i,parentId:t}))))}getViewIdForParentType(e){return e===r.u.COMMENT?d.u.baseViewId:this.getViewId()}}var b=i(15585),S=i(31879),E=i(77680);const T=new u.Z("file-upload-deserializer");class FileUploadDeserializer{deserialize(e){if(!e||!this.validate(e))return T.debug("Deserialized invalid file attachment data from MDS",e),null;const t=new o.P;return t.id=e.id,t.created=(0,S.p)(e.created),e.mimeType&&(t.mimeType=e.mimeType,t.mediaType=(0,p.id)(e.mimeType)),t.thumbnailUrl=new E.n(e.url||"",(0,S.p)(e.validUntil,null)),t.url=new E.n(e.url||"",(0,S.p)(e.validUntil,null)),t.filename=e.filename||"",t.bytes=e.bytes||0,t.category=a.G.UPLOAD,t.width=e.imageWidth||0,t.height=e.imageHeight||0,t}validate(e){return["id","created","url","filename","mimeType","validUntil"].every((t=>t in e))}}class FileUploadSerializer{constructor(){}serialize(e){return{filename:e.file.name,contents:{filename:e.file.name,blob:e.file}}}}const w=new u.Z("FileAttachmentStorage");class FileAttachmentStorage extends b.U{constructor(e){super(e),this.uploadDeserializer=new FileUploadDeserializer,this.uploadSerializer=new FileUploadSerializer}async create(e,t){const i=b.U.baseViewId,n=this.uploadSerializer.serialize(e);let s;try{s=await this.client.upload(v.UploadFileAttachmentToModel,"UploadFileAttachmentToModel",Object.assign(Object.assign({},n),{modelId:i,organizationId:this.config.organizationId}),t)}catch(t){return w.error(t),"file.upload.quota.exceeded"===t.code?e.error=l.kV.OVER_QUOTA:e.error=l.kV.UPLOAD_FAILED,e.progress=100,e}if(s.errors&&s.errors.length>0)w.error(s.errors),e.error=l.kV.UPLOAD_FAILED;else{const t=(0,h.q)(s,"data.uploadFileAttachmentToModel")||null;if(t){const i=this.uploadDeserializer.deserialize(t);i?(w.info("upload successful!"),e.attachment=i):(w.error("cannot create attachment"),e.error=l.kV.UPLOAD_FAILED)}else w.error("upload failed!"),e.error=l.kV.UPLOAD_FAILED}return e.progress=100,e}async delete(e){const t=await this.client.mutate(v.DeleteFileAttachment,{id:e}),i=(0,h.q)(t,"data.deleteFileAttachment")||!1;return i?w.info("upload deleted!"):w.error("upload deletion failed!"),i}}var x=i(22151),_=i(96168),M=i(91735),O=i(97807);function A(e){switch(e){case O.ht.PHOTO:return l.DD.IMAGE;case O.ht.VIDEO:return l.DD.VIDEO;case O.ht.RICH:return l.DD.RICH;default:return}}function C(e){const{height:t,width:i,thumbnail_height:n,thumbnail_width:s,cache_age:r}=e,o=(void 0===t||void 0===i)&&(s&&n),a=e.type===O.ht.PHOTO?e.url:void 0,l=e.thumbnail_url||a,c=r?new Date(Date.now()+1e3*r):null;return{width:o?s:i,height:o?n:t,mediaType:A(e.type),url:new E.n(a||"",c),thumbnailUrl:new E.n(l||"",c)}}class AttachmentsModule extends n.Y{constructor(){super(...arguments),this.name="attachments-module",this.loadEmbeddedAttachment=async e=>this.getUpdatedEmbed(e.attachment),this.embedMedia=async e=>{let t,i=null;const n=await this.oEmbedConsumer.getOEmbedData(e.src);return n?(i=new o.P,i.id=(0,s.fV)(),i.parentType=e.parentType,i.parentId=e.parentId,i.src=e.src,i.category=a.G.EXTERNAL,Object.assign(i,C(n)),this.attachmentsData.addPending(i),t=l._V.EMBED_SUCCESS):t=l._V.EMBED_FAIL,this.engine.broadcast(new c.v8(i,t,e.parentId,e.parentType)),i},this.uploadAttachments=async e=>{const{parentType:t,parentId:i,files:n}=e,s=this.attachmentsData;n.forEach((e=>{this.uploadAttachment(e,i,t).then((e=>{s.atomic((()=>{e.error?(s.removeUpload(e.id),s.addFailure(e)):e.attachment&&(e.attachment.parentId=i,e.attachment.parentType=t,s.removeUpload(e.id),s.addPending(e.attachment))})),this.engine.broadcast(new c.RE(e))}))}))},this.onProgress=(e,t)=>{if(!e.lengthComputable)return;const i=e.total>0?Math.floor(e.loaded/e.total*100):100,n=Object.assign(Object.assign({},t),{progress:i});this.attachmentsData.addUpload(n),this.engine.broadcast(new c.Vj(n))},this.removeFailure=async e=>{this.attachmentsData.removeFailure(e.id)},this.removeAttachment=async e=>{if(!this.fileAttachmentStorage)return void this.log.error("No file attachment store");const{attachment:t}=e,i=this.attachmentsData,n=i.getPendingAttachment(t.id);n?(n.category===a.G.UPLOAD&&await this.fileAttachmentStorage.delete(t.id),i.removePendingAttachment(t.id)):i.markAttachmentForDelete(t)},this.confirmAttachmentChanges=async e=>{const t=this.attachmentsData,{pendings:i,removals:n}=t,{parentId:s,parentType:o,prevParentId:l}=e,c=i.length>0||n.length>0;if(i.length>0){const e=l||s;t.iteratePending((t=>{l&&t.parentId===e&&t.parentType===o&&(t.parentId=s)}));const n=o!==r.u.MATTERTAG?i.values:i.values.filter((e=>e.category!==a.G.EXTERNAL));await this.attachmentsStore.create(n)}if(n.length>0){const e=o!==r.u.MATTERTAG?n.values:n.values.filter((e=>e.category!==a.G.EXTERNAL));e.length>0&&await this.deleteAttachments(e,s,o)}return this.resetAttachmentData(),c},this.cancelAttachmentChanges=async()=>{const e=this.attachmentsData,{pendings:t,removals:i}=e;0===t.length&&0===i.length||(this.fileAttachmentStorage?(e.pendings.values.forEach((e=>{e.category===a.G.UPLOAD&&this.fileAttachmentStorage.delete(e.id)})),this.resetAttachmentData()):this.log.error("No file attachment store"))},this.deleteAttachments=async(e,t,i)=>{if(!this.fileAttachmentStorage)return void this.log.error("No file attachment store");if(0===e.length)return;const n=[],s=[];this.attachmentsData.atomic((()=>{e.forEach((e=>{e.category===a.G.UPLOAD?n.push(e):s.push(e.id)}))})),n.length>0&&await Promise.all(n.map((e=>this.attachmentsStore.remove(e)))),s.length>0&&await this.attachmentsStore.delete(s,t,i)},this.handleAttachmentViewerCommand=async e=>{const{open:t,attachments:i,attachmentId:n}=e;t&&i&&n?this.openAttachmentViewer(i,n):this.closeAttachmentViewer()}}async init(e,t){this.engine=t;const{modelId:i,organizationId:n,apiConfig:s,queue:r}=e;this.attachmentsStore=new AttachmentsStore({readonly:!1}),n&&(this.fileAttachmentStorage=new FileAttachmentStorage({readonly:!1,viewId:i,organizationId:n}));const o={embedlyKey:s.embedly_key,queue:r,instagramAppId:s.instagram_app_id,instagramClientToken:s.instagram_client_token};this.oEmbedConsumer=new O.a_(o),this.attachmentsData=new x.b,this.bindings.push(t.commandBinder.addBinding(_.It,this.uploadAttachments),t.commandBinder.addBinding(_.wu,this.embedMedia),t.commandBinder.addBinding(_.st,this.loadEmbeddedAttachment),t.commandBinder.addBinding(_.iu,this.confirmAttachmentChanges),t.commandBinder.addBinding(_.Ze,this.cancelAttachmentChanges),t.commandBinder.addBinding(_.x9,(async()=>this.resetAttachmentData())),t.commandBinder.addBinding(_.$T,this.removeAttachment),t.commandBinder.addBinding(_.Rh,this.removeFailure),t.commandBinder.addBinding(_.xW,this.handleAttachmentViewerCommand)),t.market.register(this,x.b,this.attachmentsData)}async getUpdatedEmbed(e){if(e.category===a.G.EXTERNAL)try{const t=await this.oEmbedConsumer.getOEmbedData(e.src);return Object.assign(e,C(t)),t}catch(e){this.log.warn(e),this.log.warn("Get embedded media failed")}return null}async uploadAttachment(e,t,i){const n={file:e,id:(0,s.fV)(),progress:0,error:null,attachment:null,parentId:t,parentType:i};if(!this.fileAttachmentStorage)return this.log.error("No file attachment store"),n.error=l.kV.PERMISSION_DENIED,Promise.resolve(n);const r=e.size;return 0===r?(n.error=l.kV.EMPTY_FILE,Promise.resolve(n)):r>M.z6?(n.error=l.kV.FILE_TOO_LARGE,Promise.resolve(n)):(this.attachmentsData.addUpload(n),this.fileAttachmentStorage.create(n,(e=>this.onProgress(e,n))))}resetAttachmentData(){const e=this.attachmentsData;e.atomic((()=>{e.clearPending(),e.clearRemovals(),e.clearUploads(),e.clearFailures()}))}openAttachmentViewer(e,t){this.viewerOpen=!0,this.engine.broadcast(new c.O(e,t))}closeAttachmentViewer(){this.viewerOpen&&(this.viewerOpen=!1,this.engine.broadcast(new c.Rd))}}const P=AttachmentsModule},28470:(e,t,i)=>{"use strict";i.d(t,{O:()=>ViewAttachmentsMessage,Rd:()=>CloseAttachmentViewerMessage,Vj:()=>AttachmentUploadProgressMessage,RE:()=>AttachmentUploadDoneMessage,v8:()=>EmbeddingDoneMessage});var n=i(91466);class ViewAttachmentsMessage extends n.v{constructor(e,t){super(),this.attachments=e,this.attachmentId=t}}class CloseAttachmentViewerMessage extends n.v{}class AttachmentUploadProgressMessage extends n.v{constructor(e){super(),this.upload=e}}class AttachmentUploadDoneMessage extends n.v{constructor(e){super(),this.upload=e}}class EmbeddingDoneMessage extends n.v{constructor(e,t,i,n){super(),this.attachment=e,this.status=t,this.parentId=i,this.parentType=n}}},91735:(e,t,i)=>{"use strict";i.d(t,{yk:()=>n,z6:()=>s,Aw:()=>r,t8:()=>o,m:()=>a,KI:()=>l,fn:()=>c,vH:()=>d,VB:()=>h,RW:()=>u});const n=25,s=524288e3,r=["image/gif","image/png","image/jpeg","image/webp","image/bmp"],o=["image/gif","image/png","image/jpeg","image/webp"],a=140,l=140,c=60,d=60,h=300,u=250},45631:(e,t,i)=>{"use strict";i.d(t,{d:()=>ExternalAttachmentDeserializer});var n=i(88512),s=i(77680),r=i(31879),o=i(95836),a=i(86065),l=i(85004);const c=new n.Z("external-attachment-deserializer");class ExternalAttachmentDeserializer{constructor(){}deserialize(e){if(!e||!this.validate(e))return c.debug("Deserialized invalid external attachment data from MDS",e),null;const t=new a.P;return t.id=e.id,t.created=(0,r.p)(e.created),t.src=e.url||"",t.thumbnailUrl=new s.n(e.thumbnailUrl||"",(0,r.p)(e.validUntil,null)),t.url=new s.n(e.url||"",(0,r.p)(e.validUntil,null)),e.mediaType&&(t.mediaType=(0,o.bY)(e.mediaType)),e.category?t.category=e.category:t.category=l.G.EXTERNAL,e.width&&(t.width=e.width),e.height&&(t.height=e.height),t.parentType=e.parentDetails.type,t.parentId=e.parentDetails.parent.id,t}validate(e){if(!e)return!1;const t=["id","created","modified","mediaType","category","parentDetails"].filter((t=>!(t in e))),i=0===t.length;return i||c.debug("Attachment invalid:",{missingFields:t}),i}}},78230:(e,t,i)=>{"use strict";i.d(t,{O:()=>FileAttachmentDeserializer});var n=i(88512),s=i(31879),r=i(95836),o=i(86065),a=i(85004),l=i(77680);const c=new n.Z("file-attachment-deserializer");class FileAttachmentDeserializer{constructor(){}deserialize(e){if(!e||!this.validate(e))return c.debug("Deserialized invalid file attachment data from MDS",e),null;const t=new o.P;return t.id=e.id,t.created=(0,s.p)(e.created),e.mimeType&&(t.mimeType=e.mimeType,t.mediaType=(0,r.id)(e.mimeType)),t.category=a.G.UPLOAD,t.thumbnailUrl=new l.n(e.url||"",(0,s.p)(e.validUntil,null)),t.url=new l.n(e.url||"",(0,s.p)(e.validUntil,null)),t.filename=e.filename||"",t.bytes=e.bytes||0,t.width=e.imageWidth||0,t.height=e.imageHeight||0,t}validate(e){if(!e)return!1;return["id","created","url","mimeType","filename"].every((t=>t in e))}}},95836:(e,t,i)=>{"use strict";var n;i.d(t,{bY:()=>u,VV:()=>m,fy:()=>l,Ug:()=>d,lV:()=>c,Uq:()=>a,m:()=>p,id:()=>h}),function(e){e.IMAGE="image",e.VIDEO="video",e.RICH="rich",e.ZIP="zip",e.PDF="pdf"}(n||(n={}));var s=i(85004),r=i(74886),o=i(91735);function a(e){return!(e.category!==s.G.UPLOAD||!e.mimeType)&&o.t8.includes(e.mimeType)}function l(e,t){return t?{width:o.VB,height:o.RW}:e?{width:o.fn,height:o.vH}:{width:o.m,height:o.KI}}function c(e){return e.category===s.G.EXTERNAL||!!e.mimeType&&o.Aw.includes(e.mimeType)}function d(e){return e.filter((e=>c(e)))}function h(e){return e.startsWith("image")?r.DD.IMAGE:e.startsWith("video")?r.DD.VIDEO:e.startsWith("audio")?r.DD.AUDIO:e.startsWith("model")?r.DD.MODEL:e.startsWith("text")?r.DD.TEXT:"application/pdf"===e?r.DD.PDF:r.DD.APPLICATION}function u(e){switch(e){case n.IMAGE:return r.DD.IMAGE;case n.PDF:return r.DD.PDF;case n.VIDEO:return r.DD.VIDEO;case n.RICH:return r.DD.RICH;case n.ZIP:return r.DD.ZIP;default:throw Error(`Unknown attachment media type ${e}`)}}function p(e){switch(e){case r.DD.IMAGE:return n.IMAGE;case r.DD.PDF:return n.PDF;case r.DD.VIDEO:return n.VIDEO;case r.DD.RICH:return n.RICH;case r.DD.ZIP:return n.ZIP;default:throw Error(`Unknown media type ${e}`)}}function m(e){if(!e)return"0";const t=Math.min(Math.floor(Math.log(e)/Math.log(1e3)),3),i=["B","kB","MB","GB"][t];return`${Number((e/Math.pow(1e3,t)).toFixed(1))}${i}`}},59088:(e,t,i)=>{"use strict";i.d(t,{M_:()=>CameraData,rw:()=>u});var n=i(63560),s=i(32770),r=i(17131),o=i(2212);const a=(e,t)=>e&&t?e.equals(t):e===t;var l=i(69626),c=i(36371),d=i(23573),h=i(7170);class CameraPoseData extends d.T{constructor(e){super(),this.position=new o.Vector3,this.rotation=new o.Quaternion,this.focalDistance=-1,this.projection=(0,n.AN)(e)}aspect(){return this.projection.elements[5]/this.projection.elements[0]}clone(e=new CameraPoseData(this.aspect())){return e.position.copy(this.position),e.rotation.copy(this.rotation),e.focalDistance=this.focalDistance,e.projection.copy(this.projection),e}isOrtho(){return(0,l.Pp)(this.projection)}fovX(){return 2*Math.atan(1*this.aspect()/this.projection.elements[5])}fovY(){return 2*Math.atan(1/this.projection.elements[5])}}class CameraTransition extends d.T{constructor(){super(...arguments),this.startTime=0,this.duration=0,this.active=!1,this.type=null,this.progress=new r.z(0),this.blackoutProgress=new r.z(0),this.from={position:new o.Vector3,rotation:new o.Quaternion,projection:new c.M},this.to={position:new o.Vector3,rotation:new o.Quaternion,projection:new c.M},this.rotationDelay=0,this.rotationDuration=1,this.matrixDelay=0,this.matrixDuration=1,this.activeInternal=!1,this.promise=null}}const u=(e,t,i=!0)=>{t.position=p(e.position,t.position,i),t.rotation=p(e.rotation,t.rotation,i),t.projection=p(e.projection,t.projection,i),t.focalDistance=e.focalDistance},p=(e,t,i=!0)=>(e&&!t?t=e.clone():e&&t?t.copy(e):i&&(t=void 0),t);class CameraData extends s.V{constructor(e,t){super(),this._width=e,this._height=t,this.name="camera",this._baseProjection=new c.M,this._orthoMatrix=new c.M,this._lastOrthoZoom=1,this._perspectiveMatrix=new c.M,this.pose=new CameraPoseData(e/t),this.transition=new CameraTransition,this.setCameraDimensions(e,t),this._baseFovY=h.Ue*n.oR.fov}setCameraDimensions(e,t){if(void 0===e||void 0===t)return;this._width=e,this._height=t;const i=e/t,s=this.isOrtho()?(0,n.aH)(e,t,t/(2*this.orthoZoom()),this._orthoMatrix):this._perspectiveMatrix.makePerspectiveFov(h.MN*this.fovY(),i,n.oR.near,n.oR.far);if(this.pose.projection.copy(s),this.transition.active&&this.transition.to.projection)if((0,l.Pp)(this.transition.to.projection)){const i=(0,l.S3)(this.transition.to.projection);this.transition.to.projection.copy((0,n.aH)(e,t,t/(2*i)))}else{const e=2*h.MN*Math.atan(1/this.transition.to.projection.elements[5]);this.transition.to.projection.makePerspectiveFov(e,i,n.oR.near,n.oR.far)}this.pose.commit()}setBaseProjection(e){this._baseProjection=e}get width(){return this._width}get height(){return this._height}get baseFovY(){return this._baseFovY}aspect(){return this.pose.aspect()}fovY(){return this.pose.fovY()}fovX(){return this.pose.fovX()}isOrtho(){return this.pose.isOrtho()}baseZoom(){return this.pose.projection.elements[0]/2}defaultZoom(){return(0,l.Pp)(this._baseProjection)?(0,l.S3)(this._baseProjection):this.perspectiveZoom()}zoom(){return this.isOrtho()?this.orthoZoom():this.perspectiveZoom()}orthoZoom(){const e=(0,l.S3)(this.pose.projection);return isNaN(e)?this._lastOrthoZoom:(this._lastOrthoZoom=e,e)}perspectiveZoom(){return this.baseFovY/this.fovY()}copyTransition(e){this.transition.active=e.active,this.transition.activeInternal=e.activeInternal,this.transition.type=e.type,this.transition.startTime=e.startTime,this.transition.duration=e.duration,this.transition.rotationDelay=e.rotationDelay,this.transition.rotationDuration=e.rotationDuration,this.transition.matrixDelay=e.matrixDelay,this.transition.matrixDuration=e.matrixDuration,e.progress&&this.transition.progress.copy(e.progress),e.blackoutProgress&&this.transition.blackoutProgress.copy(e.blackoutProgress),e.from&&u(e.from,this.transition.from),e.to&&u(e.to,this.transition.to),this.transition.promise=e.promise}canTransition(){return!this.transition.active}clone(){const e=new CameraData(this.width,this.height);return e.copy(this),e}copy(e){this.pose.position.copy(e.pose.position),this.pose.rotation.copy(e.pose.rotation),this.pose.focalDistance=e.pose.focalDistance,this.pose.projection.copy(e.pose.projection),this.pose.commit(),this._baseFovY=e.baseFovY,this.copyTransition(e.transition),this.transition.commit(),this._width=e.width,this._height=e.height}shallowIsEqual(e){return this.pose.position.equals(e.pose.position)&&this.pose.rotation.equals(e.pose.rotation)&&this.pose.projection.equals(e.pose.projection)&&this.pose.focalDistance===e.pose.focalDistance&&this.baseFovY===e.baseFovY}isEqual(e){return this.shallowIsEqual(e)&&this.transitionIsEqual(e.transition)}transitionIsEqual(e){return this.transition.active===e.active&&this.transition.type===e.type&&this.transition.progress.equals(e.progress)&&this.transition.blackoutProgress.equals(e.blackoutProgress)&&this.transition.rotationDelay===e.rotationDelay&&this.transition.rotationDuration===e.rotationDuration&&this.transition.matrixDelay===e.matrixDelay&&this.transition.matrixDuration===e.matrixDuration&&this.transition.activeInternal===e.activeInternal&&a(this.transition.from.position,e.from.position)&&a(this.transition.from.rotation,e.from.rotation)&&a(this.transition.from.projection,e.from.projection)&&a(this.transition.to.position,e.to.position)&&a(this.transition.to.rotation,e.to.rotation)&&a(this.transition.to.projection,e.to.projection)&&this.transition.startTime===e.startTime&&this.transition.duration===e.duration}}},63560:(e,t,i)=>{"use strict";i.d(t,{oR:()=>s,AN:()=>r,aH:()=>o});var n=i(36371);const s={fov:75,near:.1,far:3e3},r=(e,t)=>(t||(t=new n.M),t.makePerspectiveFov(s.fov,e,s.near,s.far)),o=(e,t,i=1,r)=>{r||(r=new n.M);const o=e/2,a=t/2,l=r.makeOrthographic(-o,o,a,-a,s.near,s.far);return l.elements[0]*=i,l.elements[5]*=i,l}},77719:(e,t,i)=>{"use strict";i.r(t),i.d(t,{TRANSITION_DISTANCE_MULTIPLIER:()=>S,baseTransitionSpeedKey:()=>E,default:()=>CameraModule});var n=i(2212);var s=i(8482),r=i(69626),o=i(67790),a=i(47724),l=i(59088),c=i(91466);class CameraMoveMessage extends c.v{constructor(e,t){super(),this.from=t,this.to=e,this.timestamp=Date.now()}}class BeginCameraMoveMessage extends CameraMoveMessage{}class EndCameraMoveMessage extends CameraMoveMessage{}var d=i(64185),h=i(79437),u=i(10613),p=i(33874),m=i(40168),f=i(27408),g=i(76701),v=i(31278),y=i(17386);class ResetPitchCommand extends y.m{}const b={[v.n.Instant]:{blackoutTime:0,transitionTime:0},[v.n.FadeToBlack]:{blackoutTime:u.Z.camera.transitionBlackoutTime,transitionTime:2*u.Z.camera.transitionBlackoutTime},[v.n.Interpolate]:{blackoutTime:0,transitionTime:u.Z.camera.transitionFadeTime},[v.n.MoveToBlack]:{blackoutTime:u.Z.camera.transitionBlackoutTime,transitionTime:u.Z.camera.transitionFadeTime}},S=166,E="Transition time";class CameraModule extends a.Y{constructor(){super(...arguments),this.name="camera-data",this.eulerCache=new n.Euler,this.quaternionCache=new n.Quaternion}async init(e,t){this.engine=t,this.market=t.market,this.canvas=await t.market.waitForData(m.W),this.cameraData=new l.M_(this.canvas.width,this.canvas.height),this.market.register(this,l.M_,this.cameraData),this.baseTransitionTime=e.baseTransitionTime||u.Z.camera.baseTransitionTime,t.market.waitForData(p.e).then((e=>{e.onPropertyChanged(E,(e=>{this.baseTransitionTime=e}))})),t.commandBinder.addBinding(ResetPitchCommand,(async()=>this.resetPitch())),this.bindings.push(t.subscribe(o.a,(e=>this.cameraData.setCameraDimensions(e.width,e.height)))),this.transitionSpeed=e.transitionSpeed||u.Z.camera.transitionSpeed}getData(e=!0){return e?Object.freeze(this.cameraData.clone()):this.cameraData}onUpdate(e){}fromPose(){return{position:this.cameraData.pose.position.clone(),rotation:this.cameraData.pose.rotation.clone(),projection:this.cameraData.pose.projection.clone(),focalDistance:this.cameraData.pose.focalDistance}}updateCameraProjection(e){e&&(this.cameraData.pose.projection.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({projection:e}))}updateCameraFocus(e){this.cameraData.pose.focalDistance=e,this.cameraData.pose.commit()}updateCameraRotation(e){e&&(this.cameraData.pose.rotation.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({rotation:e}))}resetPitch(){this.eulerCache.setFromQuaternion(this.cameraData.pose.rotation,"YXZ"),this.eulerCache.x=0,this.eulerCache.z=0,this.quaternionCache.setFromEuler(this.eulerCache),this.updateCameraRotation(this.quaternionCache)}updateCameraPosition(e){e&&(this.cameraData.pose.position.copy(e),this.cameraData.pose.commit(),this.broadcastCameraMoved({position:e}))}broadcastCameraMoved(e){const t=this.fromPose(),i=Object.assign(Object.assign({},t),e);this.engine.broadcast(new CameraMoveMessage(i,t))}updateCameraPose(e){e.position&&this.updateCameraPosition(e.position),e.rotation&&this.updateCameraRotation(e.rotation)}canTransition(){return this.cameraData.canTransition()}moveTo(e){if(!this.canTransition())return d.Q.reject("Cannot move while the camera is already moving");const t=b[e.transitionType],i=e.pose.rotation,n=e.pose.position;let s=e.projection;e.pose.zoom&&(s&&(0,r.Pp)(s)||this.cameraData.isOrtho())&&(s=this.adjustProjectionZoom(s||this.cameraData.pose.projection.clone(),e.pose.zoom));const o=void 0!==e.blackoutTime?e.blackoutTime:t.blackoutTime,a=e.transitionType,l=e.transitionSpeedMultiplier?1/e.transitionSpeedMultiplier:1;let c=a===v.n.Instant?0:e.transitionTime;if(void 0===c)if(e.transitionType===v.n.Interpolate&&n){const e=n.distanceTo(this.cameraData.pose.position);c=this.baseTransitionTime+Math.log2(1+e)*S*this.transitionSpeed*l}else c=t.transitionTime;const h=this.fromPose();this.beginInternalTransition({transitionType:a,transitionTime:c,blackoutTime:o,pose:{position:n,rotation:i},projection:s,easing:e.easing,rotationDelay:e.rotationDelay||0,rotationDuration:e.rotationDuration||1,matrixDelay:e.matrixDelay||0,matrixDuration:e.matrixDuration||1,focalDistance:e.focalDistance||h.focalDistance});const u={position:e.pose.position?e.pose.position.clone():void 0,rotation:e.pose.rotation?e.pose.rotation.clone():void 0,projection:e.projection?e.projection.clone():void 0,focalDistance:e.focalDistance?e.focalDistance:void 0};this.engine.broadcast(new BeginCameraMoveMessage(u,h));const p=this.cameraData.transition.promise;if(!p)throw new Error("Expected promise to have been created.");const m=this.progressInternalTransition.bind(this),y=this.endInternalTransition.bind(this),E=this;return p.notify(0),this.engine.startGenerator((function*(){let t=16;for(t>=E.cameraData.transition.duration&&(p.notify(.5),yield new g.Jj);t<E.cameraData.transition.duration;){m(t,o);const e=(0,f.uZ)(t/E.cameraData.transition.duration,0,1);p.notify(e),yield new g.Jj,t=16+Date.now()-E.cameraData.transition.startTime}y(e.transitionType),E.cameraData.commit(),p.notify(1),p.resolve(),E.engine.broadcast(new EndCameraMoveMessage(u,h))})),p.promise()}async cancelTransition(){return this.cameraData.transition.active?new Promise((e=>{(0,l.rw)(this.cameraData.pose,this.cameraData.transition.to,!1);const t=Date.now()-this.cameraData.transition.startTime;this.cameraData.transition.duration=t,this.cameraData.transition.progress.stop(1),this.cameraData.pose.commit(),this.cameraData.transition.commit();const i=this.cameraData.transition.onPropertyChanged("active",(t=>{t||(i&&i.cancel(),e())}))})):Promise.resolve()}updateTransitionSpeed(e){if(this.cameraData.transition.active){const t=Date.now(),i=t-this.cameraData.transition.startTime,n=i/e,s=this.cameraData.transition.progress,r=(s.duration-i)/e+n;this.cameraData.transition.duration=r,this.cameraData.transition.startTime=t-n,s.modifyAnimation(s.value,s.endValue,r,s.easing,n),this.cameraData.transition.commit()}}beginExternalTransition(){this.cameraData.transition.activeInternal||(this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.active=!0,this.cameraData.transition.promise=new d.Q,this.cameraData.transition.commit())}endExternalTransition(){var e;this.cameraData.transition.activeInternal||(this.cameraData.transition.active=!1,null===(e=this.cameraData.transition.promise)||void 0===e||e.resolve(),this.cameraData.transition.commit())}beginInternalTransition(e){const t=e.transitionTime||0;if(this.cameraData.transition.startTime=Date.now(),this.cameraData.transition.duration=t,this.cameraData.transition.active=!0,this.cameraData.transition.promise=new d.Q,this.cameraData.transition.activeInternal=!0,this.cameraData.transition.type=e.transitionType,this.cameraData.transition.progress.modifyAnimation(0,1,t,e.easing||h.to),this.cameraData.transition.rotationDelay=e.rotationDelay||0,this.cameraData.transition.rotationDuration=e.rotationDuration||1,this.cameraData.transition.matrixDelay=e.matrixDelay||0,this.cameraData.transition.matrixDuration=e.matrixDuration||1,e.transitionType===v.n.FadeToBlack&&this.cameraData.transition.blackoutProgress.modifyAnimation(0,1,e.blackoutTime,h.vG),e.transitionType===v.n.MoveToBlack){const e=500;this.cameraData.transition.blackoutProgress.modifyAnimation(0,1,t-2*e,h.aB,0,e)}this.cameraData.transition.from.position=this.cameraData.pose.position.clone(),this.cameraData.transition.from.rotation=this.cameraData.pose.rotation.clone(),this.cameraData.transition.from.projection=this.cameraData.pose.projection.clone(),this.cameraData.transition.from.focalDistance=this.cameraData.pose.focalDistance,this.cameraData.transition.to.position=e.pose.position?e.pose.position.clone():void 0,this.cameraData.transition.to.rotation=e.pose.rotation?e.pose.rotation.clone():void 0,this.cameraData.transition.to.projection=e.projection?e.projection.clone():void 0,this.cameraData.transition.to.focalDistance=e.focalDistance?e.focalDistance:void 0,this.cameraData.transition.commit()}progressInternalTransition(e,t){if(this.cameraData.transition.active){if(this.cameraData.transition.progress.updateAbsolute(e),this.cameraData.transition.type===v.n.Interpolate)this.updateInterpolateTransition();else if(this.cameraData.transition.type===v.n.FadeToBlack){let i=0;const n=this.cameraData.transition.duration;e<=t?i=e:((0,l.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),i=e>=n-t?n-e:t),this.cameraData.transition.blackoutProgress.updateAbsolute(i),this.cameraData.transition.progress.updateAbsolute(e<=t?0:n)}else if(this.cameraData.transition.type===v.n.MoveToBlack){const t=this.cameraData.transition.blackoutProgress;this.updateInterpolateTransition(),t.updateAbsolute(e-t.delay)}this.cameraData.pose.commit(),this.cameraData.transition.commit()}}updateInterpolateTransition(){const e=this.cameraData.transition.from,t=this.cameraData.transition.to;if(t.position&&e.position&&this.cameraData.pose.position.copy(e.position).lerp(t.position,this.cameraData.transition.progress.value),t.focalDistance&&e.focalDistance&&(this.cameraData.pose.focalDistance=(0,s.t)(e.focalDistance,t.focalDistance,this.cameraData.transition.progress.value)),t.rotation&&e.rotation){const i=(0,h.e3)(this.cameraData.transition.progress.easing,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.rotationDuration,this.cameraData.transition.rotationDelay);this.cameraData.pose.rotation.copy(e.rotation).slerp(t.rotation,i)}if(t.projection&&e.projection){const i=(0,h.e3)(h.w2,this.cameraData.transition.progress.value,this.cameraData.transition.progress.elapsed,this.cameraData.transition.progress.duration*this.cameraData.transition.matrixDuration,this.cameraData.transition.matrixDelay);!function(e,t,i,n){const s=n.elements,r=e.elements,o=t.elements;for(let e=0;e<16;e++)s[e]=r[e]*(1-i)+o[e]*i}(e.projection,t.projection,i,this.cameraData.pose.projection)}}endInternalTransition(e){(0,l.rw)(this.cameraData.transition.to,this.cameraData.pose,!1),this.cameraData.transition.type=null,this.cameraData.transition.active=!1,this.cameraData.transition.activeInternal=!1,this.cameraData.transition.progress.stop(1),e!==v.n.FadeToBlack&&e!==v.n.MoveToBlack||this.cameraData.transition.blackoutProgress.stop(0),this.cameraData.pose.commit(),this.cameraData.transition.commit()}adjustProjectionZoom(e,t){const i=1/t;return e.elements[0]=i/this.canvas.aspectRatio,e.elements[5]=i,e}setBaseProjection(e){this.cameraData.setBaseProjection(e)}}},31278:(e,t,i)=>{"use strict";var n;i.d(t,{n:()=>n}),function(e){e[e.Instant=0]="Instant",e[e.FadeToBlack=1]="FadeToBlack",e[e.Interpolate=2]="Interpolate",e[e.MoveToBlack=3]="MoveToBlack"}(n||(n={}))},10613:(e,t,i)=>{"use strict";i.d(t,{Z:()=>o,y:()=>a});var n=i(26059),s=i(31278),r=i(17597);const o=Object.freeze({camera:{transitionBlackoutTime:300,transitionFadeTime:800,baseTransitionTime:(0,r.eY)("btt",200),transitionSpeed:(0,r.eY)("tsp",3)}}),a={[n.s.Desktop]:s.n.Interpolate,[n.s.Mobile]:s.n.Interpolate,[n.s.VrOrientOnly]:s.n.FadeToBlack,[n.s.VrWithController]:s.n.FadeToBlack,[n.s.VrWithTrackedController]:s.n.FadeToBlack}},27687:(e,t,i)=>{"use strict";i.d(t,{q9:()=>r,bD:()=>o,D_:()=>a,z5:()=>c,st:()=>d,Kh:()=>h,fi:()=>u});var n=i(2212),s=i(12216);const r=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,s,r,o)=>(r=r||new n.Vector2,o=o||new n.Vector3,l(i.pose,t),e.copy(t),e.invert(),o.set(s.x,s.y,s.z).applyMatrix4(e).applyMatrix4(i.pose.projection.asThreeMatrix4()),u(i.width,i.height,o,r),{screenPosition:r,ndcPosition:o})})(),o=(()=>{const e=new n.Vector3,t=new n.Vector2;return(i,n,s,r,o,l)=>(e.copy(a(i,n,s,l)),u(r,o,e,t),t)})(),a=(()=>{const e=new n.Matrix4,t=new n.Matrix4,i=new n.Vector3;return(n,r,o,a)=>(e.compose(r,o,s.f.UNIT),t.copy(e),t.invert(),i.copy(n).applyMatrix4(t).applyMatrix4(a),i)})(),l=(e,t)=>(t=t||new n.Matrix4).compose(e.position,e.rotation,s.f.UNIT),c=(e,t,i,s,r)=>((r=r||new n.Vector2).x=e/i*2-1,r.y=-t/s*2+1,r),d=(e,t,i=.5,s)=>((s=s||new n.Vector3).x=t.x,s.y=t.y,s.z=i,h(e.pose,s)),h=(()=>{const e=new n.Matrix4,t=new n.Matrix4;return(i,s,r)=>((r=r||new n.Vector3).copy(s),t.copy(i.projection.asThreeMatrix4()),t.invert(),l(i,e),r.applyMatrix4(t).applyMatrix4(e))})(),u=(e,t,i,s)=>((s=s||new n.Vector2).set((i.x+1)*e/2,(1-i.y)*t/2),s)},18469:(e,t,i)=>{"use strict";i.d(t,{O:()=>CameraStartData,B:()=>CameraStartPose});var n=i(5087),s=i(32770);class CameraStartData extends s.V{constructor(e,t,i){super(),this.name="cam-start",this.icon=e,this.thumb=t,this.modified=new Date(0),this.pose=new CameraStartPose,i&&this.pose.copy(i)}copy(e){return this.icon=e.icon,this.thumb=e.thumb,this.modified=e.modified||new Date,this.pose.copy(e.pose),this}get hasCameraPose(){return this.pose&&this.pose.camera&&void 0!==this.pose.camera.position}}class CameraStartPose{constructor(e=n.Ey.Panorama,t,i,s,r,o){this.mode=e,this.camera={position:t||void 0,rotation:i||void 0,zoom:s||void 0},this.pano=r||{uuid:void 0},this.floorVisibility=o||void 0}copy(e){return this.camera.position=r(e.camera.position,this.camera.position),this.camera.rotation=r(e.camera.rotation,this.camera.rotation),this.camera.zoom=e.camera.zoom,this.pano.uuid=e.pano.uuid?e.pano.uuid.slice():void 0,this.mode=e.mode,this.floorVisibility=e.floorVisibility?e.floorVisibility.slice():void 0,this}}const r=(e,t)=>e&&t?t.copy(e):e&&!t?e.clone():void 0},73272:(e,t,i)=>{"use strict";i.d(t,{K:()=>NavigationUrl});var n=i(2212),s=i(5087),r=i(17597),o=i(88512),a=i(19674),l=i(44382);const c=new o.Z("navurl");class InvalidViewmodeError extends Error{constructor(e,t){super(`view mode ${e} is invalid${t?` when ${t}`:""}`)}}class NavigationUrl{static encodeVector3(e,t=2){const{x:i,y:n,z:s}=e;return NavigationUrl.packFloats([i,n,s],t)}static decodeVector3(e){const t=NavigationUrl.unpackFloats(e,3);return t?new n.Vector3(...t):null}static encodeQuaternion(e,t=2){return NavigationUrl.packFloats([e.x,e.y,e.z,e.w],t)}static decodeQuaternion(e){const t=NavigationUrl.unpackFloats(e,4);return t&&!(0,l.mB)(t)?new n.Quaternion(...t):null}static encodeEuler(e,t=2){return NavigationUrl.packFloats([e.x,e.y,e.z],t)}static decodeEuler(e){const t=NavigationUrl.unpackFloats(e,3);return t?new n.Euler(t[0],t[1],t[2],"XYZ"):void 0}static packFloats(e,t=2){let i=e.map((e=>{const i=parseFloat(e.toFixed(t)).toString().replace(/^(\-)?0+.(\d+)/,"$1.$2");return"0"===i?"":i})).join(",");return i=i.replace(/,+$/,""),i}static unpackFloats(e,t=0){const i=e.split(",").map((e=>""===e?0:parseFloat(e)));if(!i||i.includes(NaN))return[];for(;i.length<t;)i.push(0);return i}static getQueryString(e,t=!0){return NavigationUrl.serialize(e,t).toString()}static serialize(e,t=!0){const i=NavigationUrl.removeNavigationKeys();try{if(t){const t=NavigationUrl.getShortPose(e);for(const[e,n]of Object.entries(t))i.set(e,n)}else{const t=NavigationUrl.getStartPose(e),n=JSON.stringify(t);i.set("start",n)}}catch(e){c.debug(e)}return i}static deserialize(e=window.location.href){const t=new URL(e).searchParams;try{const e=t.get("start");return e?NavigationUrl.parseStartObject(e):NavigationUrl.parseShortUrl(t)}catch(e){c.debug(e)}return null}static removeNavigationKeys(){const e=(0,r.kD)();for(const t of["start","sm","sp","sq","sr","ss","sf","sz"])e.delete(t);return e}static parseShortUrl(e){const t=e.get("sm"),i=e.get("sp"),r=e.get("sq"),o=e.get("sr"),l=e.get("ss"),d=e.get("sf"),h=e.get("sz"),u=NavigationUrl.parseViewmode(t),p=NavigationUrl.decodeEuler(o||"")||new n.Euler(0,0,0),m=NavigationUrl.decodeQuaternion(r||"")||new n.Quaternion(0,0,0,1),f=i?NavigationUrl.decodeVector3(i):void 0,g=l?parseInt(l,10)-1:void 0,v=d?NavigationUrl.unpackFloats(d,4):void 0,y=h?parseFloat(h):void 0;if((0,s.Bw)(u)&&void 0===g)throw new InvalidViewmodeError(u,"sweep index not defined");if(!(0,s.Bw)(u)&&!f)throw new InvalidViewmodeError(u,"position is falsy");let b=r?m:(new n.Quaternion).setFromEuler(p);(0,s.Bw)(u)&&(b=(0,a.Z)(b));const S={mode:u,quaternion:b,position:f||void 0,sweepIndex:g,floorVisibility:v,zoom:y};return c.debug("Parsed short URL pose data:",S),S}static parseStartObject(e){const t=JSON.parse(decodeURIComponent(e));if(!t.camera_quaternion)throw Error("Start override is missing camera_quaternion");if(!t.camera_position)throw Error("Start override is missing camera_position");const i=NavigationUrl.parseViewmode(t.camera_mode),s=(new n.Quaternion).copy(t.camera_quaternion),r={mode:i,panoId:t.scan_id,position:(new n.Vector3).copy(t.camera_position),quaternion:s,zoom:t.ortho_zoom,floorVisibility:t.floor_visibility};return c.debug("Parsed &start URL pose data:",r),r}static getShortPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:r}){const o=(new n.Euler).setFromQuaternion(e.pose.rotation,"XYZ"),a=r.currentSweepIndex,l={};if(t.isInside())o.z=0,l.sr=NavigationUrl.encodeEuler(o),void 0!==a&&(l.ss=a+1),t.currentMode===s.Ey.Mesh&&(l.sm=NavigationUrl.validateViewmode(t.currentMode));else{l.sm=NavigationUrl.validateViewmode(t.currentMode),l.sr=NavigationUrl.encodeEuler(o),l.sp=NavigationUrl.encodeVector3(e.pose.position);const n=i.getFloorsVisibility();n.length&&i.totalFloors>1&&(l.sf=n)}return t.currentMode===s.Ey.Floorplan&&(l.sz=parseFloat(e.zoom().toFixed(2))),l.sq=NavigationUrl.encodeQuaternion(e.pose.rotation),c.debug(`Short URL params for current location ${JSON.stringify(l)}`),delete l.sq,l}static getStartPose({cameraData:e,viewmodeData:t,floorsViewData:i,sweepData:n}){const r={x:0,y:0,z:0,w:1};r.x=e.pose.rotation.x,r.y=e.pose.rotation.y,r.z=e.pose.rotation.z,r.w=e.pose.rotation.w;const o={x:0,y:0,z:0};o.x=e.pose.position.x,o.y=e.pose.position.y,o.z=e.pose.position.z;const a={camera_mode:NavigationUrl.validateViewmode(t.currentMode),camera_position:o,camera_quaternion:r};return t.isInside()?a.scan_id=n.currentSweep:a.floor_visibility=i.getFloorsVisibility(),t.currentMode===s.Ey.Floorplan&&(a.ortho_zoom=e.zoom()),a}static parseViewmode(e){let t=NavigationUrl.DEFAULT_VIEW_MODE;return null!=e&&(t=parseInt(e,10)),NavigationUrl.validateViewmode(t)}static validateViewmode(e){if(null===e||!NavigationUrl.VALID_URL_VIEW_MODES.includes(e))throw new InvalidViewmodeError(e);return e}}NavigationUrl.DEFAULT_VIEW_MODE=s.Ey.Panorama,NavigationUrl.VALID_URL_VIEW_MODES=[s.Ey.Panorama,s.Ey.Dollhouse,s.Ey.Floorplan,s.Ey.Outdoor,s.Ey.Mesh]},95877:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CameraStartModule});var n=i(79956),s=i(18469),r=i(47724),o=i(73272),a=i(5087),l=i(91466);class StartLocationSetMessage extends l.v{constructor(e){super(),this.is360=e}}var c=i(75892),d=i(19674),h=i(99252),u=i(38420),p=i(48602),m=i(50988),f=i(94474),g=i(12935),v=i(88512);class MdsCameraStartPatchSerializer{serialize(e){return{image:e.sid}}}var y=i(91985);const b=new v.Z("mds-camera-start-store");class MdsCameraStartStore extends f.u{constructor(){super(...arguments),this.deserializer=new g.f,this.serializer=new MdsCameraStartPatchSerializer}async update(e){const t=this.getViewId(),i=this.serializer.serialize(e);if(0===Object.keys(i).length)throw new Error("No data to update?");return this.mutate(y.PatchModel,{modelId:t,patch:i}).then((e=>{b.debug(e)}))}}var S=i(17386);class SetCameraStartCommand extends S.m{constructor(e){super(),this.payload={snapshotSid:e}}}SetCameraStartCommand.id="SET_CAMERA_START";var E=i(8445);class CameraStartModule extends r.Y{constructor(){super(...arguments),this.name="camera-start",this.store=null}async init(e,t){var i,r,a;const{readonly:l}=e;this.engine=t,[this.storage,this.sweepData,this.modelData]=await Promise.all([t.getModule(h.F),t.market.waitForData(c.Z),t.market.waitForData(E.T)]);const d=t.market.waitForData(n.P).then((e=>{this.snapshotsData=e})),m=o.K.deserialize();if(m){const e=this.parseNavigationPose(m);this.validStartPano(e)?(this.startingPose=new s.B,this.startingPose.copy(e),this.log.debug("Starting Camera Pose",this.startingPose)):this.log.error("Invalid start pose",e)}if(this.bindings.push(this.engine.commandBinder.addBinding(SetCameraStartCommand,(async e=>this.updateStartLocationFromSnapshot(e.snapshotSid)))),!l){this.store=new MdsCameraStartStore({readonly:l}),this.bindings.push(this.storage.onSave((()=>this.save()),{dataType:u.g.START_LOCATION}));const e=await t.market.waitForData(p.Q);e.setRevertableType(u.g.START_LOCATION),e.setPublishableType(u.g.START_LOCATION)}let f,g;const v=this.modelData.model.image,y=this.modelData.model.imagePose;if(y?(f=this.buildCameraStart(y),g=y.thumbnailUrl):v&&(await d,f=null!==(i=this.getIconStartPose(v))&&void 0!==i?i:void 0,g=this.getIconThumbnail(v)),f||(f=null!==(r=this.getStartFallback())&&void 0!==r?r:void 0),null===(a=null==f?void 0:f.pano)||void 0===a?void 0:a.uuid){const e=this.sweepData.getSweep(f.pano.uuid);e&&!e.enabled&&(this.log.warn(`Enabled hidden start sweep ${f.pano.uuid}`),e.enabled=!0,e.commit())}this.data=new s.O(v,g,f),t.market.register(this,s.O,this.data)}getStartingPose(){return this.startingPose||this.data.pose}parseNavigationPose(e){const{mode:t,quaternion:i,position:n,floorVisibility:s,sweepIndex:r,zoom:o}=e;let{panoId:a}=e;if(a&&!this.sweepData.containsSweep(a)){const e=this.sweepData.getSweepByUuid(a);e&&(a=e.id)}if(!a&&void 0!==r){const e=this.sweepData.getSweepByIndex(r);e?a=e.id:this.log.debug(`Failed to load sweep index ${r}`)}return{mode:t,camera:{position:n,rotation:i,zoom:o},pano:{uuid:a},floorVisibility:s}}async updateStartLocationFromSnapshot(e){const t=this.snapshotsData.get(e),i=this.buildCameraStart(t),n=new s.O(t.sid,t.thumbnailUrl,i);this.data.copy(n),this.data.commit(),this.engine.broadcast(new StartLocationSetMessage(t.is360)),await this.engine.commandBinder.issueCommand(new m.VQ({dataTypes:[u.g.START_LOCATION]}))}async save(){const e=this.data.icon;if(!e||!this.store)return void this.log.warn("Unable to save start location");const t=this.snapshotsData.get(e);return this.store.update(t)}buildCameraStart(e){const t={mode:e.metadata.cameraMode,camera:{position:e.metadata.cameraPosition,rotation:e.metadata.cameraQuaternion,zoom:e.metadata.orthoZoom},pano:{}};return(0,a.Bw)(t.mode)&&(t.pano={uuid:e.metadata.scanId}),t.floorVisibility=e.metadata.floorVisibility,t}defaultCameraStart(e){return{mode:a.Ey.Panorama,camera:{position:e.position,rotation:(0,d.Z)(e.rotation),zoom:0},pano:{uuid:e.id}}}validStartPano(e){return!!e&&(!(0,a.Bw)(e.mode)||!!e.pano.uuid&&this.sweepData.containsSweep(e.pano.uuid))}getStartFallback(){const e=this.sweepData.getFirstAlignedSweep()||this.sweepData.getFirstSweep();return void 0===e?null:this.defaultCameraStart(e)}getIconStartPose(e){let t=null;return e&&e in this.snapshotsData.collection&&(t=(new s.B).copy(this.buildCameraStart(this.snapshotsData.get(e)))),this.validStartPano(t)||(t=null),t}getIconThumbnail(e){if(e&&e in this.snapshotsData.collection)return this.snapshotsData.get(e).thumbnailUrl}}},37554:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CanvasExtModule});var n=i(51198),s=i(67790),r=i(47724),o=i(40168),a=i(8430),l=i(46228),c=i(2782);class CanvasExtModule extends r.Y{constructor(){super(...arguments),this.name="canvas-ext"}async init(e,t){this._canvas=e.canvas,this.msgBus=t.msgBus,this.canvasBounds=this._canvas.getBoundingClientRect(),this.bindings.push(t.commandBinder.addBinding(a.M,(async function(){})),t.commandBinder.addBinding(l.L,(async function(){})),t.commandBinder.addBinding(c.n,(async function(){}))),this.data=new o.W(this.canvasBounds.width,this.canvasBounds.height),t.market.register(this,o.W,this.data)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){this.canvasBounds=this._canvas.getBoundingClientRect();const e=this.data.width!==this.width||this.data.height!==this.height,t=this.data.x!==this.x||this.data.y!==this.y;e&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.msgBus.broadcast(new s.a(this.width,this.height))),t&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.msgBus.broadcast(new n.k(this.x,this.y)))}}},36016:(e,t,i)=>{"use strict";i.d(t,{lb:()=>s,hf:()=>r});var n=i(8430);const s=(e=200)=>({resizeDimensions:[{property:n.P.width,setDimension:e=>e.width,duration:e},{property:n.P.height,setDimension:e=>e.height,duration:e},{property:n.P.top,setDimension:()=>0,duration:e},{property:n.P.left,setDimension:()=>0,duration:e}]}),r=(e,t,i,s=200)=>{const r=[];return void 0!==e&&r.push({property:n.P.width,setDimension:t=>t.width+e,duration:s}),void 0!==t&&r.push({property:n.P.height,setDimension:e=>e.height+t,duration:s}),void 0!==i&&r.push({property:n.P.left,setDimension:()=>i,duration:s}),{resizeDimensions:r}}},2782:(e,t,i)=>{"use strict";i.d(t,{n:()=>BlurCanvasCommand});var n=i(17386);class BlurCanvasCommand extends n.m{constructor(e,t){super(),this.name="blur-canvas",this.payload={duration:e,pixelBlur:t}}}},8430:(e,t,i)=>{"use strict";i.d(t,{P:()=>n,M:()=>ResizeCanvasCommand});var n,s=i(17386);!function(e){e.left="left",e.top="top",e.width="width",e.height="height"}(n||(n={}));class ResizeCanvasCommand extends s.m{constructor(e){super(),this.name="resize-canvas",this.payload=Object.assign({},e)}}},46228:(e,t,i)=>{"use strict";i.d(t,{L:()=>ScreenToCanvasPointCommand});var n=i(17386);class ScreenToCanvasPointCommand extends n.m{constructor(e){super(),this.name="screen-to-canvas-point",this.payload=Object.assign({},e)}}},40168:(e,t,i)=>{"use strict";i.d(t,{W:()=>CanvasData});var n=i(32770);class CanvasData extends n.V{constructor(e,t){super(),this.name="canvas",this.x=0,this.y=0,this.width=e||0,this.height=t||0}get aspectRatio(){const e=this.width/this.height;return isFinite(e)?e:1}}},86718:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CanvasModule});var n=i(47724),s=i(40168),r=i(67790),o=i(51198),a=i(8430),l=i(64185),c=i(46228),d=i(10757),h=i(2782),u=i(85917),p=i(31102);class CanvasMountError extends p.y{}const m={[a.P.width]:"width",[a.P.height]:"height",[a.P.top]:"top",[a.P.left]:"left"};class CanvasModule extends n.Y{constructor(){super(...arguments),this.name="canvas",this.getNewX=()=>0,this.getNewY=()=>0,this.getNewWidth=e=>e.width,this.getNewHeight=e=>e.height,this.activeTransitions=[],this.activeTransitionMap={left:null,top:null,width:null,height:null},this.onResize=e=>{e.propertyName in a.P&&(this.resolveActiveTransition(e.propertyName),this._canvas.style.transitionDuration=this.stringifyTransitionDurations())},this.onWindowResize=()=>{this.transitionDurations.left=this.transitionDurations.top=this.transitionDurations.width=this.transitionDurations.height="0s",this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition(),this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),this._canvas.style.transitionDuration=this.stringifyTransitionDurations()},this.resizeCanvas=async e=>{if(0!==e.resizeDimensions.length)return this.activeTransitions.forEach(this.resolveActiveTransition.bind(this)),e.resizeDimensions.forEach((e=>{const{property:t,setDimension:i,duration:n=0}=e,s=m[t],r=this._canvas.style[s];switch(t){case a.P.height:this.setHeight(i,n);break;case a.P.width:this.setWidth(i,n);break;case a.P.top:this.setY(i,n);break;case a.P.left:this.setX(i,n)}if(this._canvas.style[s]!==r&&n>0){const e=new l.Q;e.then((()=>{clearTimeout(i)}));const i=setTimeout((()=>{this.resolveActiveTransition(t)}),n+500);this.activeTransitionMap[t]=e,this.activeTransitions.push(t)}})),this.hasActiveTransitions()||(this.canvasBounds=this._canvas.getBoundingClientRect()),this.getTransitionPromise()}}async init(e,t){if(this.engine=t,!e.container)throw new CanvasMountError;this.container=e.container,this.container.appendChild(e.canvas),this.containerBounds=this.container.getBoundingClientRect(),this._canvas=e.canvas,this._canvas.setAttribute("tabindex","-1"),this._canvas.style.position="absolute",this._canvas.style.left="0",this._canvas.style.top="0",this.transitionDurations={left:"0s",top:"0s",width:"0s",height:"0s",filter:"0.4s"},this._canvas.style.transitionProperty=Object.keys(this.transitionDurations).join(","),this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.updateTransitions(),this.bindings.push((0,u.kp)(u.g_.RESIZE,this.onWindowResize),t.commandBinder.addBinding(a.M,this.resizeCanvas),this.makeTransitionEndSubscription(),t.commandBinder.addBinding(c.L,(async e=>this.screenToCanvasPoint(e.x,e.y))),t.commandBinder.addBinding(h.n,this.blur.bind(this)));for(const e of this.bindings)e.renew();this.canvasBounds=this._canvas.getBoundingClientRect(),this.containerBounds=this.container.getBoundingClientRect(),this.data=new s.W(this.canvasBounds.width,this.canvasBounds.height),t.market.register(this,s.W,this.data)}makeTransitionEndSubscription(){let e=!1;return{renew:()=>{e||(this.element.addEventListener("transitionend",this.onResize),e=!0)},cancel:()=>{e&&(this.element.removeEventListener("transitionend",this.onResize),e=!1)}}}dispose(e){super.dispose(e)}get element(){return this._canvas}get width(){return this.canvasBounds.width}get height(){return this.canvasBounds.height}get x(){return this.canvasBounds.left}get y(){return this.canvasBounds.top}onUpdate(){const e=this.container.getBoundingClientRect(),t=this.containerHasChanged(e);t&&(this.containerBounds=e,this.updateTransitions()),(t||this.hasActiveTransitions())&&(this.canvasBounds=this._canvas.getBoundingClientRect());const i=this.data.width!==this.width||this.data.height!==this.height,n=this.data.x!==this.x||this.data.y!==this.y;i&&(this.data.width=this.width,this.data.height=this.height,this.data.commit(),this.engine.broadcast(new r.a(this.width,this.height))),n&&(this.data.x=this.x,this.data.y=this.y,this.data.commit(),this.engine.broadcast(new o.k(this.x-this.containerBounds.left,this.y-this.containerBounds.top)))}containerHasChanged(e){return e.left!==this.containerBounds.left||e.top!==this.containerBounds.top||e.width!==this.containerBounds.width||e.height!==this.containerBounds.height}setX(e,t=0){this.getNewX="number"==typeof e?()=>e:e,this.transitionDurations.left=`${t}ms`,this.updateTransitions()}setY(e,t=0){this.getNewY="number"==typeof e?()=>e:e,this.transitionDurations.top=`${t}ms`,this.updateTransitions()}setWidth(e,t=0){this.getNewWidth="number"==typeof e?()=>e:e,this.transitionDurations.width=`${t}ms`,this.updateTransitions()}setHeight(e,t=0){this.getNewHeight="number"==typeof e?()=>e:e,this.transitionDurations.height=`${t}ms`,this.updateTransitions()}screenToCanvasPoint(e,t){return{x:e-this.x,y:t-this.y}}async blur(e){this.transitionDurations.filter=`${e.duration}ms`,this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this._canvas.style.filter=`blur(${e.pixelBlur}px)`,await(0,d.gw)(e.duration),0===e.pixelBlur&&(this._canvas.style.filter="")}getTransitionPromise(){return Promise.all(this.activeTransitions.map((e=>this.activeTransitionMap[e])).filter((e=>!!e)))}updateTransitions(){this._canvas.style.transitionDuration=this.stringifyTransitionDurations(),this.applySize(),this.applyPosition()}applySize(){this._canvas.style.width=`${this.getNewWidth(this.containerBounds)}px`,this._canvas.style.height=`${this.getNewHeight(this.containerBounds)}px`}applyPosition(){this._canvas.style.left=`${this.getNewX(this.containerBounds)}px`,this._canvas.style.top=`${this.getNewY(this.containerBounds)}px`}stringifyTransitionDurations(){return Object.keys(this.transitionDurations).map((e=>this.transitionDurations[e])).join(",")}resolveActiveTransition(e){this.canvasBounds=this._canvas.getBoundingClientRect();const t=this.activeTransitions.indexOf(e);-1!==t&&this.activeTransitions.splice(t,1);const i=this.activeTransitionMap[e];i&&i.resolve(),this.activeTransitionMap[e]=null,this.transitionDurations[e]="0s"}hasActiveTransitions(){return this.activeTransitions.length>0}}},16785:(e,t,i)=>{"use strict";i.d(t,{Z:()=>CommonControls});class CommonControls{}},13988:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CommonControlsModule});var n=i(47724),s=i(35597);class CommonControlsModule extends n.Y{constructor(){super(...arguments),this.name="common-controls"}async init(e,t){this.modeControls={},t.market.waitForData(s.O).then((e=>this.viewmodeData=e))}startRotateTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startRotateTransition(e,t,i)))}startZoomTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startZoomTransition(e,t,i)))}startTranslateTransition(e,t,i=!0){return this.checkControlsForAction((n=>n.startTranslateTransition(e,t,i)))}stop(){return this.checkControlsForAction((e=>(e.stop(),Promise.resolve())))}checkControlsForAction(e){if(this.viewmodeData&&null!==this.viewmodeData.currentMode){if(this.modeControls[this.viewmodeData.currentMode]){return e(this.modeControls[this.viewmodeData.currentMode].controls)}}return Promise.reject("checkControlsForAction() -> Current view mode is null")}addControls(e,t,i=!1){this.modeControls[e]&&!i||(this.modeControls[e]={mode:e,controls:t})}}},63739:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CurrentPanoMarker});var n=i(47724),s=i(96909),r=i(2212),o=i(48358),a=i(26605);const l=new r.Vector3(0,1,0),c=16724312,d=[{innerRadius:0,outerRadius:.42,color:c,opacity:.7},{innerRadius:.67,outerRadius:1,color:c,opacity:.7}];class MarkerRenderer{constructor(e,t,i){this.scene=e,this.sweepData=t,this.mesh=new a.f({radius:.25,normal:l,rings:d}),this.mesh.name="CurrentPanoMarker",this.mesh.renderOrder=o.z.panoMarker,this.mesh.layers.mask=i.mask}init(){}dispose(){this.mesh.dispose()}render(){const e=this.sweepData.currentAlignedSweepObject;e&&this.move(e.floorPosition)}activate(){this.scene.add(this.mesh)}deactivate(){this.scene.remove(this.mesh)}move(e){this.mesh.position.copy(e).setY(e.y+MarkerRenderer.floorOffset)}}MarkerRenderer.floorOffset=.01;var h=i(35597),u=i(75892),p=i(17386);class TogglePanoMarkerCommand extends p.m{constructor(e){super(),this.id="TOGGLE_PANO_MARKER",this.payload={enabled:e}}}var m=i(5087),f=i(33874),g=i(73710);class CurrentPanoMarker extends n.Y{constructor(){super(...arguments),this.name="current-pano-marker",this.state={markerEnabled:!1,transitionPromise:null}}async init(e,t){const i=(await t.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene(),n=t.claimRenderLayer(this.name),[r,o,a]=await Promise.all([t.market.waitForData(f.e),t.market.waitForData(u.Z),t.market.waitForData(h.O)]);this.engine=t,this.settingsData=r,this.sweepData=o,this.viewmodeData=a,this.markerRenderer=new MarkerRenderer(i,o,n),this.bindings.push(t.commandBinder.addBinding(TogglePanoMarkerCommand,(async({enabled:e})=>this.setCommandOverride(e))),this.viewmodeData.makeModeChangeSubscription((()=>this.updateMarker())),this.sweepData.makeSweepChangeSubscription((()=>this.updateMarker())),this.settingsData.onPropertyChanged(g.o,(()=>this.updateMarker()))),this.updateMarker()}setCommandOverride(e){this.state.commandOverride=e,this.updateMarker()}async updateMarker(){const{commandOverride:e}=this.state,t=this.viewmodeData.currentMode,i=this.sweepData.currentAlignedSweepObject,n=!1===this.settingsData.tryGetProperty(g.o,!0)||!1===e||(0,m.Bw)(t)||t===m.Ey.Transition;return this.toggleMarker(!!i&&!n)}async toggleMarker(e){const{markerEnabled:t,transitionPromise:i}=this.state;if(i&&await i,t===e)return;const n=e?this.enableMarker():this.disableMarker();return this.state.transitionPromise=n.finally((()=>{this.state.markerEnabled=e,this.state.transitionPromise=null})),this.state.transitionPromise}async enableMarker(){return this.engine.addComponent(this,this.markerRenderer)}async disableMarker(){return this.engine.removeComponent(this,this.markerRenderer)}}},73710:(e,t,i)=>{"use strict";i.d(t,{o:()=>n});const n="features/current_sweep_indicator"},55461:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n="features/cursor"},63781:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorDataModule});var n=i(96909),s=i(47724),r=i(2212),o=i(8482),a=i(69927),l=i(49340),c=i(44019);class CursorDataModule extends s.Y{constructor(){super(...arguments),this.name="cursor-data",this.cursorState=new a.Y,this.position=new r.Vector2,this.timeToFade=0,this.onPointerMove=()=>{if(null!==this.raycasterData.hit&&this.raycasterData.pointerNdcPosition.distanceToSquared(this.position)>CursorDataModule.movementThreshold){this.position.copy(this.raycasterData.pointerNdcPosition),this.timeToFade=CursorDataModule.fadeOutDelay;const e=(0,o.t)(0,CursorDataModule.fadeInDuration,1-this.cursorState.opacity.value);this.cursorState.opacity.modifyAnimation(this.cursorState.opacity.value,1,e),this.cursorState.commit()}}}async init(e,t){this.input=await t.getModuleBySymbol(n.y.INPUT),this.raycasterData=await t.market.waitForData(c.P),t.market.register(this,a.Y,this.cursorState),this.bindings.push(this.input.registerHandler(l.mE,this.onPointerMove)),CursorDataModule.fadeInDuration>CursorDataModule.fadeOutDelay&&this.log.warn("fadeInDuration should be less than fadeOutDelay!")}onUpdate(e){let t=!1;this.timeToFade>0&&(this.timeToFade-=e,this.timeToFade<=0&&(t=!0)),this.cursorState.opacity.tick(e),this.cursorState.commit(),t&&this.cursorState.opacity.modifyAnimation(1,0,CursorDataModule.fadeOutDuration)}dispose(e){super.dispose(e)}}CursorDataModule.fadeOutDelay=700,CursorDataModule.fadeOutDuration=700,CursorDataModule.fadeInDuration=300,CursorDataModule.movementThreshold=.003},69927:(e,t,i)=>{"use strict";i.d(t,{Y:()=>CursorData});var n=i(17131),s=i(32770);class CursorData extends s.V{constructor(){super(),this.name="cursor",this.opacity=new n.z(0),this.texture=null}}},71682:(e,t,i)=>{"use strict";var n;i.d(t,{L:()=>n}),function(e){e[e.Reticle=0]="Reticle",e[e.GridPlane=1]="GridPlane"}(n||(n={}))},68113:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>CursorMesh});var n=i(47724),s=i(96909),r=i(2212),o=i(69927),a=i(44019),l=i(84561),c=i(71682),d=i(48358),h=i(26605);const u=[{outerRadius:.977,innerRadius:.926,color:16777215,opacity:1},{outerRadius:.898,innerRadius:.648,color:16777215,opacity:.73}];class Cursor{constructor(e,t=l.o.ALL){this.scene=e,this.layer=t,this.supportsMobile=!1,this.style=c.L.Reticle,this.bindings=[],this.onCursorDataUpdated=e=>{this.mesh.configure({opacity:e.opacity.value,texture:e.texture})},this.onPositionUpdate=e=>{if(e.hit&&e.hit.face){const t=e.hit.point.clone(),i=e.hit.face.normal;this.container.position.copy(t),this.mesh.configure({normal:i})}},this.container=new r.Group,this.container.name="cursor",this.mesh=new h.f({radius:.2,rings:u}),this.container.add(this.mesh),this.mesh.renderOrder=d.z.reticule,this.mesh.layers.mask=this.layer.mask}init(){}render(){}dispose(){this.mesh.dispose(),this.container.children.forEach((e=>{if(e.isMesh&&e!==this.mesh){e.geometry.dispose();const t=e.material;t.dispose(),t.map&&t.map.dispose()}}))}async activate(e){const t=await e.market.waitForData(o.Y),i=await e.market.waitForData(a.P);this.bindings.push(t.onChanged(this.onCursorDataUpdated),i.onChanged(this.onPositionUpdate)),this.scene.add(this.container)}deactivate(){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}setVisible(e){this.container.visible=e}}class CursorMesh extends n.Y{constructor(){super(...arguments),this.name="cursor-mesh",this.setVisible=e=>{this.cursor&&this.cursor.setVisible(e)}}async init(e,t){const i=(await t.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene(),n=t.claimRenderLayer(this.name);this.cursor=new Cursor(i,n),t.addComponent(this,this.cursor)}get container(){return this.cursor.container}}},55130:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>DollhouseControls});var n=i(47724),s=i(96909),r=i(12216),o=i(13988),a=i(81040),l=i(51869),c=i(88727),d=i(81507),h=i(88216),u=i(76870),p=i(68576),m=i(35597),f=i(5087),g=i(60771),v=i(27408),y=i(7170),b=i(19674),S=i(2212),E=i(63560),T=i(14735),w=i(67027),x=i(68524),_=i(16785),M=i(64185),O=i(31278);const A=1e3/60,C=89*y.Ue,P=.001*y.Ue,D=.25,N=Math.PI/1e3,I=x.Z.epsilon;class CameraControls extends _.Z{constructor(e,t,i,n=!1){super(),this.cameraPoseProxy=e,this.cameraCheck=t,this.tempOrientation=new S.Quaternion,this.tempAxis=new S.Vector3,this.nextPosition=new S.Vector3,this.nextOrientation=new S.Quaternion,this.currentOrientation=new S.Quaternion,this.currentPosition=new S.Vector3,this.positionDelta=new S.Vector3,this.angularAccel=new S.Vector2,this.angularVelocity=new S.Vector2,this.linearAccel=new S.Vector2,this.linearVelocity=new S.Vector2,this.zoomAccel=0,this.zoomVelocity=0,this.cameraOrientation=new S.Euler,this.aimTarget=new S.Vector3,this.poseController=null,this.currentPhiLowerLimit=P,this.currentPhiUpperLimit=C,this.checkBounds=n,this._maxZoomDistance=Math.max(30,1.5*i.getSize(new S.Vector3).length()),this.transition={active:!1,startTime:0,elapsed:0,duration:0,angularVelocity:new S.Vector2,linearVelocity:new S.Vector2,zoomVelocity:0,easeOut:!1}}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.stop()}get maxZoomDistance(){return this._maxZoomDistance}setOrbitalAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.angularVelocity),this.angularAccel.x=void 0!==e.x?e.x:this.angularAccel.x,this.angularAccel.y=void 0!==e.y?e.y:this.angularAccel.y)}setPanAcceleration(e,t=!1){this.transition.active||(t&&this.haltVelocity(e,this.linearVelocity),this.linearAccel.x=void 0!==e.x?e.x:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y:this.linearAccel.y)}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}async setPhiLimits(e,t,i){this.currentPhiLowerLimit=e,this.currentPhiUpperLimit=t;const n=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(n.rotation,"YXZ");const s=-this.cameraOrientation.x,r=(0,v.uZ)(0,this.currentPhiLowerLimit-s,this.currentPhiUpperLimit-s);Math.abs(r)>I&&i&&await this.orbit(new S.Vector2,!0)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startTransition(e,t,i,n,s){if(null===this.poseController)return M.Q.reject("Unable to start transition, since controller is unavailable.");const r=new M.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=r,this.transition.angularVelocity.copy(t),this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=n,this.transition.easeOut=s,this.angularAccel.set(0,0),this.linearAccel.set(0,0),this.zoomAccel=0,this.angularVelocity.copy(t),this.linearVelocity.copy(i),this.zoomVelocity=n,this.poseController.beginExternalTransition(),r.promise()}stopTransition(){this.transition.active&&(this.poseController&&this.poseController.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i,n){let s=1,r=e/A;if(this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){s=(this.transition.duration-(this.transition.elapsed-e))/e,r=1}t&&(this.angularVelocity.copy(this.transition.angularVelocity).multiplyScalar(s*r),this.orbit(this.angularVelocity)),i&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(s*r),this.pan(this.linearVelocity)),n&&(this.zoomVelocity=this.transition.zoomVelocity*s*r,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}updateDefault(e,t,i,n){const s=e/A;t&&(this.angularVelocity.addScaledVector(this.angularAccel,s),this.orbit(this.angularVelocity),this.angularVelocity.multiplyScalar(Math.pow(.92,s))),i&&(this.linearVelocity.addScaledVector(this.linearAccel,s),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(.92,s))),n&&(this.zoomVelocity+=this.zoomAccel*s,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(.84,s))}startRotateTransition(e,t,i){return t.x*=-1,this.startTransition(e,t.clone().multiplyScalar(A),new S.Vector2,0,i).nativePromise()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,new S.Vector2,t.clone().multiplyScalar(A),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,new S.Vector2(0,0),new S.Vector2(0,0),t,i).nativePromise()}update(e){const t=this.angularAccel.length()>I||this.angularVelocity.length()>I,i=this.linearAccel.length()>I||this.linearVelocity.length()>I,n=Math.abs(this.zoomAccel)>I||Math.abs(this.zoomVelocity)>I;this.transition.active?this.updateTransition(e,t,i,n):this.updateDefault(e,t,i,n)}stopMomentum(){this.transition.active||(this.angularVelocity.set(0,0),this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setOrbitalAcceleration({x:0,y:0}),this.setPanAcceleration({x:0,y:0}),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose;this.positionDelta.x=e.x,this.positionDelta.z=e.y,this.nextPosition.copy(t.position).add(this.positionDelta),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,t.focalDistance)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition))}orbit(e,t=!1){if(!this.poseController)return;const i=this.cameraPoseProxy.pose;this.cameraOrientation.setFromQuaternion(i.rotation,"YXZ");const n=-this.cameraOrientation.x,s=(0,v.uZ)(e.y,this.currentPhiLowerLimit-n,this.currentPhiUpperLimit-n);if(this.aimTarget.copy(r.f.FORWARD).applyQuaternion(i.rotation),this.aimTarget.setLength(i.focalDistance),this.aimTarget.addVectors(i.position,this.aimTarget),this.tempAxis.copy(r.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(i.rotation),-s),this.nextPosition.copy(i.position).sub(this.aimTarget).applyQuaternion(this.tempOrientation),this.nextOrientation.copy(i.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(r.f.UP,e.x),this.nextPosition.applyQuaternion(this.tempOrientation),this.nextOrientation.premultiply(this.tempOrientation),this.nextPosition=this.nextPosition.add(this.aimTarget),this.nextOrientation.normalize(),!this.checkBounds||this.cameraCheck(i.position,this.nextOrientation,i.focalDistance)){if(this.currentPosition.copy(this.nextPosition),this.currentOrientation.copy(this.nextOrientation),t)return this.poseController.moveTo({transitionType:O.n.Interpolate,pose:{position:this.currentPosition.clone(),rotation:this.currentOrientation.clone()},transitionTime:500});i.rotation.equals(this.currentOrientation)||(this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraRotation(this.currentOrientation))}}zoom(e){if(!this.poseController)return;const t=this.cameraPoseProxy.pose,i=this.maxZoomDistance-D,n=t.focalDistance,s=(0,v.uZ)(e*i+n,D,this.maxZoomDistance)-n,o=t.focalDistance+s;this.nextPosition.copy(t.position).add(r.f.FORWARD.clone().applyQuaternion(t.rotation).setLength(-s)),this.checkBounds&&!this.cameraCheck(this.nextPosition,t.rotation,o)||(this.currentPosition.copy(this.nextPosition),this.poseController.updateCameraPosition(this.currentPosition),this.poseController.updateCameraFocus(o))}}var L=i(27687);class CameraTouchControls{constructor(e,t,i){this.poseProxy=e,this.cameraCheck=t,this.raycaster=i,this.movingCamera=!1,this.smoothedTouch0=new S.Vector2,this.smoothedTouch1=new S.Vector2,this.origTouchAxis=new S.Vector2,this.origCenterPt=new S.Vector2,this.plane=new S.Plane(r.f.UP.clone(),0),this.originalPinchLength=0,this.pointersMoved=(()=>{const e=new S.Vector2,t=new S.Vector3,i=new S.Vector3,n=new S.Vector2,s=new S.Vector3;return o=>{if(!this.poseController)return;this.smoothedTouch0.lerp(o[0].position,.2),this.smoothedTouch1.lerp(o[1].position,.2),n.copy(this.smoothedTouch1).sub(this.smoothedTouch0).normalize();const a=this.origTouchAxis.angle()-n.angle();t.copy(this.initialPose.position);const l=new S.Vector3(-this.intersectionPt.x,0,-this.intersectionPt.z);t.add(l),t.applyAxisAngle(r.f.UP,a),l.negate(),t.add(l);const c=(new S.Quaternion).copy(this.initialPose.rotation),d=(new S.Quaternion).setFromAxisAngle(r.f.UP,a);c.premultiply(d);const h=this.smoothedTouch0.clone().lerp(this.smoothedTouch1,.5),u=new S.Vector3;if(i.copy(r.f.FORWARD).applyQuaternion(c),this.castFrom(h.x,i.y<-.01?h.y:this.origCenterPt.y,u),isNaN(u.x))return void(this.movingCamera=!1);u.x-=this.intersectionPt.x,u.z-=this.intersectionPt.z,u.negate(),u.applyAxisAngle(r.f.UP,a);const p=1-1/(e.subVectors(this.smoothedTouch0,this.smoothedTouch1).length()/this.originalPinchLength),m=t.add(u).lerp(this.intersectionPt,p).clone(),f=s.subVectors(m,this.intersectionPt).length();this.cameraCheck(m,c,f)&&this.poseController&&(this.poseController.updateCameraPosition(m),this.poseController.updateCameraRotation(c),this.poseController.updateCameraFocus(f))}})(),this.initMove=(()=>{const e=new S.Vector2,t=new S.Ray,i=new S.Vector3;return n=>{const s=n[0].position,o=n[1].position;this.smoothedTouch0.copy(s),this.smoothedTouch1.copy(o),this.originalPinchLength=e.subVectors(s,o).length(),this.origTouchAxis.copy(o).sub(s).normalize(),this.origCenterPt.copy(s).lerp(o,.5);const{pose:a}=this.poseProxy;this.initialPose=a.clone();const l=new S.Vector3,c=new S.Vector3;(0,L.Kh)(this.initialPose,l.set(this.origCenterPt.x,this.origCenterPt.y,-1),l),(0,L.Kh)(this.initialPose,c.set(this.origCenterPt.x,this.origCenterPt.y,1),c),c.sub(l).normalize();const d=this.raycaster.picking.pick(l,c);d||(t.set(l,c),t.at(a.focalDistance,i)),this.intersectionPt=d?d.point:i,this.plane.set(r.f.UP.clone(),0),this.plane.translate(new S.Vector3(0,this.intersectionPt.y,0))}})(),this.castFrom=(()=>{const e=new S.Ray,t=new S.Vector3,i=new S.Vector3;return(n,s,r)=>{(0,L.Kh)(this.initialPose,t.set(n,s,-1),t),(0,L.Kh)(this.initialPose,i.set(n,s,1),i),i.sub(t).normalize(),e.set(t,i),e.intersectPlane(this.plane,r)&&!r.equals(t)||(r.x=NaN),r.y=0}})()}rawPointerUpdate(e){const t=this.movingCamera;this.movingCamera=2===e.pointers.length&&!!this.poseController,this.movingCamera&&(t?this.pointersMoved(e.pointers):this.initMove(e.pointers))}onAccessGranted(e){this.poseController=e}onAccessRevoked(e){this.poseController=void 0,this.movingCamera=!1}}var R,k=i(17386);class SetDollhouseVerticalLimits extends k.m{constructor(e){super(),this.payload=e,this.id="DOLLHOUSE_VERTICAL_LIMITS"}}!function(e){e[e.NONE=u.r3.NONE]="NONE",e[e.ROTATE=u.r3.PRIMARY]="ROTATE",e[e.PAN=u.r3.SECONDARY]="PAN",e[e.ZOOM=u.r3.MIDDLE]="ZOOM"}(R||(R={}));class DollhouseControls extends n.Y{constructor(){super(...arguments),this.name="dollhouse-controls",this.controlState=R.NONE,this.movementKeys=new S.Vector2,this.adjustedBounds=new S.Box3,this.didDrag=!1,this.resetControlState=()=>{this.controlState=R.NONE},this.convertDeltaToLocal=(()=>{const e=new S.Vector3,t=new S.Vector3;return i=>{const n=i.x||0,s=i.y||0,o=2*n*this.cameraPoseProxy.pose.focalDistance,a=2*s*this.cameraPoseProxy.pose.focalDistance/this.cameraPoseProxy.pose.aspect();return e.copy(r.f.RIGHT).applyQuaternion(this.cameraPoseProxy.pose.rotation).setY(0).setLength(o),t.copy(r.f.FORWARD).applyQuaternion(this.cameraPoseProxy.pose.rotation),e.add(t.setY(0).setLength(a)),e}})(),this.cameraCheck=(()=>{function e(e){return e.x>=1||e.x<=-1||e.y>=1||e.y<=-1||e.z<=-1||e.z>=1}const t=[];for(let e=0;e<8;e++)t.push(new S.Vector3);const i=new S.Matrix4,n=new S.Matrix4,s=new S.Box3;return(o,a,l)=>{if(l<D)return!1;if(!(0,b.cb)(o,a,this.cameraPoseProxy.pose.projection,this.adjustedBounds))return!1;(0,b.jB)(this.meshData.bounds,t),i.compose(o,a,r.f.UNIT),i.invert(),n.copy(this.cameraPoseProxy.pose.projection.asThreeMatrix4()),s.makeEmpty();let c=!1;for(let e=0;e<8;e++)t[e].applyMatrix4(i),t[e].z=(0,v.uZ)(t[e].z,-E.oR.far,-E.oR.near),t[e].applyMatrix4(n),s.expandByPoint(t[e]);c=e(s.min)||e(s.max),s.min.clampScalar(-1,1),s.max.clampScalar(-1,1);return(s.max.x-s.min.x)*(s.max.y-s.min.y)>(c?.05:.01)}})()}async init(e,t){this.cameraPoseProxy=e.cameraPoseProxy,[this.viewmodeData,this.meshData,this.commonControlsModule]=await Promise.all([t.market.waitForData(m.O),t.market.waitForData(w._),t.getModule(o.default)]),this.bindings.push(t.subscribe(p.Z,(e=>{this.controls.stop(),this.resetControlState()}))),t.commandBinder.addBinding(SetDollhouseVerticalLimits,(async e=>this.controls.setPhiLimits(void 0!==e.phiLowerLimitDegrees?e.phiLowerLimitDegrees*y.Ue:P,void 0!==e.phiUpperLimitDegrees?e.phiUpperLimitDegrees*y.Ue:C,this.validateViewmode())));const i=await t.getModuleBySymbol(s.y.INPUT);this.setupBounds(),this.controls=new CameraControls(this.cameraPoseProxy,this.cameraCheck,this.meshData.bounds,!0),this.commonControlsModule.addControls(f.Ey.Dollhouse,this.controls);const n=await t.getModuleBySymbol(s.y.RAYCASTER);this.cameraTouchControls=new CameraTouchControls(this.cameraPoseProxy,this.cameraCheck,n),this.bindings.push(i.registerHandler(a.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(i.registerHandler(l.E0,(e=>{this.validateViewmode()&&(this.didDrag=!1,this.onDragBegin(e.buttons))}))),this.bindings.push(i.registerHandler(l._R,(e=>{this.validateViewmode()&&(e.timeSinceLastMove<100&&this.didDrag&&(this.onDrag(e.delta),this.controls.update(A),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons))}))),this.bindings.push(i.registerHandler(l._t,(e=>{this.validateViewmode()&&(this.didDrag=!0,this.onDrag(e.delta),this.controls.update(A),this.controls.stop())}))),this.bindings.push(i.registerHandler(T.h,(e=>{this.validateViewmode()&&this.cameraTouchControls.rawPointerUpdate(e)}))),this.bindings.push(i.registerHandler(c.e,(e=>{this.validateViewmode()&&e.state!==h.M.PRESSED&&this.onKey(e.key,e.state)}))),this.cameraPoseProxy.newSession(this)}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onAccessGranted(e){this.controls.onAccessGranted(e),this.cameraTouchControls.onAccessGranted(e)}onAccessRevoked(e){this.controls.onAccessRevoked(e),this.cameraTouchControls.onAccessRevoked(e)}onScrollWheel(e){if(0!==e.delta.y){const t=1/this.cameraPoseProxy.pose.focalDistance*2,i=this.modelSize;this.controls.setZoomAcceleration(.1*e.delta.y/(t*i*500)),this.controls.update(A),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===R.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case R.ROTATE:this.controls.setOrbitalAcceleration({x:-Math.PI*e.x,y:-Math.PI*e.y});break;case R.PAN:const t=this.convertDeltaToLocal(e);this.controls.setPanAcceleration({x:-t.x,y:-t.z});break;case R.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=R.NONE,(0,g.tq)()&&this.controls.stop())}onKey(e,t){const i=t===h.M.DOWN;let n=!1;switch(e){case d.R.LEFTARROW:case d.R.J:this.controls.setOrbitalAcceleration({x:i?N:0},!0);break;case d.R.RIGHTARROW:case d.R.L:this.controls.setOrbitalAcceleration({x:i?-N:0},!0);break;case d.R.UPARROW:case d.R.I:this.controls.setOrbitalAcceleration({y:i?-N:0},!0);break;case d.R.DOWNARROW:case d.R.K:this.controls.setOrbitalAcceleration({y:i?N:0},!0);break;case d.R.W:this.movementKeys.y=i?1:0,n=!0;break;case d.R.S:this.movementKeys.y=i?-1:0,n=!0;break;case d.R.D:this.movementKeys.x=i?1:0,n=!0;break;case d.R.A:this.movementKeys.x=i?-1:0,n=!0}if(n){const e=this.convertDeltaToLocal(this.movementKeys).setLength(.02);this.controls.setPanAcceleration({x:e.x,y:e.z})}}validateViewmode(){return this.viewmodeData.currentMode===f.Ey.Dollhouse}setupBounds(){function e(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}this.modelSize=Math.max(this.meshData.size.length(),1),this.adjustedBounds.copy(this.meshData.bounds);const t=-2;this.adjustedBounds.min.x=e(this.adjustedBounds.min.x,t),this.adjustedBounds.min.y=e(this.adjustedBounds.min.y,t),this.adjustedBounds.min.z=e(this.adjustedBounds.min.z,t),this.adjustedBounds.max.x=e(this.adjustedBounds.max.x,2),this.adjustedBounds.max.y=e(this.adjustedBounds.max.y,2),this.adjustedBounds.max.z=e(this.adjustedBounds.max.z,2);const i=new S.Vector3;this.adjustedBounds.getSize(i),this.adjustedBounds.setFromCenterAndSize(this.meshData.center,i)}}},76541:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Fatcaster});var n=i(47724),s=i(96909),r=i(37606),o=i(2212),a=i(12216);class Fatcaster extends n.Y{constructor(){super(...arguments),this.name="fat-caster",this.rayAssembly=new Array(Fatcaster.rayCount),this.rayPlaneOrientation=new o.Quaternion,this.rayVisuals=[]}async init(e,t){this.config={debug:!!e.debug},this.raycaster=await t.getModuleBySymbol(s.y.RAYCASTER);for(let e=0;e<Fatcaster.rayCount;++e)this.rayAssembly[e]=new o.Ray;if(e.debug){const e=(await t.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene();for(let t=0;t<Fatcaster.rayCount;++t){this.rayVisuals[t]=new o.ArrowHelper(new o.Vector3,new o.Vector3);const i=this.rayVisuals[t];i.remove(i.cone),i.setLength(1e3),e.add(this.rayVisuals[t])}}}async dispose(e){const t=(await e.getModuleBySymbol(s.y.WEBGL_RENDERER)).getScene();for(const e of this.rayVisuals)t.remove(e)}get ray(){return this.raycaster.pointer.pointerRay.clone()}cast(e,t,i=r.a.Filter.AVERAGE){const n=this.ray;return this.updateRayAssembly(n.origin,n.direction,e),this.castRays(t,i)}castRays(e,t){const i=[];let n=null;for(const t of this.rayAssembly){const s=this.raycaster.picking.pick(t.origin,t.direction,e);s&&(t===this.rayAssembly[0]&&(n=s),s.point.add(this.rayAssembly[0].origin).sub(t.origin),i.push(s))}return t(i,n,this.rayAssembly)}updateRayAssembly(e,t,i){for(const e of this.rayAssembly)e.direction.copy(t);if(this.rayPlaneOrientation.setFromUnitVectors(a.f.FORWARD,t),this.rayAssembly[0].origin.copy(e),this.rayAssembly[1].origin.copy(a.f.RIGHT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[2].origin.copy(a.f.UP).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[3].origin.copy(a.f.LEFT).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[4].origin.copy(a.f.DOWN).multiplyScalar(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[5].origin.copy(a.f.UP).add(a.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[6].origin.copy(a.f.UP).add(a.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[7].origin.copy(a.f.DOWN).add(a.f.RIGHT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.rayAssembly[8].origin.copy(a.f.DOWN).add(a.f.LEFT).setLength(i).applyQuaternion(this.rayPlaneOrientation).add(e),this.config.debug)for(let e=0;e<this.rayVisuals.length;++e){const i=this.rayVisuals[e];i.setDirection(t),i.position.copy(this.rayAssembly[e].origin)}}}Fatcaster.rayCount=9},37606:(e,t,i)=>{"use strict";i.d(t,{a:()=>n});var n,s=i(2212);!function(e){let t;!function(e){const t=e=>{for(const t of e)if(t.face)return{point:t.point,object:t.object,distance:t.distance,face:t.face};return null},i=(e,t)=>e.distance-t.distance;e.CENTER_FIRST=(e,i)=>i&&i.face?{point:i.point,normal:i.face.normal,object:i.object,distance:i.distance,face:i.face}:t(e),e.CLOSEST=e=>t(e.sort(i)),e.AVERAGE=e=>{if(0===e.length)return null;const t={point:new s.Vector3,face:{a:0,b:1,c:2,normal:new s.Vector3,materialIndex:0},distance:0,object:e[0].object};for(const i of e)t.face&&i.face&&(t.point.add(i.point),t.face.normal.add(i.face.normal));return t.point.divideScalar(e.length),t.face&&t.face.normal.divideScalar(e.length).normalize(),t};e.CENTER_GROUP=t=>(i,s,r)=>{if(s){const n=[s];for(let e=1;e<i.length&&e<3;++e){const o=i[e];if(o.face){const i=Math.abs(r[e].direction.dot(o.face.normal));s.point.distanceTo(o.point)*i<=t&&n.push(o)}}if(n.length>=3){const t=e.AVERAGE(n,null,r);if(t&&t.face&&s.face)return t.face.normal=s.face.normal,t}}const o=n(i,r,t);return o?e.AVERAGE(o,null,r):e.CENTER_FIRST(i,s,r)};const n=(e,t,n)=>{const s=e.slice().sort(i),r=[s[0]];let o;for(o=1;o<s.length&&r.length<3;++o){const e=s[o];if(e.face){const i=Math.abs(t[o].direction.dot(e.face.normal));r[0].point.distanceTo(e.point)*i>n&&(r.length=0),r.push(e)}}return r.length<3?null:r}}(t=e.Filter||(e.Filter={}))}(n||(n={}))},49924:(e,t,i)=>{"use strict";i.d(t,{Z:()=>GetFloorIntersectCommand});var n=i(17386);class GetFloorIntersectCommand extends n.m{constructor(e){super(),this.payload=Object.assign({},e)}}},14880:(e,t,i)=>{"use strict";i.r(t),i.d(t,{GetFloorIntersectCommand:()=>n.Z,default:()=>v});var n=i(49924),s=i(96909),r=i(84303),o=i(47724),a=i(59088),l=i(27687),c=i(26627),d=i(35597),h=i(5087),u=i(36123),p=i(76863),m=i(69626),f=i(2212),g=i(12216);class FloorCaster extends o.Y{constructor(){super(...arguments),this.name="floor-caster",this.cameraPosition=new f.Vector3,this.forwardPosition=new f.Vector3,this.targetPlane=new f.Plane}async init(e,t){this.engine=t,[this.renderer,this.cameraData,this.viewmodeData,this.raycaster,this.floorsData,this.meshQuery]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(a.M_),t.market.waitForData(d.O),t.getModuleBySymbol(s.y.RAYCASTER),t.market.waitForData(c.i),t.getModuleBySymbol(s.y.MESH_QUERY)]),t.commandBinder.addBinding(n.Z,(e=>this.castToFloor(e.screenPosition,e.height,e.includeHiddenFloors)))}async castToFloor(e,t,i=!0){await this.engine.after(r.A.End);const n=this.renderer.getScene().camera,s=(0,l.z5)(e.x,e.y,this.cameraData.width,this.cameraData.height);let o,a=null;this.cameraPosition.set(s.x,s.y,-1).unproject(n),this.forwardPosition.set(s.x,s.y,1).unproject(n);const c=this.raycaster.picking.cast(this.cameraPosition,this.forwardPosition.clone().sub(this.cameraPosition).normalize(),i?p.T0:p.Pv)[0];if(c&&c.object instanceof u.S){a=c&&c.point||null;const e=this.meshQuery.floorIdFromObject(c.object);e?o=this.floorsData.getFloor(e):a&&(o=this.floorsData.getClosestFloorAtHeight(a.y))}if(void 0!==t){this.cameraPosition.copy(this.cameraData.pose.position);const e=(0,l.st)(this.cameraData,s);if(this.viewmodeData.currentMode!==h.Ey.Floorplan){const i=(0,m.n0)(this.cameraPosition,e);this.targetPlane.set(g.f.DOWN,t),a=(0,m.Fe)(this.cameraPosition,i,this.targetPlane)||null}else e.y=t,a=e}const d=o?o.index:-1;return{position:a,floor:d,floorIndex:d}}}const v=FloorCaster},42952:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorplanControls});var n=i(2212),s=i(12216),r=i(57812),o=i(68524),a=i(85362);class CameraControls extends a.B{constructor(e,t,i,n=!1){super(e,t,i,n),this.cameraModule=e,this.angularAccel=0,this.angularVelocity=0,this.transition.angularVelocity=0}setRollAcceleration(e,t=!1){this.transition.active||(t&&e&&this.angularVelocity&&Math.sign(e)!==Math.sign(this.angularVelocity)&&(this.angularVelocity=0),this.angularAccel=e)}startRotateTransition(e,t,i){return this.startTransition(e,t.x*r.SI,new n.Vector2,0,i).nativePromise()}startTransition(e,t,i,n,s){return this.transition.angularVelocity=t,this.angularVelocity=t,this.angularAccel=0,super.startTransition(e,t,i,n,s)}update(e){super.update(e);(Math.abs(this.angularAccel)>o.Z.epsilon||Math.abs(this.angularVelocity)>o.Z.epsilon)&&(this.transition.active?this.updateAngularTransition(e):this.updateAngularDefault(e))}stopMomentum(){super.stopMomentum(),this.transition.active||(this.angularVelocity=0)}stopAcceleration(){super.stopAcceleration(),this.transition.active||this.setRollAcceleration(0)}updateAngularTransition(e){const t=this.getTransitionScale(e);this.angularVelocity=this.transition.angularVelocity*t,this.roll(this.angularVelocity)}updateAngularDefault(e){const t=e/r.SI;this.angularVelocity=this.angularVelocity+this.angularAccel*t,this.roll(this.angularVelocity),this.angularVelocity*=Math.pow(1-r.O8,t)}roll(e){const t=this.cameraModule.getData(!1);this.currentOrientation.setFromAxisAngle(s.f.FORWARD,e),this.currentOrientation.multiplyQuaternions(t.pose.rotation,this.currentOrientation),this.currentOrientation.normalize(),this.checkBounds&&!this.insideBounds(t.pose.position,this.currentOrientation,t.pose.projection)||t.pose.rotation.equals(this.currentOrientation)||this.cameraModule.updateCameraRotation(this.currentOrientation)}}var l=i(35726),c=i(63757),d=i(96909),h=i(81507),u=i(88216),p=i(5087),m=i(76870);const f=Math.PI/2/1e3;var g;!function(e){e[e.NONE=m.r3.NONE]="NONE",e[e.PAN=m.r3.PRIMARY]="PAN",e[e.ROTATE=m.r3.SECONDARY]="ROTATE",e[e.ZOOM=m.r3.MIDDLE]="ZOOM"}(g||(g={}));class FloorplanControls extends l.default{constructor(){super(...arguments),this.name="floorplan-controls"}async init(e,t){await super.init(e,t),t.getModuleBySymbol(d.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(c.D,(e=>{this.validateViewmode()&&(this.controls.setRollAcceleration(e.rotateDelta),this.controls.update(r.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(c.u,this.resetControlState))}))}createCameraControls(e){this.controls=new CameraControls(this.cameraModule,e.bounds,e.center,!0),this.commonControlsModule.addControls(p.Ey.Floorplan,this.controls)}onDrag(e){switch(super.onDrag(e),this.controlState){case g.ROTATE:this.controls.setRollAcceleration(e.x*Math.PI)}}onKey(e){super.onKey(e);const{key:t,state:i,modifiers:n}=e,s=i===u.M.DOWN;switch(t){case h.R.J:case h.R.LEFTARROW:this.controls.setRollAcceleration(s?f:0,!0);break;case h.R.L:case h.R.RIGHTARROW:this.controls.setRollAcceleration(s?-f:0,!0);break;case h.R.DOWNARROW:n.shiftKey||this.controls.setZoomAcceleration(s?r.Gu:0);break;case h.R.UPARROW:n.shiftKey||this.controls.setZoomAcceleration(s?-r.Gu:0)}}validateViewmode(){return this.viewmodeData.currentMode===p.Ey.Floorplan}}},76896:(e,t,i)=>{"use strict";i.d(t,{P:()=>EndMoveToFloorMessage});var n=i(91466);class EndMoveToFloorMessage extends n.v{constructor(e,t){super(),this.floorId=e,this.floorName=t}}},90454:(e,t,i)=>{"use strict";i.d(t,{S:()=>StartMoveToFloorMessage});var n=i(91466);class StartMoveToFloorMessage extends n.v{constructor(e,t){super(),this.from=e,this.to=t}}},26627:(e,t,i)=>{"use strict";i.d(t,{i:()=>FloorsData});var n=i(32770),s=i(44283),r=i(64781),o=i(53149);class FloorsData extends n.V{constructor(e){super(),this.name="floors",this.floors=(0,r.q)(e)}onNameChange(e){let t=[];return(0,s.k1)((()=>{this.getOrderedValues().forEach(((i,n)=>{t.push(i.onPropertyChanged("name",e))}))}),(()=>{t.forEach((e=>e.cancel())),t=[]}),!0)}getFloor(e){if(!this.floors.has(e))throw new o.H;return this.floors.get(e)}hasFloor(e){return this.floors.has(e)}getFloorAtIndex(e){return this.floors.values.find((t=>t.index===e))}getFloorByMeshGroup(e){return this.floors.values.find((t=>t.meshGroup===e))}getFloorCount(){return this.floors.length}getCollection(){return this.floors}iterate(e){return this.getOrderedValues().forEach(e)}getTopFloor(){const e=this.getOrderedValues();if(!e.length)throw new o.H("Cannot get top floor, model has no floors");return e[e.length-1]}getBottomFloor(){const e=this.getOrderedValues();if(!e.length)throw new o.H("Cannot get bottom floor, model has no floors");return e[0]}getFloorAtHeight(e,t=!1){const i=this.getOrderedValues();t&&i.reverse();for(const t of i){const i=t.boundingBox;if(i.min.y<=e&&e<=i.max.y)return t}const n=this.getBottomFloor();return e<n.boundingBox.min.y?n:this.getTopFloor()}getClosestFloorAtHeight(e){let t,i=1/0;for(const n of this.floors){const s=Math.abs(n.medianSweepHeight()-e);i>s&&(i=s,t=n)}return t}rename(e,t){if(!this.floors.has(e))return;const i=this.floors.get(e);i.name=t,i.commit()}getOrderedValues(){return this.floors.values.sort(((e,t)=>e.index-t.index))}}},53149:(e,t,i)=>{"use strict";i.d(t,{H:()=>InvalidFloorException});var n=i(31102);class InvalidFloorException extends n.y{constructor(e="Invalid Floor"){super(e),this.name="InvalidFloorException"}}},50620:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorDataModule});var n=i(47724),s=i(39729),r=i(71194),o=i(57361),a=i(26627),l=i(50988),c=i(38420),d=i(99252),h=i(48602),u=i(81047),p=i(94474),m=i(88512),f=i(2212);class OrderList{constructor(){this.list=[]}insort(e){const t=this.binarySearch(e);let i=t.index;if(!t.success)for(;this.compare(e,this.list[i])>=0&&i<this.list.length;)i++;for(let e=this.list.length;e>i;e--)this.list[e]=this.list[e-1];this.list[i]=e}removeIndex(e){if(e>this.list.length)throw Error("OrderList.removeIndex() -> Invalid index: "+e);this.list.splice(e,1)}getElement(e){if(e>=0&&e<this.list.length)return this.list[e];throw new Error("OrderList.getElement() -> Invalid index: "+e)}get length(){return this.list.length}find(e){const t=this.binarySearch(e);return t.success?t.index:-1}compare(e,t){return void 0===t?1:"number"==typeof e?e===t?0:e<t?-1:1:e.compare(t)}binarySearch(e){let t=0,i=this.list.length-1,n=-1,s=null,r=0;for(;t<=i;){if(n=Math.floor((t+i)/2),s=this.list[n],r=this.compare(e,s),0===r)return{success:!0,index:n};r<0?i=n-1:t=n+1}return{success:!1,index:n}}}var g=i(85861),v=i(23573);class Floor extends v.T{constructor(e={}){super(),this.name="",this.center=new f.Vector3,this.boundingBox=new f.Box3,this.size=new f.Vector3,this.sweepHeights=new OrderList,this.sweepFloorHeights=new OrderList,this.medianSweepHeight=()=>this.sweepHeights.length>0?this.sweepHeights.getElement(Math.floor(this.sweepHeights.length/2)):this.center.y,this.minSweepFloorHeight=()=>this.sweepFloorHeights.length>0?this.sweepFloorHeights.getElement(0):this.boundingBox.min.y,Object.assign(this,e)}setBounds(e){this.boundingBox.copy(e),this.boundingBox.getSize(this.size),this.boundingBox.getCenter(this.center)}addSweep(e){this.sweepHeights.insort(e.position.y),this.sweepFloorHeights.insort(e.floorPosition.y)}get bottom(){return this.minSweepFloorHeight()}get top(){return this.sweepFloorHeights.length>0?this.sweepFloorHeights.getElement(this.sweepFloorHeights.length-1):this.boundingBox.max.y}deepCopy(){return(0,g.p$)({id:this.id,meshGroup:this.meshGroup,index:this.index,name:this.name,center:this.center,boundingBox:this.boundingBox,size:this.size,medianSweepHeight:this.medianSweepHeight(),bottom:this.bottom})}}const y=new m.Z("mds-floor-deserializer");class MdsFloorDeserializer{deserialize(e){if(!e||!this.validate(e))return y.debug("Deserialized invalid floor data from MDS",e),null;const t=e.label||"",i=e.dimensions||{},{areaFloor:n}=i;return new Floor({id:e.id,index:e.sequence,meshGroup:e.meshId,name:t,areaFloor:n||-1})}validate(e){return["id","sequence","meshId"].every((t=>t in e))}}class MdsFloorPatchSerializer{serialize(e){return{label:e.name}}}class MdsFloorStore extends p.u{constructor(){super(...arguments),this.deserializer=new MdsFloorDeserializer,this.prefetchKey="data.model.floors"}async read(e={}){const t={modelId:this.getViewId()};return this.query(u.GetFloors,t,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.floors;if(!n||!Array.isArray(n))return null;return n.reduce(((e,t)=>{const i=this.deserializer.deserialize(t);return i&&(e[t.id]=i),e}),{})}))}async update(e,t){const i=this.getViewId(),n=(new MdsFloorPatchSerializer).serialize(t);if(!n)throw new Error("Could not update Floor");return this.mutate(u.PatchFloor,{modelId:i,floorId:e,data:n})}}var b=i(53149);class FloorDataModule extends n.Y{constructor(){super(...arguments),this.name="floors"}async init(e,t){const{readonly:i,baseUrl:n}=e;this.engine=t,this.store=new MdsFloorStore({readonly:i,baseUrl:n});const[r]=await Promise.all([this.store.read()]);if(this.data=new a.i(r||{}),t.market.register(this,a.i,this.data),!1===i){const e=this.data.getCollection();this.monitor=new o.c(e,{aggregationType:s.E.NextFrame,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new l.VQ({dataTypes:[c.g.FLOORS]}))));const[i]=await Promise.all([t.getModule(d.F)]);this.bindings.push(i.onSave((()=>this.save()),{dataType:c.g.FLOORS}));const n=await t.market.waitForData(h.Q);n.setRevertableType(c.g.FLOORS),n.setPublishableType(c.g.FLOORS)}}onUpdate(){}async save(){const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=[];for(const i of e){const e=i.index;if(!e)throw new b.H(`Invalid floor '${i.index}'`);i.action===r.KI.updated&&t.push(this.store.update(e,i.diff))}return Promise.all(t)}}},27326:(e,t,i)=>{"use strict";i.d(t,{c:()=>FloorsViewData});var n=i(17131),s=i(32770),r=i(13789),o=i(48715),a=i(35026),l=i(23573);class FloorState extends l.T{constructor(){super(...arguments),this.hidden=!1,this.navigable=!0,this.hasEnabledAlignedSweeps=!1,this.hasEnabledUnalignedSweeps=!1}}var c=i(64781),d=i(75256),h=i(21479);class FloorsStateHelper{constructor(e,t,i,n,s){this.floors=e,this.viewmodeData=t,this.sweepData=i,this.applicationData=n,this.currentFloorObservable=s,this.bindings=[],this.states=new c.v,this._navigableFloorIds=new d.d,this.hasEnabledAlignedSweeps=!1,this.updateFloorSweepData=()=>{const e=this.sweepData;this.isEditMode()||(this.states.values.forEach((e=>{e.hasEnabledAlignedSweeps=!1,e.hasEnabledUnalignedSweeps=!1})),e.iterate((e=>{if(null!==e.floorId){let t=this.getState(e.floorId);t||(t=this.initializeFloorState(e.floorId)),e.alignmentType===a.z9.ALIGNED?t.hasEnabledAlignedSweeps||(t.hasEnabledAlignedSweeps=e.enabled):t.hasEnabledUnalignedSweeps||(t.hasEnabledUnalignedSweeps=e.enabled),t.commit(),this.hasEnabledAlignedSweeps||(this.hasEnabledAlignedSweeps=e.enabled)}}))),this.updateNavigable()},this.updateHidden=()=>{const e=!this.currentFloorId,t=this.isViewingAlignedPano();this.states.keys.forEach((i=>{const n=!!i&&i===this.currentFloorId,s=this.getState(i);s.hidden=!(e||n||t),s.commit()}))},this.updateNavigable=()=>{const e=this.isEditMode(),t=this.isViewingAlignedPano(),i=this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan();this.states.keys.forEach((n=>{const s=this.getState(n);s.navigable=!!e||(t?s.hasEnabledAlignedSweeps:!!i||(s.hasEnabledAlignedSweeps||s.hasEnabledUnalignedSweeps)),s.commit()}));const n=[];this.floors.iterate((e=>{this.getState(e.id).navigable&&n.push(e.id)})),this._navigableFloorIds.replace(n)},this.bindings.push(t.makeModeChangeSubscription(this.updateHidden),i.makeSweepChangeSubscription(this.updateHidden),s.onChanged(this.updateHidden),t.makeModeChangeSubscription(this.updateNavigable),i.makeSweepChangeSubscription(this.updateNavigable),n.onPropertyChanged("application",this.updateFloorSweepData)),this.initializeFloorStates(),this.updateFloorSweepData(),this.updateHidden()}getState(e){return this.states.get(e)}get navigableFloorIds(){return this._navigableFloorIds.values()}onNavigableFloorIdsChanged(e){return this._navigableFloorIds.onChanged(e)}isViewingAlignedPano(){return this.viewmodeData.isInside()&&void 0!==this.sweepData.currentAlignedSweepObject}isEditMode(){return this.applicationData.application===h.Mx.WORKSHOP}get currentFloorId(){return this.currentFloorObservable.value?this.currentFloorObservable.value.id:null}initializeFloorStates(){this.floors.iterate((e=>this.initializeFloorState(e.id)))}initializeFloorState(e){const t=new FloorState;return this.states.set(e,t),t}}var u=i(60697);function p(e,t){return e}const m={floorChangesEnabled:()=>!0,roomNavFeatureEnabled:()=>!0};class FloorsViewData extends s.V{constructor(e,t,i,s,r,a){super(),this.name="floors-view",this.floorSelectable=!1,this.currentFloorObservable=new o.f(null),this._observableFloorsSelectMode=new o.f(!1),this._observableRoomSelectMode=new o.f(!1),this._showFloorSelection=new o.f(!1),this.getFloorMin=e=>{const t=e||(this.currentFloorId||this.bottomFloorId);return this.floors.getFloor(t).bottom},this.isHidden=e=>this.stateHelper.getState(e).hidden,this.isNavigable=e=>this.stateHelper.getState(e).navigable,this.getHighestVisibleFloor=()=>this.currentFloor?this.currentFloor:this.floors.getTopFloor(),this.getHighestVisibleFloorId=()=>this.getHighestVisibleFloor().id,this.updateViewData=()=>{this.floors.iterate((e=>{this.derivedData[e.id]={id:e.id,index:e.index,name:this.getFloorName(e.id)}})),this.commit()},this.getViewData=e=>{if(!this.derivedData[e]){const t=this.floors.getFloor(e);this.derivedData[e]={id:t.id,index:t.index,name:this.getFloorName(t.id)}}return this.derivedData[e]},this.getAllViewData=()=>{const e=[];return this.floors.iterate((t=>{e.push(this.getViewData(t.id))})),e},this.getFloor=e=>this.floors.getFloor(e),this.floors=e,this.config=null!=a?a:m,this.localize=null!=r?r:p,this.derivedData={},this._transition={from:null,to:null,progress:new n.z(0),promise:Promise.resolve()},this.stateHelper=new FloorsStateHelper(e,t,i,s,this.currentFloorObservable),this.updateViewData()}isCurrentOrAllFloors(e){return!e||!this.currentFloorId||e===this.currentFloorId}makeFloorChangeSubscription(e){return this.currentFloorObservable.onChanged(e)}get currentFloor(){return this.currentFloorObservable.value}get currentFloorId(){var e;return(null===(e=this.currentFloorObservable.value)||void 0===e?void 0:e.id)||null}get currentFloorIndex(){return this.currentFloorObservable.value?this.currentFloorObservable.value.index:u.qE}get currentFloorMeshGroup(){return this.currentFloorObservable.value?this.currentFloorObservable.value.meshGroup:u.eh}getFloorIndexForMeshGroup(e){if(e===u.eh)return u.qE;const t=this.floors.getFloorByMeshGroup(e);return t?t.index:u.qE}get bottomFloorId(){return this.floors.getBottomFloor().id}get topFloorId(){return this.floors.getTopFloor().id}get singleFloor(){if(1===this.floors.getFloorCount())return this.floors.getFloorAtIndex(0)}isMultifloor(){return this.floors.getFloorCount()>1}get nearestFloorId(){return this.transitionActive?this.transition.progress.value>.5?this.transition.to:this.transition.from:this.currentFloorId}get nearestFloor(){const e=this.nearestFloorId;return e?this.floors.getFloor(e):void 0}get transitionActive(){return this.transition.progress.active}get transition(){return this._transition}transitionToFloorInstant(e){this.currentFloorObservable.value=e?this.floors.getFloor(e):null,this.commit()}transitionToFloor(e,t,i,n){const s=this._transition.progress;s.modifyAnimation(0,1,i),this._transition={from:e,to:t,progress:s,promise:n},this.commit(),n.then((()=>{this.transitionToFloorInstant(t)}))}get totalFloors(){return this.floorsEnabled?this.floors.getFloorCount():1}hasEnabledAlignedSweeps(e){return null!==e?this.stateHelper.getState(e).hasEnabledAlignedSweeps:this.stateHelper.hasEnabledAlignedSweeps}getNavigableFloorIds(){return this.stateHelper.navigableFloorIds}onNavigableFloorIdsChanged(e){return this.stateHelper.onNavigableFloorIdsChanged(e)}getFloorIdMap(){const e={};return this.iterate((t=>{e[t.id]={id:t.id,name:t.name,items:[]}})),e}iterate(e){this.floors.iterate((t=>{const i=this.getViewData(t.id);i&&e(i)}))}getFloorNames(){const e=[];return this.floorsEnabled?(this.floors.iterate((t=>{e[t.index]=this.getFloorName(t.id)})),e):e}getFloorName(e){if(!e)return this.localize(r.Z.FLOOR_ALL);const t=this.floors.getFloor(e);return void 0!==t.name&&""!==t.name?t.name:this.getDefaultFloorName(e)}getDefaultFloorName(e){const t=this.floors.getFloor(e);return this.localize(r.Z.SHOWCASE.FLOORS.DEFAULT_NAME,t.index+1)}getFloorsVisibility(){if(this.currentFloorId){const e=[];return this.floors.iterate((t=>{e[t.index]=t.id===this.currentFloorId?1:0})),e}return[]}get floorsEnabled(){return this.config.floorChangesEnabled()}get floorSelectModeEnabled(){return this.config.roomNavFeatureEnabled()}get floorSelectModeActive(){return this._observableFloorsSelectMode.value}set floorSelectModeActive(e){const t=e&&this.floorsEnabled&&this.floorSelectModeEnabled;t!==this._observableFloorsSelectMode.value&&(this._observableFloorsSelectMode.value=t,this.commit())}onFloorSelectModeChange(e){return this._observableFloorsSelectMode.onChanged(e)}get showFloorSelection(){return this._showFloorSelection.value}set showFloorSelection(e){(e&&this.floorSelectModeEnabled)!==this._showFloorSelection.value&&(this._showFloorSelection.value=e&&this.floorSelectModeEnabled,this.commit())}onShowFloorSelectionChanged(e){return this._showFloorSelection.onChanged(e)}get roomSelectModeActive(){return this._observableRoomSelectMode.value}set roomSelectModeActive(e){const t=e&&this.floorSelectModeEnabled||!this.floorSelectModeEnabled;t!==this._observableRoomSelectMode.value&&(this._observableRoomSelectMode.value=t,this.commit())}onRoomSelectModeChange(e){return this._observableRoomSelectMode.onChanged(e)}}},2725:(e,t,i)=>{"use strict";i.d(t,{Vw:()=>MoveToFloorCommand,h9:()=>MoveToFloorIndexCommand,EU:()=>ShowAllFloorsCommand});var n=i(17386);class MoveToFloorCommand extends n.m{constructor(e,t=!1,i,n){super(),this.id="MOVETO_FLOOR",this.payload={floorId:e,suppressCameraMovement:t,transitionTime:i,focusPoint:n}}}class MoveToFloorIndexCommand extends n.m{constructor(e,t=!1,i,n){super(),this.id="MOVETO_FLOOR_NUMBER",this.payload={floorIndex:e,suppressCameraMovement:t,transitionTime:i,focusPoint:n}}}class ShowAllFloorsCommand extends n.m{constructor(e){super(),this.id="SHOW_ALL_FLOORS",this.payload=e}}},60697:(e,t,i)=>{"use strict";i.d(t,{qE:()=>n,eh:()=>s,cw:()=>r});const n=-1,s=-1,r=500},84285:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>FloorsViewDataModule});var n=i(47724),s=i(96909),r=i(41452),o=i(88727),a=i(94610),l=i(81507),c=i(88216),d=i(75892),h=i(35597),u=i(59088),p=i(67027),m=i(76896),f=i(85895),g=i(68576),v=i(44019),y=i(5087),b=i(69941),S=i(21479),E=i(8150),T=i(26627),w=i(27408),x=i(8482),_=i(2388);class FloorsRenderer{constructor(e,t,i,n,s,r,o,a){this.getAngleModifier=e,this.pose=t,this.floorsViewData=i,this.meshQuery=n,this.viewmodeData=s,this.raycasterData=r,this.meshData=o,this.touchDevice=a,this.getDiscardDistance=e=>{if(e){return 4+(this.pose.focalDistance*_.xx.DISCARD_FOCAL_MULTI||0)}return 0}}activate(){}init(){}dispose(){}deactivate(){const{floorOpacity:e,floorFadeDist:t}=this.meshData.meshGroupVisuals;for(const i of this.meshData.meshGroups.floors.values())t.set(i.meshGroup,0),e.set(i.meshGroup,0)}beforeRender(){const e=this.floorsViewData.nearestFloor,t=this.floorsViewData.transition.progress.active,i=!(!e||this.viewmodeData.isInside()),n=_.xx.FADE_OPAQUE;let s=n,r=n;const o=this.getAngleModifier();i&&(this.floorsViewData.floorSelectModeEnabled&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isOrthographic())?(s=n*o*_.xx.FADE_IN_VALUE,r=s*_.xx.FADE_BELOW_MULT+_.xx.FADE_BELOW_START):(s=_.xx.FADE_ABOVE,r=_.xx.FADE_BELOW));const{floorOpacity:a,floorFadeDist:l}=this.meshData.meshGroupVisuals;for(const{meshGroup:i}of this.meshData.meshGroups.floors){const o=this.floorsViewData.floors.getFloorByMeshGroup(i);let c=n;const d=this.isBelowSelectedFloor(o)?r:s;let h=(0,w.uZ)(d+_.xx.FADE_IN_HOVER_BOOST_VALUE,0,1);this.floorsViewData.roomSelectModeActive&&(h=d),c=this.isHoveredFloor(null==o?void 0:o.id)&&!t&&d>0?h:d,c=this.isFloorTransitioningOut(o)?d:c,c=this.isSelectedFloor(null==o?void 0:o.id)||this.isFloorTransitioningIn(o)?n:c,c=this.clampForViewmodeTransitions(c);const u=a.get(i);if(void 0===u)a.set(i,c);else if(u!==c){let e=(0,x.t)(u,c,.2);Math.abs(c-e)<1e-4&&(e=c),a.set(i,e)}const p=this.viewmodeData.isDollhouse(),m=this.getDiscardDistance(p&&!!e&&i>e.meshGroup);l.set(i,m)}}render(){}clampForViewmodeTransitions(e){if(this.viewmodeData.currentMode===y.Ey.Transition){const{to:t}=this.viewmodeData.transition;if(t===y.Ey.Panorama)return Math.max(1-this.meshData.meshTextureOpacity.value,e)}return e}isHoveredFloor(e){if(void 0!==e&&this.raycasterData.hit&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isOrthographic())&&!this.touchDevice&&this.floorsViewData.isNavigable(e)){const t=this.raycasterData.hit.object;return e===this.meshQuery.floorIdFromObject(t)}return!1}isSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!t||!(!e||t.id!==e)}isBelowSelectedFloor(e){const t=this.floorsViewData.nearestFloor;return!!(e&&t&&t.index>e.index)}isFloorTransitioningIn(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.to&&this.floorsViewData.transition.to!==e.id)}isFloorTransitioningOut(e){return!(!e||!this.floorsViewData.transition.progress.active||this.floorsViewData.transition.from&&this.floorsViewData.transition.from!==e.id&&this.floorsViewData.transition.to===e.id)}}var M=i(64185),O=i(90454),A=i(76701),C=i(31278),P=i(29422),D=i(2212),N=i(12216),I=i(69626),L=i(51263),R=i(57051),k=i(53149),U=i(95586),B=i(60697);class FloorsNavigation{constructor(e,t,i,n,s,r,o,a,l){this.engine=e,this.floorsData=t,this.floorsViewData=i,this.sweepData=n,this.cameraData=s,this.cameraModule=r,this.viewmodeData=o,this.updateCurrentFloor=a,this.meshData=l,this.MOVE_TO_BLACK_TRANSITION_TIME=2e3,this.moveFloorUp=(e=!1,t)=>{const i=this.floorsViewData.currentFloorId,n=this.floorsViewData.getNavigableFloorIds(),s=i?n.indexOf(i):-1;let r=n[s+1];return void 0===r&&(r=this.viewmodeData.isInside()?n[n.length-1]:n[0]),this.moveToFloor(r,e,t)},this.moveFloorDown=(e=!1,t)=>{const i=this.floorsViewData.currentFloorId,n=this.floorsViewData.getNavigableFloorIds(),s=i?n.indexOf(i):n.length;let r=n[s-1];return void 0===r&&(r=this.viewmodeData.isInside()?n[0]:n[n.length-1]),this.moveToFloor(r,e,t)},this.moveToFloor=(e,t=!1,i,n)=>{const s=this.floorsViewData.currentFloorId,r=s===e,o=this.floorsViewData.totalFloors<2&&!e,a=e?this.floorsViewData.floors.getFloor(e):null;if(r||o||!this.floorsViewData.floorsEnabled)return this.updateCurrentFloor(e),M.Q.resolve();if(a&&!this.canMoveToFloor(a,t))return M.Q.reject(new k.H("Invalid floor ID"));this.engine.broadcast(new O.S(s,e)),void 0===i&&(i=B.cw);const l=new M.Q;let c;this.floorsViewData.transitionToFloor(s,e,i,l.nativePromise()),this.floorsViewData.commit();let d,h=n;if(this.viewmodeData.isInside()){const t=e=>e=>this.floorsViewData.isCurrentOrAllFloors(e.floorId),i=!!e?L.nK:t,s=[(0,L._T)(),(0,L._k)(),i(e)],r=[(0,R.l0)(n||this.cameraData.pose.position)],o=this.sweepData.sortByScore(s,r).shift();o&&(h=o.sweep.position,c=o.sweep.id)}else null!==e&&this.engine.commandBinder.issueCommand(new U.aK);d=t?Promise.resolve():this.getCameraTransition(e,i,c,h);const u=this,p=M.Q.all([l,d]);return this.engine.startGenerator((function*(){let e=Date.now();for(;u.floorsViewData.transition.progress.active;){yield new A.Jj;const t=Date.now(),i=t-e;u.floorsViewData.transition.progress.tick(i),u.floorsViewData.commit(),e=t}u.updateCurrentFloor(u.floorsViewData.transition.to),l.resolve()})),p}}moveToFloorIndex(e,t=!1,i,n){let s=null;if(e!==B.qE){const t=this.floorsViewData.floors.getFloorAtIndex(e);if(!t)return M.Q.reject(new k.H(`Invalid floor index ${e}`));s=t.id}return this.moveToFloor(s,t,i,n)}canMoveToFloor(e,t=!1){if(!e)return!1;const i=this.floorsViewData.transition.progress.active,n=this.cameraData.canTransition()||t,s=e.index<=this.floorsViewData.totalFloors-1,r=e.index>=-1;return!i&&n&&s&&r}getCameraTransition(e,t,i,n){if(this.viewmodeData.currentMode===y.Ey.Dollhouse||this.viewmodeData.currentMode===y.Ey.Floorplan){const i=this.getPoseForFloor(e,n);return this.cameraModule.moveTo({transitionType:C.n.Interpolate,pose:i.pose,focalDistance:i.focalDistance,transitionTime:t}).nativePromise()}return this.viewmodeData.isInside()&&i?this.engine.commandBinder.issueCommand(new P.ju({transition:C.n.MoveToBlack,sweep:i,transitionTime:this.MOVE_TO_BLACK_TRANSITION_TIME})):Promise.resolve()}getPoseForFloor(e,t){const{position:i,rotation:n}=this.cameraData.pose,s=e?this.floorsData.getFloor(e):null,r=s?s.medianSweepHeight():this.meshData.center.y,o=s?s.center:this.meshData.center;o.setY(r);const a=N.f.FORWARD.clone().applyQuaternion(n),l=i.clone();let c,d;if(t){const e=i.clone().addScaledVector(a,this.cameraData.pose.focalDistance),n=(new D.Vector3).set(0,i.y,0),s=(new D.Vector3).set(0,e.y,0),o=n.distanceTo(s);l.setY(r+o);const h=e.clone().setY(t.y);d=h.distanceTo(l),this.viewmodeData.isDollhouse()&&(c=(0,I.n0)(l,h))}else{const e=(s?s.size.y:F)/2+F*-a.y;l.setY(r+e),d=l.distanceTo(o)}return{focalDistance:d,pose:{position:l,rotation:c}}}}const F=8;var V=i(27326),H=i(2725),j=i(79437),G=i(19674),z=i(7170);class FloorsSelectModeHelper{constructor(e,t,i){this.floorsViewData=e,this.viewmodeData=t,this.pose=i,this.vectors={lookDir:new D.Vector3,flattenedLookDir:new D.Vector3},this.getAngleModifier=this.getAngleModifier.bind(this)}update(){const e=this.getAngleModifier(),t=1===this.floorsViewData.totalFloors,i=!!this.floorsViewData.nearestFloor,n=!this.viewmodeData.isInside()&&!this.viewmodeData.transitionActive();this.floorsViewData.roomSelectModeActive=n&&(t||i&&e<1||this.viewmodeData.isFloorplan()),this.floorsViewData.floorSelectModeActive=n&&1===e&&!t,this.floorsViewData.showFloorSelection=!this.viewmodeData.transitionActive()&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan())&&i&&!t,this.floorsViewData.floorSelectable=this.floorsViewData.floorSelectModeEnabled&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isOrthographic())}getAngleModifier(){const e=this.vectors.lookDir.copy(N.f.FORWARD).applyQuaternion(this.pose.rotation),t=this.vectors.flattenedLookDir.copy(e).setY(0),i=e.angleTo(t)*z.MN,n=_.xx.FADE_IN_START_ANGLE,s=_.xx.FADE_IN_END_ANGLE,r=1-(0,G.dS)(i,n,s,0,1);return(0,j.FG)(r,0,1,1)}}var W=i(60771),K=i(17490),Y=i(24764),q=i(51245),Z=i(4901),$=i(14092),Q=i(33874),X=i(73844),J=i(88814),ee=i(3248);class FloorsViewDataModule extends n.Y{constructor(){super(...arguments),this.name="floors-viewdata",this.onEndMoveToSweepMessage=e=>{const t=this.sweepData.getSweep(e.toSweep);t&&this.updateCurrentFloor(t.floorId)},this.onMoveToFloorCommand=async e=>this.floorNavigation.moveToFloor(e.floorId,e.suppressCameraMovement,e.transitionTime,e.focusPoint),this.onMoveToFloorIndexCommand=async e=>this.floorNavigation.moveToFloorIndex(e.floorIndex,e.suppressCameraMovement,e.transitionTime,e.focusPoint),this.onShowAllFloorsCommand=async e=>{const t="boolean"==typeof e.moveCamera&&!e.moveCamera;await this.engine.commandBinder.issueCommand(new H.Vw(null,t))},this.applicationChanged=()=>{this.floorsViewData.updateViewData()},this.updateCurrentFloor=e=>{this.config.allowFloorChanges&&this.floorsViewData.currentFloorId!==e&&(this.floorsViewData.transitionToFloorInstant(e),this.engine.broadcast(new m.P(e,this.floorsViewData.getFloorName(e))))},this.updateFloorSelectMode=()=>{var e;null===(e=this.floorsSelectModeHelper)||void 0===e||e.update()},this.floorSelectFeatureEnabledCheck=()=>{const e=this.settingsData.tryGetProperty(X.ws,!0),t=this.settingsData.tryGetProperty(ee.gx.FloorSelect,!0),i=this.applicationData.application===S.Mx.WORKSHOP;this.toggleFloors(i||e&&t)}}async init(e,t){this.engine=t,this.config=e,[this.floorsData,this.settingsData,this.applicationData,this.sweepData,this.viewmodeData]=await Promise.all([t.market.waitForData(T.i),t.market.waitForData(Q.e),t.market.waitForData(S.pu),t.market.waitForData(d.Z),t.market.waitForData(h.O)]);const i=await t.getModule(r.default),n={floorChangesEnabled:()=>this.config.allowFloorChanges,roomNavFeatureEnabled:()=>this.settingsData.tryGetProperty(X.Q5,!1)};if(this.floorsViewData=new V.c(this.floorsData,this.viewmodeData,this.sweepData,this.applicationData,i.t.bind(i),n),this.floorSelectFeatureEnabledCheck(),t.market.register(this,V.c,this.floorsViewData),[this.cameraData,this.input,this.raycasterData]=await Promise.all([t.market.waitForData(u.M_),t.getModuleBySymbol(s.y.INPUT),t.market.waitForData(v.P)]),this.config.allowFloorChanges&&this.viewmodeData.isInside()&&this.sweepData.currentSweepObject){const e=this.sweepData.currentSweepObject.floorId;e&&(this.log.debug(`Set initial floor to ${e} from current sweep`),this.updateCurrentFloor(e))}const[o,a]=await Promise.all([t.getModuleBySymbol(s.y.CAMERA),t.market.waitForData(p._)]);this.floorNavigation=new FloorsNavigation(t,this.floorsData,this.floorsViewData,this.sweepData,this.cameraData,o,this.viewmodeData,this.updateCurrentFloor,a),this.floorsSelectModeHelper=new FloorsSelectModeHelper(this.floorsViewData,this.viewmodeData,this.cameraData.pose);const l=await t.getModuleBySymbol(s.y.MESH_QUERY),c=new FloorsRenderer(this.floorsSelectModeHelper.getAngleModifier,this.cameraData.pose,this.floorsViewData,l,this.viewmodeData,this.raycasterData,a,(0,W.Jm)());t.addComponent(this,c),this.settingsData.tryGetProperty(X.Q5,!1)&&this.config.allowFloorChanges&&this.registerFloorHoverCursorEffect(),this.bindings.push(this.registerKeys(),t.subscribe(E.bS,this.applicationChanged),this.floorsData.onChanged(this.floorsViewData.updateViewData),t.subscribe(f.Z,this.onEndMoveToSweepMessage),t.subscribe(g.Z,function(e,t,i){let n=!1;return s=>{const r=e.tryGetData(b.k);if(!r||r&&r.isTourActive())return;(0,y.Bw)(s.toMode)&&(n=null!==i.currentFloorId);const o=(0,y.Bw)(s.fromMode),a=s.toMode===y.Ey.Floorplan,l=s.toMode===y.Ey.Dollhouse;if(!o||!l&&!a)return;const c=n||a?i.currentFloorId:null;t(new H.Vw(c,!0,0))}}(t.market,t.commandBinder.issueCommand,this.floorsViewData)),t.commandBinder.addBinding(H.Vw,this.onMoveToFloorCommand),t.commandBinder.addBinding(H.h9,this.onMoveToFloorIndexCommand),t.commandBinder.addBinding(H.EU,this.onShowAllFloorsCommand),t.subscribe(J.Z,this.updateFloorSelectMode),this.cameraData.pose.onChanged(this.updateFloorSelectMode),this.floorsViewData.onChanged(this.updateFloorSelectMode),this.settingsData.onPropertyChanged(X.ws,this.floorSelectFeatureEnabledCheck),this.settingsData.onPropertyChanged(ee.gx.FloorSelect,this.floorSelectFeatureEnabledCheck),this.applicationData.onPropertyChanged("application",this.floorSelectFeatureEnabledCheck)),this.updateFloorSelectMode()}onUpdate(){}toggleFloors(e){e||null===this.floorsViewData.currentFloorId||this.updateCurrentFloor(null),this.config.allowFloorChanges=e,this.updateFloorSelectMode()}registerKeys(){return this.input.registerHandler(o.e,(async e=>{if(!this.cameraData.canTransition())return;const t=e.modifiers.shiftKey;if(e.state===c.M.PRESSED)switch(e.key){case l.R.UPARROW:t&&this.floorNavigation.moveFloorUp();break;case l.R.DOWNARROW:t&&this.floorNavigation.moveFloorDown();break;case l.R.R:this.floorNavigation.moveFloorUp();break;case l.R.F:this.floorNavigation.moveFloorDown();break;case l.R.Y:this.floorNavigation.moveToFloor(null)}}))}registerFloorHoverCursorEffect(){const e=Y.s.is((e=>q.$4.isRoomMesh(e)&&e.raycastEnabled&&this.floorsViewData.floorSelectable)),t=new K.V(this.input.registerMeshHandler(a.z,e,(e=>{this.engine.commandBinder.issueCommand(new Z.u($.C.FINGER))})),this.input.registerMeshHandler(a.A,e,(e=>{this.engine.commandBinder.issueCommand(new Z.u($.C.DEFAULT))})));t.cancel();const i=(()=>{let e=!1;return()=>{const i=this.floorsViewData.floorSelectModeEnabled;i!==e&&(e=i,e?t.renew():(t.cancel(),this.engine.commandBinder.issueCommand(new Z.u($.C.DEFAULT))))}})();i(),this.bindings.push(this.viewmodeData.onChanged(i),this.floorsViewData.onFloorSelectModeChange(i),this.floorsViewData.makeFloorChangeSubscription(i),t)}}},73844:(e,t,i)=>{"use strict";i.d(t,{Q5:()=>n,ws:()=>s,u_:()=>r,gu:()=>o});const n="features/roomnav",s="features/floorselect",r="features/current_floor_indicator",o="features/floor_name_overlay"},33394:(e,t,i)=>{"use strict";i.d(t,{I:()=>GuiErrorCommand});var n=i(17386);class GuiErrorCommand extends n.m{constructor(e,t){super(),this.id="DEFAULT_ERROR",this.payload={messagePhraseKey:e,options:t}}}},89046:(e,t,i)=>{"use strict";i.d(t,{Bz:()=>ToggleModalCommand,rE:()=>CloseModalCommand,Mn:()=>ToggleIconToolbarCommand});var n=i(17386);class ToggleModalCommand extends n.m{constructor(e,t){super(),this.payload={modal:e,open:t}}}ToggleModalCommand.id="TOGGLE_MODAL";class CloseModalCommand extends n.m{constructor(){super()}}CloseModalCommand.id="CLOSE_MODAL";class ToggleIconToolbarCommand extends n.m{constructor(e){super(),this.payload={open:e}}}ToggleIconToolbarCommand.id="TOGGLE_ICON_TOOLBAR"},49080:(e,t,i)=>{"use strict";var n;i.d(t,{P:()=>n}),function(e){e.TERMS="terms",e.VR_SELECT="vrSelect",e.MATTERTAG_PHOTO="mattertag",e.HELP="help",e.CTA="cta",e.MEASUREMENT_HELP="measurementModeHelp",e.SHARE="share",e.ATTACHMENT="attachmentViewer",e.ADD_FROM_PHOTOS="add_from_photos",e.HIGHLIGHT_EDITOR="highlight_editor",e.REVERT_CHANGES="revert_unpublished_modal",e.HLR_SETTINGS="hlr_settings",e.NOTES_INTRO="notes_intro",e.RATING_THANK_YOU="rating_thank_you"}(n||(n={}))},92839:(e,t,i)=>{"use strict";i.d(t,{O:()=>B});var n=i(20331);const s=()=>{},r=()=>null,o=()=>!1,a=()=>Promise.reject(),l=()=>Promise.resolve(),c=()=>"",d=()=>({}),h=()=>[],u=()=>({renew:s,cancel:s}),p={register:s,unregister:s,waitForData:a,tryGetData:r,getModuleNameFromData:()=>""},m={subscribe:u,unsubscribe:s,broadcast:s};var f=i(11554);class NoopCommandBinder extends f.B{constructor(){super(...arguments),this.addBinding=u,this.removeBinding=s,this.issueCommand=a,this.issueCommandWhenBound=a,this.hookCommand=s,this.resetHooks=s}}const g=new NoopCommandBinder,v={mask:0,addLayers:s,removeLayers:s,clone:()=>v},y=()=>v;const b={market:p,msgBus:m,commandBinder:g,getModule:a,getModuleBySymbol:a,getModuleBySymbolSync:function(){throw new Error("getModuleBySymbolSync not supported")},getModuleSync:()=>{throw new Error("cannot get module with mock engine")},addComponent:l,removeComponent:l,getComponentByType:r,getComponents:function*(){},claimRenderLayer:y,getRenderLayer:y,subscribe:u,unsubscribe:s,broadcast:s,disposeRenderLayer:s,startGenerator:s,stopGenerator:s,after:l,deactivate:s,getXrFrame:()=>{},toggleRendering:s};var S=i(80100);class NoopShowcaseAnalytics extends S.default{constructor(){super(...arguments),this.init=l,this.onUpdate=s,this.dispose=s,this.track=s,this.getSessionId=c}}const E=new NoopShowcaseAnalytics;var T=i(41452);class NoopLocale extends T.default{constructor(){super(...arguments),this.t=e=>e}get languageCode(){return"en"}}const w=new NoopLocale;var x=i(81347);const _=(0,i(49747).Q)(""),M=()=>_;class NoopUserData extends x.m{constructor(){super(...arguments),this.getUserInfoByEmail=r,this.getUserInfoById=r,this.getUserDisplay=M,this.iterate=s,this.getUsersWhoMayNeedAccess=d,this.getKnownUsers=h,this.getCurrentUser=M,this.isLoggedIn=o,this.isPolicyFlagEnabled=o,this.isOrgAdmin=o,this.isInviter=o,this.isEditor=o,this.isCommenter=o,this.getCurrentUserId=()=>_.id,this.onUsersChanged=u}}const O=new NoopUserData(_,!1,!1);var A=i(24151),C=i(64781),P=i(23953),D=i(79553);const N={activate:l,deactivate:l},I=new P.U({id:D.w1.LABELS,namePhraseKey:"",panel:!1,panelLeft:!1,hidesAppBar:!1,icon:"",analytic:"",toolbar:!1,dimmed:!1,enabled:!1,manager:N,ui:{}}),L=new C.v;class NoopToolsData extends A.t{constructor(){super(...arguments),this.addTools=s,this.iterate=s,this.getTool=()=>I,this.removeTool=s,this.removeAllTools=s,this.setOpenAsset=s,this.onOpenAssetChanged=u,this.getActiveTool=r,this.onToolChanged=u,this.setOpenModal=s,this.onOpenModalChanged=u,this.onToolsLoadedChanged=u,this.setToolAccess=s,this.onToolAssetAccessChanged=u,this.isPanelOpen=o,this.isPanelCollapsedToBottom=o,this.setToolPanelLayout=s,this.onToolPanelLayoutChanged=u,this.onPanelCollapsedChanged=u,this.setPanelCollapsed=s}get toolsMap(){return L}get openAsset(){return null}get activeToolName(){return null}get openModal(){return null}get toolsLoaded(){return!1}get toolAccess(){return D.X$.SCENE}get toolPanelLayout(){return D.wS.NORMAL}get panelCollapsed(){return!1}}const R=new NoopToolsData;var k=i(33874);class NoopSettingsData extends k.e{constructor(){super(...arguments),this.setProperty=s,this.setLocalStorageProperty=s,this.hasProperty=o,this.tryGetProperty=s,this.getProperty=s,this.checkUrlParam=o,this.iterate=s}}const U=new NoopSettingsData,B={editMode:!1,mainDiv:document.createElement("div"),queue:new n.RequestQueue,messageBus:m,userData:O,toolsData:R,settings:U,analytics:E,engine:b,market:p,commandBinder:g,locale:w}},25813:(e,t,i)=>{"use strict";i.d(t,{I:()=>r});var n=i(67294),s=i(92839);const r=(0,n.createContext)(s.O)},71813:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Gui});var n=i(47724),s=i(96909),r=i(41452),o=i(67294),a=i(73935),l=i(25813),c=i(92839),d=i(85893),h=i(33394),u=i(94184),p=i.n(u),m=i(91466);class AlertNotificationMessage extends m.v{constructor(e){super(),this.open=e}}var f=i(19806),g=i(88512),v=i(12040);const y=new g.Z("alert-notification");class AlertNotification extends o.Component{constructor(e){super(e),this.throttledMessages=new Map,this.onClose=()=>{clearTimeout(this.alertTimer),this.setState({open:!1})},this.state={open:!1}}componentDidMount(){this.update()}componentWillUnmount(){this.state.open&&this.props.messageBus.broadcast(new AlertNotificationMessage(!1))}UNSAFE_componentWillReceiveProps(e){this.update(e)}componentDidUpdate(e,t){this.state.open!==t.open&&this.props.messageBus.broadcast(new AlertNotificationMessage(this.state.open))}update(e=this.props){const{show:t,timeout:i,message:n,throttle:s,type:r}=e,{analytics:o}=this.context;if(t){if(s>0){if(this.throttledMessages.has(n)&&this.throttledMessages.get(n)>Date.now())return void y.debug(`Suppressed alert dialog due to message throttling: ${n}`);this.throttledMessages.set(n,Date.now()+1e3*s)}clearTimeout(this.alertTimer),this.setState({open:!0}),i>0&&(this.alertTimer=window.setTimeout(this.onClose,1e3*i)),o&&o.track("alert_gui",{alert_action:"show",alert_type:r,alert_message:n})}}render(){const{title:e,message:t,type:i}=this.props,{open:n}=this.state,s={active:n,[`notification-${i}`]:!0};return(0,d.jsxs)("aside",Object.assign({className:p()("alert-notification",s)},{children:[(0,d.jsxs)("div",Object.assign({className:"notification-body"},{children:[e&&(0,d.jsx)("h3",Object.assign({className:"notification-title"},{children:e}),void 0),(0,d.jsx)("p",Object.assign({className:"notification-text"},{children:t}),void 0)]}),void 0),(0,d.jsx)(f.P,{buttonStyle:f.A.LIGHT,onClose:this.onClose,hideTooltip:!0},void 0)]}),void 0)}}AlertNotification.contextType=l.I,AlertNotification.defaultProps={type:v.N.INFO,show:!1,timeout:10,throttle:0};var b=i(61645);class ErrorBar extends o.Component{constructor(e){super(e),this.bindings=[],this.state={guiError:!1,errorMessagePhraseKey:""}}componentDidMount(){const{commandBinder:e}=this.context;this.bindings.push(e.addBinding(h.I,(async e=>{this.showErrorMessage(e.messagePhraseKey,e.options)})))}componentWillUnmount(){this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}componentDidUpdate(e,t){const{guiError:i}=this.state;i&&this.setState({guiError:!1})}showErrorMessage(e,t){this.setState({guiError:!0,errorMessagePhraseKey:e,errorOptions:t})}render(){const{messageBus:e,locale:t}=this.context,{guiError:i,errorMessagePhraseKey:n,errorOptions:s}=this.state;let r=n&&t.t(n);const{error:o}=s||{};return o&&(0,b.bh)(o)&&(r=`${r} (${o.code})`),(0,d.jsx)(AlertNotification,Object.assign({messageBus:e,show:i,message:r},s),void 0)}}ErrorBar.contextType=l.I;var S=i(33874),E=i(81347);class Gui extends n.Y{constructor(){super(...arguments),this.name="gui",this.workshopApp=!1,this.onAppReadyChanged=(e,t)=>{this.workshopApp&&(t&&e?this.mainDiv.classList.add("edit-mode"):this.mainDiv.classList.remove("edit-mode"))}}async init(e,t){this.workshopApp=e.workshopApp,this.mainDiv=e.mainDiv,this.container=e.container,this.reactContainer=e.reactContainer,this.queue=e.queue,this.engine=t,this.messageBus=t,this.market=t.market,this.commandBinder=t.commandBinder;const i=t.getModule(r.default),n=t.getModuleBySymbol(s.y.SHOWCASE_ANALYTICS),o=t.market.waitForData(E.m),a=t.market.waitForData(S.e);this.mainArgs=await Promise.all([i,n,a,o]),this.loadErrorBar(this.mainArgs)}dispose(e){this.bindings.forEach((e=>{e.cancel()})),this.bindings=[]}async loadUi(e){let t=[];return t=t.concat(this.mainArgs),t=t.concat([this.mainDiv,this.reactContainer,this.engine,this.messageBus,this.market,this.commandBinder,this.onAppReadyChanged,this.queue]),e.apply(this,t)}loadErrorBar(e){((e,t,i,n,s,r,d)=>{const h=document.createElement("div");h.className="error-bar",n.insertBefore(h,n.firstElementChild);const u=Object.assign(Object.assign({},c.O),{messageBus:e,commandBinder:t,market:i,analytics:s,settings:r,locale:d});(0,a.render)((0,o.createElement)(l.I.Provider,{value:u},[(0,o.createElement)(ErrorBar,{key:"error-bar"})]),h)})(this.engine,this.commandBinder,this.market,this.container,e[1],e[2],e[0])}}},84842:(e,t,i)=>{"use strict";i.d(t,{nV:()=>ModalToggledMessage,nZ:()=>PopupMenuOpenedMessage,Z_:()=>LoadIndicatorMessage,bN:()=>LoadIndicatorSuppressMessage,SN:()=>TextBoxFocusMessage});var n=i(91466);class ModalToggledMessage extends n.v{constructor(e,t){super(),this.modal=e,this.open=t}}class PopupMenuOpenedMessage extends n.v{constructor(e){super(),this.id=e}}class LoadIndicatorMessage extends n.v{constructor(e){super(),this.isOpen=e}}class LoadIndicatorSuppressMessage extends n.v{constructor(e){super(),this.suppress=e}}class TextBoxFocusMessage extends n.v{constructor(e,t){super(),this.textElement=e,this.focused=t}}},12040:(e,t,i)=>{"use strict";var n;i.d(t,{N:()=>n}),function(e){e.INFO="info",e.SUCCESS="success",e.WARNING="warning",e.ERROR="error"}(n||(n={}))},33746:(e,t,i)=>{"use strict";i.d(t,{lZ:()=>n,ig:()=>s,oO:()=>h});var n,s,r=i(85893),o=i(67294),a=i(2116),l=i(94184),c=i.n(l),d=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.UP="up",e.DOWN="down",e.LEFT="left",e.RIGHT="right",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right"}(n||(n={})),function(e){e.SMALL="small",e.MEDIUM="medium",e.LARGE="large",e.XLARGE="xlarge",e.FIT="fit"}(s||(s={}));let h=class DataBalloon extends o.Component{constructor(e){super(e),this.onClick=e=>{this.props.showOnClick&&this.setState((e=>({persist:!e.persist}))),void 0!==this.props.tooltipTimeout&&window.setTimeout((()=>{this.setState({tooltipEnabled:!1})}),this.props.tooltipTimeout)},this.onMouseEnter=e=>{this.enableTooltip(),this.adjustBalloonPosIfNeeded(e)},this.enableTooltip=()=>{this.setState({tooltipEnabled:!0})},this.state={currentPosition:null,tooltipEnabled:!0,persist:!1}}render(){const{children:e,position:t,content:i,className:n,tooltipWidth:s}=this.props,{currentPosition:o,tooltipEnabled:a,persist:l}=this.state;return(0,r.jsx)("div",Object.assign({role:"button","data-balloon":i,"data-balloon-pos":o||t,"data-balloon-width":s,"data-balloon-persist":l||void 0,className:c()("data-balloon",n,{disabled:!a}),onClick:this.onClick,onTouchStart:this.enableTooltip,onMouseEnter:this.onMouseEnter},{children:e}),void 0)}adjustBalloonPosIfNeeded(e){const{currentPosition:t}=this.state;if(null===t){const t=e.target,{position:i}=this.props;let s=i;if(i!==n.LEFT&&i!==n.RIGHT){const e=window.getComputedStyle(t,":after"),r=e.width?parseInt(e.width,10):0;if(r>0){const e=t.getBoundingClientRect(),o=(r-e.width)/2,a=i===n.UP||i===n.UP_RIGHT||i===n.UP_LEFT;e.left-o<=0?s=a?n.UP_RIGHT:n.DOWN_RIGHT:(i===n.UP_LEFT||i===n.DOWN_LEFT)&&e.left-r<=0?s=a?n.UP:n.DOWN:e.right+o>=window.innerWidth?s=a?n.UP_LEFT:n.DOWN_LEFT:(i===n.UP_RIGHT||i===n.DOWN_RIGHT)&&e.right+r>=window.innerWidth&&(s=a?n.UP:n.DOWN)}}this.setState({currentPosition:s})}}};h=d([a.Z],h)},36114:(e,t,i)=>{"use strict";i.d(t,{Dd:()=>s,hU:()=>m});var n,s,r=i(85893),o=i(67294),a=i(94184),l=i.n(a),c=i(2116),d=i(60771),h=i(33746),u=i(47210),p=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.CLEAR="clear",e.PLAIN="plain",e.OVERLAY="overlay",e.PRIMARY="primary",e.SOCIAL="social",e.TOOLBAR="toolbar"}(s||(s={}));let m=n=class IconButton extends o.Component{constructor(e){super(e),this.onClick=e=>{const t=this.props.buttonState;t!==u.BN.BUSY&&t!==u.BN.DISABLED&&this.props.onClick&&this.props.onClick(e)},this.onMouseDown=e=>{const{onMouseDown:t,onClick:i,buttonState:s}=this.props;if(t)t(e);else if(n.iMobile&&i&&s!==u.BN.BUSY&&s!==u.BN.DISABLED){const t=document.activeElement;t&&e.cancelable&&(t.blur(),e.preventDefault())}}}render(){const{ariaLabel:e,breakoutTooltip:t,buttonSize:i,buttonState:n,buttonStyle:o,children:a,className:c,dataValue:d,iconClass:p,id:m,onClick:f,onMouseUp:g,tooltipMsg:v,tooltipPersist:y,tooltipPosition:b,tooltipPreformatted:S,tooltipWidth:E}=this.props,T=n===u.BN.DISABLED,w=n===u.BN.BUSY,x=n===u.BN.DECORATIVE,_=!T&&!w&&!x,M=v?b||h.lZ.DOWN:void 0,O=v?!!S:void 0,A={"button-small":i===u.qE.SMALL,"button-large":i===u.qE.LARGE,"button-disabled":T,"button-dimmed":n===u.BN.DIMMED,"button-active":n===u.BN.ACTIVE,"button-busy":w,"button-interactive":_,"icon-button-primary":o===s.PRIMARY,"icon-button-overlay":o===s.OVERLAY,"icon-button-plain":o===s.PLAIN,"icon-button-social":o===s.SOCIAL,"icon-button-toolbar":o===s.TOOLBAR,"icon-button-breakout-tooltip":t},C={id:m,role:"button","aria-label":e||v,"aria-disabled":T,"data-value":d,className:l()("icon-button",A,c),onClick:f?this.onClick:void 0,onMouseUp:g,onMouseDown:this.onMouseDown},P={"data-balloon":v,"data-balloon-pos":M,"data-balloon-width":E,"data-balloon-pre":O,"data-balloon-persist":y};return t||Object.assign(C,P),(0,r.jsxs)("div",Object.assign({},C,{children:[t&&(0,r.jsx)("div",Object.assign({className:"icon-button-breakout-tooltip-container"},{children:(0,r.jsx)("div",Object.assign({className:"icon-button-breakout-tooltip-trigger"},P),void 0)}),void 0),p&&(0,r.jsx)("span",{className:`icon ${p}`},void 0),a]}),void 0)}};m.iMobile=(0,d.Tt)()||(0,d._1)(),m=n=p([c.Z],m)},66049:(e,t,i)=>{"use strict";i.d(t,{L:()=>ShowToastrCommand,Q:()=>HideToastrCommand});var n=i(17386);class ShowToastrCommand extends n.m{constructor(e){super(),this.id="SHOW_TOASTR",this.payload=e}}class HideToastrCommand extends n.m{constructor(){super(...arguments),this.id="HIDE_TOASTR"}}},47210:(e,t,i)=>{"use strict";i.d(t,{BN:()=>s,qE:()=>r,ZJ:()=>o,zx:()=>m});var n,s,r,o,a=i(85893),l=i(67294),c=i(94184),d=i.n(c),h=i(2116),u=i(60771),p=function(e,t,i,n){var s,r=arguments.length,o=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(s=e[a])&&(o=(r<3?s(o):r>3?s(t,i,o):s(t,i))||o);return r>3&&o&&Object.defineProperty(t,i,o),o};!function(e){e.ENABLED="enabled",e.DISABLED="disabled",e.DECORATIVE="decorative",e.DIMMED="dimmed",e.ACTIVE="active",e.BUSY="busy"}(s||(s={})),function(e){e[e.STANDARD=0]="STANDARD",e[e.MINI=1]="MINI",e[e.SMALL=2]="SMALL",e[e.LARGE=3]="LARGE"}(r||(r={})),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.SECONDARY=1]="SECONDARY",e[e.TERTIARY=2]="TERTIARY",e[e.OUTLINE=3]="OUTLINE",e[e.OVERLAY=4]="OVERLAY",e[e.LIGHT=5]="LIGHT",e[e.SECONDARY_LIGHT=6]="SECONDARY_LIGHT",e[e.CLEAR=7]="CLEAR",e[e.TOOLBAR=8]="TOOLBAR",e[e.PLAIN=9]="PLAIN"}(o||(o={}));let m=n=class Button extends l.Component{constructor(e){super(e),this.handlingClick=!1,this.mouseupTimeout=0,this.onMouseDown=e=>{if(this.handlingClick=!1,this.props.onMouseDown)this.props.onMouseDown(e);else if(n.iMobile&&this.props.onClick){const t=document.activeElement;t&&e.cancelable&&(this.handlingClick=!0,e.preventDefault(),e.nativeEvent.stopImmediatePropagation(),t.blur(),window.addEventListener("mouseup",(t=>{this.handlingClick&&(this.handleClick(e),window.clearTimeout(this.mouseupTimeout))}),{once:!0}),this.mouseupTimeout=window.setTimeout((()=>{this.handlingClick=!1}),300))}},this.onClick=e=>{this.handlingClick||this.handleClick(e)}}handleClick(e){const{buttonState:t,onClickArgs:i=[]}=this.props,n=t===s.DISABLED,r=t===s.BUSY,o=t===s.DECORATIVE;!this.props.onClick||n||r||o?e.stopPropagation():this.props.onClick(e,...i)}render(){const{ariaLabel:e,buttonSize:t,buttonState:i,buttonStyle:n,children:l,className:c,dataValue:h,id:u,multiline:p,onMouseEnter:m,onMouseLeave:f,tooltipMsg:g,tooltipPosition:v,tooltipPreformatted:y}=this.props,b=i===s.DISABLED,S=i===s.BUSY,E=i===s.DECORATIVE,T=n===o.SECONDARY||n===o.SECONDARY_LIGHT,w=n===o.TERTIARY,x=n===o.LIGHT||n===o.SECONDARY_LIGHT,_={"button-small":t===r.SMALL,"button-large":t===r.LARGE,"button-mini":t===r.MINI,"button-secondary":T,"button-tertiary":w,"button-outline":n===o.OUTLINE,"button-light":x,"button-primary":n===o.PRIMARY,"button-overlay":n===o.OVERLAY,"button-clear":n===o.CLEAR,"button-plain":n===o.PLAIN,"button-toolbar":n===o.TOOLBAR,"button-active":i===s.ACTIVE,"button-dimmed":i===s.DIMMED,"button-busy":S,"button-disabled":b,"button-decorative":E,"button-multiline":p,"button-with-tooltip":!!g};return(0,a.jsx)("div",Object.assign({id:u,role:"button","aria-label":e||g,"aria-disabled":b,className:d()("button",_,c),"data-value":h,onClick:this.onClick,onMouseEnter:m,onMouseLeave:f,onMouseDown:this.onMouseDown,"data-balloon":g||null,"data-balloon-pre":!!y,"data-balloon-pos":v||null},{children:l}),void 0)}};m.iMobile=(0,u.Tt)()||(0,u._1)(),m=n=p([h.Z],m)},19806:(e,t,i)=>{"use strict";i.d(t,{A:()=>u,P:()=>CloseButton});var n=i(85893),s=i(67294),r=i(94184),o=i.n(r),a=i(36114),l=i(33746),c=i(13789),d=i(25813);const{CLOSE_BUTTON_TOOLTIP_MESSAGE:h}=c.Z.REUSABLES;var u;!function(e){e[e.DEFAULT=0]="DEFAULT",e[e.LIGHT=1]="LIGHT",e[e.SHADOW=2]="SHADOW",e[e.OVERLAY=3]="OVERLAY",e[e.TOOLBAR=4]="TOOLBAR"}(u||(u={}));class CloseButton extends s.Component{constructor(){super(...arguments),this.handleMouseDown=e=>{const{closeOnMouseDown:t,onClose:i}=this.props;t&&i&&i(e)}}getIconButtonStyle(){switch(this.props.buttonStyle){case u.LIGHT:case u.SHADOW:return a.Dd.CLEAR;case u.OVERLAY:return a.Dd.OVERLAY;case u.TOOLBAR:return a.Dd.TOOLBAR;default:return a.Dd.PLAIN}}render(){const{locale:e}=this.context,{buttonStyle:t,buttonState:i,onClose:s,hideTooltip:r}=this.props,c=r?void 0:e.t(h),d=r?e.t(h):void 0,p=o()("close-button",{"close-button-shadow":t===u.SHADOW,"close-button-light":t===u.LIGHT});return(0,n.jsx)(a.hU,{className:p,ariaLabel:d,iconClass:"icon-close",buttonStyle:this.getIconButtonStyle(),buttonState:i,tooltipMsg:c,tooltipPosition:l.lZ.DOWN,onClick:s,onMouseDown:this.handleMouseDown},void 0)}}CloseButton.contextType=d.I},86010:(e,t,i)=>{"use strict";i.d(t,{o:()=>n,v:()=>TextParser});var n,s=i(44574),r=i(60771);!function(e){e.TEXT="",e.LINK="link-url",e.HASH="link-hashtag",e.USER="link-user"}(n||(n={}));class TextParser{constructor(e){this.serialize=e=>{const t=[],i=[].slice.call(e.childNodes);for(const e of i)switch(e.nodeName){case"#text":t.push(this.serializeText(e));break;case"A":t.push(this.serializeAnchor(e));break;case"P":case"DIV":t.push(this.serializeElement(e,!0));break;case"SPAN":t.push(this.serializeElement(e,!1));break;case"BR":t.push(this.serializeBreak(e));break;default:t.push(this.serialize(e))}return t.join("")},this.deserialize=(e,t,i,n=this.markers)=>{const s=this.parse(e).map((e=>this.createNode(e,t,i)));return n?this.parseMarkers(s,n):s},this.serializeHTMLToMarkdown=e=>{const t=document.createElement("div");t.innerHTML=e;const i=this.serialize(t);return t.remove(),i},this.serializeText=e=>{let t=this.sanitizeText(e.textContent||"");if(this.links){const e=new RegExp(/https?:\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u00a1-\uffff][a-z0-9\u00a1-\uffff_-]{0,62})?[a-z0-9\u00a1-\uffff]\.)+(?:[a-z\u00a1-\uffff]{2,}\.?))(?::\d{2,5})?(?:[/?#]\S*)?/gi),i=document.createElement("a");t=t.replace(e,(e=>(i.href=e,`[${e}](${i.href})`))),i.remove()}return this.hashtags&&(t=t.replace(/(#\w*)/,(e=>`[${e}]`))),t.replace(/\<\s*br\s*\/?>/gi,"\n")},this.serializeAnchor=e=>{const t=e.dataset.blocktype,i=this.sanitizeText(e.innerText||"");let n=i;switch(t){case s.C.HASH:n=`[${i}]`;break;case s.C.USER:if(this.users){let t=e.dataset.id||"",i=e.dataset.value||"";if(!t&&!i&&(i="@"===n[0]?n.substr(1):n,i)){const e=this.users.getUserInfoByEmail(i);e&&(t=e.id)}(t||this.validateEmail(i))&&(n=`[@${t}](${i})`)}break;case s.C.LINK:const t=e.dataset.value||e.href;t&&(n=`[${i}](${t})`);break;default:e.href&&(n=`[${i}](${e.href})`)}return n},this.serializeElement=(e,t)=>{let i=t?"\n":" ";return e.childNodes.length>0&&(i+=this.serialize(e)),i},this.serializeBreak=e=>"\n",this.validateEmail=(()=>{const e=/\S+@\S+\.\S+/,t=document.createElement("input");return t.type="email",t.required=!0,i=>(t.value=i,"function"==typeof t.checkValidity?t.checkValidity():e.test(i))})();const{links:t,hashtags:i,users:n,markers:r}=e;this.links=t||!1,this.hashtags=i||!1,this.users=n,this.markers=r}parseMarkers(e,t){const[i,n]=t;let s=!1;const r=new RegExp(i+"|"+n);for(let t=0;t<e.length;t++){const i=e[t],{nodeType:n,textContent:o}=i,a=3===n;if(!o)continue;a?e.splice(t,1):i.textContent=null;const l=o.split(r);l.forEach(((n,r)=>{if(""!==n){let r;if(s){const e=document.createElement("span");e.setAttribute("data-blocktype","marker"),r=e,r.textContent=n}else r=document.createTextNode(n);a?e.splice(t++,0,r):i.appendChild(r)}r<l.length-1&&(s=!s)})),a&&t--}return e}createNode(e,t,i){switch(e.blockType){case s.C.USER:const r=document.createElement(i?"a":"span");if(r.setAttribute("data-blocktype",e.blockType),i){const t=r;t.className=`link-annotation ${n.USER}`,t.removeAttribute("href"),i&&(t.onclick=i);const s=e.id||"",o=e.value||"";s&&t.setAttribute("data-id",s),o&&t.setAttribute("data-value",o)}return r.textContent=`${e.text}`,r;case s.C.HASH:const o=document.createElement(i?"a":"span");if(o.setAttribute("data-blocktype",e.blockType),i){const e=o;e.className=`link-annotation ${n.HASH}`,e.removeAttribute("href"),i&&(e.onclick=i)}return o.textContent=`${e.text}`,o;case s.C.LINK:if(e.value){const s=document.createElement(i||t?"a":"span");if(s.setAttribute("data-blocktype",e.blockType),s.setAttribute("data-value",e.value),i||t){const r=s;t&&(r.href=`${e.value}`),r.target="_blank",r.className=`link-annotation ${n.LINK}`,i&&(r.onclick=i)}return s.textContent=`${e.text}`,s}}return document.createTextNode(""+e.text)}parse(e){const t=[];if(!e)return[];const i=e.split("[").map(((e,t)=>0===t?e:"["+e));let n=0;for(;n<i.length;){const e=this.parseIntoBlocks(i[n],t);e&&i.splice(n+1,0,e),n++}return t}getPlainText(e){return this.parse(e).map((e=>e.text)).join("")}searchMarkdown(e,t){let i=-1,n=0,s=0;const r=this.parse(e).map((e=>{let r;return this.matchTextBlock(e,t)?(s++,-1===i&&(i=n),r=e.markdown):r=e.text,n+=e.text.length,r}));return-1===i?null:{markdown:r.join(""),matchIndex:i,textLength:n,numMatches:s}}getUserMentions(e){return this.parse(e).filter((e=>e.blockType===s.C.USER&&e.value)).map((e=>e.value||""))}matchTextBlock(e,t){if(e.blockType===t.blockType)if(e.blockType===s.C.USER){if(e.id===t.id)return!0;if(e.value===t.value)return!0}else if(e.blockType===s.C.HASH)return e.text===t.text;return!1}getHTMLWithoutSelection(e,t){let i=!1,n="",s=!1,r="";return e.childNodes.forEach((e=>{const o=e instanceof HTMLElement?e.outerHTML:e.nodeValue;o&&(i&&s&&(r+=o),e===t.startContainer&&(n+=o.slice(0,t.startOffset),i=!0),e===t.endContainer&&(r+=o.slice(t.endOffset,o.length),s=!0),i||s||(n+=o))})),[n,r]}parseIntoBlocks(e,t){if(this.users){const i=this.getUserBlock(e);if(i)return t.push(i),e.slice(i.markdown.length)}if(this.links){const i=this.getLinkBlock(e);if(i&&i.value&&-1===i.value.indexOf("javascript:"))return t.push(i),e.slice(i.markdown.length)}if(this.hashtags){const i=this.getHashBlock(e);if(i)return t.push(i),e.slice(i.markdown.length)}const i=this.getTextBlock(e);return i&&t.push(i),null}getTextBlock(e){return 0===e.length?null:{blockType:s.C.TEXT,text:e,markdown:e}}getHashBlock(e){const t=e.match(TextParser.hashRegex);return!t||t.length<2?null:{blockType:s.C.HASH,markdown:t[0],text:t[1]}}getUserBlock(e){if(!this.users)return null;const t=e.match(TextParser.userRegex);if(!t||t.length<3)return null;let i=t[1].substr(1),n=t[2];const r=n?this.users.getUserInfoByEmail(n):this.users.getUserInfoById(i),o=r?r.name:"";return i=r?r.id:i,n=r?r.email:n,{blockType:s.C.USER,markdown:t[0],id:i,value:n,text:`@${o||n}`}}getLinkBlock(e){const t=e.match(TextParser.linkRegEx);if(!t)return null;const i=t[2];let n=1,r=0;for(;r<i.length&&("("===i[r]?n++:")"===i[r]&&n--,0!==n);)r++;const o=i.length-r;let a=this.conditionallyEncode(t[2].substring(0,r));return-1===a.indexOf("://")&&(a="http://"+a),{blockType:s.C.LINK,markdown:t[0].substring(0,t[0].length-o),text:t[1],value:a}}conditionallyEncode(e){return this.needsEncoding(e)?encodeURI(e):e}needsEncoding(e){if(e.match(r.jx))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}sanitizeText(e){return e.replace(/\]\(/g,"]&zwnj;(").replace(/[\u200B]/g,"").replace(/[\u2018\u2019]/g,"'").replace(/[\u201C\u201D]/g,'"')}}TextParser.hashRegex=/\[(#(\w|-)*)\]/,TextParser.userRegex=/\[(@\w*)\]\(([^\)\(\[\]]*)\)/,TextParser.linkRegEx=/\[([^\]]*)\]\((.*)\)/},67799:(e,t,i)=>{"use strict";i.d(t,{MN:()=>n,OR:()=>s,LH:()=>r,c9:()=>o,_U:()=>a,Xx:()=>l,g:()=>c,El:()=>d});const n=767,s=()=>window.innerWidth>n,r=375,o=55,a=70,l=250,c=500,d=750},70179:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Animation});var n=i(79437);class Animation{constructor(e){this.isAnimating=!0,this.duration=e.duration,this.startValue=e.startValue,this.changeValue=e.endValue-this.startValue,this.easingFunction=e.easingFunction||n.to}getUpdatedValue(){this.startTime||(this.startTime=Date.now());const e=Date.now()-this.startTime;return e>this.duration&&(this.isAnimating=!1),this.easingFunction(Math.min(e,this.duration),this.startValue,this.changeValue,this.duration)}}},97251:(e,t,i)=>{"use strict";i.d(t,{u:()=>f,a:()=>g});var n=i(31278),s=i(79553),r=i(92532),o=i(92824),a=i(2904),l=i(51627),c=i(65049),d=i(66049),h=i(17597),u=i(13789);const{TAGS:p,NOTES:m}=u.Z.SHOWCASE,f=function(e,t,i){const n=e.tryGetProperty("tool","").toUpperCase();return t&&e.tryGetProperty("tag","")?s.w1.TAGS:i&&e.tryGetProperty("note","")?s.w1.NOTES:n||null},g=function(e,t){const{commandBinder:i,market:u,settings:f}=t;if(e===s.w1.NOTES){const e=f.tryGetProperty("note","");if(e)return f.setProperty("note",""),void u.waitForData(o.X).then((t=>{if(t.getNoteView(e))i.issueCommand(new a.yW(e,!0,(0,h.FU)().comment));else{const e={messagePhraseKey:m.MISSING_MESSAGE,timeout:4e3,dismissesOnAction:!0};i.issueCommand(new d.L(e))}}))}else if(e===s.w1.TAGS){const e=f.tryGetProperty("tag","");if(e)return f.setProperty("tag",""),void u.waitForData(l.n).then((t=>{if(t.getTagView(e))i.issueCommand(new c.lt(e,n.n.FadeToBlack,!0));else{const e={messagePhraseKey:p.MISSING_MESSAGE,timeout:4e3,dismissesOnAction:!0};i.issueCommand(new d.L(e))}}))}e&&(f.setProperty("tool",""),i.issueCommandWhenBound(new r.tT(e,!0)))}},94610:(e,t,i)=>{"use strict";i.d(t,{z:()=>HoverEvent,A:()=>UnhoverEvent});var n=i(15614);class HoverEvent extends n.G{constructor(){super(...arguments),this.type="hover"}}class UnhoverEvent extends n.G{constructor(){super(...arguments),this.type="unhover"}}},15614:(e,t,i)=>{"use strict";i.d(t,{G:()=>InputEvent});class InputEvent{constructor(){this.eventType="input"}}},35003:(e,t,i)=>{"use strict";i.d(t,{T:()=>ClickCancelEvent,R:()=>ClickEvent});var n=i(28134);class ClickCancelEvent extends n.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class ClickEvent extends n.C{constructor(e,t){super(),this.position=e,this.button=t}}},51869:(e,t,i)=>{"use strict";i.d(t,{E0:()=>DragBeginEvent,_t:()=>DragEvent,_R:()=>DragEndEvent,u4:()=>DragGestureStartEvent,Zv:()=>DragGestureEndEvent});var n=i(28134);class DragBeginEvent extends n.C{constructor(e,t){super(),this.position=e,this.buttons=t}}class DragEvent extends n.C{constructor(e,t,i,n){super(),this.position=e,this.clientPosition=n,this.delta=t,this.buttons=i}}class DragEndEvent extends n.C{constructor(e,t,i,n,s){super(),this.position=e,this.delta=t,this.buttons=i,this.timeSinceLastMove=n,this.fullDelta=s}}class DragGestureStartEvent extends n.C{constructor(e,t){super(),this.position=e,this.pointer=t}}class DragGestureEndEvent extends n.C{constructor(e,t){super(),this.position=e,this.fullDelta=t}}},28134:(e,t,i)=>{"use strict";i.d(t,{C:()=>GestureEvent});var n=i(15614);class GestureEvent extends n.G{}},33665:(e,t,i)=>{"use strict";i.d(t,{DG:()=>LongPressMoveEvent,PC:()=>LongPressProgressEvent,Vh:()=>LongPressStartEvent,$b:()=>LongPressSuccessEvent,pt:()=>LongPressEndEvent});var n=i(28134);class LongPressMoveEvent extends n.C{constructor(e,t,i,n){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=n}}class LongPressProgressEvent extends n.C{constructor(e,t,i,n,s){super(),this.position=e,this.clientPosition=t,this.delta=i,this.buttons=n,this.progress=s}}class LongPressStartEvent extends n.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.buttons=i}}class LongPressSuccessEvent extends n.C{constructor(e,t){super(),this.position=e,this.clientPosition=t}}class LongPressEndEvent extends n.C{constructor(e,t,i){super(),this.position=e,this.clientPosition=t,this.cancelled=i}}},77417:(e,t,i)=>{"use strict";i.d(t,{d:()=>MultiSwipeEvent,h:()=>MultiSwipeEndEvent});var n=i(28134);class MultiSwipeEvent extends n.C{constructor(e,t,i){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i)}}class MultiSwipeEndEvent extends n.C{constructor(e,t,i,n){super(),this.pointerCount=e,this.position=Object.assign({},t),this.delta=Object.assign({},i),this.timeSinceLastMove=n}}},38022:(e,t,i)=>{"use strict";i.d(t,{G:()=>PinchEvent,i:()=>PinchEndEvent});var n=i(28134);class PinchEvent extends n.C{constructor(e){super(),this.pinchDelta=e}}class PinchEndEvent extends n.C{constructor(e,t){super(),this.pinchDelta=e,this.timeSinceLastMove=t}}},14735:(e,t,i)=>{"use strict";i.d(t,{h:()=>RawPointersEvent});var n=i(28134);class RawPointersEvent extends n.C{constructor(e){super(),this.pointers=e}}},63757:(e,t,i)=>{"use strict";i.d(t,{D:()=>RotateEvent,u:()=>RotateEndEvent});var n=i(28134);class RotateEvent extends n.C{constructor(e){super(),this.rotateDelta=e}}class RotateEndEvent extends n.C{constructor(e,t){super(),this.rotateDelta=e,this.timeSinceLastMove=t}}},81040:(e,t,i)=>{"use strict";i.d(t,{a:()=>ScrollEvent});var n=i(28134);class ScrollEvent extends n.C{constructor(e,t){super(),this.position=e,this.delta=t}}},48221:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>InputIni});var n=i(47724),s=i(90933),r=i(74002),o=i(76870),a=i(49340),l=i(36169),c=i(10757),d=i(60771);class InputPointer{constructor(e,t,i,n){if(this.config=e,this.canvasData=i,this.handledTouchesAsPointer=0,this.lastTouchEnd=0,this.activeButtons=o.r3.NONE,this.preventDoubleTap=e=>{e.cancelable&&e.timeStamp-this.lastTouchEnd<=InputPointer.doubleTapThreshold&&e.preventDefault(),this.lastTouchEnd=e.timeStamp},this.preventMultiTouchGesture=e=>{const t=e.touches&&e.touches.length>1,i="scale"in e&&1!==e.scale;(t||i)&&e.cancelable&&e.preventDefault()},this.onEventCallback=n,window.PointerEvent||(t.addEventListener("mousedown",(e=>this.onMouseDown(e))),t.addEventListener("mouseup",(e=>this.onMouseUp(e))),t.addEventListener("mousemove",(e=>this.onMouseMove(e))),t.addEventListener("mouseenter",(e=>this.onMouseEnter(e)))),t.addEventListener("contextmenu",(e=>e.preventDefault())),t.addEventListener("touchstart",(e=>this.onTouchStart(e))),t.addEventListener("touchend",(e=>this.onTouchEnd(e))),t.addEventListener("touchmove",(e=>this.onTouchMove(e))),t.addEventListener("touchcancel",(e=>this.onTouchEnd(e))),t.addEventListener("pointerdown",(e=>this.onPointerDown(e))),t.addEventListener("pointerup",(e=>this.onPointerUp(e))),t.addEventListener("pointermove",(e=>this.onPointerMove(e))),t.addEventListener("pointercancel",(e=>this.onPointerUp(e))),t.addEventListener("pointerenter",(e=>this.onMouseEnter(e))),(0,d.Tt)()||(0,d._1)()){const e=!!l.h&&{passive:!1};document.addEventListener("touchmove",this.preventMultiTouchGesture,e),document.addEventListener("touchend",this.preventDoubleTap,e)}}onMouseDown(e){e.currentTarget.focus(),this.tryPreventDefault(e),this.activeButtons|=1<<e.button;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!0,a._A.MOUSE))}onMouseUp(e){this.tryPreventDefault(e),this.activeButtons&=~(1<<e.button);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),t,i,e.button,!1,a._A.MOUSE))}onMouseMove(e){this.tryPreventDefault(e);const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(this.getPointerId(e),t,i,this.activeButtons,a._A.MOUSE))}onMouseEnter(e){const t=(0,c.lY)(e.buttons,o.MP.MIDDLE,o.MP.SECONDARY),i=(this.activeButtons^t)&~t;for(let t=o.MP.PRIMARY;t<o.MP.COUNT;++t){const n=(0,o.AF)(t);if(n&&(i&n)>0){const{ndc:i,client:n}=this.getPointerPosition(e);this.onEventCallback(new a.er(this.getPointerId(e),i,n,t,!1,a._A.MOUSE))}}this.activeButtons=t}onTouchStart(e){if(e.currentTarget.focus(),e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,n,s,o.MP.PRIMARY,!0,a._A.TOUCH))}}onTouchEnd(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i);this.onEventCallback(new a.er(i.identifier,n,s,o.MP.PRIMARY,!1,a._A.TOUCH))}}onTouchMove(e){if(e.cancelable&&e.preventDefault(),this.handledTouchesAsPointer)--this.handledTouchesAsPointer;else for(let t=0;t<e.changedTouches.length;t++){const i=e.changedTouches.item(t),{ndc:n,client:s}=this.getTouchPosition(i),r=new a.mE(i.identifier,n,s,o.r3.PRIMARY,a._A.TOUCH);this.onEventCallback(r)}}onPointerDown(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseDown(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,o.MP.PRIMARY,!0,e.pointerType))}}onPointerUp(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:this.onMouseUp(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.er(e.pointerId,t,i,o.MP.PRIMARY,!1,e.pointerType))}}onPointerMove(e){switch(this.tryPreventDefault(e),e.pointerType){case a._A.MOUSE:-1!==e.button?this.activeButtons<e.buttons?this.onMouseDown(e):this.activeButtons>e.buttons&&this.onMouseUp(e):this.onMouseMove(e);break;case a._A.GAMEPAD:case a._A.TOUCH:++this.handledTouchesAsPointer;const{ndc:t,client:i}=this.getPointerPosition(e);this.onEventCallback(new a.mE(e.pointerId,t,i,o.r3.PRIMARY,e.pointerType))}}getPointerId(e){return(0,r.bX)(e)?e.pointerId:0}getPointerPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}getTouchPosition(e){return{ndc:this.normalizePosition(e.clientX,e.clientY),client:{x:e.clientX-this.canvasData.x,y:e.clientY-this.canvasData.y}}}normalizePosition(e,t){return{x:2*(e-this.canvasData.x)/this.canvasData.width-1,y:-2*(t-this.canvasData.y)/this.canvasData.height+1}}tryPreventDefault(e){this.config.pointerPreventDefault&&e.cancelable&&e.preventDefault()}}InputPointer.doubleTapThreshold=300;var h,u=i(81507),p=i(88216),m=i(88727);!function(e){e[e.SEMICOLON=59]="SEMICOLON",e[e.PLUSEQUALS=61]="PLUSEQUALS",e[e.DASHUNDERSCORE=173]="DASHUNDERSCORE"}(h||(h={}));class InputKey{constructor(e){this.keysDown={},this.onEventCallback=e,this.bindHandlers()}bindHandlers(){if(window&&window.document){const e=window.document;window.addEventListener("blur",(()=>{Object.keys(this.keysDown).forEach((e=>this.keysDown[e]=!1))})),e.addEventListener("keydown",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]=!0,this.onEventCallback(new m.e(t,p.M.DOWN,e))}})),e.addEventListener("keyup",(e=>{if(!e.ctrlKey&&!e.metaKey){e.preventDefault();const t=this.translateFirefoxKeys(e.which||e.keyCode);this.keysDown[t]&&this.onEventCallback(new m.e(t,p.M.PRESSED,e)),this.keysDown[t]=!1,this.onEventCallback(new m.e(t,p.M.UP,e))}}))}}translateFirefoxKeys(e){switch(e){case h.SEMICOLON:return u.R.SEMICOLON;case h.PLUSEQUALS:return u.R.PLUSEQUALS;case h.DASHUNDERSCORE:return u.R.DASHUNDERSCORE}return e}}var f,g=i(2212);!function(e){e[e.WAITING=0]="WAITING",e[e.WAITINGTOEXCEEDTHRESHOLD=1]="WAITINGTOEXCEEDTHRESHOLD",e[e.GESTURING=2]="GESTURING"}(f||(f={}));var v=i(35003);class ClickGesturer{constructor(e=.04,t=300){this.startPosition=new g.Vector2,this.pointerDelta=new g.Vector2,this.activeButtons=o.r3.NONE,this.state=f.WAITING,this.dragLimit=e,this.holdLimit=t}start(e){if(this.state===f.WAITING&&this.startPosition.copy(e.position),0==(e.buttons&e.buttons-1))this.startTime=Date.now(),this.activeButtons=e.buttons,this.state=f.WAITINGTOEXCEEDTHRESHOLD;else if(this.activeButtons)return this.state=f.GESTURING,new v.T(e.position,this.activeButtons)}stop(){let e;return this.state===f.WAITINGTOEXCEEDTHRESHOLD&&Date.now()-this.startTime<this.holdLimit&&(e=new v.R(this.startPosition.add(this.pointerDelta),(0,o.L2)(this.activeButtons)),this.pointerDelta.set(0,0)),this.state=f.WAITING,e}onMove(e){if(this.state===f.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.dragLimit))return this.state=f.GESTURING,new v.T(e.position,e.buttons)}compareState(e){return e===this.state}}var y=i(51869);class DragGesturer{constructor(e,t=.04){this.onEventCallback=e,this.startPosition=new g.Vector2,this.previousPosition=new g.Vector2,this.pointerDelta=new g.Vector2,this.lastPointerMove=Date.now(),this.state=f.WAITING,this.threshold=t}start(e){return this.state===f.WAITING&&(this.startPosition.copy(e.position),this.previousPosition.copy(this.startPosition),this.state=f.WAITINGTOEXCEEDTHRESHOLD),new y.E0(e.position,e.buttons)}stop(){const e=(new g.Vector2).copy(this.previousPosition).sub(this.startPosition);this.state===f.GESTURING&&this.onEventCallback(new y.Zv(this.startPosition,e)),this.state===f.WAITING&&this.pointerDelta.set(0,0),this.state=f.WAITING;const t=Date.now()-this.lastPointerMove;return new y._R(this.previousPosition,this.pointerDelta,o.r3.NONE,t,e)}onMove(e){let t;return this.state===f.WAITINGTOEXCEEDTHRESHOLD&&(this.pointerDelta.copy(e.position).sub(this.startPosition),this.pointerDelta.length()>this.threshold&&(this.state=f.GESTURING,this.onEventCallback(new y.u4(this.startPosition,e)))),this.state===f.GESTURING&&(this.pointerDelta.copy(e.position).sub(this.previousPosition),this.pointerDelta.length()>0&&(t=new y._t(this.previousPosition,this.pointerDelta,e.buttons,e.clientPosition))),this.previousPosition.copy(e.position),this.lastPointerMove=Date.now(),t}compareState(e){return e===this.state}compareStartPoint(e){return e.equals(this.startPosition)}compareDelta(e){return e.equals(this.pointerDelta)}}var b=i(38022);class PointerMovement{constructor(e=new g.Vector2,t=new g.Vector2,i=0){this.lastPosition=e,this.velocity=t,this.samePositionTicks=i}start(e){this.lastPosition.copy(e),this.velocity.set(0,0),this.samePositionTicks=0}update(e){if(this.lastPosition.distanceTo(e)<=.01){if(this.samePositionTicks++,this.samePositionTicks<2)return}else this.samePositionTicks=0;this.velocity.copy(this.lastPosition).sub(e),this.lastPosition.copy(e)}stationary(){return this.samePositionTicks>=2||this.velocity.length()<.01}}const S=2*Math.SQRT2;class PinchGesturer{constructor(e=.04){this.threshold=e,this.startDistance=0,this.previousDistance=0,this.pointerDelta=new g.Vector2,this.lastPointerMove=Date.now(),this.pinchDelta=0,this.state=f.WAITING,this.pointerMovement1=new PointerMovement,this.pointerMovement2=new PointerMovement}start(e,t){this.state===f.WAITING&&(this.restart(e,t),this.pointerMovement1.start(e.position),this.pointerMovement2.start(t.position))}stop(){this.state=f.WAITING;const e=Date.now()-this.lastPointerMove;return new b.i(this.pinchDelta,e)}onMove(e,t){this.pointerMovement1.update(e.position),this.pointerMovement2.update(t.position);if(!(this.pointerMovement1.stationary()||this.pointerMovement2.stationary()||this.pointerMovement1.velocity.dot(this.pointerMovement2.velocity)<0))return void this.restart(e,t);this.pointerDelta.copy(e.position).sub(t.position);const i=this.pointerDelta.length()/S;if(this.state===f.WAITINGTOEXCEEDTHRESHOLD){const e=i-this.startDistance;Math.abs(e)>this.threshold&&(this.state=f.GESTURING)}let n;if(this.state===f.GESTURING){const e=i-this.previousDistance;Math.abs(e)>0&&(this.pinchDelta=e,n=new b.G(e))}return this.previousDistance=i,this.lastPointerMove=Date.now(),n}restart(e,t){this.state=f.WAITINGTOEXCEEDTHRESHOLD,this.startDistance=e.position.distanceTo(t.position)/S,this.previousDistance=this.startDistance}}var E=i(27408),T=i(63757);class RotateGesturer{constructor(e=.1){this.startPointerDelta=new g.Vector2,this.previousPointerDelta=new g.Vector2,this.pointerDelta=new g.Vector2,this.lastPointerMove=Date.now(),this.angleWithDirection=0,this.state=f.WAITING,this.threshold=e}start(e,t){this.state===f.WAITING&&(this.state=f.WAITINGTOEXCEEDTHRESHOLD,this.startPointerDelta.copy(e.position).sub(t.position).normalize(),this.pointerDelta.copy(this.startPointerDelta),this.previousPointerDelta.copy(this.pointerDelta))}stop(){this.state=f.WAITING;const e=Date.now()-this.lastPointerMove;return new T.u(this.angleWithDirection,e)}onMove(e,t){if(this.pointerDelta.copy(e.position).sub(t.position).normalize(),this.state===f.WAITINGTOEXCEEDTHRESHOLD){Math.acos((0,E.uZ)(this.pointerDelta.dot(this.startPointerDelta),-1,1))>this.threshold&&(this.state=f.GESTURING)}let i;if(this.state===f.GESTURING){const e=Math.acos((0,E.uZ)(this.pointerDelta.dot(this.previousPointerDelta),-1,1));if(e>0){const t=this.previousPointerDelta.x*this.pointerDelta.y-this.previousPointerDelta.y*this.pointerDelta.x;this.angleWithDirection=t>=0?e:-e,i=new T.D(this.angleWithDirection)}}return this.previousPointerDelta.copy(this.pointerDelta),this.lastPointerMove=Date.now(),i}compareState(e){return e===this.state}}var w=i(14624),x=i(77417);class MultiSwipeGesturer{constructor(e=.04){this.startEpicenter=new g.Vector2,this.previousEpicenter=new g.Vector2,this.deltaEpicenter=new g.Vector2,this.currentEpicenter=new g.Vector2,this.pointerCount=0,this.lastPointerMove=Date.now(),this.state=f.WAITING,this.pointerMovements=[],this.threshold=e}start(e){this.state===f.WAITING&&(this.restart(e),this.pointerMovements=e.map((e=>new PointerMovement)),e.forEach(((e,t)=>{this.pointerMovements[t].start(e.position)})))}stop(){this.state=f.WAITING;const e=this.pointerCount;this.pointerCount=0;const t=Date.now()-this.lastPointerMove;return new x.h(e,this.currentEpicenter,this.deltaEpicenter,t)}onMove(e){(0,w.V)(this.getPointerPositions(e),this.currentEpicenter),e.forEach(((e,t)=>{this.pointerMovements[t].update(e.position)}));if(this.pointerMovements.find((e=>e.stationary())))return void this.restart(e);const t=this.pointerMovements[0].velocity;if(this.pointerMovements.find((e=>t.dot(e.velocity)<0)))return void this.restart(e);if(this.state===f.WAITINGTOEXCEEDTHRESHOLD){this.currentEpicenter.distanceTo(this.startEpicenter)>this.threshold&&(this.state=f.GESTURING)}let i;return this.state===f.GESTURING&&(this.deltaEpicenter.copy(this.currentEpicenter).sub(this.previousEpicenter),i=new x.d(e.length,this.currentEpicenter,this.deltaEpicenter)),this.previousEpicenter.copy(this.currentEpicenter),this.lastPointerMove=Date.now(),i}getPointerPositions(e){return e.map((e=>e.position))}restart(e){(0,w.V)(this.getPointerPositions(e),this.startEpicenter),this.previousEpicenter.copy(this.startEpicenter),this.currentEpicenter.copy(this.previousEpicenter),this.state=f.WAITINGTOEXCEEDTHRESHOLD,this.pointerCount=e.length}}var _=i(81040),M=i(33665);const O=new(i(88512).Z)("longpress");var A;!function(e){e[e.IDLE=0]="IDLE",e[e.WAITING=1]="WAITING",e[e.STARTED=2]="STARTED",e[e.SUCCESSFUL=3]="SUCCESSFUL"}(A||(A={}));class LongPressGesturer{constructor(e,t=500){this.onEventCallback=e,this.state=A.IDLE,this.ndcStartPosition=new g.Vector2,this.pointerDelta=new g.Vector2,this.ndcPosition=new g.Vector2,this.clientPosition=new g.Vector2,this.pressConfirmThreshold=this.pressStartThreshold=Math.max(t,1e-4)}start(e){this.state!==A.IDLE&&this.stop(),this.state===A.IDLE&&0==(e.buttons&e.buttons-1)&&(this.ndcStartPosition.copy(e.position),this.state=A.WAITING,this.buttons=e.buttons,this.pointerDelta.set(0,0),this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.holdTimeout=window.setTimeout((()=>{this.state=A.STARTED,O.debug("STARTED"),this.startTime=Date.now(),this.progress(0),this.onEventCallback(new M.Vh(e.position,e.clientPosition,e.buttons)),this.successTimeout=window.setTimeout((()=>{O.debug("SUCCESSFUL"),this.state=A.SUCCESSFUL,this.progress(1),this.onEventCallback(new M.$b(this.ndcPosition,this.clientPosition))}),this.pressConfirmThreshold)}),this.pressStartThreshold))}stop(){const e=this.state;if(this.state=A.IDLE,window.clearTimeout(this.holdTimeout),window.clearTimeout(this.successTimeout),e>A.WAITING){O.debug("DONE, cancelled:",e<A.SUCCESSFUL);const t=e<A.SUCCESSFUL;this.onEventCallback(new M.pt(this.ndcPosition,this.clientPosition,t))}}onMove(e){const t=this.state===A.STARTED||this.state===A.WAITING,i=this.state===A.STARTED||this.state===A.SUCCESSFUL;(t||i)&&(this.ndcPosition.copy(e.position),this.clientPosition.copy(e.clientPosition),this.pointerDelta.copy(this.ndcPosition).sub(this.ndcStartPosition)),t&&this.pointerDelta.length()>.1?this.stop():i&&this.onEventCallback(new M.DG(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons))}tick(){if(this.state===A.STARTED){const e=1-(this.pressStartThreshold-(Date.now()-this.startTime))/this.pressStartThreshold;this.progress(Math.min(1,e))}}progress(e){this.onEventCallback(new M.PC(this.ndcPosition,this.clientPosition,this.pointerDelta,this.buttons,e))}}var C=i(14735),P=i(96909);class InputDebugMenu{constructor(){this.displayTouches=!1,this.touches=new Map}async init(e){const[t]=await Promise.all([e.getModuleBySymbol(P.y.SETTINGS)]);t.registerMenuButton({header:"Input",buttonName:"Toggle pointer visualization",callback:()=>{this.displayTouches=!this.displayTouches}})}addPointer(e,t){this.displayTouches&&(this.touches.set(e,this.createPointer(t)),this.movePointer(e,t))}removePointer(e){const t=this.touches.get(e);t&&(document.body.removeChild(t),this.touches.delete(e))}movePointer(e,t){const i=this.touches.get(e);i&&(i.style.left=t.x-25+"px",i.style.top=t.y-25+"px")}createPointer(e){const t=document.createElement("div");return t.style.position="fixed",t.style.backgroundColor="#aa11aa",t.style.width="50px",t.style.height="50px",t.style.zIndex="99999",t.style.pointerEvents="none",t.style.touchAction="none",t.style.borderRadius="50px",document.body.appendChild(t),t}}var D;!function(e){e[e.NONE=0]="NONE",e[e.CLICK_DRAG_LONGPRESS=1]="CLICK_DRAG_LONGPRESS",e[e.PINCH_ROTATE=2]="PINCH_ROTATE",e[e.MULTI_SWIPE_ONLY=3]="MULTI_SWIPE_ONLY"}(D||(D={}));class InputGesture{constructor(){this.activeGesture=D.NONE,this.pointers=[],this.couldBeClick=!1}async init(e,t,i){this.onEventCallback=t,this.clicker=new ClickGesturer(e.dragThreshold),this.longPress=new LongPressGesturer(t,e.holdThreshold),this.dragger=new DragGesturer(t,e.dragThreshold),this.pincher=new PinchGesturer(e.pinchThreshold),this.rotater=new RotateGesturer(e.rotateThreshold),this.multiswiper=new MultiSwipeGesturer(e.dragThreshold);const n=await i.getModuleBySymbol(P.y.CANVAS);e.disableWheel||this.bindWheelHandlers(n.element),this.inputDebug=new InputDebugMenu,this.inputDebug.init(i)}get activePointers(){return this.pointers.length}onPointerChange(e){this.isMoveEvent(e)?this.onPointerMove(e):this.onPointerButton(e)}isMoveEvent(e){return!e.hasOwnProperty("down")}onPointerMove(e){this.movePointer(e.id,e.position,e.clientPosition,e.buttons),this.inputDebug.movePointer(e.id,e.clientPosition)}onPointerButton(e){e.down?(this.addPointer(e.id,e.position,e.clientPosition,e.button),this.inputDebug.addPointer(e.id,e.clientPosition)):(this.removePointer(e.id,e.button),this.inputDebug.removePointer(e.id))}bindWheelHandlers(e){e.addEventListener("wheel",(e=>{e.preventDefault(),this.onEventCallback(new _.a({x:e.clientX,y:e.clientY},{x:this.normalizeWheelDelta(e.deltaMode,e.deltaX),y:this.normalizeWheelDelta(e.deltaMode,e.deltaY)}))}))}normalizeWheelDelta(e,t){if(e===WheelEvent.DOM_DELTA_LINE){return.7*t*t*t+13*t}return t}addPointer(e,t,i,n){const s=(0,o.AF)(n);if(!s)return;const r=this.getPointer(e);r&&0==(r.buttons&s)?(r.buttons|=s,r.activeButtons++):this.pointers.push({id:e,position:new g.Vector2(t.x,t.y),clientPosition:new g.Vector2(i.x,i.y),buttons:s,activeButtons:1}),this.toggleGestures()}removePointer(e,t){const i=(0,o.AF)(t);if(!i)return;const n=this.getPointerIndex(e);if(-1!==n){const e=this.pointers[n];0!=(e.buttons&i)&&(e.buttons&=~i,e.activeButtons--),e.activeButtons||this.pointers.splice(n,1),this.toggleGestures()}}movePointer(e,t,i,n){const s=this.getPointer(e);if(s)switch(s.position.copy(t),s.clientPosition.copy(i),s.buttons!==n?this.updateOffscreenPointer(s,n):this.onEventCallback(new C.h(this.pointers)),this.activeGesture){case D.CLICK_DRAG_LONGPRESS:const e=this.clicker.onMove(s);e&&this.onEventCallback(e);const t=this.dragger.onMove(s);t&&this.onEventCallback(t),this.longPress.onMove(s);break;case D.PINCH_ROTATE:const i=this.pincher.onMove(this.pointers[0],this.pointers[1]),n=this.rotater.onMove(this.pointers[0],this.pointers[1]);i&&this.onEventCallback(i),n&&this.onEventCallback(n);case D.MULTI_SWIPE_ONLY:const r=this.multiswiper.onMove(this.pointers);r&&this.onEventCallback(r)}}getPointer(e){const t=this.getPointerIndex(e);if(-1!==t)return this.pointers[t]}toggleGestures(){this.onEventCallback(new C.h(this.pointers));const e=this.activeGesture;if(this.activeGesture=this.pointers.length,e===D.CLICK_DRAG_LONGPRESS&&this.activeGesture===D.NONE&&this.couldBeClick){const e=this.clicker.stop();e&&this.onEventCallback(e)}if(this.couldBeClick=e===D.NONE&&this.activeGesture===D.CLICK_DRAG_LONGPRESS,this.activeGesture===D.CLICK_DRAG_LONGPRESS){const e=this.clicker.start(this.pointers[0]);e&&this.onEventCallback(e);const t=this.dragger.start(this.pointers[0]);t&&this.onEventCallback(t),this.longPress.start(this.pointers[0])}else if(e===D.CLICK_DRAG_LONGPRESS){const e=this.dragger.stop();this.longPress.stop(),this.onEventCallback(e)}this.activeGesture===D.PINCH_ROTATE?(this.pincher.start(this.pointers[0],this.pointers[1]),this.rotater.start(this.pointers[0],this.pointers[1]),this.multiswiper.start(this.pointers)):e===D.PINCH_ROTATE&&(this.onEventCallback(this.pincher.stop()),this.onEventCallback(this.rotater.stop()),this.onEventCallback(this.multiswiper.stop())),this.activeGesture===D.MULTI_SWIPE_ONLY?this.multiswiper.start(this.pointers):e===D.MULTI_SWIPE_ONLY&&this.onEventCallback(this.multiswiper.stop())}getPointerIndex(e){for(let t=0;t<this.pointers.length;t++){if(this.pointers[t].id===e)return t}return-1}updateOffscreenPointer(e,t){if(e.buttons=t,0===t){const t=this.getPointerIndex(e.id);this.pointers.splice(t,1),this.toggleGestures()}}tick(){this.longPress.tick()}}var N=i(38493),I=i(94610),L=i(40168);class InputSubscription{constructor(e,t,i){this._renew=e,this._cancel=t,this.active=i}renew(){this.active()||this._renew()}cancel(){this.active()&&this._cancel()}}class InputIni extends n.Y{constructor(){super(...arguments),this.name="input-ini",this.fallbackHandlerMap={},this.meshHandlerMap={},this.priorityHandlerMap={},this.unfilteredHandlerMap={},this.captureHandlerMap={},this.gesturing=!1,this.gestureCapture=new N.Z((e=>e.object.id)),this.activeIntersections=new N.Z((e=>e.object.id)),this.eventTypeLookup=new s.cj,this.meshTypeLookup=new s.cj,this.hoveredMesh={object:null,instanceId:void 0,index:void 0},this.registerUnfilteredHandler=(e,t)=>{this.insertHandler(e,this.unfilteredHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e);return new InputSubscription((()=>this.registerUnfilteredHandler(e,t)),(()=>this.unregisterUnfilteredHandler(e,t)),(()=>-1!==this.unfilteredHandlerMap[i].indexOf(t)))},this.registerMesh=(e,t,i)=>{this.raycaster.targets.addTarget(e,t,i)},this.unregisterMesh=e=>{this.raycaster.targets.removeTarget(e)},this.onPointerEvent=e=>{const t=!e.hasOwnProperty("down"),i=!t&&e.down,n=!i&&!t;if(t||i){this.raycaster.pointer.updatePointer(e.position),this.activeIntersections.clear();for(const e of this.raycaster.pointer.cast())this.activeIntersections.add(e);if(!this.gesturing){this.gestureCapture.clear();for(const e of this.activeIntersections)this.gestureCapture.add(e);this.updateHoveredMesh()}i&&(this.gesturing=!0),this.onEvent(e)}this.inputGesture.onPointerChange(e),n&&this.onEvent(e),0===this.inputGesture.activePointers&&(this.activeIntersections.clear(),this.gestureCapture.clear(),this.gesturing&&this.updateHoveredMesh(),this.gesturing=!1)},this.onEvent=e=>{const t=this.eventTypeLookup.getKeyByInstance(e),i=this.captureHandlerMap[t];if(i&&i.length>0){for(const t of i)t(e);return void(i.length=0)}const n=this.unfilteredHandlerMap[t];if(n)for(const t of n)t(e);const s=this.iterateMeshCallbacks(e,this.gesturing?this.gestureCapture:this.activeIntersections),r=this.fallbackHandlerMap[t];if(!s&&r)for(const t of r)t(e)}}async init(e,t){const i={disableWheel:!!e.disableWheel},n=await t.getModuleBySymbol(P.y.CANVAS),s=await t.market.waitForData(L.W);this.raycaster=await t.getModuleBySymbol(P.y.RAYCASTER),new InputPointer({pointerPreventDefault:e.pointerPreventDefault},n.element,s,this.onPointerEvent),new InputKey(this.onEvent),this.inputGesture=new InputGesture,this.inputGesture.init(i,this.onEvent,t)}registerHandler(e,t){this.insertHandler(e,this.fallbackHandlerMap,t);const i=this.eventTypeLookup.getKeyByType(e,!0);return new InputSubscription((()=>this.registerHandler(e,t)),(()=>this.unregisterHandler(e,t)),(()=>-1!==this.fallbackHandlerMap[i].indexOf(t)))}unregisterHandler(e,t){this.removeHandler(e,this.fallbackHandlerMap,t)}registerMeshHandler(e,t,i){return this._registerMeshHandler(e,{comparator:t,callback:i})}_registerMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);this.meshHandlerMap[i]||(this.meshHandlerMap[i]=[]);const n=this.meshHandlerMap[i];return n.push(t),new InputSubscription((()=>this._registerMeshHandler(e,t)),(()=>this.unregisterMeshHandler(e,t)),(()=>-1!==n.indexOf(t)))}unregisterMeshHandler(e,t){const i=this.eventTypeLookup.getKeyByType(e,!0);if(this.meshHandlerMap[i]){const e=this.meshHandlerMap[i],n=e.indexOf(t);n>-1&&e.splice(n,1)}}registerPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0),r=this.meshTypeLookup.getKeyByType(t,!0);this.priorityHandlerMap[n]||(this.priorityHandlerMap[n]={});const o=this.priorityHandlerMap[n];if(o[r]){const i=(0,s.z$)(e),n=(0,s.z$)(t);throw Error(`${i} already has a priority handler registered for mesh type: ${n}`)}return o[r]=i,new InputSubscription((()=>this.registerPriorityHandler(e,t,i)),(()=>this.unregisterPriorityHandler(e,t,i)),(()=>void 0!==o[r]))}unregisterPriorityHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e),s=this.priorityHandlerMap[n];if(s){const e=this.meshTypeLookup.getKeyByType(t),n=s[e];n&&i===n&&delete s[e]}}unregisterUnfilteredHandler(e,t){this.removeHandler(e,this.unfilteredHandlerMap,t)}captureNext(e,t){return this.insertHandler(e,this.captureHandlerMap,t),t}removeCaptureHandler(e,t){this.removeHandler(e,this.captureHandlerMap,t)}registerSnappingMeshGeometry(e,t,i,n){this.raycaster.snapping.addMeshGeometry(e,t,i,n)}unregisterSnappingMeshGeometry(e){this.raycaster.snapping.removeMeshGeometry(e)}updateHoveredMesh(){const e=this.activeIntersections.getByIndex(0),t=e&&e.object===this.hoveredMesh.object&&e.instanceId===this.hoveredMesh.instanceId&&e.index===this.hoveredMesh.index;let i=!1;if(this.hoveredMesh.object&&(void 0===e||!t)){const t=this.getMeshHandler(I.A,(0,s.oL)(this.hoveredMesh.object),this.priorityHandlerMap);if(t&&(i=t(new I.A,this.hoveredMesh.object,e)||!1),!i){const t=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(I.A)];if(t)for(const i of t)i.comparator.compare(this.hoveredMesh.object)&&i.callback(new I.A,this.hoveredMesh.object,e)}}let n=!1;if(e&&!t){const t=this.getMeshHandler(I.z,(0,s.oL)(e.object),this.priorityHandlerMap);if(t&&(n=t(new I.z,e.object,e)||!1),!n){const t=this.meshHandlerMap[this.eventTypeLookup.getKeyByType(I.z)];if(t)for(const i of t)i.comparator.compare(e.object)&&i.callback(new I.z,e.object,e)}}this.hoveredMesh.object=e&&e.object||null,this.hoveredMesh.instanceId=null==e?void 0:e.instanceId,this.hoveredMesh.index=null==e?void 0:e.index}iterateMeshCallbacks(e,t){let i=!1;const n=this.eventTypeLookup.getKeyByInstance(e);for(let s=0;s<t.count();s++){const r=t.getByIndex(s);if(!r)continue;if(i)break;const o=r.object,a=this.activeIntersections.get(o.id)||r;for(const t in this.priorityHandlerMap[n])if(r.object instanceof this.meshTypeLookup.getTypeByKey(t)){const s=this.priorityHandlerMap[n]&&this.priorityHandlerMap[n][t];if(s&&(i=!0,s(e,o,a)))return!0}const l=this.meshHandlerMap[n];if(l)for(const t of l)if(t.comparator.compare(o)){const n=t.callback(e,o,a);(n||void 0===n)&&(i=!0)}}return i}insertHandler(e,t,i){const n=this.eventTypeLookup.getKeyByType(e,!0);t[n]||(t[n]=[]),t[n].push(i)}removeHandler(e,t,i){const n=t[this.eventTypeLookup.getKeyByType(e)];if(n)for(let e=0;e<n.length;e++)if(n[e]===i){n.splice(e,1);break}}getMeshHandler(e,t,i){const n=i[this.eventTypeLookup.getKeyByType(e)];if(n){return n[this.meshTypeLookup.getKeyByType(t)]}return null}onUpdate(){this.inputGesture.tick()}}},88727:(e,t,i)=>{"use strict";i.d(t,{e:()=>KeyEvent});var n=i(15614);class KeyEvent extends n.G{constructor(e,t,i){super(),this.key=e,this.state=t,this.modifiers=i}}},88216:(e,t,i)=>{"use strict";var n;i.d(t,{M:()=>n}),function(e){e[e.DOWN=0]="DOWN",e[e.PRESSED=1]="PRESSED",e[e.UP=2]="UP"}(n||(n={}))},81507:(e,t,i)=>{"use strict";var n;i.d(t,{R:()=>n}),function(e){e[e.BACKSPACE=8]="BACKSPACE",e[e.TAB=9]="TAB",e[e.RETURN=13]="RETURN",e[e.SHIFT=16]="SHIFT",e[e.CONTROL=17]="CONTROL",e[e.ALT=18]="ALT",e[e.ESCAPE=27]="ESCAPE",e[e.SPACE=32]="SPACE",e[e.HASH=35]="HASH",e[e.LEFTARROW=37]="LEFTARROW",e[e.UPARROW=38]="UPARROW",e[e.RIGHTARROW=39]="RIGHTARROW",e[e.DOWNARROW=40]="DOWNARROW",e[e.DELETE=46]="DELETE",e[e.ZERO=48]="ZERO",e[e.ONE=49]="ONE",e[e.TWO=50]="TWO",e[e.THREE=51]="THREE",e[e.FOUR=52]="FOUR",e[e.FIVE=53]="FIVE",e[e.SIX=54]="SIX",e[e.SEVEN=55]="SEVEN",e[e.EIGHT=56]="EIGHT",e[e.NINE=57]="NINE",e[e.AT=64]="AT",e[e.A=65]="A",e[e.B=66]="B",e[e.C=67]="C",e[e.D=68]="D",e[e.E=69]="E",e[e.F=70]="F",e[e.G=71]="G",e[e.H=72]="H",e[e.I=73]="I",e[e.J=74]="J",e[e.K=75]="K",e[e.L=76]="L",e[e.M=77]="M",e[e.N=78]="N",e[e.O=79]="O",e[e.P=80]="P",e[e.Q=81]="Q",e[e.R=82]="R",e[e.S=83]="S",e[e.T=84]="T",e[e.U=85]="U",e[e.V=86]="V",e[e.W=87]="W",e[e.X=88]="X",e[e.Y=89]="Y",e[e.Z=90]="Z",e[e.SEMICOLON=186]="SEMICOLON",e[e.PLUSEQUALS=187]="PLUSEQUALS",e[e.DASHUNDERSCORE=189]="DASHUNDERSCORE",e[e.OPENBRACKET=219]="OPENBRACKET"}(n||(n={}))},76870:(e,t,i)=>{"use strict";var n,s;i.d(t,{MP:()=>n,r3:()=>s,AF:()=>r,L2:()=>o}),function(e){e[e.PRIMARY=0]="PRIMARY",e[e.MIDDLE=1]="MIDDLE",e[e.SECONDARY=2]="SECONDARY",e[e.BACK=3]="BACK",e[e.FORWARD=4]="FORWARD",e[e.COUNT=5]="COUNT"}(n||(n={})),function(e){e[e.NONE=0]="NONE",e[e.PRIMARY=1]="PRIMARY",e[e.SECONDARY=4]="SECONDARY",e[e.MIDDLE=2]="MIDDLE",e[e.BACK=8]="BACK",e[e.FORWARD=16]="FORWARD",e[e.ALL=31]="ALL"}(s||(s={}));const r=e=>{const t=s[n[e]];return"number"==typeof t?t:void 0},o=e=>{const t=n[s[e]];return"number"==typeof t?t:void 0}},49340:(e,t,i)=>{"use strict";i.d(t,{_A:()=>n,er:()=>PointerButtonEvent,mE:()=>PointerMoveEvent});var n,s=i(15614);class PointerEvent extends s.G{}!function(e){e.MOUSE="mouse",e.TOUCH="touch",e.PEN="pen",e.GAMEPAD="gamepad"}(n||(n={}));class PointerButtonEvent extends PointerEvent{constructor(e,t,i,n,s,r){super(),this.id=e,this.position=t,this.clientPosition=i,this.button=n,this.down=s,this.device=r}}class PointerMoveEvent extends PointerEvent{constructor(e,t,i,n,s){super(),this.id=e,this.position=t,this.clientPosition=i,this.buttons=n,this.device=s}}},26059:(e,t,i)=>{"use strict";var n,s;i.d(t,{s:()=>n,f:()=>s}),function(e){e.Desktop="desktop",e.Mobile="mobile",e.VrOrientOnly="xr.orientonly",e.VrWithController="xr.controller",e.VrWithTrackedController="xr.trackedcontroller"}(n||(n={})),function(e){e.None="interaction.none",e.Direct="interaction.direct",e.Key="interaction.key",e.Gui="interaction.gui",e.Mouse="interaction.mouse",e.Touch="interaction.touch",e.Pen="interaction.pen",e.XRController="interaction.xr.controller",e.XRGaze="interaction.xr.gaze",e.XRScreen="interaction.xr.screen"}(s||(s={}))},19047:(e,t,i)=>{"use strict";i.d(t,{Z:()=>InteractionmodeData});var n=i(32770),s=i(26059);class InteractionmodeData extends n.V{constructor(){super(...arguments),this.name="interaction",this._source=InteractionmodeData.defaultSource,this._mode=InteractionmodeData.defaultMode}static get defaultMode(){return s.s.Desktop}static get defaultSource(){return s.f.None}get mode(){return this._mode}get source(){return this._source}updateSource(e){this._source=e}updateMode(e){this._mode=e}hasController(e=this.mode){return e===s.s.VrWithController||e===s.s.VrWithTrackedController}isVR(e=this.mode){return e===s.s.VrOrientOnly||e===s.s.VrWithController||e===s.s.VrWithTrackedController}isMobile(e=this.mode){return e===s.s.Mobile}}},94625:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>InteractionModeModule});var n=i(47724),s=i(96909),r=i(49340),o=i(88727),a=i(19047),l=i(26059),c=i(46114),d=i(60771);class InteractionModeModule extends n.Y{constructor(){super(...arguments),this.name="interactionmode",this.onPointerButtonEvent=e=>{let t=this.data.source;switch(e.device){case r._A.TOUCH:t=l.f.Touch;break;case r._A.MOUSE:t=l.f.Mouse;break;case r._A.PEN:t=l.f.Pen;break;case r._A.GAMEPAD:this.renderer.xr.enabled&&this.renderer.xr.isPresenting&&(t=l.f.XRController);break;default:this.log.debug("source:",e.device,e)}this.updateSource(t)},this.onKeyEvent=()=>{this.updateSource(l.f.Key)}}async init(e,t){this.engine=t,this.data=new a.Z,this.mobileBrowser=(0,d.tq)();const i=await t.getModuleBySymbol(s.y.WEBGL_RENDERER);this.renderer=i.threeRenderer,this.updateMode(this.getInteractionMode(),this.data.mode),this.engine.market.register(this,a.Z,this.data),t.getModuleBySymbol(s.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(r.er,this.onPointerButtonEvent),e.registerHandler(o.e,this.onKeyEvent))}))}onUpdate(e){const t=this.getInteractionMode();this.updateMode(t,this.data.mode)}getInteractionMode(){if(this.renderer.xr.enabled&&this.renderer.xr.isPresenting){const e=this.renderer.xr.getSession();if(null!==e&&e.inputSources.length>0)switch(e.inputSources[0].targetRayMode){case"gaze":case"screen":return l.s.VrOrientOnly;case"tracked-pointer":return l.s.VrWithTrackedController}return l.s.VrOrientOnly}return this.mobileBrowser?l.s.Mobile:l.s.Desktop}updateMode(e,t){e!==this.data.mode&&(this.data.updateMode(e),this.data.commit(),this.engine.broadcast(new c.m(this.data.mode,t)))}updateSource(e){e!==this.data.source&&(this.data.updateSource(e),this.data.commit(),this.engine.broadcast(new c.a(this.data.source)))}}},46114:(e,t,i)=>{"use strict";i.d(t,{m:()=>InteractionModeChangeMessage,a:()=>InteractionSourceChangeMessage});var n=i(91466);class InteractionModeChangeMessage extends n.v{constructor(e,t){super(),this.mode=e,this.fromMode=t}}class InteractionSourceChangeMessage extends n.v{constructor(e){super(),this.source=e}}},74371:(e,t,i)=>{"use strict";i.d(t,{D:()=>LabelData});var n=i(32770),s=i(64781),r=i(10757);const o=new(i(88512).Z)("label-data");class LabelData extends n.V{constructor(e){super(),this.name="label",this.has=e=>this.map.has(e),this.getLabel=e=>this.map.get(e),this.map=(0,s.q)(e||{})}getCount(){return this.map.length}add(e){let t=e.sid;return this.map.has(t)&&o.warn("Label already tracked:",{sid:t,label:e,existing:this.getLabel(t)}),t=t||this.generateSid(),e.sid=t,e.commit(),this.map.set(e.sid,e),t}generateSid(){let e="";for(;!e||this.map.has(e);)e=(0,r.O1)(11);return e}remove(e){return!!this.map.has(e)&&(this.map.delete(e),!0)}clear(){for(const e of this.map.keys)this.map.delete(e)}getCollection(){return this.map}iterate(e){for(const t of this.map.keys)e(this.map.get(t),t)}isEqual(e){if(this.map.length!==e.map.length)return!1;for(const t of this.map){const i=e.map.get(t.sid);if(!i||!LabelData.labelsAreEqual(t,i))return!1}return!0}static labelsAreEqual(e,t){return e.floorId===t.floorId&&e.roomId===t.roomId&&e.position.x===t.position.x&&e.position.y===t.position.y&&e.position.z===t.position.z&&e.sid===t.sid&&e.text===t.text&&e.floorId===t.floorId&&e.roomId===t.roomId&&e.visible===t.visible}getLabelsForRoom(e){const t=[];return this.iterate((i=>{i.roomId===e&&t.push(i)})),t}}},23502:(e,t,i)=>{"use strict";i.d(t,{Nj:()=>n,Cu:()=>s});const n="features/labels",s="features/3d_labels_enabled"},25643:(e,t,i)=>{"use strict";i.d(t,{V:()=>RTLDisabledRoomnavMessage});var n=i(91466);class RTLDisabledRoomnavMessage extends n.v{}},23275:(e,t,i)=>{"use strict";i.d(t,{c:()=>LineSegment});var n=i(2212),s=i(78475);class Line extends n.Mesh{constructor(e,t){super(),this.type="Line",this.part=s.B.line,this.computeLineDistances=(()=>{const e=new n.Vector3,t=new n.Vector3;return()=>{const i=this.geometry,s=i.attributes.instanceStart,r=i.attributes.instanceEnd,o=new Float32Array(2*s.data.count);for(let i=0,n=0,a=s.data.count;i<a;i++,n+=2)e.fromBufferAttribute(s,i),t.fromBufferAttribute(r,i),o[n]=0===n?0:o[n-1],o[n+1]=o[n]+e.distanceTo(t);return this.instanceDistanceBuffer?(this.instanceDistanceBuffer.set(o,0),this.instanceDistanceBuffer.needsUpdate=!0):(this.instanceDistanceBuffer=new n.InstancedInterleavedBuffer(o,2,1),i.setAttribute("instanceDistanceStart",new n.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,0,!1)),i.setAttribute("instanceDistanceEnd",new n.InterleavedBufferAttribute(this.instanceDistanceBuffer,1,1,!1))),this}})(),this.geometry=e,this.material=t}copy(e){throw Error("not implemented")}}class LineSegmentsGeometry extends n.InstancedBufferGeometry{constructor(){super(),this.type="LineSegmentsGeometry";this.setIndex([0,2,1,2,3,1,2,4,3,4,5,3,4,6,5,6,7,5]),this.setAttribute("position",new n.Float32BufferAttribute([-1,2,0,1,2,0,-1,1,0,1,1,0,-1,0,0,1,0,0,-1,-1,0,1,-1,0],3)),this.setAttribute("uv",new n.Float32BufferAttribute([0,1,.5,1,0,.5,.5,.5,0,0,.5,0,0,1,.5,1],2))}applyMatrix(e){const t=this.attributes.instanceStart,i=this.attributes.instanceEnd;return void 0!==t&&(t.applyMatrix4(e),i.applyMatrix4(e),this.positionBuffer.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}setPositions(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.positionBuffer?(this.positionBuffer.set(t,0),this.positionBuffer.needsUpdate=!0):(this.positionBuffer=new n.InstancedInterleavedBuffer(t,6,1),this.setAttribute("instanceStart",new n.InterleavedBufferAttribute(this.positionBuffer,3,0,!1)),this.setAttribute("instanceEnd",new n.InterleavedBufferAttribute(this.positionBuffer,3,3,!1))),this.computeBoundingBox(),this.computeBoundingSphere()),this}setColors(e){let t;return e instanceof Float32Array?t=e:Array.isArray(e)&&(t=new Float32Array(e)),t&&(this.colorBuffer?(this.colorBuffer.set(t,0),this.colorBuffer.needsUpdate=!0):(this.colorBuffer=new n.InstancedInterleavedBuffer(t,6,1),this.setAttribute("instanceColorStart",new n.InterleavedBufferAttribute(this.colorBuffer,3,0,!1)),this.setAttribute("instanceColorEnd",new n.InterleavedBufferAttribute(this.colorBuffer,3,3,!1)))),this}fromWireframeGeometry(e){return this.setPositions(e.attributes.position.array),this}fromEdgesGeometry(e){return this.setPositions(e.attributes.position.array),this}fromMesh(e){return this.fromWireframeGeometry(new n.WireframeGeometry(e.geometry)),this}fromLineSegements(e){const t=e.geometry;return t instanceof n.BufferGeometry&&this.setPositions(t.position.array),this}computeBoundingBox(){this.boundingBox||(this.boundingBox=new n.Box3),this.box||(this.box=new n.Box3);const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;void 0!==e&&void 0!==t&&(this.boundingBox.setFromBufferAttribute(e),this.box.setFromBufferAttribute(t),this.boundingBox.union(this.box))}computeBoundingSphere(){this.tempVector||(this.tempVector=new n.Vector3),this.boundingSphere||(this.boundingSphere=new n.Sphere),this.boundingBox||this.computeBoundingBox();const e=this.attributes.instanceStart,t=this.attributes.instanceEnd;if(void 0!==e&&void 0!==t){const i=this.boundingSphere.center;this.boundingBox.getCenter(i);let n=0;for(let s=0,r=e.count;s<r;s++)this.tempVector.fromBufferAttribute(e,s),n=Math.max(n,i.distanceToSquared(this.tempVector)),this.tempVector.fromBufferAttribute(t,s),n=Math.max(n,i.distanceToSquared(this.tempVector));this.boundingSphere.radius=Math.sqrt(n),isNaN(this.boundingSphere.radius)&&console.error("computeBoundingSphere(): Computed radius is NaN. The instanced position data is likely to have NaN values.",this)}}}class LineGeometry extends LineSegmentsGeometry{constructor(){super(),this.type="LineGeometry",this.isLineGeometry=!0}setPositions(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return LineSegmentsGeometry.prototype.setPositions.call(this,i),this}setColors(e){const t=e.length-3,i=new Float32Array(2*t);for(let n=0;n<t;n+=3)i[2*n]=e[n],i[2*n+1]=e[n+1],i[2*n+2]=e[n+2],i[2*n+3]=e[n+3],i[2*n+4]=e[n+4],i[2*n+5]=e[n+5];return LineSegmentsGeometry.prototype.setColors.call(this,i),this}fromLine(e){throw new Error("LineGeometry.fromLine not converted to TS yet")}copy(e){return this}}var r=i(69626),o=i(37342);class LineEndpoint extends n.Mesh{constructor(e,t,i=o.V9.endpointSelected,n=o.V9.endpointDefault){super(e,t),this.selectedSize=i,this.defaultSize=n,this.currentSize=o.V9.endpointDefault,this.currentSize=this.defaultSize,this.scale.set(o.Ey,o.Ey,o.Ey)}dispose(){this.material.dispose(),this.geometry.dispose()}billboardScale(e,t,i){const n=(0,r.mY)(t,e,this.position,i,.5),s=Math.max(Math.min(1/n*this.currentSize,o.g4),o.Ey);this.scale.set(s,s,s)}updateSelected(e){this.currentSize=e?this.selectedSize:this.defaultSize}}var a=i(48358),l=i(74384);class LineSegment{constructor(e,t,i,o,c){this.lineMaterial=i,this.options=o,this.endpointMaterial=c,this.startPosition=new n.Vector3,this.endPosition=new n.Vector3,this.endpoints=!1,this.isVisible=!0,this.meshToLinePartMap={},this.opacity=e=>(this.endpointMaterial&&this.endpointMaterial.setOpacity(e),this.lineMesh.material.setOpacity(e),this),this.updatePositions=(e,t)=>(this.startPosition.copy(e),this.endPosition.copy(t),this.options.beforeUpdatePositions&&(e=this.options.beforeUpdatePositions(e),t=this.options.beforeUpdatePositions(t)),this.lineMesh.geometry.setPositions([e.x,e.y,e.z,t.x,t.y,t.z]),this.endpoints&&(this.endMesh.position.copy(t),this.startMesh.position.copy(e),this.lastBillboardOptions&&this.updateBillboard(this.lastBillboardOptions)),this.lineMesh.material.dashed&&this.lineMesh.computeLineDistances(),this),this.updateBillboard=e=>{if(this.endpoints&&(e.rotation&&(this.endMesh.quaternion.copy(e.rotation),this.startMesh.quaternion.copy(e.rotation)),e.position&&e.projection&&!(0,r.s1)(e.projection))){const t=this.lineMesh.material.resolution.y;this.endMesh.billboardScale(e.position,e.projection,t),this.startMesh.billboardScale(e.position,e.projection,t)}return this.lastBillboardOptions=e,this},this.updateSelected=e=>(this.lineMesh.material.updateSelected(e),this.endpoints&&(this.endMesh.material.updateHovered(e),this.endMesh.updateSelected(e),this.startMesh.updateSelected(e)),this),this.setRenderLayer=e=>{this.children.forEach((t=>t.layers.mask=e.mask))},this.setRenderOrder=e=>{this.children.forEach((t=>t.renderOrder=e))},this.updateResolution=(e,t)=>(this.lineMesh.material.resolution.set(e,t),this),this.hide=()=>{this.options.onHide&&this.options.onHide(),this.isVisible=!1},this.show=()=>{this.options.onShow&&this.options.onShow(),this.isVisible=!0},this.toggle=e=>(e?this.show():this.hide(),this),this.dispose=()=>{this.options.onHide&&this.options.onHide(),this.lineMesh.geometry.dispose(),this.lineMesh.material.dispose(),this.endMesh&&this.endMesh.dispose(),this.startMesh&&this.startMesh.dispose(),this.meshToLinePartMap={}},this.overrideLineMaterial=e=>{this.lineMesh.material=e},this.restoreLineMaterial=()=>{this.lineMesh.material=this.lineMaterial},this.startPosition.copy(e),this.endPosition.copy(t),this.lineMesh=new Line(new LineGeometry,i),this.lineMesh.matrixAutoUpdate=!1,this.lineMesh.part=s.B.line,this.lineMesh.renderOrder=a.z.lines,this.meshToLinePartMap[s.B.line]=this.lineMesh,c&&(this.endpoints=!0,this.endMesh=new LineEndpoint((0,l.fc)(),c),this.endMesh.part=s.B.end,this.endMesh.renderOrder=a.z.endpoints,this.meshToLinePartMap[s.B.end]=this.endMesh,this.startMesh=new LineEndpoint((0,l.fc)(),c),this.startMesh.part=s.B.start,this.startMesh.renderOrder=a.z.endpoints,this.meshToLinePartMap[s.B.start]=this.startMesh),this.updatePositions(this.startPosition,this.endPosition),this.updateSelected(!1)}get currentOpacity(){return this.lineMesh.material.getOpacity()}getMesh(e){return this.meshToLinePartMap[e]}get children(){return Object.keys(this.meshToLinePartMap).map((e=>this.meshToLinePartMap[e]))}get visible(){return this.isVisible}}},78475:(e,t,i)=>{"use strict";var n;i.d(t,{B:()=>n}),function(e){e.line="line",e.start="start",e.end="end"}(n||(n={}))},26589:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Lines});var n,s=i(47724),r=i(96909),o=i(2212),a=i(23275),l=i(66223),c=i(91975),d=i(40886),h=i(71370),u=i(88296);!function(e){e[e.LINE_DEFAULT=0]="LINE_DEFAULT",e[e.LINE_HOVER=1]="LINE_HOVER",e[e.END_DEFAULT=2]="END_DEFAULT",e[e.END_HOVER=3]="END_HOVER"}(n||(n={}));class LineTextures{constructor(){const e=(0,l.p)(c),t=(0,l.p)(d),i=(0,l.p)(h),s=(0,l.p)(u);this.textures={[n.LINE_DEFAULT]:i,[n.LINE_HOVER]:s,[n.END_DEFAULT]:e,[n.END_HOVER]:t},i.minFilter=o.LinearFilter,s.minFilter=o.LinearFilter,e.minFilter=o.LinearFilter,t.minFilter=o.LinearFilter}get(e){return this.textures[e]}dispose(){for(const e in this.textures){const t=Number(e);this.get(t).dispose()}}}const p={endpoint:{uniforms:{opacity:{type:"f",value:1},color:{type:"c",value:new o.Color},bg:{type:"t",value:null}},vertexShader:i(79826),fragmentShader:i(2209)},line:{uniforms:o.UniformsUtils.merge([o.UniformsLib.common,o.UniformsLib.fog,{linewidth:{value:4},resolution:{value:new o.Vector2(0,0)},dashScale:{value:1},dashSize:{value:.025},gapSize:{value:.05},mask:{value:null}}]),vertexShader:i(63862),fragmentShader:i(64116)}};var m=i(37342);class LineMaterial extends o.RawShaderMaterial{constructor(e,t,i,n=m.V9.lineSelected){super(),this.parameters=e,this.hoverTexture=t,this.defaultTexture=i,this.selectedWidth=n,this.type="LineMaterial",this.isLineMaterial=!0,this.defaultWidth=m.V9.lineDefault,this.setValues({uniforms:o.UniformsUtils.clone(p.line.uniforms),vertexShader:p.line.vertexShader,fragmentShader:p.line.fragmentShader,transparent:!0,depthWrite:!1,depthTest:!0,opacity:1}),this.setValues(e),i&&(this.mask=i),this.defaultWidth=e&&e.linewidth?e.linewidth:m.V9.lineDefault}updateSelected(e){const t=e?this.hoverTexture:this.defaultTexture;t&&this.mask!==t&&(this.mask=t,e?this.setLinewidth(this.selectedWidth):this.setLinewidth(this.defaultWidth))}setLinewidth(e){this.uniforms.linewidth||(this.uniforms=o.UniformsUtils.clone(p.line.uniforms)),this.getLinewidth()!==e&&(this.uniforms.linewidth.value=e)}getLinewidth(){return this.uniforms.linewidth.value}get color(){return this.uniforms.diffuse.value}set color(e){this.uniforms.diffuse.value=e}getOpacity(){return this.uniforms.opacity.value}setOpacity(e){this.uniforms||(this.uniforms=o.UniformsUtils.clone(p.line.uniforms)),this.getOpacity()!==e&&(this.uniforms.opacity.value=e)}get dashScale(){return this.uniforms.dashScale.value}set dashScale(e){this.uniforms.dashScale.value=e}set dashed(e){e?this.defines.USE_DASH="":delete this.defines.USE_DASH,this.needsUpdate=!0}get dashed(){return"USE_DASH"in this.defines}get dashSize(){return this.uniforms.dashSize.value}set dashSize(e){this.uniforms.dashSize.value=e}get gapSize(){return this.uniforms.gapSize.value}set gapSize(e){this.uniforms.gapSize.value=e}get resolution(){return this.uniforms.resolution.value}set resolution(e){this.uniforms.resolution.value=e}set mask(e){this.uniforms.mask.value!==e&&(e?this.defines.USE_MASK="":delete this.defines.USE_MASK,this.uniforms.mask.value=e,this.needsUpdate=!0)}get mask(){return this.uniforms.mask.value}copy(e){return o.RawShaderMaterial.prototype.copy.call(this,e),this.parameters=e.parameters,this.color.copy(e.color),this.defaultWidth=e.defaultWidth,this.setLinewidth(e.getLinewidth()),this.resolution.copy(e.resolution),this.defaultTexture=e.defaultTexture,this.hoverTexture=e.hoverTexture,this.mask=e.mask,this.setOpacity(e.getOpacity()),this.dashed=e.dashed,this.dashScale=e.dashScale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}class LineEndpointMaterial extends o.RawShaderMaterial{constructor(e,t,i){const n=o.UniformsUtils.clone(p.endpoint.uniforms);super({fragmentShader:p.endpoint.fragmentShader,vertexShader:p.endpoint.vertexShader,uniforms:n,name:"LineEndpointMaterial",transparent:!0,depthWrite:!1,depthTest:!0}),this.color=e,this.defaultTex=t,this.hoverTex=i,this.uniforms.bg.value=t,this.uniforms.color.value.copy(this.color)}clone(){return new LineEndpointMaterial(this.color,this.defaultTex,this.hoverTex).copy(this)}setOpacity(e){this.uniforms&&e!==this.uniforms.opacity.value&&(this.uniforms.opacity.value=e)}getOpacity(){return this.uniforms.opacity.value}updateHovered(e){const t=e?this.hoverTex:this.defaultTex;this.uniforms.bg.value!==t&&(this.uniforms.bg.value=t)}}var f=i(59088),g=i(67627),v=i(40168);class Lines extends s.Y{constructor(){super(...arguments),this.name="lines",this.makeLineMaterial=(e,t,i={},n,s)=>Lines.makeLineMaterial(e,t,i,n,s),this.makeEndpointMaterial=(e,t,i)=>Lines.makeEndpointMaterial(e,t,i),this.onCanvasChange=e=>{for(const t of this.segments)t.updateResolution(e.width,e.height)}}static get textures(){return Lines._textures||(Lines._textures=new LineTextures),Lines._textures}async init(e,t){Lines._textures||(Lines._textures=new LineTextures);const i=await t.getModuleBySymbol(r.y.WEBGL_RENDERER);this.scene=i.getScene(),this.canvas=await t.market.waitForData(v.W),this.cameraData=await t.market.waitForData(f.M_),this.bindings.push(this.canvas.onChanged(this.onCanvasChange)),this.cameraPosition=new o.Vector3,this.segments=[]}onUpdate(){this.cameraPosition.copy(this.cameraData.pose.position)}dispose(e){super.dispose(e),this.segments.forEach((e=>e.dispose()))}makeLine(e,t,i,n,s=(()=>!1)){const r=s()?m.iV.OFFSET_TOWARDS_CAMERA:0,o=s()?e=>this.cameraPosition.clone().sub(e).setLength(r).add(e):e=>e,l=new a.c(e,t,i,{beforeUpdatePositions:o,onShow:()=>l.children.forEach((e=>this.scene.addChild(g.a.Root,e))),onHide:()=>l.children.forEach((e=>this.scene.removeChild(g.a.Root,e)))},n);return l.updateResolution(this.canvas.width,this.canvas.height),l.opacity(1),l.show(),l.updatePositions(e,t),this.segments.push(l),l}}Lines.makeLineMaterial=(e,t,i={},s,r)=>{const a=r||Lines.textures.get(n.LINE_HOVER),l=s||Lines.textures.get(n.LINE_DEFAULT),c=new o.Vector2(window.innerWidth,window.innerHeight);return t?new LineMaterial(Object.assign({color:new o.Color(e),resolution:c},i),a,l):new LineMaterial(Object.assign({color:new o.Color(e)},i))},Lines.makeEndpointMaterial=(e,t,i)=>{const s=i||Lines.textures.get(n.END_HOVER),r=t||Lines.textures.get(n.END_DEFAULT);return new LineEndpointMaterial(new o.Color(e),r,s)}},37342:(e,t,i)=>{"use strict";i.d(t,{iV:()=>n,V9:()=>s,Ey:()=>r,g4:()=>o});const n={FADE_DURATION:300,LABEL_HIDDEN_OPACITY:.15,DEPTH_WRITE_THRESHOD:.15,ALIGN_LABELS:!1,LABEL_SIZING:.14,LABEL_NDC_SCALEFACTOR:.5,LABEL_ASPECT_SCALEFACTOR:.035,OFFSET_TOWARDS_CAMERA:.25,HIDE_LABELS:!1},s={dottedLineDefault:2,lineDefault:6,lineSelected:6,endpointDefault:2.5,endpointSelected:3.75},r=.01,o=5},13789:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e.LOADING="LOADING",e.PRESENTED_BY_CAPS="PRESENTED_BY_CAPS",e.EXPLORE_3D_SPACE="EXPLORE_3D_SPACE",e.POWERED_BY="POWERED_BY",e.SC_LOCKOUT_MESSAGE="SC_LOCKOUT_MESSAGE",e.SC_LOCKOUT_TITLE="SC_LOCKOUT_TITLE",e.SC_PASSWORD_TITLE="SC_PASSWORD_TITLE",e.SC_PASSWORD_INVALID="SC_PASSWORD_INVALID",e.SC_PASSWORD_PLACEHOLDER="SC_PASSWORD_PLACEHOLDER",e.SC_PASSWORD_SUBMIT="SC_PASSWORD_SUBMIT",e.VIEW_INSIDE="VIEW_INSIDE",e.VIEW_INSIDE_MESH="VIEW_INSIDE_MESH",e.VIEW_DOLLHOUSE="VIEW_DOLLHOUSE",e.VIEW_FLOORPLAN="VIEW_FLOORPLAN",e.VIEW_FULLSCREEN="VIEW_FULLSCREEN",e.EXIT_FULLSCREEN="EXIT_FULLSCREEN",e.OPEN_HIGHLIGHTS="OPEN_HIGHLIGHTS",e.CLOSE_HIGHLIGHTS="CLOSE_HIGHLIGHTS",e.PAUSE="PAUSE",e.SOCIAL_SHARING="SOCIAL_SHARING",e.VIEW_IN_VR="VIEW_IN_VR",e.FLOOR_NAME="FLOOR_NAME",e.FLOOR_ALL="FLOOR_ALL",e.PRESENTED_BY="PRESENTED_BY",e.MORE="MORE",e.LESS="LESS",e.LEARN_MORE="LEARN_MORE",e.FEEDBACK="FEEDBACK",e.TERMS="TERMS",e.HELP="HELP",e.ALT_MATTERPORT_LOGO="ALT_MATTERPORT_LOGO",e.TERMS_FAIL="TERMS_FAIL",e.HELP_NAVIGATION_TAB="HELP_NAVIGATION_TAB",e.HELP_MORE_HELP_TAB="HELP_MORE_HELP_TAB",e.HELP_DESKTOP_360_2A="HELP_DESKTOP_360_2A",e.HELP_DESKTOP_360_2B="HELP_DESKTOP_360_2B",e.HELP_DESKTOP_DOLLHOUSE_1A="HELP_DESKTOP_DOLLHOUSE_1A",e.HELP_DESKTOP_DOLLHOUSE_1B="HELP_DESKTOP_DOLLHOUSE_1B",e.HELP_DESKTOP_DOLLHOUSE_2A="HELP_DESKTOP_DOLLHOUSE_2A",e.HELP_DESKTOP_DOLLHOUSE_3A="HELP_DESKTOP_DOLLHOUSE_3A",e.HELP_DESKTOP_FLOORPLAN_1A="HELP_DESKTOP_FLOORPLAN_1A",e.HELP_DESKTOP_FLOORPLAN_2A="HELP_DESKTOP_FLOORPLAN_2A",e.HELP_DESKTOP_FLOORPLAN_2B="HELP_DESKTOP_FLOORPLAN_2B",e.HELP_DESKTOP_FLOORPLAN_3A="HELP_DESKTOP_FLOORPLAN_3A",e.HELP_DESKTOP_FLOORPLAN_3B="HELP_DESKTOP_FLOORPLAN_3B",e.HELP_DESKTOP_MORE_360_B="HELP_DESKTOP_MORE_360_B",e.HELP_DESKTOP_MORE_DOLLHOUSE_B="HELP_DESKTOP_MORE_DOLLHOUSE_B",e.HELP_DESKTOP_MORE_FLOORS_B="HELP_DESKTOP_MORE_FLOORS_B",e.HELP_DESKTOP_MORE_FULLSCREEN_B="HELP_DESKTOP_MORE_FULLSCREEN_B",e.HELP_DESKTOP_MORE_HLR_B="HELP_DESKTOP_MORE_HLR_B",e.HELP_DESKTOP_MORE_INSIDE_B="HELP_DESKTOP_MORE_INSIDE_B",e.HELP_DESKTOP_MORE_MATTERTAG_B="HELP_DESKTOP_MORE_MATTERTAG_B",e.HELP_DESKTOP_MORE_TOUR_B="HELP_DESKTOP_MORE_TOUR_B",e.HELP_DESKTOP_MORE_VR_B="HELP_DESKTOP_MORE_VR_B",e.HELP_DESKTOP_MORE_ZOOM_B="HELP_DESKTOP_MORE_ZOOM_B",e.HELP_DESKTOP_PANORAMA_1A="HELP_DESKTOP_PANORAMA_1A",e.HELP_DESKTOP_PANORAMA_1B="HELP_DESKTOP_PANORAMA_1B",e.HELP_DESKTOP_PANORAMA_2A="HELP_DESKTOP_PANORAMA_2A",e.HELP_DESKTOP_PANORAMA_2B="HELP_DESKTOP_PANORAMA_2B",e.HELP_DESKTOP_PANORAMA_3A="HELP_DESKTOP_PANORAMA_3A",e.HELP_DESKTOP_PANORAMA_3B="HELP_DESKTOP_PANORAMA_3B",e.HELP_MOBILE_3="HELP_MOBILE_3",e.HELP_MOBILE_360_2="HELP_MOBILE_360_2",e.HELP_MOBILE_DOLLHOUSE_1="HELP_MOBILE_DOLLHOUSE_1",e.HELP_MOBILE_DOLLHOUSE_2="HELP_MOBILE_DOLLHOUSE_2",e.HELP_MOBILE_FLOORPLAN_1="HELP_MOBILE_FLOORPLAN_1",e.HELP_MOBILE_FLOORPLAN_2="HELP_MOBILE_FLOORPLAN_2",e.HELP_MOBILE_MORE_360_B="HELP_MOBILE_MORE_360_B",e.HELP_MOBILE_MORE_DOLLHOUSE_B="HELP_MOBILE_MORE_DOLLHOUSE_B",e.HELP_MOBILE_MORE_INSIDE_B="HELP_MOBILE_MORE_INSIDE_B",e.HELP_MOBILE_MORE_MATTERTAG_B="HELP_MOBILE_MORE_MATTERTAG_B",e.HELP_MOBILE_MORE_VR_B="HELP_MOBILE_MORE_VR_B",e.HELP_MOBILE_PANORAMA_1="HELP_MOBILE_PANORAMA_1",e.HELP_MOBILE_PANORAMA_2="HELP_MOBILE_PANORAMA_2",e.HELP_MORE_360_A="HELP_MORE_360_A",e.HELP_MORE_DOLLHOUSE_A="HELP_MORE_DOLLHOUSE_A",e.HELP_MORE_FLOORS_A="HELP_MORE_FLOORS_A",e.HELP_MORE_FLOORPLAN_A="HELP_MORE_FLOORPLAN_A",e.HELP_MORE_FULLSCREEN_A="HELP_MORE_FULLSCREEN_A",e.HELP_MORE_HLR_A="HELP_MORE_HLR_A",e.HELP_MORE_INSIDE_A="HELP_MORE_INSIDE_A",e.HELP_MORE_MATTERTAG_A="HELP_MORE_MATTERTAG_A",e.HELP_MORE_TOUR_A="HELP_MORE_TOUR_A",e.HELP_MORE_VR_A="HELP_MORE_VR_A",e.HELP_MORE_ZOOM_A="HELP_MORE_ZOOM_A",e.VR_APP_INSTRUCT="VR_APP_INSTRUCT",e.VR_APP_RECCOMMENDED="VR_APP_RECCOMMENDED",e.VR_ENTER="VR_ENTER",e.VR_LEARN_MORE_CAPS="VR_LEARN_MORE_CAPS",e.VR_QUEST="VR_QUEST",e.VR_RECOMMENDED="VR_RECOMMENDED",e.VR_SUPPORTS="VR_SUPPORTS",e.VR_VIEW_SPACE="VR_VIEW_SPACE",e.ERROR_WEBGL_UNSUPPORTED_PROBLEM="ERROR_WEBGL_UNSUPPORTED_PROBLEM",e.ERROR_BROWSER_SOLUTION="ERROR_BROWSER_SOLUTION",e.ERROR_BROWSER_EXPLANATION="ERROR_BROWSER_EXPLANATION",e.ERROR_LOADING_FAILED_PROBLEM="ERROR_LOADING_FAILED_PROBLEM",e.ERROR_LOADING_FAILED_ACTIONS="ERROR_LOADING_FAILED_ACTIONS",e.ERROR_GENERIC_PROBLEM="ERROR_GENERIC_PROBLEM",e.ERROR_GENERIC_SOLUTION="ERROR_GENERIC_SOLUTION",e.ERROR_GENERIC_ACTIONS="ERROR_GENERIC_ACTIONS",e.ERROR_GENERIC_ACTIONS_MOBILE="ERROR_GENERIC_ACTIONS_MOBILE",e.DESKTOP_SHORT_CTA="DESKTOP_SHORT_CTA",e.MOBILE_SHORT_CTA="MOBILE_SHORT_CTA",e.ROTATE="ROTATE",e.MOVE="MOVE",e.PLAY="PLAY",e.INSIDE="INSIDE",e.ZOOM="ZOOM",e.MEASUREMENT="MEASUREMENT",e.MEASUREMENT_START_ADDING="MEASUREMENT_START_ADDING",e.MEASUREMENT_CONTINUOUS_LINES="MEASUREMENT_CONTINUOUS_LINES",e.MEASUREMENT_SNAPPING="MEASUREMENT_SNAPPING",e.MEASUREMENT_UNITS="MEASUREMENT_UNITS",e.MEASUREMENT_IMPERIAL="MEASUREMENT_IMPERIAL",e.MEASUREMENT_METRIC="MEASUREMENT_METRIC",e.MEASUREMENT_SETTINGS="MEASUREMENT_SETTINGS",e.MEASUREMENT_HELP_CLICK_ANYWHERE="MEASUREMENT_HELP_CLICK_ANYWHERE",e.MEASUREMENT_HELP_ESCAPE="MEASUREMENT_HELP_ESCAPE",e.MEASUREMENT_HELP_PRESS_START="MEASUREMENT_HELP_PRESS_START",e.MEASUREMENT_HELP_DRAG_EDIT="MEASUREMENT_HELP_DRAG_EDIT",e.MEASUREMENT_HELP_PRESS_END="MEASUREMENT_HELP_PRESS_END",e.MEASUREMENT_MODE="MEASUREMENT_MODE",e.MEASUREMENT_HELP_MODAL_SUB_HEADER="MEASUREMENT_HELP_MODAL_SUB_HEADER",e.MEASUREMENT_HELP_MODAL_BODY_1="MEASUREMENT_HELP_MODAL_BODY_1",e.MEASUREMENT_HELP_MODAL_BODY_2="MEASUREMENT_HELP_MODAL_BODY_2",e.MEASUREMENT_NUDGE_TITLE="MEASUREMENT_NUDGE_TITLE",e.MEASUREMENT_NUDGE_MESSAGE="MEASUREMENT_NUDGE_MESSAGE",e.NOTES_MODE="NOTES_MODE",e.NOTES_NUDGE_TITLE="NOTES_NUDGE_TITLE",e.NOTES_NUDGE_MESSAGE="NOTES_NUDGE_MESSAGE",e.ON="ON",e.OFF="OFF",e.CLOSE="CLOSE",e.COPY="COPY",e.COPY_URL="COPY_URL",e.COPY_LINK="COPY_LINK",e.SHARE="SHARE",e.SHARE_COPIED="SHARE_COPIED",e.SHARE_CURRENT_LOCATION="SHARE_CURRENT_LOCATION",e.SHARE_DEFAULT_LOCATION="SHARE_DEFAULT_LOCATION",e.SHARE_ERROR_SWEEP_DISABLED="SHARE_ERROR_SWEEP_DISABLED",e.SHARE_EXPLORE="SHARE_EXPLORE",e.SHARE_LINK_TO_LOCATION="SHARE_LINK_TO_LOCATION",e.SHARE_AT="SHARE_AT",e.SHARE_WITH="SHARE_WITH",e.SHARE_3D="SHARE_3D",e.SHARE_MODAL_TITLE="SHARE_MODAL_TITLE",e.SHARED_TITLE="SHARED_TITLE",e.SHARED_MESSAGE="SHARED_MESSAGE",e.SHARED_MESSAGE_HASHTAG="SHARED_MESSAGE_HASHTAG"}(n||(n={})),function(e){let t,i,n,s,r,o;!function(e){e.COLLAPSE_PANEL="PANELS.COLLAPSE_PANEL",e.EXPAND_PANEL="PANELS.EXPAND_PANEL"}(t=e.PANELS||(e.PANELS={})),function(e){e.CLOSE_BUTTON_TOOLTIP_MESSAGE="REUSABLES.CLOSE_BUTTON_TOOLTIP_MESSAGE",e.HELP_BUTTON_TOOLTIP_MESSAGE="REUSABLES.HELP_BUTTON_TOOLTIP_MESSAGE",e.EMOJI_ALT_DISAPPOINTED="REUSABLES.EMOJI_ALT_DISAPPOINTED",e.EMOJI_ALT_UNSATISFIED="REUSABLES.EMOJI_ALT_UNSATISFIED",e.EMOJI_ALT_NEUTRAL="REUSABLES.EMOJI_ALT_NEUTRAL",e.EMOJI_ALT_SATISFIED="REUSABLES.EMOJI_ALT_SATISFIED",e.EMOJI_ALT_HAPPY="REUSABLES.EMOJI_ALT_HAPPY"}(i=e.REUSABLES||(e.REUSABLES={})),function(e){let t,i,n,s,r,o,a,l,c,d;!function(e){e.UPLOAD_TOOLTIP="SHOWCASE.ANNOTATIONS.UPLOAD_TOOLTIP",e.EMBED_TOOLTIP="SHOWCASE.ANNOTATIONS.EMBED_TOOLTIP",e.MAX_ATTACHMENTS_TOOLTIP="SHOWCASE.ANNOTATIONS.MAX_ATTACHMENTS_TOOLTIP",e.LINK_TOOLTIP="SHOWCASE.ANNOTATIONS.LINK_TOOLTIP",e.ADD_CTA="SHOWCASE.ANNOTATIONS.ADD_CTA",e.SAVE_CTA="SHOWCASE.ANNOTATIONS.SAVE_CTA",e.CANCEL_CTA="SHOWCASE.ANNOTATIONS.CANCEL_CTA",e.CONTENT_DELETED="SHOWCASE.ANNOTATIONS.CONTENT_DELETED"}(t=e.ANNOTATIONS||(e.ANNOTATIONS={})),function(e){e.ERROR_UPLOAD_FAIL="SHOWCASE.ATTACHMENTS.ERROR_UPLOAD_FAIL",e.ERROR_FILE_TOO_LARGE="SHOWCASE.ATTACHMENTS.ERROR_FILE_TOO_LARGE",e.ERROR_EMPTY_FILE="SHOWCASE.ATTACHMENTS.ERROR_EMPTY_FILE",e.ERROR_OVER_QUOTA="SHOWCASE.ATTACHMENTS.ERROR_OVER_QUOTA",e.ERROR_PERMISSION_DENIED="SHOWCASE.ATTACHMENTS.ERROR_PERMISSION_DENIED",e.REMOVE_TOOLTIP="SHOWCASE.ATTACHMENTS.REMOVE_TOOLTIP",e.CLOSE_TOOLTIP="SHOWCASE.ATTACHMENTS.CLOSE_TOOLTIP",e.DOWNLOAD_TOOLTIP="SHOWCASE.ATTACHMENTS.DOWNLOAD_TOOLTIP"}(i=e.ATTACHMENTS||(e.ATTACHMENTS={})),function(e){e.DEFAULT_NAME="SHOWCASE.FLOORS.DEFAULT_NAME"}(n=e.FLOORS||(e.FLOORS={})),function(e){e.ALT_GESTURE_DRAG="SHOWCASE.HELP.ALT_GESTURE_DRAG",e.ALT_GESTURE_DRAGTWOFINGER="SHOWCASE.HELP.ALT_GESTURE_DRAGTWOFINGER",e.ALT_GESTURE_POSITION="SHOWCASE.HELP.ALT_GESTURE_POSITION",e.ALT_GESTURE_PINCH="SHOWCASE.HELP.ALT_GESTURE_PINCH",e.ALT_GESTURE_PLAY="SHOWCASE.HELP.ALT_GESTURE_PLAY",e.ALT_GESTURE_POSITIONTWOFINGER="SHOWCASE.HELP.ALT_GESTURE_POSITIONTWOFINGER",e.ALT_GESTURE_TAP="SHOWCASE.HELP.ALT_GESTURE_TAP",e.ALT_GESTURE_TAPINSIDE="SHOWCASE.HELP.ALT_GESTURE_TAPINSIDE",e.ALT_KEYBOARD_ALL="SHOWCASE.HELP.ALT_KEYBOARD_ALL",e.ALT_KEYBOARD_INSIDE="SHOWCASE.HELP.ALT_KEYBOARD_INSIDE",e.ALT_KEYBOARD_LEFTRIGHT="SHOWCASE.HELP.ALT_KEYBOARD_LEFTRIGHT",e.ALT_KEYBOARD_UPDOWN="SHOWCASE.HELP.ALT_KEYBOARD_UPDOWN",e.ALT_KEYBOARD_ZOOM="SHOWCASE.HELP.ALT_KEYBOARD_ZOOM",e.ALT_MOUSE_CLICK="SHOWCASE.HELP.ALT_MOUSE_CLICK",e.ALT_MOUSE_CLICKINSIDE="SHOWCASE.HELP.ALT_MOUSE_CLICKINSIDE",e.ALT_MOUSE_DRAGLEFT="SHOWCASE.HELP.ALT_MOUSE_DRAGLEFT",e.ALT_MOUSE_DRAGRIGHT="SHOWCASE.HELP.ALT_MOUSE_DRAGRIGHT",e.ALT_MOUSE_PLAY="SHOWCASE.HELP.ALT_MOUSE_PLAY",e.ALT_MOUSE_POSITIONLEFT="SHOWCASE.HELP.ALT_MOUSE_POSITIONLEFT",e.ALT_MOUSE_POSITIONRIGHT="SHOWCASE.HELP.ALT_MOUSE_POSITIONRIGHT",e.ALT_MOUSE_ZOOM="SHOWCASE.HELP.ALT_MOUSE_ZOOM"}(s=e.HELP||(e.HELP={})),function(e){e.EMPTY_REEL_TITLE="SHOWCASE.HLR.EMPTY_REEL_TITLE",e.EMPTY_REEL_MESSAGE="SHOWCASE.HLR.EMPTY_REEL_MESSAGE",e.EMPTY_REEL_LEARN_MORE="SHOWCASE.HLR.EMPTY_REEL_LEARN_MORE"}(r=e.HLR||(e.HLR={})),function(e){e.TODAY="SHOWCASE.NOTES.TODAY",e.YESTERDAY="SHOWCASE.NOTES.YESTERDAY",e.THIS_WEEK="SHOWCASE.NOTES.THIS_WEEK",e.ONE_WEEK_AGO="SHOWCASE.NOTES.ONE_WEEK_AGO",e.TWO_WEEKS_AGO="SHOWCASE.NOTES.TWO_WEEKS_AGO",e.THREE_WEEKS_AGO="SHOWCASE.NOTES.THREE_WEEKS_AGO",e.OLDER="SHOWCASE.NOTES.OLDER",e.NO_MATCHES="SHOWCASE.NOTES.NO_MATCHES",e.HAVE_NONE="SHOWCASE.NOTES.HAVE_NONE",e.HAVE_NONE_OPEN="SHOWCASE.NOTES.HAVE_NONE_OPEN",e.HAVE_NONE_RESOLVED="SHOWCASE.NOTES.HAVE_NONE_RESOLVED",e.CONTENT_DELETED="SHOWCASE.NOTES.CONTENT_DELETED",e.RESULTS="SHOWCASE.NOTES.RESULTS",e.NUM_ATTACHMENTS="SHOWCASE.NOTES.ATTACHMENTS",e.NOTES="SHOWCASE.NOTES.NOTES",e.REPLIES="SHOWCASE.NOTES.REPLIES",e.FILTER_RESOLVED="SHOWCASE.NOTES.FILTER_RESOLVED",e.FILTER_UNRESOLVED="SHOWCASE.NOTES.FILTER_UNRESOLVED",e.FILTER_ALL="SHOWCASE.NOTES.FILTER_ALL",e.CANCEL="SHOWCASE.NOTES.CANCEL",e.DELETE="SHOWCASE.NOTES.DELETE",e.EDIT="SHOWCASE.NOTES.EDIT",e.MARK_AS_RESOLVED="SHOWCASE.NOTES.MARK_AS_RESOLVED",e.UNRESOLVE="SHOWCASE.NOTES.UNRESOLVE",e.FEEDBACK="SHOWCASE.NOTES.FEEDBACK",e.NAV_BACK="SHOWCASE.NOTES.NAV_BACK",e.NAV_CLOSE="SHOWCASE.NOTES.NAV_CLOSE",e.REPLY_PLACEHOLDER="SHOWCASE.NOTES.REPLY_PLACEHOLDER",e.EDIT_LIST_ITEM_OPTION_CTA="SHOWCASE.NOTES.EDIT_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="SHOWCASE.NOTES.DELETE_LIST_ITEM_OPTION_CTA",e.MISSING_MESSAGE="SHOWCASE.NOTES.MISSING_MESSAGE",e.MODAL_TITLE="SHOWCASE.NOTES.MODAL_TITLE",e.MODAL_COPY="SHOWCASE.NOTES.MODAL_COPY",e.MODAL_CTA="SHOWCASE.NOTES.MODAL_CTA",e.ADD_CTA_TOOLTIP="SHOWCASE.NOTES.ADD_CTA_TOOLTIP",e.ADD_TOOLTIP="SHOWCASE.NOTES.ADD_TOOLTIP",e.CANCEL_TOOLTIP="SHOWCASE.NOTES.CANCEL_TOOLTIP",e.COLOR_STEM_TOOLTIP="SHOWCASE.NOTES.COLOR_STEM_TOOLTIP",e.DELETE_TOOLTIP="SHOWCASE.NOTES.DELETE_TOOLTIP",e.OVERLAY_ADD_TOUCH="SHOWCASE.NOTES.OVERLAY_ADD_TOUCH",e.OVERLAY_ADD_CLICK="SHOWCASE.NOTES.OVERLAY_ADD_TOUCH",e.OVERLAY_PLACE_TOUCH="SHOWCASE.NOTES.OVERLAY_ADD_TOUCH",e.OVERLAY_PLACE_CLICK="SHOWCASE.NOTES.OVERLAY_ADD_TOUCH"}(o=e.NOTES||(e.NOTES={})),function(e){e.READ_MORE_MESSAGE="SHOWCASE.TAGS.READ_MORE_MESSAGE",e.MISSING_MESSAGE="SHOWCASE.TAGS.MISSING_MESSAGE"}(a=e.TAGS||(e.TAGS={})),function(e){e.CLEAR_SEARCH="SHOWCASE.SEARCH.CLEAR_SEARCH",e.GROUP_FLOOR="SHOWCASE.SEARCH.GROUP_FLOOR",e.GROUP_TYPE="SHOWCASE.SEARCH.GROUP_TYPE",e.GROUP_BY="SHOWCASE.SEARCH.GROUP_BY",e.ITEMS="SHOWCASE.SEARCH.ITEMS",e.EMPTY_LIST_MESSAGE="SHOWCASE.SEARCH.EMPTY_LIST_MESSAGE",e.VALIDATION_MESSAGE="SHOWCASE.SEARCH.VALIDATION_MESSAGE",e.ADVANCED_SEARCH_INSTRUCTIONS="SHOWCASE.SEARCH.ADVANCED_SEARCH_INSTRUCTIONS",e.ADVANCED_SEARCH_HELP_BUTTON="SHOWCASE.SEARCH.ADVANCED_SEARCH_HELP_BUTTON",e.ADVANCED_SEARCH_TITLE="SHOWCASE.SEARCH.ADVANCED_SEARCH_TITLE",e.TAG_GROUP_HEADER="SHOWCASE.SEARCH.TAG_GROUP_HEADER",e.LABEL_GROUP_HEADER="SHOWCASE.SEARCH.LABEL_GROUP_HEADER",e.MEASUREMENT_GROUP_HEADER="SHOWCASE.SEARCH.MEASUREMENT_GROUP_HEADER",e.NOTE_GROUP_HEADER="SHOWCASE.SEARCH.NOTE_GROUP_HEADER"}(l=e.SEARCH||(e.SEARCH={})),function(e){e.HEADING="SHOWCASE.SUMMARY.HEADING",e.LABEL_ADDRESS="SHOWCASE.SUMMARY.LABEL_ADDRESS",e.LABEL_CONTACT="SHOWCASE.SUMMARY.LABEL_CONTACT",e.LABEL_INFORMATION="SHOWCASE.SUMMARY.LABEL_INFORMATION",e.LABEL_LOCATION="SHOWCASE.SUMMARY.LABEL_LOCATION",e.LABEL_LEARN_MORE="SHOWCASE.SUMMARY.LABEL_LEARN_MORE"}(c=e.SUMMARY||(e.SUMMARY={})),function(e){e.TOUR_BUTTON_LABEL="SHOWCASE.TOURS.TOUR_BUTTON_LABEL"}(d=e.TOURS||(e.TOURS={}))}(n=e.SHOWCASE||(e.SHOWCASE={})),function(e){e.BLUR="TOOLS.BLUR",e.BLUR_HELP_MESSAGE="TOOLS.BLUR_HELP_MESSAGE",e.HLR="TOOLS.HLR",e.HLR_HELP_MESSAGE="TOOLS.HLR_HELP_MESSAGE",e.LABELS="TOOLS.LABELS",e.LABELS_HELP_MESSAGE="TOOLS.LABELS_HELP_MESSAGE",e.MATTERTAGS="TOOLS.MATTERTAGS",e.MATTERTAGS_HELP_MESSAGE="TOOLS.MATTERTAGS_HELP_MESSAGE",e.MEASUREMENTS="TOOLS.MEASUREMENTS",e.MEASUREMENTS_HELP_MESSAGE="TOOLS.MEASUREMENTS_HELP_MESSAGE",e.MESH_TRIM="TOOLS.MESH_TRIM",e.MESH_TRIM_HELP_MESSAGE="TOOLS.MESH_TRIM_HELP_MESSAGE",e.NOTES="TOOLS.NOTES",e.PHOTOS="TOOLS.PHOTOS",e.PHOTOS_HELP_MESSAGE="TOOLS.PHOTOS_HELP_MESSAGE",e.SCANS_3D="TOOLS.SCANS_3D",e.SCANS_3D_HELP_MESSAGE="TOOLS.SCANS_3D_HELP_MESSAGE",e.SETTINGS_PANEL="TOOLS.SETTINGS_PANEL",e.START_LOCATION="TOOLS.START_LOCATION",e.START_LOCATION_HELP_MESSAGE="TOOLS.START_LOCATION_HELP_MESSAGE",e.SUMMARY="TOOLS.SUMMARY",e.TAGS="TOOLS.TAGS",e.TOURS="TOOLS.TOURS",e.TOURS_HELP_MESSAGE="TOOLS.TOURS_HELP_MESSAGE",e.VIEW_360="TOOLS.VIEW_360",e.VIEW_360_HELP_MESSAGE="TOOLS.VIEW_360_HELP_MESSAGE",e.VR_PATH="TOOLS.VR_PATH",e.VR_PATH_HELP_MESSAGE="TOOLS.VR_PATH_HELP_MESSAGE",e.SEARCH="TOOLS.SEARCH"}(s=e.TOOLS||(e.TOOLS={})),function(e){e.INVITE_USER="USERS.INVITE_USER",e.INVITE_USER_FAILED="USERS.INVITE_USER_FAILED",e.INVITE_BUTTON="USERS.INVITE_BUTTON",e.INVITE_USERS="USERS.INVITE_USERS",e.INVITE_USERS_FAILED="USERS.INVITE_USERS_FAILED",e.INVITE_VISIBLE_MSG="USERS.INVITE_VISIBLE_MSG",e.UNKNOWN_USER="USERS.UNKNOWN_USER",e.UNKNOWN_USERS="USERS.UNKNOWN_USERS"}(r=e.USERS||(e.USERS={})),function(e){let t,i,n,s,r,o,a,l,c,d,h,u,p,m,f,g,v,y,b,S;!function(e){e.DELETE_SELECTED_CTA="WORKSHOP.ACCORDION.DELETE_SELECTED_CTA",e.SELECT_ALL_CTA="WORKSHOP.ACCORDION.SELECT_ALL_CTA",e.ENTER_SELECT_MODE_CTA="WORKSHOP.ACCORDION.ENTER_SELECT_MODE_CTA",e.EXIT_SELECT_MODE_CTA="WORKSHOP.ACCORDION.EXIT_SELECT_MODE_CTA",e.DELETE_FOOTER_CTA="WORKSHOP.ACCORDION.DELETE_FOOTER_CTA",e.TOGGLE_VISIBILITY_FOOTER_CTA="WORKSHOP.ACCORDION.TOGGLE_VISIBILITY_FOOTER_CTA",e.BATCH_DELETE_MODAL_TITLE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_TITLE",e.BATCH_DELETE_MODAL_MESSAGE="WORKSHOP.ACCORDION.BATCH_DELETE_MODAL_MESSAGE",e.RENAME_HEADER_OPTION_CTA="WORKSHOP.ACCORDION.RENAME_HEADER_OPTION_CTA"}(t=e.ACCORDION||(e.ACCORDION={})),function(e){e.CHANGES_SAVED_MESSAGE="WORKSHOP.APP_SWITCH.CHANGES_SAVED_MESSAGE",e.EDIT_CTA="WORKSHOP.APP_SWITCH.EDIT_CTA",e.UNSUPPORTED_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_MESSAGE",e.UNSUPPORTED_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.UNSUPPORTED_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_TITLE",e.PRIVATE_PUBLISH_TOOLTIP_TITLE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_TITLE",e.PUBLIC_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PUBLIC_PUBLISH_TOOLTIP_MESSAGE",e.PRIVATE_PUBLISH_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.PRIVATE_PUBLISH_TOOLTIP_MESSAGE",e.PUBLISH_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISH_CHANGES_CTA",e.PUBLISHING_CHANGES_CTA="WORKSHOP.APP_SWITCH.PUBLISHING_CHANGES_CTA",e.REVERT_CHANGES_MODAL_TITLE="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_TITLE",e.REVERT_CHANGES_MODAL_HEADER="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_HEADER",e.REVERT_CHANGES_MODAL_EXPLANATION="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_EXPLANATION",e.REVERT_CHANGES_MODAL_WARNING="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_WARNING",e.REVERT_CHANGES_MODAL_LEARN_MORE_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_LEARN_MORE_CTA",e.REVERT_CHANGES_MODAL_CANCEL_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_CANCEL_CTA",e.REVERT_CHANGES_MODAL_REVERT_CTA="WORKSHOP.APP_SWITCH.REVERT_CHANGES_MODAL_REVERT_CTA",e.FLOORS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.FLOORS_CHECKBOX_LABEL",e.MEASUREMENTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MEASUREMENTS_CHECKBOX_LABEL",e.MATTERTAGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.MATTERTAGS_CHECKBOX_LABEL",e.LABELS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.LABELS_CHECKBOX_LABEL",e.HIGHLIGHTS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.HIGHLIGHTS_CHECKBOX_LABEL",e.START_LOCATION_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.START_LOCATION_CHECKBOX_LABEL",e.SETTINGS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SETTINGS_CHECKBOX_LABEL",e.SWEEPS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.SWEEPS_CHECKBOX_LABEL",e.BLURS_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.BLURS_CHECKBOX_LABEL",e.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL="WORKSHOP.APP_SWITCH.NO_UNPUBLISHED_CHANGES_CHECKBOX_LABEL",e.EXIT_EDIT_MODE_CTA="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_CTA",e.EXIT_EDIT_MODE_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.EXIT_EDIT_MODE_TOOLTIP_MESSAGE",e.DISCARD_CHANGES_TOOLTIP_MESSAGE="WORKSHOP.APP_SWITCH.DISCARD_CHANGES_TOOLTIP_MESSAGE",e.PREVIEW_CHANGES_CTA="WORKSHOP.APP_SWITCH.PREVIEW_CHANGES_CTA",e.TIMESTAMP_UNPUBLISHED_CHANGES="WORKSHOP.APP_SWITCH.TIMESTAMP_UNPUBLISHED_CHANGES",e.TIMESTAMP_GREATER_THAN_ONE_MONTH="WORKSHOP.APP_SWITCH.TIMESTAMP_GREATER_THAN_ONE_MONTH",e.TIMESTAMP_DAY="WORKSHOP.APP_SWITCH.TIMESTAMP_DAY",e.TIMESTAMP_HOUR="WORKSHOP.APP_SWITCH.TIMESTAMP_HOUR",e.TIMESTAMP_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_MINUTE",e.TIMESTAMP_LESS_THAN_ONE_MINUTE="WORKSHOP.APP_SWITCH.TIMESTAMP_LESS_THAN_ONE_MINUTE",e.TIMESTAMP_LAST_PUBLISHED_MESSAGE="WORKSHOP.APP_SWITCH.TIMESTAMP_LAST_PUBLISHED_MESSAGE",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_PUBLISH_CHANGES_ERROR_MESSAGE",e.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNABLE_TO_REVERT_CHANGES_ERROR_MESSAGE",e.UNAUTHORIZED_ERROR_MESSAGE="WORKSHOP.APP_SWITCH.UNAUTHORIZED_ERROR_MESSAGE"}(i=e.APP_SWITCH||(e.APP_SWITCH={})),function(e){e.ACCEPT_ALL_SUGGESTIONS="WORKSHOP.BLURS.ACCEPT_ALL_SUGGESTIONS",e.ACCEPT_SUGGESTION_TOOLTIP="WORKSHOP.BLURS.ACCEPT_SUGGESTION_TOOLTIP",e.ALREADY_PROCESSING_ALERT_MESSAGE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_MESSAGE",e.ALREADY_PROCESSING_ALERT_TITLE="WORKSHOP.BLURS.ALREADY_PROCESSING_ALERT_TITLE",e.APPLY_BLURS_CTA="WORKSHOP.BLURS.APPLY_BLURS_CTA",e.APPLYING="WORKSHOP.BLURS.APPLYING",e.APPLY_MODAL_CONFIRM="WORKSHOP.BLURS.APPLY_MODAL_CONFIRM",e.APPLY_MODAL_MESSAGE="WORKSHOP.BLURS.APPLY_MODAL_MESSAGE",e.APPLY_MODAL_RETRY="WORKSHOP.BLURS.APPLY_MODAL_RETRY",e.APPLY_MODAL_TITLE="WORKSHOP.BLURS.APPLY_MODAL_TITLE",e.APPLY_MODAL_TRUNCATED="WORKSHOP.BLURS.APPLY_MODAL_TRUNCATED",e.APPLY_MODAL_WARNING="WORKSHOP.BLURS.APPLY_MODAL_WARNING",e.BATCH_SELECT="WORKSHOP.BLURS.BATCH_SELECT",e.BLUR_STATUS="WORKSHOP.BLURS.BLUR_STATUS",e.BLUR_STATUS_ALL="WORKSHOP.BLURS.BLUR_STATUS_ALL",e.BLUR_STATUS_APPLIED="WORKSHOP.BLURS.BLUR_STATUS_APPLIED",e.BLUR_STATUS_FAILED="WORKSHOP.BLURS.BLUR_STATUS_FAILED",e.BLUR_STATUS_PENDING="WORKSHOP.BLURS.BLUR_STATUS_PENDING",e.BLUR_STATUS_PROCESSING="WORKSHOP.BLURS.BLUR_STATUS_PROCESSING",e.BLUR_STATUS_SUGGESTED="WORKSHOP.BLURS.BLUR_STATUS_SUGGESTED",e.BRUSH_TOOLTIP_MESSAGE="WORKSHOP.BLURS.BRUSH_TOOLTIP_MESSAGE",e.BRUSH_TOOLTIP_TITLE="WORKSHOP.BLURS.BRUSH_TOOLTIP_TITLE",e.CLOSE_SUGGESTIONS="WORKSHOP.BLURS.CLOSE_SUGGESTIONS",e.CREATE_TOOLTIP_MESSAGE="WORKSHOP.BLURS.CREATE_TOOLTIP_MESSAGE",e.CREATE_TOOLTIP_TITLE="WORKSHOP.BLURS.CREATE_TOOLTIP_TITLE",e.DEFAULT_ALERT_CONFIRMATION="WORKSHOP.BLURS.DEFAULT_ALERT_CONFIRMATION",e.DEFAULT_ALERT_TITLE="WORKSHOP.BLURS.DEFAULT_ALERT_TITLE",e.DEFAULT_BLUR_NAME="WORKSHOP.BLURS.DEFAULT_BLUR_NAME",e.DELETE_BLUR_CTA="WORKSHOP.BLURS.DELETE_BLUR_CTA",e.GROUP_BY="WORKSHOP.BLURS.GROUP_BY",e.GROUP_BY_FLOOR="WORKSHOP.BLURS.GROUP_BY_FLOOR",e.GROUP_BY_SCAN="WORKSHOP.BLURS.GROUP_BY_SCAN",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.MULTI_FLOOR_EMPTY_MESSAGE",e.NO_BLURS="WORKSHOP.BLURS.NO_BLURS",e.NO_SUGGESTIONS="WORKSHOP.BLURS.NO_SUGGESTIONS",e.NO_SUGGESTIONS_ON_FLOOR="WORKSHOP.BLURS.NO_SUGGESTIONS_ON_FLOOR",e.NUM_TYPE="WORKSHOP.BLURS.NUM_TYPE",e.OTHER_GROUP_LABEL="WORKSHOP.BLURS.OTHER_GROUP_LABEL",e.OVERLAY_MESSAGE="WORKSHOP.BLURS.OVERLAY_MESSAGE",e.OVERLAY_MESSAGE_TOUCH="WORKSHOP.BLURS.OVERLAY_MESSAGE_TOUCH",e.REJECT_ALL_SUGGESTIONS="WORKSHOP.BLURS.REJECT_ALL_SUGGESTIONS",e.REJECT_SUGGESTION_TOOLTIP="WORKSHOP.BLURS.REJECT_SUGGESTION_TOOLTIP",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.BLURS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.BLURS.SINGLE_FLOOR_EMPTY_MESSAGE",e.SORT="WORKSHOP.BLURS.SORT",e.SORT_CREATED_ASC="WORKSHOP.BLURS.SORT_CREATED_ASC",e.SORT_CREATED_DESC="WORKSHOP.BLURS.SORT_CREATED_DESC",e.STATUS="WORKSHOP.BLURS.STATUS",e.SUGGESTED_BLUR="WORKSHOP.BLURS.SUGGESTED_BLUR",e.SUGGESTIONS_AVAILABLE_MESSAGE="WORKSHOP.BLURS.SUGGESTIONS_AVAILABLE_MESSAGE",e.SUGGESTIONS_FOUND_MESSAGE="WORKSHOP.BLURS.SUGGESTIONS_FOUND_MESSAGE",e.TYPE="WORKSHOP.BLURS.TYPE",e.VIEW_SUGGESTIONS="WORKSHOP.BLURS.VIEW_SUGGESTIONS"}(n=e.BLURS||(e.BLURS={})),function(e){e.TYPE="WORKSHOP.SUGGESTIONS.TYPE"}(s=e.SUGGESTIONS||(e.SUGGESTIONS={})),function(e){e.HELP_LINK="WORKSHOP.EDIT_BAR.HELP_LINK",e.BETA_TAG="WORKSHOP.EDIT_BAR.BETA_TAG",e.COLLAPSE_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.COLLAPSE_LIST_TOOLTIP_MESSAGE",e.EXPAND_LIST_TOOLTIP_MESSAGE="WORKSHOP.EDIT_BAR.EXPAND_LIST_TOOLTIP_MESSAGE"}(r=e.EDIT_BAR||(e.EDIT_BAR={})),function(e){e.APPLY_CTA="WORKSHOP.EMBED.APPLY_CTA",e.HELP_CTA="WORKSHOP.EMBED.HELP_CTA",e.ERROR_MESSAGE="WORKSHOP.EMBED.ERROR_MESSAGE",e.LOADING_MESSAGE="WORKSHOP.EMBED.LOADING_MESSAGE",e.INVALID_URL_MESSAGE="WORKSHOP.EMBED.INVALID_URL_MESSAGE",e.SUPPORTED_FORMATS_MESSAGE="WORKSHOP.EMBED.SUPPORTED_FORMATS_MESSAGE",e.MEDIA_LINK_LABEL="WORKSHOP.EMBED.MEDIA_LINK_LABEL",e.PROVIDER_NOT_SUPPORTED_MESSAGE="WORKSHOP.EMBED.PROVIDER_NOT_SUPPORTED_MESSAGE",e.LINK_TYPE_NOT_SUPPORTED_MESSAGE="WORKSHOP.EMBED.LINK_TYPE_NOT_SUPPORTED_MESSAGE"}(o=e.EMBED||(e.EMBED={})),function(e){e.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE="WORKSHOP.HLR.ADD_FROM_PHOTOS_TOOLTIP_MESSAGE",e.ADD_HIGHLIGHT_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_CTA",e.ADD_HIGHLIGHT_DISABLED_CTA="WORKSHOP.HLR.ADD_HIGHLIGHT_DISABLED_CTA",e.ADD_HIGHLIGHT_INSTRUCTIONS="WORKSHOP.HLR.ADD_HIGHLIGHT_INSTRUCTIONS",e.APPLY_TO_ALL_CTA="WORKSHOP.HLR.APPLY_TO_ALL_CTA",e.CLEAR_HLR_MODAL_MESSAGE="WORKSHOP.HLR.CLEAR_HLR_MODAL_MESSAGE",e.CLEAR_HLR_MODAL_TITLE="WORKSHOP.HLR.CLEAR_HLR_MODAL_TITLE",e.CLEAR_REEL_CTA="WORKSHOP.HLR.CLEAR_REEL_CTA",e.CLOSE_SETTINGS_CTA="WORKSHOP.HLR.CLOSE_SETTINGS_CTA",e.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.DELETE_HIGHLIGHT_TOOLTIP_MESSAGE",e.DISMISS_TOOLTIP_CTA="WORKSHOP.HLR.DISMISS_TOOLTIP_CTA",e.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.DOLLHOUSE_ROTATION_SPEED_SETTING_LABEL",e.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_HIGHLIGHT_TOOLTIP_MESSAGE",e.EDIT_SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.HLR.EDIT_SETTINGS_TOOLTIP_MESSAGE",e.HIGHLIGHT_CAPTION_HINT="WORKSHOP.HLR.HIGHLIGHT_CAPTION_HINT",e.HIGHLIGHT_CAPTION_PLACEHOLDER="WORKSHOP.HLR.HIGHLIGHT_CAPTION_PLACEHOLDER",e.HIGHLIGHT_DESCRIPTION_HINT="WORKSHOP.HLR.HIGHLIGHT_DESCRIPTION_HINT",e.HIGHLIGHT_DESCRIPTION_PLACEHOLDER="WORKSHOP.HLR.HIGHLIGHT_DESCRIPTION_PLACEHOLDER",e.HIGHLIGHT_TITLE_HINT="WORKSHOP.HLR.HIGHLIGHT_TITLE_HINT",e.HIGHLIGHT_TITLE_PLACEHOLDER="WORKSHOP.HLR.HIGHLIGHT_TITLE_PLACEHOLDER",e.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_PAN_DIRECTION_SETTING_LABEL",e.INDIVIDUAL_TRANSITION_SETTING_LABEL="WORKSHOP.HLR.INDIVIDUAL_TRANSITION_SETTING_LABEL",e.NUM_TYPE="WORKSHOP.HLR.NUM_TYPE",e.PANNING_SETTINGS_TAB_TITLE="WORKSHOP.HLR.PANNING_SETTINGS_TAB_TITLE",e.PAN_DIRECTION_SETTING_AUTO="WORKSHOP.HLR.PAN_DIRECTION_SETTING_AUTO",e.PAN_DIRECTION_SETTING_LABEL="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LABEL",e.PAN_DIRECTION_SETTING_LEFT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_LEFT",e.PAN_DIRECTION_SETTING_RIGHT="WORKSHOP.HLR.PAN_DIRECTION_SETTING_RIGHT",e.PREVIEW_SETTINGS_CTA="WORKSHOP.HLR.PREVIEW_SETTINGS_CTA",e.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE="WORKSHOP.HLR.REMOVE_HIGHLIGHT_TOOLTIP_MESSAGE",e.RESTORE_DEFAULTS_CTA="WORKSHOP.HLR.RESTORE_DEFAULTS_CTA",e.ROTATION_ANGLE_SETTING_LABEL="WORKSHOP.HLR.ROTATION_ANGLE_SETTING_LABEL",e.ROTATION_SPEED_SETTING_LABEL="WORKSHOP.HLR.ROTATION_SPEED_SETTING_LABEL",e.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_GENERIC_HIDDEN_TOOLTIP_TITLE",e.SCAN_NOT_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NOT_HIDDEN_TOOLTIP_TITLE",e.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE="WORKSHOP.HLR.SCAN_NUMBER_HIDDEN_TOOLTIP_TITLE",e.SETTINGS_MODAL_TITLE="WORKSHOP.HLR.SETTINGS_MODAL_TITLE",e.SLIDESHOW_SPEED_SETTING_LABEL="WORKSHOP.HLR.SLIDESHOW_SPEED_SETTING_LABEL",e.SPEED_SETTING_FAST="WORKSHOP.HLR.SPEED_SETTING_FAST",e.SPEED_SETTING_MEDIUM="WORKSHOP.HLR.SPEED_SETTING_MEDIUM",e.SPEED_SETTING_SLOW="WORKSHOP.HLR.SPEED_SETTING_SLOW",e.TOAST_ERROR_CTA="WORKSHOP.HLR.TOAST_ERROR_CTA",e.TOAST_ERROR_MESSAGE="WORKSHOP.HLR.TOAST_ERROR_MESSAGE",e.TOUR_EDITOR_BEHAVIORS_TAB="WORKSHOP.HLR.TOUR_EDITOR_BEHAVIORS_TAB",e.TOUR_EDITOR_LABELS_TAB="WORKSHOP.HLR.TOUR_EDITOR_LABELS_TAB",e.TOUR_EDITOR_EMPTY_MESSAGE="WORKSHOP.HLR.TOUR_EDITOR_EMPTY_MESSAGE",e.TOUR_EDITOR_EMPTY_TITLE="WORKSHOP.HLR.TOUR_EDITOR_EMPTY_TITLE",e.TOUR_SETTINGS_LABEL="WORKSHOP.HLR.TOUR_SETTINGS_LABEL",e.TRANSITION_AFTER_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_AFTER_360_DISABLED_MESSAGE",e.TRANSITION_EDITOR_TITLE="WORKSHOP.HLR.TRANSITION_EDITOR_TITLE",e.TRANSITION_IS_360_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_IS_360_DISABLED_MESSAGE",e.TRANSITION_NO_ROTATION_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_NO_ROTATION_DISABLED_MESSAGE",e.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE="WORKSHOP.HLR.TRANSITION_SAME_SWEEP_DISABLED_MESSAGE",e.TRANSITION_SETTINGS_TAB_TITLE="WORKSHOP.HLR.TRANSITION_SETTINGS_TAB_TITLE",e.TRANSITION_SETTING_LABEL="WORKSHOP.HLR.TRANSITION_SETTING_LABEL",e.TRANSITION_SETTING_SLIDESHOW="WORKSHOP.HLR.TRANSITION_SETTING_SLIDESHOW",e.TRANSITION_SETTING_WALKTHROUGH="WORKSHOP.HLR.TRANSITION_SETTING_WALKTHROUGH",e.TYPE="WORKSHOP.HLR.TYPE",e.WALKTHROUGH_SPEED_SETTING_LABEL="WORKSHOP.HLR.WALKTHROUGH_SPEED_SETTING_LABEL",e.ZOOM_SPEED_SETTING_LABEL="WORKSHOP.HLR.ZOOM_SPEED_SETTING_LABEL"}(a=e.HLR||(e.HLR={})),function(e){e.TYPE="WORKSHOP.LABELS.TYPE",e.NUM_TYPE="WORKSHOP.LABELS.NUM_TYPE",e.EDIT_TEXT_CANCEL_CTA="WORKSHOP.LABELS.EDIT_TEXT_CANCEL_CTA",e.EDIT_TEXT_DONE_CTA="WORKSHOP.LABELS.EDIT_TEXT_DONE_CTA",e.INPUT_PLACEHOLDER="WORKSHOP.LABELS.INPUT_PLACEHOLDER",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.LABELS.MOBILE_OVERLAY_MESSAGE",e.ADD_LABEL_TOOLTIP_MESSAGE="WORKSHOP.LABELS.ADD_LABEL_TOOLTIP_MESSAGE",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.LABELS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.LABELS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.LABELS.SINGLE_FLOOR_EMPTY_MESSAGE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.LABELS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.EDIT_LABEL="WORKSHOP.LABELS.EDIT_LABEL"}(l=e.LABELS||(e.LABELS={})),function(e){e.KITCHEN="WORKSHOP.LABEL_SUGGESTIONS.KITCHEN",e.PRIMARY_BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BEDROOM",e.BEDROOM="WORKSHOP.LABEL_SUGGESTIONS.BEDROOM",e.PRIMARY_BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.PRIMARY_BATHROOM",e.BATHROOM="WORKSHOP.LABEL_SUGGESTIONS.BATHROOM",e.LIVING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LIVING_ROOM",e.FAMILY_ROOM="WORKSHOP.LABEL_SUGGESTIONS.FAMILY_ROOM",e.DINING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.DINING_ROOM",e.PATIO="WORKSHOP.LABEL_SUGGESTIONS.PATIO",e.BALCONY="WORKSHOP.LABEL_SUGGESTIONS.BALCONY",e.BACKYARD="WORKSHOP.LABEL_SUGGESTIONS.BACKYARD",e.FRONT_YARD="WORKSHOP.LABEL_SUGGESTIONS.FRONT_YARD",e.HALLWAY="WORKSHOP.LABEL_SUGGESTIONS.HALLWAY",e.LAUNDRY="WORKSHOP.LABEL_SUGGESTIONS.LAUNDRY",e.PANTRY="WORKSHOP.LABEL_SUGGESTIONS.PANTRY",e.CLOSET="WORKSHOP.LABEL_SUGGESTIONS.CLOSET",e.GARAGE="WORKSHOP.LABEL_SUGGESTIONS.GARAGE",e.DRIVEWAY="WORKSHOP.LABEL_SUGGESTIONS.DRIVEWAY",e.BASEMENT="WORKSHOP.LABEL_SUGGESTIONS.BASEMENT",e.FACADE="WORKSHOP.LABEL_SUGGESTIONS.FACADE",e.GARDEN="WORKSHOP.LABEL_SUGGESTIONS.GARDEN",e.LOBBY="WORKSHOP.LABEL_SUGGESTIONS.LOBBY",e.OFFICE="WORKSHOP.LABEL_SUGGESTIONS.OFFICE",e.POOL="WORKSHOP.LABEL_SUGGESTIONS.POOL",e.UNFURNISHED="WORKSHOP.LABEL_SUGGESTIONS.UNFURNISHED",e.STAIRWAY="WORKSHOP.LABEL_SUGGESTIONS.STAIRWAY",e.ELEVATOR="WORKSHOP.LABEL_SUGGESTIONS.ELEVATOR",e.ESCALATOR="WORKSHOP.LABEL_SUGGESTIONS.ESCALATOR",e.STUDY="WORKSHOP.LABEL_SUGGESTIONS.STUDY",e.SPA="WORKSHOP.LABEL_SUGGESTIONS.SPA",e.RECEPTION="WORKSHOP.LABEL_SUGGESTIONS.RECEPTION",e.MEETING_ROOM="WORKSHOP.LABEL_SUGGESTIONS.MEETING_ROOM",e.STORAGE="WORKSHOP.LABEL_SUGGESTIONS.STORAGE",e.BREAK_ROOM="WORKSHOP.LABEL_SUGGESTIONS.BREAK_ROOM",e.LUNCH_ROOM="WORKSHOP.LABEL_SUGGESTIONS.LUNCH_ROOM",e.CONFERENCE_ROOM="WORKSHOP.LABEL_SUGGESTIONS.CONFERENCE_ROOM"}(c=e.LABEL_SUGGESTIONS||(e.LABEL_SUGGESTIONS={})),function(e){e.ADD="WORKSHOP.MATTERTAGS.ADD",e.ADD_FILE="WORKSHOP.MATTERTAGS.ADD_FILE",e.ADD_MATTERTAG_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.ADD_MATTERTAG_TOOLTIP_MESSAGE",e.ATTACHMENTS_LABEL="WORKSHOP.MATTERTAGS.ATTACHMENTS_LABEL",e.BACK="WORKSHOP.MATTERTAGS.BACK",e.COLOR_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.COLOR_TOOLTIP_MESSAGE",e.DEFAULT_LIST_ITEM_TEXT="WORKSHOP.MATTERTAGS.DEFAULT_LIST_ITEM_TEXT",e.DEFAULT_TAG_TITLE="WORKSHOP.MATTERTAGS.DEFAULT_TAG_TITLE",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.DELETE_LIST_ITEM_OPTION_CTA",e.DELETE_MATTERTAGS_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_MESSAGE",e.DELETE_MATTERTAGS_MODAL_TITLE="WORKSHOP.MATTERTAGS.DELETE_MATTERTAGS_MODAL_TITLE",e.DESCRIPTION_PLACEHOLDER="WORKSHOP.MATTERTAGS.DESCRIPTION_PLACEHOLDER",e.DISCARD_MATTERTAG_MODAL_MESSAGE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_MESSAGE",e.DISCARD_MATTERTAG_MODAL_TITLE="WORKSHOP.MATTERTAGS.DISCARD_MATTERTAG_MODAL_TITLE",e.DROP_FILES_MESSAGE="WORKSHOP.MATTERTAGS.DROP_FILES_MESSAGE",e.EDIT_BILLBOARD_CANCEL_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_CANCEL_CTA",e.EDIT_BILLBOARD_DONE_CTA="WORKSHOP.MATTERTAGS.EDIT_BILLBOARD_DONE_CTA",e.EDIT_LIST_ITEM_OPTION_CTA="WORKSHOP.MATTERTAGS.EDIT_LIST_ITEM_OPTION_CTA",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.HIDE_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.HIDE_TOOLTIP_MESSAGE",e.LINK_DISABLED_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_DISABLED_TOOLTIP_MESSAGE",e.LINK_EDITOR_APPLY_CTA="WORKSHOP.MATTERTAGS.LINK_EDITOR_APPLY_CTA",e.LINK_EDITOR_INVALID_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_INVALID_TIP",e.LINK_EDITOR_MAX_LENGTH_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_MAX_LENGTH_TIP",e.LINK_EDITOR_PREVIEW_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_PREVIEW_TIP",e.LINK_EDITOR_REMOVE_TIP="WORKSHOP.MATTERTAGS.LINK_EDITOR_REMOVE_TIP",e.LINK_EDITOR_TEXT_LABEL="WORKSHOP.MATTERTAGS.LINK_EDITOR_TEXT_LABEL",e.LINK_EDITOR_TIP_TEXT="WORKSHOP.MATTERTAGS.LINK_EDITOR_TIP_TEXT",e.LINK_EDITOR_URL_LABEL="WORKSHOP.MATTERTAGS.LINK_EDITOR_URL_LABEL",e.LINK_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.LINK_TOOLTIP_MESSAGE",e.MAX_ATTACHMENTS_MESSAGE="WORKSHOP.MATTERTAGS.MAX_ATTACHMENTS_MESSAGE",e.MEDIA_LINK_APPLY_CTA="WORKSHOP.MATTERTAGS.MEDIA_LINK_APPLY_CTA",e.MEDIA_LINK_ERROR_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_ERROR_MESSAGE",e.MEDIA_LINK_HELP_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_HELP_LINK",e.MEDIA_LINK_INVALID_URL_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_INVALID_URL_MESSAGE",e.MEDIA_LINK_LABEL="WORKSHOP.MATTERTAGS.MEDIA_LINK_LABEL",e.MEDIA_LINK_LOADING_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_LINK_LOADING_MESSAGE",e.MEDIA_LINK_SUPPORTED_FORMATS_LINK="WORKSHOP.MATTERTAGS.MEDIA_LINK_SUPPORTED_FORMATS_LINK",e.MEDIA_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.MEDIA_TOOLTIP_MESSAGE",e.MOBILE_OVERLAY_MESSAGE="WORKSHOP.MATTERTAGS.MOBILE_OVERLAY_MESSAGE",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.MULTI_FLOOR_EMPTY_MESSAGE",e.NUM_TYPE="WORKSHOP.MATTERTAGS.NUM_TYPE",e.SAVE="WORKSHOP.MATTERTAGS.SAVE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_STEM_LABEL="WORKSHOP.MATTERTAGS.SHOW_STEM_LABEL",e.SHOW_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.SHOW_TOOLTIP_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MATTERTAGS.SINGLE_FLOOR_EMPTY_MESSAGE",e.STEM_SLIDER_RESET_CTA="WORKSHOP.MATTERTAGS.STEM_SLIDER_RESET_CTA",e.STEM_TOOLTIP_MESSAGE="WORKSHOP.MATTERTAGS.STEM_TOOLTIP_MESSAGE",e.TAG_NUM_TYPE="WORKSHOP.MATTERTAGS.TAG_NUM_TYPE",e.TAG_REORDER_BANNER_CTA="WORKSHOP.MATTERTAGS.TAG_REORDER_BANNER_CTA",e.TAG_REORDER_BANNER_TEXT="WORKSHOP.MATTERTAGS.TAG_REORDER_BANNER_TEXT",e.TAG_TYPE="WORKSHOP.MATTERTAGS.TAG_TYPE",e.TITLE_PLACEHOLDER="WORKSHOP.MATTERTAGS.TITLE_PLACEHOLDER",e.TYPE="WORKSHOP.MATTERTAGS.TYPE",e.UPLOAD_FILE="WORKSHOP.MATTERTAGS.UPLOAD_FILE"}(d=e.MATTERTAGS||(e.MATTERTAGS={})),function(e){e.TYPE="WORKSHOP.MEASUREMENTS.TYPE",e.NUM_TYPE="WORKSHOP.MEASUREMENTS.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.MEASUREMENTS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.OTHER_GROUP_LABEL="WORKSHOP.MEASUREMENTS.OTHER_GROUP_LABEL",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.RENAME_LIST_ITEM_OPTION_CTA",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.MEASUREMENTS.DELETE_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.MEASUREMENTS.LIST_ITEM_INPUT_PLACEHOLDER",e.MULTI_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.MULTI_FLOOR_EMPTY_MESSAGE",e.SINGLE_FLOOR_EMPTY_MESSAGE="WORKSHOP.MEASUREMENTS.SINGLE_FLOOR_EMPTY_MESSAGE"}(h=e.MEASUREMENTS||(e.MEASUREMENTS={})),function(e){e.ERROR_TITLE="WORKSHOP.MODAL.ERROR_TITLE",e.SAVING_ERROR_TITLE="WORKSHOP.MODAL.SAVING_ERROR_TITLE",e.SAVING_ERROR_MESSAGE="WORKSHOP.MODAL.SAVING_ERROR_MESSAGE",e.NO="WORKSHOP.MODAL.NO",e.YES="WORKSHOP.MODAL.YES",e.CANCEL="WORKSHOP.MODAL.CANCEL",e.OK="WORKSHOP.MODAL.OK",e.DISCARD="WORKSHOP.MODAL.DISCARD",e.SAVE="WORKSHOP.MODAL.SAVE"}(u=e.MODAL||(e.MODAL={})),function(e){e.HAPPINESS_TITLE="WORKSHOP.MODEL_RATING.HAPPINESS_TITLE",e.HAPPINESS_BODY="WORKSHOP.MODEL_RATING.HAPPINESS_BODY",e.QUALITY_ISSUES_TITLE="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_TITLE",e.QUALITY_ISSUES_LIGHTING="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_LIGHTING",e.QUALITY_ISSUES_3D_MESH="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_3D_MESH",e.QUALITY_ISSUES_COLORING="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_COLORING",e.QUALITY_ISSUES_IMAGE_QUALITY="WORKSHOP.MODEL_RATING.QUALITY_ISSUES_IMAGE_QUALITY",e.NAVIGATION_ISSUES_TITLE="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_TITLE",e.NAVIGATION_ISSUES_BLOCKED_DOORWAYS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_BLOCKED_DOORWAYS",e.NAVIGATION_ISSUES_OBSTRUCTIONS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_OBSTRUCTIONS",e.NAVIGATION_ISSUES_MISALIGNED_SCANS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_MISALIGNED_SCANS",e.NAVIGATION_ISSUES_FLOOR_SEPARATION="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_FLOOR_SEPARATION",e.NAVIGATION_ISSUES_DISAPPEARING_FLOORS="WORKSHOP.MODEL_RATING.NAVIGATION_ISSUES_DISAPPEARING_FLOORS",e.FEEDBACK_TITLE="WORKSHOP.MODEL_RATING.FEEDBACK_TITLE",e.FEEDBACK_LABEL="WORKSHOP.MODEL_RATING.FEEDBACK_LABEL",e.THANK_YOU_HEADING="WORKSHOP.MODEL_RATING.THANK_YOU_HEADING",e.THANK_YOU_BODY="WORKSHOP.MODEL_RATING.THANK_YOU_BODY",e.THANK_YOU_CTA="WORKSHOP.MODEL_RATING.THANK_YOU_CTA",e.THANK_YOU_CTA_LINK_TEXT="WORKSHOP.MODEL_RATING.THANK_YOU_CTA_LINK_TEXT",e.SAVE="WORKSHOP.MODEL_RATING.SAVE",e.NEXT="WORKSHOP.MODEL_RATING.NEXT",e.PROGRESS="WORKSHOP.MODEL_RATING.PROGRESS"}(p=e.MODEL_RATING||(e.MODEL_RATING={})),function(e){e.TYPE="WORKSHOP.PHOTOS.TYPE",e.NUM_TYPE="WORKSHOP.PHOTOS.NUM_TYPE",e.ADD_PHOTOS_CTA="WORKSHOP.PHOTOS.ADD_PHOTOS_CTA",e.ADDING_PHOTOS_CTA="WORKSHOP.PHOTOS.ADDING_PHOTOS_CTA",e.MODAL_TITLE="WORKSHOP.PHOTOS.MODAL_TITLE",e.NUM_SELECTED="WORKSHOP.PHOTOS.NUM_SELECTED",e.SELECT_ALL_CTA="WORKSHOP.PHOTOS.SELECT_ALL_CTA",e.UNSELECT_ALL_CTA="WORKSHOP.PHOTOS.UNSELECT_ALL_CTA",e.SAVING_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVING_TOAST_MESSAGE",e.SAVED_TOAST_MESSAGE="WORKSHOP.PHOTOS.SAVED_TOAST_MESSAGE",e.SAVED_TOAST_CTA="WORKSHOP.PHOTOS.SAVED_TOAST_CTA",e.ERROR_MODAL_TITLE="WORKSHOP.PHOTOS.ERROR_MODAL_TITLE",e.ERROR_MODAL_MESSAGE="WORKSHOP.PHOTOS.ERROR_MODAL_MESSAGE",e.CAMERA_PITCH_RESET_MESSAGE="WORKSHOP.PHOTOS.CAMERA_PITCH_RESET_MESSAGE",e.ZOOM_RESET_MESSAGE="WORKSHOP.PHOTOS.ZOOM_RESET_MESSAGE",e.ZOOM_IN_MESSAGE="WORKSHOP.PHOTOS.ZOOM_IN_MESSAGE",e.ZOOM_OUT_MESSAGE="WORKSHOP.PHOTOS.ZOOM_OUT_MESSAGE",e.CANNOT_SAVE_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_MESSAGE",e.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_SAVE_SCAN_NUMBER_TOOLTIP_MESSAGE",e.CANNOT_SAVE_TOOLTIP_TITLE="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_TITLE",e.CANNOT_SAVE_TOOLTIP_CTA="WORKSHOP.PHOTOS.CANNOT_SAVE_TOOLTIP_CTA",e.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_2D_PHOTO_TOOLTIP_MESSAGE",e.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CAN_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.CANNOT_TAKE_360_PHOTO_TOOLTIP_MESSAGE",e.PANO_CTA="WORKSHOP.PHOTOS.PANO_CTA",e.SETTINGS_TOOLTIP_MESSAGE="WORKSHOP.PHOTOS.SETTINGS_TOOLTIP_MESSAGE",e.ASSETS_SETTING_LABEL="WORKSHOP.PHOTOS.ASSETS_SETTING_LABEL",e.SHOW_GRID_SETTING_LABEL="WORKSHOP.PHOTOS.SHOW_GRID_SETTING_LABEL",e.SNAPSHOT_ERROR_TOAST_MESSAGE="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_MESSAGE",e.SNAPSHOT_ERROR_TOAST_CTA="WORKSHOP.PHOTOS.SNAPSHOT_ERROR_TOAST_CTA"}(m=e.PHOTOS||(e.PHOTOS={})),function(e){e.TYPE="WORKSHOP.SCANS.TYPE",e.NUM_TYPE="WORKSHOP.SCANS.NUM_TYPE",e.BATCH_SHOW_CTA="WORKSHOP.SCANS.BATCH_SHOW_CTA",e.BATCH_HIDE_CTA="WORKSHOP.SCANS.BATCH_HIDE_CTA",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.LIST_ITEM_TEXT="WORKSHOP.SCANS.LIST_ITEM_TEXT",e.FLOOR_EMPTY_MESSAGE="WORKSHOP.SCANS.FLOOR_EMPTY_MESSAGE",e.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.NO_HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.HLR_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.HLR_LIST_ITEM_TOOLTIP_MESSAGE",e.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_LIST_ITEM_TOOLTIP_MESSAGE",e.OVERLAY_HIDE_CTA="WORKSHOP.SCANS.OVERLAY_HIDE_CTA",e.OVERLAY_SHOW_CTA="WORKSHOP.SCANS.OVERLAY_SHOW_CTA",e.OVERLAY_HIDE_SCAN_CTA="WORKSHOP.SCANS.OVERLAY_HIDE_SCAN_CTA",e.OVERLAY_SHOW_SCAN_CTA="WORKSHOP.SCANS.OVERLAY_SHOW_SCAN_CTA",e.OVERLAY_PANORAMA_INFO="WORKSHOP.SCANS.OVERLAY_PANORAMA_INFO",e.OVERLAY_INFO="WORKSHOP.SCANS.OVERLAY_INFO",e.START_LOCATION_TOOLTIP_TITLE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_TITLE",e.START_LOCATION_TOOLTIP_MESSAGE="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_MESSAGE",e.START_LOCATION_TOOLTIP_CTA="WORKSHOP.SCANS.START_LOCATION_TOOLTIP_CTA",e.REMOVE_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_TITLE",e.REMOVE_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_MESSAGE",e.REMOVE_HLR_MODAL_BATCH_MESSAGE="WORKSHOP.SCANS.REMOVE_HLR_MODAL_BATCH_MESSAGE",e.REMOVE_HLR_MODAL_WARNING="WORKSHOP.SCANS.REMOVE_HLR_MODAL_WARNING",e.REMOVE_SCANS_FROM_HLR_MODAL_TITLE="WORKSHOP.SCANS.REMOVE_SCANS_FROM_HLR_MODAL_TITLE",e.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE="WORKSHOP.SCANS.REMOVE_SCAN_FROM_HLR_MODAL_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_SCANS_MESSAGE",e.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE="WORKSHOP.SCANS.REMOVE_BATCH_FROM_HLR_MODAL_HIGHLIGHTS_MESSAGE"}(f=e.SCANS||(e.SCANS={})),function(e){e.ADVANCED_SPACE_SEARCH_LABEL="WORKSHOP.SETTINGS.ADVANCED_SPACE_SEARCH_LABEL",e.ADVANCED_SPACE_SEARCH_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_SPACE_SEARCH_MESSAGE",e.ADVANCED_DOLLHOUSE_LABEL="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_LABEL",e.ADVANCED_DOLLHOUSE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_DOLLHOUSE_MESSAGE",e.ADVANCED_FLOORPLAN_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_LABEL",e.ADVANCED_FLOORPLAN_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOORPLAN_MESSAGE",e.ADVANCED_FLOOR_SELECTION_LABEL="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_LABEL",e.ADVANCED_FLOOR_SELECTION_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_FLOOR_SELECTION_MESSAGE",e.ADVANCED_HEADER="WORKSHOP.SETTINGS.ADVANCED_HEADER",e.ADVANCED_MEASUREMENT_MODE_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_LABEL",e.ADVANCED_MEASUREMENT_MODE_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MENU_LABEL",e.ADVANCED_MEASUREMENT_MODE_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_MEASUREMENT_MODE_MESSAGE",e.ADVANCED_ROOM_LABELS_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_LABEL",e.ADVANCED_ROOM_LABELS_MESSAGE="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MESSAGE",e.ADVANCED_ROOM_LABELS_MENU_LABEL="WORKSHOP.SETTINGS.ADVANCED_ROOM_LABELS_MENU_LABEL",e.HIDE_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.HIDE_LABELS_IN_DOLLHOUSE_OPTION",e.HIDE_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.HIDE_SAVED_MEASUREMENTS_OPTION",e.HLR_OPTION_LABEL="WORKSHOP.SETTINGS.HLR_OPTION_LABEL",e.HLR_OPTION_MESSAGE="WORKSHOP.SETTINGS.HLR_OPTION_MESSAGE",e.NAV_OPTION_ADVANCED="WORKSHOP.SETTINGS.NAV_OPTION_ADVANCED",e.NAV_OPTION_PRESENTATION="WORKSHOP.SETTINGS.NAV_OPTION_PRESENTATION",e.NAV_OPTION_TOUR_HLR="WORKSHOP.SETTINGS.NAV_OPTION_TOUR_HLR",e.NAV_OPTION_UNITS="WORKSHOP.SETTINGS.NAV_OPTION_UNITS",e.SHOW_SAVED_MEASUREMENTS_OPTION="WORKSHOP.SETTINGS.SHOW_SAVED_MEASUREMENTS_OPTION",e.SHOW_LABELS_IN_DOLLHOUSE_OPTION="WORKSHOP.SETTINGS.SHOW_LABELS_IN_DOLLHOUSE_OPTION",e.PRESENTATION_BACKGROUND_BLACK_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_BLACK_LABEL",e.PRESENTATION_BACKGROUND_GREY_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_GREY_LABEL",e.PRESENTATION_BACKGROUND_HEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_HEADER",e.PRESENTATION_BACKGROUND_SUBHEADER="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_SUBHEADER",e.PRESENTATION_BACKGROUND_WHITE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_BACKGROUND_WHITE_LABEL",e.PRESENTATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_HEADER",e.PRESENTATION_INFORMATION_EVERYTHING_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_LABEL",e.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_EVERYTHING_MESSAGE",e.PRESENTATION_INFORMATION_COMPACT_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_LABEL",e.PRESENTATION_INFORMATION_COMPACT_MESSAGE="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_COMPACT_MESSAGE",e.PRESENTATION_INFORMATION_HEADER="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_HEADER",e.PRESENTATION_INFORMATION_NONE_LABEL="WORKSHOP.SETTINGS.PRESENTATION_INFORMATION_NONE_LABEL",e.TOUR_AND_HLR_HEADER="WORKSHOP.SETTINGS.TOUR_AND_HLR_HEADER",e.TOUR_MODE_LEGACY_LABEL="WORKSHOP.SETTINGS.TOUR_MODE_LEGACY_LABEL",e.TOUR_MODE_LEGACY_MESSAGE="WORKSHOP.SETTINGS.TOUR_MODE_LEGACY_MESSAGE",e.TOUR_MODE_NONE_LABEL="WORKSHOP.SETTINGS.TOUR_MODE_NONE_LABEL",e.TOUR_MODE_STORY_LABEL="WORKSHOP.SETTINGS.TOUR_MODE_STORY_LABEL",e.TOUR_MODE_STORY_MESSAGE="WORKSHOP.SETTINGS.TOUR_MODE_STORY_MESSAGE",e.TOUR_OPTION_LABEL="WORKSHOP.SETTINGS.TOUR_OPTION_LABEL",e.TOUR_OPTION_MESSAGE="WORKSHOP.SETTINGS.TOUR_OPTION_MESSAGE",e.UNITS_HEADER="WORKSHOP.SETTINGS.UNITS_HEADER",e.UNITS_IMPERIAL_CTA="WORKSHOP.SETTINGS.UNITS_IMPERIAL_CTA",e.UNITS_METRIC_CTA="WORKSHOP.SETTINGS.UNITS_METRIC_CTA",e.UNITS_SUBHEADER="WORKSHOP.SETTINGS.UNITS_SUBHEADER"}(g=e.SETTINGS||(e.SETTINGS={})),function(e){e.ENABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.ENABLED_TOOLTIP_TITLE",e.DISABLED_TOOLTIP_TITLE="WORKSHOP.START_LOCATION.DISABLED_TOOLTIP_TITLE",e.HIDDEN_SWEEP_MESSAGE="WORKSHOP.START_LOCATION.HIDDEN_SWEEP_MESSAGE",e.UNPLACED_360_MESSAGE="WORKSHOP.START_LOCATION.UNPLACED_360_MESSAGE",e.ENABLED_MESSAGE="WORKSHOP.START_LOCATION.ENABLED_MESSAGE",e.TOOLTIP_CTA="WORKSHOP.START_LOCATION.TOOLTIP_CTA",e.SET_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SET_NEW_LOCATION_CTA",e.SETTING_NEW_LOCATION_CTA="WORKSHOP.START_LOCATION.SETTING_NEW_LOCATION_CTA",e.THUMBNAIL_PREVIEW_CTA="WORKSHOP.START_LOCATION.THUMBNAIL_PREVIEW_CTA"}(v=e.START_LOCATION||(e.START_LOCATION={})),function(e){e.NUM_TYPE="WORKSHOP.TRIM.NUM_TYPE",e.HIDE_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.TRIM.HIDE_LIST_ITEM_TOOLTIP_MESSAGE",e.SHOW_LIST_ITEM_TOOLTIP_MESSAGE="WORKSHOP.TRIM.SHOW_LIST_ITEM_TOOLTIP_MESSAGE",e.DELETE_LIST_ITEM_OPTION_CTA="WORKSHOP.TRIM.DELETE_LIST_ITEM_OPTION_CTA",e.RENAME_LIST_ITEM_OPTION_CTA="WORKSHOP.TRIM.RENAME_LIST_ITEM_OPTION_CTA",e.LIST_ITEM_INPUT_PLACEHOLDER="WORKSHOP.TRIM.LIST_ITEM_INPUT_PLACEHOLDER",e.DEFAULT_NAME="WORKSHOP.TRIM.DEFAULT_NAME",e.ALL_FLOORS="WORKSHOP.TRIM.ALL_FLOORS",e.EMPTY_FLOOR_MESSAGE="WORKSHOP.TRIM.EMPTY_FLOOR_MESSAGE",e.SIDE_POSE_CTA="WORKSHOP.TRIM.SIDE_POSE_CTA",e.TOP_POSE_CTA="WORKSHOP.TRIM.TOP_POSE_CTA",e.PERSPECTIVE_POSE_CTA="WORKSHOP.TRIM.PERSPECTIVE_POSE_CTA",e.SIDE_POSE_TOOLTIP="WORKSHOP.TRIM.SIDE_POSE_TOOLTIP",e.LEFT_SIDE_POSE_TOOLTIP="WORKSHOP.TRIM.LEFT_SIDE_POSE_TOOLTIP",e.RIGHT_SIDE_POSE_TOOLTIP="WORKSHOP.TRIM.RIGHT_SIDE_POSE_TOOLTIP",e.TOP_POSE_TOOLTIP="WORKSHOP.TRIM.TOP_POSE_TOOLTIP",e.PERSPECTIVE_POSE_TOOLTIP="WORKSHOP.TRIM.PERSPECTIVE_POSE_TOOLTIP",e.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE="WORKSHOP.TRIM.UNABLE_TO_SAVE_CHANGES_ERROR_MESSAGE",e.ADD_INDIVIDUAL_FLOOR_TRIM_TOOLTIP="WORKSHOP.TRIM.ADD_INDIVIDUAL_FLOOR_TRIM_TOOLTIP",e.ADD_ALL_FLOORS_TRIM_TOOLTIP="WORKSHOP.TRIM.ADD_ALL_FLOORS_TRIM_TOOLTIP",e.MAX_INDIVIDUAL_FLOOR_TRIMS_TOOLTIP="WORKSHOP.TRIM.MAX_INDIVIDUAL_FLOOR_TRIMS_TOOLTIP",e.MAX_ALL_FLOORS_TRIMS_TOOLTIP="WORKSHOP.TRIM.MAX_ALL_FLOORS_TRIMS_TOOLTIP",e.MAX_TRIMS_ERROR_MESSAGE="WORKSHOP.TRIM.MAX_TRIMS_ERROR_MESSAGE",e.KEEP_TOGGLE="WORKSHOP.TRIM.KEEP_TOGGLE",e.REMOVE_TOGGLE="WORKSHOP.TRIM.REMOVE_TOGGLE",e.TOOL_ROTATION_CTA="WORKSHOP.TRIM.TOOL_ROTATION_CTA",e.TOOL_POSITION_CTA="WORKSHOP.TRIM.TOOL_POSITION_CTA",e.TOOL_SCALE_CTA="WORKSHOP.TRIM.TOOL_SCALE_CTA",e.TOOL_ROTATION_TOOLTIP="WORKSHOP.TRIM.TOOL_ROTATION_TOOLTIP",e.TOOL_POSITION_TOOLTIP="WORKSHOP.TRIM.TOOL_POSITION_TOOLTIP",e.TOOL_SCALE_TOOLTIP="WORKSHOP.TRIM.TOOL_SCALE_TOOLTIP",e.DELETE_TRIM="WORKSHOP.TRIM.DELETE_TRIM",e.COMPLETE_TRIM="WORKSHOP.TRIM.COMPLETE_TRIM",e.ADD_TRIM="WORKSHOP.TRIM.ADD_TRIM",e.RESET_ROTATION="WORKSHOP.TRIM.RESET_ROTATION",e.HIDE_PANO_LIST_ITEM_TOOLTIP="WORKSHOP.TRIM.HIDE_PANO_LIST_ITEM_TOOLTIP",e.SHOW_PANO_LIST_ITEM_TOOLTIP="WORKSHOP.TRIM.SHOW_PANO_LIST_ITEM_TOOLTIP",e.MOVE_TRIM_ALL_FLOORS="WORKSHOP.TRIM.MOVE_TRIM_ALL_FLOORS"}(y=e.TRIM||(e.TRIM={})),function(e){e.NUM_TYPE="WORKSHOP.VIEWS_360.NUM_TYPE",e.START_LOCATION_REMOVAL_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_REMOVAL_MESSAGE",e.START_LOCATION_MARKER_MESSAGE="WORKSHOP.VIEWS_360.START_LOCATION_MARKER_MESSAGE",e.DEFAULT_NAME="WORKSHOP.VIEWS_360.DEFAULT_NAME",e.OVERLAY_MESSAGE="WORKSHOP.VIEWS_360.OVERLAY_MESSAGE",e.OVERLAY_INFO_MISSING_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_MISSING_SWEEP",e.OVERLAY_INFO_CURRENT_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_CURRENT_SWEEP",e.OVERLAY_INFO_SELECTED_SWEEP="WORKSHOP.VIEWS_360.OVERLAY_INFO_SELECTED_SWEEP",e.ROTATE_TOOLTIP_TITLE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_TITLE",e.ROTATE_TOOLTIP_MESSAGE="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_MESSAGE",e.ROTATE_TOOLTIP_CTA="WORKSHOP.VIEWS_360.ROTATE_TOOLTIP_CTA",e.UNPLACED_CARD_MESSAGE="WORKSHOP.VIEWS_360.UNPLACED_CARD_MESSAGE",e.RENAME_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.RENAME_ITEM_OPTION_CTA",e.REMOVE_ITEM_OPTION_CTA="WORKSHOP.VIEWS_360.REMOVE_ITEM_OPTION_CTA",e.NO_VIEWS_MESSAGE="WORKSHOP.VIEWS_360.NO_VIEWS_MESSAGE"}(b=e.VIEWS_360||(e.VIEWS_360={})),function(e){e.TOAST_MESSAGE="WORKSHOP.VR.TOAST_MESSAGE",e.TOAST_CTA="WORKSHOP.VR.TOAST_CTA"}(S=e.VR||(e.VR={}))}(o=e.WORKSHOP||(e.WORKSHOP={}))}(n||(n={}));const s=n},51058:(e,t,i)=>{"use strict";var n;function s(e){return e.match(/us|mm|lr$/i)?n.IMPERIAL:n.METRIC}i.d(t,{M:()=>n,z:()=>s}),function(e){e.IMPERIAL="imperial",e.METRIC="metric"}(n||(n={}))},7677:(e,t,i)=>{"use strict";i.d(t,{i:()=>s,y:()=>r});var n=i(3184);function s(e){if(!e)return n.k$;if(r(e))return e;const t=e.toLocaleLowerCase();if(t in n.Xy)return n.Xy[t];const[i]=t.split("-");return i in n.Xy?n.Xy[i]:(n.E7.find((e=>e.startsWith(t))),n.k$)}function r(e){return n.E7.includes(e)}},41452:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LocaleModule});var n=i(47724),s=i(96909),r=i(54078),o=i(3184);async function a(e,t){const i=function(e){return e===o.k$?"./locale/strings.json":`./locale/messages/strings_${e}.json`}(e),n=await t.get(i);return JSON.parse(n)}var l=i(60771),c=i(17597),d=i(7677);class LocaleModule extends n.Y{constructor(){super(...arguments),this.name="locale"}async init(e,t){this._languageCode=function(){const e=(0,c.eY)("lang",(0,l.ht)());return(0,d.i)(e)}();const i=this._languageCode.substr(0,2);this.polyglot=new r({locale:i,interpolation:{prefix:"%{",suffix:"}"},onMissingKey:e=>(this.log.warn("Missing phrase key:"+e),LocaleModule.missingPrefix+e)});const n=await async function(e,t){const i=await a(e,t);if(e===o.k$)return i;const n=await a(o.k$,t);return Object.assign(Object.assign({},n),i)}(this._languageCode,e.queue);this.polyglot.extend(n),this.registerSettings(t)}t(e,t){return this.polyglot.t(e,t)}get languageCode(){return this._languageCode}async registerSettings(e){(await e.getModuleBySymbol(s.y.SETTINGS)).registerSetting("Locale",o.Zs,this.languageCode,!1)}}LocaleModule.missingPrefix="FIX-"},3184:(e,t,i)=>{"use strict";i.d(t,{E7:()=>n,k$:()=>s,Xy:()=>r,Zs:()=>o});const n=["en-US","es","fr","de","ru","ja","zh-CN","zh-TW","ko","nl","it","pt"],s="en-US",r=Object.assign(Object.assign({},n.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t.toLowerCase()]:t})),{})),{en:"en-US",zh:"zh-CN",cn:"zh-CN",jp:"ja"}),o="language_code"},6189:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>LoginRedirect});var n=i(67294),s=i(73935),r=i(47724),o=i(41452),a=i(64185),l=i(85893),c=i(94184),d=i.n(c),h=i(92759),u=i(47210);class LoginRedirectUi extends n.Component{constructor(e){super(e),this.signup=()=>{window.top.location.href=this.props.registerUrl}}render(){const{loginUrl:e,backgroundUrl:t}=this.props,i=t||h;return(0,l.jsx)("div",Object.assign({className:"login-redirect-screen",style:{backgroundImage:`url(${i})`}},{children:(0,l.jsx)("div",Object.assign({className:d()("login-redirect",{skrim:!!t})},{children:(0,l.jsxs)("div",Object.assign({className:"login-redirect-body"},{children:[(0,l.jsx)("h1",Object.assign({className:"login-redirect-title"},{children:"You have been invited to this space, create an account to join the conversation."}),void 0),(0,l.jsx)("div",Object.assign({className:"login-redirect-create"},{children:(0,l.jsx)(u.zx,Object.assign({buttonSize:u.qE.LARGE,buttonStyle:u.ZJ.LIGHT,onClick:this.signup},{children:"Create an Account"}),void 0)}),void 0),(0,l.jsxs)("div",Object.assign({className:"login-redirect-link"},{children:["Already have an account?",(0,l.jsx)("a",Object.assign({className:"link",href:e},{children:"Sign in"}),void 0)]}),void 0)]}),void 0)}),void 0)}),void 0)}}class LoginRedirect extends r.Y{constructor(){super(...arguments),this.name="login-redirect",this.authenticated=!1}async init(e,t){this.config=e,this.engine=t}async loadUi(){const{container:e,loginUrl:t,registerUrl:i}=this.config,r=await this.engine.getModule(o.default),l=encodeURIComponent(window.top.location.href);this.reactContainer=document.createElement("div"),this.reactContainer.id="login-redirect-container",e.appendChild(this.reactContainer);const c=(0,n.createElement)(LoginRedirectUi,{locale:r,backgroundUrl:this.getBackground(),loginUrl:`${t}?target=${l}`,registerUrl:`${i}?target=${l}`});return(0,s.render)(c,this.reactContainer),new a.Q}async unloadUi(){if(this.reactContainer){const e=(0,s.unmountComponentAtNode)(this.reactContainer);return this.reactContainer.remove(),delete this.reactContainer,e}return!1}getBackground(){const{baseUrl:e,modelId:t}=this.config;if(!t||!e)return;const i=window.devicePixelRatio||1;return`${e}/api/v1/player/models/${t}/thumb?width=${Math.max(window.innerWidth,400)}&dpr=${i}&disable=upscale`}}},90756:(e,t,i)=>{"use strict";var n;i.d(t,{U:()=>n}),function(e){e[e.NAVIGATION=0]="NAVIGATION",e[e.MODEL=1]="MODEL",e[e.EXT_LINK=2]="EXT_LINK"}(n||(n={}));n.NAVIGATION,n.MODEL,n.EXT_LINK},78238:(e,t,i)=>{"use strict";i.d(t,{U:()=>Mattertag});var n=i(2212),s=i(87068),r=i(34986),o=i(48711),a=i(23573);class Mattertag extends a.T{constructor(e){super(),this.sid="",this.created=new Date,this.modified=new Date,this.enabled=!0,this.label="",this.description="",this.parsedDescription=[],this.anchorPosition=new n.Vector3,this.anchorNormal=new n.Vector3(0,1,0),this.stemVector=new n.Vector3(0,0,(0,o._F)(1)),this.stemHeight=(0,o._F)(1),this.stemVisible=!0,this.fileAttachments=[],this.externalAttachments=[],this.color=s.I.MATTERTAG_BLUE.clone(),this.mediaType=r.z.none,this.mediaSrc="",this.widgetFrame=null,e&&Object.assign(this,e)}copy(e){this.anchorNormal.copy(e.anchorNormal),this.anchorPosition.copy(e.anchorPosition),this.color.copy(e.color),this.created.setTime(e.created.getTime()),this.description=e.description,this.enabled=e.enabled,this.floorId=e.floorId,this.roomId=e.roomId,this.label=e.label,this.mediaType=e.mediaType,this.mediaSrc=e.mediaSrc,this.modified.setTime(e.modified.getTime()),this.sid=e.sid,this.stemVector.copy(e.stemVector),this.stemHeight=e.stemHeight,this.stemVisible=e.stemVisible,this.fileAttachments=e.fileAttachments,this.externalAttachments=e.externalAttachments,this.parsedDescription=[];for(const t of e.parsedDescription)this.parsedDescription.push({link:t.link&&{label:t.link.label.slice(),url:t.link.url.slice(),type:t.link.type,navigationData:t.link.navigationData&&{floorVisibility:t.link.navigationData.floorVisibility,mode:t.link.navigationData.mode,sweepIndex:t.link.navigationData.sweepIndex,panoId:t.link.navigationData.panoId,position:t.link.navigationData.position&&t.link.navigationData.position.clone(),quaternion:t.link.navigationData.quaternion.clone(),zoom:t.link.navigationData.zoom}},text:t.text,type:t.type});return this.copyWidgetFrame(e.widgetFrame),this.commit(),this}clone(){return(new Mattertag).copy(this)}copyWidgetFrame(e){e?this.widgetFrame?(!function(e,t,...i){for(const n of i)e[n]=t[n]}(this.widgetFrame.size,e.size,"width","height"),this.widgetFrame.frame=e.frame):this.widgetFrame=Object.assign({},e):this.widgetFrame=null}refresh(e){this.fileAttachments.forEach((t=>{const i=e[t.id];i&&(t.thumbnailUrl.refreshFrom(i.thumbnailUrl),t.url.refreshFrom(i.url))}))}}},34986:(e,t,i)=>{"use strict";var n;i.d(t,{z:()=>n}),function(e){e.text="text",e.link="link",e.photo="photo",e.video="video",e.rich="rich",e.none="none",e.error="error"}(n||(n={})),function(e){e.parse=t=>null!==t&&t in e?e[t]:e.none}(n||(n={}))},51153:(e,t,i)=>{"use strict";i.d(t,{V:()=>n,s:()=>MattertagDataAnalytics});var n,s=i(40698),r=i(58626),o=i(46610),a=i(34986);!function(e){e.OVERLAY="overlay",e.HOVER="hover",e.OPEN="open"}(n||(n={}));class MattertagDataAnalytics{constructor(){this.handlers=[{msgType:o.QY,func:(e,t,i)=>{const n=i.tryGetData(s.n),o=i.tryGetData(r.P5);if(!n||!o)return;const l=n.getTagCount(),c=o.getVisitedTags().length,d=o.getViewedTagCount(),h=n.getTag(t.sid);h&&e.track("tag_opened",{tag_count:l,tag_id:t.sid,tags_visited:c,tag_view_count:d,has_media:h.mediaType!==a.z.none})}},{msgType:o.dJ,func:(e,t,i)=>{const n=i.tryGetData(s.n),o=i.tryGetData(r.P5);if(!n||!o)return;const a=n.getTagCount(),l=o.getVisitedTags().length,c=o.getViewedTagCount(),d=n.getTag(t.sid);if(d){const i={mattertag_sid:t.sid,mattertag_view:t.view,mattertag_media:d.mediaType,mattertags_count:a,mattertags_total_views:c,mattertags_visited:l};e.track("mattertag_view",i)}}}]}}},41663:(e,t,i)=>{"use strict";i.d(t,{cH:()=>GetDiscPositionsCommand,Fz:()=>AddMattertagCommand,Gn:()=>RemoveMattertagCommand,Ek:()=>EditMattertagCommand,Mm:()=>SaveNewMattertagCommand,qq:()=>SaveMattertagChangesCommand});var n=i(17386);class GetDiscPositionsCommand extends n.m{constructor(e){super(),this.id="MATTERTAG_DISC_POSITIONS",this.payload={tags:e}}}class AddMattertagCommand extends n.m{constructor(e,t,i){super(),this.id="ADD_MATTERTAG",this.payload={positionOptions:e,standardOptions:t,mediaOptions:i}}}class RemoveMattertagCommand extends n.m{constructor(e){super(),this.id="DELETE_MATTERTAG",this.payload={sid:e}}}class EditMattertagCommand extends n.m{constructor(e,t,i,n){super(),this.payload={sid:e,standardOptions:t,mediaOptions:i,positionOptions:n}}}class SaveNewMattertagCommand extends n.m{constructor(e,t,i=[],n){super(),this.payload={id:e,properties:t,fileAttachments:i,embed:n}}}class SaveMattertagChangesCommand extends n.m{constructor(e,t,i=[],n=[],s){super(),this.payload={id:e,properties:t,pendingAttachments:i,removedAttachments:n,embed:s}}}},40698:(e,t,i)=>{"use strict";i.d(t,{n:()=>MattertagsData});var n=i(32770),s=i(64781),r=i(77680);class MattertagsData extends n.V{constructor(e){if(super(),this.name="tag",this.mattertags=(0,s.q)(),e)for(const t of e)this.mattertags.set(t.sid,t);this.commit()}clear(){for(const e of this.mattertags)this.removeTag(e.sid)}clone(){return(new MattertagsData).copy(this)}copy(e){return MattertagsData.copyTagCollection(this,e),this}static copyTagCollection(e,t){const i=e.mattertags,n=t.mattertags;for(const t of i.keys)n.has(t)||e.removeTag(t);for(const t of n)e.addTag(t)}get collection(){return this.mattertags}addTag(e){this.mattertags.has(e.sid)?this.mattertags.get(e.sid).copy(e):this.mattertags.set(e.sid,e.clone())}removeTag(e){return this.mattertags.delete(e)}getTag(e){return this.mattertags.get(e)}getTagList(){return this.mattertags.keys}getTagCount(){return this.mattertags.length}iterate(e){for(const t of this.mattertags)e(t)}*[Symbol.iterator](){for(const e of this.mattertags)yield e}set onStale(e){this.hydrate=e}updateOnStaleCallbacks(e){if(!this.hydrate)return;const t=e?this.getTag(e):this.mattertags;(0,r.s)(t,(async()=>{const e=await this.hydrate();this.iterate((t=>{t.refresh(e)}))}))}}},78768:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagDataModule});var n=i(47724),s=i(96909),r=i(78238),o=i(10757),a=i(38420),l=i(99252),c=i(48602),d=i(96781),h=i(50988),u=i(71194),p=i(57361),m=i(39729),f=i(41663),g=i(98649),v=i(67166),y=i(34986),b=i(74886),S=i(86065),E=i(85004),T=i(84933),w=i(77680);function x(e){switch(e){case b.DD.VIDEO:return y.z.video;case b.DD.IMAGE:return y.z.photo;case b.DD.RICH:return y.z.rich}return y.z.none}function _(e){return{[g.L.VIDEO]:b.DD.VIDEO,[g.L.PHOTO]:b.DD.IMAGE,[g.L.RICH]:b.DD.RICH}[e]}function M(e,t,i){return t?new S.P({id:(0,T.fV)(),created:new Date,parentId:e,parentType:v.u.MATTERTAG,mediaType:_(i),src:t,url:new w.n(t,null),thumbnailUrl:new w.n(t,null),category:E.G.EXTERNAL}):null}var O=i(40698),A=i(90756),C=i(73272),P=i(60771);class DescriptionParser{constructor(e){this.modelSID=e.model,this.capabilites={links:{enable:e.supportLinks,keepLabels:e.keepLinkLabels}}}parse(e){const t=[];if(!e)return[];return e.split("[").map((function(e,t){return 0===t?e:"["+e})).forEach((e=>{const i=this.findLink(e);i?-1===i.url.indexOf("javascript:")&&(this.addLinkChunk(t,i),this.addTextChunk(t,e.slice(i.markdown.length))):this.addTextChunk(t,e)})),t}findLink(e){const t=e.match(/\[([^\]]*)\]\((.*)\)/);if(!t)return null;const i=t[2];let n=1,s=0;for(;s<i.length&&("("===i[s]?n++:")"===i[s]&&n--,0!==n);)s++;const r=i.length-s;return{markdown:t[0].substring(0,t[0].length-r),label:t[1],url:this.conditionallyEncode(t[2].substring(0,s))}}conditionallyEncode(e){return this.needsEncoding(e)?encodeURI(e):e}needsEncoding(e){if(e.match(P.jx))return!0;let t=e;try{t=decodeURI(e)}catch(e){}return!1}addTextChunk(e,t){0!==t.length&&e.push({type:y.z.text,text:t})}addLinkChunk(e,t){if(!this.capabilites.links.enable)return void(this.capabilites.links.keepLabels&&this.addTextChunk(e,t.label));const i={label:t.label,url:t.url,type:A.U.EXT_LINK};-1===i.url.indexOf("://")&&(i.url="http://"+i.url);const n=-1!==i.url.indexOf("matterport.com/show"),s=-1!==i.url.indexOf(window.location.host+"/show");if(n||s){const e=-1!==i.url.indexOf(this.modelSID),t=C.K.deserialize(i.url);e&&t?(i.type=A.U.NAVIGATION,i.navigationData=t):(i.type=A.U.MODEL,i.url+="&play=1")}e.push({type:y.z.link,link:i})}}var D=i(53204);class ListSerializer{constructor(e){this.config=e}serialize(e){const{serializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const n of e){const e=t.serialize(n);e&&i.push(e)}return i}deserialize(e){const{deserializer:t}=this.config;if(!e||!Array.isArray(e)||!t)return null;const i=[];for(const n of e){const e=t.deserialize(n);e&&i.push(e)}return i}}var N=i(94474),I=i(88512),L=i(36651),R=i(45631),k=i(78230),U=i(80680);const B=new I.Z("mds-mattertag-serializer");class MdsMattertagCreateSerializer{constructor(e,t){this.updateSerializer=e,this.mediaSerializer=t}serialize(e){const t=this.mediaSerializer.serialize(e),i=this.updateSerializer.serialize(e),n=null!==t?Object.assign(Object.assign({},t),i):i;return this.validate(n)?n:null}validate(e){if(!e)return!1;const t=["label","description","mediaUrl"].some((t=>t in e)),i=["floorId","enabled","anchorPosition"].filter((t=>!(t in e))),n=0===i.length,s=!!e.anchorPosition&&(0,U.u)(e.anchorPosition),r=n&&t&&s;return r||B.debug("Invalid MattertagDetails:",{missingFields:i,validPosition:s}),r}}var F=i(31879),V=i(19674),H=i(2212);const j=new I.Z("mds-mattertag-serializer");class MdsMattertagDeserializer{constructor(e,t){this.fileAttachmentDeserializer=e,this.externalAttachmentDeserializer=t}deserialize(e){if(!e||!this.validate(e))return j.debug("Deserialized invalid Mattertag data from MDS",e),null;const t=e.anchorPosition?V.ep.fromVisionVector(e.anchorPosition):void 0,i=e.stemNormal?V.ep.fromVisionVector(e.stemNormal):void 0,n=new r.U;if(n.sid=e.id,n.label=e.label||"",n.description=e.description||"",n.enabled=!!e.enabled,e.color&&(n.color=new H.Color(e.color)),n.created=(0,F.p)(e.created),n.modified=(0,F.p)(e.modified),e.floor&&e.floor.id&&(n.floorId=e.floor.id),e.room&&e.room.id&&(n.roomId=e.room.id),t&&(n.anchorPosition=t),e.media&&(n.mediaSrc=e.media),e.mediaType&&(n.mediaType=function(e){const t={[g.L.VIDEO]:y.z.video,[g.L.PHOTO]:y.z.photo,[g.L.RICH]:y.z.rich};return e in t?t[e]:y.z.none}(e.mediaType)),n.fileAttachments=this.getFileAttachments(n,e),n.externalAttachments=this.getExternalAttachments(n,e),void 0!==e.stemLength&&(n.stemHeight=e.stemLength),i&&i instanceof H.Vector3){const t=i.clone().setLength(n.stemHeight);n.anchorNormal=i,n.stemVector=t,n.stemVisible=!!e.stemEnabled}else n.stemVector=new H.Vector3(0,0,0),n.stemVisible=!!e.stemEnabled;return n}validate(e){if(!e)return!1;return["id","created","modified","enabled"].every((t=>t in e))}getFileAttachments(e,t){return this.fileAttachmentDeserializer?this.deserializeFileAttachments(t).sort(((e,t)=>e.created.getTime()-t.created.getTime())):[]}getExternalAttachments(e,t){if(!this.externalAttachmentDeserializer)return[];const i=this.deserializeExternalAttachments(t);if(t.media&&t.mediaType){const n=M(e.sid,t.media,t.mediaType);n&&i.push(n)}return i.sort(((e,t)=>e.created.getTime()-t.created.getTime()))}deserializeExternalAttachments(e){const t=(0,L.q)(e,"externalAttachments")||[],i=[];return t.forEach((t=>{var n;const s=null===(n=this.externalAttachmentDeserializer)||void 0===n?void 0:n.deserialize(t);s&&(s.parentId=e.id,s.parentType=v.u.MATTERTAG,i.push(s))})),i}deserializeFileAttachments(e){const t=(0,L.q)(e,"fileAttachments")||[],i=[];return t.forEach((t=>{var n;const s=null===(n=this.fileAttachmentDeserializer)||void 0===n?void 0:n.deserialize(t);s&&(s.parentId=e.id,s.parentType=v.u.MATTERTAG,i.push(s))})),i}}class MdsMattertagMediaRemoveSerializer{serialize(e){return this.validate(e)?{sid:e.sid}:null}validate(e){const t=null!==e&&!!e.mediaType&&e.mediaType===y.z.none;return null!==e&&!!e.sid&&t}}const G=new I.Z("mds-mattertag-serializer");class MdsMattertagMediaUpdateSerializer{serialize(e){const t=this.extractMedia(e);return this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["mediaUrl","mediaType"].every((t=>t in e)),i=void 0!==e.mediaType&&["rich","photo","video"].includes(e.mediaType),n=t&&i;return n||G.debug("invalid media",e,{hasRequiredFields:t,hasValidMediaType:i}),n}extractMedia(e){const t={};return e.mediaSrc&&(t.mediaUrl=e.mediaSrc),e.mediaType&&e.mediaType in z&&(t.mediaType=e.mediaType),t.mediaUrl&&t.mediaType?t:null}}const z={[y.z.photo]:[g.L.PHOTO],[y.z.rich]:[g.L.RICH],[y.z.video]:[g.L.VIDEO]};var W=i(55356);const K=new I.Z("mds-mattertag-serializer");class MdsMattertagUpdateSerializer{serialize(e){if(!e)return null;const t={};return void 0!==e.enabled&&(t.enabled=e.enabled),void 0!==e.stemVisible&&(t.stemEnabled=e.stemVisible),void 0!==e.label&&(t.label=e.label),void 0!==e.description&&(t.description=e.description),void 0!==e.color&&(0,W.D5)(e.color)&&(t.color=(0,W.Ex)(e.color)),void 0!==e.anchorPosition&&(0,U.u)(e.anchorPosition)&&(t.anchorPosition=V.ep.toVisionVector(e.anchorPosition)),void 0!==e.anchorNormal&&(0,U.u)(e.anchorNormal)&&(t.stemNormal=V.ep.toVisionVector(e.anchorNormal)),void 0!==e.stemHeight&&(t.stemLength=e.stemHeight),e.floorId&&(t.floorId=e.floorId),e.roomId&&(t.roomId=e.roomId),t&&this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["floorId","roomId","color","label","description","enabled","stemEnabled","stemLength","stemNormal","stemDirection","anchorPosition"],i=Object.keys(e).length>0,n=Object.keys(e).every((e=>t.includes(e))),s=n&&i;return s||K.debug("Invalid MattertagPatch:",{hasContents:i,hasValidFields:n,data:e}),s}}class MdsMattertagFileAttachmentSerializer{serialize(e){const t=e.fileAttachments;return void 0===t||0===t.length?null:{fileAttachments:t.map((e=>e.id))}}}var Y=i(6850);const q=new I.Z("MdsMattertagStore");class MdsMattertagStore extends N.u{constructor(e,t){super(e),this.prefetchKey="data.model.mattertags";const i=t?new R.d:void 0;this.fileAttachmentDeserializer=t?new k.O:void 0,this.fileAttachmentSerializer=new MdsMattertagFileAttachmentSerializer,this.patchSerializer=new MdsMattertagUpdateSerializer,this.mediaUpdateSerializer=new MdsMattertagMediaUpdateSerializer,this.mediaRemovalSerializer=new MdsMattertagMediaRemoveSerializer,this.createSerializer=new MdsMattertagCreateSerializer(this.patchSerializer,this.mediaUpdateSerializer),this.tagDeserializer=new MdsMattertagDeserializer(this.fileAttachmentDeserializer,i),this.deserializer=new ListSerializer({deserializer:this.tagDeserializer})}async read(e){const{includeDisabled:t=!1}=this.config,i={modelId:this.getViewId(),includeDisabled:t};return this.query(Y.GetMattertags,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mattertags;if(!n||!Array.isArray(n))return null;return(this.deserializer.deserialize(n)||[]).reduce(((e,t)=>(e[t.sid]=t,e)),{})}))}async refreshFileAttachments(e){if(!this.fileAttachmentDeserializer)return{};const{includeDisabled:t=!1}=this.config,i={modelId:this.getViewId(),includeDisabled:t};return this.query(Y.RefreshTagFileAttachments,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.mattertags;if(!n||!Array.isArray(n))return{};const s=[];for(const e of n){if(!e.id)throw q.error("Failure refreshing tag file attachments"),new Error("Failure refreshing tag file attachments");e.fileAttachments.forEach((e=>{var t;const i=null===(t=this.fileAttachmentDeserializer)||void 0===t?void 0:t.deserialize(e);i&&s.push(i)}))}return s.reduce(((e,t)=>(e[t.id]=t,e)),{})}))}async create(e){const t=this.getViewId();return Promise.all(e.map((e=>{const i=this.createSerializer.serialize(e);if(!i)throw q.error("Failure saving tag:",e.sid,e),new Error("Could not save Mattertag");return this.mutate(Y.AddMattertag,{modelId:t,mattertagId:e.sid,data:i}).then((t=>{const i=(0,L.q)(t,"data.addMattertag"),n=(new r.U).copy(e);return n.sid=i.id,n.commit(),n}))})))}async update(e,t){if(!e||0===e.length)return;const i=this.getViewId();let n="";const s={};s.modelId=i;let r="";for(const t of e){const e=t.sid,i=this.mediaUpdateSerializer.serialize(t),o=this.mediaRemovalSerializer.serialize(t),a=this.patchSerializer.serialize(t),l=this.fileAttachmentSerializer.serialize(t);if(!(a||i||o||l))return void q.debug(`Nothing to update for tag ${e}`,t);a&&(n+=`, $patch${e}: MattertagPatch!`,s[`patch${e}`]=a),l&&(n+=`, $fileAttachments${e}: [ID!]`,s[`fileAttachments${e}`]=l.fileAttachments),s[`mediaType${e}`]=i&&i.mediaType,s[`mediaUrl${e}`]=i&&i.mediaUrl;r+=`\n        update${e}:\n        ${a?`patchMattertag(\n            modelId: $modelId,\n            mattertagId: "${e}",\n            patch: $patch${e}) {\n              id\n            }`:""}\n        ${o?`removeMattertagMedia(\n            modelId: $modelId,\n            mattertagId: "${e}") {\n              id\n            }`:""}\n        ${i?`updateMattertagMediaUrl(\n            modelId: $modelId,\n            mattertagId: "${e}",\n            type: ${i&&i.mediaType},\n            url: "${i&&i.mediaUrl}") {\n              id\n            }`:""}\n        ${l?`addMattertagAttachments(\n            modelId: $modelId,\n            mattertagId: "${e}",\n            fileAttachments: $fileAttachments${e}) {\n              id\n            }`:""}\n      `}for(const e of t)(null==e?void 0:e.id)&&(null==e?void 0:e.parentId)&&e.parentType?(n+=`, $parentType${e.id}: ParentType!`,s[`parentType${e.id}`]=e.parentType,r+=`\n        unattach${e.id}:\n        removeFileAttachment(modelId: $modelId,\n                             attachmentId: "${e.id}",\n                             parentType: $parentType${e.id},\n                             parentId: "${e.parentId}") `):q.debug("MattertagStore.update: unable to remove file attachment");const o=D.Ps`
      mutation tagUpdate($modelId: ID! ${n}) {
        ${r}
      }
    `;return this.mutate(o,s).then((()=>{}))}async delete(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";for(const t of e){if(!t||t&&!t.sid)throw new Error("MattertagStore.delete failed");i+=`delete${t.sid}: deleteMattertag(modelId: $modelId, mattertagId: "${t.sid}") `}const n=D.Ps`
      mutation batchDeleteMattertag($modelId: ID!) {
        ${i}
      }
    `;return this.mutate(n,{modelId:t}).then((()=>{}))}}var Z=i(59088),$=i(27687),Q=i(17597),X=i(76236),J=i(93673),ee=i(21479),te=i(17490),ie=i(33874),ne=i(10882),se=i(38321),re=i(42835),oe=i(44060),ae=i(31278),le=i(90662),ce=i(6460),de=i(60225),he=i(4141),ue=i(29422),pe=i(13789);const{SEARCH:me}=pe.Z.SHOWCASE;class SharedTagSearchResultItem extends he.K{constructor(e,t,i){super(e),this.mattertag=t,this.id=this.mattertag.sid,this.title=this.mattertag.label,this.description=this.textParser.getPlainText(this.mattertag.description),this.icon="icon-simple-tag",this.groupPhraseKey=me.TAG_GROUP_HEADER,this.floorId=this.mattertag.floorId,this.color=function(e){return`rgb(${255*e.r}, ${255*e.g}, ${255*e.b})`}(this.mattertag.color),this.textParser=i}}class TagSearchResultItem extends SharedTagSearchResultItem{constructor(){super(...arguments),this.onSelect=async()=>{super.onSelect();const{anchorPosition:e,stemVector:t,stemHeight:i}=this.mattertag,n={anchorPosition:e,stemNormal:t,stemLength:i};this.commandBinder.issueCommand(new le.ew),await this.commandBinder.issueCommand(new ue.OR({pinPosition:n,transition:ae.n.FadeToBlack})),this.commandBinder.issueCommand(new le.oM(this.id,ce.J.TAG))}}}class MattertagSearchResultItem extends SharedTagSearchResultItem{constructor(){super(...arguments),this.onSelect=()=>{super.onSelect(),this.commandBinder.issueCommand(new le.ew),this.commandBinder.issueCommand(new de.Y(this.mattertag.sid,ae.n.FadeToBlack))}}}var fe=i(86010),ge=i(62644);const ve=new fe.v({links:!0}),ye="0"===(0,Q.eY)("mt"),be="MP_MATTERTAG_SEARCH_GROUP";async function Se(e,t,i){const n=await e.market.waitForData(ie.e),r=await e.market.waitForData(ee.pu),o=await e.getModuleBySymbol(s.y.PINS),a=t=>new(i?TagSearchResultItem:MattertagSearchResultItem)(e.commandBinder,t,ve),l=(t,n)=>{i?e.commandBinder.issueCommand(new se.ik(t,re.Er.MATTERTAG,n)):o.pinRenderer.setPinVisible(t,n)},c=e=>{const i=[];return t.iterate((t=>{if(!t.enabled)return;const n=e(t.label,ve.getPlainText(t.description));l(t.sid,n),n&&i.push(a(t))})),i},d=e=>{const i=[];return t.iterate((t=>{if(!t.enabled)return;const n=function(e){if(function(e=""){return e.trim().startsWith("{")}(e.description))try{const t=JSON.parse(e.description);return t.title=e.label,t}catch(e){}return null}(t),s=e(n);l(t.sid,s),s&&i.push(a(t))})),i},h=new ne.u(n,{[oe.re]:!0}),u={renew:()=>{e.commandBinder.issueCommandWhenBound(new ge.c6({id:be,getSimpleMatches:c,getAdvancedMatches:d,registerChangeObserver:e=>t.onChanged(e),onActivatedChanged:h.toggle}))},cancel:()=>{e.commandBinder.issueCommandWhenBound(new ge.Pe(be))}},p=e=>{const t=e===ee.Mx.WORKSHOP;!ye||t?u.renew():u.cancel()},m=r.onPropertyChanged("application",p);return p(r.application),new te.V(u,m)}class MattertagDataModule extends n.Y{constructor(){super(...arguments),this.name="mattertag-data",this.monitor=null,this.filesToUnattach=[],this.getDiscPositions=(()=>{const e=[],t={},i={},n=new H.Vector3;return async s=>(e.length=0,s.tags.forEach((s=>{const r=this.data.getTag(s);r&&(i[s]||(i[s]=new H.Vector3),i[s].copy(r.anchorPosition).add(r.stemVector),t[s]||(t[s]=new H.Vector2),(0,$.q9)(this.cameraData,i[s],t[s],n),e.push({sid:s,screen:n.z>1?null:t[s],world:i[s]}))})),e)})(),this.addTag=async e=>{const{positionOptions:t,standardOptions:i,mediaOptions:n}=e,s=Object.assign(Object.assign({},t),i),r=this.createTag((0,o.O1)(11),s,[],n);return r.modified=new Date,r.commit(),r.sid},this.editTag=async e=>{const{sid:t,positionOptions:i,standardOptions:n,mediaOptions:s}=e,r=Object.assign(Object.assign({},i),n),o=this.data.getTag(t);o&&(this.updateTag(o,r,s),o.modified=new Date,o.commit())},this.removeTag=async e=>{if(void 0!==this.data.getTag(e.sid)&&this.data.removeTag(e.sid))return e.sid},this.saveNewTag=async e=>{const{id:t,properties:i,embed:n,fileAttachments:s}=e,r=n?{mediaSrc:n.src,mediaType:x(n.mediaType)}:void 0;return this.createTag(t,i,s,r),this.engine.commandBinder.issueCommand(new h.VQ({dataTypes:[a.g.MATTERTAGS]}))},this.saveTag=async e=>{const{id:t,properties:i,pendingAttachments:n,removedAttachments:s,embed:r}=e,o=this.data.getTag(t);if(!o)return void this.log.debug("Cannot save non-existent tag");const l=r?x(r.mediaType):y.z.none,c=r?r.src:"";void 0!==r&&(c===o.mediaSrc&&l!==o.mediaType||this.updateExternalAttachment(o,r));const d=r?{mediaSrc:c,mediaType:l}:void 0;return this.updateTag(o,i,d),n.forEach((e=>{o.fileAttachments.push(e)})),this.removeFileAttachments(o,s),this.data.addTag(o),this.data.updateOnStaleCallbacks(t),this.engine.commandBinder.issueCommand(new h.VQ({dataTypes:[a.g.MATTERTAGS]}))}}async init(e,t){const{readonly:i,baseUrl:n,newTagsEnabled:r}=e;this.engine=t,this.config=e,this.descParser=new DescriptionParser({model:e.modelId,supportLinks:!0,keepLinkLabels:!0}),this.store=new MdsMattertagStore({readonly:i,includeDisabled:!i,baseUrl:n},r);const o=await this.store.read()||{};this.meshQueryModule=await t.getModuleBySymbol(s.y.MESH_QUERY),this.cameraData=await t.market.waitForData(Z.M_);const d=await t.getModule(l.F);if(this.data=t.market.tryGetData(O.n)||new O.n,this.initializeTagData(o,t.market,e.parserOptions),this.bindings.push(t.commandBinder.addBinding(f.cH,this.getDiscPositions),t.commandBinder.addBinding(f.Fz,this.addTag),t.commandBinder.addBinding(f.Ek,this.editTag),t.commandBinder.addBinding(f.Gn,this.removeTag)),!i){this.bindings.push(t.commandBinder.addBinding(f.Mm,this.saveNewTag),t.commandBinder.addBinding(f.qq,this.saveTag),d.onSave((()=>this.save()),{dataType:a.g.MATTERTAGS}),d.onPublish((()=>this.onAfterPublish()),{dataType:a.g.MATTERTAGS,phase:a.Q.AFTER}));const e=await t.market.waitForData(c.Q);e.setRevertableType(a.g.MATTERTAGS),e.setPublishableType(a.g.MATTERTAGS),this.monitor=new p.c(this.data.collection,{aggregationType:m.E.Manual,shallow:!0}),this.configureTrash()}Se(t,this.data,r).then((e=>this.bindings.push(e)))}async save(){if(this.monitor&&this.monitor.commitChanges(),!this.store||!this.monitor)return void this.log.warn("Mattertags changes will NOT be saved");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e,i=t.filter((e=>e.action===u.KI.removed)).map((e=>({sid:e.index}))),n=t.filter((e=>e.action===u.KI.added)).map((e=>this.data.getTag(e.index))),s=t.filter((e=>e.action===u.KI.updated)).map((e=>{const t=Object.assign({sid:e.index},e.diff);return"mediaSrc"in t&&(t.mediaType=this.data.getTag(e.index).mediaType),t}));return Promise.all([this.store.delete(i),this.store.create(n),this.store.update(s,this.filesToUnattach)]).then((()=>{this.filesToUnattach=[]}))}clearDiffRecord(){this.monitor&&this.monitor.clearDiffRecord()}initializeTagData(e,t,i){const n=i?new DescriptionParser(i):this.descParser;for(const t in e){const i=e[t];i.parsedDescription=n.parse(e[t].description),this.meshQueryModule.inferMeshIdsFromPoint(i,i.anchorPosition),this.data.addTag(i)}this.data.onStale=()=>this.store.refreshFileAttachments(),this.data.updateOnStaleCallbacks(),t.register(this,O.n,this.data)}createTag(e,t,i,n){let s=e;for(;this.data.getTag(s);)s=(0,o.O1)(11);const a=new r.U;if(a.sid=s,this.config.newTagsEnabled&&n){const e=function(e){switch(e){case y.z.video:return g.L.VIDEO;case y.z.photo:return g.L.PHOTO;case y.z.rich:return g.L.RICH}return null}(n.mediaType);if(n.mediaSrc&&e){const t=M(s,n.mediaSrc,e);t&&a.externalAttachments.push(t)}}return i.forEach((e=>{a.fileAttachments.push(e)})),this.updateTag(a,t,n),this.data.addTag(a),this.data.updateOnStaleCallbacks(s),a}updateTag(e,t,i){void 0!==t.color&&e.color.copy(t.color),void 0!==t.enabled&&(e.enabled=t.enabled),void 0!==t.stemHeight&&(e.stemHeight=t.stemHeight,e.stemVector.copy(e.anchorNormal).setLength(t.stemHeight)),void 0!==t.stemVisible&&(e.stemVisible=t.stemVisible),void 0!==t.label&&(e.label=t.label.slice()),void 0!==t.description&&(e.description=t.description,e.parsedDescription=this.descParser.parse(e.description)),void 0!==t.floorId&&(e.floorId=t.floorId),void 0!==(null==i?void 0:i.mediaType)&&(e.mediaType=i.mediaType),void 0!==(null==i?void 0:i.mediaSrc)&&(e.mediaSrc=i.mediaSrc.slice()),void 0!==t.normal&&(e.anchorNormal.copy(t.normal).normalize(),e.stemVector.copy(t.normal).setLength(e.stemHeight)),void 0!==t.position&&e.anchorPosition.copy(t.position)}removeFileAttachments(e,t){const{fileAttachments:i}=e;t.forEach((e=>{const t=i.findIndex((t=>t.id===e.id));-1!==t?(i.splice(t,1),this.filesToUnattach.push(e)):this.log.debug("Attempting to remove an attachment that is not in the tag")}))}updateExternalAttachment(e,t){const{mediaSrc:i}=e;i&&(e.externalAttachments=[]),t&&(e.externalAttachments=[t])}async onAfterPublish(){this.verifyDataIntegrity()}async verifyDataIntegrity(){const e="data-integrity"===(0,Q.eY)("error",""),t=this.data.getTagCount(),i=await this.store.read().catch((e=>{this.log.debug("Mattertag integrity check failed",e)}))||{},n=Object.keys(i).length;(n!==t||e)&&this.engine.broadcast(new d.Qq(`Unexpected tag count after publish (${n}/${t})`,a.g.MATTERTAGS,e))}async configureTrash(){const{readonly:e}=this.config,{commandBinder:t}=this.engine;if(e)return;const i=a.g.MATTERTAGS,n=new MdsMattertagDeserializer,s={objectType:i,create:e=>new X.F({label:e.label||(0,o.aS)(e.description||"",100)||"Mattertag",objectId:e.id,objectType:i,created:new Date,value:e}),restore:e=>{const t=n.deserialize(e.value);t&&this.data.addTag(t)}},r=await t.issueCommandWhenBound(new J.B(s));this.bindings.push(r)}}},46610:(e,t,i)=>{"use strict";i.d(t,{QY:()=>MattertagNavigatedMessage,Ik:()=>MattertagLinkOpenedMessage,dJ:()=>MattertagViewedMessage});var n=i(91466);class MattertagNavigatedMessage extends n.v{constructor(e){super(),this.sid=e}}class MattertagLinkOpenedMessage extends n.v{constructor(e){super(),this.url=e}}class MattertagViewedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.view=t}}},44060:(e,t,i)=>{"use strict";i.d(t,{re:()=>n,lc:()=>s,Us:()=>r});const n="features/mattertags",s="embedlyKey",r=1e3},92895:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagMeshModule});var n=i(47724),s=i(96909),r=i(33874),o=i(40698),a=i(42835),l=i(39504),c=i(44060),d=i(58626),h=i(66223),u=i(64366),p=i(78947);class MattertagMeshModule extends n.Y{constructor(){super(...arguments),this.name="mattertag-mesh",this.visibilityDirty=!0,this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.addNewTagMesh=(e,t)=>{this.settings.tryGetProperty(l.R,!1)||this.pinRenderer.updatePin(e.sid,a.Er.MATTERTAG,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,color:`#${e.color.getHexString()}`}),this.backgroundTexture,this.maskTexture)},this.removeTagMesh=(e,t)=>{this.pinRenderer.removePin(e.sid)},this.updateTagMesh=(e,t)=>{this.addNewTagMesh(e,e.sid)},this.initializeTagVisibility=()=>{if(this.settings.tryGetProperty(l.R,!1))return;const e=this.settings.tryGetProperty(c.re,!0);this.pinRenderer.setPinOpacityByType(a.Er.MATTERTAG,e?1:0),e&&this.mattertagData.iterate((e=>{this.pinRenderer.setPinVisible(e.sid,e.enabled)}))},this.updateTagVisibilty=()=>{if(this.settings.tryGetProperty(l.R,!1))return;this.settings.tryGetProperty(c.re,!1)?this.fadePinsToState():this.pinRenderer.fadePinOpacityByType(a.Er.MATTERTAG,0)},this.selectedTagChanged=()=>{if(!this.settings.tryGetProperty(l.R,!1)){if(this.mattertagViewData.selectedTag&&!this.mattertagViewData.navigating){const e=this.mattertagData.getTag(this.mattertagViewData.selectedTag);this.pinRenderer.showSelectedMesh(a.Er.MATTERTAG,e.sid)}this.mattertagViewData.selectedTag||this.pinRenderer.hideSelectedMesh()}}}async init(e,t){const[i,n,a,l]=await Promise.all([t.market.waitForData(o.n),t.getModuleBySymbol(s.y.PINS),t.market.waitForData(r.e),t.market.waitForData(d.P5)]);this.settings=a,this.mattertagData=i,this.mattertagViewData=l,this.pinRenderer=n.pinRenderer;const m=()=>{this.visibilityDirty=!0};this.bindings.push(this.mattertagData.collection.onElementChanged({onAdded:this.addNewTagMesh,onRemoved:this.removeTagMesh,onUpdated:this.updateTagMesh}),this.mattertagViewData.onToolStateChanged(m),this.settings.onPropertyChanged(c.re,m),this.mattertagData.onChanged(m),this.mattertagViewData.onSelectedTagChanged(this.selectedTagChanged),this.mattertagViewData.onNavigatingTagChanged(this.selectedTagChanged)),this.backgroundTexture=(0,h.p)(u),this.maskTexture=(0,h.p)(p),this.mattertagData.iterate((e=>{this.addNewTagMesh(e,e.sid)})),this.initializeTagVisibility()}dispose(e){this.pinRenderer.removePinsByType(a.Er.MATTERTAG),this.backgroundTexture.dispose(),this.maskTexture.dispose(),super.dispose(e)}onUpdate(e){this.visibilityDirty&&(this.visibilityDirty=!1,this.updateTagVisibilty())}showAnchorMesh(e){this.pinRenderer.showAnchorMesh(a.Er.MATTERTAG,e.sid,Object.assign(Object.assign({},e),{stemNormal:e.stemVector,stemLength:e.stemHeight})),this.unanchoredTagOpacity=.5,this.anchoredTagOpacity=1,this.anchorTagId=e.sid,this.fadePinsToState()}hideAnchorMesh(){this.unanchoredTagOpacity=1,this.anchoredTagOpacity=1,this.anchorTagId=void 0,this.pinRenderer.hideAnchorMesh(),this.fadePinsToState()}resetPinOpacity(){this.fadePinsToState()}changeDiscOpacity(e,t){this.pinRenderer.setPinOpacity(e,t)}setTagVisibility(e){this.pinRenderer.setPinTypeVisible(a.Er.MATTERTAG,e)}setTagVisible(e,t){this.pinRenderer.setPinVisible(e,t)}setOverrideMaterial(e,t,i){this.pinRenderer.setPinRenderOverrides(e,t,i)}fadePinsToState(){const{selectedTag:e}=this.mattertagViewData;this.mattertagData.iterate((t=>{const i=t.enabled||e===t.sid;this.pinRenderer.setPinVisible(t.sid,i);const n=t.sid===this.anchorTagId?this.anchoredTagOpacity:this.unanchoredTagOpacity;this.pinRenderer.fadePinOpacity(t.sid,i?n:0)}))}}},60225:(e,t,i)=>{"use strict";i.d(t,{Y:()=>NavigateToMattertagCommand});var n=i(17386);class NavigateToMattertagCommand extends n.m{constructor(e,t,i=!1){super(),this.id="MATTERTAG_NAVIGATE",this.payload={sid:e,transition:t,navigateToDisabled:i}}}},58626:(e,t,i)=>{"use strict";i.d(t,{Pg:()=>n,rI:()=>s,P5:()=>MattertagsViewData,ZJ:()=>BillboardData});var n,s,r=i(32770),o=i(75256),a=i(48715),l=i(64781),c=i(23573);!function(e){e.UP="Up",e.DOWN="Down",e.LEFT="Left",e.LEFT_UP="LeftUp",e.LEFT_DOWN="LeftDown",e.RIGHT="Right",e.RIGHT_UP="RightUp",e.RIGHT_DOWN="RightDown"}(n||(n={})),function(e){e.CLOSED="closed",e.IDLE="idle",e.DISABLED="disabled",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed",e.EDITING="editing"}(s||(s={}));class MattertagsViewData extends r.V{constructor(e){super(),this.mattertags=e,this.name="tag-view",this.visitedTags=new o.d,this.navigatingTag=(0,a.Y)(null),this.toolStateObservable=(0,a.Y)(s.CLOSED),this.openTagObservable=(0,a.Y)(null),this.selectedTagObservable=(0,a.Y)(null),this.uncommittedTagObservable=(0,a.Y)(null),this.progressObservable=new a.f(-1),this.screenPositionObservable=new a.f(null),this.viewedTags=0,this.creatingNewMattertag=!1,this.tagCapabilities={},this.getViewData=e=>{const t=this.mattertags.getTag(e),i=this.derivedData[e];return t&&!i&&this.makeViewData&&(this.derivedData[e]=this.makeViewData(t)),this.derivedData[e]},this.derivedData={},this.activeBillboards=(0,l.q)()}setViewDataFactory(e){this.makeViewData=e}openBillboard(e){this.openTag&&this.openTag!==e&&this.closeBillboard(this.openTag),this.openTag!==e&&this.setOpenTag(e)}hideBillboard(e){this.openTag===e&&this.setOpenTag(null)}closeBillboard(e){this.openTag===e&&this.setOpenTag(null),this.selectedTag===e&&this.setSelectedTag(null)}closeOpenBillboard(){this.openTag&&this.closeBillboard(this.openTag)}setTagCapabilities(e,t){const i=this.tagCapabilities[e]||{};i.opening=t.opening,i.navigating=t.navigating,this.tagCapabilities[e]=i,this.openTag!==e||this.tagCapabilities.opening||this.closeBillboard(e)}getTagCount(){return this.mattertags.collection.length}get navigating(){return this.navigatingTag.value}setNavigatingTag(e){this.navigatingTag.value=e}onNavigatingTagChanged(e){return this.navigatingTag.onChanged(e)}setSelectedTag(e){this.selectedTagObservable.value=e}get selectedTag(){return this.selectedTagObservable.value}onSelectedTagChanged(e){return this.selectedTagObservable.onChanged(e)}setUncommittedTag(e){this.uncommittedTagObservable.value=e}get uncommittedTag(){return this.uncommittedTagObservable.value}onUncommittedChanged(e){return this.uncommittedTagObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){return this.progressObservable.onChanged(e)}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}setToolState(e){switch(e){case s.CREATING:this.creatingNewMattertag=!0;break;case s.IDLE:case s.CLOSED:this.creatingNewMattertag=!1}this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e){return this.toolStateObservable.onChanged(e)}get openTag(){return this.openTagObservable.value}setOpenTag(e){this.openTagObservable.value=e}onOpenTagChanged(e){return this.openTagObservable.onChanged(e)}isCreatingNewMattertag(){return this.creatingNewMattertag}visitTag(e){this.viewedTags++,-1===this.visitedTags.indexOf(e)&&this.visitedTags.push(e)}getViewedTagCount(){return this.viewedTags}getVisitedTags(){return this.visitedTags.values()}setNavigatingPosition(e){this.navigatingPosition=e}getNavigatingPosition(){return this.navigatingPosition}}class BillboardData extends c.T{constructor(e){super(),this.sid=e,this.closing=!1,this.position=null,this.distance=0,this.timeoutId=0}}},87738:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>MattertagViewDataModule});var n=i(2212),s=i(47724),r=i(96909),o=i(40698),a=i(41663),l=i(59088),c=i(46610),d=i(29397),h=i(68576),u=i(8150),p=i(31278),m=i(51153),f=i(21479),g=i(5087),v=i(44060),y=i(39504),b=i(33874),S=i(60225),E=i(58626),T=i(29422),w=i(12216),x=i(42835),_=i(48470);class MattertagViewDataModule extends s.Y{constructor(){super(...arguments),this.name="mattertags-viewdata",this.distance=new n.Vector3,this.cameraPosition=new n.Vector3,this.hoverTimeout=0,this.updateViewData=()=>{this.data.iterate((e=>{this.viewData.derivedData[e.sid]=this.makeViewDataForMattertag(e)})),this.viewData.commit()},this.makeViewDataForMattertag=e=>{const t=this.viewData.activeBillboards.get(e.sid),i=this.viewData.selectedTag===e.sid,n=t?t.position:null,s=t?t.distance:0;return{position:n,selected:i,located:!(!n||!s),closeTheTag:!t||t.closing||!(i||!this.viewData.selectedTag),navigating:!(!this.viewData.navigating||this.viewData.navigating!==e.sid),navigatingPosition:i?this.viewData.getNavigatingPosition():void 0,positioned:!1,distance:s,stemHeight:e.stemHeight,visible:e.enabled,color:`#${e.color.getHexString()}`,onTagDirectionChanged:this.onTagDirectionChanged}},this.onCameraUpdate=e=>{this.viewData.activeBillboards.keys.length>0&&(this.cameraPosition.copy(e.pose.position),this.updateActiveBillboards(this.viewData.activeBillboards.keys),this.viewData.commit())},this.updateBillboardData=(e,t)=>{const i=this.viewData.activeBillboards.get(e);i&&(Object.assign(i,t),i.commit())},this.addActiveBillboard=e=>{this.viewData.activeBillboards.has(e)||this.viewData.activeBillboards.set(e,new E.ZJ(e))},this.removeFromActiveBillboards=e=>{this.viewData.activeBillboards.has(e)&&this.viewData.activeBillboards.delete(e)},this.handleOpenBillboardChanged=()=>{const e=this.viewData.openTag;this.viewData.activeBillboards.atomic((()=>{e&&(this.viewData.activeBillboards.get(e)?(window.clearTimeout(this.viewData.activeBillboards.get(e).timeoutId),this.updateBillboardData(e,{timeoutId:0,closing:!1})):this.addActiveBillboard(e),this.updateActiveBillboards([e]));for(const t of this.viewData.activeBillboards.keys){if(t===e)return;this.updateBillboardData(t,{closing:!0,direction:void 0,timeoutId:window.setTimeout((()=>{this.removeFromActiveBillboards(t)}),1e3)})}}))},this.updateActiveBillboards=async e=>{try{await this.engine.commandBinder.issueCommand(new a.cH(e)).then((e=>{for(const t of e)this.updateBillboardData(t.sid,{distance:this.distance.copy(this.cameraPosition).distanceToSquared(t.world),position:t.screen})}))}catch(e){this.log.error(`Could not get Disc Positions for tags - ${e}`)}},this.onSweepChosen=e=>{this.viewData.setNavigatingPosition(e)},this.onDiscHoverChange=e=>{if(this.settings.tryGetProperty(y.R,!1))return;if(e.pinType!==x.Er.MATTERTAG)return;const t=this.viewData.toolState;if(t!==E.rI.CLOSED&&this.viewData.selectedTag)return;const i=this.data.getTag(e.id);if(i&&i.enabled)if(clearTimeout(this.hoverTimeout),e.hovering)t!==E.rI.EDITING&&(this.hoverTimeout=window.setTimeout((()=>this.discHoverChange(e.id,e.hovering)),125));else{if(e.id===this.viewData.selectedTag)return;this.discHoverChange(e.id,!1)}},this.onDiscClicked=e=>{if(this.settings.tryGetProperty(y.R,!1))return;const t=this.viewData.toolState;e.pinType===x.Er.MATTERTAG&&t===E.rI.CLOSED&&(e.id===this.viewData.selectedTag?this.closeBillboard(e.id):(this.viewData.setSelectedTag(e.id),this.navigateToTag(e.id,p.n.Interpolate)))},this.onSweepExit=e=>{e.toSweep&&e.fromSweep!==e.toSweep&&(this.viewData.isCreatingNewMattertag()||this.viewData.closeOpenBillboard())},this.onAppChange=e=>{this.currentApp=e.application,this.viewData.closeOpenBillboard(),this.viewData.setSelectedTag(null)},this.onViewmodeChange=e=>{null===this.viewData.navigating&&(0,g.Bw)(e.fromMode)&&this.viewData.closeOpenBillboard()},this.onTagDirectionChanged=(e,t)=>{this.updateBillboardData(e,{direction:t})}}async init(e,t){this.engine=t;const[i,n,s,a]=await Promise.all([t.market.waitForData(o.n),t.market.waitForData(b.e),t.market.waitForData(l.M_),t.getModuleBySymbol(r.y.PINS)]);this.data=i,this.settings=n,this.cameraData=s,this.pinRenderer=a.pinRenderer,this.viewData=t.market.tryGetData(E.P5)||new E.P5(this.data),t.market.register(this,E.P5,this.viewData),this.viewData.setViewDataFactory(this.makeViewDataForMattertag),this.updateViewData(),this.settings.onPropertyChanged(v.re,(e=>{0!==e&&this.viewData.closeOpenBillboard()})),this.bindings.push(t.subscribe(_.tP,this.onDiscHoverChange),t.subscribe(_.F7,this.onDiscClicked),t.subscribe(d.Z,this.onSweepExit),t.subscribe(h.Z,this.onViewmodeChange),t.subscribe(u.bS,this.onAppChange),this.cameraData.onChanged(this.onCameraUpdate),this.data.onChanged(this.updateViewData),this.viewData.onOpenTagChanged(this.handleOpenBillboardChanged),this.viewData.activeBillboards.onChanged(this.updateViewData)),this.engine.commandBinder.addBinding(S.Y,(async e=>this.navigateToTag(e.sid,e.transition,e.navigateToDisabled)))}openBillboard(e){const t=this.viewData.tagCapabilities[e];t&&!t.opening||this.viewData.openBillboard(e)}closeBillboard(e){this.viewData.closeBillboard(e)}async navigateToTag(e,t,i=!1){if(this.settings.tryGetProperty(y.R,!1))return;const n=this.data.getTag(e);if(!n)throw new Error("No tag with that sid was found");if(!n.enabled&&!i)throw new Error("Cannot navigate to a disabled mattertag");const s=this.viewData.tagCapabilities[e];if(s&&!s.navigating)return;this.viewData.setNavigatingTag(e);const r=this.viewData.activeBillboards.get(e),o=r&&r.direction,{anchorPosition:a,stemVector:l,stemHeight:c}=n,d=this.tagDirectionToOrientationAdjust(o),h={anchorPosition:a,stemNormal:l,stemLength:c};return this.engine.commandBinder.issueCommand(new T.OR({pinPosition:h,transition:t,orientationAdjust:d,onSweepChosen:this.onSweepChosen})).then((()=>{this.viewData.setSelectedTag(e),this.onTagVisited(e),this.openBillboard(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)})).catch((e=>{this.log.debug(e),this.viewData.setNavigatingTag(null),this.viewData.setNavigatingPosition(void 0)}))}onTagVisited(e){this.viewData.visitTag(e),this.engine.broadcast(new c.dJ(e,m.V.OPEN)),this.engine.broadcast(new c.QY(e))}discHoverChange(e,t){if(this.settings.tryGetProperty(y.R,!1))return;if(!this.data.getTag(e))return;const i=this.viewData.openTag===e;t&&!i?(this.currentApp===f.Mx.SHOWCASE&&this.engine.broadcast(new c.dJ(e,m.V.HOVER)),this.openBillboard(e),this.pinRenderer.setPinColorVariant(e,x.K_.HIGHLIGHTED)):!t&&i&&(this.closeBillboard(e),this.pinRenderer.setPinColorVariant(e,x.K_.DEFAULT)),this.viewData.commit()}tagDirectionToOrientationAdjust(e,t=new n.Quaternion){const i=.25;let s=0,r=0;if(e){switch(e){case E.Pg.RIGHT:case E.Pg.RIGHT_DOWN:case E.Pg.RIGHT_UP:s=-.25;break;case E.Pg.LEFT:case E.Pg.LEFT_DOWN:case E.Pg.LEFT_UP:s=i}switch(e){case E.Pg.UP:case E.Pg.LEFT_UP:case E.Pg.RIGHT_UP:r=i;break;case E.Pg.DOWN:case E.Pg.LEFT_DOWN:case E.Pg.RIGHT_DOWN:s=-.25}}else s=-.25,r=-.25;return t.setFromAxisAngle(w.f.RIGHT,r),t.multiply((new n.Quaternion).setFromAxisAngle(w.f.UP,s)),t}}},38003:(e,t,i)=>{"use strict";i.d(t,{X:()=>MeasurementModeData});var n=i(32770),s=i(60725),r=i(48715),o=i(44283);class MeasurementModeData extends n.V{constructor(){super(...arguments),this.name="measure-mode",this._groups=[],this._groupMap={},this.onDataChangedCallbacks=new Set,this._editingGroupId=null,this._creatingGroupId=null,this.phaseObservable=(0,r.Y)(s.au.CLOSED),this.selectedGroupIndexObservable=new r.f(-1),this.pressProgressObservable=new r.f(-1),this.pointPositionObservable=new r.f(null)}modeActive(){return this.phase!==s.au.CLOSED}*groups(){for(const e of this._groups)yield e}get selectedGroupSid(){const e=this.selectedGroupInfo;return e&&e.info.sid?e.info.sid:null}get selectedGroupInfo(){return-1===this.selectedGroupIndex?null:this.getGroupInfo(this.selectedGroupIndex)}get phase(){return this.phaseObservable.value}get creatingGroupId(){return this._creatingGroupId}set creatingGroupId(e){this._creatingGroupId=e}get editingGroupId(){return this._editingGroupId}set editingGroupId(e){this._editingGroupId=e}setPhase(e){this.phase!==e&&(this.phaseObservable.value=e)}onPhaseChanged(e){return this.phaseObservable.onChanged(e)}notifyDataChanged(){this.onDataChangedCallbacks.forEach((e=>e()))}onDataChanged(e){return(0,o.k1)((()=>this.onDataChangedCallbacks.add(e)),(()=>this.onDataChangedCallbacks.delete(e)),!0)}get groupCount(){return this._groups.length}get selectedGroupIndex(){return this.selectedGroupIndexObservable.value}setSelectedGroupIndex(e){this.selectedGroupIndexObservable.value=e}onSelectedGroupIndexChanged(e){return this.selectedGroupIndexObservable.onChanged(e)}get pointPosition(){return this.pointPositionObservable.value}setPointPosition(e){this.pointPositionObservable.value=e}onPointPositionChanged(e){return this.pointPositionObservable.onChanged(e)}setPressProgress(e){this.pressProgressObservable.value=e}get pressProgress(){return this.pressProgressObservable.value}onPressProgressChanged(e){return this.pressProgressObservable.onChanged(e)}getGroupInfo(e){return e<0||e>=this._groups.length?null:this._groups[e]}getGroupInfoBySid(e){return e?this._groupMap[e]:null}repopulate(e){this.clear();for(const t of e){const e=t.clone();this._groups.push(e),this._groupMap[t.info.sid]=e}this.notifyDataChanged()}clear(){this._groups=[],this._groupMap={}}}},60725:(e,t,i)=>{"use strict";var n;i.d(t,{au:()=>n,Pj:()=>s,Ph:()=>r,q8:()=>o,WN:()=>a}),function(e){e[e.CLOSED=0]="CLOSED",e[e.IDLE=1]="IDLE",e[e.EDITING=2]="EDITING",e[e.CREATING=3]="CREATING",e[e.POINT_PLACED=4]="POINT_PLACED",e[e.CREATING_NEXT_POINT=5]="CREATING_NEXT_POINT",e[e.CONFIRMING_POINT=6]="CONFIRMING_POINT"}(n||(n={}));const s={mobile:{[n.POINT_PLACED]:!0,[n.EDITING]:!0},desktop:{[n.CREATING]:!0,[n.CREATING_NEXT_POINT]:!0,[n.EDITING]:!0}},r={mobile:{[n.CREATING_NEXT_POINT]:!0,[n.POINT_PLACED]:!0,[n.EDITING]:!0},desktop:{[n.CREATING]:!0,[n.CREATING_NEXT_POINT]:!0,[n.EDITING]:!0}},o={[n.IDLE]:!0,[n.EDITING]:!0},a={[n.IDLE]:!0,[n.EDITING]:!0}},58878:(e,t,i)=>{"use strict";i.d(t,{Ev:()=>MeasurementDeleteSelectedCommand,Tn:()=>MeasurementDeleteCommand,JM:()=>MeasurementListDeletionCommand});var n=i(17386);class MeasurementDeleteSelectedCommand extends n.m{}class MeasurementDeleteCommand extends n.m{constructor(e){super(),this.payload={index:e}}}class MeasurementListDeletionCommand extends n.m{constructor(...e){super(),this.payload={sids:e}}}},40688:(e,t,i)=>{"use strict";i.d(t,{O:()=>MeasurementModeToggle});var n=i(17386);class MeasurementModeToggle extends n.m{constructor(e,t){super(),this.payload={on:e,dimWhileActive:void 0!==t?t:e}}}},62518:(e,t,i)=>{"use strict";i.d(t,{c:()=>MeasurementNewline});var n=i(17386);class MeasurementNewline extends n.m{}},52247:(e,t,i)=>{"use strict";i.d(t,{R:()=>MeasurementRenameCommand});var n=i(17386);class MeasurementRenameCommand extends n.m{constructor(e,t=""){super(),this.id="RENAME_MEASUREMENT",this.payload={sid:e,text:t}}}},39712:(e,t,i)=>{"use strict";i.d(t,{v:()=>MeasurementSelect,t:()=>MeasurementSelectById});var n=i(17386);class MeasurementSelect extends n.m{constructor(e){super(),this.payload=e}}class MeasurementSelectById extends n.m{constructor(e){super(),this.payload={sid:e}}}},41911:(e,t,i)=>{"use strict";i.d(t,{B:()=>MeasurementStop});var n=i(17386);class MeasurementStop extends n.m{}},13341:(e,t,i)=>{"use strict";i.d(t,{W:()=>MeasurementVisibilityCommand});var n=i(17386);class MeasurementVisibilityCommand extends n.m{constructor(e,...t){super(),this.id="VISIBILITY_MEASUREMENT",this.payload={sids:t,visible:e}}}},21244:(e,t,i)=>{"use strict";i.d(t,{rf:()=>MeasurementSegmentCreatedMessage,u6:()=>MeasurementCreatedMessage,ff:()=>MeasurementCreationCancelledMessage,ty:()=>MeasurementTitleAddedMessage,mM:()=>MeasurementTitleChangedMessage,$Z:()=>MeasurementDeletedMessage,av:()=>MeasurementUpdatedMessage,$n:()=>MeasurementModeToggledMessage});var n=i(91466);class MeasurementSegmentCreatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementCreatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementCreationCancelledMessage extends n.v{}class MeasurementTitleAddedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.text=t}}class MeasurementTitleChangedMessage extends n.v{constructor(e,t,i){super(),this.sid=e,this.oldText=t,this.newText=i}}class MeasurementDeletedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementUpdatedMessage extends n.v{constructor(e){super(),this.data=e}}class MeasurementModeToggledMessage extends n.v{constructor(e,t,i){super(),this.opened=e,this.viewmode=t,this.count=i}}},30060:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n="features/measurements-nudge"},58014:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModelDataLoadedMessage});var n=i(91466);class ModelDataLoadedMessage extends n.v{constructor(e,t){super(),this.sid=e,this.vrSupported=t}}},8445:(e,t,i)=>{"use strict";i.d(t,{T:()=>ModelData});var n=i(32770);class ModelData extends n.V{constructor(e){super(),this.name="model",this.model=e}}},95395:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ModelDataModule});var n=i(47724),s=i(96909),r=i(48602),o=i(58851),a=i(20331),l=i(68524),c=i(88512),d=i(65006);const h=new c.Z("modelurls");class UrlContainerNoop{constructor(){this.version=3,this.baseUrl="",this.expires=0}validate(e){return!0}update(e){return Promise.resolve()}get(e){if(!this.isSigned(e))throw new Error("Tried getting relative model url with no signed urls configured.");return e}isSigned(e){if(!e.match(/^https?:/))return!1;const t=e.indexOf("?");if(-1===t)return!1;return new URLSearchParams(e.substr(t)).has("t")}}class UrlContainerV3 extends UrlContainerNoop{constructor(){super(...arguments),this.version=3,this.baseUrl="",this.absoluteUrl="",this.expires=0}validate(e){return e.templates&&e.catalog_file&&(!e.expires||1e3*e.expires>Date.now())}update(e){if(!e.templates)throw new Error("No templates found.");return this.baseUrl=e.templates[0],this.absoluteUrl=this.baseUrl.split("{{filename}}").shift()||"",e.expires?this.expires=1e3*e.expires:this.expires=Date.now()+l.Z.signedUrlDefaultExpireTime,Promise.resolve()}get(e){return this.baseUrl&&this.baseUrl.replace("{{filename}}",e.replace(this.absoluteUrl,""))}}class ModelUrls{constructor(e,t){this.api=e,this.endpoint=t,this.urlContainer=null,this.previousRefreshPromise=null,this.containerClasses=[UrlContainerNoop],t?this.containerClasses=[UrlContainerV3]:this.urlContainer=new UrlContainerNoop}needsRefresh(){if(null===this.endpoint)return!1;const e=this.urlContainer?this.urlContainer.expires:Date.now();return Date.now()+l.Z.signedUrlRefreshBuffer>e}refresh(){if(!this.needsRefresh())return Promise.resolve();if(!this.previousRefreshPromise){h.debug("Refreshing urls...");const e=this;this.previousRefreshPromise=this._refresh().then((function(){h.debug("Refreshed"),e.previousRefreshPromise=null}),(function(t){h.error("Failed url refresh, urls might go stale soon",t),e.previousRefreshPromise=null}))}return this.previousRefreshPromise}async _refresh(e=!0){const t=this.endpoint?await this.api.get(this.endpoint,{responseType:"json",prefetchFrom:e?"files":void 0,priority:a.RequestPriority.HIGHEST}):null;if(this.urlContainer&&this.urlContainer.validate(t))return this.urlContainer.update(t);for(const e of this.containerClasses){const i=new e;if(i.validate(t))return h.info("Using urls version "+i.version),this.urlContainer=i,this.urlContainer.update(t)}if(e)return this._refresh(!1);throw new Error("missing-urls")}isSigned(e){var t;return(null===(t=this.urlContainer)||void 0===t?void 0:t.isSigned(e))||!1}async getSignedUrl(e){if(e.startsWith("blob:"))return e;if(await this.refresh(),!this.urlContainer)throw new Error("Tried to use ModelUrls.get before urlContainer is established.");const t=this.urlContainer.get(e);if(!t)throw new Error(`Could not get signed URL for path ${e}`);return t}async getFile(e,t,i){const n=this.isSigned(e)?e:await this.getSignedUrl(e),s=(0,d.bf)(n,i);return this.api.getOnStoreQueue(s,t)}async getImage(e,t,i){const n=this.isSigned(e)?e:await this.getSignedUrl(e),s=(0,d.bf)(n,i);return this.api.getImage(s,t)}async getImageBitmap(e,t,i,n,s){const r=this.isSigned(e)?e:await this.getSignedUrl(e),o=(0,d.bf)(r,s);return this.api.getImageBitmap(o,t,i,n)}}var u,p=i(77680),m=i(8445),f=i(58014),g=i(91985),v=i(12935),y=i(94474);!function(e){e.AVAILABLE="available",e.LOCKED="locked",e.UNAVAILABLE="unavailable"}(u||(u={}));var b=i(31879),S=i(36651);class Model{constructor(){this.lastPublished=null}refresh(e){var t;for(const t in this.textures)e.textures[t]&&this.textures[t].refreshFrom(e.textures[t]);null===(t=this.meshUrls)||void 0===t||t.forEach(((t,i)=>{var n,s;const r=null===(s=null===(n=e.meshUrls)||void 0===n?void 0:n[i])||void 0===s?void 0:s.url;t.url&&r&&t.url.refreshFrom(r)})),this.tileset&&e.tileset&&this.tileset.urlTemplate.refreshFrom(e.tileset.urlTemplate),this.imagePose&&e.imagePose&&this.imagePose.refresh(e.imagePose)}}var E=i(25138);const T=new c.Z("mds-snapshot-serializer");class MdsModelDeserializer{deserialize(e){var t,i;if(!e||!this.validate(e))return T.debug("Deserialized invalid model data from MDS",e),null;const n=e.publication||{},s=n.contact||{},r=e.options,o=new Model;o.sid=e.id,o.organizationId=e.organization||null,o.image=e.image?e.image.id:"",o.imagePose=null,o.details={sid:e.id,name:e.name||"",presentedBy:n.presentedBy||"",summary:n.summary||"",formattedAddress:n.address||"",contact:{email:s.email||"",name:s.name||"",phone:s.phoneNumber||"",formattedPhone:s.phoneNumber||""},externalUrl:n.externalUrl||""},o.created=(0,b.p)(e.created,null),o.options={urlBranding:null===(t=r.urlBrandingEnabled)||void 0===t||t,socialSharing:!!r.socialSharingEnabled,isPublic:!!n.published,isVR:!!r.vrEnabled},n.lastPublished&&(o.lastPublished=(0,b.p)(n.lastPublished,null));const a=e.assets.textures.filter((e=>"high"===e.quality))[0],l=e.assets.textures.filter((e=>"low"===e.quality))[0];o.textures={},a&&(o.textures.high=new p.n(a,(0,b.p)(a.validUntil,null))),l&&(o.textures.low=new p.n(l,(0,b.p)(l.validUntil,null)));const c=this.getDamFileUrls(e);(null==c?void 0:c.length)&&(o.meshUrls=c);const d=null===(i=e.assets.tilesets)||void 0===i?void 0:i[0];if(this.validateTileset(d)&&(o.tileset=this.getTileset(d),o.textures.max=this.getTilesetTextures(d)),!o.meshUrls&&!o.tileset)throw new Error(`No DAM or tileset info found for model ${e.id}`);return o}validate(e){return["id","assets","publication"].every((t=>t in e))}getDamFileUrls(e){return((0,S.q)(e,"assets.meshes")||[]).reduce(((e,t)=>{if(t.status===u.AVAILABLE){const i={url:new p.n(t.url,(0,b.p)(t.validUntil,null)),suffix:t.resolution?`_${t.resolution}`:"",extension:t.format||""};"50k"===t.resolution?e.unshift(i):e.push(i)}return e}),[])}validateTileset(e){return!!e&&(e&&e.status===u.AVAILABLE)}getTileset(e){var t;const i=this.getUrlTemplate(e);return{rootURL:i.replace(E.d_.urlTemplateToken,E.d_.rootTilesetFilename),urlTemplate:new p.n(i,(0,b.p)(e.validUntil,null)),tilesetVersion:null!==(t=e.tilesetVersion)&&void 0!==t?t:"1.0"}}getTilesetTextures(e){const t=this.getUrlTemplate(e);return new p.n({id:"tiled",resolution:"*",textures:1/0,quality:"max",format:"jpg",urlTemplate:t.replace(E.d_.urlTemplateToken,"textures_max/<texture>.jpg"),validUntil:e.validUntil},(0,b.p)(e.validUntil,null))}getUrlTemplate(e){return E.d_.urlTemplateOverride?E.d_.urlTemplateOverride+E.d_.urlTemplateToken+"?t=fake":e.urlTemplate}}class MdsModelStore extends y.u{constructor(){super(...arguments),this.serializer=new MdsModelDeserializer,this.photoDeserializer=new v.f,this.prefetchKey="data.model"}async read(e){var t,i;const n={modelId:this.getViewId()},s=await this.query(g.GetModelDetails,n,e),r=this.photoDeserializer.deserialize(null===(t=null==s?void 0:s.data)||void 0===t?void 0:t.model.image),o=this.serializer.deserialize(null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.model);return o&&r&&(o.imagePose=r),o}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}}var w=i(17597);class ModelDataModule extends n.Y{constructor(){super(...arguments),this.name="model-data"}async init(e,t){this.engine=t;const{baseUrl:i,readonly:n}=e;this.store=new MdsModelStore({readonly:n,baseUrl:i});const[a]=await Promise.all([this.store.read()]);if(!a)throw Error("Could not fetch model data");(0,p.s)(a,(async()=>{const e=await this.store.refresh();a.refresh(e)})),this.model=a;const l=new m.T(this.model);t.market.register(this,m.T,l),this.registerSettings(l),async function(e,t,i){(await i.getModuleBySymbol(s.y.ANALYTICS)).setOptions({model_mesh_type:e.model.tileset&&t.tiledMeshEnabled?"streamed":"dam"})}(l,e,t),t.market.waitForData(r.Q).then((e=>{a.lastPublished&&(e.lastPublished=a.lastPublished.getTime())}));const c=(await t.getModule(o.default)).getApi();this.signedUrls=new ModelUrls(c,null),this.signedUrls.meshUrls=this.model.meshUrls,t.broadcast(new f.Z(this.model.sid,this.model.vrSupported))}async registerSettings(e){const t=await this.engine.getModuleBySymbol(s.y.SETTINGS),i="Model Options",{urlBranding:n=!0,socialSharing:r,isPublic:o,isVR:a}=e.model.options||{};t.registerSetting(i,E.Yo,r),t.registerSetting(i,"is_public",o),t.registerSetting(i,"is_vr",a);const l=!n||!!(0,w.eY)("brand",!0),c=n?(0,w.eY)("mls","0"):"0",d=n?(0,w.eY)("title","1"):"1";t.registerSetting(i,E.Zz,"0"!==d&&"2"!==c),t.registerSetting(i,E.DU,"0"!==d&&"2"!==d),t.registerSetting(i,E.L,l),t.registerSetting(i,E.sX,"1"===c||"2"===c)}getSignedUrls(){return this.signedUrls}}},25138:(e,t,i)=>{"use strict";i.d(t,{Yo:()=>s,L:()=>r,sX:()=>o,DU:()=>a,Zz:()=>l,d_:()=>c});var n=i(17597);const s="social_sharing",r="branding_enabled",o="presentation_mls_mode",a="presentation_title",l="presentation_about",c={urlTemplateToken:"<file>",urlTemplateOverride:(0,n.eY)("tiledtemplate",null),rootTilesetFilename:(0,n.eY)("tiledroot","tileset.json")}},75351:(e,t,i)=>{"use strict";var n;i.d(t,{S:()=>n}),function(e){e[e.Standard=0]="Standard",e[e.Depth=1]="Depth",e[e.Transparent=2]="Transparent",e[e.Wireframe=3]="Wireframe"}(n||(n={}))},36123:(e,t,i)=>{"use strict";i.d(t,{S:()=>ModelColliderTarget});var n=i(2212);class ModelColliderTarget extends n.Mesh{constructor(){super(...arguments),this.raycastEnabled=!0}}},21922:(e,t,i)=>{"use strict";i.d(t,{g:()=>RoomMesh});var n=i(2212),s=i(84561),r=i(74384),o=i(36123),a=i(48358),l=i(2388);class RoomMesh extends o.S{constructor(e,t,i=s.o.ALL){super(),this._opacity=1,this._chunks=[],this.size=new n.Vector3,this.center=new n.Vector3,this.built=!1,this.layers.mask=i.mask,this.name=`RoomMesh:${e}-${t}`,this.meshGroup=e,this.meshSubgroup=t,this.renderOrder=a.z.default,this.onBeforeRender=(e,t,i,s,r,o)=>{r instanceof n.RawShaderMaterial&&(o?this.chunks[o.materialIndex].onBeforeDraw(r):this.chunks.length&&this.chunks[0].onBeforeDraw(r))}}dispose(){this.reset()}reset(){this._chunks.length=0,this.geometry.dispose(),this.built=!1}addChunk(e){-1===this._chunks.indexOf(e)&&this._chunks.push(e)}getChunk(e){return this._chunks[e]}build(){if(this.built)throw new Error("build() should only be called once");if(!this._chunks.length)return;const e=(0,r.qf)(this._chunks.map((e=>e.geometry)));e.clearGroups();let t=0;this.material=[],this._chunks.forEach(((i,n)=>{i.geometry&&i.geometry.index&&(e.addGroup(t,i.geometry.index.count,n),t+=i.geometry.index.count,i.geometry.dispose(),i.geometry=e,i.notifyOnMaterialUpdated((e=>{Array.isArray(this.material)&&(this.material[n]=e)})),i.onOpacityUpdate=e=>{this.opacity=e})})),this.geometry=e,this.geometry.computeBoundingBox(),this.geometry.computeBoundingSphere(),this.material=this._chunks.map((e=>e.material)),this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0}buildWithTileChunk(e){if(this.built)return;const{meshGroup:t,meshSubgroup:i,lod:n}=e;this.name=`RoomMesh:${n}-${t}-${i}-${e.chunkIndex}`,this.meshGroup=t,this.meshSubgroup=i,this._chunks.push(e),e.notifyOnMaterialUpdated((e=>{this.material=e})),e.onOpacityUpdate=e=>{this.opacity=e},this.size=this.boundingBox.getSize(this.size),this.center=this.boundingBox.getCenter(this.center),this.built=!0}get boundingBox(){return(0,r.A5)(this.geometry)}set opacity(e){e!==this.opacity&&(this._opacity=e,this.raycastEnabled=e>l.xx.FADE_CLICKABLE_THRESHOLD,this.renderOrder=e<l.xx.FADE_OPAQUE?a.z.ghostFloor:a.z.default)}get opacity(){return this._opacity}get chunks(){return this._chunks}getSortKey(){return this.chunks.length?this._chunks[0].getSortKey():0}}},80301:(e,t,i)=>{"use strict";var n;i.d(t,{l:()=>n}),function(e){e[e.NONE=0]="NONE",e[e.RAYCAST=1]="RAYCAST"}(n||(n={}))},91670:(e,t,i)=>{"use strict";i.d(t,{U:()=>SetChunkRenderModeCommand});var n=i(17386),s=i(75351);class SetChunkRenderModeCommand extends n.m{constructor(e){super(),this.id="SET_CHUNK_RENDER_MODE",this.payload={mode:e}}}SetChunkRenderModeCommand.modes=s.S},67027:(e,t,i)=>{"use strict";i.d(t,{_:()=>MeshData});var n=i(32770),s=i(2212),r=i(17131);const o=[-5,-5,-5,5,5,5];class MeshData extends n.V{constructor(e,t=o){super(),this.name="mesh-data",this.bounds=new s.Box3,this.center=new s.Vector3,this.size=new s.Vector3,this.meshCenter=new s.Vector3,this.meshRadius=0,this.maxPlacementRadius=0,this._meshGroups={floors:new Set,rooms:new Map,roomsByFloor:new Map},this.meshGroupVisuals={floorOpacity:new Map,floorFadeDist:new Map},this.meshSubGroupsFromPoint=e=>{const t=[];for(const[i,n]of this.meshGroups.rooms)n.boundingBox.containsPoint(e)&&t.push(i);return t},this.meshTextureOpacity=new r.z(e),this.bounds.setFromArray(t),this.bounds.getCenter(this.center),this.bounds.getSize(this.size)}get meshGroups(){return this._meshGroups}}},17916:(e,t,i)=>{"use strict";var n;i.d(t,{V:()=>n}),function(e){e[e.Min=0]="Min",e[e.Standard=1]="Standard",e[e.High=2]="High",e[e.Detail=3]="Detail"}(n||(n={}))},76863:(e,t,i)=>{"use strict";i.d(t,{T0:()=>r,Pv:()=>o,Nr:()=>a});var n=i(36123);const s=e=>e instanceof n.S,r=e=>s(e),o=e=>s(e)&&e.raycastEnabled&&e.visible,a=e=>{let t=e.visible;t&&e.traverseAncestors((e=>{t&&(t=e.visible)}));return!r(e)&&t||o(e)}},22377:(e,t,i)=>{"use strict";var n;i.d(t,{h:()=>n}),function(e){e.PanoTexture="PANO_TEXTURE",e.PanoTextureTransition="PANO_TEXTURE_TRANSITION",e.MeshTexture="MESH_TEXTURE",e.ColorOverlay="COLOR_OVERLAY",e.MeshPreviewSphere="MESH_PREVIEW_SPHERE",e.Wireframe="WIREFRAME",e.FlatShading="FLAT_SHADING",e.PanoOverlay="PANO_OVERLAY",e.PanoOverlayTransition="PANO_OVERLAY_TRANSITION",e.MeshTrimVertex="MESH_TRIM_VERTEX",e.MeshTrimPixel="MESH_TRIM_PIXEL"}(n||(n={}))},51245:(e,t,i)=>{"use strict";i.d(t,{oR:()=>s,$4:()=>r});var n=i(21922);const s=e=>!!e&&e instanceof n.g,r={hasMeshGroup:e=>"object"==typeof e&&!!e&&"meshGroup"in e,hasMeshSubgroup:e=>"object"==typeof e&&!!e&&"meshSubgroup"in e,isRoomMesh:s,isVisibleRoomMesh:e=>s(e)&&e.raycastEnabled&&e.visible}},93331:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ModelLoadProgressMessage});var n=i(91466);class ModelLoadProgressMessage extends n.v{constructor(e,t){super(),this.loaded=e,this.total=t}}},2388:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>s,Lp:()=>r,iT:()=>o,xx:()=>a});var n=i(17597);const s={flipDownload:(0,n.eY)("flipDownload",!0),flipUpload:(0,n.eY)("flipUpload",!0),debugLOD:(0,n.eY)("debuglod",!1),debugRttQuality:(0,n.eY)("debugQuality",!1),debugRttScores:(0,n.eY)("debugScores",!1),debugRttClear:(0,n.eY)("debuglodrtt",!0),debugPauseTexStream:(0,n.eY)("textureStreamPause",!1),sightingMaxAge:(0,n.eY)("meshSightingMaxAge",600),disableTextureStreamBelowLod:(0,n.eY)("disableTextureStreamBelowLod",3),textureTileSize:(0,n.eY)("chunkTileSize",512)},r="wireframeEnabled",o="features/tiled_mesh",a={FADE_OPAQUE:1,FADE_ABOVE:.024,FADE_BELOW:.1,FADE_CLICKABLE_THRESHOLD:.025,FADE_IN_VALUE:.08,FADE_DEPTH_WRITE_THRESHOLD:(0,n.eY)("chunkDepthWrite",.5),FADE_IN_END_ANGLE:45,FADE_IN_START_ANGLE:22,FADE_IN_HOVER_BOOST_VALUE:.2,FADE_BELOW_START:0,FADE_BELOW_MULT:1,DISCARD_FOCAL_MULTI:.125}},56247:(e,t,i)=>{"use strict";i.d(t,{t:()=>r,Z:()=>o});var n=i(2212),s=i(22377);const r=10,o={cube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:i(54124),fragmentShader:i(59253)},blurCube:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},dir:{type:"v2",value:new n.Vector2(0,0)}},vertexShader:i(25247),fragmentShader:i(48326)},modelChunk:{uniforms:{[s.h.MeshTexture]:{map:{type:"t",value:null},meshOpacity:{type:"f",value:0},opacity:{type:"f",value:1},transparentDiscardDist:{type:"f",value:0}},[s.h.MeshTrimVertex]:{meshTrimMatrices:{type:"mat4array",value:[]},meshTrimsDiscardContents:{type:"barray",value:new Array(r).fill(!0)},hasKeepVolume:{type:"b",value:!1}},[s.h.MeshTrimPixel]:{meshTrimMatrices:{type:"mat4array",value:[]},meshTrimsDiscardContents:{type:"barray",value:new Array(r).fill(!0)},hasKeepVolume:{type:"b",value:!1}},[s.h.PanoTexture]:{pano0Map:{type:"t",value:null},pano0Position:{type:"v3",value:new n.Vector3},pano0Matrix1:{type:"m4",value:new n.Matrix4},pano0Matrix2:{type:"m4",value:new n.Matrix4},panoOpacity:{type:"f",value:1}},[s.h.PanoTextureTransition]:{progress:{type:"f",value:0},pano1Map:{type:"t",value:null},pano1Position:{type:"v3",value:new n.Vector3},pano1Matrix1:{type:"m4",value:new n.Matrix4},pano1Matrix2:{type:"m4",value:new n.Matrix4}},[s.h.PanoOverlay]:{overlay0Map:{type:"t",value:null},overlay0Matrix:{type:"m4",value:new n.Matrix4}},[s.h.PanoOverlayTransition]:{overlay1Map:{type:"t",value:null},overlay1Matrix:{type:"m4",value:new n.Matrix4}},[s.h.ColorOverlay]:{colorOverlay:{type:"v4",value:null}},[s.h.MeshPreviewSphere]:{meshPreviewCenter:{type:"v3",value:null},meshPreviewSize:{type:"f",value:.3}},[s.h.Wireframe]:{time:{type:"f",value:0},fill:{type:"c",value:new n.Color(16711680)},stroke:{type:"c",value:new n.Color(16777215)},dualStroke:{type:"b",value:!1},fillEnabled:{type:"b",value:!1},insideAltColor:{type:"b",value:!1},thickness:{type:"f",value:.1},secondThickness:{type:"f",value:.1},dashEnabled:{type:"b",value:!1},dashRepeats:{type:"f",value:10},dashOverlap:{type:"b",value:!1},dashLength:{type:"f",value:.1,range:[0,1]},dashAnimate:{type:"b",value:!1},squeeze:{type:"b",value:!1},squeezeMin:{type:"f",value:.1},squeezeMax:{type:"f",value:1},wireframeOpacity:{type:"f",value:1,range:[0,1]}}},vertexShader:i(57971),fragmentShader:i(40933)},modelOutside:{uniforms:{map:{type:"t",value:null},opacity:{type:"f",value:1},colorOverlay:{type:"v4",value:new n.Vector4(0,0,0,0)}},vertexShader:i(10982),fragmentShader:i(96432)},depth:{uniforms:{opacity:{type:"f",value:1},maxDistance:{type:"f",value:20}},vertexShader:i(27409),fragmentShader:i(24074)}}},6559:(e,t,i)=>{"use strict";i.d(t,{S7:()=>n,O7:()=>f,qT:()=>u,Pm:()=>p});var n,s=i(55356),r=i(2212),o=i(17916),a=i(19674),l=i(2388);class TextureQualityMap{constructor(){this._configs={},this._orders={},this._maxLod=-1/0,this._maxTs=1/0,this._streamAbove=0,this.resetOnNextRegisterOnce=!1,this.dynamic=!1}static encodeKey(e,t){return e-t}get maxLod(){return this._maxLod}get maxTexelSize(){return this._maxTs}limitStreamingBelow(e){this._streamAbove=e}order(e,t=!1){return t&&!this._orders[e]&&(this._orders[e]=[]),this._orders[e]}reset(){this._configs={},this._orders={},this.dynamic=!1,this._maxTs=1/0,this._maxLod=-1/0}get isDynamic(){return this.dynamic}valid(e){return e in this._configs}get(e){if(!this.valid(e))throw new Error("invalid quality level "+e);return this._configs[e]}max(e){return e<this._streamAbove?this.min(e):this.order(e)[this.order(e).length-1]}min(e){return this.order(e)[0]}fromPixelSize(e,t){const i=this.order(e),n=this.min(e);let s=this.max(e);for(let e=i.length-1;e>=0;e--)t>this.get(i[e]).texelSize&&i.indexOf(s)>i.indexOf(n)&&(s=i[e]);return s}moreDetailed(e,t){let i=this.min(e);const n=this.max(e),s=this.order(e),r=s.indexOf(t);return r+1===s.length?n:(-1!==r&&(i=Math.min(n,s[r+1%s.length])),i)}lessDetailed(e,t){const i=this.order(e),n=i.indexOf(t);let s=t;return-1!==n&&(s=i[Math.max(0,n-1)]),s}minSize(){return Object.values(this._configs).sort(c)[0]}maxSize(){const e=Object.values(this._configs).sort(c);return e[e.length-1]}nearestQuality(e,t){const i=this.order(e),n=this.max(e),s=(0,a.et)(t,1,4,0,i.length-1);return Math.min(n,i[Math.round(s)])}registerQualities(e,t,i,n,s="max"){this.dynamic=!0,this.resetOnNextRegisterOnce&&(this.reset(),this.resetOnNextRegisterOnce=!1);const r=this._configs,o=this.order(e,!0),a=t*n;for(let n=t,c=i;n>=a;n*=.5,c*=2){const i=TextureQualityMap.encodeKey(e,c),a=r[i];(!a||a&&a.assetSize<t)&&(this._maxTs=Math.min(this._maxTs,c),this._maxLod=Math.max(this._maxLod,e),r[i]={key:i,lod:e,texelSize:c,textureSize:n,assetSize:t,assetType:s,tileSize:Math.min(n,l.ZP.textureTileSize)}),-1===o.indexOf(i)&&o.push(i)}o.sort(((e,t)=>r[t].texelSize-r[e].texelSize))}}function c(e,t){return e.textureSize>t.textureSize?1:-1}!function(e){e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.ULTRA=4]="ULTRA"}(n||(n={}));const d=new TextureQualityMap;var h;(h=d).reset(),h.registerQualities(o.V.Standard,512,.048,.5,"low"),h.registerQualities(o.V.Standard,2048,.012,.5,"high"),h.dynamic=!1,h.resetOnNextRegisterOnce=!0;const u=()=>d;const p=e=>{const t=u();if(!t.isDynamic){const i=t.order(0).map(((e,i)=>({index:i,level:t.get(e)})));for(const{index:t,level:n}of i)if(n.textureSize===e)return t}throw new Error(`Not a valid texture size: ${e}`)},m={[n.LOW]:new r.Vector4(1,0,0,.5),[n.MEDIUM]:new r.Vector4(1,1,0,.5),[n.HIGH]:new r.Vector4(0,1,0,.5),[n.ULTRA]:new r.Vector4(0,1,1,.5)};function f(e){return e in m?m[e]:(0,s.G1)(.5,e)}},98811:(e,t,i)=>{"use strict";i.d(t,{P:()=>ModelRatingViewData});var n=i(32770),s=i(48715);class ModelRatingViewData extends n.V{constructor(){super(),this.name="model-rating-view-data",this.isDialogVisible=new s.f(!1),this.setDialogVisible=e=>{this.isDialogVisible.value=void 0!==e?e:!this.isDialogVisible.value}}onDialogVisibleChanged(e){return this.isDialogVisible.onChanged(e)}getIsDialogVisible(){return this.isDialogVisible.value}}},43229:(e,t,i)=>{"use strict";i.d(t,{m:()=>ToggleModelRatingDialogCommand,M:()=>SubmitModelRatingCommand});var n=i(17386);class ToggleModelRatingDialogCommand extends n.m{constructor(e){super(),this.payload={toVisible:e}}}ToggleModelRatingDialogCommand.id="TOGGLE_MODEL_RATING_DIALOG";class SubmitModelRatingCommand extends n.m{constructor(e,t=!1){super(),this.payload={rating:e,didFinish:t}}}SubmitModelRatingCommand.id="SUBMIT_MODEL_RATING"},62627:(e,t,i)=>{"use strict";i.d(t,{E:()=>ModelRatedMessage});var n=i(91466);class ModelRatedMessage extends n.v{constructor(e){super(),this.rating=e}}},87220:(e,t,i)=>{"use strict";i.d(t,{i:()=>n,j:()=>s});const n="features/model-rating-dialog",s="features/model-rating-dialog-prompt"},4901:(e,t,i)=>{"use strict";i.d(t,{u:()=>SetMouseCursorCommand});var n=i(17386);class SetMouseCursorCommand extends n.m{constructor(e=null){super(),this.id="SET_MOUSE_CURSOR",this.payload={cursor:e}}}},14092:(e,t,i)=>{"use strict";var n;i.d(t,{C:()=>n}),function(e){e.NONE="none",e.DEFAULT="default",e.MOVE="move",e.MOVE_LF="col-resize",e.MOVE_UD="row-resize",e.XHAIR="crosshair",e.PLUS="cell",e.QUESTION="help",e.NOPE="not-allowed",e.FINGER="pointer",e.TEXT="text",e.TEXT_VERT="vertical-text",e.ZOOM_IN="zoom-in",e.ZOOM_OUT="zoom-in",e.GRAB="grab",e.GRABBING="grabbing",e.ARROW_R="e-resize",e.ARROW_L="w-resize",e.ARROW_U="n-resize",e.ARROW_D="s-resize",e.ARROW_UR="ne-resize",e.ARROW_UL="nw-resize",e.ARROW_DR="se-resize",e.ARROW_DL="sw-resize",e.ARROW_LR="ew-resize",e.ARROW_UD="ns-resize",e.ARROW_URDL="nesw-resize",e.ARROW_ULDR="nwse-resize"}(n||(n={}))},32600:(e,t,i)=>{"use strict";i.r(t),i.d(t,{Cursor:()=>s.C,SetMouseCursorCommand:()=>r.u,default:()=>MouseCursor});var n=i(47724),s=i(14092),r=i(4901);class MouseCursor extends n.Y{constructor(){super(...arguments),this.name="mouse-cursor",this.activeCursor=null}async init(e,t){this.config=Object.assign({classPrefix:"cursor"},e),this.bindings.push(t.commandBinder.addBinding(r.u,(async e=>this.changeCursor(e.cursor))))}changeCursor(e){const{container:t,classPrefix:i}=this.config;e!==this.activeCursor&&(this.activeCursor&&t.classList.remove(`${i}-${this.activeCursor}`),e&&t.classList.add(`${i}-${e}`),this.activeCursor=e)}}},29422:(e,t,i)=>{"use strict";i.d(t,{ZK:()=>LockNavigationCommand,Lp:()=>UnlockNavigationCommand,Np:()=>NavigateToBox,zs:()=>FocusOnPointInsideCommand,OR:()=>FocusOnPinInsideCommand,ju:()=>NavigateToSweepCommand,Cs:()=>NavigateToLabelCommand,L4:()=>NavigateToPoseCommand});var n=i(17386);class LockNavigationCommand extends n.m{constructor(){super(),this.id="LOCK_NAVIGATION"}}class UnlockNavigationCommand extends n.m{constructor(){super(),this.id="UNLOCK_NAVIGATION"}}class NavigateToBox extends n.m{constructor(e){super(),this.payload=e,this.id="NAVIGATE_TO_BOX"}}class FocusOnPointInsideCommand extends n.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_POINT_INSIDE"}}class FocusOnPinInsideCommand extends n.m{constructor(e){super(),this.payload=e,this.id="FOCUS_ON_PIN_INSIDE"}}class NavigateToSweepCommand extends n.m{constructor(e){super(),this.id="MOVE_TO_SWEEP",this.payload=Object.assign({},e)}}class NavigateToLabelCommand extends n.m{constructor(e){super(),this.payload=e,this.id="NAVIGATE_TO_LABEL"}}class NavigateToPoseCommand extends n.m{constructor(e){super(),this.id="NAVIGATE_TO_POSE",this.payload={pose:e}}}},29539:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>Navigation});var n=i(47724),s=i(33874),r=i(96909),o=i(59088),a=i(31278),l=i(10613),c=i(19047),d=i(29422),h=i(31102);class NavigationException extends h.y{constructor(e){super(e),this.name="NavigationException"}}const u={Locked:"Cannot move while navigation is locked",InsideOnly:"Cannot navigate between panos when not in Panorama mode",InvalidSweep:"Not at a valid sweep",InTransition:"Cannot move while in a transition",NoDestinationFound:"Cannot move in that direction"};var p=i(35003),m=i(94610),f=i(24764),g=i(25269),v=i(2212),y=i(2725),b=i(76863),S=i(82088),E=i(95586),T=i(4901),w=i(14092),x=i(79553),_=i(73844);class NavigationInputFocus{constructor(e,t,i,n,s,r,o,a,l,c,d){this.canStartTransition=e,this.commandBinder=t,this.input=i,this.floorsViewData=n,this.navigation=s,this.navigationDollhouse=r,this.sweepData=o,this.cameraModule=a,this.toolsData=l,this.settingsData=c,this.meshQuery=d,this.bindings=[],this.cancelTransition=!1,this.didSetCursor=!1,this.targetFloorId=null,this.targetHitPoint=new v.Vector3,this.toggleInput=e=>{this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.onRoomClick=(e,t,i)=>{if(this.shouldIgnore())return!1;if(!this.canStartTransition())return!1;if(!i||!i.point)return!1;const n=this.meshQuery.floorIdFromObject(t);if(!n)return!1;if(!this.floorsViewData.isNavigable(n))return this.onBackgroundClick();if(this.cancelTransition)return!0;const s=this.floorsViewData.currentFloorId;return 1!==this.floorsViewData.totalFloors&&n!==s?(this.targetFloorId||(this.targetFloorId=n,this.targetHitPoint.copy(i.point)),!s&&(this.changeFloorIfNeeded(),!0)):this.floorsViewData.roomSelectModeActive||this.floorsViewData.floorSelectModeActive?(this.cancelTransition=!0,this.cameraModule.cancelTransition().then((()=>this.navigation.navigateToPanoNearIntersection(i))).then((()=>{this.cancelTransition=!1})),this.commandBinder.issueCommand(new T.u(w.C.DEFAULT)),!0):this.floorsViewData.floorSelectModeActive?(this.cancelTransition=!1,!1):(this.navigationDollhouse.navigateToPoint(i.point).then((()=>{this.cancelTransition||this.setFocusSweep(i),this.cancelTransition=!1})),!0)},this.onBackgroundClick=()=>!this.shouldIgnore()&&(!!this.canStartTransition()&&(!this.targetFloorId&&(!!this.cancelTransition||(this.cancelTransition=!0,void this.cameraModule.cancelTransition().then((()=>this.commandBinder.issueCommand(new y.Vw(null,!1)))).then((()=>{this.cancelTransition=!1})))))),this.onBackgroundHover=()=>{if(this.shouldIgnore())return!1;const{activeToolName:e}=this.toolsData;return null!==this.floorsViewData.currentFloorId&&e!==x.w1.LABELS&&(this.didSetCursor=!0,this.commandBinder.issueCommand(new T.u(w.C.FINGER))),!1},this.onBackgroundUnhover=()=>(this.shouldIgnore()||this.didSetCursor&&(this.commandBinder.issueCommand(new T.u(w.C.DEFAULT)),this.didSetCursor=!1),!1),this.onFloorChange=()=>{this.shouldIgnore()||null===this.floorsViewData.currentFloorId&&this.commandBinder.issueCommand(new T.u(w.C.DEFAULT))},this.clearFloorChange=()=>{this.targetFloorId=null},this.changeFloorIfNeeded=async()=>{this.targetFloorId&&(await this.commandBinder.issueCommand(new y.Vw(this.targetFloorId,!1,void 0,this.targetHitPoint)),this.targetFloorId=null)},this.bindings.push(this.input.registerMeshHandler(p.R,f.s.is(b.Pv),this.onRoomClick),this.input.registerUnfilteredHandler(p.R,this.clearFloorChange),this.input.registerHandler(p.R,this.changeFloorIfNeeded),this.input.registerMeshHandler(p.R,f.s.isType(g.i),this.onBackgroundClick),this.input.registerMeshHandler(m.z,f.s.isType(g.i),this.onBackgroundHover),this.input.registerMeshHandler(m.A,f.s.isType(g.i),this.onBackgroundUnhover),this.floorsViewData.makeFloorChangeSubscription(this.onFloorChange))}async setFocusSweep(e){if(!this.canStartTransition())return;if(this.cancelTransition)return;const t=(0,S.bG)(this.sweepData,!1,e,this.meshQuery);t.length>0&&t[0].sweep&&await this.commandBinder.issueCommand(new E.aK(t[0].sweep.id))}shouldIgnore(){return!this.settingsData.tryGetProperty(_.Q5,!1)}}var M=i(12216),O=i(81507),A=i(81040),C=i(88727),P=i(88216),D=i(36123),N=i(76870),I=i(88512);const L=new I.Z("nav-input");class NavigationInputInside{constructor(e,t,i){this.navigation=e,this.inputIni=t,this.insideNav=[],this.insideVrNav=[],this.toggleInput=e=>{this.insideNav.forEach((t=>e?t.renew():t.cancel()))},this.toggleVrInput=e=>{this.insideVrNav.forEach((t=>e?t.renew():t.cancel()))},this.registerInsideClickHandlers=e=>[e.registerMeshHandler(p.R,f.s.is(b.Pv),((e,t,i)=>this.tryExecuteAction(((e,t)=>B(e)&&R(t)),((e,t)=>R(t)&&this.navigation.navigateTowardsIntersection(t)),e,i))),e.registerMeshHandler(p.R,f.s.isType(g.i),((e,t,i)=>this.tryExecuteAction(((e,t)=>B(e)&&R(t)),((e,t)=>R(t)&&this.navigation.navigateTowardsIntersection(t)),e,i)))],this.registerVrClickHandlers=e=>[e.registerMeshHandler(p.R,f.s.isInstanceOf(D.S),((e,t,i)=>this.tryExecuteAction(((e,t)=>B(e)&&R(t)),((e,t)=>R(t)&&this.navigation.navigateToPanoNearIntersection(t)),e,i)))],this.registerWheelInput=e=>[e.registerHandler(A.a,(e=>this.tryExecuteAction((e=>!0),(e=>{if(e instanceof A.a){const t=new v.Vector3(0,0,Math.sign(e.delta.y));return!!this.navigation.navigateInLocalDirection(t)}return!1}),e)))],this.hotkeys=e=>[e.registerHandler(C.e,(e=>this.tryExecuteAction((e=>(k(e)||U(e))&&e.key in NavigationInputInside.hotkeyDirections),(e=>{if(k(e)){this.continuousMovementHotkey=e.key;const t=NavigationInputInside.hotkeyDirections[e.key];this.navigation.setContinuousNavigationLocalDirection(t)}else U(e)&&e.key===this.continuousMovementHotkey&&this.navigation.setContinuousNavigationLocalDirection();return!1}),e)))],this.tryExecuteAction=(e,t,i,n)=>{let s=!1;try{this.navigation.isNavigationInputAllowed()&&e(i,n)&&(s=t(i,n))}catch(e){if(!(e instanceof NavigationException))throw L.warn(e),e;L.debug(e)}return s},this.insideVrNav.push(...this.registerVrClickHandlers(this.inputIni)),this.insideNav.push(...this.registerInsideClickHandlers(this.inputIni),...this.hotkeys(this.inputIni)),i&&this.insideNav.push(...this.registerWheelInput(this.inputIni))}get bindings(){return[...this.insideNav,...this.insideVrNav]}}function R(e){return void 0!==e&&void 0!==e.point}function k(e){return e instanceof C.e&&e.state===P.M.DOWN}function U(e){return e instanceof C.e&&e.state===P.M.UP}function B(e){return e instanceof p.R&&e.button===N.MP.PRIMARY}NavigationInputInside.hotkeyDirections={[O.R.W]:M.f.FORWARD,[O.R.A]:M.f.LEFT,[O.R.S]:M.f.BACK,[O.R.D]:M.f.RIGHT,[O.R.UPARROW]:M.f.FORWARD,[O.R.DOWNARROW]:M.f.BACK};const F=new I.Z("nav-input");class NavigationInputOutside{constructor(e,t,i){this.navigation=e,this.input=t,this.settings=i,this.bindings=[],this.toggleInput=e=>{F.debug("toggling dollhouse input",e),this.bindings.forEach((t=>e?t.renew():t.cancel()))},this.bindings.push(...this.registerEnterPanoHandler())}registerEnterPanoHandler(){return[this.input.registerMeshHandler(p.R,f.s.isInstanceOf(D.S),((e,t,i)=>!this.settings.tryGetProperty(_.Q5,!1)&&(!!this.navigation.isNavigationInputAllowed()&&(e.button===N.MP.PRIMARY&&void 0!==i&&this.navigation.navigateToPanoNearIntersection(i)))))]}}var V=i(75892),H=i(3805),j=i(35597),G=i(5087),z=i(3506),W=i(27326),K=i(2240),Y=i(24151),q=i(93263),Z=i(7170),$=i(69626),Q=i(39455),X=i(64185);class NavigationDollhouse{constructor(e,t,i){this.canStartTransition=e,this.pose=t,this.cameraModule=i,this.navigateToPoint=async e=>{if(!this.canStartTransition())return;const t=this.pose.focalDistance,i=(0,$.fd)(this.pose.rotation,e,t);await this.cameraModule.cancelTransition(),await this.cameraModule.moveTo({pose:{position:i},transitionType:a.n.Interpolate,focalDistance:t,transitionTime:Q.E.TRANSITION_TIME_DH})},this.navigateToBox=e=>{if(!this.canStartTransition())return X.Q.resolve();const{position:t,rotation:i,focalDistance:n}=this.getPoseForBox(e);return this.cameraModule.moveTo({pose:{position:t,rotation:i},transitionType:a.n.Interpolate,focalDistance:n,transitionTime:Q.E.TRANSITION_TIME_DH})},this.getPoseForBox=e=>{const t=e.getCenter(new v.Vector3),i=e.getSize(new v.Vector3),n=i.z>i.x;let s=this.pose.rotation;s=n?s.angleTo(J.LANDSCAPE_LEFT)>s.angleTo(J.LANDSCAPE_RIGHT)?J.LANDSCAPE_LEFT:J.LANDSCAPE_RIGHT:s.angleTo(J.PORTRAIT_RIGHT)>s.angleTo(J.PORTRAIT_LEFT)?J.PORTRAIT_LEFT:J.PORTRAIT_RIGHT;const r=-85*Z.Ue,o=2*Math.atan(1/this.pose.projection.elements[5]),a=(0,$.YN)(t,s,r,e,1.2*o,this.pose.aspect()),l=t.distanceTo(a.position);return{position:a.position,rotation:a.rotation,focalDistance:l}}}}const J={LANDSCAPE_LEFT:(new v.Quaternion).setFromAxisAngle(M.f.UP,45*Z.Ue),LANDSCAPE_RIGHT:(new v.Quaternion).setFromAxisAngle(M.f.UP,-45*Z.Ue),PORTRAIT_LEFT:(new v.Quaternion).setFromAxisAngle(M.f.UP,25*Z.Ue),PORTRAIT_RIGHT:(new v.Quaternion).setFromAxisAngle(M.f.UP,-25*Z.Ue)};var ee=i(51263),te=i(57051),ie=i(19674),ne=i(27687),se=i(45870);const re=!0,oe=8,ae=.1,le=25,ce=500;class NavigationPoint{constructor(e,t,i,n,s){this.engine=e,this.cameraData=t,this.sweepData=i,this.viewmodeModule=n,this.raycaster=s,this.tryNavigateToPoint=async(e,t,i,n)=>{const s=[],r=[];if(s.push(ee._T()),s.push(ee._k()),t===a.n.Interpolate&&(0,G.Bw)(this.viewmodeModule.currentMode)&&this.sweepData.currentSweep){const t=.5,i=this.sweepData.currentSweep,n=this.sweepData.getSweep(i),o=n.position.clone().sub(e).normalize();s.push(ee.pI(e,o,t)),s.push(ee.T3(n)),r.push(te.o7(e,o))}s.push(this.withinLatitudeFilter(e)),s.push(this.notTooCloseFilter(e)),s.push(this.notTooFarFilter(e));r.push(te.Dv(e,-2));const o=this.sweepData.sortByScore(s,r),l=new v.Vector3;let c=null,h=!1,u=null;for(const s of o)if(this.sweepCanSeeNote(e,s.sweep)){if(u=s.sweep,t===a.n.Interpolate){l.copy(e).sub(u.position).normalize(),h=!0;const s=this.getSweepToPointRotation(u.position,e,n),r=this.cameraData.pose.projection.asThreeMatrix4(),{width:o,height:p}=this.cameraData,m=(0,ne.bD)(e,u.position,s,o,p,r);i&&i(m),c=(0,G.Bw)(this.viewmodeModule.currentMode)?this.commandBinder.issueCommand(new d.ju({transition:t||a.n.Interpolate,sweep:u.id,rotation:s})):this.viewmodeModule.switchToMode(G.Ey.Panorama,t,{rotation:s,sweepID:u.id})}break}return!(!u||!h&&t===a.n.Interpolate)&&(c||(c=this.engine.commandBinder.issueCommand(new d.ju({transition:t,transitionTime:ce,sweep:u.id,rotation:this.getSweepToPointRotation(u.position,e,n)}))),c&&await c,!0)},this.getSweepToPointRotation=(e,t,i)=>{const n=(0,$.n0)(e,t);return i&&n.multiply(i),(0,ie.Z)(n)},this.notTooCloseFilter=e=>t=>Math.abs(t.position.x-e.x)>ae||Math.abs(t.position.z-e.z)>ae,this.notTooFarFilter=e=>t=>{if(!re){return t.position.distanceTo(e)>oe}return!0},this.withinLatitudeFilter=e=>t=>{const i=(new v.Vector3).copy(e).sub(t.position),n=-Math.atan(i.y/Math.sqrt(i.x*i.x+i.z*i.z)),s=(0,Z.Id)(le);return se.zf-s<n&&n<se.uQ+s},this.commandBinder=e.commandBinder}async focusPin(e,t,i,n){const{anchorPosition:s,stemNormal:r,stemLength:o}=e,a=s.clone().add(r.clone().setLength(o));return this.focusPoint(a,t,i,n)}async focusPoint(e,t,i,n){if(this.cameraData.canTransition()&&this.sweepData.canTransition()&&!await this.tryNavigateToPoint(e,t,i,n)){if(t!==a.n.Interpolate)return this.goToNearestSweep(e,t,i,n);try{await this.commandBinder.issueCommand(new H._i(H.BD.DOLLHOUSE,a.n.Interpolate))}catch(s){await this.goToNearestSweep(e,t,i,n)}await this.tryNavigateToPoint(e,t,i,n)||await this.goToNearestSweep(e,t,i,n)}}async goToNearestSweep(e,t,i,n){const s=e,r=this.sweepData.getClosestSweep(s,!0);if(!r)throw new Error("Cannot find sweep closest to Mattertag disc");const o=this.getSweepToPointRotation(r.position,s,n),l=this.cameraData.pose.projection.asThreeMatrix4(),{width:c,height:h}=this.cameraData,u=(0,ne.bD)(s,r.position,o,c,h,l);i&&i(u),await this.commandBinder.issueCommand(new d.ju({sweep:r.id,rotation:o,transition:t||a.n.Interpolate}))}sweepCanSeeNote(e,t){const i=(new v.Vector3).copy(e).sub(t.position),n=i.length();i.normalize();let s=this.raycaster.picking.pick(t.position,i,b.Pv);return(!s||s.distance>n)&&(s=this.raycaster.picking.pick(e,i.negate(),b.Pv)),!s||n<=s.distance}}var de=i(76701),he=i(23573);class DynamicNumber extends he.T{constructor(e=1,t=0){super(),this._slowdown=!0,this._initialSpeed=0,this._speed=0,this._acceleration=1,this._desiredAcceleration=1,this._jerk=1,this._maxSpeed=1,this._minSpeed=.05,this._startValue=0,this._value=0,this._endValue=e,this._delay=t}get active(){return this._active}get currentValue(){return this._value}get endValue(){return this._endValue}get speed(){return this._speed}get isSlowingDown(){return this._isSlowingDown}get maxSpeed(){return this._maxSpeed}get acceleration(){return this._acceleration}getProgressPercent(){return(this._value-this._startValue)/(this._endValue-this._startValue)}onComplete(e){return this._onComplete=e,this}setStartValue(e){return this._startValue=e,this}setCurrentValue(e){return this._value=e,this}setEndValue(e){return this._endValue=e,this}setInitialSpeed(e){return this._initialSpeed=e,this}setMaxSpeed(e){return this._maxSpeed=e,this}setDesiredAcceleration(e){return this._desiredAcceleration=e,this._jerk=3*Math.abs(this._desiredAcceleration-this._acceleration),this}activate(e){return this._active=e,this}setAccel(e){return this._acceleration=Math.abs(e),this}start(){this._active=!0,this._value=this._startValue,this._speed=this._initialSpeed}setSlowdown(e){return this._slowdown=e,this}tick(e){if(!this._active||e<=0)return;if(this._delay>0)return void(this._delay-=e);e>33&&(e=33);const t=.001*e,i=this._value,n=this._speed*t,s=(0,ie.r_)(i,this.endValue,n),r=this._endValue-i<=this.getSlowdownDistance(),o=this._slowdown&&r,a=o?this._minSpeed:this._maxSpeed,l=this.acceleration*t;this._speed=(0,ie.r_)(this._speed,a,l),this._isSlowingDown=o;const c=this._desiredAcceleration,d=this._jerk*t;return this._acceleration=(0,ie.r_)(this._acceleration,c,d),this._value=s,s===this.endValue?(this.activate(!1),this.commit(),void(this._onComplete&&this._onComplete())):void 0}getSlowdownDistance(){const e=this.speed,t=this._acceleration,i=e/(0===t?1e-5:t);return this.speed*i+.5*t*i*i}stop(e){this._active=!1,this._endValue=e,this.commit()}}var ue=i(77719);const pe=new I.Z("walk");class NavigationWalking{constructor(e,t,i,n,s,r,o){this.cameraPose=e,this.sweepTransition=t,this.sweepControl=i,this.cameraControl=n,this.generators=s,this.navigation=r,this.active=!1,this.path=[],this.lastQueueTime=0,this.repeatedQueueDelayMS=150,this.positionTracker=(new DynamicNumber).setAccel(15).setMaxSpeed(5),this.baseTransitionTime=l.Z.camera.baseTransitionTime,this.baseTransitionSpeed=l.Z.camera.transitionSpeed,o.onPropertyChanged(ue.baseTransitionSpeedKey,(e=>{this.baseTransitionTime=e}))}get isActive(){return this.active}get targetSweep(){return this.nextSweep}setContinuousMovementDirection(e){this.continuousMovementDirection=e,!this.active&&e&&this.navigation.navigateInLocalDirection(e)}stop(){this.path.length=0,this.cameraControl.endExternalTransition(),this.startingSweep=void 0,this.nextSweep=void 0,this.active=!1,this.generator&&(this.generators.stopGenerator(this.generator),this.generator=null)}appendNode(e,t){if(!this.canQueueSweeps(e))return Promise.resolve();if(!e)return Promise.resolve();if(this.path.push(e),this.lastQueueTime=Date.now(),!this.active){this.startingSweep=t;const{generator:i,deferred:n}=this.createTransition();this.generators.startGenerator(i),this.generator=i,this.activePromise=n.nativePromise().then((()=>{this.activePromise=null})),this.positionTracker.setEndValue(this.getDistanceToSweep(e)),this.checkForSpeedIncrease(e)}return this.activePromise?this.activePromise:Promise.resolve()}canQueueSweeps(e){if(e&&this.path.indexOf(e)>=0)return!1;return!(this.path.length>=2)&&!(this.active&&Date.now()-this.lastQueueTime<this.repeatedQueueDelayMS)}attemptContinuousNavigation(){try{this.continuousMovementDirection&&this.navigation.navigateInLocalDirection(this.continuousMovementDirection)}catch(e){if(!(e instanceof NavigationException))throw pe.warn(e),e;pe.debug(e)}}createTransition(){const e=this,t=new X.Q;return{generator:function*(){e.active=!0;let i=Date.now();e.cameraControl.beginExternalTransition();const n=(new v.Vector3).copy(e.cameraPose.position),s=new v.Vector3,r=new v.Vector3,o=e.positionTracker;for(o.setMaxSpeed(5).setAccel(15);e.path.length>0;){const t=e.nextSweep?e.nextSweep.id:e.startingSweep,a=e.path.shift();if(!a){e.nextSweep=void 0;break}e.nextSweep=a,n.copy(e.cameraPose.position);const l=n.distanceTo(a.position);for(o.setStartValue(0).setEndValue(l).setInitialSpeed(o.speed).activate(!0),r.subVectors(a.position,n),r.normalize(),yield new de.M8(e.sweepControl.activateSweepUnsafe({sweepId:a.id})),e.sweepControl.beginSweepTransition({sweepId:a.id,internalProgress:!1,prevSweepId:t}),o.start(),e.checkForSpeedIncrease(a);o.active;){const t=Date.now()-i,l=0===e.path.length;let c=!1,d=!1;if(!l){const t=e.path[0];c=o.endValue-o.currentValue+a.position.distanceTo(t.position)<o.getSlowdownDistance();const i=s.subVectors(t.position,a.position);i.normalize();r.dot(i)<.3&&(d=!0)}o.setSlowdown(l||c||d),o.tick(t);const h=o.getProgressPercent();e.cameraControl.updateCameraPosition(s.lerpVectors(n,a.position,h)),e.sweepTransition.progress.modifyAnimation(h,1,0),i=Date.now(),e.continuousMovementDirection&&e.canQueueSweeps()&&o.isSlowingDown&&e.attemptContinuousNavigation(),o.active&&(yield new de.Jj)}e.sweepControl.endSweepTransition({sweepId:a.id,prevSweepId:t})}t.resolve(),e.stop()},deferred:t}}getDistanceToSweep(e){return(this.nextSweep?this.nextSweep.position:this.cameraPose.position).distanceTo(e.position)}checkForSpeedIncrease(e){const t=this.positionTracker,i=this.getDistanceToSweep(e),n=t.endValue-t.currentValue,s=n+i-t.getSlowdownDistance();if(n+i>12){const e=this.baseTransitionTime,i=this.baseTransitionSpeed,n=.001*(e+Math.log2(1+s)*ue.TRANSITION_DISTANCE_MULTIPLIER*i)-t.maxSpeed/t.acceleration,r=s/n;n>0&&t.setMaxSpeed(r).setDesiredAcceleration(3*r)}else t.setMaxSpeed(5).setDesiredAcceleration(15)}}var me=i(79437),fe=i(3248);class NavigationLabel{constructor(e,t,i,n,s,r,o){this.engine=e,this.settingsData=t,this.cameraData=i,this.cameraModule=n,this.viewmodeData=s,this.floorsViewData=r,this.toolsData=o}async enforceLabelEditorFriendlyViewmode(e){var t;let i=this.settingsData.tryGetProperty(_.Q5,!1)&&this.viewmodeData.isDollhouse();this.toolsData.activeToolName!==x.w1.LABELS&&(i&=this.settingsData.tryGetProperty(fe.gx.LabelsDollhouse,!0));let n=!0;if(await(null===(t=this.cameraData.transition.promise)||void 0===t?void 0:t.nativePromise()),!this.viewmodeData.isFloorplan()&&!i)try{await this.engine.commandBinder.issueCommand(new H._i(H.BD.FLOORPLAN,a.n.Interpolate))}catch(e){n=!1}return(e&&e!==this.floorsViewData.currentFloorId||null===this.floorsViewData.currentFloorId)&&await this.engine.commandBinder.issueCommand(new y.Vw(e||this.floorsViewData.getHighestVisibleFloorId())),n}async navigateToLabel(e){const t=await this.enforceLabelEditorFriendlyViewmode(e.floorId);return this.viewmodeData.isFloorplan()?await this.panToLabelFloorplan(e.position):this.viewmodeData.isDollhouse()&&await this.panToLabelDollhouse(e.position),t}async panToLabelDollhouse(e){this.cameraData.canTransition()||await this.cameraModule.cancelTransition();const t=new v.Box3;t.setFromCenterAndSize(new v.Vector3(0,1,0).add(e),new v.Vector3(4,4,4)),await this.engine.commandBinder.issueCommand(new d.Np({box:t}))}async panToLabelFloorplan(e){this.cameraData.canTransition()||await this.cameraModule.cancelTransition();const t=new v.Plane,i=new v.Vector3(0,0,1).applyQuaternion(this.cameraData.pose.rotation),n=e;t.setFromNormalAndCoplanarPoint(i,n);const s=(0,$.Fe)(this.cameraData.pose.position,this.cameraData.pose.rotation,t);if(!s)return;const r=(new v.Vector3).copy(n).sub(s),o=(new v.Vector3).copy(this.cameraData.pose.position).add(r);await this.cameraModule.moveTo({transitionType:a.n.Interpolate,pose:{position:o},transitionTime:1e3,easing:me.hl})}}var ge=i(26128),ve=i(15443);class Navigation extends n.Y{constructor(){super(...arguments),this.name="navigation",this.navigationEnabled=!0,this.inputOutside=[],this.navigationRules=[()=>!0],this.addNavigationRule=e=>{-1===this.navigationRules.indexOf(e)&&this.navigationRules.push(e)},this.removeNavigationRule=e=>{const t=this.navigationRules.indexOf(e);-1!==t&&this.navigationRules.splice(t,1)},this.isNavigationInputAllowed=()=>{const e=this.navigationRules.reduce(((e,t)=>e&&t()),!0);return!(!this.navigationEnabled||!e)||(this.log.debug("Cannot move while navigation is locked",{blockedByRules:!e,blockedByCommand:!this.navigationEnabled}),!1)}}async init(e,t){const{market:i}=t;this.commandBinder=t.commandBinder,this.bindings.push(this.commandBinder.addBinding(d.ZK,(async()=>this.lockNavigation())),this.commandBinder.addBinding(d.Lp,(async()=>this.unlockNavigation())),this.commandBinder.addBinding(d.Np,(async e=>this.navigateToBox(e.box))),this.commandBinder.addBinding(d.zs,(async e=>{const{focusPosition:t,transition:i,orientationAdjust:n,onSweepChosen:s}=e;return this.navigationPoint.focusPoint(t,i,s,n)})),this.commandBinder.addBinding(d.OR,(async e=>{const{pinPosition:t,transition:i,orientationAdjust:n,onSweepChosen:s}=e;return this.navigationPoint.focusPin(t,i,s,n)})),this.commandBinder.addBinding(d.ju,(e=>this.navigateToSweep(e.sweep,e.rotation,e.transition,e.transitionTime,e.transitionSpeedMultiplier))),this.commandBinder.addBinding(d.Cs,(async({position:e,floorId:t,viewmodeOnly:i})=>i?this.navigationLabel.enforceLabelEditorFriendlyViewmode():!(!e||!t)&&this.navigationLabel.navigateToLabel({position:e,floorId:t}))),this.commandBinder.addBinding(d.L4,(async e=>this.navigateToPose(e.pose)))),[this.settingsData,this.sweepData,this.sweepModule,this.viewmodeData,this.viewmodeModule,this.cameraData,this.cameraModule,this.interactionmodeData,this.meshQuery]=await Promise.all([i.waitForData(s.e),i.waitForData(V.Z),t.getModule(K.default),i.waitForData(j.O),t.getModule(q.default),i.waitForData(o.M_),t.getModuleBySymbol(r.y.CAMERA),i.waitForData(c.Z),t.getModuleBySymbol(r.y.MESH_QUERY)]);const[n,a,l]=await Promise.all([t.getModuleBySymbol(r.y.RAYCASTER),i.waitForData(Y.t),i.waitForData(W.c)]);this.navigationPoint=new NavigationPoint(t,this.cameraData,this.sweepData,this.viewmodeModule,n),this.navigationLabel=new NavigationLabel(t,this.settingsData,this.cameraData,this.cameraModule,this.viewmodeData,l,a);const h=await t.getModuleBySymbol(r.y.INPUT);this.inputOutside.push(new NavigationInputOutside(this,h,this.settingsData));const u=()=>this.isNavigationInputAllowed()&&this.viewmodeData.canStartTransition()&&!l.transitionActive&&this.sweepData.canTransition(),p=()=>u()&&(this.viewmodeData.isDollhouse()||this.viewmodeData.isFloorplan()||this.viewmodeData.isOrthographic());this.navigationDollhouse=new NavigationDollhouse(p,this.cameraData.pose,this.cameraModule),this.inputOutside.push(new NavigationInputFocus(p,t.commandBinder,h,l,this,this.navigationDollhouse,this.sweepData,this.cameraModule,a,this.settingsData,this.meshQuery)),this.inputInside=new NavigationInputInside(this,h,!!e.enableWheel),this.inputOutside.forEach((e=>this.bindings.push(...e.bindings))),this.bindings.push(...this.inputInside.bindings),this.updateInputBindings(),this.bindings.push(this.viewmodeData.makeModeChangeSubscription((()=>{this.viewmodeData.currentMode!==G.Ey.Transition&&this.updateInputBindings()}))),this.navigationWalk=new NavigationWalking(this.cameraData.pose,this.sweepData.transition,this.sweepModule,this.cameraModule,t,this,this.settingsData),t.broadcast(new ge.em(ve.Y.Navigation))}updateInputBindings(){const e=this.interactionmodeData.isVR(),t=this.viewmodeData.isInside();this.inputInside.toggleInput(t&&!e),this.inputInside.toggleVrInput(t&&e),this.inputOutside.forEach((e=>e.toggleInput(!t)))}navigateInLocalDirection(e){const t=this.cameraData.pose.rotation;return this.navigateInDirection(e.clone().applyQuaternion(t))}setContinuousNavigationLocalDirection(e){this.navigationWalk.setContinuousMovementDirection(e)}navigateTowardsIntersection(e){try{this.navigateInDirection(e.point.clone().sub(this.cameraData.pose.position))}catch(e){return!1}return!0}navigateToPanoNearIntersection(e){const t=(0,S.bG)(this.sweepData,this.viewmodeData.isInside(),e,this.meshQuery),i=t.length>0?t[0].sweep:this.sweepData.getClosestSweep(e.point,!0),n=l.y[this.interactionmodeData.mode];if(this.viewmodeData.isInside()&&i)return this.navigateToSweep(i.id,void 0,n),!0;if(this.viewmodeData.canSwitchViewMode(G.Ey.Panorama)){const e=i?i.id:void 0;return this.commandBinder.issueCommand(new H._i(H.BD.INSIDE,n,{sweepID:e})),!0}return!1}navigateInDirection(e){if(!this.viewmodeData.isInside())throw new NavigationException(u.InsideOnly);if(!this.sweepData.currentSweep)throw new NavigationException(u.InvalidSweep);const t=l.y[this.interactionmodeData.mode],i=(0,S.Tq)(this.sweepData,e,this.navigationWalk.isActive?.65:void 0,this.navigationWalk.isActive?this.navigationWalk.targetSweep:void 0);if(i.length>0&&i[0].sweep)return this.navigateToSweep(i[0].sweep.id,void 0,t);throw new NavigationException(u.NoDestinationFound)}async navigateToBox(e){return this.navigationDollhouse.navigateToBox(e)}lockNavigation(){this.navigationEnabled=!1,this.log.debug("Navigation input locked")}unlockNavigation(){this.navigationEnabled=!0,this.log.debug("Navigation input unlocked")}async navigateToSweep(e,t,i,n,s){const r=this.settingsData.tryGetProperty(z.gj,a.n.Interpolate);let o;void 0===i&&(i=r);const l=this.sweepData.currentSweep;if(i===a.n.Interpolate){const t=!l||this.sweepData.isSweepAligned(l),n=this.sweepData.isSweepAligned(e),s=l!==e,r=!t||!n,o=this.viewmodeData.isInside();s&&r&&o&&(i=a.n.FadeToBlack)}if(this.viewmodeData.isInside()){const r=void 0===t&&void 0===n&&void 0===s,l=this.cameraData.canTransition()&&this.sweepData.canTransition();if(i===a.n.Interpolate&&this.sweepData.currentSweep!==e&&r&&(l||this.navigationWalk.isActive)){const t=this.sweepData.getSweep(e);o=this.navigationWalk.appendNode(t,this.sweepData.currentSweep)}else{if(!l)return this.sweepData.currentSweep;o=this.sweepModule.moveToSweep({transitionType:i,sweepId:e,rotation:t,transitionTime:n,transitionSpeedMultiplier:s})}}else o=this.viewmodeModule.switchToMode(G.Ey.Panorama,i,{sweepID:e,rotation:t});return await o,this.sweepData.currentSweep}navigateToPose(e){const t={2:H.BD.DOLLHOUSE,3:H.BD.FLOORPLAN},{sweepIndex:i,quaternion:n,mode:s}=e;let{panoId:r,position:o}=e;if(!r&&void 0!==i){const e=this.sweepData.getSweepByIndex(i);e&&(r=e.id)}if(r)this.commandBinder.issueCommand(new d.ju({sweep:r,rotation:n,transition:a.n.FadeToBlack}));else{if(!(s in t))throw new Error("Unknown navigation link pose: "+JSON.stringify(e));this.commandBinder.issueCommand(new H._i(t[s],a.n.Interpolate,{rotation:n,position:o}))}}}},39455:(e,t,i)=>{"use strict";i.d(t,{E:()=>n});const n={longerTransitionMaxDist:10,TRANSITION_TIME_DH:650}},82088:(e,t,i)=>{"use strict";i.d(t,{Tq:()=>o,bG:()=>l});var n=i(51263),s=i(57051),r=i(39455);const o=(e,t,i,n,...s)=>a({sweepData:e,direction:t,directionFactor:i,sourceSweep:n,ignoreSweeps:s}),a=e=>{const{sweepData:t,direction:i,sourceSweep:r,ignoreSweeps:o,directionFactor:a}=e;if(!t.currentSweepObject)return[];const l=r||t.currentSweepObject,c=[n.ff(l),n._k(),n.vO(l),n.pI(l.position,i,a)];for(const e of o)c.push(n.ff(e));const d=[s.o7(l.position,i),s.TE(l.position)],h=t.getSweepNeighbours(l);return t.sortByScore(c,d,h)},l=(e,t,i,o)=>{const a=[n._k(),n._T()],l=[s.Dv(i.point)],c=e.currentSweepObject;t&&c&&a.push(n.ff(c),n.SF(c.position,r.E.longerTransitionMaxDist),n.vO(c)),i.face&&a.push(n.D5(i.point,i.face.normal));const d=o.floorIdFromObject(i.object);d&&l.push(s.Bv(d));const h=e.sortByScore(a,l);if(0===h.length){const t=e.getClosestSweep(i.point,!0);h.push({sweep:t,score:0})}return h}},39950:(e,t,i)=>{"use strict";i.d(t,{c:()=>HashtagData});var n=i(32770),s=i(75256);class HashtagData extends n.V{constructor(){super(...arguments),this.name="hashtag-data",this.hashtags=(0,s.C)([])}addHashtags(e){this.atomic((()=>{e.forEach((e=>{this.addHashtag(e)}))}))}addHashtag(e){const t=e.trim().toLowerCase();-1===this.hashtags.map((e=>e.trim().toLowerCase())).indexOf(t)&&this.hashtags.push(e)}getHashtags(){return this.hashtags.values()}}},8752:(e,t,i)=>{"use strict";var n;i.d(t,{U:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.OPEN="open",e.EDITING="editing"}(n||(n={}))},92824:(e,t,i)=>{"use strict";i.d(t,{X:()=>NotesViewData});var n=i(32770),s=i(48715),r=i(75256),o=i(44574),a=i(15881),l=i(8752),c=i(84834);class NotesViewData extends n.V{constructor(e,t,i,n){super(),this.data=e,this.textParser=t,this.backgroundTexture=i,this.maskTexture=n,this.name="notes-view-data",this.notes=(0,r.C)([]),this.noteListViewsObservable=(0,r.C)([]),this.creatingNewNote=!1,this.openNoteViewObservable=(0,s.Y)(null),this.focusedCommentObservable=(0,s.Y)(null),this.listIndexObservable=(0,s.Y)(-1),this.activeNotationObservable=(0,s.Y)(null),this.notesPhaseObservable=(0,s.Y)(l.U.CLOSED),this.notesFilterObservable=(0,s.Y)(c.$.OPEN),this.searchBlockObservable=(0,s.Y)(null),this.updateViewData(null)}getNotesList(){return this.notes}onNotesChanged(e){return this.notes.onChanged(e)}getNoteView(e){const t=this.notes.findIndex((t=>t.id===e));return-1!==t?this.notes.get(t):null}getTextParser(){return this.textParser}getComment(e,t){const i=this.getNote(e);return(null==i?void 0:i.comments.find((e=>e.id===t)))||null}getAttachment(e,t,i){var n;const s=(null===(n=this.getNote(e))||void 0===n?void 0:n.comments.find((e=>e.id===t)))||null;return(null==s?void 0:s.attachments.find((e=>e.id===i)))||null}updateViewData(e){const t=[];this.data.iterate((e=>{var i;const n=this.createNoteView(e);t.push(n),(null===(i=this.openNoteView)||void 0===i?void 0:i.id)===n.id&&this.setOpenNoteView(n)})),this.notes.replace(t);const i=this.getFilteredNotes(),n=e?this.getSearchResults(i,e):this.getNoteListViews(i);this.noteListViewsObservable.replace(n.sort(((e,t)=>t.createdTime-e.createdTime)))}createNoteView(e){return Object.assign(Object.assign({},e),{backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture})}get noteListViews(){return this.noteListViewsObservable}getFilteredNotes(){const e=this.notesFilter===c.$.ALL,t=this.notesFilter===c.$.RESOLVED,i=[];return this.notes.forEach((n=>{(e||n.resolved===t)&&i.push(n)})),i}getNoteListViews(e){return e.map((e=>{const t=e.comments.get(0);if(!t)throw new Error("No root comment in a note");return{id:e.id,text:t.text,user:e.user,color:e.color,createdTime:e.lastCommentMs,assetType:a.h.NOTE,numAttachments:t.attachments.length,numComments:e.comments.length,commentId:t.id}}))}getSearchResults(e,t){const i=[];return e.forEach((e=>{e.comments.forEach((n=>{const{text:s,user:r}=n;let l=this.getSearchSnippet(s,t);null===l&&t.blockType===o.C.USER&&t.id===r.id&&(l=this.textParser.getPlainText(s)),null!==l&&i.push({id:n.id,text:l,user:n.user,color:e.color,createdTime:n.created.getTime(),assetType:a.h.COMMENT,numAttachments:n.attachments.length,numComments:0,noteId:e.id})}))})),i}getCommentUserMentions(e,t){const i=[];return this.textParser.getUserMentions(e).forEach((e=>{const n=t[e];n&&i.push(n)})),i}getSearchSnippet(e,t){const i=this.textParser.searchMarkdown(e,t);if(!i)return null;const{textLength:n,numMatches:s,matchIndex:r,markdown:o}=i;let a=o,l=r;if(n>20&&l>0){if(1===s){const e=Math.floor((20-t.text.length)/2);e>0&&l>e&&(l-=e)}a=`...${a.substr(l)}`,a.length<20&&(l-=20-a.length,l>0&&(a=`...${o.substr(l)}`))}return a}getNote(e){const t=this.notes.findIndex((t=>t.id===e));return this.notes.get(t)}getNoteAttachments(e){const t=[],i=this.getNote(e);return i&&i.comments.forEach((e=>{t.push(...e.attachments)})),t}get isNewNote(){return this.creatingNewNote}setCreatingNote(e){this.creatingNewNote=e}getPendingNote(){return this.creatingNewNote&&this.openNoteView?this.openNoteView:null}setNotesPhase(e){this.notesPhaseObservable.value=e}get notesPhase(){return this.notesPhaseObservable.value}onNotesPhaseChanged(e){return this.notesPhaseObservable.onChanged(e)}setNotesFilter(e){this.notesFilterObservable.value=e}get notesFilter(){return this.notesFilterObservable.value}onNotesFilterChanged(e){return this.notesFilterObservable.onChanged(e)}setActiveNotation(e){this.activeNotationObservable.value=e}get activeNotation(){return this.activeNotationObservable.value}onActiveNotationChanged(e){return this.activeNotationObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setOpenNoteView(e){this.openNoteViewObservable.value=e}get openNoteView(){return this.openNoteViewObservable.value}onOpenNoteViewChanged(e){return this.openNoteViewObservable.onChanged(e)}resetOpenNoteView(){const e=this.openNoteView;if(e){const t=this.data.getNoteProperties(e.id);t&&this.updateOpenNoteView(t)}}updateOpenNoteView(e){const t=this.openNoteView;t&&Object.assign(t,e)}setFocusedComment(e){this.focusedCommentObservable.value=e}get focusedComment(){return this.focusedCommentObservable.value}onFocusedCommentChanged(e){return this.focusedCommentObservable.onChanged(e)}setSearchBlock(e){this.searchBlockObservable.value=e}get searchBlock(){return this.searchBlockObservable.value}onSearchBlockChanged(e){return this.searchBlockObservable.onChanged(e)}}},2904:(e,t,i)=>{"use strict";i.d(t,{yK:()=>NotesModeToggleCommand,yW:()=>OpenNoteToCommentCommand,VI:()=>StartNewNoteCommand,FB:()=>SaveNewNoteCommand,gc:()=>CancelNewNoteCommand,_N:()=>CloseNoteCommand,kd:()=>SaveNoteChangesCommand,oH:()=>CancelCommentChangesCommand,df:()=>ToggleNoteToolEditorCommand,oE:()=>SaveNoteAppearanceCommand,yp:()=>ResolveNoteCommand,sG:()=>DeleteNoteCommand,Zd:()=>OpenNoteListViewCommand,x4:()=>EditCommentCommand,Df:()=>AddCommentCommand,Uw:()=>UpdateCommentCommand,mH:()=>DeleteCommentCommand,av:()=>CancelCommentSearchCommand});var n=i(17386);class NotesModeToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class OpenNoteToCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,docked:t,commentId:i}}}class StartNewNoteCommand extends n.m{constructor(){super()}}class SaveNewNoteCommand extends n.m{constructor(e){super(),this.payload={text:e}}}class CancelNewNoteCommand extends n.m{constructor(){super()}}class CloseNoteCommand extends n.m{constructor(){super()}}class SaveNoteChangesCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,text:t}}}class CancelCommentChangesCommand extends n.m{}class ToggleNoteToolEditorCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SaveNoteAppearanceCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,properties:t}}}class ResolveNoteCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,resolved:t}}}class DeleteNoteCommand extends n.m{constructor(e){super(),this.payload={noteId:e}}}class OpenNoteListViewCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,isComment:t,editText:i}}}class EditCommentCommand extends n.m{constructor(e){super(),this.payload={id:e}}}class AddCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,text:t,replyId:i}}}class UpdateCommentCommand extends n.m{constructor(e,t,i){super(),this.payload={noteId:e,commentId:t,text:i}}}class DeleteCommentCommand extends n.m{constructor(e,t){super(),this.payload={noteId:e,commentId:t}}}class CancelCommentSearchCommand extends n.m{constructor(){super()}}},84834:(e,t,i)=>{"use strict";var n,s;i.d(t,{$:()=>n,Y:()=>s}),function(e){e.OPEN="open",e.RESOLVED="resolved",e.ALL="all"}(n||(n={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(s||(s={}))},23923:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AddCommentCommand:()=>ie.Df,CancelCommentChangesCommand:()=>ie.oH,CancelCommentSearchCommand:()=>ie.av,CancelNewNoteCommand:()=>ie.gc,CloseNoteCommand:()=>ie._N,Comment:()=>Comment,DeleteCommentCommand:()=>ie.mH,DeleteNoteCommand:()=>ie.sG,EditCommentCommand:()=>ie.x4,FocusCommentMessage:()=>ne.JL,HashtagData:()=>te.c,Note:()=>Note,NoteColorVariant:()=>W.Y,NoteResolutionChangeMessage:()=>ne.hY,NotesData:()=>NotesData,NotesFilter:()=>W.$,NotesModeOpenedMessage:()=>ne.Ey,NotesModeToggleCommand:()=>ie.yK,NotesPhase:()=>z.U,NotesViewData:()=>ee.X,OpenNoteListViewCommand:()=>ie.Zd,OpenNoteToCommentCommand:()=>ie.yW,ResolveNoteCommand:()=>ie.yp,SaveNewNoteCommand:()=>ie.FB,SaveNoteAppearanceCommand:()=>ie.oE,SaveNoteChangesCommand:()=>ie.kd,StartNewNoteCommand:()=>ie.VI,ToggleNoteToolEditorCommand:()=>ie.df,UpdateCommentCommand:()=>ie.Uw,default:()=>_e});var n=i(47724),s=i(44283),r=i(66223),o=i(28636),a=i(27314),l=i(10757),c=i(31278),d=i(86010),h=i(44574),u=i(79553),p=i(66157),m=i(92532),f=i(24151),g=i(89046),v=i(67166),y=i(15881),b=i(81347),S=i(61481),E=i(7683),T=i(21479),w=i(8150),x=i(75892),_=i(35597),M=i(33874),O=i(19047),A=i(26627),C=i(27326),P=i(51764),D=i(46114),N=i(29422),I=i(38321),L=i(42835),R=i(32025),k=i(48470),U=i(6460),B=i(90662),F=i(19980),V=i(91028),H=i(94536),j=i(96168),G=i(95836),z=i(8752),W=i(84834),K=i(2212),Y=i(23573),q=i(75256),Z=i(49747),$=i(87182);class Note extends Y.T{constructor(e){super(),this.id="",this.color=$.Rn,this.anchorPosition=new K.Vector3,this.stemNormal=new K.Vector3,this.stemLength=$.ZP.stem.length,this.stemEnabled=!0,this.created=new Date,this.modified=new Date,this.lastCommentMs=(new Date).getTime(),this.resolved=!1,this.user=(0,Z.Q)(""),this.comments=(0,q.C)([]),e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.resolved=e.resolved,this.color=e.color,this.floorId=e.floorId,this.roomId=e.roomId,this.anchorPosition.copy(e.anchorPosition),this.stemNormal.copy(e.stemNormal),this.stemLength=e.stemLength,this.stemEnabled=e.stemEnabled,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.lastCommentMs=e.lastCommentMs,this.comments.replace(e.comments.values()),this.commit(),this}getComment(e){return this.comments.find((t=>t.id===e))||null}updateComment(e){const t=this.comments.findIndex((t=>t.id===e.id));-1!==t&&(e.assetId=this.id,this.comments.update(t,e))}}var Q=i(32770),X=i(64781);class NotesData extends Q.V{constructor(e){super(),this.name="notes-data",this.notes=(0,X.q)(e)}iterate(e){for(const t of this.notes)e(t)}updateNote(e){this.notes.has(e.id)?this.notes.get(e.id).copy(e):this.notes.set(e.id,e)}updateNoteProperties(e,t){if(this.notes.has(e)){const i=this.notes.get(e);let n=!1;void 0!==t.resolved&&t.resolved!==i.resolved&&(i.resolved=t.resolved,n=!0),void 0!==t.color&&t.color!==i.color&&(i.color=t.color,n=!0),void 0!==t.anchorPosition&&t.anchorPosition!==i.anchorPosition&&(i.anchorPosition=t.anchorPosition,n=!0),void 0!==t.stemNormal&&t.stemNormal!==i.stemNormal&&(i.stemNormal=t.stemNormal,n=!0),void 0!==t.stemLength&&t.stemLength!==i.stemLength&&(i.stemLength=t.stemLength,n=!0),void 0!==t.stemEnabled&&t.stemEnabled!==i.stemEnabled&&(i.stemEnabled=t.stemEnabled,n=!0),void 0!==t.floorId&&t.floorId!==i.floorId&&(i.floorId=t.floorId,n=!0),void 0!==t.roomId&&t.roomId!==i.roomId&&(i.roomId=t.roomId,n=!0),n&&i.commit()}}removeNote(e){this.notes.has(e)&&(this.notes.delete(e),this.commit())}getNote(e){return this.notes.get(e)}getNoteProperties(e){const t=this.notes.get(e);if(!t)return null;return Object.assign({},t)}get collection(){return this.notes}}var J,ee=i(92824),te=i(39950),ie=i(2904),ne=i(76495),se=i(94474),re=i(36651),oe=i(88512),ae=i(45631),le=i(78230);!function(e){e.RESOLVED="resolved",e.OPEN="open"}(J||(J={}));var ce=i(80680),de=i(19674);const he=new oe.Z("mds-note-serialize");class MdsNoteCreateSerializer{constructor(){this.getNoteDetails=(e,t)=>{const i={enabled:!0,floorId:"",roomId:void 0};void 0!==e.floorId&&""!==e.floorId&&(i.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(i.roomId=e.roomId),void 0!==e.color&&""!==e.color&&(i.color=e.color),void 0!==e.stemEnabled&&(i.stemEnabled=e.stemEnabled),void 0!==e.stemLength&&(i.stemLength=e.stemLength),void 0!==e.anchorPosition&&(0,ce.u)(e.anchorPosition)&&(i.anchorPosition=de.ep.toVisionVector(e.anchorPosition)),void 0!==e.stemNormal&&(0,ce.u)(e.stemNormal)&&(i.stemNormal=de.ep.toVisionVector(e.stemNormal)),void 0!==e.resolved&&(i.resolution=e.resolved?J.RESOLVED:J.OPEN);const n={text:t};return i.comment=n,Object.keys(i).length>0?i:null},this.validate=e=>{if(!e)return!1;const t=["floorId","roomId","enabled"].filter((t=>!(t in e))),i=0===t.length,n=!!e.floorId&&"string"==typeof e.floorId,s=!!e.anchorPosition&&(0,ce.u)(e.anchorPosition),r=i&&n&&s;return r||he.debug("Note invalid:",{missingFields:t,validPosition:s}),r}}serialize(e,t){const i=this.getNoteDetails(e,t);return this.validate(i)?i:null}}class MdsNotePatchSerializer{constructor(){this.getNotePatch=e=>{if(!e)return null;const t={};return void 0!==e.floorId&&""!==e.floorId&&(t.floorId=e.floorId),void 0!==e.roomId&&""!==e.roomId&&(t.roomId=e.roomId),void 0!==e.color&&""!==e.color&&(t.color=e.color),void 0!==e.stemEnabled&&(t.stemEnabled=e.stemEnabled),void 0!==e.stemLength&&(t.stemLength=e.stemLength),void 0!==e.anchorPosition&&(0,ce.u)(e.anchorPosition)&&(t.anchorPosition=de.ep.toVisionVector(e.anchorPosition)),void 0!==e.stemNormal&&(0,ce.u)(e.stemNormal)&&(t.stemNormal=de.ep.toVisionVector(e.stemNormal.normalize())),Object.keys(t).length>0?t:null},this.validate=e=>{if(!e)return!1;const t=["floorId","roomId","color","anchorPosition","stemNormal","stemLength","stemEnabled","stemNormal","enabled"];return Object.keys(e).every((e=>t.includes(e)))}}serialize(e){const t=this.getNotePatch(e);return t&&this.validate(t)?t:null}}var ue=i(31879);const pe=new oe.Z("mds-note-deserializer");class MdsNoteDeserializer{constructor(e,t){this.commentDeserializer=e,this.userData=t,this.validate=e=>{if(!e)return!1;const t=["id","created","modified","floor","resolution"].filter((t=>!(t in e))),i=0===t.length,n=!(!e.floor||!e.floor.id);return i&&n||pe.debug("Note invalid:",{missingFields:t,validFloor:n}),i&&n}}deserialize(e){if(!e||!this.validate(e))return pe.debug("Deserialized invalid Note data from MDS",e),null;const t=new Note;t.id=e.id,t.floorId=e.floor.id,e.room&&e.room.id&&(t.roomId=e.room.id),t.resolved=e.resolution===J.RESOLVED,t.created=(0,ue.p)(e.created),t.modified=(0,ue.p)(e.modified),t.user=this.userData.loadContributor(e.createdBy),t.lastCommentMs=(0,ue.p)(e.lastCommentAt).getTime();const i=this.deserializeComments(e);if(!(i.length>0))return pe.error("Note without a comment:",t.id),null;t.comments.replace(i),e.color&&(t.color=e.color);const n=e.anchorPosition?de.ep.fromVisionVector(e.anchorPosition):void 0;n&&(t.anchorPosition=n),void 0!==e.stemLength&&(t.stemLength=e.stemLength);const s=e.stemNormal?de.ep.fromVisionVector(e.stemNormal):void 0;return s?(t.stemNormal=s,t.stemEnabled=!!e.stemEnabled):(t.stemNormal=new K.Vector3(0,0,0),t.stemEnabled=!!e.stemEnabled),t}deserializeComments(e){const t=(0,re.q)(e,"comments.results")||[],i=[];return t.forEach((t=>{const n=this.commentDeserializer.deserialize(t);n&&(n.assetId=e.id,n.assetType=y.h.NOTE,i.push(n))})),i}}class MdsCommentSerializer{constructor(){this.validate=e=>!!e}serialize(e){if(void 0===e.text)return null;const t={text:e.text};return t&&this.validate(t)?t:null}}class Comment extends Y.T{constructor(e){super(),this.id="",this.assetId="",this.assetType=y.h.NOTE,this.text="",this.user=(0,Z.Q)(""),this.created=new Date,this.modified=new Date,this.edited=!1,this.attachments=(0,q.C)([]),e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.user=e.user,this.assetId=e.assetId,this.assetType=e.assetType,this.created.setTime(e.created.getTime()),this.modified.setTime(e.modified.getTime()),this.text=e.text,this.edited=e.edited,this.attachments=e.attachments,this.commit(),this}}const me=new oe.Z("mds-comment-deserializer");class MdsCommentDeserializer{constructor(e,t,i){this.fileDeserializer=e,this.embedDeserializer=t,this.userData=i}deserialize(e){if(!e||!this.validate(e))return me.debug("Deserialized invalid Comment data from MDS",e),null;const t=new Comment;t.id=e.id,t.created=(0,ue.p)(e.created),t.modified=(0,ue.p)(e.modified),e.text&&(t.text=e.text),t.edited=e.edited,t.user=this.userData.loadContributor(e.createdBy);const i=this.deserializeExternalAttachments(e),n=this.deserializeFileAttachments(e),s=i.concat(n).sort(((e,t)=>e.created.getTime()-t.created.getTime()));return s.length>0&&t.attachments.replace(s),t}deserializeExternalAttachments(e){const t=(0,re.q)(e,"externalAttachments")||[],i=[];return t.forEach((t=>{const n=this.embedDeserializer.deserialize(t);n&&(n.parentId=e.id,n.parentType=v.u.COMMENT,i.push(n))})),i}deserializeFileAttachments(e){const t=(0,re.q)(e,"fileAttachments")||[],i=[];return t.forEach((t=>{const n=this.fileDeserializer.deserialize(t);n&&(n.parentId=e.id,n.parentType=v.u.COMMENT,i.push(n))})),i}validate(e){if(!e)return!1;const t=["id","created","modified","edited","createdBy"].filter((t=>!(t in e))),i=0===t.length;return i||me.debug("Comment invalid:",{missingFields:t}),i}}var fe=i(11764),ge=i(70129);const ve=new oe.Z("MdsNoteStore");class MdsNoteStore extends se.u{constructor(e,t){super(e),this.userData=t,this.prefetchKey="data.model.notes",this.embedDeserializer=new ae.d,this.fileDeserializer=new le.O,this.commentDeserializer=new MdsCommentDeserializer(this.fileDeserializer,this.embedDeserializer,this.userData),this.deserializer=new MdsNoteDeserializer(this.commentDeserializer,this.userData),this.createSerializer=new MdsNoteCreateSerializer,this.patchSerializer=new MdsNotePatchSerializer,this.commentSerializer=new MdsCommentSerializer}read(e){const t={modelId:this.getViewId()};return this.query(fe.GetNotes,t,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.notes;if(!n||!Array.isArray(n))return{};const s=[];for(const e of n){const t=this.deserializer.deserialize(e);t&&s.push(t)}return s.reduce(((e,t)=>(e[t.id]=t,e)),{})}))}async readNote(e,t){const i={modelId:this.getViewId(),ids:[e]};return this.query(fe.GetNotes,i,t).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.notes;return n&&Array.isArray(n)&&1===n.length?this.deserializer.deserialize(n[0]):null}))}async create(e,t){const i=this.getViewId(),n=this.createSerializer.serialize(e,t);if(!n)throw ve.error("Failure creating note:",e.id,e),new Error("Could not create Note");return this.mutate(fe.AddNote,{modelId:i,data:n}).then((e=>this.deserializer.deserialize((0,re.q)(e,"data.addNote"))))}async update(e){const t=this.getViewId(),i=e.id,n=this.patchSerializer.serialize(e);if(!n)throw ve.error("Failure updating note:",i),new Error("Could not update Note");return this.mutate(fe.PatchNote,{modelId:t,noteId:i,data:n}).then((e=>this.deserializer.deserialize((0,re.q)(e,"data.patchNote"))))}async updateResolution(e,t){const i=this.getViewId(),n=t?fe.ResolveNote:fe.ReopenNote,s=t?"data.resolveNote":"data.reopenNote";return this.mutate(n,{modelId:i,noteId:e}).then((e=>(0,re.q)(e,s)))}async delete(e){const t=this.getViewId();return Promise.all(e.map((e=>{if(!e||e&&!e.id)throw new Error("MdsNoteStore.delete failed");return this.mutate(fe.DeleteNote,{modelId:t,noteId:e.id})})))}async createComment(e,t){const i=this.getViewId(),n=this.commentSerializer.serialize(t);if(!n)throw ve.error("Failure creating comment:",t),new Error("Could not create Comment");return this.mutate(fe.AddNoteComment,{modelId:i,noteId:e,data:n}).then((e=>this.commentDeserializer.deserialize((0,re.q)(e,"data.addNoteComment"))))}async updateComment(e){const t=this.getViewId(),i=e.id,n=this.commentSerializer.serialize(e);if(!n)throw ve.error("Failure updating comment:",i),new Error("Could not update Comment");return this.mutate(ge.PatchComment,{modelId:t,commentId:i,data:n}).then((e=>(ve.debug(Object.assign({type:"PatchComment"},e)),this.commentDeserializer.deserialize((0,re.q)(e,"data.patchComment")))))}async deleteComment(e){const t=this.getViewId();if(!e||e&&!e.id)throw new Error("MdsNoteStore.deleteComment failed");return this.mutate(ge.DeleteComment,{modelId:t,commentId:e.id})}}var ye=i(17490),be=i(10882),Se=i(4141),Ee=i(13789);const{SEARCH:Te}=Ee.Z.SHOWCASE;class CommentSearchResultItem extends Se.K{constructor(e,t,i,n){super(e),this.comment=t,this.note=i,this.textParser=n,this.id=this.comment.id,this.title=this.comment.user.name,this.description=this.textParser.getPlainText(this.comment.text),this.icon="icon-comment",this.groupPhraseKey=Te.NOTE_GROUP_HEADER,this.floorId=this.note.floorId,this.color=this.note.color,this.onSelect=async()=>{super.onSelect(),this.commandBinder.issueCommand(new ie.yW(this.note.id,!1,this.id))}}}var we=i(62644);const xe="MP_NOTE_SEARCH_GROUP";class NotesModule extends n.Y{constructor(){super(...arguments),this.name="notes",this.activated=!1,this.registered=!1,this.activeBindings=[],this.refreshPromise=null,this.pollOnNotes=()=>{let e;return(0,s.k1)((()=>{clearInterval(e),e=window.setInterval((()=>{this.refreshNotes()}),1e3*$.GR)}),(()=>{window.clearInterval(e)}),!0)},this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty($.Mp,!1),t=!this.in360View(),i=!this.interactionmodeData.isVR(),n=t&&i&&e,s=n?this.getFilteredNoteIds(!1):[];this.engine.commandBinder.issueCommand(new I.kb(L.Er.NOTE,n?1:0,s))},this.userOpenedNotesMode=()=>{this.toolsData.setToolAccess(u.X$.TOOL)},this.toggleNotesMode=async e=>{e.opened?this.activateTool():this.deactivateTool()},this.togglePinAssetEditor=async e=>{this.viewData.setActiveNotation(null),e.opened?this.changeNotesPhase(z.U.EDITING):this.viewData.notesPhase===z.U.EDITING&&this.changeNotesPhase(z.U.OPEN)},this.openNoteToComment=async e=>{const{noteId:t,commentId:i,docked:n}=e,s=this.viewData,r=s.getNoteView(t);if(!r)return;const{notesFilter:o}=s,a=o===W.$.RESOLVED;o!==W.$.ALL&&(null==r?void 0:r.resolved)!==a&&s.setNotesFilter(W.$.ALL),this.setFocusedNoteComment(r,i),await this.openNote(t,c.n.FadeToBlack,n),this.openAnnotation(t,n)},this.onAppChange=()=>{this.deactivateTool(),this.updatePerSettings()},this.onNotesPhaseChanged=()=>{let e=!0;const t=this.toolsData.toolPanelLayout===u.wS.BOTTOM_PANEL;switch(this.viewData.notesPhase){case z.U.EDITING:case z.U.CREATING:e=!1;break;case z.U.OPENING:case z.U.OPEN:e=!t}this.engine.broadcast(new p.ps(e))},this.changeNotesPhase=e=>{e!==this.viewData.notesPhase&&this.viewData.setNotesPhase(e)},this.onCloseNote=async()=>{this.closeNote()},this.pinAddCancelled=e=>{e.pinType===L.Er.NOTE&&this.cancelNoteCreation(!1)},this.onCancelNewNote=async()=>{this.cancelNoteCreation(!0)},this.cancelNoteCreation=e=>{const t=this.viewData;this.userData.isCommenter()&&(e&&t.openNoteView&&this.engine.commandBinder.issueCommand(new I.tT(t.openNoteView.id,L.Er.NOTE)),this.engine.broadcast(new p.A),this.cancelAttachmentChanges(),t.setActiveNotation(null),t.setOpenNoteView(null),t.setFocusedComment(null),t.setCreatingNote(!1),this.changeNotesPhase(z.U.IDLE))},this.noteWasAdded=(e,t)=>{this.updateNotePin(e)},this.noteWasUpdated=(e,t)=>{this.updateNotePin(e)},this.updateNotes=()=>{this.activated&&(this.parseNotes(),this.updateNoteViewData()),this.displayNotes()},this.onNoteFilterChanged=()=>{this.viewData.setOpenNoteView(null),this.viewData.setFocusedComment(null),this.updateNoteViewData(),this.displayNotes()},this.onSearchBlockChanged=()=>{this.closeNote(),this.updateNoteViewData()},this.onViewModeOrFloorChanged=()=>{this.updatePerSettings()},this.onOpenNoteViewChanged=()=>{const e=this.viewData.openNoteView;e&&this.updateNotePin(e)},this.startNoteCreation=async()=>{if(!this.userData.isCommenter())return;const e=this.viewData;let t=(0,l.O1)(11);for(;this.notesData.getNote(t);)t=(0,l.O1)(11);const i=new Note;i.user=this.userData.getCurrentUser(),i.id=t,i.floorId=this.floorsViewData.getHighestVisibleFloor().id;const n=e.createNoteView(i);e.setCreatingNote(!0),this.changeNotesPhase(z.U.CREATING),e.setOpenNoteView(n),e.setFocusedComment(null),this.engine.commandBinder.issueCommand(new I.fM(i.id,n,L.Er.NOTE,n.backgroundTexture,n.maskTexture)),this.engine.commandBinder.issueCommand(new ie.av)},this.saveNewNote=async e=>{if(!this.userData.isCommenter())return;const{text:t}=e,i=this.viewData,n=i.getPendingNote();if(n){const e=await this.store.create(n,t);if(!e)return void this.log.error("MDS Note saved failed");const s=e.comments.get(0);if(!s)throw new Error("No root comment in the new note");const r=await this.confirmAttachmentChanges(s.id,n.id);this.notesData.updateNote(e),r&&await this.refreshNote(e.id),this.parseMarkdown(t),i.setOpenNoteView(i.getNoteView(e.id));const o=i.openNoteView;if(o){const t=(0,H.C)(this.userData,U.J.NOTE,o.user);this.engine.commandBinder.issueCommand(new I.Ar(e.id,L.Er.NOTE,t)),this.engine.commandBinder.issueCommand(new I.OL(n.id,L.Er.NOTE))}i.setActiveNotation(null),i.setCreatingNote(!1),this.updateNoteViewData(),i.setListIndex(this.getListIndex(e.id,y.h.NOTE))}else this.log.debug("No pending note")},this.pinMoved=e=>{const{id:t,pinType:i,pinPos:n}=e,s=this.viewData.openNoteView;if(s&&i===L.Er.NOTE&&t===s.id){if(this.notesData.getNote(t)){const{anchorPosition:e,stemNormal:i,floorId:s,roomId:r}=n;this.store.update({id:t,anchorPosition:e,stemNormal:i,floorId:s,roomId:r}).then((e=>{e&&this.notesData.updateNote(e)}))}else this.log.debug("Cannot move a non-existent note")}},this.pinPlaced=e=>{const t=this.viewData.openNoteView;t&&e.pinType===L.Er.NOTE&&e.id===t.id&&(this.viewData.updateOpenNoteView(e.pinPos),this.changeNotesPhase(z.U.OPEN),this.viewData.setActiveNotation(t.id),this.engine.broadcast(new p.ro))},this.onPinUnselected=e=>{const{openNoteView:t,notesPhase:i,activeNotation:n}=this.viewData;n||t&&e.pinType===L.Er.NOTE&&e.id===t.id&&(i===z.U.CLOSED||this.appData.application===T.Mx.WORKSHOP?this.closeNote():i!==z.U.OPEN&&i!==z.U.IDLE||this.engine.commandBinder.issueCommand(new m.tT(u.w1.NOTES,!1)))},this.handleOpeningFromList=async e=>{const t=this.viewData,i=t.noteListViews.values(),{id:n,editText:s,isComment:r}=e,o=i.findIndex((e=>{const t=e.assetType===y.h.COMMENT===r;return e.id===n&&t}));if(-1===o)return void this.log.debug("note/comment id not in list");const a=i[o];if(!a)return void this.log.debug("Cannot open non-existent list view");const l=this.toolsData.toolPanelLayout===u.wS.SIDE_PANEL?c.n.FadeToBlack:c.n.Instant,d=r?n:a.commentId,h=r?a.noteId:n,p=h&&t.getNoteView(h);h&&p?(this.setFocusedNoteComment(p,d),await this.dockNote(h,l,o,s),this.openAnnotation(h,!0)):this.log.debug("cannot find note to open")},this.onEditComment=async e=>{this.viewData.setActiveNotation(e.id)},this.handlePinHoverChangeMessage=e=>{const{openNoteView:t,isNewNote:i}=this.viewData;if(i)return;const{id:n,pinType:s,hovering:r}=e,{dockedAnnotation:o}=this.annotationsViewData,a=t&&t.id===(null==o?void 0:o.id);if(r&&t&&!a&&n!==t.id&&this.closeNote(),s!==L.Er.NOTE)return;const{commandBinder:l}=this.engine;let c=this.viewData.getNoteView(n);r?(c||this.activated||(this.updateNoteViewData(),c=this.viewData.getNoteView(n)),c&&c.id!==(null==t?void 0:t.id)&&l.issueCommand(new B.Kw(c.id,U.J.NOTE))):c&&c.id!==(null==t?void 0:t.id)&&l.issueCommand(new B.Aj(c.id,U.J.NOTE))},this.handleAnnotationClosed=e=>{var t;e.annotationType===U.J.NOTE&&(null===(t=this.viewData.openNoteView)||void 0===t?void 0:t.id)===e.id&&this.closeNote()},this.handleAnnotationOpening=e=>{var t;const{id:i,annotationType:n,docked:s}=e;if(n!==U.J.NOTE)return void this.closeNote();const r=null===(t=this.viewData.focusedComment)||void 0===t?void 0:t.id;r&&!this.viewData.getComment(i,r)&&this.viewData.setFocusedComment(null),this.openNote(i,null,s)},this.handlePinSelection=async e=>{const{id:t,pinType:i}=e;this.viewData.activeNotation||(i===L.Er.NOTE?(this.viewData.setFocusedComment(null),await this.dockNote(t,c.n.Interpolate),this.openAnnotation(t,!0)):this.closeNote())},this.handleViewingAttachment=e=>{const{annotationType:t,id:i,attachmentId:n}=e;if(t!==U.J.NOTE)return;const s=this.viewData.getNoteAttachments(i),r=s.find((e=>e.id===n));if(r&&(0,G.lV)(r)){const e=s.filter((e=>(0,G.lV)(e)));this.engine.commandBinder.issueCommand(new j.xW(!0,e,n))}},this.deleteNote=async e=>{const t=e.noteId,i=this.notesData.getNote(t);if(i){this.engine.commandBinder.issueCommand(new g.rE),this.store.delete([i]),this.notesData.removeNote(t);const e=this.viewData.openNoteView;e&&e.id===t&&this.closeNote(),this.engine.commandBinder.issueCommand(new I.OL(t,L.Er.NOTE))}else this.log.debug("Cannot delete a non-existent note")},this.onResolveNoteCommand=async e=>{const{noteId:t,resolved:i}=e;i?this.resolveNote(t):this.reopenNote(t)},this.onSaveNoteChanges=async e=>{const{noteId:t,text:i}=e,n=this.notesData.getNote(t);if(n){const e=n.comments.get(0);if(e)return this.updateNoteComment(t,e.id,i);this.log.warn("no root comment")}else this.log.debug("Cannot update a non-existent note")},this.cancelCommentChanges=async e=>{this.cancelAttachmentChanges(),this.viewData.setActiveNotation(null)},this.saveNoteAppearance=async e=>{const t=this.notesData,{noteId:i,properties:n}=e;if(t.getNote(i)){const e=this.viewData,{openNoteView:s}=e;if(Object.keys(n)){const r=await this.store.update(Object.assign({id:i},n));r&&(this.updateNotePin(r),t.updateNote(r),(null==s?void 0:s.id)===i&&e.updateOpenNoteView(n))}}else this.log.debug("Cannot update a non-existent note")},this.addComment=async e=>{const{noteId:t,text:i,replyId:n}=e,s=this.notesData.getNote(t);if(s){s.resolved&&(this.viewData.setNotesFilter(W.$.ALL),this.reopenNote(s.id));const e=await this.store.createComment(t,{text:i});return e?(this.viewData.setActiveNotation(null),this.parseMarkdown(i),await this.confirmAttachmentChanges(e.id,n),await this.refreshNote(s.id),this.refreshNotes(),e):(this.log.error("Cannot create MDS comment"),null)}return this.log.debug("Cannot add a comment to a non-existent note"),null},this.onUpdateComment=async e=>{const{noteId:t,commentId:i,text:n}=e;return this.updateNoteComment(t,i,n)},this.deleteComment=async e=>{const{commentId:t,noteId:i}=e,n=this.notesData.getNote(i);if(n){const e=n.getComment(t);e&&await this.store.deleteComment(e),this.refreshNotes()}else this.log.debug("Cannot delete a comment in a non-existent note")},this.cancelSearch=async()=>{this.viewData.searchBlock&&this.viewData.setSearchBlock(null)},this.notationBlockClicked=e=>{const{annotationType:t,block:i}=e;t===U.J.NOTE&&(i.blockType!==h.C.USER&&i.blockType!==h.C.HASH||this.viewData.setSearchBlock(i))}}async init(e,t){const[i,n,s]=await Promise.all([t.market.waitForData(M.e),t.market.waitForData(O.Z),t.market.waitForData(b.m)]);if(!s.isLoggedIn()||n.isVR()||!i.tryGetProperty($.IA,!1))return;this.engine=t,this.config=e,this.interactionmodeData=n,this.userData=s,this.settingsData=i;const[l,c,h,u,p,m,g]=await Promise.all([t.market.waitForData(T.pu),t.market.waitForData(f.t),t.market.waitForData(x.Z),t.market.waitForData(_.O),t.market.waitForData(A.i),t.market.waitForData(C.c),t.market.waitForData(F.A)]);this.appData=l,this.toolsData=c,this.sweepData=h,this.viewmodeData=u,this.floorsViewData=m,this.annotationsViewData=g,this.store=this.getStore(p);const v=await this.store.read();this.notesData=new NotesData(v||{}),t.market.register(this,NotesData,this.notesData),this.textParser=new d.v({links:!0,hashtags:!0,users:this.userData}),this.maskTexture=(0,r.p)(a),this.backgroundTexture=(0,r.p)(o),this.viewData=new ee.X(this.notesData,this.textParser,this.backgroundTexture,this.maskTexture),this.hashtagData=new te.c,t.market.register(this,te.c,this.hashtagData),await t.market.waitForData(R.B),this.bindings.push(i.onPropertyChanged($.Mp,this.updatePerSettings),t.commandBinder.addBinding(ie.yK,this.toggleNotesMode),t.subscribe(k.Q4,this.handlePinSelection),t.subscribe(k.tP,this.handlePinHoverChangeMessage),t.subscribe(k.WM,this.onPinUnselected),t.subscribe(V.do,this.handleAnnotationOpening),t.subscribe(V.Ps,this.handleAnnotationClosed),t.subscribe(V.qk,this.handleViewingAttachment),t.commandBinder.addBinding(ie.yW,this.openNoteToComment),t.subscribe(w.bS,this.onAppChange),u.makeModeChangeSubscription(this.onViewModeOrFloorChanged),m.makeFloorChangeSubscription(this.onViewModeOrFloorChanged),t.subscribe(P.Z,this.updatePerSettings),t.subscribe(D.m,this.updatePerSettings),t.subscribe(ne.Ey,this.userOpenedNotesMode),this.pollOnNotes()),t.market.register(this,ee.X,this.viewData),this.updatePerSettings(),this.displayNotes(),this.parseNotes(),async function(e,t,i,n,s){const r=await e.market.waitForData(T.pu),o=n=>{const s=[];return t.iterate((t=>{if(t.resolved)return;let r=0;t.comments.forEach((o=>{n(o.user.name,i.getPlainText(o.text))&&(r+=1,s.push(new CommentSearchResultItem(e.commandBinder,o,t,i)))}));const o=r>0;e.commandBinder.issueCommand(new I.ik(t.id,L.Er.NOTE,o))})),s},a=new be.u(s,{[$.Mp]:!0}),l=e=>new ye.V(t.onChanged(e),n.onChanged(e)),c={renew:()=>{e.commandBinder.issueCommandWhenBound(new we.c6({id:xe,getSimpleMatches:o,registerChangeObserver:l,onActivatedChanged:a.toggle}))},cancel:()=>{e.commandBinder.issueCommandWhenBound(new we.Pe(xe))}},d=()=>{const e=r.application===T.Mx.WORKSHOP;s.tryGetProperty($.IA,!1)||e?c.renew():c.cancel()},h=r.onPropertyChanged("application",d),u=s.onPropertyChanged($.IA,d);return d(),new ye.V(c,h,u)}(t,this.notesData,this.textParser,this.userData,this.settingsData).then((e=>this.bindings.push(e)))}dispose(e){this.deactivateTool(),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.engine.commandBinder.issueCommand(new I.zM(L.Er.NOTE)),this.maskTexture.dispose(),this.backgroundTexture.dispose(),this.cancelSearch(),super.dispose(e)}onUpdate(){}async refreshNotes(){var e;if(this.refreshPromise)return;const t=this.viewData,{isNewNote:i,notesPhase:n}=t;if(i||n===z.U.EDITING)return;this.refreshPromise=this.store.read().finally((()=>{this.refreshPromise=null}));const s=await this.refreshPromise,r=Object.values(s),o=null===(e=t.openNoteView)||void 0===e?void 0:e.id,{collection:a}=this.notesData;this.notesData.atomic((()=>{const e=a.keys.filter((e=>!s[e]));e.length&&e.forEach((e=>{e===o&&(this.log.debug("Open note was deleted"),t.setOpenNoteView(null),t.setFocusedComment(null),t.setActiveNotation(null)),a.delete(e)})),r.length&&r.forEach((e=>{this.notesData.updateNote(e)}))}))}async refreshNote(e){if(this.refreshPromise)return;const t=await this.store.readNote(e);t&&(this.notesData.updateNote(t),this.updateNotePin(t))}activateTool(){this.activated||(this.config.workshop&&this.appData.application===T.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new g.Mn(!1)),this.userData.isCommenter()&&this.engine.commandBinder.issueCommand(new I.Ki(!0)),this.changeNotesPhase(z.U.IDLE),this.updateNoteViewData(),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(e){var t;if(!this.activated)return;const{isNewNote:i,openNoteView:n}=this.viewData,s=(null===(t=this.annotationsViewData.dockedAnnotation)||void 0===t?void 0:t.annotationType)===U.J.NOTE;i?this.cancelNoteCreation(!0):n&&(e||s)&&this.closeNote(),this.viewData.setSearchBlock(null),this.changeNotesPhase(z.U.CLOSED),this.engine.commandBinder.issueCommand(new I.Ki(!1)),this.config.workshop&&this.appData.application===T.Mx.WORKSHOP&&this.engine.commandBinder.issueCommand(new g.Mn(!0)),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}getStore(e){const{modelId:t,baseUrl:i,readonly:n}=this.config;return new MdsNoteStore({readonly:n,includeDisabled:!0,baseUrl:i,viewId:t},this.userData)}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.engine.subscribe(k.b0,this.pinPlaced),this.engine.subscribe(k.bV,this.pinMoved),this.engine.subscribe(k.hu,this.pinAddCancelled),this.engine.subscribe(V.iP,this.notationBlockClicked),e.addBinding(ie.VI,this.startNoteCreation),e.addBinding(ie.FB,this.saveNewNote),e.addBinding(ie.gc,this.onCancelNewNote),e.addBinding(ie._N,this.onCloseNote),e.addBinding(ie.kd,this.onSaveNoteChanges),e.addBinding(ie.oH,this.cancelCommentChanges),e.addBinding(ie.Zd,this.handleOpeningFromList),e.addBinding(ie.x4,this.onEditComment),e.addBinding(ie.sG,this.deleteNote),e.addBinding(ie.yp,this.onResolveNoteCommand),e.addBinding(ie.Df,this.addComment),e.addBinding(ie.Uw,this.onUpdateComment),e.addBinding(ie.mH,this.deleteComment),e.addBinding(ie.oE,this.saveNoteAppearance),e.addBinding(ie.df,this.togglePinAssetEditor),e.addBinding(ie.av,this.cancelSearch),this.viewData.onSearchBlockChanged(this.onSearchBlockChanged),this.viewData.onNotesFilterChanged(this.onNoteFilterChanged),this.viewData.onOpenNoteViewChanged(this.onOpenNoteViewChanged),this.viewData.onNotesPhaseChanged(this.onNotesPhaseChanged),this.notesData.onChanged(this.updateNotes),this.notesData.collection.onElementChanged({onAdded:this.noteWasAdded,onUpdated:this.noteWasUpdated})),this.registered=!0}async parseNotes(){const e=[],t=[];return this.notesData.iterate((i=>{i.comments.forEach((i=>{const n=this.getUserMentionsAndHashtags(i.text);n.emails.forEach((t=>{e.push({email:t,userStatus:S.J.MENTIONED})})),t.push(...n.hashtags)}))})),this.hashtagData.addHashtags(t),this.engine.commandBinder.issueCommand(new E.Vu(e))}async parseMarkdown(e){const t=[],i=this.getUserMentionsAndHashtags(e);return i.emails.forEach((e=>{t.push({email:e,userStatus:S.J.MENTIONED})})),this.hashtagData.addHashtags(i.hashtags),this.engine.commandBinder.issueCommand(new E.Vu(t))}getUserMentionsAndHashtags(e){const t=[],i=[];for(const n of this.textParser.parse(e))n.blockType===h.C.USER&&n.value?t.push(n.value):n.blockType===h.C.HASH&&i.push(n.text);return{emails:t,hashtags:i}}openAnnotation(e,t){t?this.engine.commandBinder.issueCommand(new B.bd(e,U.J.NOTE)):this.engine.commandBinder.issueCommand(new B.oM(e,U.J.NOTE))}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isInside()&&this.sweepData.isSweepUnaligned(e)}async closeNote(){const{commandBinder:e}=this.engine,{openNoteView:t,notesPhase:i}=this.viewData;if(this.viewData.setActiveNotation(null),this.viewData.setOpenNoteView(null),this.viewData.setFocusedComment(null),i!==z.U.CLOSED&&this.changeNotesPhase(z.U.IDLE),t){const i=t.id;this.cancelAttachmentChanges(),e.issueCommand(new j.xW(!1));this.notesData.getNote(i)&&(e.issueCommand(new I.RH(i,L.Er.NOTE)),e.issueCommand(new I.ik(i,L.Er.NOTE,this.getNoteVisibility(i,t.resolved)))),await e.issueCommand(new B.Aj(i,U.J.NOTE)),this.engine.broadcast(new p.A)}}updateNoteViewData(){this.viewData.updateViewData(this.viewData.searchBlock)}getFilteredNoteIds(e){const t=[];return this.notesData.iterate((i=>{this.getNoteVisibility(i.id,i.resolved)===e&&t.push(i.id)})),t}getNoteVisibility(e,t){const{notesFilter:i,openNoteView:n}=this.viewData;return(null==n?void 0:n.id)===e||i===W.$.ALL||t&&i===W.$.RESOLVED||!t&&i===W.$.OPEN}displayNotes(){const e=[];this.notesData.iterate((t=>{e.push(Object.assign(Object.assign({},t),{pinType:L.Er.NOTE,backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture,visible:this.getNoteVisibility(t.id,t.resolved)}))})),this.engine.commandBinder.issueCommand(new I.mE(e))}updateNotePin(e){const t=Object.assign(Object.assign({},e),{pinType:L.Er.NOTE,backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture,visible:this.getNoteVisibility(e.id,e.resolved)});this.engine.commandBinder.issueCommand(new I.mE([t]))}async confirmAttachmentChanges(e,t){return this.engine.commandBinder.issueCommand(new j.iu(e,v.u.COMMENT,t))}async cancelAttachmentChanges(){return this.engine.commandBinder.issueCommand(new j.Ze)}setFocusedNoteComment(e,t){if(t){const i=this.viewData.getComment(e.id,t);this.viewData.setFocusedComment(i)}else this.viewData.setFocusedComment(null)}async openNote(e,t,i,n=-1,s=!1){var r;const o=(null===(r=this.annotationsViewData.dockedAnnotation)||void 0===r?void 0:r.annotationType)===U.J.NOTE;return(null!==i?i:o)?this.dockNote(e,t,n,s):this.selectNote(e,t)}async selectNote(e,t){var i;const{commandBinder:n}=this.engine,s=this.viewData.getNoteView(e);if(s){const{openNoteView:r}=this.viewData,o=(null==r?void 0:r.id)===e,a=(null===(i=this.annotationsViewData.dockedAnnotation)||void 0===i?void 0:i.id)===e;if(o&&!a&&r)return void this.log.debug("Note is already selected");this.activated&&await n.issueCommand(new m.tT(u.w1.NOTES,!1)),n.issueCommand(new j.xW(!1)),r&&(n.issueCommand(new B.Aj(r.id,U.J.NOTE)),n.issueCommand(new I.RH(r.id,L.Er.NOTE))),this.viewData.setOpenNoteView(s),await n.issueCommand(new I.Ar(e,L.Er.NOTE,!1)),null!==t&&await n.issueCommand(new N.OR({pinPosition:s,transition:t}))}else this.log.debug("Cannot select a non-existent note")}async dockNote(e,t,i=-1,n=!1){var s,r;const{toolsData:o,viewData:a,engine:l,activated:c,userData:d}=this,h=a.getNoteView(e);if(h){const{openNoteView:f}=this.viewData,v=(null==f?void 0:f.id)===e,b=(null===(s=this.annotationsViewData.dockedAnnotation)||void 0===s?void 0:s.id)===e;if(this.toolsData.panelCollapsed&&l.commandBinder.issueCommand(new m.zK(!1)),v&&b&&f)return void this.log.debug("Note is already docked");l.commandBinder.issueCommand(new g.rE),c?-1!==i&&o.toolAccess===u.X$.TOOL&&o.setToolAccess(u.X$.LIST):(await l.commandBinder.issueCommand(new m.tT(u.w1.NOTES,!0)),o.setToolAccess(u.X$.SCENE)),v||a.setOpenNoteView(h);const S=(0,H.C)(d,U.J.NOTE,h.user);l.commandBinder.issueCommand(new I.Ar(e,L.Er.NOTE,S)),this.changeNotesPhase(z.U.OPENING),null!==t&&await l.commandBinder.issueCommand(new N.OR({pinPosition:h,transition:t})),l.broadcast(new p.ro),this.changeNotesPhase(z.U.OPEN);const E=null===(r=a.focusedComment)||void 0===r?void 0:r.id;if(n){const t=E||e;a.setActiveNotation(t)}else a.setActiveNotation(null);if(E||!v){const e=E||h.comments.get(0).id;l.broadcast(new ne.JL(e))}let T=i;-1===T&&(T=this.getListIndex(h.id,y.h.NOTE)),this.viewData.setListIndex(T)}else this.log.debug("Cannot open a non-existent note")}getListIndex(e,t){return this.viewData.noteListViews.values().findIndex((i=>i.assetType===t&&i.id===e))}async resolveNote(e){const t=this.notesData.getNote(e);if(t){if(t.resolved)return;this.closeNote(),await(0,l.gw)(350),this.engine.broadcast(new ne.hY(e,!0));await this.store.updateResolution(e,!0)?this.notesData.updateNoteProperties(e,{resolved:!0}):this.log.error("Resolving note failed")}else this.log.debug("Cannot resolve a non-existent note")}reopenNote(e){const t=this.notesData.getNote(e);if(t){if(!t.resolved)return;this.viewData.updateOpenNoteView({resolved:!1}),this.notesData.updateNoteProperties(e,{resolved:!1}),this.store.updateResolution(e,!1)}else this.log.debug("Cannot reopen a non-existent note")}async updateNoteComment(e,t,i){const n=this.notesData.getNote(e);if(n){const s=n.getComment(t);if(s)if(s.user.id===this.userData.getCurrentUserId()){const r=await this.confirmAttachmentChanges(t,v.u.COMMENT);if(i!==s.text){const e=await this.store.updateComment({id:t,text:i});e&&n.updateComment(e),this.parseMarkdown(i)}(r||i!==s.text)&&(await this.refreshNote(n.id),n.resolved&&(this.viewData.setNotesFilter(W.$.ALL),this.reopenNote(e))),this.viewData.setActiveNotation(null)}else this.log.debug("Cannot update another user's comment");else this.log.debug("Cannot update a non-existent comment")}else this.log.debug("Cannot update a comment in a non-existent note")}}const _e=NotesModule},76495:(e,t,i)=>{"use strict";i.d(t,{Ey:()=>NotesModeOpenedMessage,hY:()=>NoteResolutionChangeMessage,JL:()=>FocusCommentMessage});var n=i(91466);class NotesModeOpenedMessage extends n.v{}class NoteResolutionChangeMessage extends n.v{constructor(e,t){super(),this.id=e,this.resolved=t}}class FocusCommentMessage extends n.v{constructor(e){super(),this.commentId=e}}},87182:(e,t,i)=>{"use strict";i.d(t,{IA:()=>s,Mp:()=>r,pE:()=>o,uE:()=>a,GR:()=>l,E8:()=>c,AT:()=>d,TM:()=>h,Ko:()=>u,Rn:()=>p,ZP:()=>m});var n=i(80161);const s="features/notes-mode",r="features/notes",o="features/notes-nudge",a="spaces.notes",l=30,c=15,d=n.x.VIEWER,h=500,u=500,p="#5c7fff",m=Object.freeze({noteMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}},colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"],stem:{length:.23,width:1,opacity:1,transparent:!1,color:"white",alphaTest:.05},anchor:{size:.1},navigation:{anyDistance:!0,visibleDistance:8,cameraClearance:.1,tiltTolerance:25}})},66806:(e,t,i)=>{"use strict";i.d(t,{W:()=>OrderedListData});var n=i(32770),s=i(64781);class OrderedListData extends n.V{constructor(e){super(),this.name="ordered-list-data",this.lists=(0,s.q)(e)}getOrderedList(e){return this.lists.get(e)}updateOrderedList(e){this.lists.has(e.name)?this.lists.get(e.name).copy(e):this.lists.set(e.name,e)}}},36561:(e,t,i)=>{"use strict";i.d(t,{wg:()=>SaveNamedOrderedListCommand,Bd:()=>CreateOrderedListCommand,ui:()=>UpdateOrderedListCommand});var n=i(17386);class SaveNamedOrderedListCommand extends n.m{constructor(e,t){super(),this.payload={name:e,entries:t}}}class CreateOrderedListCommand extends n.m{constructor(e,t){super(),this.payload={name:e,entries:t}}}class UpdateOrderedListCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,name:t,entries:i}}}},39064:(e,t,i)=>{"use strict";var n;i.d(t,{l:()=>n}),function(e){e.TAG="tag"}(n||(n={}))},96513:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CreateOrderedListCommand:()=>u.Bd,MdsOrderedListDeserializer:()=>MdsOrderedListDeserializer,MdsOrderedListStore:()=>MdsOrderedListStore,OrderedList:()=>OrderedList,OrderedListData:()=>h.W,OrderedListEntryType:()=>p.l,SaveNamedOrderedListCommand:()=>u.wg,UpdateOrderedListCommand:()=>u.ui,default:()=>m});var n=i(47724),s=i(23573);class OrderedList extends s.T{constructor(e){super(),this.id="",this.name="",this.description="",this.entries=[],e&&Object.assign(this,e)}copy(e){return this.id=e.id,this.name=e.name,e.description&&(this.description=e.description),this.entries=e.entries.slice(),this.commit(),this}}var r=i(94474),o=i(36651),a=i(88512),l=i(60344);const c=new a.Z("ordered-list-deserializer");class MdsOrderedListDeserializer{deserialize(e){return e&&this.validate(e)?new OrderedList({id:e.id,name:e.label,entries:e.entries}):(c.debug("Deserialized invalid ordered list data from Mds",e),null)}validate(e){return["id","label","entries"].every((t=>t in e))}}const d=new a.Z("MdsOrderedListStore");class MdsOrderedListStore extends r.u{constructor(e){super(e),this.deserializer=new MdsOrderedListDeserializer}async read(){const e=this.getViewId();return this.query(l.GetOrderedLists,{modelId:e,ids:[]}).then((e=>{const t=(0,o.q)(e,"data.model.orderedLists");if(!t||!Array.isArray(t))return d.debug("GetOrderedLists failed"),{};return t.reduce(((e,t)=>{const i=this.deserializer.deserialize(t);return i&&(e[i.name]&&d.debug(`Duplicate orderedList found with label: ${i.name}`),e[i.name]=i),e}),{})}))}async create(e){const t=this.getViewId();return this.mutate(l.AddOrderedList,{modelId:t,label:e.name,description:e.description,entries:e.entries}).then((e=>this.deserializer.deserialize((0,o.q)(e,"data.addOrderedList"))))}async update(e){const t=this.getViewId();return this.mutate(l.PatchOrderedList,{modelId:t,orderedListId:e.id,label:e.name,description:e.description,entries:e.entries}).then((e=>this.deserializer.deserialize((0,o.q)(e,"data.patchOrderedList"))))}}var h=i(66806),u=i(36561);class OrderedListsModule extends n.Y{constructor(){super(...arguments),this.name="ordered-lists",this.saveNamedOrderedList=async e=>{const{name:t,entries:i}=e,n=this.data.getOrderedList(t);if(n){const e=new OrderedList({name:t,id:n.id,entries:i}),s=await this.store.update(e);s?this.data.updateOrderedList(s):this.log.error("Failed to update list")}else{const e=new OrderedList({name:t,entries:i}),n=await this.store.create(e);n?this.data.updateOrderedList(n):this.log.error("Failed to add list")}}}async init(e,t){const{modelId:i,baseUrl:n}=e;this.store=new MdsOrderedListStore({baseUrl:n,viewId:i,readonly:!1});const s=await this.store.read();this.data=new h.W(s||{}),this.bindings.push(t.commandBinder.addBinding(u.wg,this.saveNamedOrderedList)),t.market.register(this,h.W,this.data)}dispose(e){this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],super.dispose(e)}onUpdate(){}}var p=i(39064);const m=OrderedListsModule},85362:(e,t,i)=>{"use strict";i.d(t,{B:()=>CameraControls});var n=i(2212),s=i(36371),r=i(57812),o=i(68524),a=i(19674),l=i(69626),c=i(16785),d=i(64185);class CameraControls extends c.Z{constructor(e,t,i,o=!1){super(),this.cameraModule=e,this.targetProjection=new s.M,this.currentOrientation=new n.Quaternion,this.currentPosition=new n.Vector3,this.positionDelta=new n.Vector3,this.linearAccel=new n.Vector2,this.linearVelocity=new n.Vector2,this.zoomAccel=0,this.zoomVelocity=0,this.scale=1,this.maxZoom=0,this.minZoom=r.Tm,this.checkBounds=o,this.bounds=t.clone(),this.boundsCenter=i.clone(),this.setupBounds(),this.transition={active:!1,startTime:0,elapsed:0,duration:0,linearVelocity:new n.Vector2,zoomVelocity:0,easeOut:!1}}start(){this.scale=1,this.maxZoom=this.cameraModule.getData(!1).defaultZoom()*r.Ct}setPanAcceleration(e,t=!1,i){if(!this.transition.active){t&&this.haltVelocity(e,this.linearVelocity);const n=this.cameraModule.getData(!1),s=n.pose.projection.elements[0],r=n.pose.projection.elements[5];this.linearAccel.x=void 0!==e.x?e.x/s:this.linearAccel.x,this.linearAccel.y=void 0!==e.y?e.y/r:this.linearAccel.y,void 0!==i&&this.linearAccel.setLength(i)}}setZoomAcceleration(e){this.transition.active||(this.zoomAccel=e)}haltVelocity(e,t){e.x&&t.x&&Math.sign(e.x)!==Math.sign(t.x)&&(t.x=0),e.y&&t.y&&Math.sign(e.y)!==Math.sign(t.y)&&(t.y=0)}startRotateTransition(e,t,i){return Promise.resolve()}startTranslateTransition(e,t,i=!0){return this.startTransition(e,0,t.clone().multiplyScalar(r.SI),0,i).nativePromise()}startZoomTransition(e,t,i){return this.startTransition(e,0,new n.Vector2(0,0),t,i).nativePromise()}startTransition(e,t,i,n,s){const r=new d.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=r,this.transition.linearVelocity.copy(i),this.transition.zoomVelocity=n,this.transition.easeOut=s,this.linearAccel.set(0,0),this.zoomAccel=0,this.linearVelocity.copy(i),this.zoomVelocity=n,this.cameraModule.beginExternalTransition(),r.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e,t,i){this.transition.elapsed+=e;const n=this.getTransitionScale(e);t&&(this.linearVelocity.copy(this.transition.linearVelocity).multiplyScalar(n),this.pan(this.linearVelocity)),i&&(this.zoomVelocity=this.transition.zoomVelocity*n,this.zoom(this.zoomVelocity)),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)}getTransitionScale(e){if(this.transition.elapsed>=this.transition.duration){return(this.transition.duration-(this.transition.elapsed-e))/e}return e/r.SI}updateDefault(e,t,i){const n=e/r.SI;t&&(this.linearVelocity.addScaledVector(this.linearAccel,n),this.pan(this.linearVelocity),this.linearVelocity.multiplyScalar(Math.pow(1-r.O8,n))),i&&(this.zoomVelocity=this.zoomVelocity+this.zoomAccel*n,this.zoom(this.zoomVelocity),this.zoomVelocity*=Math.pow(1-r.TD,n))}update(e){const t=this.linearAccel.length()>o.Z.epsilon||this.linearVelocity.length()>o.Z.epsilon,i=Math.abs(this.zoomAccel)>o.Z.epsilon||Math.abs(this.zoomVelocity)>o.Z.epsilon;this.transition.active?this.updateTransition(e,t,i):this.updateDefault(e,t,i)}stopMomentum(){this.transition.active||(this.linearVelocity.set(0,0),this.zoomVelocity=0)}stopAcceleration(){this.transition.active||(this.setPanAcceleration({x:0,y:0}),this.setZoomAcceleration(0))}stop(e=!1){this.stopTransition(),this.stopAcceleration(),e||this.stopMomentum()}pan(e){const t=this.cameraModule.getData(!1);this.positionDelta.x=e.x,this.positionDelta.y=e.y,this.positionDelta.z=0,this.positionDelta.applyQuaternion(t.pose.rotation),this.currentPosition.copy(t.pose.position).add(this.positionDelta),this.checkBounds&&!this.insideBounds(this.currentPosition,t.pose.rotation,t.pose.projection)||this.cameraModule.updateCameraPosition(this.currentPosition)}zoom(e){const t=this.cameraModule.getData(!1);this.targetProjection.copy(t.pose.projection);const i=this.scale*(1-e);if(Math.abs(i-this.scale)>o.Z.epsilon){this.targetProjection.elements[0]*=i/this.scale,this.targetProjection.elements[5]*=i/this.scale;const n=(0,l.S3)(this.targetProjection);if(e<0&&n<=this.minZoom||e>0&&n>=this.maxZoom)return;if(this.checkBounds&&!this.insideBounds(t.pose.position,t.pose.rotation,this.targetProjection))return;this.scale=i,this.cameraModule.updateCameraProjection(this.targetProjection.clone())}}setupBounds(){this.bounds.min.x=this.adjustBound(this.bounds.min.x,2),this.bounds.min.y=this.adjustBound(this.bounds.min.y,2),this.bounds.min.z=this.adjustBound(this.bounds.min.z,2),this.bounds.max.x=this.adjustBound(this.bounds.max.x,-2),this.bounds.max.y=this.adjustBound(this.bounds.max.y,-2),this.bounds.max.z=this.adjustBound(this.bounds.max.z,-2),this.worldBounds=(new n.Box3).setFromCenterAndSize(this.boundsCenter,new n.Vector3(this.bounds.max.x-this.bounds.min.x,this.bounds.max.y-this.bounds.min.y,this.bounds.max.z-this.bounds.min.z))}insideBounds(e,t,i){return!!(0,a.cb)(e,t,i,this.worldBounds)}adjustBound(e,t){return Math.sign(e+t)===Math.sign(e)?e+t:0}}},57812:(e,t,i)=>{"use strict";i.d(t,{SI:()=>s,O8:()=>r,Gu:()=>o,bC:()=>a,JU:()=>l,Ct:()=>c,Tm:()=>d,TD:()=>h,mP:()=>u,jX:()=>p,N4:()=>m});var n=i(60771);const s=1e3/60,r=.05,o=.1/60,a=.02,l=25,c=3,d=3,h=.16,u=(0,n.V5)()?45:(0,n.Kr)()?20:35,p=.01,m=2},35726:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>OrthographicControls});var n,s=i(47724),r=i(2212),o=i(85362),a=i(57812),l=i(35597),c=i(76870),d=i(81507),h=i(88216),u=i(5087),p=i(68576),m=i(88814),f=i(81040),g=i(51869),v=i(38022),y=i(88727),b=i(13988),S=i(67027),E=i(19674),T=i(96909);!function(e){e[e.NONE=c.r3.NONE]="NONE",e[e.PAN=c.r3.PRIMARY]="PAN",e[e.ROTATE=c.r3.SECONDARY]="ROTATE",e[e.ZOOM=c.r3.MIDDLE]="ZOOM"}(n||(n={}));class OrthographicControls extends s.Y{constructor(){super(...arguments),this.name="orthographic-controls",this.controlState=n.NONE,this.controlsEngaged=!1,this.movementKeys=new r.Vector2,this.resetControlState=()=>{this.controlState=n.NONE}}async init(e,t){const[i,n,s,r]=await Promise.all([t.market.waitForData(S._),t.getModuleBySymbol(T.y.CAMERA),t.getModule(b.default),t.market.waitForData(l.O)]);this.meshData=i,this.cameraModule=n,this.viewmodeData=r,this.modelSize=Math.max(i.size.length(),1),this.commonControlsModule=s,this.createCameraControls(i),t.getModuleBySymbol(T.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(f.a,(e=>{this.validateViewmode()&&this.onScrollWheel(e)}))),this.bindings.push(e.registerHandler(g.E0,(e=>{this.validateViewmode()&&this.onDragBegin(e.buttons)}))),this.bindings.push(e.registerHandler(g._t,(e=>{this.validateViewmode()&&(this.controlsEngaged=!0,this.onDrag(e.delta),this.controls.update(a.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(g._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&(this.onDrag(e.delta),this.controls.update(a.SI),this.controls.stopAcceleration()),this.onDragEnd(e.delta,e.buttons),this.controlsEngaged=!1)}))),this.bindings.push(e.registerHandler(v.G,(e=>{this.validateViewmode()&&(this.controls.setZoomAcceleration(-e.pinchDelta*a.N4),this.controls.update(a.SI),this.controls.stop())}))),this.bindings.push(e.registerHandler(v.i,this.resetControlState)),this.bindings.push(e.registerHandler(y.e,(e=>{this.validateViewmode()&&e.state!==h.M.PRESSED&&this.onKey(e)})))})),this.bindings.push(t.subscribe(p.Z,(e=>{this.controls.stop(),this.resetControlState()}))),this.bindings.push(t.subscribe(m.Z,(e=>{this.validateViewmode()&&this.controls.start()})))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}createCameraControls(e){this.controls=new o.B(this.cameraModule,e.bounds,e.center,!0),this.commonControlsModule.addControls(u.Ey.Orthographic,this.controls)}onScrollWheel(e){if(0!==e.delta.y){const t=(0,E.et)(this.modelSize,1,1500,2,.125);this.controls.setZoomAcceleration(e.delta.y*a.jX/(t*a.mP)),this.controls.update(a.SI),this.controls.setZoomAcceleration(0)}}onDragBegin(e){if(this.controlState===n.NONE){const t=e;this.controlState=t}this.controls.stop()}onDrag(e){switch(this.controlState){case n.PAN:const t=e;this.controls.setPanAcceleration({x:-t.x,y:-t.y});break;case n.ZOOM:0!==e.y&&this.controls.setZoomAcceleration(-e.y)}}onDragEnd(e,t){t&this.controlState||(this.controlState=n.NONE)}onKey(e){const{key:t,state:i}=e,n=i===h.M.DOWN;let s=!1;switch(t){case d.R.A:this.movementKeys.x=n?-1:0,s=!0;break;case d.R.D:this.movementKeys.x=n?1:0,s=!0;break;case d.R.W:this.movementKeys.y=n?1:0,s=!0;break;case d.R.S:this.movementKeys.y=n?-1:0,s=!0;break;case d.R.K:this.controls.setZoomAcceleration(n?a.Gu:0);break;case d.R.I:this.controls.setZoomAcceleration(n?-a.Gu:0)}if(s){const e=this.movementKeys;this.controls.setPanAcceleration({x:e.x,y:e.y},!1,a.bC)}}validateViewmode(){return this.viewmodeData.currentMode===u.Ey.Orthographic}}},45870:(e,t,i)=>{"use strict";i.d(t,{SI:()=>s,uQ:()=>r,zf:()=>o,O8:()=>a,WI:()=>l});var n=i(7170);const s=1e3/60,r=(0,n.Id)(70),o=-r,a=.05,l=.1/60},62881:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PanoramaControls,lookAccelerationKey:()=>w});var n=i(47724),s=i(2212),r=i(12216),o=i(45870),a=i(68524),l=i(27408),c=i(16785),d=i(64185);class CameraControls extends c.Z{constructor(e){super(),this.lookVelocity=new s.Vector2,this.lookAccel=new s.Vector2,this.tempAxis=new s.Vector3,this.tempOrientation=new s.Quaternion,this.currentOrientation=new s.Quaternion,this.tempEuler=new s.Euler,this.cameraModule=e,this.transition={active:!1,startTime:0,elapsed:0,duration:0,velocity:new s.Vector2,easeOut:!1}}setLookAcceleration(e,t=!1){this.transition.active||(t&&(e.x&&this.lookVelocity.x&&Math.sign(e.x)!==Math.sign(this.lookVelocity.x)&&(this.lookVelocity.x=0),e.y&&this.lookVelocity.y&&Math.sign(e.y)!==Math.sign(this.lookVelocity.y)&&(this.lookVelocity.y=0)),this.lookAccel.x=void 0!==e.x?e.x:this.lookAccel.x,this.lookAccel.y=void 0!==e.y?e.y:this.lookAccel.y)}startTransition(e,t,i){const n=new d.Q;return this.transition.active=!0,this.transition.duration=e,this.transition.elapsed=0,this.transition.startTime=Date.now(),this.transition.deferred=n,this.transition.velocity.copy(t),this.transition.easeOut=i,this.lookAccel.set(0,0),this.lookVelocity.copy(t),this.cameraModule.beginExternalTransition(),n.promise()}stopTransition(){this.transition.active&&(this.cameraModule.endExternalTransition(),this.transition.active=!1),this.transition.deferred&&(this.transition.deferred.resolve(),this.transition.deferred=void 0)}updateTransition(e){const t=e/o.SI;if(this.lookVelocity.copy(this.transition.velocity),this.transition.elapsed+=e,this.transition.elapsed>=this.transition.duration){const t=this.transition.duration-(this.transition.elapsed-e);this.lookVelocity.multiplyScalar(t/e)}else this.lookVelocity.multiplyScalar(t)}updateCameraParameters(){const e=this.cameraModule.getData(!1);this.tempEuler.setFromQuaternion(e.pose.rotation,"YXZ");const t=this.tempEuler.x,i=(0,l.uZ)(this.lookVelocity.y,o.zf-t,o.uQ-t);this.tempAxis.copy(r.f.RIGHT),this.tempOrientation.setFromAxisAngle(this.tempAxis.applyQuaternion(e.pose.rotation),i),this.currentOrientation.copy(e.pose.rotation).premultiply(this.tempOrientation),this.tempOrientation.setFromAxisAngle(r.f.UP,this.lookVelocity.x),this.currentOrientation.premultiply(this.tempOrientation),e.pose.rotation.equals(this.currentOrientation)||(this.tempOrientation.copy(this.currentOrientation).normalize(),this.cameraModule.updateCameraRotation(this.tempOrientation))}update(e){const t=this.cameraModule.getData(!1),i=e/o.SI;t.pose.rotation.equals(this.currentOrientation)||this.currentOrientation.copy(t.pose.rotation),this.transition.active?(this.updateTransition(e),this.updateCameraParameters(),this.transition.elapsed>=this.transition.duration&&(this.stop(this.transition.easeOut),this.transition.active=!1)):(this.lookAccel.length()>a.Z.epsilon||this.lookVelocity.length()>a.Z.epsilon)&&(this.lookVelocity.addScaledVector(this.lookAccel,i),this.updateCameraParameters(),this.lookVelocity.multiplyScalar(Math.pow(1-o.O8,i)))}stop(e=!1){this.stopTransition(),this.lookAccel.set(0,0),e||this.lookVelocity.set(0,0)}startRotateTransition(e,t,i){const n=this.cameraModule.getData(!1);return n.transition&&n.transition.activeInternal&&n.transition.to.rotation&&(n.transition.to.rotation=void 0),this.startTransition(e,t.clone().multiplyScalar(o.SI),i).nativePromise()}startTranslateTransition(e,t,i=!0){throw new Error("Panning isn't supported in Panorama Controls")}startZoomTransition(e,t,i){throw new Error("Zooming isn't supported in Panorama Controls")}}var h=i(35597),u=i(19047),p=i(5087),m=i(76870),f=i(81507),g=i(88216),v=i(68576),y=i(51869),b=i(88727),S=i(13988),E=i(33874),T=i(96909);const w="Rotation speed";class PanoramaControls extends n.Y{constructor(){super(...arguments),this.name="panorama-controls",this.controlsEngaged=!1,this.lookAccelerationSpeed=o.WI,this.calcRotationAngle=(()=>{const e=new s.Matrix4,t=new s.Vector3,i=new s.Vector3;return(n,r,o)=>{const a=n.getData(!1);e.copy(a.pose.projection.asThreeMatrix4()),e.invert(),t.set(r.x-o.x,r.y-o.y,-1).applyMatrix4(e),i.set(r.x,r.y,-1).applyMatrix4(e);const l=Math.sqrt(t.x*t.x+t.z*t.z),c=Math.sqrt(i.x*i.x+i.z*i.z),d=Math.atan2(t.y,l),h=Math.atan2(i.y,c)-d;t.y=0,i.y=0,t.normalize(),i.normalize();const u=Math.acos(t.dot(i));let p=0;return isNaN(u)||(p=u,o.x>0&&(p*=-1)),new s.Vector2(-p,-h)}})()}async init(e,t){const i=await t.getModuleBySymbol(T.y.CAMERA);this.controls=new CameraControls(i);const n=await t.getModule(S.default);n.addControls(p.Ey.Panorama,this.controls),n.addControls(p.Ey.Mesh,this.controls),this.market=t.market,this.bindings.push(t.subscribe(v.Z,(e=>{this.controls.stop()}))),t.getModuleBySymbol(T.y.INPUT).then((e=>{e.registerHandler(y.E0,(e=>{this.validateViewmode()&&this.controls.stop()})),e.registerHandler(y._t,(e=>{this.validateViewmode()&&e.buttons&m.r3.PRIMARY&&(this.controlsEngaged=!0,this.onDrag(i,e.position,e.delta),this.controls.update(o.SI),this.controls.stop())})),e.registerHandler(y._R,(e=>{this.validateViewmode()&&this.controlsEngaged&&(e.timeSinceLastMove<100&&!(e.buttons&m.r3.PRIMARY)&&(this.onDrag(i,e.position,e.delta),this.controls.update(o.SI),this.controls.setLookAcceleration({x:0,y:0})),this.controlsEngaged=!1)})),e.registerHandler(b.e,(e=>{this.validateViewmode()&&this.onKey(e.key,e.state)}))}))}onUpdate(e){this.validateViewmode()&&this.controls.update(e)}onDrag(e,t,i){this.controls.setLookAcceleration(this.calcRotationAngle(e,t,i))}onKey(e,t){let i=null;const n=this.market.tryGetData(E.e);n&&(i=n.tryGetProperty(w,null)),this.lookAccelerationSpeed=i?i*(Math.PI/180)/60:this.lookAccelerationSpeed;const s=t===g.M.DOWN;switch(e){case f.R.LEFTARROW:case f.R.J:this.controls.setLookAcceleration({x:s?this.lookAccelerationSpeed:0},!0);break;case f.R.RIGHTARROW:case f.R.L:this.controls.setLookAcceleration({x:s?-this.lookAccelerationSpeed:0},!0);break;case f.R.K:this.controls.setLookAcceleration({y:s?-this.lookAccelerationSpeed:0},!0);break;case f.R.I:this.controls.setLookAcceleration({y:s?this.lookAccelerationSpeed:0},!0)}}validateViewmode(){const e=this.market.tryGetData(h.O),t=this.market.tryGetData(u.Z);return!e||!t||e.isInside()&&!t.isVR()}}},32025:(e,t,i)=>{"use strict";i.d(t,{B:()=>PinsViewData});var n=i(32770),s=i(48715),r=i(42835);class PinsViewData extends n.V{constructor(){super(),this.name="pins-view-data",this.pins=new Map,this.creatingPin=!1,this.pinEditorStateObservable=(0,s.Y)(r.V8.IDLE),this.selectedPinObservable=(0,s.Y)(null),this.focusedPinObservable=(0,s.Y)(null),this.editableObservable=(0,s.Y)(!0),this.progressObservable=(0,s.Y)(-1),this.screenPositionObservable=(0,s.Y)(null),this.canPlaceObservable=(0,s.Y)(!0),this.canAddObservable=(0,s.Y)(!0)}updatePin(e){this.pins.set(e.id,e)}getPin(e){return this.pins.get(e)}removePin(e){this.pins.get(e)&&this.pins.delete(e)}removePinsByType(e){this.pins.forEach(((t,i)=>{t.pinType===e&&this.pins.delete(t.id)}))}get creatingNewPin(){return this.creatingPin}updateSelectedPin(e){const t=this.selectedPin;if(t){const i=Object.assign(Object.assign({},t),e);this.updatePin(i),this.setSelectedPin(i)}}setSelectedPin(e){this.selectedPinObservable.value=e}get selectedPin(){return this.selectedPinObservable.value}onSelectedPinChanged(e){return this.selectedPinObservable.onChanged(e)}setFocusedPin(e){this.focusedPinObservable.value=e}get focusedPin(){return this.focusedPinObservable.value}onFocusedPinChanged(e){return this.focusedPinObservable.onChanged(e)}setPinEditorState(e){switch(e){case r.V8.IDLE:this.creatingPin=!1;break;case r.V8.CREATING:this.creatingPin=!0}this.pinEditorStateObservable.value=e}get pinEditorState(){return this.pinEditorStateObservable.value}onPinEditorStateChanged(e){return this.pinEditorStateObservable.onChanged(e)}setProgress(e){this.progressObservable.value=e}get progress(){return this.progressObservable.value}onProgressChanged(e){const t=this.progressObservable.onChanged(e);return t.renew(),t}get screenPosition(){return this.screenPositionObservable.value}setScreenPosition(e){this.screenPositionObservable.value=e}onScreenPositionChanged(e){return this.screenPositionObservable.onChanged(e)}get isPinEditable(){return this.editableObservable.value}setEditablePin(e){this.editableObservable.value=e}onPinEditableChanged(e){return this.editableObservable.onChanged(e)}get canAdd(){return this.canAddObservable.value}setCanAdd(e){this.canAddObservable.value=e}onCanAddChanged(e){return this.canAddObservable.onChanged(e)}get canPlace(){return this.canPlaceObservable.value}setCanPlace(e){this.canPlaceObservable.value=e}onCanPlaceChanged(e){return this.canPlaceObservable.onChanged(e)}}},38321:(e,t,i)=>{"use strict";i.d(t,{Ki:()=>EnablePinCreationCommand,Ar:()=>SelectPinCommand,RH:()=>UnselectPinCommand,fM:()=>CreatePinCommand,tT:()=>CancelNewPinCommand,OL:()=>RemovePinCommand,zM:()=>RemovePinsByTypeCommand,mE:()=>UpdatePinViewsCommand,tE:()=>UpdatePinCommand,ik:()=>ChangePinVisibilityCommand,qN:()=>ChangePinVisibilityByTypeCommand,_Y:()=>ChangePinOpacityCommand,kb:()=>ChangePinOpacityByTypeCommand,yR:()=>ClickOffPinCommand,ip:()=>PlacePinCommand,I$:()=>MovePinCommand});var n=i(17386);class EnablePinCreationCommand extends n.m{constructor(e){super(),this.payload={enabled:e}}}class SelectPinCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,editable:i}}}class UnselectPinCommand extends n.m{constructor(e,t){super(),this.payload={id:e,pinType:t}}}class CreatePinCommand extends n.m{constructor(e,t,i,n,s){super(),this.payload={id:e,pin:t,pinType:i,backgroundTexture:n,maskTexture:s}}}class CancelNewPinCommand extends n.m{constructor(e,t){super(),this.payload={id:e,pinType:t}}}class RemovePinCommand extends n.m{constructor(e,t){super(),this.payload={id:e,pinType:t}}}class RemovePinsByTypeCommand extends n.m{constructor(e){super(),this.payload={pinType:e}}}class UpdatePinViewsCommand extends n.m{constructor(e){super(),this.payload={pinViews:e}}}class UpdatePinCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,properties:i}}}class ChangePinVisibilityCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,visible:i}}}class ChangePinVisibilityByTypeCommand extends n.m{constructor(e,t){super(),this.payload={pinType:e,visible:t}}}class ChangePinOpacityCommand extends n.m{constructor(e,t,i){super(),this.payload={id:e,pinType:t,opacity:i}}}class ChangePinOpacityByTypeCommand extends n.m{constructor(e,t,i=[]){super(),this.payload={pinType:e,opacity:t,skipIds:i}}}class ClickOffPinCommand extends n.m{constructor(){super()}}class PlacePinCommand extends n.m{constructor(){super()}}class MovePinCommand extends n.m{constructor(e,t){super(),this.payload={id:e,pos:t}}}},42835:(e,t,i)=>{"use strict";var n,s,r,o;i.d(t,{Er:()=>n,K_:()=>s,V8:()=>r,Od:()=>o}),function(e){e.MATTERTAG="mattertag",e.NOTE="note"}(n||(n={})),function(e){e.DEFAULT="default",e.HIGHLIGHTED="highlighted",e.DIMMED="dimmed"}(s||(s={})),function(e){e.IDLE="idle",e.CREATING="creating",e.PRESSING="pressing",e.PLACING="placing",e.PLACED="placed"}(r||(r={})),function(e){e.UP="up",e.UP_LEFT="up-left",e.UP_RIGHT="up-right",e.DOWN="down",e.DOWN_LEFT="down-left",e.DOWN_RIGHT="down-right",e.LEFT="left",e.RIGHT="right"}(o||(o={}))},48470:(e,t,i)=>{"use strict";i.d(t,{tP:()=>PinHoverChangeMessage,F7:()=>PinClickedMessage,b0:()=>PinPlacedMessage,cd:()=>NewPinReadyMessage,pe:()=>PinPlacementCancelledMessage,bV:()=>PinMovedMessage,WM:()=>PinUnselectedMessage,hu:()=>PinAddCancelledMessage,Q4:()=>PinSelectedMessage});var n=i(91466);class PinHoverChangeMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.hovering=t,this.pinType=i}}class PinClickedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinPlacedMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class NewPinReadyMessage extends n.v{}class PinPlacementCancelledMessage extends n.v{}class PinMovedMessage extends n.v{constructor(e,t,i){super(),this.id=e,this.pinType=t,this.pinPos=i}}class PinUnselectedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinAddCancelledMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}class PinSelectedMessage extends n.v{constructor(e,t){super(),this.id=e,this.pinType=t}}},70384:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PreRendererModule});var n,s=i(47724),r=i(96909),o=i(75892),a=i(909),l=i(48280),c=i(10757);!function(e){e[e.None=0]="None",e[e.Queued=1]="Queued",e[e.Rendering=2]="Rendering",e[e.Rendered=3]="Rendered"}(n||(n={}));class PreRenderer{constructor(e){this.statusMap={},this.active=[],this.queued=[],this.panoRenderer=e,this.disablePreRendering()}init(){}dispose(){}activate(e){}deactivate(e){this.disablePreRendering()}enablePreRendering(){this.enabled=!0}disablePreRendering(){this.enabled=!1}render(){}beforeRender(){this.enabled&&this.processQueued()}tryPreRender(e){return this.getPreRenderState(e)===n.None&&(this.queued.push(e),this.statusMap[e]=n.Queued,!0)}getPreRenderState(e){const t=this.statusMap[e];return void 0!==t?t:n.None}processQueued(){let e=0;for(const t of Object.keys(this.statusMap))this.statusMap[t]===n.Rendering&&e++;if(0===e&&this.queued.length>0){const e=this.queued.shift();if(e){this.active.push(e),this.statusMap[e]=n.Rendering;this.panoRenderer.activateSweep(e).then((()=>{this.onRendered(e)}))}}}cleanup(e=[]){const t=(0,c.ow)(e),i=[];for(const e of this.queued)t[e]?i.push(e):this.statusMap[e]=n.None;this.queued.length=0,this.queued.push.apply(this.queued,i);const s=[];for(const e of this.active)t[e]?s.push(e):this.statusMap[e]=n.None;this.active.length=0,this.active.push.apply(this.active,s)}onRendered(e){this.statusMap[e]=n.Rendered}}var d=i(17597);const h=Object.freeze({prerender:{preRenderTourPanos:(0,d.eY)("pre",1)}});class PreRendererModule extends s.Y{constructor(){super(...arguments),this.name="prerenderer-module",this.lastPrerendered=null}async init(e,t){if(h.prerender.preRenderTourPanos||e.preRenderTourPanos){this.sweepData=await t.market.waitForData(o.Z);const e=await t.getModuleBySymbol(r.y.SWEEP_PANO);this.panoRenderer=e.getRenderer(),this.preRenderer=new PreRenderer(this.panoRenderer),t.addComponent(this,this.preRenderer),this.bindings.push(t.subscribe(a.Z,(e=>{this.preRenderer.enablePreRendering(),this.lastPrerendered=null,e.sweepIds&&e.sweepIds.length>=3&&(this.lastPrerendered=e.sweepIds[2],this.preRenderer.tryPreRender(this.lastPrerendered)),this.cleanup(this.sweepData),this.currentRestrictedSweeps=e.sweepIds}))),this.bindings.push(t.subscribe(l.Z,(e=>{this.preRenderer.disablePreRendering(),this.cleanup(this.sweepData,!0),this.currentRestrictedSweeps=null})))}}getCurrentSweeps(){return this.currentRestrictedSweeps||[]}cleanup(e,t=!1){const i=[];e.transition.active?(e.transition.from&&i.push(e.transition.from),e.transition.to&&i.push(e.transition.to)):e.currentSweep&&i.push(e.currentSweep),this.lastPrerendered&&i.push(this.lastPrerendered),t&&this.panoRenderer.freeAllTextures(i),this.preRenderer.cleanup(i)}}},1894:(e,t,i)=>{"use strict";i.d(t,{n:()=>Snapcaster,x:()=>SurfaceEdgeFinderCompleteMessage});var n=i(49399),s=i(2212);class LegacyThreeGeometry{constructor(){this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[],[]],this.boundingBox=null,this.boundingSphere=null}}class Face3{constructor(e,t,i,n,r,o=0){this.a=e,this.b=t,this.c=i,this.materialIndex=o,this.a=e,this.b=t,this.c=i,this.normal=n&&!Array.isArray(n)&&n.isVector3?n:new s.Vector3,this.vertexNormals=Array.isArray(n)?n:[],this.color=r&&!Array.isArray(r)&&r.isColor?r:new s.Color,this.vertexColors=Array.isArray(r)?r:[],this.materialIndex=o}clone(){return new Face3(this.a,this.b,this.c,this.normal,this.color).copy(this)}copy(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(let t=0,i=e.vertexNormals.length;t<i;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(let t=0,i=e.vertexColors.length;t<i;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}}var r=i(88512),o=i(7170);const a=new r.Z("surface-edge-finder"),l=new s.Triangle,c=["a","b","c"];class Face extends Face3{constructor(e,t,i,n){super(e.a,e.b,e.c,e.normal),this.va=t,this.vb=i,this.vc=n,this.area=l.set(this.va.vector,this.vb.vector,this.vc.vector).getArea(),this.midpoint=l.getMidpoint(new s.Vector3),this.vertices=[this.va,this.vb,this.vc],t.faces.push(this),i.faces.push(this),n.faces.push(this)}}class Vertex{constructor(e){this.vector=e,this.faces=[]}}class Surface{constructor(){this.area=0,this.normal=new s.Vector3,this.midpoint=new s.Vector3,this.faces=[],this.normalSum=new s.Vector3,this.midpointSum=new s.Vector3}add(e){e.surface&&e.surface.remove(e),this.faces.push(e),this.area+=e.area,this.midpointSum.add(e.midpoint),this.normalSum.add(e.normal),this.recalcFromSums(),e.surface=this}remove(e){e.surface&&(this.faces.splice(this.faces.indexOf(e),1),this.area-=e.area,this.midpointSum.sub(e.midpoint),this.normalSum.sub(e.normal),this.recalcFromSums()),e.surface=null}recalcFromSums(){this.normal.copy(this.normalSum).normalize(),this.midpoint.copy(this.midpointSum).divideScalar(this.faces.length)}mergeSurfaces(e){for(const t of e.faces)t.surface=this,this.faces.push(t);this.area+=e.area,this.normalSum.add(e.normalSum),this.midpointSum.add(e.midpointSum),this.recalcFromSums(),e.faces=[],e.area=0,e.normal.set(0,0,0),e.normalSum.set(0,0,0),e.midpointSum.set(0,0,0),e.midpoint.set(0,0,0)}getEdges(){const e={},t={};for(const t of this.faces)for(let i=0;i<3;i++){const n=t[c[i]],s=t[c[(i+1)%3]],r=Math.min(n,s)+","+Math.max(n,s);if(void 0===e[r]){const t={edge1:n,edge2:s,isEdge:!0};e[r]=t}else e[r].isEdge=!1}for(const{edge1:i,edge2:n,isEdge:s}of Object.values(e))s&&(t[i]||(t[i]=[]),t[i].push(n),t[n]||(t[n]=[]),t[n].push(i));return t}getCircularPaths(e){const t=this.getEdges(),i=new Set,n=[],s=Object.keys(t).map((e=>parseInt(e,10)));let r;for(;r=s.pop();){const s=[];for(;r;){let n;s.push(e[r]);let o=0;for(const s of t[r]){const t=Math.min(r,s)+","+Math.max(r,s);if(i.has(t))continue;const a=e[r].vector.distanceToSquared(this.midpoint);(void 0===n||a>o)&&(n=s,o=a)}if(!n)break;{const e=Math.min(r,n)+","+Math.max(r,n);i.add(e),r=n}}s.length>2&&n.push(s)}return n}}class SurfaceEdgeFinder{constructor(){this.surfaces=new Set,this.lines=[],this.points=[]}*run(e,t=[1,5,10],i=.2,r=.01,l=20){const c=function(e){const t=new LegacyThreeGeometry,i=null!==e.index?e.index:void 0,n=e.attributes;if(void 0===n.position)throw Error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion.");const r=n.position,o=n.normal,a=n.color,l=n.uv,c=n.uv2;void 0!==c&&(t.faceVertexUvs[1]=[]);for(let e=0;e<r.count;e++)t.vertices.push((new s.Vector3).fromBufferAttribute(r,e)),void 0!==a&&t.colors.push((new s.Color).fromBufferAttribute(a,e));function d(e,i,n,r=0){const d=void 0===a?[]:[t.colors[e].clone(),t.colors[i].clone(),t.colors[n].clone()],h=void 0===o?[]:[(new s.Vector3).fromBufferAttribute(o,e),(new s.Vector3).fromBufferAttribute(o,i),(new s.Vector3).fromBufferAttribute(o,n)],u=new Face3(e,i,n,h,d,r);t.faces.push(u),void 0!==l&&t.faceVertexUvs[0].push((new s.Vector2).fromBufferAttribute(l,e),(new s.Vector2).fromBufferAttribute(l,i),(new s.Vector2).fromBufferAttribute(l,n)),void 0!==c&&t.faceVertexUvs[1].push((new s.Vector2).fromBufferAttribute(c,e),(new s.Vector2).fromBufferAttribute(c,i),(new s.Vector2).fromBufferAttribute(c,n))}const h=e.groups;if(h.length>0)for(let e=0;e<h.length;e++){const t=h[e],n=t.start;for(let e=n,s=n+t.count;e<s;e+=3)void 0!==i?d(i.getX(e),i.getX(e+1),i.getX(e+2),t.materialIndex):d(e,e+1,e+2,t.materialIndex)}else if(void 0!==i)for(let e=0;e<i.count;e+=3)d(i.getX(e),i.getX(e+1),i.getX(e+2));else for(let e=0;e<r.count;e+=3)d(e,e+1,e+2);return t}(e),d=c.vertices.map((e=>new Vertex(e))),h=[];for(const e of c.faces)h.push(new Face(e,d[e.a],d[e.b],d[e.c])),yield;for(let e=0,t=h.length;e<t;e++){const t=h[e];(new Surface).add(t)}for(const e of t)yield*this.mergeSurfacesByNormal(h,e);for(const e of h)this.surfaces.add(e.surface);let u=0;const p=[];for(const e of this.surfaces){if(e.area<=i)continue;const t=e.getCircularPaths(d);for(const e of t)this.cullPath(e,((e,t)=>{if(e.length()<r||t.length()<r)return u++,!1;const i=e.angleTo(t)*o.MN;return!(i<l||i>180-l)||(u++,!1)})),e.length>2&&p.push(e);yield}a.debug(`Culled ${u} path points`);const m=new Set,f=new Set,g=e=>`${e.x.toFixed(3)},${e.y.toFixed(3)},${e.z.toFixed(3)}`,v=e=>`${g(e.start)}:${g(e.end)}`,y=e=>`${g(e.end)}:${g(e.start)}`;for(const e of p)for(let t=0;t<e.length;t++){const i=e[t].vector,s=e[(t+1)%e.length].vector,r=new n.FM(i,s),o=v(r),a=y(r),l=g(i);f.has(o)||f.has(a)||(f.add(o),f.add(a),this.lines.push(r)),m.has(l)||(m.add(l),this.points.push(new n.UQ(i)))}yield}cullPath(e,t){const i=new s.Vector3,n=new s.Vector3;let r=!0;for(;r;){r=!1;for(let s=0;s<e.length&&e.length>2;s++){const o=e[0===s?e.length-1:s-1].vector,a=e[s].vector,l=e[(s+1)%e.length].vector;i.copy(o).sub(a),n.copy(l).sub(a),t(i,n)||(e.splice(s,1),r=!0,s--)}}}*mergeSurfacesByNormal(e,t,i=5){let n=-1,s=0;for(;0!==n&&s++<i;){a.debug(`Merging surfaces by normal angle threshold: ${t}`);const i=Math.cos(o.Ue*t);n=0;let s=0;for(const t of e){s++%1e3==0&&(yield);for(const e of t.vertices)for(const s of e.faces){const e=s.surface;t.surface!==e&&t.surface.normal.dot(e.normal)>=i&&(t.surface.faces.length>e.faces.length?t.surface.mergeSurfaces(e):e.mergeSurfaces(t.surface),n++)}}n&&a.debug(`Merged ${n} surfaces by normal...`)}}}var d=i(81890),h=i(74384),u=i(76863),p=i(91466);const m=new r.Z("snapcaster");var f;!function(e){e[e.UNINITIALIZED=0]="UNINITIALIZED",e[e.WORKING=1]="WORKING",e[e.READY=2]="READY"}(f||(f={}));class Snapcaster{constructor(e,t,i){this.cameraData=e,this.raycastPicker=t,this.engine=i,this.meshes=new Map,this.newMeshes=new Set,this.raycaster=new s.Raycaster,this.filterSnapFeature=e=>{var t,i;const{meshName:n}=e;return!n||!1!==(null===(i=null===(t=this.meshes.get(n))||void 0===t?void 0:t.filter)||void 0===i?void 0:i.call(t,e))},this.cast=(e,t,i,r)=>{let o;i&&r&&(o=(new s.Plane).setFromNormalAndCoplanarPoint(r,i)),this.raycaster.set(e.origin,e.direction);const a=this.snappingOctree.raycast(this.raycaster,t,this.filterSnapFeature)||[],l=e=>{let t=(1+e.distance)*(1+e.distanceToRay)**2;return e.object instanceof n.UQ&&(t/=10),o&&o.distanceToPoint(e.point)<-.2&&(t+=10),t};return a.sort(((e,t)=>l(e)-l(t))),a},this.pick=(e,t,i,n,r)=>{i||(i=this.cast(e,t,n,r));let o=null;const a=new s.Vector3;for(const t of i){a.copy(t.point).sub(e.origin).normalize();const i=this.raycastPicker.pick(e.origin,a,u.Pv);if(!i||i.distance>t.distance-.05){o=t;break}}return o?{isLineOctreeIntersection:!0,distance:o.distance,distanceToRay:o.distanceToRay,point:o.point,object:o.object}:null},this.add=(...e)=>{for(const t of e)this.snappingOctree.add(t)},this.remove=(...e)=>{for(const t of e)this.snappingOctree.remove(t)}}get snappingOctree(){return this.preloadMeshSnapping(),this._snappingOctree}setupOctree(e){this._snappingOctree=new n.ZP(e)}async preloadMeshSnapping(){var e;!this.populateProcess&&this.newMeshes.size&&(this.populateProcess=await this.engine.commandBinder.issueCommand(new d.S("snapping",this.buildSnappingForMeshes(),6e4)),await(null===(e=this.populateProcess)||void 0===e?void 0:e.promise),this.populateProcess=null)}*buildSnappingForMeshes(){const e=new s.Vector3;for(;;){let t=null;for(const i of this.newMeshes){const n=this.meshes.get(i);if(n){const{geometry:s}=n;if(!s){m.error("No mesh to generate snapping information from!"),n.status=f.READY;continue}const r=(0,h.A5)(s).getCenter(e).distanceTo(this.cameraData.pose.position);(!t||r<t.distance)&&(t={meshName:i,geometry:s,distance:r,info:n})}}if(!t)break;this.newMeshes.delete(t.meshName),t.info.status=f.WORKING,yield*this.buildSnappingForGeometry(t.geometry,t.info),t.info.status=f.READY,t.info.geometry=null,yield}m.info(`Snapping found ${this._snappingOctree.pointCount} points and ${this._snappingOctree.lineCount} lines`)}*buildSnappingForGeometry(e,t){e.computeVertexNormals(),yield;const i=new SurfaceEdgeFinder;yield*i.run(e),m.debug(`Mesh done, added ${i.points.length} points and ${i.lines.length} lines`);for(const e of i.points)e.meshName=t.meshName,e.meta=t.meta,this._snappingOctree.add(e);for(const e of i.lines)e.meshName=t.meshName,e.meta=t.meta,this._snappingOctree.add(e);this.engine.broadcast(new SurfaceEdgeFinderCompleteMessage(i))}forEachSnapFeature(e,t=!1){this.snappingOctree.traverse((i=>{t&&!this.filterSnapFeature(i)||e(i)}))}addMeshGeometry(e,t,i,n){this.meshes.has(e)||(this.meshes.set(e,{meshName:e,geometry:t,status:f.UNINITIALIZED,meta:i,filter:n}),this.newMeshes.add(e))}removeMeshGeometry(e){const t=this.meshes.get(e);t&&t.status===f.UNINITIALIZED&&(this.meshes.delete(e),this.newMeshes.delete(e))}}class SurfaceEdgeFinderCompleteMessage extends p.v{constructor(e){super(),this.edgeFinder=e}}},44019:(e,t,i)=>{"use strict";i.d(t,{P:()=>RaycasterData,E:()=>RaycastHit});var n=i(2212),s=i(32770);class RaycasterData extends s.V{constructor(){super(...arguments),this.name="pointer",this.hit=null,this.hits=[],this.pointerNdcPosition=new n.Vector2,this.pointerScreenPosition=new n.Vector2,this.pointerOrigin=new n.Vector3,this.pointerDirection=new n.Vector3,this.pointerRay=new n.Ray}}class RaycastHit{constructor(e,t,i,n){this.point=e,this.normal=t,this.object=i,this.intersection=n,this.face={normal:t}}}},71291:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RaycasterModule});var n=i(47724),s=i(96909),r=i(2212),o=i(19674),a=i(74384);class ColliderNode{constructor(){this.parent=null,this.raycastDistance=1/0,this.distance=1/0}updateRaycastDistance(e){this.raycastDistance=this.bounds.distanceToPoint(e)}updateDistanceToBounds(e){this.distance=this.bounds.distanceToPoint(e)}}class ColliderMeshTarget extends ColliderNode{constructor(e){super(),this.mesh=e,this.bounds=(0,a.A5)(this.mesh.geometry).clone().applyMatrix4(this.mesh.matrixWorld),this.center=this.bounds.getCenter(new r.Vector3)}raycast(e,t){this.mesh.visible&&this.mesh.raycast(e,t)}nearestPointOnGeometry(e){const t=e.clone().applyMatrix4((new r.Matrix4).copy(this.mesh.matrixWorld).invert());let i;const n=this.mesh.geometry.boundsTree;return i=n?n.closestPointToPoint(t):(0,a.GO)(this.mesh.geometry,t),i?(i.point.applyMatrix4(this.mesh.matrixWorld),{object:this.mesh,point:i.point,distance:i.point.distanceTo(e),faceIndex:i.faceIndex}):null}}class ColliderOctreeNode extends ColliderNode{constructor(e,t,i){super(),this.level=t,this.leafMinSize=i,this.childNodes=[],this.children=[],this.listeners={},this.bounds=e.clone(),this.size=e.getSize(new r.Vector3),this.center=e.getCenter(new r.Vector3)}get depth(){return this.level}*addMeshes(e){e.updateMatrixWorld(!0);const t=[];e.traverse((e=>{e instanceof r.Mesh&&e.geometry&&t.push(e)}));for(const e of t)this.addMesh(new ColliderMeshTarget(e))}removeMeshes(e){let t=!1;for(let i=0;i<this.children.length;i++){const n=this.children[i];n instanceof ColliderMeshTarget&&n.mesh.id===e.id&&(n.parent=null,this.children.splice(i,1),this.emit("removed",this,n),t=!0)}if(!t)throw new Error("Mesh that is being attempted removed does not exist in this node.")}addMesh(e){let t=!1;if(this.size.length()>this.leafMinSize){0===this.childNodes.length&&this.buildChildNodes();for(const i of this.childNodes)i.bounds.containsBox(e.bounds)&&(t=!0,i.addMesh(e))}t||this.add(e)}add(e){if(e.parent)throw new Error("ColliderNode already has a parent, remove before trying to add in another node");e.parent=this,this.children.push(e),this.emit("added",this,e)}buildChildNodes(){const e=this.size.multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let n=0;n<2;n++){const s=this.bounds.min.x+e.x*n,o=s+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,d=c+e.z,h=new r.Box3(new r.Vector3(s,a,c),new r.Vector3(o,l,d)),u=new ColliderOctreeNode(h,this.level+1,this.leafMinSize);this.childNodes.push(u),this.add(u)}}raycast(e,t){if(!0===e.ray.intersectsBox(this.bounds))for(const i of this.children)i.raycast(e,t)}pick(e,t,i){if(!e.ray.intersectsBox(this.bounds))return t;for(const t of this.children)t.updateRaycastDistance(e.ray.origin);this.children.sort(((e,t)=>e.raycastDistance-t.raycastDistance));for(const n of this.children){if(t&&t.distance<n.raycastDistance)break;if(i(n))if(n instanceof ColliderOctreeNode)t=n.pick(e,t,i);else{const i=[];n.raycast(e,i);for(const e of i)(!t||t.distance>e.distance)&&(t=e)}}return t}nearestTo(e,t,i=null){for(const t of this.children)t.updateDistanceToBounds(e);this.children.sort(((e,t)=>e.distance-t.distance));for(const n of this.children){if(0!==n.distance&&i&&i.distance<n.distance)break;if(t(n))if(n instanceof ColliderOctreeNode)i=n.nearestTo(e,t,i);else if(n instanceof ColliderMeshTarget){const t=n.nearestPointOnGeometry(e);if(t){(!i||i.distance>t.distance)&&(i=t)}}}return i}getAllBounds(e,t=0,i=1/0,n=!1){for(const s of this.children)this.level>=t&&this.level<=i&&(n||e.push(s.bounds.clone())),s instanceof ColliderOctreeNode&&s.getAllBounds(e,t,i,n)}emit(e,...t){const i=this.listeners[e]||[];for(const e of i)e(...t);this.parent&&this.parent.emit(e,...t)}on(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t)}}class OctreeCollider{constructor(e,t){this.meshToNodes={},this._depth=0;const i=(0,o.rj)(e);this.root=new ColliderOctreeNode(i,0,t),this.root.on("added",((e,t)=>{e.depth>this._depth&&(this._depth=e.depth),t instanceof ColliderMeshTarget&&(this.meshToNodes[t.mesh.id]||(this.meshToNodes[t.mesh.id]=[]),this.meshToNodes[t.mesh.id].push(t))})),this.root.on("removed",((e,t)=>{if(t instanceof ColliderMeshTarget){const e=this.meshToNodes[t.mesh.id];for(let i=0;i<e.length;i++)e[i]===t&&e.splice(i,1)}}))}get depth(){return this._depth}*addMeshesAsync(e){yield*this.root.addMeshes(e)}addMeshes(e){for(const t of this.root.addMeshes(e));}removeMeshes(e){e.traverse((e=>{const t=this.meshToNodes[e.id]||[];for(const i of t)i.parent&&i.parent.removeMeshes(e)}))}raycast(e){const t=[];return this.root.raycast(e,t),t}getAllBounds(e=0,t=1/0,i=!1){const n=[];return this.root.getAllBounds(n,e,t,i),n}pick(e,t){const i=e.firstHitOnly;e.firstHitOnly=!0;const n=this.root.pick(e,null,(e=>!(t&&e instanceof ColliderMeshTarget)||t(e.mesh)));return e.firstHitOnly=i,n}nearestMeshTo(e,t){const i=this.root.bounds.clampPoint(e,new r.Vector3);return this.root.nearestTo(i,(e=>!(t&&e instanceof ColliderMeshTarget)||t(e.mesh)))}getDebugBoundsMesh(e=16777215,t=0,i=1/0,n=!1){const s=this.getAllBounds(t,i,n),o=new r.LineBasicMaterial({color:e});if(s.length>0){const e=[];for(const t of s){const i=new r.Box3Helper(t);e.push(i.geometry)}const t=(0,a.qf)(e);return new r.LineSegments(t,o)}return new r.LineSegments(new r.BufferGeometry,o)}}class Raycaster{constructor(e,t){this.camera=e,this.defaultRaycastFilter=t,this.meshes={},this.octreeEnabledMeshes={},this.meshFilters=new Map,this.raycaster=new r.Raycaster,this.prevRay=new r.Ray,this._hitCache=[],this.getOctree=()=>this.octree}init(){this.raycaster=new r.Raycaster,this.raycaster.camera=this.camera,this.raycaster.params.Line&&(this.raycaster.params.Line.threshold=.1)}dispose(){this._hitCache.length=0,this.meshes={}}cast(e,t,i){if(e&&t&&(this.prevRay.copy(this.raycaster.ray),this.raycaster.set(e,t)),this.prevRay.equals(this.raycaster.ray))return this._hitCache;if(this.raycaster.layers.mask=this.camera.layers.mask,this._hitCache.length=0,this.octree){const e=this.getRaycastFilter(l.OctreeMeshes,i),t=this.octree.pick(this.raycaster,e);t&&this._hitCache.push(t)}const n=this.getRaycastFilter(l.DynamicMeshes,i);for(const e in this.meshes){const t=this.meshes[e];if(n(t)){const e=this.raycaster.intersectObject(t,!0);this._hitCache=this._hitCache.concat(e)}}return this._hitCache.sort(this.sortIntersectionsByDistance),this.prevRay.copy(this.raycaster.ray),this._hitCache}pick(e,t,i){this.raycaster.set(e,t);const n=this.getRaycastFilter(l.OctreeMeshes,i);return this.octree.pick(this.raycaster,n)}nearest(e,t){return this.octree.nearestMeshTo(e,this.getRaycastFilter(l.OctreeMeshes,t))}setupOctree(e){this.octree=new OctreeCollider(e,.5);for(const e of Object.keys(this.meshes))if(this.octreeEnabledMeshes[e]){const t=this.meshes[e];this.octree.addMeshes(t)}return this.octree}addTarget(e,t,i){const n=e,s=n.collider?n.collider:e;this.meshes[e.id]=s,i&&this.meshFilters.set(s,i),this.octreeEnabledMeshes[e.id]=t,this.octree&&t&&(this.octree.addMeshes(e),e.traverse((e=>{e instanceof r.Mesh&&(this.octreeEnabledMeshes[e.id]=t,i&&this.meshFilters.set(e,i))})))}removeTarget(e){this.octree&&this.octreeEnabledMeshes[e.id]&&(this.octree.removeMeshes(e),this.octreeEnabledMeshes[e.id]=!1,e.traverse((e=>{e instanceof r.Mesh&&(this.octreeEnabledMeshes[e.id]=!1,this.meshFilters.delete(e))})));const t=this.meshes[e.id];t&&(this.meshFilters.delete(t),delete this.meshes[e.id])}getRaycastFilter(e,t){const i=t||this.defaultRaycastFilter,n=t=>{const i=this.octreeEnabledMeshes[t.id];switch(e){case l.DynamicMeshes:return!i;case l.OctreeMeshes:return i}};return e=>n(e)&&i(e)&&this.checkMeshSpecificFilter(e)}checkMeshSpecificFilter(e){const t=this.meshFilters.get(e);return!t||t(e)}sortIntersectionsByDistance(e,t){return e.distance>t.distance?1:e.distance<t.distance?-1:0}render(){}activate(){}deactivate(){}}var l;!function(e){e[e.OctreeMeshes=0]="OctreeMeshes",e[e.DynamicMeshes=1]="DynamicMeshes"}(l||(l={}));var c=i(44019),d=i(1894),h=i(27687);class RaycastPointerScreen{constructor(e,t){this.raycaster=e,this.cameraData=t,this.lastHits=[],this.lastRay=new r.Ray(new r.Vector3(1,1,1),new r.Vector3(0,1,0)),this.currentRay=new r.Ray,this.pointer=new r.Vector2(-2,-2),this.origin=new r.Vector3,this.direction=new r.Vector3,this.cast=()=>{const e=this.pointerRay;return this.lastRay.equals(e)||(this.lastHits=this.raycaster.cast(e.origin,e.direction).slice(),this.lastRay.copy(e)),this.lastHits},this.updatePointer=e=>{this.pointer.distanceToSquared(e)>2e-5&&this.pointer.set(e.x,e.y)}}get pointerRay(){const{origin:e,direction:t}=this.updateDirections();return this.currentRay.set(e,t)}get ndcPosition(){return this.pointer}updateDirections(){return(0,h.Kh)(this.cameraData.pose,this.origin.set(this.pointer.x,this.pointer.y,-1),this.origin),(0,h.Kh)(this.cameraData.pose,this.direction.set(this.pointer.x,this.pointer.y,1),this.direction),this.direction.sub(this.origin).normalize(),{origin:this.origin,direction:this.direction}}}class RaycastPointerDataUpdate{constructor(e,t,i){this.raycaster=e,this.data=t,this.cameraData=i,this.cache={normal4:new r.Vector4,normal:new r.Vector3,rotationMatrix:new r.Matrix4,ndc3:new r.Vector3}}beforeRender(){if(this.raycaster.pointer.pointerRay.equals(this.data.pointerRay))return;this.data.pointerRay.copy(this.raycaster.pointer.pointerRay),this.data.pointerOrigin.copy(this.data.pointerRay.origin),this.data.pointerDirection.copy(this.data.pointerRay.direction);const e=this.raycaster.pointer.cast();if(this.data.hits.length=0,this.data.hits.push(...e),this.data.pointerNdcPosition.copy(this.raycaster.pointer.ndcPosition),this.cache.ndc3.set(this.data.pointerNdcPosition.x,this.data.pointerNdcPosition.y,.5),this.data.pointerScreenPosition.copy((0,h.fi)(this.cameraData.width,this.cameraData.height,this.cache.ndc3)),e.length>0){const t=e[0];if(t&&t.face){const e=t.face.normal;this.cache.normal4.set(e.x,e.y,e.z,0),this.cache.rotationMatrix.extractRotation(t.object.matrixWorld),this.cache.normal4.applyMatrix4(this.cache.rotationMatrix),this.cache.normal.set(this.cache.normal4.x,this.cache.normal4.y,this.cache.normal4.z),this.data.hit=new c.E(t.point.clone(),this.cache.normal.clone(),t.object,t)}}else this.data.hit=null;this.data.commit()}init(){}render(){}dispose(){}activate(){}deactivate(){}}var u=i(59088),p=i(76863),m=i(26128),f=i(15443);class RaycasterModule extends n.Y{constructor(){super(...arguments),this.name="raycaster",this.raycasterPointerData=new c.P,this.overridePointer=null,this.setOverridePointer=e=>{this.overridePointer=e}}async init(e,t){t.market.register(this,c.P,this.raycasterPointerData);const[i,n]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(u.M_)]),r=i.getCamera();this.raycaster=new Raycaster(r,p.Nr),t.addComponent(this,this.raycaster),this.defaultPointer=new RaycastPointerScreen(this.raycaster,n),this.snapcaster=new d.n(n,this.raycaster,t);const o=new RaycastPointerDataUpdate(this,this.raycasterPointerData,n);t.addComponent(this,o),t.broadcast(new m.em(f.Y.Raycaster)),t.broadcast(new m.em(f.Y.Octree)),t.broadcast(new m.em(f.Y.Snapping))}dispose(){}setupOctree(e){this.raycaster.setupOctree(e),this.snapcaster.setupOctree(e)}getOctree(){return this.raycaster.getOctree()}get pointer(){return null!==this.overridePointer?this.overridePointer:this.defaultPointer}get targets(){return this.raycaster}get picking(){return this.raycaster}get snapping(){return this.snapcaster}}},87202:(e,t,i)=>{"use strict";i.d(t,{oM:()=>RequestRenderTargetCommand,sH:()=>Context2dCaptureCommand,vU:()=>ScreenCaptureCommand,sp:()=>RenderToCubemapCommand,fZ:()=>EquirectangularCommand,ep:()=>ComposeTargetsCommand});var n=i(17386);class RequestRenderTargetCommand extends n.m{constructor(){super(...arguments),this.id="RequestRenderTargetCommand"}}class Context2dCaptureCommand extends n.m{constructor(e,t){super(),this.payload={renderTarget:e,context:t}}}class ScreenCaptureCommand extends n.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class RenderToCubemapCommand extends n.m{constructor(e,t,i){super(),this.payload={renderTarget:e,sceneObject:t,camera:i}}}class EquirectangularCommand extends n.m{constructor(e,t,i=0){super(),this.payload={renderTarget:e,texture:t,heading:i}}}class ComposeTargetsCommand extends n.m{constructor(e,t){super(),this.payload={target1:e,target2:t}}}},32306:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RenderToTexture});var n=i(47724),s=i(96909),r=i(84561),o=i(2212);const a={circle_projection:new o.RawShaderMaterial({uniforms:{textureSampleScale:{value:5},panoTexture:{value:null},borderSize:{value:0},borderColor:{value:new o.Vector4(1,1,1,1)}},depthWrite:!1,depthTest:!0,side:o.DoubleSide,vertexShader:i(74624),fragmentShader:i(57223)}),equirectangular:new o.RawShaderMaterial({uniforms:{cubemap:{value:null},yaw:{value:0}},depthWrite:!1,depthTest:!1,vertexShader:i(64799),fragmentShader:i(72488)}),compose:new o.RawShaderMaterial({uniforms:{mask:{value:null},bg:{value:null}},transparent:!0,vertexShader:i(47151),fragmentShader:i(14499)}),copyOpaque:new o.RawShaderMaterial({uniforms:{texture:{value:null}},vertexShader:i(95611),fragmentShader:i(54779)})};var l=i(53225),c=i(87202);class RenderTarget{constructor(e,t){this._renderer=e,this._renderTarget=t}get target(){return this._renderTarget}get width(){return this._renderTarget.width}get height(){return this._renderTarget.height}get bpp(){return 4}readRenderTargetData(e){const t=this._renderTarget.width,i=this._renderTarget.height;return e=e||new Uint8Array(t*i*4),this._renderer.readRenderTargetPixels(this._renderTarget,0,0,t,i,e),e}setSize(e,t){this._renderTarget.setSize(e,t)}dispose(){this._renderTarget.dispose()}}var d=i(84303),h=i(74384);class RenderToTexture extends n.Y{constructor(){super(...arguments),this.name="render-to-texture",this.circleProjectionPlane=new l.E((0,h.fc)(),a.circle_projection),this.equirectProjectionPlane=new l.E((0,h.fc)(),a.equirectangular),this.composePlane=new l.E((0,h.fc)(),a.compose),this.copyPlane=new l.E((0,h.fc)(),a.copyOpaque),this.cachedSize=new o.Vector2,this.cachedViewport=new o.Vector4,this.cachedViewport2=new o.Vector4,this.solidWhiteTexture=new o.DataTexture(new Uint8Array([255,255,255,255]),1,1),this.debugRenderOffset=0}async init(e,t){this.engine=t;const i=await t.getModuleBySymbol(s.y.WEBGL_RENDERER);this.cwfRenderer=i.cwfRenderer,this.renderer=i.cwfRenderer.renderer,this.camera=new o.Camera,this.orthoCamera=new o.OrthographicCamera(-.5,.5,.5,-.5,0,1),this.camera.layers.mask=r.o.ALL.mask,this.scene=new o.Scene,this.scene.name="rtt",this.scene.autoUpdate=!1,this.bindings.push(t.commandBinder.addBinding(c.oM,(async e=>new RenderTarget(this.renderer,this.createRenderTarget2D(0))))),this.bindings.push(t.commandBinder.addBinding(c.sH,(async e=>{this.renderContext(e.renderTarget.target,e.context)}))),this.bindings.push(t.commandBinder.addBinding(c.vU,(async e=>{this.render(e.renderTarget.target,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(c.fZ,(async e=>{this.renderEquirectangular(e.texture,e.renderTarget.target,e.heading)}))),this.bindings.push(t.commandBinder.addBinding(c.sp,(async e=>{this.render(e.renderTarget,e.sceneObject,e.camera)}))),this.bindings.push(t.commandBinder.addBinding(c.ep,(async e=>{this.compose(e.target1.target,e.target2.target,e.target2.target)})))}getRenderSize(){const e=this.renderer.getPixelRatio(),t=this.renderer.getSize(this.cachedSize);return t.width*=e,t.height*=e,t}onUpdate(){this.debugRenderOffset=0}createRenderTarget2D(e,t=e,i,n=!0){const s=new o.WebGLRenderTarget(e,t,i);return s.texture.generateMipmaps=n,s}clearRenderTarget2D(e){this.renderer.setRenderTarget(e),this.renderer.clear(),this.renderer.setRenderTarget(null)}disposeRenderTarget2D(e){e.texture.dispose(),e.depthTexture&&e.depthTexture.dispose(),e.dispose()}getRenderTargetData(e,t){const i=e.width,n=e.height;return t=t||new Uint8Array(i*n*4),this.renderer.readRenderTargetPixels(e,0,0,i,n,t),t}compose(e,t,i=this.solidWhiteTexture){const{uniforms:n}=this.composePlane.material;n.bg.value=this.isRenderTarget(t)?t.texture:t,n.mask.value=this.isRenderTarget(i)?i.texture:i,this.scene.add(this.composePlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.composePlane),n.bg.value=null,n.mask.value=null}copyTextureOpaque(e,t){const{uniforms:i}=this.copyPlane.material;i.texture.value=t&&this.isRenderTarget(t)?t.texture:t,this.scene.add(this.copyPlane),this.overrideRenderTarget(e,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.copyPlane),i.texture.value=null}copyTexture(e,t){return t.format===o.RGBFormat?this.copyTextureOpaque(e,t):this.compose(e,t)}resizeTexture(e,t){const i=new o.WebGLRenderTarget(t,t);return e.isCompressedTexture?i.texture.format=o.RGBAFormat:i.texture.format=e.format,i.texture.addEventListener("dispose",i.dispose.bind(i)),this.copyTexture(i,e),i.texture}renderToScreen(e,t=!0,i,n){(t?Promise.resolve():this.engine.after(d.A.Render)).then((()=>{const t=this.isRenderTarget(e)?e.width:e.image.width,s=this.isRenderTarget(e)?e.height:e.image.height,r=i?i.x:this.debugRenderOffset,o=i?i.y:60;this.renderer.getViewport(this.cachedViewport),this.renderer.setViewport(r,o,t,s),this.compose(null,e,n),this.renderer.setViewport(this.cachedViewport),i||(this.debugRenderOffset+=t+4)}))}isRenderTarget(e){return e.hasOwnProperty("texture")}renderContext(e,t){e.texture.image=t.canvas,e.texture.needsUpdate=!0}render(e,t,i,n){const s=t.parent;if(s&&this.scene.applyMatrix4(s.matrixWorld),this.scene.add(t),e.isWebGLCubeRenderTarget){const t=new o.CubeCamera(.01,1e3,e);i.getWorldPosition(t.position),i.getWorldQuaternion(t.quaternion),this.scene.add(t),this.scene.updateMatrixWorld(),t.layers.mask=n?n.mask:i.layers.mask,t.update(this.renderer,this.scene),this.scene.remove(t)}else{i.getWorldPosition(this.camera.position),i.getWorldQuaternion(this.camera.quaternion),this.camera.projectionMatrix.copy(i.projectionMatrix),this.camera.layers.mask=n?n.mask:i.layers.mask;const t=this.renderer.getSize(this.cachedSize),s=t.width/t.height,r=e.width/e.height,o=this.camera.projectionMatrix;s>r?o.elements[0]=o.elements[5]/r:o.elements[5]=o.elements[0]*r,this.overrideRenderTarget(e,(()=>{this.renderer.clear(),this.renderer.render(this.scene,this.camera)}))}return s&&(s.add(t),this.scene.matrixWorld.identity()),this.scene.remove(t),e}setScissors(e,t){if(e){if(!t)throw Error("Rect to restrict rendering to required when enabling scissors.");this.renderer.setScissorTest(!0),this.renderer.setScissor(t.x,t.y,t.width,t.height)}else{const e=this.renderer.getSize(this.cachedSize);this.renderer.setScissor(0,0,e.width,e.height),this.renderer.setScissorTest(!1)}}renderSphericalProjection(e,t,i,n,s){const r=a.circle_projection;r.uniforms.borderColor.value.copy(s||new o.Vector4(1,1,1,1)),r.uniforms.borderSize.value=n||0,r.uniforms.textureSampleScale.value=i||5,r.uniforms.panoTexture.value=e,this.scene.add(this.circleProjectionPlane),this.circleProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.circleProjectionPlane),r.uniforms.panoTexture.value=null}renderEquirectangular(e,t,i=0){const n=this.equirectProjectionPlane.material;n.uniforms.cubemap.value=e,n.uniforms.yaw.value=i,this.scene.add(this.equirectProjectionPlane),this.equirectProjectionPlane.position.z=0,this.overrideRenderTarget(t,(()=>{this.renderer.render(this.scene,this.orthoCamera)})),this.scene.remove(this.equirectProjectionPlane),n.uniforms.cubemap.value=null,n.uniforms.yaw.value=0}overrideRenderTarget(e,t){const i=this.renderTargetSwap(e);t(),this.renderTargetRestore(i)}renderTargetSwap(e){const t=this.renderer.xr.enabled,i=this.renderer.getRenderTarget(),n=this.renderer.getViewport(this.cachedViewport2);return this.renderer.xr.enabled=!1,this.renderer.setRenderTarget(e),{xr:t,rtt:i,viewport:n}}renderTargetRestore(e){this.renderer.xr.enabled=e.xr,this.renderer.setRenderTarget(e.rtt),this.renderer.setViewport(e.viewport)}renderAndReadAsync(e,t,i){const n=i.buffer;if(!this.renderer.capabilities.isWebGL2)return this.log.debug("renderAsync call webgl2, falling back to sync render/read"),this.render(e.target,e.mesh,e.camera),Promise.resolve(this.getRenderTargetData(e.target,n));const s=this.renderTargetSwap(e.target),r=this.renderer.getContext(),o=i.webglBuffer||r.createBuffer();if(!o)throw Error("Unable to create pack buffer");return r.bindBuffer(r.PIXEL_PACK_BUFFER,o),r.bufferData(r.PIXEL_PACK_BUFFER,n.byteLength,r.DYNAMIC_READ),e.clear&&this.renderer.clear(),this.renderer.render(e.mesh,e.camera),r.readPixels(t.x,t.y,t.width,t.height,r.RGBA,r.UNSIGNED_BYTE,0),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),this.renderTargetRestore(s),this.cwfRenderer.fence(r).then((()=>(r.bindBuffer(r.PIXEL_PACK_BUFFER,o),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,n),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),i.webglBuffer||r.deleteBuffer(o),n)))}}},1466:(e,t,i)=>{"use strict";i.d(t,{vP:()=>r,Xk:()=>o,jJ:()=>a,fY:()=>l});var n=i(10757);let s=null;const r=async(e,t)=>{const n=new Uint8Array(e.width*e.height*4);if(e.readRenderTargetData(n),!s){const e=await Promise.all([i.e(764),i.e(524),i.e(718)]).then(i.bind(i,94656));s=e.createJpegEncodeWorker()}const r=n.buffer,o=await s.exec({data:r,width:e.width,height:e.height,options:{exif:t,quality:85,flipY:!0}},[r]);return new Uint8Array(o.data)},o=e=>new Blob([e],{type:"image/jpeg"}),a=e=>"data:image/jpg;base64,"+(0,n.$B)(e),l=(e,t,i,n)=>'http://ns.adobe.com/xap/1.0/\0<?xpacket begin="" id="W5M0MpCehiHzreSzNTczkc9d"?><x:xmpmeta xmlns:x="adobe:ns:meta/"><rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"><rdf:Description rdf:about="" xmlns:GPano="http://ns.google.com/photos/1.0/panorama/"><GPano:CroppedAreaImageHeightPixels>'+t+"</GPano:CroppedAreaImageHeightPixels><GPano:CroppedAreaImageWidthPixels>"+e+"</GPano:CroppedAreaImageWidthPixels><GPano:CroppedAreaLeftPixels>0</GPano:CroppedAreaLeftPixels><GPano:CroppedAreaTopPixels>0</GPano:CroppedAreaTopPixels><GPano:FullPanoHeightPixels>"+t+"</GPano:FullPanoHeightPixels><GPano:FullPanoWidthPixels>"+e+"</GPano:FullPanoWidthPixels><GPano:ProjectionType>equirectangular</GPano:ProjectionType><GPano:UsePanoramaViewer>True</GPano:UsePanoramaViewer><GPano:InitialViewHeadingDegrees>"+i+"</GPano:InitialViewHeadingDegrees><GPano:InitialViewPitchDegrees>"+n+'</GPano:InitialViewPitchDegrees><GPano:CaptureSoftware>Matterport Camera</GPano:CaptureSoftware><GPano:StitchingSoftware>Matterport Cloud</GPano:StitchingSoftware></rdf:Description></rdf:RDF></x:xmpmeta><?xpacket end="w"?>'},86488:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RoomData});var n=i(32770),s=i(48715);class RoomData extends n.V{constructor(e){if(super(),this.name="rooms",this.selected=new s.f(null),this._rooms={},this.floorToRoomsMap=new Map,e)for(const t of Object.values(e))this.add(t)}add(e){this._rooms[e.id]=e;const t=this.floorToRoomsMap.get(e.floorId);t?t.push(e):this.floorToRoomsMap.set(e.floorId,[e])}remove(e){const t=this.get(e);if(!t)return;const i=this.floorToRoomsMap.get(t.floorId);if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}delete this._rooms[e]}rooms(){const e=this._rooms,t=Object.keys(this._rooms);return function*(){for(const i of t)yield e[i]}()}get roomCount(){return Object.keys(this._rooms).length}get collection(){return this._rooms}get(e){return this._rooms[e]}getByMeshSubgroup(e){return Object.values(this._rooms).find((t=>t.meshSubgroup===e))}roomsByFloor(e){return this.floorToRoomsMap.get(e)||[]}}},90938:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>RoomDataModule});var n=i(47724),s=i(86488),r=i(75892),o=i(35597),a=i(79548),l=i(88655),c=i(94474),d=i(88512);class Room{constructor(e){this.tags=[],e&&Object.assign(this,e)}}const h=new d.Z("mds-floor-deserializer");class MdsRoomDeserializer{deserialize(e){if(!e||!this.validate(e))return h.debug("Deserialized invalid room data from MDS",e),null;const t=e.dimensions||{},{height:i,width:n,depth:s,areaFloor:r}=t;return new Room({id:e.id,meshSubgroup:e.meshId,floorId:e.floor.id,height:i,width:n,depth:s,areaFloor:r,tags:e.tags})}validate(e){const t=["id","meshId"].every((t=>t in e)),i=e.floor&&e.floor.id&&"number"==typeof e.floor.meshId;return t&&!!i}}class MdsRoomStore extends c.u{constructor(){super(...arguments),this.prefetchKey="data.model.rooms"}async read(e){const t=new MdsRoomDeserializer,i={modelId:this.getViewId()};return this.query(l.GetRooms,i,e).then((e=>{var i,n;const s=null===(n=null===(i=null==e?void 0:e.data)||void 0===i?void 0:i.model)||void 0===n?void 0:n.rooms;if(!s||!Array.isArray(s))return null;return s.reduce(((e,i)=>{const n=t.deserialize(i);return n&&(e[n.id]=n),e}),{})}))}}class RoomDataModule extends n.Y{constructor(){super(...arguments),this.name="room-data",this.visitedRooms={}}async init(e,t){const{baseUrl:i}=e;this.store=new MdsRoomStore({baseUrl:i,readonly:!0});const n=await this.store.read();this.data=new s.Z(n||{}),t.market.register(this,s.Z,this.data);const l=await t.market.waitForData(o.O),c=this.data.roomCount,d=e=>{const i=l.closestMode;this.visitedRooms[e.id]||(this.visitedRooms[e.id]={visitCount:0}),this.visitedRooms[e.id].visitCount++;const n=this.visitedRooms[e.id].visitCount;t.broadcast(new a.D(e.id,e.meshSubgroup,i,n,c,""))},h=await t.market.waitForData(r.Z),u=h.makeSweepChangeSubscription((e=>{if(e){const t=h.getSweep(e);this.data.selected.value=t.roomId,this.data.commit()}})),p=this.data.selected.onChanged((e=>{if(null!==e){const t=this.data.get(e);t&&d(t)}}));this.bindings.push(u,p)}}},79548:(e,t,i)=>{"use strict";i.d(t,{D:()=>RoomVisitedMessage});var n=i(91466);class RoomVisitedMessage extends n.v{constructor(e,t,i,n,s,r){super(),this.roomId=e,this.meshSubgroup=t,this.viewmode=i,this.visitCount=n,this.roomCount=s,this.roomType=r}}},81890:(e,t,i)=>{"use strict";i.d(t,{S:()=>ScheduleProcessCommand});var n=i(17386);class ScheduleProcessCommand extends n.m{constructor(e,t,i,n=1){super(),this.id="SCHEDULE_PROCESS_COMMAND",this.payload={type:e,func:t,maxDelay:i,steps:n}}}},67502:(e,t,i)=>{"use strict";i.d(t,{_:()=>ScheduleTaskCommand});var n=i(17386);class ScheduleTaskCommand extends n.m{constructor(e,t,i){super(),this.id="SCHEDULE_TASK_COMMAND";const n=function*(){return t()}();this.payload={type:e,func:n,maxDelay:i,steps:1}}}},95469:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SchedulerModule});var n,s=i(47724),r=i(58232);class TaskType{constructor(e){this.name=e,this.taskDurations=new r.P(100),this.medianDuration=1}get typicalStepDuration(){return this.medianDuration}addTaskDuration(e){this.taskDurations.push(e),this.taskDurations.index%10==0&&(this.medianDuration=this.taskDurations.median())}}!function(e){e.WAITING="waiting",e.STARTED="started",e.DONE="done"}(n||(n={}));class Scheduler{constructor(){this.tasks=[],this.types={}}getType(e){return this.types[e]||(this.types[e]=new TaskType(e)),this.types[e]}addTask(e){this.tasks.push(e)}update(e){this.tasks=this.tasks.filter((e=>e.status!==n.DONE)),this.tasks.sort(((e,t)=>t.urgency-e.urgency));let t=0;e:for(const i of this.tasks)for(;i.status!==n.DONE;){const n=performance.now(),s=t+i.type.typicalStepDuration>e,r=n>=i.deadline;if(s&&!r)break e;const o=n;i.run();const a=performance.now()-o;i.type.addTaskDuration(a),t+=a}}}var o=i(67502),a=i(81890);class Task{constructor(e,t,i,s){this.type=e,this.func=t,this.deadline=i,this.steps=s,this.status=n.WAITING,this.promise=new Promise(((e,t)=>{this.onSuccess=e,this.onError=t}))}run(){let e;this.status=n.STARTED;try{e=this.func.next()}catch(e){return this.status=n.DONE,void this.onError(e)}this.steps-=1,e.done&&(this.status=n.DONE,this.onSuccess(e.value))}get estimatedDuration(){return this.steps*this.type.typicalStepDuration}get urgency(){const e=this.deadline-performance.now();return e<=0?1e6-e:this.estimatedDuration/e/e}}class SchedulerModule extends s.Y{constructor(){super(...arguments),this.name="scheduler-module",this.scheduler=new Scheduler}async init(e,t){this.engine=t,this.engine.commandBinder.addBinding(o._,(async e=>{const t=new Task(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t})),this.engine.commandBinder.addBinding(a.S,(async e=>{const t=new Task(this.scheduler.getType(e.type),e.func,performance.now()+e.maxDelay,e.steps);return this.scheduler.addTask(t),t}))}onUpdate(e){this.scheduler.update(4)}}},24844:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ScreenshotsModule});var n=i(47724),s=i(96909),r=i(40168),o=i(84561),a=i(60771),l=i(1466),c=i(91670),d=i(2212),h=i(32306),u=i(87202),p=i(35597),m=i(3805),f=i(31278),g=i(5087);class ScreenshotsModule extends n.Y{constructor(){super(...arguments),this.name="screenshots-module",this.capturer=new ScreenCapturer}async init(e,t){this.engine=t,[this.settingsModule,this.canvas,this.renderer,this.renderToTexture]=await Promise.all([t.getModuleBySymbol(s.y.SETTINGS),t.market.waitForData(r.W),t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.getModule(h.default)]),this.settingsModule.registerButton("Debug","Take screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,o.o.ALL)})),this.settingsModule.registerButton("Debug","Take 4k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:2304,width:4096},`image_${e}.jpg`,o.o.ALL)})),this.settingsModule.registerButton("Debug","Take 8k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:4608,width:8192},`image_${e}.jpg`,o.o.ALL)})),this.settingsModule.registerButton("Debug","Take 16k screenshot",(async()=>{const e=Date.now();await this.takeAndDownloadScreenshot({height:9e3,width:16e3},`image_${e}.jpg`,o.o.ALL)})),this.settingsModule.registerButton("Debug","Take FB 3D screenshot",(async()=>{const e=Date.now(),t=this.engine.getRenderLayer("model-mesh"),i=this.engine.getRenderLayer("skybox"),n=t.clone();n.addLayers(i);const s=(await this.engine.market.waitForData(p.O)).currentMode;try{await this.takeAndDownloadScreenshot({height:this.canvas.height,width:this.canvas.width},`image_${e}.jpg`,n),await this.engine.commandBinder.issueCommand(new c.U(c.U.modes.Depth)),await this.engine.commandBinder.issueCommand(new m._i(m.BD.MESH,f.n.Instant)),await this.takeAndDownloadScreenshot({height:Math.floor(this.canvas.height/4),width:Math.floor(this.canvas.width/4)},`image_${e}_depth.jpg`,t)}catch(e){throw this.log.error("Could not take screenshot"),e}finally{await this.engine.commandBinder.issueCommand(new c.U(null)),await this.engine.commandBinder.issueCommand(new m._i(m.KP[s||g.Ey.Panorama]))}}))}async takeAndDownloadScreenshot(e,t,i){this.renderTarget||(this.renderTarget=await this.engine.commandBinder.issueCommandWhenBound(new u.oM));const n=await this.capturer.capture(i,e,this.renderer,this.renderToTexture,this.renderTarget);(0,a.Hx)((0,l.Xk)(n),t)}}class ScreenCapturer{constructor(){this.captureCamera=new d.Camera}async capture(e,t,i,n,s){const{camera:r,scene:o}=i.getScene();return r.getWorldPosition(this.captureCamera.position),r.getWorldQuaternion(this.captureCamera.quaternion),this.captureCamera.projectionMatrix.copy(r.projectionMatrix),this.captureCamera.layers.mask=e.mask,s.setSize(t.width,t.height),n.render(s.target,o,this.captureCamera),await(0,l.vP)(s)}}},4141:(e,t,i)=>{"use strict";i.d(t,{K:()=>SearchResultItem});var n,s=i(86010),r=i(62644);!function(e){e.MATTERTAG="Mattertag",e.LABEL="Label",e.MEASUREMENT="Measurement",e.COMMENT="Comment"}(n||(n={}));const o=new s.v({});class SearchResultItem{constructor(e){this.textParser=o,this.commandBinder=e}onSelect(){this.commandBinder.issueCommand(new r.IL(this))}}},69617:(e,t,i)=>{"use strict";i.d(t,{r:()=>SearchResultsData});var n=i(32770),s=i(75256),r=i(48715);const o=/(==|!=|>|<|>=|<=|~=)/;class SearchResultsData extends n.V{constructor(){super(...arguments),this.activated=(0,r.Y)(!1),this.query=(0,r.Y)(""),this.results=(0,s.C)([]),this.validationError=(0,r.Y)(null),this.isAdvancedSearchEnabled=(0,r.Y)(!1),this.selectedSearchResult=(0,r.Y)(null),this.getIsAdvancedQuery=()=>{const e=this.getQuery();return this.getIsAdvancedSearchEnabled()&&(e=>o.test(e||""))(e)},this.setSelectedSearchResult=e=>{this.selectedSearchResult.value=e}}getQuery(){return this.query.value}setQuery(e){this.query.value=e}getResults(){return this.results.values()}setResults(e){this.results.replace(e)}getValidationError(){return this.validationError.value}setValidationError(e){this.validationError.value=e}setIsAdvancedSearchEnabled(e){this.isAdvancedSearchEnabled.value=e}getIsAdvancedSearchEnabled(){return this.isAdvancedSearchEnabled.value}getSelectedSearchResult(){return this.selectedSearchResult.value}getActivated(){return this.activated.value}setActivated(e){this.activated.value=e}onlyExecuteWhenActivated(e){let t=!1;const i=()=>{this.getActivated()?(e(),t=!1):t=!0};return this.activated.onChanged((e=>{e&&t&&i()})),i}}},62644:(e,t,i)=>{"use strict";i.d(t,{Xv:()=>SearchModeToggleCommand,HA:()=>SendQueryCommand,IL:()=>SelectSearchResultCommand,c6:()=>RegisterSearchGroupCommand,Pe:()=>DeregisterSearchGroupCommand});var n=i(17386);class SearchModeToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class SendQueryCommand extends n.m{constructor(e){super(),this.payload={query:e}}}class SelectSearchResultCommand extends n.m{constructor(e){super(),this.payload={item:e}}}class RegisterSearchGroupCommand extends n.m{constructor(e){super(),this.payload=Object.assign({getSimpleMatches:()=>[],getAdvancedMatches:()=>[]},e)}}class DeregisterSearchGroupCommand extends n.m{constructor(e){super(),this.payload={id:e}}}},69808:(e,t,i)=>{"use strict";i.d(t,{B:()=>n,l:()=>s});const n="features/space-search",s="features/space-search-advanced"},55105:(e,t,i)=>{"use strict";i.d(t,{K:()=>SensorModule});var n=i(47724),s=i(96909),r=i(36371),o=i(12216),a=i(2212);class SensorObserver{constructor(){this.needsUpdate=!0}notify(){this.needsUpdate=!0}}var l=i(61255);class SensorObservable{constructor(e){this.observable=new l.$,this.notifier=new class{constructor(e){this.sensorObservable=e}notify(){this.sensorObservable.observable.notify()}}(this),this.dependencySub=e.sub(this.notifier)}dispose(){this.dependencySub.cancel()}observe(e){return this.observable.observe(e)}}class CameraFrustumVolume{constructor(e){this.cameraData=e,this._forward=new a.Vector3,this.frustum=new a.Frustum,this.frustumTransform=new r.M,this.frustumProjection=new r.M,this.forwardObserver=new SensorObserver,this.frustumObserver=new SensorObserver,this.frustumObservable=new SensorObservable(new CameraDataSubsriber(e)),this.frustumObservable.observe(this.forwardObserver),this.frustumObservable.observe(this.frustumObserver)}dispose(){this.frustumObservable.dispose()}get fovx(){return this.cameraData.fovX()}get fovy(){return this.cameraData.fovY()}get forward(){return this.forwardObserver.needsUpdate&&(this.forwardObserver.needsUpdate=!1,this._forward.copy(o.f.FORWARD),this._forward.applyQuaternion(this.cameraData.pose.rotation)),this._forward}observe(e){return this.frustumObservable.observe(e)}get origin(){return this.cameraData.pose.position}containsPoint(e){return this.updateVolume(),this.frustum.containsPoint(e)}updateVolume(){if(this.frustumObserver.needsUpdate){this.frustumObserver.needsUpdate=!1;const e=this.cameraData.pose;this.frustumTransform.compose(e.position,e.rotation,o.f.UNIT).getInverse(this.frustumTransform),this.frustumProjection.copy(this.cameraData.pose.projection),this.frustum.setFromProjectionMatrix(this.frustumTransform.multiplyMatrices(this.frustumProjection,this.frustumTransform).asThreeMatrix4())}}}class CameraDataSubsriber{constructor(e){this.cameraData=e}sub(e){return this.cameraData.onChanged((()=>e.notify()))}}var c=i(59088);class SensorUpdater{constructor(){this.sensors=new Set}addSensor(e){this.sensors.add(e)}removeSensor(e){this.sensors.delete(e)}update(){for(const e of this.sensors)e.update()}}class SensorDecorator{constructor(e,t,i){this.frustum=e,this.raycaster=t,this.sensorDisposer=i,this.volumeObserver=new SensorObserver,this.sources=new Set,this.dirtySources=new Set,this.sourceWatchers=new Map,this.readingsCache=new Map,this.readingObservable=new l.$,this.raycastDirection=new a.Vector3,this.volumeSub=e.observe(this.volumeObserver)}get origin(){return this.frustum.origin}dispose(){this.volumeSub.cancel(),this.sensorDisposer.disposeSensor(this)}addSource(...e){for(const t of e)this.sources.add(t),this.dirtySources.add(t),this.sourceWatchers.set(t,new SourceWatcher(this.dirtySources,t))}get readings(){return this.readingsCache}update(){this.volumeObserver.needsUpdate?(this.volumeObserver.needsUpdate=!1,this.recomputeAllReadings(),this.readingObservable.notify()):this.dirtySources.size>0&&(this.recomputeDirtyReadings(),this.readingObservable.notify())}recomputeAllReadings(){for(const e of this.sources)this.recomputeReading(e);this.dirtySources.clear()}recomputeDirtyReadings(){for(const e of this.dirtySources)this.recomputeReading(e);this.dirtySources.clear()}recomputeReading(e){this.raycastDirection.copy(e.origin).sub(this.frustum.origin).normalize();const t=this.frustum.origin.distanceToSquared(e.origin),i=this.readingsCache.get(e)||{direction:new a.Vector3};i.inRange=function(e,t){return t.volume.containsPoint(e.origin)}(this,e),i.inView=i.inRange&&this.frustum.containsPoint(e.origin)&&!function(e,t){return!!t&&e>t.distance**2}(t,this.raycaster.picking.pick(this.frustum.origin,this.raycastDirection)),i.direction.copy(this.raycastDirection),i.distanceSq=t,this.readingsCache.set(e,i)}onReadingsUpdated(e){return this.readingObservable.observe(e)}}class SourceWatcher{constructor(e,t){this.sub=t.volume.observe({notify(){e.add(t)}})}dispose(){this.sub.cancel()}}var d=i(94610),h=i(35003),u=i(24764),p=i(13827);const m=(e,t)=>e.type===p.SourceType.BOX?g(t):e.type===p.SourceType.CYLINDER?function(e){const t=new a.CylinderBufferGeometry(.5,.5,1);t.translate(0,.5,0);const i=new a.Mesh(t,new a.MeshBasicMaterial);i.scale.set(.05,.1,.05);const n=new a.MeshBasicMaterial({transparent:!0,opacity:.1,side:a.DoubleSide,depthWrite:!1}),s=new a.Mesh(t,new a.MeshBasicMaterial({wireframe:!0})),r=new a.Mesh(t,n);return r.add(s),e.add(i),e.add(r),{interactionMesh:i,volumeMesh:r,dispose(){e.remove(i),e.remove(r),i.geometry.dispose(),i.material.dispose(),r.geometry.dispose(),r.material.dispose(),s.geometry.dispose(),s.material.dispose()},setColor(e){r.material.color.set(e),s.material.color.set(e)}}}(t):f(t),f=e=>{const t=new a.SphereBufferGeometry(1,20,20),i=new a.Mesh(t,new a.MeshBasicMaterial);i.scale.set(.5,.5,.5);const n=new a.Mesh(t,new a.MeshBasicMaterial({wireframe:!0})),s=new a.Mesh(t,new a.MeshBasicMaterial({transparent:!0,opacity:.1,side:a.DoubleSide,depthWrite:!1}));return s.add(n),e.add(i),e.add(s),{interactionMesh:i,volumeMesh:s,dispose:()=>{e.remove(i),e.remove(s),i.geometry.dispose(),i.material.dispose(),s.geometry.dispose(),s.material.dispose(),n.geometry.dispose(),n.material.dispose()},setColor:e=>{s.material.color.set(e),n.material.color.set(e)}}},g=e=>{const t=new a.BoxBufferGeometry(1,1,1),i=new a.Mesh(t,new a.MeshBasicMaterial);i.scale.set(.1,.1,.1);const n=new a.MeshBasicMaterial({transparent:!0,opacity:.1,side:a.DoubleSide,depthWrite:!1}),s=new a.Mesh(t,n),r=new a.LineSegments(new a.EdgesGeometry(t),new a.LineBasicMaterial);return s.add(r),e.add(i),e.add(s),{interactionMesh:i,volumeMesh:s,dispose:()=>{e.remove(i),e.remove(s),i.geometry.dispose(),i.material.dispose(),s.geometry.dispose(),s.material.dispose(),r.geometry.dispose(),r.material.dispose()},setColor:e=>{s.material.color.set(e),r.material.color.set(e)}}};const v=e=>{if(e.type===p.SourceType.BOX){const t=e;return Object.assign({},t.volume.size)}if(e.type===p.SourceType.CYLINDER){const t=e;return{x:t.volume.radius,y:t.volume.height,z:t.volume.radius}}{const t=e.volume.radius;return{x:t,y:t,z:t}}},y=(new a.Quaternion).identity();function b(e){if(e.type===p.SourceType.BOX){return e.volume.orientation}return y}class VolumeVisualizer{constructor(e,t,i){this.source=e,this.scene=t,this.inputIni=i,this.subs=[],this.stickyHover=!1,this.sourceDirty=!0,this.meshes=m(e,this.scene.scene),this.meshes.interactionMesh.scale.set(.1,.1,.1),this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.interactionMesh.material.color.set(16724312),this.meshes.volumeMesh.scale.set(0,0,0),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.visible=!1;const n=b(e);this.meshes.volumeMesh.quaternion.copy(n);this.mixer=new a.AnimationMixer(this.meshes.volumeMesh);const s=v(e),r=new a.VectorKeyframeTrack(".scale",[0,.4],[0,0,0,s.x,s.y,s.z],a.InterpolateSmooth),o=new a.AnimationClip(void 0,.4,[r]);this.onHoverAction=this.mixer.clipAction(o),this.onHoverAction.clampWhenFinished=!0,this.onHoverAction.loop=a.LoopOnce,this.subs.push(this.inputIni.registerMeshHandler(d.z,u.s.isValue(this.meshes.interactionMesh),(()=>{const e=this.onHoverAction.time;this.onHoverAction.reset(),this.meshes.volumeMesh.visible=!0,this.onHoverAction.timeScale=1,this.onHoverAction.time=e,this.onHoverAction.play()}))),this.subs.push(this.inputIni.registerMeshHandler(d.A,u.s.isValue(this.meshes.interactionMesh),(()=>{if(!this.stickyHover){const e=this.onHoverAction.time;this.onHoverAction.reset(),this.onHoverAction.time=e,this.onHoverAction.timeScale=-1,this.onHoverAction.play()}}))),this.subs.push(this.inputIni.registerMeshHandler(h.R,u.s.isValue(this.meshes.interactionMesh),(()=>{this.stickyHover=!this.stickyHover,this.stickyHover?this.meshes.interactionMesh.material.color.set(4473924):this.meshes.interactionMesh.material.color.set(16724312)}))),this.inputIni.registerMesh(this.meshes.interactionMesh,!1),this.subs.push(e.volume.observe(this))}notify(){this.sourceDirty=!0}update(e,t){if(this.sourceDirty){this.sourceDirty=!1,this.meshes.interactionMesh.position.copy(this.source.origin),this.meshes.volumeMesh.position.copy(this.source.origin),this.meshes.volumeMesh.quaternion.copy(b(this.source));const e=v(this.source),t=this.onHoverAction.getClip().tracks[0].values;t[3]=e.x,t[4]=e.y,t[5]=e.z}this.meshes.setColor(t.inRange?65280:16711680),this.mixer.update(e/1e3)}dispose(){this.meshes.dispose(),this.mixer.stopAllAction();for(const e of this.subs)e.cancel()}}class SensorRenderer{constructor(e,t,i){this.sensor=e,this.scene=t,this.inputIni=i,this.subs=[],this.visuals=new Map}init(){this.subs.push(this.sensor.onReadingsUpdated(this))}render(e){for(const[t,i]of this.sensor.readings){let n=this.visuals.get(t);n||(n=new VolumeVisualizer(t,this.scene,this.inputIni),this.visuals.set(t,n)),n.update(e,i)}}dispose(){}activate(){}deactivate(){for(const e of this.subs)e.cancel();for(const e of this.visuals.values())e.dispose();this.visuals.clear()}notify(){}}class SensorModule extends n.Y{constructor(){super(...arguments),this.name="sensor-module",this.sensorUpdater=new SensorUpdater,this.debugSensor=null,this.sensorDisposer=new class{constructor(e){this.sensors=e}disposeSensor(e){this.sensors.removeSensor(e)}}(this)}async init(e,t){[this.cameraData,this.raycaster,this.renderer,this.inputIni]=await Promise.all([await t.market.waitForData(c.M_),await t.getModuleBySymbol(s.y.RAYCASTER),await t.getModuleBySymbol(s.y.WEBGL_RENDERER),await t.getModuleBySymbol(s.y.INPUT)]),this.cameraVolume=new CameraFrustumVolume(this.cameraData);var i,n,r,o;this.sensorDebuggerFactory=(i=e=>{t.addComponent(this,e)},n=e=>{t.removeComponent(this,e)},r=this.renderer.getScene(),o=this.inputIni,e=>{const t=new SensorRenderer(e,r,o);return i(t),{dispose:()=>{n(t)}}})}dispose(){this.cameraVolume.dispose()}createSensor(e){const t=new SensorDecorator(e,this.raycaster,this.sensorDisposer);return this.sensorUpdater.addSensor(t),t}createCameraBoundSensor(){return this.createSensor(this.cameraVolume)}setDebugSensor(e){this.debugSensor&&(this.debugSensor.dispose(),this.debugSensor=null),e&&(this.debugSensor=this.sensorDebuggerFactory(e))}onUpdate(){this.sensorUpdater.update()}removeSensor(e){this.sensorUpdater.removeSensor(e)}}},13827:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>a,SensorModule:()=>n.K,BoxVolume:()=>s.k,CylinderVolume:()=>r.X,SphereVolume:()=>o.b,SourceType:()=>l});var n=i(55105),s=i(3198),r=i(9576),o=i(88269);const a=n.K;var l;!function(e){e.SPHERE="sourcetype.sphere",e.BOX="sourcetype.box",e.CYLINDER="sourcetype.cylinder"}(l||(l={}))},3198:(e,t,i)=>{"use strict";i.d(t,{k:()=>BoxVolume});var n=i(2212),s=i(61255);class BoxVolume extends s.${constructor(){super(),this.box=new n.Box3,this.center=new n.Vector3,this.size=new n.Vector3(1/0,1/0,1/0),this.orientation=new n.Quaternion,this.inverseOrientation=new n.Quaternion,this.pointCache=new n.Vector3,this.transformNeedsUpdate=!1,this.box.setFromCenterAndSize(this.center,this.size)}get origin(){return this.center}updateCenter(e){this.center.copy(e),this.box.setFromCenterAndSize(this.center,this.size),this.transformNeedsUpdate=!0}updateDimensions(e){this.size.copy(e),this.box.setFromCenterAndSize(this.center,this.size)}updateOrientation(e){this.orientation.copy(e),this.transformNeedsUpdate=!0}containsPoint(e){return this.transformNeedsUpdate&&(this.transformNeedsUpdate=!1,this.inverseOrientation.copy(this.orientation).invert()),this.pointCache.copy(e).sub(this.center),this.pointCache.applyQuaternion(this.orientation),this.pointCache.add(this.center),this.box.containsPoint(this.pointCache)}}},9576:(e,t,i)=>{"use strict";i.d(t,{X:()=>CylinderVolume});var n=i(2212),s=i(61255);class CylinderVolume extends s.${constructor(){super(...arguments),this._basePoint=new n.Vector3,this._height=1/0,this._radius=1/0,this.pointCache=new n.Vector3}get origin(){return this._basePoint}get basePoint(){return this._basePoint}get height(){return this._height}get radius(){return this._radius}updateBasePoint(e){this.basePoint.set(e.x,e.y,e.z)}updateHeight(e){this._height=e}updateRadius(e){this._radius=e}containsPoint(e){return this.pointCache.set(e.x,this._basePoint.y,e.z),this._basePoint.distanceToSquared(this.pointCache)<=this.radius**2&&this._basePoint.y<=e.y&&e.y<=this._basePoint.y+this.height}}},88269:(e,t,i)=>{"use strict";i.d(t,{b:()=>SphereVolume});var n=i(2212),s=i(61255);class SphereVolume extends s.${constructor(){super(...arguments),this.origin=new n.Vector3,this.radius=1/0}updateRadius(e){this.radius=e}updateOrigin(e){this.origin.copy(e)}containsPoint(e){return this.origin.distanceToSquared(e)<=this.radius**2}}},25269:(e,t,i)=>{"use strict";i.d(t,{i:()=>SkySphereMesh});var n=i(2212);class SkySphereMesh extends n.Mesh{}},37238:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SkyboxModule});var n=i(47724),s=i(96909),r=i(2212);const o={sky:{uniforms:{topColor:{type:"v3",value:new r.Vector3(.094,.102,.11)},bottomColor:{type:"v3",value:new r.Vector3(.2,.216,.235)},radius:{type:"f",value:100}},vertexShader:i(13833),fragmentShader:i(55185)}};class SkyboxMaterial extends r.RawShaderMaterial{constructor(e={}){super(Object.assign({fragmentShader:o.sky.fragmentShader,vertexShader:o.sky.vertexShader,uniforms:r.UniformsUtils.clone(o.sky.uniforms),name:"SkyboxMaterial"},e))}}var a=i(84561),l=i(25269),c=i(48358),d=i(63560);class Skybox{constructor(e,t,i,n,s=a.o.ALL){this.scene=e,this.cameraData=t,this.addToRaycasting=i,this.removeFromRaycasting=n,this.renderLayer=s,this.bindings=[]}init(){const{visualMesh:e,colliderMesh:t}=this.setupSkysphere();this.skyVisual=e,this.material=this.skyVisual.material,this.skyCollider=t}dispose(){this.material.uniforms.pano0Map.value.dispose(),this.material.uniforms.pano1Map.value.dispose(),this.material.dispose(),this.skyVisual.geometry.dispose()}activate(e){this.scene.addChild(this.scene.ids.Root,this.skyVisual),this.skyVisual.updateMatrixWorld(!0),this.skyVisual.visible=!0,this.addToRaycasting(this.skyCollider,!1)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings=[],this.scene.removeChild(this.scene.ids.Root,this.skyVisual),this.scene.removeChild(this.scene.ids.CameraRig,this.skyCollider),this.removeFromRaycasting(this.skyCollider)}updateBackgroundColors(e,t){const i=new r.Color(e),n=new r.Color(t);this.material.uniforms.topColor.value.set(i.r,i.g,i.b),this.material.uniforms.bottomColor.value.set(n.r,n.g,n.b)}beforeRender(){this.skyVisual.position.copy(this.cameraData.pose.position),this.skyCollider.position.copy(this.cameraData.pose.position)}render(){}setupSkysphere(e){const t=new r.SphereBufferGeometry(1e4,5,5);t.computeBoundingBox();const i=d.oR.far-10,n=new r.SphereBufferGeometry(i,5,5);n.computeBoundingBox(),e||(e=new SkyboxMaterial({side:r.BackSide}));const s=new l.i(n,e);s.layers.mask=this.renderLayer.mask,s.name="Skysphere",s.renderOrder=c.z.boundingSkybox,s.updateMatrixWorld(!0),e.uniforms.radius.value=i,e.depthWrite=!1,e.depthTest=!1;return{visualMesh:s,colliderMesh:new l.i(t,new r.MeshBasicMaterial({opacity:0,depthWrite:!1,side:r.BackSide}))}}}var h=i(33874),u=i(54243),p=i(3248),m=i(59088);class SkyboxModule extends n.Y{constructor(){super(...arguments),this.name="skybox-module"}async init(e,t){const[i,n,r,o]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(h.e),t.getModuleBySymbol(s.y.INPUT),t.market.waitForData(m.M_)]),a=t.claimRenderLayer("skybox"),l=i.getScene();this.skybox=new Skybox(l,o,r.registerMesh,r.unregisterMesh,a),t.addComponent(this,this.skybox);const c=n.tryGetProperty(p.gx.BackgroundColor,u.z.default);this.skybox.updateBackgroundColors(u.K[c].bgPrimary,u.K[c].bgSecondary),this.bindings.push(n.onPropertyChanged(p.gx.BackgroundColor,(e=>{this.skybox.updateBackgroundColors(u.K[e].bgPrimary,u.K[e].bgSecondary)})))}}},14608:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SnapshotsEditor});var n=i(47724),s=i(96909),r=i(75892),o=i(59088),a=i(5087),l=i(35597),c=i(87202),d=i(1466),h=i(52586),u=i(41862),p=i(37381),m=i(84561),f=i(34369),g=i(7170),v=i(65814),y=i(17386),b=i(53931);class CaptureSnapshotCommand extends y.m{constructor(e){super(),this.id="CAPTURE_SNAPSHOT",this.payload={maxSize:e.maxSize||f.SL.ULTRAHIGH,aspect:e.aspect||b.g$,category:e.category||v.i.USER,onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}class EquirectSnapshotCommand extends y.m{constructor(e){super(),this.id="EQUIRECTANGULAR_SNAPSHOT",this.payload={onProgress:e.onProgress,waitForUpload:void 0===e.waitForUpload||e.waitForUpload}}}var S=i(48715),E=i(79956),T=i(12216),w=i(69626),x=i(91466);class SnapshotErrorMessage extends x.v{constructor(e){super(),this.error=e}}var _=i(31102);class SnapshotCaptureError extends _.y{constructor(e,t="72002"){super(e),this.name="SnapshotCaptureError"}}class SnapshotUploadError extends _.y{constructor(e,t="73002"){super(e),this.name="SnapshotUploadError"}}var M,O=i(27326),A=i(35026),C=i(10757),P=i(29422),D=i(25040);!function(e){e.CAPTURING="capturing",e.UPLOADING="uploading",e.ERROR="error",e.DONE="done"}(M||(M={}));var N=i(43205),I=i(36297);const L=p.Xd.uploadIntervalDelay;class SnapshotsEditor extends n.Y{constructor(){super(...arguments),this.name="snapshots-editor"}async init(e,t){this.engine=t,[this.renderer,this.sweepTilingModule]=await Promise.all([t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.getModuleBySymbol(s.y.SWEEP_PANO)]),[this.sweepData,this.viewmodeData,this.cameraData,this.floorsViewData]=await Promise.all([t.market.waitForData(r.Z),t.market.waitForData(l.O),t.market.waitForData(o.M_),t.market.waitForData(O.c),t.market.waitForData(E.P)]),[this.snapshotTarget,this.snapshotOverlayTarget]=await Promise.all([t.commandBinder.issueCommandWhenBound(new c.oM),t.commandBinder.issueCommandWhenBound(new c.oM)]),this.bindings.push(t.commandBinder.addBinding(CaptureSnapshotCommand,(async e=>{const i=e.onProgress||(0,S.Y)(0);i.value=10,t.commandBinder.issueCommand(new P.ZK),t.commandBinder.issueCommand(new I.M);const n=await this.queryIdealResolution(e.maxSize,e.aspect);this.snapshotTarget.setSize(n.width,n.height),this.snapshotOverlayTarget.setSize(n.width,n.height),await this.fetchHighestAvailable(!1,e.maxSize,(e=>i.value=Math.max(10,e))),await(0,C.gw)(2*L),await this.takeScreenshot();const s=this.sweepData.getSweep(this.sweepData.currentSweep);this.viewmodeData.currentMode===a.Ey.Panorama&&await this.sweepTilingModule.resetSweep(s.id),t.commandBinder.issueCommand(new P.Lp),t.commandBinder.issueCommand(new I.I);let r=e.category;s&&(s.alignmentType===A.z9.UNALIGNED||s.placementType===A.hU.MANUAL)&&r===v.i.USER&&(r=v.i.UNALIGNED);const o=this.uploadAndAddSnapshot(r).then((e=>e&&e.sid)).catch((e=>{throw this.log.error(e),this.engine.broadcast(new SnapshotErrorMessage(e)),e}));return e.waitForUpload?o:null})));const i=T.f.FORWARD.clone(),n=T.f.FORWARD.clone();this.bindings.push(t.commandBinder.addBinding(EquirectSnapshotCommand,(async e=>{const s=e.onProgress||(0,S.Y)(0);s.value=10,t.commandBinder.issueCommand(new P.ZK),await(0,C.gw)(50);const r=this.queryIdealEqResolution();this.snapshotTarget.setSize(r.width,r.height);const o=this.sweepData.getSweep(this.sweepData.currentSweep);i.copy(T.f.FORWARD).applyQuaternion(o.rotation).setY(0),n.copy(T.f.FORWARD).applyQuaternion(this.cameraData.pose.rotation).setY(0);const a=(0,w.k2)(i,n)+Math.PI;await this.fetchHighestAvailable(!0,f.SL.ULTRAHIGH,(e=>s.value=Math.max(10,e))),await this.takeEquirectangular(a),await this.sweepTilingModule.resetSweep(o.id),t.commandBinder.issueCommand(new P.Lp);const l=(0,d.fY)(this.snapshotTarget.width,this.snapshotTarget.height,a,0),c=this.uploadAndAddSnapshot(v.i.PANORAMA,l).then((e=>e&&e.sid)).catch((e=>{throw this.log.error(e),this.engine.broadcast(new SnapshotErrorMessage(e)),e}));return e.waitForUpload?c:null})))}async uploadAndAddSnapshot(e,t){const i=this.createSnapshot(e);i.state=M.CAPTURING,i.imageBlob=(0,d.Xk)(await(0,d.vP)(this.snapshotTarget,t)),i.state=M.UPLOADING;try{return await this.engine.commandBinder.issueCommand(new N.nM(i))}catch(e){throw i.state=M.ERROR,this.log.error(e),new SnapshotUploadError(e)}}createSnapshot(e){const t=this.viewmodeData.isInside();let i=(0,C.DZ)(new Date);if(t){const e=this.sweepData.getSweep(this.sweepData.currentSweep).name;e&&(i=e)}const n=new D.a;return n.name=i,n.category=e,n.is360=t&&!this.sweepData.currentAlignedSweepObject,n.metadata={cameraMode:this.viewmodeData.currentMode,cameraPosition:this.cameraData.pose.position.clone(),cameraQuaternion:this.cameraData.pose.rotation.clone(),orthoZoom:this.viewmodeData.currentMode===a.Ey.Floorplan?this.cameraData.zoom():-1,ssZoom:this.cameraData.zoom(),scanId:t?this.sweepData.currentSweep:void 0,floorId:this.floorsViewData.currentFloorId,floorVisibility:this.floorsViewData.getFloorsVisibility()},n}async queryIdealResolution(e=f.SL.ULTRAHIGH,t){let i=3840,n=i*b.LP;const s=this.renderer.maxTextureSize;if(i>s&&(this.log.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${s}`),i=s,n=i*b.LP),this.viewmodeData.currentMode===a.Ey.Panorama){const r=await this.sweepTilingModule.availableResolution(this.sweepData.currentSweepObject,e),o=h.Z.getPanoSize(r)*(this.cameraData.fovY()*g.MN)/90;i=Math.min(Math.round(o*t),s),n=Math.round(i/t)}return Promise.resolve({width:i,height:n})}queryIdealEqResolution(){let e=4096,t=.5*e;if(this.viewmodeData.currentMode!==a.Ey.Panorama)throw new SnapshotCaptureError("Equirectangular capture is only supported in Panorama mode");const i=this.renderer.maxTextureSize;return e>i&&this.log.warn(`The active gl context does not support 4k x 2k equirectangular capture\nCapture is limited to a max size of ${i}`),e=Math.min(i,e),t=.5*e,{width:e,height:t}}fetchHighestAvailable(e,t=f.SL.ULTRAHIGH,i){if(this.viewmodeData.currentMode===a.Ey.Panorama){const n=this.sweepData.currentSweepObject,s=e?u.v.FullPanorama:u.v.CurrentView;return this.sweepTilingModule.requestResolution(n,t,s,!0).then((e=>{const t=this.sweepTilingModule.waitForQueue(s,e);return i&&t.progress((e=>i(e*SnapshotsEditor.captureProgressFudgeFactor))),t.nativePromise()}))}return i&&i(SnapshotsEditor.captureProgressFudgeFactor),Promise.resolve()}takeScreenshot(){const e=m.o.ALL;e.removeLayers(this.engine.getRenderLayer("grid-underlay")),e.removeLayers(this.engine.getRenderLayer("cursor-mesh")),e.removeLayers(this.engine.getRenderLayer("current-pano-marker"));const t=this.renderer.getScene().scene,i=this.renderer.getScene().camera,n=i.layers.mask;return i.layers.mask=e.mask,this.engine.commandBinder.issueCommand(new c.vU(this.snapshotTarget,t,i)).then((()=>{i.layers.mask=n}))}takeEquirectangular(e){const t=this.sweepData.currentSweep,i=this.sweepTilingModule.getRenderer(),n=i.useTexture(t),s=this.engine.commandBinder.issueCommand(new c.fZ(this.snapshotTarget,n,e));return i.freeTexture(t),s}}SnapshotsEditor.captureProgressFudgeFactor=90},25040:(e,t,i)=>{"use strict";i.d(t,{a:()=>Snapshot});var n=i(23573),s=i(5087),r=i(65814);class Snapshot extends n.T{constructor(){super(),this.category=r.i.USER}clone(){return(new Snapshot).copy(this)}copy(e){return this.sid=e.sid,this.thumbnailUrl=e.thumbnailUrl,this.imageUrl=e.imageUrl,this.name=e.name,this.is360=e.is360,this.category=e.category,this.height=e.height,this.width=e.width,this.created=e.created,this.modified=e.modified,this.visionLabel=e.visionLabel,this.visionName=e.visionName,this.imageBlob=e.imageBlob,this.metadata={cameraMode:e.metadata.cameraMode,cameraPosition:e.metadata.cameraPosition.clone(),cameraQuaternion:e.metadata.cameraQuaternion.clone(),scanId:e.metadata.scanId,orthoZoom:e.metadata.orthoZoom,ssZoom:e.metadata.ssZoom,floorId:e.metadata.floorId,floorVisibility:e.metadata.floorVisibility},this.commit(),this}isInsidePano(){return this.metadata.cameraMode===s.Ey.Panorama&&""!==this.metadata.scanId}refresh(e){this.thumbnailUrl.refreshFrom(e.thumbnailUrl),this.imageUrl.refreshFrom(e.imageUrl)}}},65814:(e,t,i)=>{"use strict";var n;i.d(t,{i:()=>n}),function(e){e.USER="user",e.PANORAMA="panorama",e.UNALIGNED="unaligned",e.AUTO="auto",e.TOUR="tour"}(n||(n={}))},43205:(e,t,i)=>{"use strict";i.d(t,{yz:()=>RenameSnapshotCommand,Ad:()=>DeleteSnapshotCommand,nM:()=>UploadSnapshotCommand});var n=i(17386);class RenameSnapshotCommand extends n.m{constructor(e,t){super(),this.id="RENAME_SNAPSHOT",this.payload={id:e,name:t}}}class DeleteSnapshotCommand extends n.m{constructor(e){super(),this.id="DELETE_SNAPSHOT",this.payload={id:e}}}class UploadSnapshotCommand extends n.m{constructor(e){super(),this.id="UPLOAD_SNAPSHOT",this.payload={snapshot:e}}}},79956:(e,t,i)=>{"use strict";i.d(t,{P:()=>SnapshotsData});var n=i(32770),s=i(10757),r=i(77680);class SnapshotsData extends n.V{constructor(e){super(),this.name="snapshots",this.snapshots={};for(const t in e)this.snapshots[t]=e[t].clone()}get(e){return this.snapshots[e]}get collection(){return this.snapshots}add(e){e.sid=this.validateSid(e.sid),this.snapshots[e.sid]=e,this.updateOnStaleCallbacks(),this.commit()}remove(e){delete this.snapshots[e.sid],this.commit()}validateSid(e){for(;!e||this.snapshots[e];)e=(0,s.O1)(11);return e}set onStale(e){this.hydrate=e,this.updateOnStaleCallbacks()}updateOnStaleCallbacks(){this.hydrate&&(0,r.s)(this.snapshots,(async()=>{const e=await this.hydrate();for(const t in this.snapshots)e&&e[t]&&this.snapshots[t].refresh(e[t])}))}}},68972:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SnapshotsDataModule});var n=i(47724),s=i(5087),r=i(75892),o=i(79956),a=i(70778),l=i(94474),c=i(36651),d=i(12935),h=i(76875),u=i(34031),p=i(19674),m=i(87324),f=i(65814);const g={[s.Ey.Dollhouse]:h.w.DOLLHOUSE,[s.Ey.Floorplan]:h.w.FLOORPLAN,[s.Ey.Panorama]:h.w.PANORAMA,[s.Ey.Outdoor]:h.w.PANORAMA,[s.Ey.Transition]:h.w.MESH,[s.Ey.Orthographic]:h.w.MESH,[s.Ey.Mesh]:h.w.MESH};class MdsSnapshotUploadSerializer{constructor(){}serialize(e,t){const i=[];for(const[n,s]of e.metadata.floorVisibility.entries())if(1===s){const e=t.floorsData.getFloorAtIndex(n);e&&i.push(e.id)}return{label:e.name,contents:{filename:`${e.name}.jpg`,blob:e.imageBlob},snapshotLocation:{anchorId:e.metadata.scanId,visibleFloorIds:i,position:(0,m.m)(p.ep.toVisionVector(e.metadata.cameraPosition)),rotation:(0,m.J5)(p.ep.toVisionCameraQuaternion(e.metadata.cameraQuaternion)),viewMode:g[e.metadata.cameraMode],zoom:e.metadata.cameraMode===s.Ey.Floorplan?e.metadata.orthoZoom:e.metadata.ssZoom},photoType:e.category===f.i.PANORAMA?u.B.EQUIRECTANGULAR:u.B.PHOTO2D}}}class MdsSnapshotStore extends l.u{constructor(){super(...arguments),this.deserializer=new d.f,this.serializer=new MdsSnapshotUploadSerializer,this.prefetchKey="data.model.assets.photos"}async read(e){const t={modelId:this.getViewId()};return this.query(a.GetSnapshots,t,e).then((e=>{var t,i,n;const s=((null===(n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.assets)||void 0===n?void 0:n.photos)||[]).map((e=>this.deserializer.deserialize(e))),r={};for(const e of s)e&&(r[e.sid]=e);return r}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async create(e,t){const i=l.u.baseViewId,n=e.category===f.i.TOUR,s=n?"UploadHighlightReelSnapshot":"UploadModelSnapshot",r=n?a.UploadHighlightReelSnapshot:a.UploadModelSnapshot,o=this.serializer.serialize(e,t);return this.client.upload(r,s,Object.assign(Object.assign({},o),{modelId:i})).then((e=>{var t;return this.deserializer.deserialize(null===(t=e.data)||void 0===t?void 0:t.snapshot)}))}async update(e){const t=l.u.baseViewId,i=await this.client.mutate(a.PatchPhoto,{modelId:t,photoId:e.sid,label:e.name}),n=(0,c.q)(i,"data.patchPhoto");return this.deserializer.deserialize(n)}async delete(e){const t=l.u.baseViewId,i=await this.client.mutate(a.DeletePhoto,{modelId:t,photoId:e});return(0,c.q)(i,"data.deletePhoto")||!1}}var v=i(43205),y=i(91466);class SnapshotCreatedMessage extends y.v{constructor(e){super(),this.snapshot=e}}var b=i(26627);class SnapshotsDataModule extends n.Y{constructor(){super(...arguments),this.name="snapshots-data"}async init(e,t){const{readonly:i,baseUrl:n}=e;this.engine=t,this.store=new MdsSnapshotStore({readonly:i,baseUrl:n});const s=await this.store.read()||{};this.sweepData=await t.market.waitForData(r.Z);for(const e in s)this.processSnapshot(s[e]);this.snapshotsData=new o.P(s),this.snapshotsData.onStale=()=>this.store.read(),t.market.register(this,o.P,this.snapshotsData),i||this.bindings.push(t.commandBinder.addBinding(v.nM,(({snapshot:e})=>this.uploadSnapshot(e))),t.commandBinder.addBinding(v.yz,(({id:e,name:t})=>this.renameSnapshot(e,t))),t.commandBinder.addBinding(v.Ad,(({id:e})=>this.deleteSnapshot(e))))}async uploadSnapshot(e){const t=await this.engine.market.waitForData(b.i),i=await this.store.create(e,{floorsData:t});return i&&(this.processSnapshot(i),this.snapshotsData.add(i),this.engine.broadcast(new SnapshotCreatedMessage(i))),i}async renameSnapshot(e,t){const i=this.snapshotsData.get(e);if(t!==i.name)return i.name=t,i.commit(),this.snapshotsData.commit(),this.store.update(i)}async deleteSnapshot(e){return this.store.delete(e)}processSnapshot(e){const t=e.metadata.cameraMode===s.Ey.Panorama,i=!this.sweepData.isSweepAligned(e.metadata.scanId);if(e.is360=t&&i,t){const t=this.sweepData.getSweep(e.metadata.scanId);t&&e.metadata.cameraPosition.copy(t.position)}e.name.match(/^[0-9.]+_[0-9.]+$/)&&(e.name="")}}},12935:(e,t,i)=>{"use strict";i.d(t,{f:()=>MdsSnapshotDeserializer});var n,s,r=i(2212);!function(e){e.SNAPSHOT="snapshot",e.TOUR="tour"}(n||(n={})),function(e){e.USER="user",e.VISION="vision"}(s||(s={}));var o=i(936),a=i(76875),l=i(34031),c=i(5087),d=i(88512),h=i(19674),u=i(36651),p=i(31879),m=i(25040),f=i(65814),g=i(77680);const v=new d.Z("mds-snapshot-deserializer");class MdsSnapshotDeserializer{deserialize(e){if(!e||!this.validate(e))return v.debug("Deserialized invalid Snapshot data from MDS",e),null;const t=new m.a;t.sid=e.id,t.thumbnailUrl=new g.n(e.thumbnailUrl||"",(0,p.p)(e.validUntil,null)),t.imageUrl=new g.n(e.presentationUrl||"",(0,p.p)(e.validUntil,null)),t.name=e.label||"",t.category=this.getCwfSnapshotCategory(e)||f.i.USER,t.width=e.width||0,t.height=e.height||0,t.created=(0,p.p)(e.created),t.modified=(0,p.p)(e.modified),t.visionLabel=e.classification||"";const i=(0,u.q)(e,"snapshotLocation.anchor.pano.placement");t.is360=!(!i||i===o.b.AUTO);const{snapshotLocation:n}=e;if(n){const e=n.position?h.ep.fromVisionVector(n.position):new r.Vector3,i=n.rotation?h.ep.fromVisionCameraQuaternion(n.rotation):new r.Quaternion,s=this.getCwfViewmode(n.viewMode)||c.Ey.Panorama,o=[];for(const e of n.floorVisibility){for(let t=0;t<e.sequence;t++)o[t]=o[t]||0;o[e.sequence]=1}t.metadata={cameraMode:s,cameraPosition:e,cameraQuaternion:i,scanId:n.anchor&&n.anchor.id||"",orthoZoom:s===c.Ey.Floorplan?n.zoom:-1,ssZoom:n.zoom||1,floorId:n.floorVisibility.length>0?n.floorVisibility[0].id:null,floorVisibility:o}}return t}validate(e){var t;if(!(null===(t=e.snapshotLocation)||void 0===t?void 0:t.position))return!1;const i=["id","snapshotLocation","thumbnailUrl","presentationUrl"].every((t=>t in e)),n=null!==this.getCwfSnapshotCategory(e);return i&&n}getCwfViewmode(e){const t={[a.w.DOLLHOUSE]:c.Ey.Dollhouse,[a.w.PANORAMA]:c.Ey.Panorama,[a.w.FLOORPLAN]:c.Ey.Floorplan,[a.w.MESH]:c.Ey.Panorama};return e in t?t[e]:null}getCwfSnapshotCategory(e){if(e.category===n.TOUR)return f.i.TOUR;if(e.origin===s.VISION)return f.i.AUTO;if(e.type===l.B.EQUIRECTANGULAR)return f.i.PANORAMA;const t=(0,u.q)(e,"snapshotLocation.anchor.pano.placement");return e.type===l.B.PHOTO2D?t===o.b.MANUAL?f.i.UNALIGNED:f.i.USER:null}}},15585:(e,t,i)=>{"use strict";i.d(t,{U:()=>MaasAttachmentsStore});var n=i(46963),s=i(92540),r=i(81063),o=i(49398);class MaasAttachmentsStore{constructor(e={readonly:!0}){this.viewId=null;const{baseUrl:t,viewId:i}=e;this.config=e,this.client=new s.w({baseUrl:t,server:r.wO}),i&&(this.viewId=i)}async create(...e){throw new n.n}async read(e={}){throw new n.n}async update(...e){throw new n.n}async delete(...e){throw new n.n}async query(e,t,i={}){if(!this.getViewId())throw new o.SN("Cannot read Attachments, no model view configured");return this.client.query(e,t,i)}async mutate(e,t,i){const{readonly:n}=this.config;if(n)throw new o.pp("Cannot write Attachments, model is in read-only mode");if(!this.getViewId())throw new o.SN("Cannot write Attachments, no model view configured");return this.client.mutate(e,t,i)}getViewId(){return this.viewId||MaasAttachmentsStore.currentViewId||MaasAttachmentsStore.baseViewId}static setCurrentViewId(e){MaasAttachmentsStore.currentViewId=e}static setBaseViewId(e){MaasAttachmentsStore.baseViewId=e}}MaasAttachmentsStore.baseViewId=null,MaasAttachmentsStore.currentViewId=null},94474:(e,t,i)=>{"use strict";i.d(t,{u:()=>MdsStore});var n=i(46963),s=i(92540),r=i(93863),o=i(88512),a=i(17597),l=i(49398);const c=new o.Z("MdsStore");class MdsStore{constructor(e={readonly:!0}){this.viewId=null;const{baseUrl:t,viewId:i}=e;this.config=e,this.client=new s.w({baseUrl:t}),i&&(this.viewId=i)}async create(...e){throw new n.n}async read(e={}){throw new n.n}async update(...e){throw new n.n}async delete(...e){throw new n.n}async query(e,t,i={}){if(!this.getViewId())throw new l.SN("No model view specified for query");const n=Object.assign({fetchPolicy:"cache-first",prefetchKey:this.prefetchKey},i),{fetchPolicy:s}=i;let r;if("no-cache"!==s)for(const i of MdsStore.sharedCache)if(r=await i.read(e,t,n),void 0!==r){c.debug(`Using cached response for ${n.prefetchKey}`);break}return r||this.client.query(e,t,n)}async mutate(e,t,i){const{readonly:n}=this.config;if(n)throw new l.pp("Cannot mutate in read-only mode");if(!this.getViewId())throw new l.SN("Cannot mutate, no view was specified");return this.client.mutate(e,t,i).then((e=>{const t="53100"===(0,a.eY)("error","");if(!s.w.isOk(e)||t){const i=new r.w0(s.w.getErrorMessage(e));throw t&&(i.isMock=!0),i}return e}))}getViewId(){return this.viewId||MdsStore.currentViewId||MdsStore.baseViewId}static setCurrentViewId(e){MdsStore.currentViewId=e}static setBaseViewId(e){MdsStore.baseViewId=e}static addSharedCache(e){MdsStore.sharedCache.add(e)}static removeSharedCache(e){MdsStore.sharedCache.delete(e)}}MdsStore.baseViewId=null,MdsStore.currentViewId=null,MdsStore.sharedCache=new Set},48602:(e,t,i)=>{"use strict";i.d(t,{Q:()=>StorageData});var n=i(32770),s=i(88512),r=i(38420),o=i(49398),a=i(94474);const l=new s.Z("storage-data");class StorageData extends n.V{constructor(e,t={}){super(),this.lastPublished=null,this.hasRevertableChanges=!1,this.hasPublishableChanges=!1,this.publishEnabled=!1,this.saveEnabled=!1,this.revertEnabled=!1,this.transactionState=r.g7.IDLE,this.views=[],this.dirtyTypes=new Set,this.publishableTypes=new Set,this.revertableTypes=new Set,this.currentViewId=e,Object.assign(this,t)}setCurrentView(e){if(e===this.currentViewId)return;const t=this.getView(e);if(!t)throw new o.SN("View not found");l.debug(`Active view set to ${e} (${t.viewType})`),this.currentViewId=e,a.u.setCurrentViewId(e),this.togglePublishingFeatures(),this.commit()}getCurrentView(){return this.getView(this.currentViewId)}getCurrentViewId(){return this.currentViewId}setTransactionState(e){if(e!==this.transactionState){if(![this.transactionState,e].includes(r.g7.IDLE))throw new Error(`Cannot transition from ${this.transactionState} to ${e}`);this.transactionState=e,this.commit()}}setViews(e){this.views=e,this.togglePublishingFeatures(),this.commit()}getDirtyTypes(){return[...this.dirtyTypes]}setDirtyType(...e){for(const t of e)this.dirtyTypes.add(t);this.onDataTypesChanged()}clearDirtyType(...e){if(e.length)for(const t of e)this.dirtyTypes.delete(t);else this.dirtyTypes.clear();this.onDataTypesChanged()}getPublishableTypes(){return[...this.publishableTypes]}setPublishableType(...e){for(const t of e)this.publishableTypes.add(t);this.onDataTypesChanged()}clearPublishableType(...e){if(e.length)for(const t of e)this.publishableTypes.delete(t);else this.publishableTypes.clear();this.onDataTypesChanged()}getRevertableTypes(){return[...this.revertableTypes]}setRevertableType(...e){for(const t of e)this.revertableTypes.add(t);this.onDataTypesChanged()}clearRevertableType(...e){if(e.length)for(const t of e)this.revertableTypes.delete(t);else this.revertableTypes.clear();this.onDataTypesChanged()}getView(e){return this.views.find((t=>t.id===e))}getViewCount(){return this.views.length}getViewByType(e){return this.views.find((t=>t.viewType===e))}togglePublishingFeatures(){const e=this.getCurrentView();e&&e.viewType===r.XZ.SESSION?(this.publishEnabled=!0,this.revertEnabled=!0,this.saveEnabled=!0):(this.publishEnabled=!1,this.revertEnabled=!1,this.saveEnabled=!0),this.commit()}onDataTypesChanged(){this.hasRevertableChanges=[...this.dirtyTypes].some((e=>this.revertableTypes.has(e))),this.hasPublishableChanges=[...this.dirtyTypes].some((e=>this.publishableTypes.has(e))),this.commit()}}},99252:(e,t,i)=>{"use strict";i.d(t,{F:()=>StorageModule});var n=i(47724),s=i(44283),r=i(92540),o=i(43973),a=i(50988),l=i(48602),c=i(49398),d=i(68655),h=i(96781),u=i(38420),p=i(94474),m=i(15585),f=i(83531),g=i(88512),v=i(36651);const y=new g.Z("PrefetchedQueryCache");class PrefetchedQueryCache{constructor(e){this.config=e,e.initialData&&(this.data=e.initialData)}async read(e,t,i={}){const{prefetchKey:n,prefetchPolicy:s=this.config.prefetchPolicy}=i;if(!n||s===u.hV.NONE)return;s!==u.hV.PRELOAD||this.preloadPromise||(this.preloadPromise=this.preload()),void 0===this.data&&this.preloadPromise&&await this.preloadPromise;const r=this.has(n);return y.debug(`Cache ${r?"hit":"miss"} for ${n}`),r?this.data:void 0}clear(){this.data=void 0}async preload(){const{query:e,variables:t,client:i}=this.config;return i.query(e,t).then((e=>{this.data=e})).catch((e=>{y.info(e),this.data={}}))}has(e){return void 0!==(0,v.q)(this.data,e)}}class PrefetchedData{static get hasPassword(){const{model:e}=window.MP_PREFETCHED_MODELDATA||{};return e&&e.has_public_access_password}static getQuery(e){var t;return((null===(t=window.MP_PREFETCHED_MODELDATA)||void 0===t?void 0:t.queries)||{})[e]}static get config(){var e;return null===(e=window.MP_PREFETCHED_MODELDATA)||void 0===e?void 0:e.config}}var b,S=i(93863),E=i(53306),T=i(17597);!function(e){e.IMAGE="image",e.FLOORS="floors",e.MEASUREMENT_PATHS="measurementPaths",e.MATTERTAGS="mattertags",e.LABELS="labels",e.HIGHLIGHT_REEL="highlightReel",e.SWEEPS="sweeps",e.PLAYER_OPTIONS="playerOptions"}(b||(b={}));class ModelViewDiff{constructor(e={}){Object.assign(this,e)}}const w=new g.Z("mds-mergediff-deserializer"),x={[u.g.FLOORS]:b.FLOORS,[u.g.MEASUREMENTS]:b.MEASUREMENT_PATHS,[u.g.MATTERTAGS]:b.MATTERTAGS,[u.g.LABELS]:b.LABELS,[u.g.HIGHLIGHTS]:b.HIGHLIGHT_REEL,[u.g.SWEEPS]:b.SWEEPS,[u.g.SETTINGS]:b.PLAYER_OPTIONS,[u.g.START_LOCATION]:b.IMAGE,[u.g.BLURS]:void 0},_={[b.IMAGE]:u.g.START_LOCATION,[b.FLOORS]:u.g.FLOORS,[b.MEASUREMENT_PATHS]:u.g.MEASUREMENTS,[b.MATTERTAGS]:u.g.MATTERTAGS,[b.LABELS]:u.g.LABELS,[b.HIGHLIGHT_REEL]:u.g.HIGHLIGHTS,[b.SWEEPS]:u.g.SWEEPS,[b.PLAYER_OPTIONS]:u.g.SETTINGS};class MergeDiffDeserializer{deserialize(e){if(!(e&&e.src&&e.dest&&e.typesModified))return w.debug("Deserialized invalid merge diff from MDS",e),null;const t=[];for(const i of e.typesModified)i in _&&t.push(_[i]);return new ModelViewDiff({srcId:e.src,targetId:e.dest,dataTypes:t})}}class ModelView{constructor(e={}){this.viewType=null,Object.assign(this,e)}}const M=new g.Z("mds-modelview-deserializer");class ModelViewDeserializer{deserialize(e){return e&&e.id&&e.type?new ModelView({id:e.id,viewType:this.getModelViewType(e.type),rawViewType:e.type}):(M.debug("Deserialized invalid ModelView data from MDS",e),null)}getModelViewType(e){const t={"matterport.workshop.session":u.XZ.SESSION,"matterport.model.default":u.XZ.BASE,"trueplan.session":u.XZ.TRUEPLAN};return e in t?t[e]:null}}class ModelViewManager{constructor(e,t){this.modelId=e,this.client=t}async getViews(){const e=new ModelViewDeserializer,t=await this.client.query(E.GetViews,{modelId:this.modelId}).catch((e=>{throw new S.Zb(e)})),i=(0,v.q)(t,"data.model.views"),n=[];if(i)for(const t of i){const i=e.deserialize(t);i&&n.push(i)}return n}async getMergeDiff(e){const t=new MergeDiffDeserializer,i=await this.client.query(E.GetMergeDiff,{viewId:e}).catch((e=>{throw new S.Zb(e)})),n=(0,v.q)(i,"data.model.mergeDiff");return t.deserialize(n)}async getUnpublishedDeletions(){const e=await this.client.query(E.GetSessionDiff,{modelId:this.modelId}).catch((e=>{throw new S.Zb(e)})),t=(0,v.q)(e,"data.model.base"),i=(0,v.q)(e,"data.model.view"),n=(e,t,i)=>{const n=t.map((e=>e[i]));return e.filter((e=>!n.includes(e[i])))},s=n(t.model.mattertags,i.model.mattertags,"id"),r=n(t.model.labels,i.model.labels,"id"),o=n(t.model.measurementPaths,i.model.measurementPaths,"id");return{[u.g.LABELS]:r,[u.g.MATTERTAGS]:s,[u.g.MEASUREMENTS]:o}}async revertView(e,t=[]){const i=t.map((e=>x[e])).filter((e=>!!e));if(!i.length)return;const n=await this.client.query(E.RevertView,{viewId:e,mergeTypes:i}).catch((e=>{throw new S.w0(e)})),s="53300"===(0,T.eY)("error","");if(!r.w.isOk(n)||s){const e=new S.w0(r.w.getErrorMessage(n));throw s&&(e.isMock=!0),e}}async mergeView(e){const t=await this.client.query(E.PublishView,{viewId:e}).catch((e=>{throw new S.w0(e)})),i="53200"===(0,T.eY)("error","");if(!r.w.isOk(t)||i){const e=new S.w0(r.w.getErrorMessage(t));throw i&&(e.isMock=!0),e}}}class StorageModule extends n.Y{constructor(){super(...arguments),this.name="storage",this.saveHandlers=new Set,this.revertHandlers=new Set,this.publishHandlers=new Set,this.lock=new o.H}async init(e,t){const{baseUrl:i,modelId:n,prefetchPolicy:s}=e;this.config=e,this.engine=t,this.client=new r.w({baseUrl:i}),this.data=new l.Q(e.modelId),t.market.register(this,l.Q,this.data),p.u.setBaseViewId(n),m.U.setBaseViewId(n),this.views=new ModelViewManager(n,this.client),this.prefetchCache=new PrefetchedQueryCache({client:this.client,prefetchPolicy:s,initialData:PrefetchedData.getQuery("GetModelPrefetch"),query:f.GetModelPrefetch,variables:{modelId:n}}),p.u.addSharedCache(this.prefetchCache),this.bindings.push(t.commandBinder.addBinding(a.R_,(e=>this.publish(e.dataTypes))),t.commandBinder.addBinding(a.qz,(e=>this.revert(e.dataTypes))),t.commandBinder.addBinding(a.VQ,(e=>this.save(e.dataTypes))),t.commandBinder.addBinding(a.dS,(e=>this.setDefaultViewType(e.viewType))),t.commandBinder.addBinding(a.ff,(()=>this.views.getUnpublishedDeletions())))}dispose(e){super.dispose(e),p.u.removeSharedCache(this.prefetchCache)}onSave(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||u.Q.ON};return(0,s.k1)((()=>this.saveHandlers.add(i)),(()=>this.saveHandlers.delete(i)),!0)}onPublish(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||u.Q.ON};return(0,s.k1)((()=>this.publishHandlers.add(i)),(()=>this.publishHandlers.delete(i)),!0)}onRevert(e,t={}){const i={callback:e,dataType:t.dataType,phase:t.phase||u.Q.ON};return(0,s.k1)((()=>this.revertHandlers.add(i)),(()=>this.revertHandlers.delete(i)),!0)}async publish(e=[]){const t=await this.lock.lock(),i=i=>{this.log.error(i),t.unlock(),this.data.setTransactionState(u.g7.IDLE);const s=n[0]?`532${(0,c.DT)(n[0])}`:"53200";if(i instanceof d.V2||i instanceof d.GT){const t=new c.lY(i,s);throw this.engine.broadcast(new h.hu(t,e)),t}const r=new c.gO(i,s);throw this.engine.broadcast(new h.aT(r,e)),r},n=e.length?[...e]:this.data.getPublishableTypes(),{before:s,on:r,after:o}=this.getCallbacksByPhase(this.publishHandlers,n),a=this.data.getViewByType(u.XZ.SESSION);a&&r.push((()=>this.views.mergeView(a.id))),this.log.debug(`Publishing ${[...n].join(", ")}...`),this.data.setTransactionState(u.g7.PUBLISHING),await Promise.all(s.map((e=>e()))).catch(i),await Promise.all(r.map((e=>e()))).catch(i),this.data.lastPublished=Date.now(),this.data.commit(),this.data.clearDirtyType(...e),this.engine.broadcast(new h.zK),await Promise.all(o.map((e=>e()))).catch(i),t.unlock(),this.data.setTransactionState(u.g7.IDLE),this.log.debug("Publishing completed")}async revert(e=[]){const t=await this.lock.lock(),i=i=>{t.unlock(),this.data.setTransactionState(u.g7.IDLE);const n=e[0]?`531${(0,c.DT)(e[0])}`:"53100",s=new c.P8(i,n);throw this.engine.broadcast(new h.Kx(s,e)),s},{before:n,on:s,after:r}=this.getCallbacksByPhase(this.revertHandlers,e),o=this.data.getViewByType(u.XZ.SESSION);o?(s.push((()=>this.views.revertView(o.id,e))),this.log.debug(`Reverting ${[...e].join(", ")}...`),this.data.setTransactionState(u.g7.REVERTING),await Promise.all(n.map((e=>e()))).catch(i),await Promise.all(s.map((e=>e()))).catch(i),this.engine.broadcast(new h.F1(e)),await Promise.all(r.map((e=>e()))).catch(i),t.unlock(),this.data.setTransactionState(u.g7.IDLE),this.data.clearDirtyType(...e),this.log.debug(`Reverting ${[...e].join(", ")} completed`)):i(new c.SN("Workshop session view not found"))}async save(e){const{before:t,on:i,after:n}=this.getCallbacksByPhase(this.saveHandlers,e),s=await this.lock.lock(),r=t=>{this.log.error(t),s.unlock(),this.data.setTransactionState(u.g7.IDLE);const i=e[0]?`531${(0,c.DT)(e[0])}`:"53100";if(t instanceof d.V2||t instanceof d.GT){const n=new c.lY(t,i);throw this.engine.broadcast(new h.hu(n,e)),n}const n=new c.pd(t,i);throw this.engine.broadcast(new h.dz(n,e)),n};this.log.debug(`Saving ${[...e].join(", ")}...`),this.data.setTransactionState(u.g7.SAVING),await Promise.all(t.map((e=>e()))).catch(r),await Promise.all(i.map((e=>e()))).catch(r),this.engine.broadcast(new h.xj(e)),await Promise.all(n.map((e=>e()))).catch(r),this.data.setDirtyType(...e),s.unlock(),this.data.setTransactionState(u.g7.IDLE),this.log.debug(`Saving ${[...e].join(", ")} completed`)}getCallbacksByPhase(e,t){const i=Array.isArray(t)?t:Object.values(u.g),n=[...e.values()].filter((e=>!e.dataType||i.includes(e.dataType))),s={[u.Q.BEFORE]:[],[u.Q.ON]:[],[u.Q.AFTER]:[]};return n.reduce(((e,t)=>(e[t.phase].push((()=>t.callback(i))),e)),s)}async setDefaultViewType(e){0===this.data.getViewCount()&&await this.loadViews();const t=this.data.getViewByType(e),i=this.data.getCurrentView();if(t&&i&&i.viewType===u.XZ.BASE)return this.log.debug(`Switching to default view type '${e}'`),this.switchToView(t.id)}async loadViews(){const e=await this.views.getViews();this.data.setViews(e)}async switchToView(e){const t=this.data.getView(e);if(!t||e===this.data.getCurrentViewId())return;this.data.setCurrentView(t.id);const i=await this.views.getMergeDiff(t.id);i&&i.dataTypes&&this.data.setDirtyType(...i.dataTypes)}}},50988:(e,t,i)=>{"use strict";i.d(t,{R_:()=>PublishCommand,qz:()=>RevertCommand,VQ:()=>SaveCommand,dS:()=>SetDefaultViewTypeCommand,ff:()=>GetUnpublishedDeletionsCommand});var n=i(17386);class PublishCommand extends n.m{constructor(e={}){super(),this.id="PUBLISH_COMMAND",this.payload=e}}class RevertCommand extends n.m{constructor(e){super(),this.id="REVERT_COMMAND",this.payload=e}}class SaveCommand extends n.m{constructor(e){super(),this.id="SAVE_COMMAND",this.payload=e}}class SetDefaultViewTypeCommand extends n.m{constructor(e){super(),this.id="SET_DEFAULT_VIEW_TYPE_COMMAND",this.payload=e}}class GetUnpublishedDeletionsCommand extends n.m{constructor(){super(...arguments),this.id="GET_UNPUBLISHED_DELETIONS_COMMAND"}}},38420:(e,t,i)=>{"use strict";var n,s,r,o,a;i.d(t,{g7:()=>n,Q:()=>s,g:()=>r,XZ:()=>o,hV:()=>a}),function(e){e.IDLE="idle",e.REVERTING="reverting",e.PUBLISHING="publishing",e.SAVING="saving"}(n||(n={})),function(e){e.ON="on",e.BEFORE="before",e.AFTER="after"}(s||(s={})),function(e){e.BLURS="blurs",e.BLUR_SUGGESTIONS="blur-suggestions",e.FLOORS="floors",e.HIGHLIGHTS="highlights",e.LABELS="labels",e.MATTERTAGS="mattertags",e.MEASUREMENTS="measurements",e.NOTES="notes",e.ORDERED_LISTS="ordered-lists",e.PHOTOS="photos",e.SETTINGS="settings",e.START_LOCATION="startlocation",e.SWEEPS="sweeps"}(r||(r={})),function(e){e.BASE="base",e.TRUEPLAN="trueplan",e.SESSION="session"}(o||(o={})),function(e){e.CACHE="cache",e.PRELOAD="preload",e.NONE="none"}(a||(a={}))},49398:(e,t,i)=>{"use strict";i.d(t,{AE:()=>StorageError,lY:()=>ForbiddenError,pd:()=>SaveError,gO:()=>PublishError,P8:()=>RevertError,pp:()=>ReadOnlyError,SN:()=>InvalidViewError,DT:()=>r});var n=i(31102),s=i(38420);class StorageError extends n.y{constructor(e,t="50001"){super(e),this.name="StorageError",this.code=t}}class ForbiddenError extends n.y{constructor(e,t="53100"){super(e),this.name="ForbiddenError",this.code=t}}class SaveError extends n.y{constructor(e,t="53100"){super(e),this.name="SaveError",this.code=t}}class PublishError extends n.y{constructor(e,t="53200"){super(e),this.name="PublishError",this.code=t}}class RevertError extends n.y{constructor(e,t="53300"){super(e),this.name="RevertError",this.code=t}}class ReadOnlyError extends n.y{constructor(e,t="53001"){super(e),this.name="ReadOnly",this.code=t}}class InvalidViewError extends n.y{constructor(e,t="52404"){super(e),this.name="InvalidView",this.code=t}}function r(e){return{[s.g.BLUR_SUGGESTIONS]:"12",[s.g.BLURS]:"01",[s.g.FLOORS]:"02",[s.g.HIGHLIGHTS]:"03",[s.g.LABELS]:"04",[s.g.MATTERTAGS]:"05",[s.g.MEASUREMENTS]:"06",[s.g.NOTES]:"07",[s.g.ORDERED_LISTS]:"13",[s.g.PHOTOS]:"08",[s.g.SETTINGS]:"09",[s.g.START_LOCATION]:"10",[s.g.SWEEPS]:"11"}[e]||"99"}},37339:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DataIntegrityMessage:()=>o.Qq,DataPublishedMessage:()=>o.zK,DataRevertedMessage:()=>o.F1,DataSavedMessage:()=>o.xj,DataType:()=>s.g,ForbiddenError:()=>r.lY,ForbiddenErrorMessage:()=>o.hu,GetUnpublishedDeletionsCommand:()=>n.ff,InvalidViewError:()=>r.SN,MaasAttachmentsStore:()=>d.U,MdsStore:()=>c.u,ModelViewType:()=>s.XZ,PrefetchPolicy:()=>s.hV,PublishCommand:()=>n.R_,PublishError:()=>r.gO,PublishErrorMessage:()=>o.aT,ReadOnlyError:()=>r.pp,RevertCommand:()=>n.qz,RevertError:()=>r.P8,RevertErrorMessage:()=>o.Kx,SaveCommand:()=>n.VQ,SaveError:()=>r.pd,SaveErrorMessage:()=>o.dz,SetDefaultViewTypeCommand:()=>n.dS,StorageAnalytics:()=>StorageAnalytics,StorageData:()=>l.Q,StorageError:()=>r.AE,TransactionPhase:()=>s.Q,TransactionState:()=>s.g7,default:()=>h.F,getErrorCodeForDataType:()=>r.DT});var n=i(50988),s=i(38420),r=i(49398),o=i(96781),a=i(61645);class StorageAnalytics{constructor(){this.handlers=[{msgType:o.Qq,func:(e,t)=>{const{dataType:i,message:n,mockError:s}=t,r="DataIntegrityError",o={error_type:r,error_dialog:"none",data_type:i,exception:{message:`${r}: ${n}`},mock_error:s};e.track("error_displayed",o)}},{msgType:o.dz,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"SaveError",r={error_code:(0,a.UX)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${s}: ${n.message}`,stack:n.stack},mock_error:(0,a.Ad)(n)};e.track("error_displayed",r)}},{msgType:o.Kx,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"RevertError",r={error_code:(0,a.UX)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${n.name||s}: ${n.message}`,stack:n.stack},mock_error:(0,a.Ad)(n)};e.track("error_displayed",r)}},{msgType:o.aT,func:(e,t)=>{const{dataTypes:i,error:n}=t,s=n.name||"PublishError",r={error_code:(0,a.UX)(n).join(", "),error_type:s,error_dialog:"banner",data_type:i?i.join(", "):"",exception:{message:`${s}: ${n.message}`,stack:n.stack},mock_error:(0,a.Ad)(n)};e.track("error_displayed",r)}}]}}var l=i(48602),c=i(94474),d=i(15585),h=i(99252)},96781:(e,t,i)=>{"use strict";i.d(t,{xj:()=>DataSavedMessage,zK:()=>DataPublishedMessage,F1:()=>DataRevertedMessage,Qq:()=>DataIntegrityMessage,dz:()=>SaveErrorMessage,Kx:()=>RevertErrorMessage,aT:()=>PublishErrorMessage,hu:()=>ForbiddenErrorMessage});var n=i(91466);class DataSavedMessage extends n.v{constructor(e){super(),this.dataTypes=e}}class DataPublishedMessage extends n.v{}class DataRevertedMessage extends n.v{constructor(e){super(),this.dataTypes=e}}class DataIntegrityMessage extends n.v{constructor(e,t,i=!1){super(),this.message=e,this.dataType=t,this.mockError=i}}class SaveErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class RevertErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class PublishErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}class ForbiddenErrorMessage extends n.v{constructor(e,t=[]){super(),this.error=e,this.dataTypes=t}}},29397:(e,t,i)=>{"use strict";i.d(t,{Z:()=>BeginMoveToSweepMessage});var n=i(51764);class BeginMoveToSweepMessage extends n.Z{}},85895:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EndMoveToSweepMessage});var n=i(51764);class EndMoveToSweepMessage extends n.Z{constructor(e,t,i,n){super(e,n),this.alignmentType=t,this.placementType=i}}},51764:(e,t,i)=>{"use strict";i.d(t,{Z:()=>MoveToSweepMessage});var n=i(91466);class MoveToSweepMessage extends n.v{constructor(e,t){super(),this.fromSweep=t,this.toSweep=e,this.timestamp=Date.now()}}},35026:(e,t,i)=>{"use strict";i.d(t,{z9:()=>n,hU:()=>s,ZP:()=>Sweep});var n,s,r=i(2212),o=i(23573),a=i(34369);!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n||(n={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s||(s={}));const l={[a.SL.BASE]:"512",[a.SL.STANDARD]:"1k",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"},c={[a.SL.BASE]:"low",[a.SL.STANDARD]:"high",[a.SL.HIGH]:"2k",[a.SL.ULTRAHIGH]:"4k"};class Sweep extends o.T{constructor(e){super(),this.skyboxes={},e&&(e.id&&(this.id=e.id),void 0!==e.index&&(this.index=e.index),this.name=e.name||"",this.position=e.position||new r.Vector3,this.floorPosition=e.floorPosition||new r.Vector3,void 0!==e.floorId&&(this.floorId=e.floorId),this.roomId=e.roomId||null,this.rotation=e.rotation||new r.Quaternion,this.enabled=e.enabled||!1,this.vrenabled=e.vrenabled||!1,this.neighbours=e.neighbours||[],this.alignmentType=e.alignmentType||n.ALIGNED,this.placementType=e.placementType||s.UNPLACED,void 0!==e.uuid&&(this.uuid=e.uuid))}isAligned(){return this.alignmentType===n.ALIGNED}isUnplaced(){return this.placementType===s.UNPLACED}get sid(){return this.id}equals(e){return this.id===e.id&&this.index===e.index&&this.name===e.name&&this.position.equals(e.position)&&this.floorId===e.floorId&&this.roomId===e.roomId&&this.rotation.equals(e.rotation)&&this.enabled===e.enabled&&this.vrenabled===e.vrenabled&&this.alignmentType===e.alignmentType&&this.placementType===e.placementType}copy(e){return this.id=e.id,this.index=e.index,this.name=e.name,this.position=(new r.Vector3).copy(e.position),this.floorPosition=(new r.Vector3).copy(e.floorPosition),this.floorId=e.floorId,this.roomId=e.roomId,this.rotation=(new r.Quaternion).copy(e.rotation),this.enabled=e.enabled,this.vrenabled=e.vrenabled,this.neighbours=e.neighbours.slice(),this.alignmentType=e.alignmentType,this.placementType=e.placementType,this.resolutions=e.resolutions,this.skyboxes=Object.assign({},e.skyboxes),this}refresh(e){this.resolutions=e.resolutions;for(const t in this.skyboxes){const i=t;this.skyboxes[i].refreshFrom(e.skyboxes[i])}}async getTileUrl(e,t,i,n){const s=await this.getSkybox(e);let r;return r=s?s.tileUrlTemplate:`tiles/${this.id}/${l[e]}_face<face>_<x>_<y>.jpg`,r.replace("<face>",`${t}`).replace("<x>",`${i}`).replace("<y>",`${n}`)}async getFaceUrl(e,t){const i=await this.getSkybox(e);let n;return n=i?i.urlTemplate:`pan/${c[e]}/${this.id}_skybox${t}.jpg`,n.replace("<face>",`${t}`)}async getSkybox(e){const t=this.skyboxes[e];return t?t.get():t}}},95586:(e,t,i)=>{"use strict";i.d(t,{NO:()=>ClearCurrentSweepCommand,aK:()=>SetCurrentSweepCommand,iF:()=>SweepSelectCommand,kR:()=>SweepHoverCommand,e9:()=>ToggleNonPanoCurrentPuckCommand,zd:()=>EnableSweepSelectionCommand,ZD:()=>DisableSweepSelectionCommand});var n=i(17386);class ClearCurrentSweepCommand extends n.m{}class SetCurrentSweepCommand extends n.m{constructor(e){super(),this.sweepId=e,this.payload={sweepId:e}}}class SweepSelectCommand extends n.m{constructor(e,t,i=500){super(),this.id="SELECT_SWEEP",this.payload={id:e,selected:t,duration:i}}}class SweepHoverCommand extends n.m{constructor(e,t,i=500){super(),this.id="HOVER_SWEEP",this.payload={id:e,hovered:t,duration:i}}}class ToggleNonPanoCurrentPuckCommand extends n.m{constructor(e){super(),this.id="TOGGLE_NON_PANO_CURRENT_PUCK",this.payload={visible:e}}}class EnableSweepSelectionCommand extends n.m{constructor(){super(...arguments),this.id="ENABLE_SWEEP_SELECTION"}}class DisableSweepSelectionCommand extends n.m{constructor(){super(...arguments),this.id="DISABLE_SWEEP_SELECTION"}}},75892:(e,t,i)=>{"use strict";i.d(t,{Z:()=>SweepData});var n=i(35026),s=i(32770),r=i(75256),o=i(64781),a=i(17131);class SweepData extends s.V{constructor(e){if(super(),this.name="sweeps",this.transitionActive=!1,this.sweepList=new r.d,this.sweepMap={},e){const t=Object.values(e).sort(((e,t)=>e.index-t.index));for(const e of t)this.sweepMap[e.id]=e,this.sweepList.push(e)}this.transition={progress:new a.z(0),active:!1,from:void 0,to:void 0}}refresh(e){for(const t in this.sweepMap)e[t]&&this.sweepMap[t].refresh(e[t])}canTransition(){return!this.transition.active}get currentSweepIndex(){if(this.currentSweep)return this.sweepMap[this.currentSweep].index}get currentSweepObject(){if(this.currentSweep)return this.getSweep(this.currentSweep)}get currentAlignedSweepObject(){if(this.currentSweep&&!this.isSweepUnaligned(this.currentSweep))return this.getSweep(this.currentSweep)}makeSweepChangeSubscription(e){return this.onPropertyChanged("currentSweep",e)}getSweep(e){return this.sweepMap[e]}getSweepByIndex(e){return this.sweepList.find((t=>t.index===e))}getSweepByUuid(e){return this.sweepList.find((t=>t.uuid===e))}containsSweep(e){return e in this.sweepMap}getFirstSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled)return t}}getStartSweep(e){const t=e&&e.pano&&e.pano.uuid?this.getSweep(e.pano.uuid):null;return t&&t.enabled?t:this.getFirstSweep()}getClosestSweep(e,t){let i=Number.MAX_VALUE,s=null;return this.iterate((r=>{if(r.enabled&&(!t||r.alignmentType===n.z9.ALIGNED)){const t=e.distanceTo(r.position);t<i&&(i=t,s=r)}})),s}getFirstAlignedSweep(){let e=-1;for(;++e<this.sweepList.length;){const t=this.sweepList.get(e);if(t.enabled&&t.alignmentType===n.z9.ALIGNED)return t}return null}activateTransition(e,t){this.transition.active=!0,this.transition.from=t,this.transition.to=e,this.transitionActive=!0}deactivateTransition(){this.transition.active=!1,this.transition.from=void 0,this.transition.to=void 0,this.transitionActive=!1}isSweepUnaligned(e){if(!e)return!1;const t=this.getSweep(e);return t&&!t.isAligned()}isSweepAligned(e){const t=this.getSweep(e);return t&&t.isAligned()}isSweepDisabled(e=this.currentSweep){if(!e)return!1;const t=this.getSweep(e);return t&&!t.enabled}*sweeps(){for(const e of this.sweepList)yield e}iterate(e){this.sweepList.forEach(((t,i)=>{e(t,i)}))}filter(e){return this.sweepList.filter(e)}sortByScore(e,t,i){return(i||this.sweepList).filter((t=>e.every((e=>e(t))))).map((e=>({sweep:e,score:t.reduce(((t,i)=>t+i(e)),0)}))).sort(((e,t)=>t.score-e.score))}getSweepList(){return this.sweepList.values()}getSweepNeighbours(e){const t=[];for(const i of e.neighbours)t.push(this.getSweep(i));return t}getCollection(){return(0,o.q)(this.sweepMap)}getConnectedSweeps(e,t){const i=[e],n=new Set;for(t=t||(e=>!0);i.length;){const e=i.pop(),s=this.getSweep(e);n.add(e);for(const e of s.neighbours){t(this.getSweep(e))&&!n.has(e)&&i.push(e)}}return n}equals(e){if(this.sweepMap.length!==e.sweepMap.length||this.currentSweep!==e.currentSweep||this.transition.active!==e.transition.active||this.transition.from!==e.transition.from||this.transition.to!==e.transition.to)return!1;for(const t in this.sweepMap){if(!e.containsSweep(t))return!1;if(!this.sweepMap[t].equals(e.getSweep(t)))return!1}return!0}}},51263:(e,t,i)=>{"use strict";i.d(t,{ff:()=>o,vO:()=>a,T3:()=>l,H7:()=>c,_T:()=>d,WO:()=>h,b1:()=>u,nK:()=>p,pI:()=>m,_k:()=>f,D5:()=>g,SF:()=>v,jN:()=>y});var n=i(35026),s=i(2212);const r=.25,o=e=>t=>t!==e,a=e=>t=>!!e.neighbours&&-1!==e.neighbours.indexOf(t.id),l=e=>t=>e===t||a(e)(t),c=e=>e.placementType===n.hU.MANUAL,d=()=>e=>e.alignmentType===n.z9.ALIGNED,h=()=>e=>e.alignmentType!==n.z9.ALIGNED,u=e=>t=>e.floorId===t.floorId,p=e=>t=>e===t.floorId,m=(()=>{const e=new s.Vector3,t=new s.Vector3;return(i,n,s=r)=>r=>e.copy(r.position).sub(i).normalize().dot(t.copy(n).normalize())>s})(),f=()=>e=>e.enabled,g=(e,t)=>{const i=new s.Vector3;return t=t.clone(),n=>i.copy(n.position).sub(e).normalize().dot(t)>0},v=(e,t)=>i=>e.distanceTo(i.position)<t,y=(e,t)=>i=>e.distanceToSquared(i.position)<t},2240:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepDataModule});var n=i(47724),s=i(96909),r=i(75892),o=i(31278),a=i(63560),l=i(85895),c=i(29397),d=i(64185),h=i(79437),u=i(59088),p=i(51764),m=i(95586),f=i(53204),g=i(15100),v=i(94474),y=i(88512);const b=new y.Z("mds-sweep-serializer");class MdsAnchorLocationUpdateSerializer{serialize(e){const t={};return void 0===e.enabled&&void 0===e.vrenabled||(t.tags=[],e.enabled&&t.tags.push("showcase"),e.vrenabled&&t.tags.push("vr")),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["tags"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=void 0===e.tags||Array.isArray(e.tags),r=s&&i&&n;return r||b.debug("Invalid AnchorPatch:",{tagsIsArrayIfPresent:s,hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),r}}var S,E=i(936);!function(e){e.VISION="vision",e.UPLOAD="upload"}(S||(S={}));var T=i(35026),w=i(19674),x=i(34369),_=i(31879),M=i(77680),O=i(80680);const A=new y.Z("mds-sweep-serializer"),C={[E.b.AUTO]:T.hU.AUTO,[E.b.MANUAL]:T.hU.MANUAL,[E.b.UNPLACED]:T.hU.UNPLACED},P={[S.VISION]:T.z9.ALIGNED,[S.UPLOAD]:T.z9.UNALIGNED};class MdsSweepDeserializer{deserialize(e){var t,i;if(!e||!this.validate(e))return A.debug("Deserialized invalid Sweep data from MDS",e),null;const n=e,s=new T.ZP;s.id=n.id,s.index=n.index,s.enabled=n.tags.includes("showcase"),s.vrenabled=n.tags.includes("vr"),s.neighbours=n.neighbors||[],n.position&&(s.floorPosition=w.ep.fromVisionVector(n.position)),s.floorId=(null===(t=n.floor)||void 0===t?void 0:t.id)||null,s.roomId=(null===(i=n.room)||void 0===i?void 0:i.id)||null;const r=n.pano;s.name=r.label||"",s.alignmentType=P[r.source],s.uuid=r.sweepUuid||"",s.alignmentType===T.z9.ALIGNED?s.placementType=T.hU.AUTO:s.placementType=C[r.placement],r.position&&(s.position=w.ep.fromVisionVector(r.position)),s.resolutions=[];const o=r.skyboxes||[];if(r.resolutions)for(const e of r.resolutions){const t=this.getPanoSizeClass(e),i=o.find((t=>t.resolution===e));t&&i?(s.resolutions.push(t),s.skyboxes[t]=this.makeSkybox(i)):A.debug(`Invalid pano size class ${e}`)}return r.rotation&&(s.rotation=w.ep.fromVisionQuaternion(r.rotation)),s.floorId||(s.alignmentType===T.z9.ALIGNED?A.warn(`Aligned sweep ${s.index} has no floor association`):s.placementType===T.hU.MANUAL&&A.debug(`Manually placed sweep ${s.index} has no floor association`)),s.roomId||s.alignmentType===T.z9.ALIGNED&&A.warn(`Aligned sweep ${s.index} has no room association`),s}validate(e){if(!e)return!1;const t=[],i=["id","index","tags"];if(t.push((()=>i.every((t=>t in e)))),t.push((()=>"number"==typeof e.index)),t.push((()=>!!e.position&&(0,O.u)(e.position))),t.push((()=>"pano"in e&&!!e.pano)),e.pano){const{placement:i,source:n,position:s}=e.pano;t.push((()=>!!i&&i in C)),t.push((()=>!!n&&n in P)),t.push((()=>!!s&&(0,O.u)(s)))}return t.every((e=>e()))}getPanoSizeClass(e){const t={low:x.SL.BASE,high:x.SL.STANDARD,"2k":x.SL.HIGH,"4k":x.SL.ULTRAHIGH};return e in t?t[e]:void 0}makeSkybox(e){return new M.n({tileUrlTemplate:e.tileUrlTemplate,tileResolution:parseInt(e.tileResolution,10),tileCount:e.tileCount,urlTemplate:e.urlTemplate},(0,_.p)(e.validUntil,null))}}var D=i(87324);const N=new y.Z("mds-sweep-serializer");class MdsSweepPanoUpdateSerializer{serialize(e){const t={};return e.rotation&&(t.rotation=(0,D.J5)(w.ep.toVisionQuaternion(e.rotation))),e.position&&(t.position=(0,D.m)(w.ep.toVisionVector(e.position))),e.placementType&&e.placementType===T.hU.UNPLACED&&(t.resetPlacement=!0),"roomId"in e&&(e.roomId?t.roomId=e.roomId:t.resetRoom=!0),"floorId"in e&&(e.floorId?t.floorId=e.floorId:t.resetFloor=!0),"name"in e&&(t.label=e.name||""),this.validate(t)?t:null}validate(e){if(!e)return!1;const t=["resetPlacement","resetFloor","resetRoom","rotation","position","floorId","roomId","label"],i=t.some((t=>t in e)),n=0===Object.keys(e).filter((e=>!t.includes(e))).length,s=i&&n;return s||N.debug("Invalid PanoramaLocation:",{hasSomeChanges:i,hasNoExtraChanges:n,mutableFields:t,data:e}),s}}const I=new y.Z("mds-sweep-store");class MdsSweepStore extends v.u{constructor(){super(...arguments),this.deserializer=new MdsSweepDeserializer,this.panoSerializer=new MdsSweepPanoUpdateSerializer,this.anchorSerializer=new MdsAnchorLocationUpdateSerializer,this.prefetchKey="data.model.locations"}async read(e={}){const{readonly:t}=this.config,i={modelId:this.getViewId()},n=t?g.GetShowcaseSweeps:g.GetSweeps;return this.query(n,i,e).then((e=>{var t,i;const n=null===(i=null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.model)||void 0===i?void 0:i.locations;if(!n||!Array.isArray(n))return null;const s={};for(const e of n){const t=this.deserializer.deserialize(e);t&&(s[t.id]=t)}return s}))}async refresh(){return this.refreshPromise||(this.refreshPromise=this.read({fetchPolicy:"no-cache"}).finally((()=>{this.refreshPromise=void 0}))),this.refreshPromise}async update(e){if(!e||0===e.length)return;const t=this.getViewId();let i="";const n={};n.modelId=t;let s="";for(const t of e){const r=this.panoSerializer.serialize(t),o=this.anchorSerializer.serialize(t);if(!r&&!o)throw I.error("No changes to update:",t,e),new Error("MdsSweepStore.update failed");i+=""+(r?`, $pano${t.id}: PanoramicImageLocationPatch!`:"")+` ${o?`, $anchor${t.id}: AnchorPatch!`:""} `,n[`pano${t.id}`]=r,n[`anchor${t.id}`]=o,s+=`\n        ${r?`\n          panoLocation${t.id}: patchPanoLocation(modelId: $modelId, , locationId: "${t.id}", patch: $pano${t.id}) {\n            id\n            placement\n          }`:""}\n        ${o?`\n          panoAnchor${t.id}: patchAnchor(modelId: $modelId, , anchorId: "${t.id}", patch: $anchor${t.id}) {\n            id\n            tags\n          }`:""}\n      `}const r=f.Ps`
      mutation sweepUpdate($modelId: ID! ${i}) {
        ${s}
      }
    `;return this.mutate(r,n).then((()=>{}))}}var L=i(57361),R=i(39729),k=i(71194),U=i(99252),B=i(50988),F=i(38420),V=i(48602),H=i(31102);class SweepTransitionError extends H.y{constructor(e="Failed to transition to sweep"){super(e),this.name="SweepTransition"}}class InvalidSweepError extends H.y{constructor(e="Invalid Sweep"){super(e),this.name="InvalidSweep"}}class SweepDataModule extends n.Y{constructor(){super(...arguments),this.name="sweep-data",this.internalProgress=!1,this.defaultEasing=h.qb,this.moveToSweep=e=>{const t=new d.Q;return e.prevSweepId=e.prevSweepId||this.sweepData.currentSweep,this.activateSweep(e).then((()=>(this.beginSweepTransition(e),this.defaultSweepCameraMove(t,e)))).then((()=>{this.endSweepTransition(e),t.resolve()})).catch((i=>{this.log.debug(`Failure moving to sweep ${e.sweepId}`,i),t.reject(i)})),t.promise()},this.activateSweep=async e=>{if(!this.sweepData.canTransition()||!this.cameraData.canTransition())throw new SweepTransitionError("Tried to start transition while another transition was active");if(!this.sweepData.containsSweep(e.sweepId))throw new InvalidSweepError(`Invalid sweep ${e.sweepId}`);return this.activateSweepUnsafe(e)},this.activateSweepUnsafe=async e=>{this.sweepPanoModule||(this.sweepPanoModule=await this.engine.getModuleBySymbol(s.y.SWEEP_PANO));return this.sweepPanoModule.getRenderer().activateSweep(e.sweepId)},this.instantSweepTransition=e=>{const t=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:e,transitionTime:0,internalProgress:!0,prevSweepId:t}),this.sweepData.currentSweep=e,this.sweepData.commit(),this.engine.broadcast(new p.Z(e,t)),this.endSweepTransition({sweepId:e,prevSweepId:t})},this.beginSweepTransition=e=>{this.sweepData.activateTransition(e.sweepId,e.prevSweepId||this.sweepData.currentSweep),this.internalProgress=e.internalProgress||!1,this.sweepData.transition.progress.modifyAnimation(0,1,e.transitionTime||0,e.easing||this.defaultEasing),this.sweepData.commit(),this.engine.broadcast(new c.Z(e.sweepId,e.prevSweepId))},this.endSweepTransition=e=>{const t=this.sweepData.getSweep(e.sweepId);this.sweepData.deactivateTransition(),this.sweepData.currentSweep=e.sweepId,this.sweepData.transition.progress.stop(1),this.internalProgress=!1,this.sweepData.commit(),this.engine.broadcast(new l.Z(e.sweepId,t.alignmentType,t.placementType,e.prevSweepId))},this.defaultSweepCameraMove=async(e,t)=>{const i={position:this.sweepData.getSweep(t.sweepId).position,rotation:t.rotation},n=(0,a.AN)(this.cameraData.aspect());let s=o.n.Interpolate;void 0!==t.transitionType&&o.n[t.transitionType]&&(s=t.transitionType);const r=this.cameraModule.moveTo({transitionType:s,pose:i,transitionTime:t.transitionTime,transitionSpeedMultiplier:t.transitionSpeedMultiplier,projection:n,easing:t.easing,rotationDelay:t.rotationDelay});let l=!1;return r.progress((i=>{this.sweepData.transition.progress.updateProgress(i),e.notify(i),i>=.5&&!l&&(l=!0,this.sweepData.currentSweep=t.sweepId,this.sweepData.commit(),this.engine.broadcast(new p.Z(t.sweepId,t.prevSweepId)))})),r.nativePromise()},this.tryInferFloorIds=e=>{for(const t of Object.values(e))if(t.isAligned()&&null===t.floorId){this.log.warn(`Aligned sweep ${t.index} has no floor association`);const i=t.neighbours.map((i=>({id:i,floorId:e[i].floorId,distance:e[i].floorPosition.distanceToSquared(t.floorPosition)})));i.sort(((e,t)=>e.distance-t.distance));const n=i.find((e=>e.floorId));n&&(this.log.debug(`Inferred Sweep ${t.index} floor as ${n.floorId} from neighbors`),t.floorId=n.floorId)}}}async init(e,t){const{readonly:i,baseUrl:n}=e;this.engine=t,this.market=this.engine.market,this.store=new MdsSweepStore({readonly:i,baseUrl:n});const o=await this.store.read()||{};[this.filterSweepData,this.tryInferFloorIds].forEach((e=>e(o))),(0,M.s)(o,(async()=>{if(this.store.refresh){const e=await this.store.refresh();this.sweepData.refresh(e||{})}else this.log.debug("Can't refresh sweep URLs - operation not supported")})),this.sweepData=new r.Z(o),this.market.register(this,r.Z,this.sweepData);const a=await t.getModule(U.F);if(!1===i){this.monitor=new L.c(this.sweepData.getCollection(),{aggregationType:R.E.NextFrame,shallow:!0},t),this.monitor.onChanged((()=>this.engine.commandBinder.issueCommand(new B.VQ({dataTypes:[F.g.SWEEPS]}))));const e=await t.market.waitForData(V.Q);e.setRevertableType(F.g.SWEEPS),e.setPublishableType(F.g.SWEEPS)}this.cameraModule=await this.engine.getModuleBySymbol(s.y.CAMERA),this.cameraData=await t.market.waitForData(u.M_),this.bindings.push(t.commandBinder.addBinding(m.NO,(async()=>{this.sweepData.currentSweep=void 0,this.sweepData.commit()})),t.commandBinder.addBinding(m.aK,(async e=>{if(e.sweepId)try{const t=e.sweepId;await this.activateSweepUnsafe({sweepId:t});const i=this.sweepData.currentSweep;this.beginSweepTransition({sweepId:t,transitionTime:0,internalProgress:!0,prevSweepId:i}),this.sweepData.currentSweep=t,this.endSweepTransition({sweepId:t,prevSweepId:i}),this.sweepData.commit()}catch(e){this.log.error(e)}else this.sweepData.currentSweep=void 0,this.sweepData.commit()})),a.onSave((()=>this.save()),{dataType:F.g.SWEEPS}))}filterSweepData(e){for(const t in e){const i=e[t];i.neighbours=i.neighbours.filter((t=>t in e))}}onUpdate(e){this.internalProgress&&this.sweepData.transition.active&&this.sweepData.transition.progress.tick(e)}async save(){if(!this.store)throw Error("No store configured for saving sweep edits!");const e=this.monitor.getDiffRecord();this.monitor.clearDiffRecord();const t=e.filter((e=>e.action===k.KI.updated)).map((e=>{const t=this.sweepData.getSweep(e.index),i=Object.assign({id:e.index},e.diff);return("position"in i||"rotation"in i)&&(i.position=t.position,i.rotation=t.rotation),("enabled"in i||"vrenabled"in i)&&(i.enabled=t.enabled,i.vrenabled=t.vrenabled),i}));return this.store.update(t)}}},57051:(e,t,i)=>{"use strict";i.d(t,{Dv:()=>l,TE:()=>c,o7:()=>d,l0:()=>h,Bv:()=>u});var n=i(2212);const s=-1,r=10,o=5,a=-5,l=(e,t=s)=>i=>e.distanceToSquared(i.position)*t,c=(e,t=s)=>i=>e.distanceTo(i.position)*t,d=(e,t,i=r)=>{const s=new n.Vector3;return n=>s.copy(n.position).sub(e).normalize().dot(t)*i},h=(e,t=s)=>i=>e.distanceToSquared(i.floorPosition)*t,u=(e,t=o,i=a)=>n=>e===n.floorId?t:i},91715:(e,t,i)=>{"use strict";var n;i.d(t,{Z:()=>s}),function(e){e[e.Center=0]="Center",e[e.UpperLeft=1]="UpperLeft",e[e.UpperRight=2]="UpperRight",e[e.LowerRight=3]="LowerRight",e[e.LowerLeft=4]="LowerLeft"}(n||(n={}));const s=n},52586:(e,t,i)=>{"use strict";i.d(t,{S:()=>c,Z:()=>PanoQualityManager});var n=i(34369),s=i(37381),r=i(17486),o=i(14844),a=i(64185);const l=new(i(88512).Z)("panoqualitymanager");var c;!function(e){e[e.Untested=0]="Untested",e[e.Testing=1]="Testing",e[e.Success=2]="Success",e[e.Fail=3]="Fail"}(c||(c={}));class PanoQualityManager{constructor(e,t,i,n){this.urls=e,this.maxCubemapSize=t,this.maxNavPanoSize=i,this.maxZoomPanoSize=n,this.overrideWindow=!1,this.devicePixelRatio=window.devicePixelRatio||1,this.navPanoSize=-1,this.zoomPanoSize=-1,this.windowHeight=window.innerHeight*this.devicePixelRatio,this.highQualityThreshold=s.Xd.windowHeightHighQualityThresholdOverride||s.Xd.windowHeightHighQualityThreshold,this.persistentStorage=new r.a,this.downloadTestResults={},this.updateMaximums()}setWindowSize(e,t){this.windowHeight=t*this.devicePixelRatio,this.updateMaximums()}overrideWindowMaximums(e){this.overrideWindow=e,this.updateMaximums()}updateNavPanoSize(e){this.maxNavPanoSize=e,this.updateMaximums()}getTestResults(e,t){const i=this.downloadTestResults[e];if(i){const e=i[t];if(e)return e}return c.Untested}ultraHighQualityModeEnabled(e){const t=n.Qf[this.getZoomPanoSize()],i=this.downloadTestResults[e];return!(!i||!i[t])&&i[t]===c.Success}updateMaximums(){this.windowHeight<this.highQualityThreshold&&!this.overrideWindow?(this.navPanoSize=Math.min(PanoQualityManager.getPanoSize(n.SL.STANDARD),this.maxNavPanoSize),this.zoomPanoSize=Math.min(PanoQualityManager.getPanoSize(n.SL.HIGH),this.maxZoomPanoSize)):(this.navPanoSize=this.maxNavPanoSize,this.zoomPanoSize=this.maxZoomPanoSize),this.zoomPanoSize<this.navPanoSize&&(this.navPanoSize=this.zoomPanoSize),this.zoomPanoSize=Math.min(this.maxCubemapSize,this.zoomPanoSize),this.navPanoSize=Math.min(this.maxCubemapSize,this.navPanoSize)}static getPanoSize(e){if(e in n.eE)return n.eE[e];throw new Error(`Not a panoSizeClass: ${e}`)}static getPanoSizeClass(e){if(e in n.Qf)return n.Qf[e];throw new Error(`Not a valid pano resolution: ${e}`)}getMaxPossiblePanoSize(){return PanoQualityManager.getPanoSize(n.SL.ULTRAHIGH)}getNavPanoSize(){return this.navPanoSize}getZoomPanoSize(){return this.zoomPanoSize}availableResolution(e,t){const i=new a.Q;if(!t)return i.reject(0);if(e.resolutions)return e.resolutions.includes(t)?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t));switch(this.getTestResults(e.id,t)){case c.Success:i.resolve(t);break;case c.Fail:return this.availableResolution(e,this.getLowerResolution(t));case c.Untested:this.testDownload(e,t,o.I_).then((n=>{n?i.resolve(t):this.availableResolution(e,this.getLowerResolution(t)).then((e=>i.resolve(e)))}));break;case c.Testing:l.warn("resolution is already testing, do we need to handle this?")}return i}getLowerResolution(e){switch(e){case n.SL.ULTRAHIGH:return n.SL.HIGH;case n.SL.HIGH:return n.SL.STANDARD;case n.SL.STANDARD:return n.SL.BASE}return null}testDownload(e,t,i){if(!this.urls)throw new Error("Can't call testDownload without signed urls");const n=PanoQualityManager.getPanoSize(t),s=new a.Q,r=e.id;this.downloadTestResults[r]||(this.downloadTestResults[r]={});const o=this.downloadTestResults[r]&&this.downloadTestResults[r][t];if(o)o===c.Success?s.resolve(!0):o===c.Fail&&s.resolve(!1);else{this.downloadTestResults[r][t]=c.Testing;const o=e=>{this.downloadTestResults[r][t]=c.Success,s.resolve(!0)},a=()=>{this.downloadTestResults[r][t]=c.Fail,s.resolve(!1)};this.getTileUrl(e,n,i,0).then((e=>{this.urls.getImage(e).then(o,a)}))}return s}getTileUrl(e,t,i,n){const s=this.persistentStorage.get("getTileUrl:locationInfo",(()=>({face:-1,faceTileIndex:-1,tileX:-1,tileY:-1})));o.Tp(t,n,s);const r=Math.floor(t/i),a=r*r,l=Math.floor(n/a),c=PanoQualityManager.getPanoSizeClass(t);return e.getTileUrl(c,l,s.tileX,s.tileY)}}},14844:(e,t,i)=>{"use strict";i.d(t,{I_:()=>l,Hq:()=>c,P6:()=>d,R5:()=>h,Tp:()=>u,Tu:()=>p,ym:()=>m,oU:()=>f,eO:()=>v});var n=i(48277),s=i(2212),r=i(91715),o=i(44110),a=i(7170);const l=512,c=6,d=(e,t,i,s,o,a,l,c)=>{const d=e/t,h=2*(t/e),u=h/2;let p=2*(s/d)-1+u,m=2*((o=d-1-o)/d)-1+u;switch(a=a||r.Z.Center){case r.Z.UpperLeft:p-=u,m+=u,p+=l*h;break;case r.Z.UpperRight:p+=u,m+=u,m-=l*h;break;case r.Z.LowerRight:p+=u,m-=u,p-=l*h;break;case r.Z.LowerLeft:p-=u,m-=u,m+=l*h;break;case r.Z.Center:}switch(i){case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:c.set(-1,m,-p);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:c.set(1,m,p);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:c.set(-p,1,-m);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:c.set(-p,-1,m);break;case n.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:c.set(-p,m,1);break;case n.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:c.set(p,m,-1)}c.normalize()},h=(e,t)=>{let i=l;e<l&&(i=e);const n=Math.floor(e/i),s=n*n;return Math.floor(t/s)},u=(e,t,i)=>{let n=l;e<l&&(n=e);const s=h(e,t),r=Math.floor(e/n),o=t-s*(r*r);i.tileX=o%r,i.tileY=Math.floor(o/r),i.face=s,i.faceTileIndex=o},p=function(e){if(e<=l)return c;const t=Math.floor(e/l);return t*t*c},m=function(){const e=new s.Matrix4,t=new s.Quaternion;return(i,n)=>{t.copy(i),t.invert(),e.makeRotationFromQuaternion(t),n.applyMatrix4(e),n.normalize()}}(),f=function(){const e=new s.Vector3,t=new s.Vector3(0,0,-1),i=new s.Quaternion,n=function(e,t){e.push({face:t.face,faceTileIndex:t.faceTileIndex,tileX:t.tileX,tileY:t.tileY})},r=function(){const e={face:-1,faceTileIndex:-1,tileX:-1,tileY:-1};return(t,i,s)=>{const r=p(t);let o=0;for(let a=0;a<r;a++)u(t,a,e),i&&!i(e)||(o++,s&&n(s,e));return o}}();return(n,o,a,c,d=!1,h,u)=>{c.length=d?0:c.length;const p=o<l?o:l;if(!h&&!u)return r(o,null,c);const f=!!u;h=h||0,u=u||h,u=Math.max(0,Math.min(u,360)),h=Math.max(0,Math.min(h,360)),e.copy(a);const y=n.rotation||new s.Quaternion;if(m(y,e),f){i.setFromUnitVectors(e,t);return r(o,(function(e){return g(o,p,e.face,e.tileX,e.tileY,i,h||0,u||0)}),c)}return r(o,(function(t){return v(o,p,t.face,t.tileX,t.tileY,e,h||0)}),c)}}(),g=function(){const e=new s.Vector3;return(t,i,n,s,l,c,h,u)=>{const p=Math.tan(.5*u*a.Ue),m=-p,f=Math.tan(.5*h*a.Ue),g=-f,v=(0,o.m)(n);let y=0,b=0,S=0,E=0,T=0;for(let n=r.Z.Center;n<=r.Z.LowerLeft;n++){if(d(t,i,v,s,l,n,0,e),e.applyQuaternion(c),e.z>=-1e-5)continue;const r=-1/e.z,o=e.x*r,a=e.y*r;a>p?y++:a<m&&b++,o>f?S++:o<g&&E++,T++}return b!==T&&y!==T&&S!==T&&E!==T}}(),v=function(){const e=new s.Vector3,t=new s.Vector3(0,1,0),i=new s.Vector3(1,0,0);return(n,s,a,l,c,h,u)=>{const p=(0,o.m)(a);if(i.copy(h).cross(t),d(n,s,p,l,c,r.Z.Center,0,e),y(e,h,u))return!0;const m=u/360,f=Math.floor(1/m);let g=0;for(let t=0;t<f;t++){for(let t=r.Z.UpperLeft;t<=r.Z.LowerLeft;t++)if(d(n,s,p,l,c,t,g,e),y(e,h,u))return!0;g+=m}return!1}}(),y=function(){const e=new s.Vector3,t=new s.Vector3;return(i,n,s,r)=>{if(t.copy(i),r){e.copy(r),e.normalize();const n=e.dot(i);e.x*=n,e.y*=n,e.z*=n,t.sub(e)}const o=s/2*a.Ue,l=Math.cos(o);return t.dot(n)>=l}}()},50401:(e,t,i)=>{"use strict";i.d(t,{o:()=>TileDownloadedMessage});var n=i(91466);class TileDownloadedMessage extends n.v{constructor(){super()}}},37381:(e,t,i)=>{"use strict";i.d(t,{YS:()=>s,Xd:()=>r,k4:()=>TilingSettings});var n=i(17597);const s="settings/tiling/preload_quality",r=Object.freeze({overlayStyle:(0,n.eY)("tileoverlay",0),uploadIntervalDelay:(0,n.eY)("tileupdelay",50),highResUploadsPerFrame:(0,n.eY)("maxnbtpf",2),maxHighResUploadsPerFrame:100,loadIndicatorDelay:300,uploadsPerFrame:(0,n.eY)("maxbtpf",6),maxUploadsPerFrame:100,windowHeightHighQualityThreshold:800,windowHeightHighQualityThresholdOverride:(0,n.eY)("threshold2k",void 0),concurrentDownloads:(0,n.eY)("tileconc",3),maxConcurrentDownloads:12,navigation:{directionFactor:10,distanceFactor:-1}});class TilingSettings{constructor(){this.reset()}reset(){this.downloadFullPano=!1,this.concurrentDownloads=r.concurrentDownloads,this.uploadsPerFrame=r.uploadsPerFrame,this.highResUploadsPerFrame=r.highResUploadsPerFrame}}},41862:(e,t,i)=>{"use strict";var n;i.d(t,{v:()=>n}),function(e){e[e.CurrentView=0]="CurrentView",e[e.FullPanorama=1]="FullPanorama"}(n||(n={}))},48280:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RestrictedSweepsClearedMessge});var n=i(91466);class RestrictedSweepsClearedMessge extends n.v{constructor(){super()}}},909:(e,t,i)=>{"use strict";i.d(t,{Z:()=>RestrictedSweepsSetMessge});var n=i(91466);class RestrictedSweepsSetMessge extends n.v{constructor(e){super(),this.sweepIds=e}}},29419:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPathModule});var n=i(2212),s=i(47724),r=i(75892),o=i(40732);const a=Object.freeze({sweeps:{maxNeighborDistance:50}});var l=i(909),c=i(48280);class SweepPathModule extends s.Y{constructor(){super(...arguments),this.name="sweep-path"}async init(e,t){this.engine=t,this.sweepData=await t.market.waitForData(r.Z),this.validNeighbors={},this.maxNeighborDistance=e.maxNeighborDistance||a.sweeps.maxNeighborDistance,this.buildDistanceMap()}setRestrictedSweeps(e,t=0){if(this.restrictedSweeps=[],e){for(let i=t;i<e.length;i++)this.restrictedSweeps.push(e[i].id);this.engine.broadcast(new l.Z(this.restrictedSweeps))}else this.restrictedSweeps=void 0,this.engine.broadcast(new c.Z)}findShortestPath(e,t,i,n,s,r,a=5e3){const l=this.sweepData.getSweep(e),c=this.sweepData.getSweep(t),d=this,h=(0,o.K)({start:l,isEnd:e=>e===c,*neighbors(e){for(const t of e.neighbours)yield d.sweepData.getSweep(t)},distance:(e,t)=>d.getDistance(e.id,t.id),heuristic:(e,t)=>1,timeout:a});return h.status===o.h.Success&&h.path.length<s?(this.addSweepsNearPath(h.path,i),this.filterCloseSweepsFromPath(h.path,n)):null}addSweepsNearPath(e,t){const i=new n.Vector3,s=new n.Vector3,r=new n.Vector3,o=new n.Vector3,a=new n.Vector3,l=new n.Vector3,c=[],d=new n.Vector3,h=(e,t,i)=>(r.copy(t).sub(e),r.dot(i)),u=(e,t)=>h(d,e.position,i)-h(d,t.position,i);let p=0;for(;p<e.length-1;){const n=e[p].id,h=e[p+1].id,m=this.sweepData.getSweep(n),f=this.sweepData.getSweep(h);d.copy(m.position),c.length=0,i.copy(f.position).sub(d).normalize();const g=this.findConnectedSweeps(m,this.maxNeighborDistance),v=this.findConnectedSweeps(f,this.maxNeighborDistance),y=g.concat(v);for(const e of y){const n=r.copy(e.position).sub(d).dot(i);if(n>0){a.copy(i),a.multiplyScalar(n),o.copy(r),o.sub(a);if(o.length()<t){s.copy(i).negate(),l.copy(e.position).sub(f.position);l.dot(s)>0&&c.push(e)}}}if(c.length>0){c.sort(u);for(let t=e.length+c.length-1;t>=p+c.length;t--)e[t]=e[t-c.length];for(let t=0;t<c.length;t++)e[t+p+1]=c[t]}p+=c.length+1}}findConnectedSweeps(e,t,i=2){const n=[];return this._findConnectedSweeps(e,e,t,n,{},i,0),n}_findConnectedSweeps(e,t,i,n,s,r,o){const a=this.getValidNeighbors(e.id);for(const e of a)if(!s[e.id]){e.position.distanceTo(t.position)<i&&(n.push(e),s[e.id]=!0,o<r&&this._findConnectedSweeps(e,t,i,n,s,r,o+1))}}getValidNeighbors(e,t){let i=this.validNeighbors[e];if(!i){i=[],this.validNeighbors[e]=i;const n=this.sweepData.getSweep(e),s=n.neighbours;for(const r of s){const s=this.sweepData.getSweep(r),o=this.getDistance(e,r);if(!s.enabled)continue;if(o>this.maxNeighborDistance)continue;let a=!0;if(t){const e=s.position.clone().sub(n.position).normalize();a=0===t(n.position,e,o).length}a&&i.push(s)}}return i}filterCloseSweepsFromPath(e,t){const i=[];let n=null,s=!1;for(const r of e)s=n&&r.position.distanceTo(n.position)<t||!1,n&&s||(i.push(r),n=r);return i.length<2?e:(s&&e.length>1&&(i[i.length-1]=e[e.length-1]),i)}getCurveForPath(e){let t=0;const i=[0];for(let n=1;n<e.length;n++)t+=e[n-1].distanceTo(e[n]),i.push(t);const s=[0];for(let n=1;n<e.length;n++)s.push(i[n]/t);const r=new n.CatmullRomCurve3(e,!1);return{curve:new n.CatmullRomCurve3(r.getSpacedPoints(2*t).concat(e[e.length-1])),totalLength:t,sourceDistances:i,normalSourceDistances:s}}buildDistanceMap(){const e={},t=new n.Vector3(0,0,0);this.sweepData.iterate((i=>{const n={},s=i.neighbours;for(const e of s){const s=this.sweepData.getSweep(e);t.copy(i.position).sub(s.position);let r,o=Math.max(0,Math.abs(t.y)-.2),a=Math.sqrt(t.x*t.x+t.z*t.z);o>0?(o=Math.pow(4*o,2),a=Math.pow(a,2),r=Math.sqrt(o*o+a*a)):r=t.length(),n[s.id]=r}e[i.id]=n})),this.distanceMap=e}getDistance(e,t){return this.distanceMap[e][t]}}},46450:(e,t,i)=>{"use strict";i.d(t,{m1:()=>PinCollider,Vp:()=>PinMesh});var n=i(2212),s=i(76570),r=i.n(s),o=i(69254),a=i.n(o);class PinMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(PinMaterial.uniforms);i.tMask.value=e,i.tPinHole.value=t,super({vertexShader:r(),fragmentShader:a(),uniforms:i,name:"PinMaterial",transparent:!0})}}PinMaterial.uniforms={tMask:{type:"t",value:null},tPinHole:{type:"t",value:null},pinColor:{type:"c",value:new n.Color},opacity:{type:"f",value:1}};var l=i(66223),c=i(27408),d=i(48358),h=i(87068),u=i(53225),p=i(48072);class PinCollider extends n.Mesh{}let m;const f=()=>m||(m=(0,l.p)(p),m);class PinMesh extends u.E{constructor(e,t,i,n){const s=new PinMaterial(f(),t);super(PinMesh.geometry,s),this.layers.mask=n.mask,this.name="PinMesh",this.cameraData=i,this._collider=new PinCollider(PinMesh.colliderGeometry,PinMesh.colliderMaterial),this._collider.name="PinMeshCollider",this._collider.material.visible=!1,this.add(this._collider),this.opacityProgress=0,this.shouldHide=!0,this.uniforms=s.uniforms,this.unhover(),this.selected=0,this.visible=!1,this.position.copy(e),this.renderOrder=d.z.pins360}updatePosition(e){this.position.copy(e)}get collider(){return this._collider}render(e){this.quaternion.copy(this.cameraData.pose.rotation),null===this.uniforms.tPinHole.value?this.opacityProgress=0:!this.shouldHide&&this.opacityProgress<1?this.opacityProgress+=e/PinMesh.FADE_DURATION:this.shouldHide&&this.opacityProgress>0&&(this.opacityProgress-=e/PinMesh.FADE_DURATION),this.opacityProgress=(0,c.uZ)(this.opacityProgress,0,1),this.uniforms.opacity.value=this.opacityProgress,this.visible=0!==this.opacityProgress}activate(){this.shouldHide=!1}deactivate(){this.shouldHide=!0}dispose(){this.collider.geometry.dispose(),this.collider.material.dispose()}setPinHover(e,t=!0,i=!0){const n=Math.min(Math.max(e,0),1);this.selected!==n&&(i&&this.uniforms.pinColor.value.copy(h.I.WHITE).lerp(h.I.MP_BRAND,n),t&&n>0&&n<=1&&(this.material.depthTest=!1),0===n&&(this.material.depthTest=!0),this.selected=n)}unhover(){this.uniforms.pinColor.value.copy(h.I.WHITE)}}PinMesh.FADE_DURATION=500,PinMesh.geometry=new n.PlaneBufferGeometry(1.5,1.5),PinMesh.colliderGeometry=new n.SphereBufferGeometry(1.5*.65),PinMesh.colliderMaterial=new n.MeshBasicMaterial({transparent:!0,opacity:.5,depthWrite:!1,color:16724312})},51561:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPinMesh});var n=i(47724),s=i(96909),r=i(2212),o=i(46450),a=i(91466);class PinSelectMessage extends a.v{constructor(e,t){super(),this.sweepId=e,this.selected=t}}class PinPlacementMessage extends a.v{constructor(e,t,i){super(),this.sweepId=e,this.pinIndex=t,this.placed=i}}class SweepPlacedMessage extends a.v{constructor(e,t){super(),this.sweepId=e,this.position=t}}var l=i(35026),c=i(34369),d=i(51263),h=i(94610),u=i(88512),p=i(95586),m=i(24764);const f=new u.Z("pin-mesh");class PinMeshRenderer{constructor(e,t,i,n,s,o){this.sweepViewData=e,this.scene=t,this.sweepTextureLoader=i,this.input=n,this.layer=o,this.container=new r.Object3D,this.bindings=[],this.visibilityFilter=()=>!0,this.updatePlacementType=(e,t)=>{this.dataToMeshMap[e.id]||e.placementType!==l.hU.MANUAL?this.dataToMeshMap[e.id]&&e.placementType!==l.hU.MANUAL&&(this.removePinMesh(e),this.engine.broadcast(new PinPlacementMessage(e.id,t,!1))):(this.createPinMesh(e,this.cameraData),this.engine.broadcast(new PinPlacementMessage(e.id,t,!0)))},this.onSweepPlacedMessage=e=>{this.highlightPin(e.sweepId,!0)},this.hoverSweep=(e,t)=>{this.issueCommand(new p.kR(e,t,0));const i=this.sweepViewData.selectedSweep===e;this.highlightPin(e,t||i)},this.meshes=[],this.meshToDataMap={},this.dataToMeshMap={},this.cameraData=s,e.iterate((t=>{t.alignmentType!==l.z9.ALIGNED&&(t.placementType===l.hU.MANUAL&&this.createPinMesh(t,s),this.bindings.push(t.onChanged((()=>{const i=e.getIndexByAlignment(!1,t.id);this.updatePlacementType(t,i),d.H7(t)&&this.updatePinMeshPosition(t.id,t.position)}))))}))}updatePinMeshPosition(e,t){this.mapSweepToMesh(e).updatePosition(t)}mapSweepToMesh(e){return this.dataToMeshMap[e]}mapColliderToSweep(e){const t=e.hasOwnProperty("collider")?e:e.parent;if(t){const e=this.meshToDataMap[t.id];if(e)return e.sweep}return null}filter(e){this.visibilityFilter=e;for(const e of this.meshes)this.filterMesh(e)}init(){}dispose(){for(const e in this.meshToDataMap){const t=this.meshToDataMap[e];this.removePinMesh(t.sweep)}}render(e){for(const t of this.meshes)t.render(e)}activate(e){this.engine=e,this.issueCommand=e.commandBinder.issueCommand.bind(e.commandBinder),this.bindings.push(this.input.registerMeshHandler(h.z,m.s.isType(o.m1),((e,t)=>this.onHoverEvent(t,!0)))),this.bindings.push(this.input.registerMeshHandler(h.A,m.s.isType(o.m1),((e,t)=>this.onHoverEvent(t,!1)))),this.bindings.push(e.subscribe(SweepPlacedMessage,this.onSweepPlacedMessage)),this.scene.add(this.container)}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}getMeshes(){return this.meshToDataMap}highlightPin(e,t){this.dataToMeshMap[e]&&this.dataToMeshMap[e].setPinHover(t?1:0,!1)}lockSelection(e,t){return t&&(this.engine.broadcast(new PinSelectMessage(e.id,!0)),this.hoverSweep(e.id,!0)),!0}createPinMesh(e,t){const i=new o.Vp(e.position,null,t,this.layer);this.meshes.push(i),this.dataToMeshMap[e.id]=i,this.meshToDataMap[i.id]={id:i.id,sweep:e},this.container.add(i),this.filterMesh(i),this.sweepTextureLoader.loadFace(e,c.SL.BASE,1,{flipY:!0}).then((e=>{i.material.uniforms.tPinHole.value=e})).catch((t=>{f.error(`${e.id} failed to load texture: ${t}`)}))}removePinMesh(e){const t=this.dataToMeshMap[e.id],i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.id],t.dispose()}filterMesh(e){const t=this.meshToDataMap[e.id];if(t){const i=t.sweep;this.visibilityFilter(i)?this.activateMesh(e):this.deactivateMesh(e)}}onHoverEvent(e,t){const i=this.mapColliderToSweep(e);i&&this.hoverSweep(i.id,t)}activateMesh(e){this.input.registerMesh(e.collider,!1),e.activate()}deactivateMesh(e){this.input.unregisterMesh(e.collider);const t=this.meshToDataMap[e.id];t&&(this.hoverSweep(t.sweep.id,!1),e.deactivate())}}PinMeshRenderer.MENU_CLEAR_DEBOUNCE=100;var g=i(76463),v=i(17386);class PinUnselectCommand extends v.m{constructor(e){super(),this.id="PIN_UNSELECT",this.payload={id:e}}}class SweepStartedRotatingMessage extends a.v{constructor(e){super(),this.sweepId=e}}class SweepFinishedRotatingMessage extends a.v{constructor(e){super(),this.sweepId=e}}var y=i(95395),b=i(21479),S=i(59088),E=i(35597),T=i(33874),w=i(5087),x=i(27326),_=i(65379),M=i(1226),O=i(90454),A=i(28963);class SweepPinMesh extends n.Y{constructor(){super(...arguments),this.name="sweep-pin-mesh",this.onChange=()=>{const e=this.sweepViewData,t=e.selectedSweep,i=e.toolState===M._.ROTATING||e.toolState===M._.ROTATED;this.pinRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(A.s,!0))return!1;if(i&&t===e.id)return!1;if(this.viewmodeData.transition.active&&(0,w.Bw)(this.viewmodeData.transition.to))return!1;const n=!this.nextFloor||this.nextFloor===e.floorId||!e.floorId,s=this.config.showPinsInFloorplanDollhouse||this.applicationData.application===b.Mx.WORKSHOP,r=this.viewmodeData.closestMode===w.Ey.Dollhouse||this.viewmodeData.closestMode===w.Ey.Floorplan;return n&&r&&s}))},this.onSelectedPinChange=()=>{const e=this.sweepViewData.selectedSweep;e&&(this.engine.commandBinder.issueCommand(new p.iF(e,!0,0)),this.pinRenderer.highlightPin(e,!0))}}async init(e,t){var i;[this.model,this.webglRenderer,this.input,this.sweepViewData,this.cameraData,this.settingsData,this.viewmodeData,this.floorsViewData,this.applicationData]=await Promise.all([t.getModule(y.default),t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.getModuleBySymbol(s.y.INPUT),t.market.waitForData(_.D),t.market.waitForData(S.M_),t.market.waitForData(T.e),t.market.waitForData(E.O),t.market.waitForData(x.c),t.market.waitForData(b.pu)]);const n=t.claimRenderLayer(this.name),r=this.webglRenderer.getScene().scene;this.config={showPinsInFloorplanDollhouse:null===(i=e&&e.showPinsInFloorplanDollhouse)||void 0===i||i},this.engine=t;const o=new g.Z(this.model.getSignedUrls());this.pinRenderer=new PinMeshRenderer(this.sweepViewData,r,o,this.input,this.cameraData,n),t.addComponent(this,this.pinRenderer),this.bindings.push(this.applicationData.onPropertyChanged("application",this.onChange),this.settingsData.onPropertyChanged(A.s,this.onChange),this.viewmodeData.onChanged(this.onChange),this.sweepViewData.onSelectedSweepChanged(this.onSelectedPinChange),t.subscribe(O.S,(e=>{this.nextFloor=e.to,this.onChange()})),t.subscribe(SweepStartedRotatingMessage,this.onChange),t.subscribe(SweepFinishedRotatingMessage,this.onChange),t.commandBinder.addBinding(PinUnselectCommand,(async e=>{this.pinRenderer.highlightPin(e.id,!1)}))),this.nextFloor=this.floorsViewData.currentFloorId,this.onChange()}mapColliderToSweep(e){return this.pinRenderer.mapColliderToSweep(e)}selectPinMesh(e,t){return this.pinRenderer.lockSelection(e,t)}highlightPinMesh(e,t){this.pinRenderer.highlightPin(e,t)}mapSweepToMesh(e){return this.pinRenderer.mapSweepToMesh(e)}updatePosition(e,t){this.pinRenderer.updatePinMeshPosition(e,t)}}},28963:(e,t,i)=>{"use strict";i.d(t,{s:()=>n});const n="features/360_views"},16400:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPinNavigation});var n=i(47724),s=i(51561),r=i(46450),o=i(4901),a=i(14092),l=i(5087),c=i(31278),d=i(93263),h=i(35597),u=i(2212),p=i(35003),m=i(94610),f=i(24764),g=i(96909);class SweepPinNavigation extends n.Y{constructor(){super(...arguments),this.name="sweep-pin-navigation"}async init(e,t){const[i,n,v,y]=await Promise.all([t.getModule(s.default),t.getModule(d.default),t.market.waitForData(h.O),t.getModuleBySymbol(g.y.INPUT)]),b=new u.Quaternion;this.bindings.push(y.registerMeshHandler(p.R,f.s.isType(r.m1),((e,t,s)=>{const r=i.mapColliderToSweep(t);return!(!r||v.transition.active)&&(b.set(0,0,0,1).multiply(r.rotation),o=r.id,a=b,v.currentMode&&v.currentMode!==l.Ey.Panorama&&n.switchToMode(l.Ey.Panorama,c.n.FadeToBlack,{sweepID:o,rotation:a}),!0);var o,a})),y.registerMeshHandler(m.z,f.s.isType(r.m1),((e,n)=>{i.mapColliderToSweep(n)&&t.commandBinder.issueCommand(new o.u(a.C.FINGER))})),y.registerMeshHandler(m.A,f.s.isType(r.m1),((e,n)=>{i.mapColliderToSweep(n)&&t.commandBinder.issueCommand(new o.u(null))})))}}},74712:(e,t,i)=>{"use strict";i.d(t,{p:()=>PortalPuckMesh,Y:()=>f});var n=i(2212),s=i(22118),r=i.n(s),o=i(28100),a=i.n(o);class PortalMaterial extends n.RawShaderMaterial{constructor(e,t){const i=n.UniformsUtils.clone(PortalMaterial.uniforms);i.tNoHover.value=e,i.tHover.value=t,i.tPortal.value=null,super({vertexShader:r(),fragmentShader:a(),uniforms:i,name:"PortalMaterial",transparent:!0})}}PortalMaterial.uniforms={tNoHover:{type:"t",value:null},tHover:{type:"t",value:null},tPortal:{type:"t",vlaue:null},progress:{type:"f",value:1},opacity:{type:"f",value:1}};var l=i(66223),c=i(68444),d=i(85089),h=i(45545),u=i(64293);let p;const m={get:()=>p||(p={toExteriorTexture:(0,l.p)(c),toExteriorHoverTexture:(0,l.p)(d),toInteriorTexture:(0,l.p)(h),toInteriorHoverTexture:(0,l.p)(u)},p)};var f,g=i(27408),v=i(48358),y=i(89352);!function(e){e[e.HIDE=0]="HIDE",e[e.SHOW=1]="SHOW",e[e.ONTOP=2]="ONTOP"}(f||(f={}));class PortalPuckMesh extends n.Mesh{constructor(e,t){const i=new PortalMaterial(m.get().toInteriorTexture,m.get().toInteriorHoverTexture);super(PortalPuckMesh.geometry,i),this.layers.mask=t.mask,this.uniforms=i.uniforms,this.renderOrder=v.z.portals,this.setState(f.HIDE),this.update(e)}update(e){if(this.portalData=e,this.position.copy(e.position),null!==e.lookDirection){const t=e.lookDirection.clone().add(e.position);this.lookAt(t)}this.hoverProgress=0,this.hovered=!1,e.toExterior?(this.uniforms.tNoHover.value=m.get().toExteriorTexture,this.uniforms.tHover.value=m.get().toExteriorHoverTexture):(this.uniforms.tNoHover.value=m.get().toInteriorTexture,this.uniforms.tHover.value=m.get().toInteriorHoverTexture)}resetMesh(e=0,t=!1,i=!1){this.uniforms.opacity.value=e,this.visible=0!==e,this.material.depthTest=t,this.material.depthWrite=i}setHover(e){this.hovered=e}setState(e){switch(e){case f.HIDE:this.resetMesh(0,!0,!0);break;case f.SHOW:this.resetMesh(1,!0,!0);break;case f.ONTOP:this.resetMesh(1)}}render(e,t){var i;if(this.hovered&&this.hoverProgress<1?this.hoverProgress+=e/300:!this.hovered&&this.hoverProgress>0&&(this.hoverProgress-=e/300),this.hoverProgress=(0,g.uZ)(this.hoverProgress,0,1),this.uniforms.progress.value=this.hoverProgress,null===(i=this.portalData)||void 0===i?void 0:i.billboard){const e=t.pose.position,i=this.position.copy(this.portalData.position),n=e.distanceTo(i);n<y.nm?i.lerpVectors(e,i,y.nm/n):n>y.iz&&i.lerpVectors(e,i,y.iz/n),this.lookAt(t.pose.position)}}updatePortalTexture(e){this.uniforms.tPortal.value=e}}PortalPuckMesh.geometry=new n.PlaneGeometry(y.vX,y.vX)},89799:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>PortalPuckMeshModule});var n=i(47724),s=i(96909),r=i(34369),o=i(2212),a=i(95432),l=i.n(a),c=i(64506),d=i.n(c);class PortalViewportMaterial extends o.RawShaderMaterial{constructor(){const e=o.UniformsUtils.clone(PortalViewportMaterial.uniforms);super({vertexShader:l(),fragmentShader:d(),uniforms:e,name:"PortalViewportMaterial",side:o.BackSide})}updateTexture(e){this.uniforms.tMap.value=e}}PortalViewportMaterial.uniforms={tMap:{type:"t",value:null}};class PortalViewportLoader{constructor(e,t,i,n){this.tempLookDirection=new o.Vector3,this.worldCamera=n,this.camera=new o.Camera,this.renderSize=i,this.sweepTextureLoader=e,this.textureRenderer=t,this.renderTargets={},this.renderCube=new o.Mesh(new o.BoxGeometry(4,4,4),new PortalViewportMaterial)}async getPortalTexture(e,t,i){const n=this.renderTargets[e.id]||this.textureRenderer.createRenderTarget2D(this.renderSize,this.renderSize),s=await this.sweepTextureLoader.load(e,r.SL.BASE);return this.renderCube.material.updateTexture(s),this.renderCube.quaternion.copy(t),this.camera.projectionMatrix.copy(this.worldCamera.projectionMatrix),this.worldCamera.getWorldPosition(this.tempLookDirection),this.camera.lookAt(this.tempLookDirection.sub(i).negate()),this.textureRenderer.render(n,this.renderCube,this.camera),n.texture}releasePortalTexture(e){const t=this.renderTargets[e];t&&this.textureRenderer.disposeRenderTarget2D(t)}}var h=i(74712),u=i(9293),p=i(94610),m=i(35003),f=i(24764),g=i(55958);class PortalPuckRenderer{constructor(e,t,i,n,s){this.container=new o.Object3D,this.bindings=[],this.visibilityFilter=e=>h.Y.HIDE,this.scene=e,this.input=t,this.layer=n,this.cameraData=s,this.viewportLoader=i,this.meshes=[],this.activeMeshes={},this.meshToDataMap={},this.dataToMeshMap={},this.activeTexturePromises={},this.meshPool=new u.L}addPortal(e){let t;const i=this.meshPool.get();i?(t=i.object,t.update(e)):t=this.meshPool.add(new h.p(e,this.layer)).object,this.meshes.push(t),this.container.add(t),this.meshToDataMap[t.id]=e,this.dataToMeshMap[e.index]=t,this.activateMesh(t,this.visibilityFilter(e))}removePortal(e){const t=this.dataToMeshMap[e.index];if(t){this.meshPool.free(t);const i=this.meshes.findIndex((e=>e.id===t.id));this.meshes.splice(i,1),this.container.remove(t),this.deactivateMesh(t),delete this.meshToDataMap[t.id],delete this.dataToMeshMap[e.index]}}init(){}activate(e){this.broadcast=e.broadcast.bind(e),this.bindings.push(this.input.registerMeshHandler(p.z,f.s.isType(h.p),((e,t)=>{this.onPuckSelect(t)}))),this.bindings.push(this.input.registerMeshHandler(p.A,f.s.isType(h.p),((e,t)=>{this.onPuckDeselect(t)}))),this.bindings.push(this.input.registerMeshHandler(m.R,f.s.isType(h.p),((e,t)=>{this.onPuckClick(t)}))),this.scene.add(this.container)}dispose(){for(const e of Object.keys(this.meshToDataMap)){const t=this.meshToDataMap[e],i=this.dataToMeshMap[t.index];this.removePortal(t),i.material.dispose(),i.geometry.dispose()}}deactivate(e){for(const e of this.bindings)e.cancel();this.bindings.length=0,this.scene.remove(this.container)}render(e){for(const t of this.meshes)t.render(e,this.cameraData)}filter(e){this.visibilityFilter=e;for(const t of this.meshes){const i=e(this.meshToDataMap[t.id]);i===h.Y.HIDE?this.deactivateMesh(t):this.activateMesh(t,i)}}mapSweepToMesh(e){for(const t in this.meshToDataMap){const i=this.meshToDataMap[t];if(i.toSweep.id===e&&i.toExterior&&i.fromInterior)return this.dataToMeshMap[i.index]}return null}activateMesh(e,t=0){this.activeMeshes[e.id]||(this.input.registerMesh(e,!1),this.activeMeshes[e.id]=!0),e.setState(t)}deactivateMesh(e){this.input.unregisterMesh(e),this.activeMeshes[e.id]=!1,this.onPuckDeselect(e),e.setState(h.Y.HIDE)}onPuckClick(e){this.broadcast(new g.K(this.meshToDataMap[e.id]))}onPuckSelect(e){this.broadcast(new g.x(!0));const t=this.meshToDataMap[e.id].toSweep,i=this.viewportLoader.getPortalTexture(t,t.rotation,e.position);this.activeTexturePromises[e.id]=i,i.then((t=>{this.activeTexturePromises.hasOwnProperty(e.id)&&i===this.activeTexturePromises[e.id]&&(e.updatePortalTexture(t),e.setHover(!0))}))}onPuckDeselect(e){this.broadcast(new g.x(!1)),e.setHover(!1),this.viewportLoader.releasePortalTexture(this.meshToDataMap[e.id].toSweep.id),delete this.activeTexturePromises[e.id]}}var v=i(89352),y=i(95395),b=i(76863),S=i(32306),E=i(75892),T=i(59088),w=i(35026),x=i(76463),_=i(51263),M=i(57051);class PortalPuckMeshModule extends n.Y{constructor(){super(...arguments),this.name="sweep-portal-mesh",this.portalCount=0}async init(e,t){const[i,n,r,o,a,l,c]=await Promise.all([t.getModule(y.default),t.getModuleBySymbol(s.y.RAYCASTER),t.getModuleBySymbol(s.y.INPUT),t.getModule(S.default),t.getModuleBySymbol(s.y.WEBGL_RENDERER),t.market.waitForData(E.Z),t.market.waitForData(T.M_)]),d=t.claimRenderLayer(this.name);this.portalData={};const h=a.getScene().camera,u=new x.Z(i.getSignedUrls());this.raycaster=n;const p=new PortalViewportLoader(u,o,256,h),m=a.getScene().scene;this.portalRenderer=new PortalPuckRenderer(m,r,p,d,c),await Promise.all([t.getModuleBySymbol(s.y.MODEL_MESH),t.getModuleBySymbol(s.y.MESH_API_FIXUP)]);const f=w.hU.MANUAL,g=l.filter((e=>_.H7(e)));l.iterate((e=>{this.portalData[e.id]||(this.portalData[e.id]=[]),_.H7(e)&&this.addPortals(e,this.portalRenderer,l,g);let t=e.placementType;this.bindings.push(e.onPropertyChanged("placementType",(i=>{t!==f&&i===f&&this.addPortals(e,this.portalRenderer,l,g),t===f&&i!==f&&this.removePortals(e.id,this.portalRenderer),t=i}))),this.bindings.push(e.onChanged((()=>{_.H7(e)&&(this.removePortals(e.id,this.portalRenderer),this.addPortals(e,this.portalRenderer,l,g))})))})),t.addComponent(this,this.portalRenderer)}filter(e){this.portalRenderer.filter(e)}getPortalToExterior(e){return this.portalRenderer.mapSweepToMesh(e)}removePortals(e,t){for(const i of this.portalData[e])t.removePortal(i);this.portalData[e]=[]}addPortals(e,t,i,n){const s=this.nearestAlignedSweep(e,i);if(s){const i=this.entryLinks(e,s),r=this.neighborLinks(e,n);this.portalData[e.id]=i.concat(r);for(const i of this.portalData[e.id])t.addPortal(i)}else this.log.debug(`Couldn't find the nearest sweep for a 360 on floor ${e.floorId}; not adding portals`)}nearestAlignedSweep(e,t){const i=[_.ff(e),_._k(),_._T(),_.b1(e)],n=[M.TE(e.position)],s=t.sortByScore(i,n)[0];return s?s.sweep:null}modelIntersection(e,t,i=1/0){const n=(new o.Vector3).copy(e.position).sub(t.position).setY(0).normalize(),s=this.raycaster.picking.pick(t.position,n,b.T0);return{intersect:s&&s.distance<=i?s:null,rayDirection:n}}entryLinks(e,t){const i=[],n=e.position.distanceTo(t.position),s=this.modelIntersection(e,t,n+v.vX);let r,a,l=!1;s.intersect&&s.intersect.face?(r=s.intersect.face.normal.clone().setY(0).normalize(),a=s.intersect.point.clone().addScaledVector(r,v.AF)):(r=null,l=!0,a=e.position.clone()),a.y=t.position.y,i.push({index:this.portalCount++,toSweep:e,fromSweep:t,position:a,lookDirection:r,billboard:l,toExterior:!0,fromInterior:!0});const c=e.position,d=(new o.Vector3).lerpVectors(e.position,t.position,2/n).setY(e.position.y),h=(new o.Vector3).subVectors(d,c),u=h.length();h.normalize();const p=this.raycaster.picking.pick(c,h);return p&&p.distance<u&&(h.setLength(Math.max(p.distance-1.1*v.vX,0)),d.addVectors(c,h)),i.push({index:this.portalCount++,toSweep:t,fromSweep:e,position:d,lookDirection:r?r.clone().negate():null,billboard:l,toExterior:!1,fromInterior:!1}),i}neighborLinks(e,t){const i=[];for(const n of t)if(e!==n&&n.floorId===e.floorId&&e.position.distanceTo(n.position)<v.M0){const t=e.position.distanceTo(n.position);if(this.modelIntersection(e,n,t).intersect||this.modelIntersection(n,e,t).intersect)continue;const s=e.position.clone().sub(n.position).setY(0).normalize(),r=n.position.clone(),o=v.iz;t>o&&r.addScaledVector(s,t-o),i.push({index:this.portalCount++,toSweep:n,fromSweep:e,position:r,lookDirection:s,billboard:!1,toExterior:!0,fromInterior:!1})}return i}}},55958:(e,t,i)=>{"use strict";i.d(t,{K:()=>PortalClickMessage,x:()=>PortalHoverMessage});var n=i(91466);class PortalClickMessage extends n.v{constructor(e){super(),this.toSweep=e.toSweep,this.toExterior=e.toExterior,this.fromInterior=e.fromInterior,this.meshPosition=e.position}}class PortalHoverMessage extends n.v{constructor(e){super(),this.hovered=e}}},89352:(e,t,i)=>{"use strict";i.d(t,{M0:()=>s,AF:()=>r,vX:()=>o,nm:()=>a,iz:()=>l});var n=i(17597);const s=(0,n.eY)("geond",15),r=(0,n.eY)("geowo",.1),o=.3,a=.75,l=4},86097:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepPortalNavigation});var n=i(17597),s=i(48711);const r=(0,n.eY)("geodist",(0,s._F)((0,n.eY)("geodistft",20)));var o=i(47724),a=i(89799),l=i(35026),c=i(5087),d=i(31278),h=i(59088),u=i(75892),p=i(93263),m=i(35597),f=i(74712),g=i(55958),v=i(29422),y=i(33874),b=i(28963),S=i(14092),E=i(4901);class SweepPortalNavigation extends o.Y{constructor(){super(...arguments),this.name="sweep-portal-navigation",this.onChange=()=>{this.portalRenderer.filter((e=>{if(!this.settingsData.tryGetProperty(b.s,!0))return f.Y.HIDE;if(!(0,c.Bw)(this.viewmodeData.closestMode))return f.Y.HIDE;const t=this.sweepData.getSweep(this.sweepData.currentSweep||"");if(t)if(t.alignmentType===l.z9.ALIGNED){if(e.fromInterior&&e.toExterior&&e.position.distanceTo(t.position)<r)return f.Y.SHOW}else if(t.placementType===l.hU.MANUAL&&e.fromSweep.id===t.id)return f.Y.ONTOP;return f.Y.HIDE}))}}async init(e,t){this.engine=t,[this.portalRenderer,this.cameraData,this.viewmodeModule,this.viewmodeData,this.sweepData,this.settingsData]=await Promise.all([t.getModule(a.default),t.market.waitForData(h.M_),t.getModule(p.default),t.market.waitForData(m.O),t.market.waitForData(u.Z),t.market.waitForData(y.e)]);const i=(e,i)=>{this.viewmodeData.currentMode&&this.cameraData.canTransition()&&(this.viewmodeData.currentMode!==c.Ey.Panorama?this.viewmodeModule.switchToMode(c.Ey.Panorama,d.n.FadeToBlack,{sweepID:e,rotation:i}):t.commandBinder.issueCommand(new v.ju({sweep:e,rotation:i,transition:d.n.FadeToBlack})))};this.settingsData.onPropertyChanged(b.s,this.onChange),this.bindings.push(t.subscribe(g.K,(e=>{i(e.toSweep.id)})),t.subscribe(g.x,(e=>this.onPortalHover(e.hovered))),this.viewmodeData.onChanged(this.onChange),this.sweepData.onChanged(this.onChange)),this.onChange()}onPortalHover(e){const t=e?S.C.FINGER:null;this.engine.commandBinder.issueCommand(new E.u(t))}}},66999:(e,t,i)=>{"use strict";i.d(t,{U:()=>n});const n="features/sweep_pucks"},65379:(e,t,i)=>{"use strict";i.d(t,{D:()=>SweepViewData});var n=i(32770),s=i(48715),r=i(35026),o=i(51263),a=i(64781),l=i(23573),c=i(17131);class SweepState extends l.T{constructor(){super(...arguments),this.selected=!1,this.visible=!0,this.animation=new c.z(0)}}var d=i(1226);class SweepViewData extends n.V{constructor(e){super(),this.data=e,this.name="sweeps-view",this.states=new a.v,this.toolStateObservable=(0,s.Y)(d._.CLOSED),this.defaultSweepVisibilityRule=e=>e.enabled,this.sweepVisibilityRule=this.defaultSweepVisibilityRule,this.selectCurrentSweep=()=>{this.setSelectedSweep(this.data.currentSweep||null)},this.derivedData={},this.selectedSweepObservable=new s.f(null);const t=[d._.MOVING,d._.PLACING,d._.PRESSING,d._.ROTATING];e.makeSweepChangeSubscription((()=>{t.includes(this.toolState)||this.selectCurrentSweep()})),e.iterate((e=>{const t=new SweepState;this.states.set(e.id,t),t.commit()})),this.updateViewData()}updateViewData(){this.data.iterate(((e,t)=>{this.derivedData[e.id]=this.makeViewDataForSweep(e,t)})),this.commit()}updateSweepVisibilityRule(e){this.sweepVisibilityRule=e||this.defaultSweepVisibilityRule}getSweepVisibility(e){return this.sweepVisibilityRule(e)}get selectedSweep(){return this.selectedSweepObservable.value}setSelectedSweep(e){if(e===this.selectedSweep)return;const t=this.selectedSweep;if(this.selectedSweepObservable.value=e,null!==e){const t=this.getState(e);t.selected=!0,t.commit()}if(null!==t){const e=this.getState(t);e.selected=!1,e.commit()}}onSelectedSweepChanged(e){return this.selectedSweepObservable.onChanged(e)}setToolState(e){e===d._.PLACING&&this.selectedSweep&&this.setSelectedSweep(null),this.toolStateObservable.value=e}get toolState(){return this.toolStateObservable.value}onToolStateChanged(e){return this.toolStateObservable.onChanged(e)}getSweep(e){return this.data.getSweep(e)}makeViewDataForSweep(e,t){const i=this.derivedData[e.id];return i?(i.floorId=e.floorId,i.position=e.position,i.alignmentType=e.alignmentType,i.placed=e.placementType===r.hU.MANUAL,i.enabled=e.enabled,i.name=e.name,i):{id:e.id,floorId:e.floorId,position:e.position,index:e.index,alignmentType:e.alignmentType,dataIndex:t,placed:e.placementType===r.hU.MANUAL,enabled:e.enabled,name:e.name}}getViewData(e){const t=this.data.getSweep(e),i=this.derivedData[e];return t&&!i&&(this.derivedData[e]=this.makeViewDataForSweep(t,t.index)),this.derivedData[e]}isSweepAligned(e){return this.data.isSweepAligned(e)}iterate(e){this.data.iterate(e)}getState(e){return this.states.get(e)}isVisible(e){return this.states.get(e).visible}setVisible(e,t){const i=this.getState(e);i.visible!==t&&(i.visible=t,i.commit())}updateAnimations(e){for(const t of this.states)t.animation.tick(e)}modifySelectAnimation(e,t,i){const n=this.getState(e).animation,s=1===n.endValue;t!==s&&(s?n.modifyAnimation(n.value,0,i):n.modifyAnimation(0,1,i))}getIndexByAlignment(e,t){return this.getAlignedSweeps(e).findIndex((e=>e.id===t))}getAlignedSweeps(e){const t=Object.values(this.derivedData);return e?t.filter((0,o._T)()):t.filter((0,o.WO)())}}},1226:(e,t,i)=>{"use strict";var n;i.d(t,{_:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.PRESSING="pressing",e.PLACING="placing",e.MOVING="moving",e.ROTATING="rotating",e.ROTATED="rotated"}(n||(n={}))},23889:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>SweepViewDataModule});var n=i(47724),s=i(75892),r=i(65379),o=i(95586),a=i(35597),l=i(76896),c=i(27326),d=i(8150),h=i(91302);class SweepViewDataModule extends n.Y{constructor(){super(...arguments),this.name="sweep-viewdata",this.selectionEnabled=!0,this.nonPanoCurrentPuckVisible=!1,this.sweepMap={},this.sweepIdList=[],this.enableSweepSelection=async e=>{this.selectionEnabled=!0},this.disableSweepSelection=async e=>{this.selectionEnabled=!1},this.toggleCurrentPuck=async e=>{this.nonPanoCurrentPuckVisible=e.visible,this.updateVisibility(this.viewData.data.currentSweep)},this.onSweepSelectCommand=async e=>{this.selectionEnabled&&this.viewData.modifySelectAnimation(e.id,e.selected,e.duration)},this.onSweepHoverCommand=async e=>{this.viewData.modifySelectAnimation(e.id,e.hovered,e.duration)},this.updateVisibility=async e=>{if(this.viewmodeData.isInside()){if(e){const t=this.viewData.getSweep(e).neighbours;this.viewData.iterate((e=>{const i=this.viewData.getSweepVisibility(e)&&-1!==t.indexOf(e.id);this.viewData.setVisible(e.id,i)})),this.viewData.setVisible(e,!1)}}else this.viewData.iterate((e=>{this.viewData.setVisible(e.id,this.floorsViewData.isCurrentOrAllFloors(e.floorId))})),e&&this.viewData.setVisible(e,this.nonPanoCurrentPuckVisible)}}async init(e,t){this.data=await t.market.waitForData(s.Z),this.viewData=t.market.tryGetData(r.D)||new r.D(this.data),t.market.register(this,r.D,this.viewData),this.bindings.push(t.commandBinder.addBinding(o.iF,this.onSweepSelectCommand),t.commandBinder.addBinding(o.kR,this.onSweepHoverCommand),t.commandBinder.addBinding(o.zd,this.enableSweepSelection),t.commandBinder.addBinding(o.ZD,this.disableSweepSelection),t.commandBinder.addBinding(o.e9,this.toggleCurrentPuck),this.data.onChanged((()=>this.viewData.updateViewData())),t.msgBus.subscribe(h.sY,(()=>this.viewData.updateViewData()))),this.viewmodeData=await t.market.waitForData(a.O),this.floorsViewData=await t.market.waitForData(c.c),this.bindings.push(this.data.onPropertyChanged("currentSweep",this.updateVisibility),t.subscribe(l.P,(()=>this.updateVisibility(this.viewData.data.currentSweep))),t.subscribe(d.bS,(()=>this.updateVisibility(this.viewData.data.currentSweep))),this.viewmodeData.makeModeChangeSubscription((()=>this.updateVisibility(this.viewData.data.currentSweep)))),this.updateVisibility(this.viewData.data.currentSweep)}onUpdate(e){this.viewData.updateAnimations(e)}}},51627:(e,t,i)=>{"use strict";i.d(t,{n:()=>TagsViewData});var n=i(32770),s=i(48715),r=i(75256),o=i(21909);class TagsViewData extends n.V{constructor(e,t,i,n,a,l){super(),this.data=e,this.sortOrder=t,this.textParser=i,this.tagDefaultTitle=n,this.backgroundTexture=a,this.maskTexture=l,this.name="tags-view-data",this.creatingNewTag=!1,this.allTagViewsObservable=(0,r.C)([]),this.enabledTagViewsObservable=(0,r.C)([]),this.sortedTagViewsObservable=(0,r.C)([]),this.openTagViewObservable=(0,s.Y)(null),this.dirtyTagStateObservable=(0,s.Y)(!1),this.tagToolStateObservable=(0,s.Y)(o.p.CLOSED),this.listIndexObservable=(0,s.Y)(-1),this.updateViewData()}getData(){return this.data}getTextParser(){return this.textParser}get tagViewList(){return this.enabledTagViewsObservable}getAllTagViews(){return this.allTagViewsObservable}getSortedTagViewList(){return this.sortedTagViewsObservable}getTagCount(){return this.data.collection.length}setTagSortOrder(e){this.sortOrder=e,this.updateSortedTagViews()}getTagView(e){const t=this.allTagViewsObservable.findIndex((t=>t.id===e));return-1!==t?this.allTagViewsObservable.get(t):null}getCurrentTagViewByIndex(e){return-1!==e?this.enabledTagViewsObservable.get(e):null}updateViewData(){const e=[];this.data.iterate((t=>{const i=this.createTagView(t);e.push(i)}));const t=this.sortByText(e);this.allTagViewsObservable.replace(t),this.updateSortedTagViews()}createTagView(e){return{id:e.sid,created:e.created,modified:e.modified,label:e.label,description:e.description,enabled:e.enabled,color:`#${e.color.getHexString()}`,anchorPosition:e.anchorPosition,floorId:e.floorId,roomId:e.roomId,stemNormal:e.stemVector,stemLength:e.stemHeight,stemEnabled:e.stemVisible,attachments:e.externalAttachments.concat(e.fileAttachments),backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture,widgetFrame:void 0,preventPreview:!1,preventSelect:!1,preventDock:!1}}get isNewTag(){return this.creatingNewTag}setCreatingTag(e){this.creatingNewTag=e}setTagsToolState(e){this.tagToolStateObservable.value=e}get tagsToolState(){return this.tagToolStateObservable.value}onTagsToolStateChanged(e){return this.tagToolStateObservable.onChanged(e)}setListIndex(e){this.listIndexObservable.value=e}get listIndex(){return this.listIndexObservable.value}onListIndexChanged(e){return this.listIndexObservable.onChanged(e)}setDirtyTagState(e){this.dirtyTagStateObservable.value=e}get dirtyTagState(){return this.dirtyTagStateObservable.value}onDirtyTagStateChanged(e){return this.dirtyTagStateObservable.onChanged(e)}setOpenTagView(e){this.openTagViewObservable.value=e}get openTagView(){return this.openTagViewObservable.value}onOpenTagViewChanged(e){return this.openTagViewObservable.onChanged(e)}updateOpenTagView(e){const t=this.openTagView;if(t){const i=Object.assign(Object.assign({},t),e);this.setOpenTagView(i)}}updateSortedTagViews(){const e=this.sortByOrder(this.allTagViewsObservable.values());this.sortedTagViewsObservable.replace(e),this.updateEnabledTagViews(e)}updateEnabledTagViews(e){const t=e.filter((e=>e.enabled));this.enabledTagViewsObservable.replace(t)}sortByText(e){return e.sort(((e,t)=>this.sortableText(e)<this.sortableText(t)?-1:1))}sortByOrder(e){const t=this.sortOrder;return e.sort(((e,i)=>{let n=t.indexOf(e.id);-1===n&&(n=Number.MAX_SAFE_INTEGER);let s=t.indexOf(i.id);return-1===s&&(s=Number.MAX_SAFE_INTEGER),n-s||(this.sortableText(e)<this.sortableText(i)?-1:1)}))}sortableText(e){return(e.label.trim()||e.description||this.tagDefaultTitle).toLowerCase()}}},65049:(e,t,i)=>{"use strict";i.d(t,{yU:()=>TagsToolToggleCommand,$J:()=>StartNewTagCommand,QG:()=>SaveTagCommand,wZ:()=>SaveTagAppearanceCommand,bg:()=>SaveTagVisibilityCommand,$g:()=>CancelNewTagCommand,lt:()=>OpenTagCommand,T3:()=>DeleteTagCommand,xb:()=>CloseTagCommand,Bz:()=>SaveTagOrderCommand,mt:()=>ToggleTagToolEditorCommand});var n=i(17386);class TagsToolToggleCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}class StartNewTagCommand extends n.m{constructor(){super()}}class SaveTagCommand extends n.m{constructor(e,t,i,n,s){super(),this.payload={id:e,properties:t,pendingAttachments:i,removedAttachments:n,embed:s}}}class SaveTagAppearanceCommand extends n.m{constructor(e,t){super(),this.payload={id:e,properties:t}}}class SaveTagVisibilityCommand extends n.m{constructor(e,t){super(),this.payload={id:e,visible:t}}}class CancelNewTagCommand extends n.m{constructor(){super()}}class OpenTagCommand extends n.m{constructor(e,t,i){super(),this.id="TAG_OPEN",this.payload={tagId:e,transition:t,dock:i}}}class DeleteTagCommand extends n.m{constructor(e){super(),this.id="TAG_DELETE",this.payload={id:e}}}class CloseTagCommand extends n.m{constructor(){super()}}class SaveTagOrderCommand extends n.m{constructor(e){super(),this.payload={ids:e}}}class ToggleTagToolEditorCommand extends n.m{constructor(e){super(),this.payload={opened:e}}}},21909:(e,t,i)=>{"use strict";var n;i.d(t,{p:()=>n}),function(e){e.CLOSED="closed",e.IDLE="idle",e.CREATING="creating",e.OPENING="opening",e.OPEN="open",e.EDITING="editing"}(n||(n={}))},53345:(e,t,i)=>{"use strict";i.r(t),i.d(t,{CancelNewTagCommand:()=>G.$g,CloseTagCommand:()=>G.xb,DeleteTagCommand:()=>G.T3,OpenTagCommand:()=>G.lt,SaveTagAppearanceCommand:()=>G.wZ,SaveTagCommand:()=>G.QG,SaveTagOrderCommand:()=>G.Bz,SaveTagVisibilityCommand:()=>G.bg,StartNewTagCommand:()=>G.$J,TagDeletedMessage:()=>TagDeletedMessage,TagsToolState:()=>H.p,TagsToolToggleCommand:()=>G.yU,TagsViewData:()=>j.n,ToggleTagToolEditorCommand:()=>G.mt,default:()=>Q});var n=i(2212),s=i(47724),r=i(41452),o=i(13789),a=i(10757),l=i(66223),c=i(4592),d=i(47247),h=i(50988),u=i(38420),p=i(31278),m=i(29422),f=i(67799),g=i(86010),v=i(51764),y=i(46114),b=i(38321),S=i(42835),E=i(32025),T=i(48470),w=i(90662),x=i(6460),_=i(19980),M=i(91028),O=i(79553),A=i(66157),C=i(92532),P=i(24151),D=i(89046),N=i(39064),I=i(36561),L=i(66806);const R="mp.tags";var k=i(44060),U=i(41663),B=i(91466);class MattertagRemoveMessage extends B.v{constructor(e,t){super(),this.sid=e,this.removeMethod=t}}var F=i(78238),V=i(40698),H=i(21909),j=i(51627),G=i(65049),z=i(96168),W=i(95836),K=i(21479),Y=i(27326),q=i(75892),Z=i(33874),$=i(35597);class TagsModule extends s.Y{constructor(){super(...arguments),this.name="tags-module",this.activated=!1,this.registered=!1,this.activeBindings=[],this.updatePerSettings=()=>{const e=this.settingsData.tryGetProperty(k.re,!1),t=!this.in360View();this.engine.commandBinder.issueCommand(new b.qN(S.Er.MATTERTAG,t&&e))},this.tagsToolToggled=async e=>{e.opened?this.activateTool():this.deactivateTool()},this.togglePinAssetEditor=async e=>{e.opened?this.changeTagsToolState(H.p.EDITING):this.viewData.tagsToolState===H.p.EDITING&&this.changeTagsToolState(H.p.OPEN)},this.onTagsToolStateChanged=()=>{let e=!0;const t=this.toolsData.toolPanelLayout===O.wS.BOTTOM_PANEL;switch(this.viewData.tagsToolState){case H.p.EDITING:case H.p.CREATING:e=!1;break;case H.p.OPENING:case H.p.OPEN:e=!t}this.engine.broadcast(new A.ps(e))},this.changeTagsToolState=e=>{e!==this.viewData.tagsToolState&&this.viewData.setTagsToolState(e)},this.onCloseTag=async()=>{this.closeTag()},this.pinAddCancelled=e=>{e.pinType===S.Er.MATTERTAG&&this.cancelTagCreation(!1)},this.onCancelNewTag=async()=>{this.cancelTagCreation(!0)},this.cancelTagCreation=e=>{const t=this.viewData;e&&t.openTagView&&this.engine.commandBinder.issueCommand(new b.tT(t.openTagView.id,S.Er.MATTERTAG)),this.engine.broadcast(new A.A),this.cancelAttachmentChanges(),t.setOpenTagView(null),t.setCreatingTag(!1),this.changeTagsToolState(H.p.IDLE)},this.tagsWereChanged=()=>{this.viewData.updateViewData()},this.onOpenTagViewChanged=()=>{const e=this.viewData.openTagView;e&&this.updateTagPin(e)},this.startTagCreation=async()=>{const e=this.viewData;let t=(0,a.O1)(11);for(;this.tagsData.getTag(t);)t=(0,a.O1)(11);const i=new F.U;i.sid=t,i.floorId=this.floorsViewData.getHighestVisibleFloor().id;const n=e.createTagView(i);e.setCreatingTag(!0),e.setDirtyTagState(!0),this.changeTagsToolState(H.p.CREATING),e.setOpenTagView(n),this.engine.commandBinder.issueCommand(new b.fM(n.id,n,S.Er.MATTERTAG,n.backgroundTexture,n.maskTexture))},this.saveTag=async e=>{const{id:t,properties:i,pendingAttachments:n,removedAttachments:s,embed:r}=e,o=this.viewData,{openTagView:a,isNewTag:l}=o;if(!a)return void this.log.debug("No open tag");const c=Object.assign({},a,i);l?await this.engine.commandBinder.issueCommand(new U.Mm(t,c,n,r)):await this.engine.commandBinder.issueCommand(new U.qq(t,c,n,s,r)),this.engine.commandBinder.issueCommand(new b.Ar(t,S.Er.MATTERTAG,!0)),o.setCreatingTag(!1),o.setListIndex(this.getListIndex(t)),await this.engine.commandBinder.issueCommand(new z.x9),this.closeTag()},this.saveTagVisibility=async e=>{const{id:t,visible:i}=e;return this.engine.commandBinder.issueCommand(new b.ik(t,S.Er.MATTERTAG,i)),this.engine.commandBinder.issueCommand(new U.qq(t,{enabled:i}))},this.saveTagAppearance=async e=>{const{id:t,properties:i}=e,{color:s,stemLength:r,stemEnabled:o}=i,{isNewTag:a}=this.viewData;if(this.viewData.updateOpenTagView(i),this.engine.commandBinder.issueCommand(new b.tE(t,S.Er.MATTERTAG,i)),!a){const e={color:s?new n.Color(s):void 0,stemHeight:r,stemVisible:o};return this.engine.commandBinder.issueCommand(new U.qq(t,e))}},this.onDeleteTag=async e=>{const t=e.id;this.tagsData.getTag(t)?(this.engine.commandBinder.issueCommand(new D.rE),this.engine.commandBinder.issueCommand(new U.Gn(t)).then((()=>{this.saveTags().then((()=>{this.engine.broadcast(new MattertagRemoveMessage(t,"details_panel_delete_button")),this.engine.commandBinder.issueCommand(new b.OL(t,S.Er.MATTERTAG));const e=this.viewData.openTagView;e&&e.id===t&&this.closeTag()}))}))):this.log.debug("Cannot delete a non-existent tag")},this.onSaveTagOrder=async e=>{const t=e.ids.map((e=>({id:e,type:N.l.TAG})));await this.engine.commandBinder.issueCommand(new I.wg(R,t)),this.viewData.setTagSortOrder(this.getSavedTagOrder())},this.pinMoved=e=>{const{id:t,pinType:i,pinPos:n}=e,s=this.viewData.openTagView;if(s&&i===S.Er.MATTERTAG&&t===s.id){if(this.tagsData.getTag(t)){const e={anchorPosition:n.anchorPosition,stemNormal:n.stemNormal,floorId:n.floorId};this.engine.commandBinder.issueCommand(new U.qq(t,e))}else this.log.debug("Cannot move a non-existent tag")}},this.pinPlaced=e=>{const t=this.viewData.openTagView;t&&e.pinType===S.Er.MATTERTAG&&e.id===t.id&&(this.viewData.updateOpenTagView(e.pinPos),this.changeTagsToolState(H.p.OPEN),this.engine.broadcast(new A.ro))},this.onPinUnselected=e=>{const{openTagView:t,tagsToolState:i,dirtyTagState:n}=this.viewData;n||t&&e.pinType===S.Er.MATTERTAG&&e.id===(null==t?void 0:t.id)&&(i===H.p.CLOSED||this.appData.application===K.Mx.WORKSHOP?this.closeTag():i!==H.p.OPEN&&i!==H.p.IDLE||this.engine.commandBinder.issueCommand(new C.tT(O.w1.TAGS,!1)))},this.handlePinHoverChangeMessage=e=>{const{openTagView:t,isNewTag:i}=this.viewData;if(i)return;const{id:n,pinType:s,hovering:r}=e,{dockedAnnotation:o}=this.annotationsViewData,a=t&&t.id===(null==o?void 0:o.id);if(r&&t&&!a&&n!==t.id&&this.closeTag(),s!==S.Er.MATTERTAG)return;const l=this.viewData.getTagView(n);if(!l)return void this.log.debug("Pin hover change on non-existent tag");const{commandBinder:c}=this.engine;r?l.id!==(null==t?void 0:t.id)&&c.issueCommand(new w.Kw(l.id,x.J.TAG)):l.id!==(null==t?void 0:t.id)&&c.issueCommand(new w.Aj(l.id,x.J.TAG))},this.handleAnnotationClosed=e=>{var t;e.annotationType===x.J.TAG&&(null===(t=this.viewData.openTagView)||void 0===t?void 0:t.id)===e.id&&this.closeTag()},this.handleAnnotationOpening=e=>{const{id:t,annotationType:i,docked:n}=e;i===x.J.TAG?this.openTag(t,null,n):this.closeTag()},this.handlePinSelection=async e=>{const{id:t,pinType:i}=e;if(this.viewData.dirtyTagState)return;if(i!==S.Er.MATTERTAG)return void this.closeTag();const n=this.activated||!(0,f.OR)();await this.openTag(t,p.n.Interpolate,n),this.openAnnotation(t,n)},this.handleViewingAttachment=e=>{const{annotationType:t,id:i,attachmentId:n}=e;if(t!==x.J.TAG)return;const s=this.viewData.getTagView(i);if(!s)return void this.log.debug("Cannot view attachment for a non-existent tag");const r=s.attachments,o=r.find((e=>e.id===n));if(o&&(0,W.lV)(o)){const e=r.filter((e=>(0,W.lV)(e)));this.engine.commandBinder.issueCommand(new z.xW(!0,e,n))}},this.onOpenTag=async e=>{var t;const{tagId:i,dock:n,transition:s}=e,r=(null===(t=this.annotationsViewData.dockedAnnotation)||void 0===t?void 0:t.annotationType)===x.J.TAG,o=null!==n?n:r;await this.openTag(i,s,o),this.openAnnotation(i,o)}}async init(e,t){const[i,n,s,a,h,u,p,m,f,b]=await Promise.all([t.market.waitForData(V.n),t.market.waitForData(P.t),t.market.waitForData(q.Z),t.market.waitForData(Z.e),t.market.waitForData($.O),t.market.waitForData(_.A),t.market.waitForData(K.pu),t.market.waitForData(Y.c),t.market.waitForData(L.W),t.getModule(r.default)]);this.tagsData=i,this.toolsData=n,this.sweepData=s,this.settingsData=a,this.viewmodeData=h,this.annotationsViewData=u,this.appData=p,this.floorsViewData=m,this.orderedListData=f,this.engine=t,this.maskTexture=(0,l.p)(d),this.backgroundTexture=(0,l.p)(c),this.textParser=new g.v({links:!0,hashtags:!1});const S=this.getSavedTagOrder();this.viewData=new j.n(this.tagsData,S,this.textParser,b.t(o.Z.WORKSHOP.MATTERTAGS.DEFAULT_TAG_TITLE),this.backgroundTexture,this.maskTexture),await t.market.waitForData(E.B),this.bindings.push(a.onPropertyChanged(k.re,this.updatePerSettings),t.commandBinder.addBinding(G.yU,this.tagsToolToggled),t.subscribe(T.Q4,this.handlePinSelection),t.subscribe(T.WM,this.onPinUnselected),t.subscribe(T.tP,this.handlePinHoverChangeMessage),t.subscribe(M.do,this.handleAnnotationOpening),t.subscribe(M.Ps,this.handleAnnotationClosed),t.subscribe(M.qk,this.handleViewingAttachment),t.subscribe(v.Z,this.updatePerSettings),t.subscribe(y.m,this.updatePerSettings),t.commandBinder.addBinding(G.xb,this.onCloseTag),t.commandBinder.addBinding(G.lt,this.onOpenTag),this.viewData.onOpenTagViewChanged(this.onOpenTagViewChanged),this.tagsData.onChanged(this.tagsWereChanged)),t.market.register(this,j.n,this.viewData),this.updatePerSettings(),this.displayTags()}dispose(e){this.deactivateTool(!0),this.bindings.forEach((e=>{e.cancel()})),this.bindings=[],this.activeBindings=[],this.engine.commandBinder.issueCommand(new b.zM(S.Er.MATTERTAG)),this.maskTexture.dispose(),this.backgroundTexture.dispose(),super.dispose(e)}onUpdate(){}activateTool(){this.activated||(this.engine.commandBinder.issueCommand(new b.Ki(!0)),this.changeTagsToolState(H.p.IDLE),this.registered?this.activeBindings.forEach((e=>{e.renew()})):this.registerHandlers(),this.activated=!0)}deactivateTool(e){var t;if(!this.activated)return;const{isNewTag:i,openTagView:n}=this.viewData,s=(null===(t=this.annotationsViewData.dockedAnnotation)||void 0===t?void 0:t.annotationType)===x.J.TAG;i?this.cancelTagCreation(!0):n&&(e||s)&&this.closeTag(),this.engine.commandBinder.issueCommand(new b.Ki(!1)),this.changeTagsToolState(H.p.CLOSED),this.activeBindings.forEach((e=>{e.cancel()})),this.activated=!1}registerHandlers(){const e=this.engine.commandBinder;this.activeBindings.push(this.engine.subscribe(T.b0,this.pinPlaced),this.engine.subscribe(T.bV,this.pinMoved),this.engine.subscribe(T.hu,this.pinAddCancelled),e.addBinding(G.wZ,this.saveTagAppearance),e.addBinding(G.bg,this.saveTagVisibility),e.addBinding(G.mt,this.togglePinAssetEditor),e.addBinding(G.$J,this.startTagCreation),e.addBinding(G.QG,this.saveTag),e.addBinding(G.$g,this.onCancelNewTag),e.addBinding(G.T3,this.onDeleteTag),e.addBinding(G.Bz,this.onSaveTagOrder),this.viewData.onTagsToolStateChanged(this.onTagsToolStateChanged)),this.registered=!0}in360View(){const e=this.sweepData.currentSweep?this.sweepData.currentSweep:"";return this.viewmodeData.isInside()&&this.sweepData.isSweepUnaligned(e)}closeTag(){const{commandBinder:e}=this.engine,{openTagView:t,tagsToolState:i}=this.viewData;if(this.viewData.setOpenTagView(null),this.viewData.setDirtyTagState(!1),i!==H.p.CLOSED&&this.changeTagsToolState(H.p.IDLE),t){const i=t.id;this.cancelAttachmentChanges(),e.issueCommand(new z.xW(!1));this.tagsData.getTag(i)&&(e.issueCommand(new b.RH(i,S.Er.MATTERTAG)),e.issueCommand(new b.ik(i,S.Er.MATTERTAG,this.getTagVisibility(i)))),e.issueCommand(new w.Aj(i,x.J.TAG)),this.engine.broadcast(new A.A)}}getTagVisibility(e){var t;const{openTagView:i}=this.viewData;return(null==i?void 0:i.id)===e||!!(null===(t=this.viewData.getTagView(e))||void 0===t?void 0:t.enabled)}displayTags(){const e=[];this.viewData.tagViewList.forEach((t=>{e.push(Object.assign(Object.assign({},t),{pinType:S.Er.MATTERTAG,backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture,visible:this.getTagVisibility(t.id)}))})),this.engine.commandBinder.issueCommand(new b.mE(e))}updateTagPin(e){const t=Object.assign(Object.assign({},e),{pinType:S.Er.MATTERTAG,backgroundTexture:this.backgroundTexture,maskTexture:this.maskTexture,visible:e.enabled});this.engine.commandBinder.issueCommand(new b.mE([t]))}async cancelAttachmentChanges(){return this.engine.commandBinder.issueCommand(new z.Ze)}getSavedTagOrder(){const e=this.orderedListData.getOrderedList(R);return e?e.entries.map((e=>e.id)):[]}async saveTags(){this.engine.commandBinder.issueCommand(new h.VQ({dataTypes:[u.g.MATTERTAGS]}))}updateListIndex(e){const t=this.viewData.tagViewList.values().findIndex((t=>t.id===e));this.viewData.setListIndex(t)}getListIndex(e){return this.viewData.tagViewList.values().findIndex((t=>t.id===e))}openAnnotation(e,t){t?this.engine.commandBinder.issueCommand(new w.bd(e,x.J.TAG)):this.engine.commandBinder.issueCommand(new w.oM(e,x.J.TAG))}async openTag(e,t,i){return i?this.dockTag(e,t):this.selectTag(e,t)}async selectTag(e,t){var i;const{commandBinder:n}=this.engine,s=this.viewData.getTagView(e);if(s){const{openTagView:r}=this.viewData,o=r&&r.id===e,l=(null===(i=this.annotationsViewData.dockedAnnotation)||void 0===i?void 0:i.id)===e;if(o&&!l)return void this.log.debug("Tag is already selected");this.activated&&await n.issueCommand(new C.tT(O.w1.TAGS,!1)),n.issueCommand(new z.xW(!1)),o||(r&&(n.issueCommand(new w.Aj(r.id,x.J.TAG)),n.issueCommand(new b.RH(r.id,S.Er.MATTERTAG))),this.viewData.setOpenTagView(s),await n.issueCommand(new b.Ar(e,S.Er.MATTERTAG,!1)),null!==t&&await n.issueCommand(new m.OR({pinPosition:s,transition:t})),this.updateListIndex(s.id)),l&&(n.issueCommand(new b.Ar(e,S.Er.MATTERTAG,!1)),this.engine.broadcast(new A.A),(0,a.gw)(f.Xx))}else this.log.debug("Cannot select a non-existent tag")}async dockTag(e,t){var i;const{commandBinder:n}=this.engine,s=this.viewData.getTagView(e);if(s){const{openTagView:r}=this.viewData,o=(null==r?void 0:r.id)===e,a=(null===(i=this.annotationsViewData.dockedAnnotation)||void 0===i?void 0:i.id)===e;if(this.toolsData.panelCollapsed&&n.issueCommand(new C.zK(!1)),o&&a)return void this.log.debug("Tag is already docked");n.issueCommand(new D.rE),this.activated||await n.issueCommand(new C.tT(O.w1.TAGS,!0)),o||(this.viewData.setOpenTagView(s),this.updateListIndex(e));const l=this.appData.application===K.Mx.WORKSHOP;n.issueCommand(new b.Ar(e,S.Er.MATTERTAG,l)),null!==t&&await n.issueCommand(new m.OR({pinPosition:s,transition:t})),a||this.engine.broadcast(new A.ro)}else this.log.debug("Cannot dock a non-existent tag")}}class TagDeletedMessage extends B.v{constructor(e){super(),this.id=e}}const Q=TagsModule},39504:(e,t,i)=>{"use strict";i.d(t,{R:()=>n});const n="features/tag-annotations";Object.freeze({colors:["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#03687d","#03a9f4","#00bcd4","#417505","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"]})},23953:(e,t,i)=>{"use strict";i.d(t,{U:()=>Tool});var n=i(23573);class Tool extends n.T{constructor(e){super(),e&&Object.assign(this,e)}}},24151:(e,t,i)=>{"use strict";i.d(t,{t:()=>ToolsData});var n=i(32770),s=i(48715),r=i(64781),o=i(67799),a=i(79553);class ToolsData extends n.V{constructor(){super(),this.name="tools-data",this.tools=(0,r.q)(),this.toolsLoadedObservable=(0,s.Y)(!1),this.assetDockedObservable=(0,s.Y)(!1),this.activeToolNameObservable=(0,s.Y)(null),this.openModalObservable=(0,s.Y)(null),this.toolAccessObservable=(0,s.Y)(a.X$.SCENE),this.panelLayoutObservable=(0,s.Y)((0,o.OR)()?a.wS.NORMAL:a.wS.NARROW),this.panelCollapsedObservable=(0,s.Y)(!1)}iterate(e){for(const t of this.tools)e(t)}get toolsMap(){return this.tools}hasTool(e){return this.toolsMap.has(e)}getTool(e){return this.tools.get(e)}addTool(...e){e.forEach((e=>this.tools.set(e.id,e))),this.onToolsAddedOrRemoved()}removeTool(...e){e.forEach((e=>this.tools.delete(e))),this.onToolsAddedOrRemoved()}removeAllTools(){this.tools.clear(),this.onToolsAddedOrRemoved()}get assetDocked(){return this.assetDockedObservable.value}setAssetDocked(e){this.assetDockedObservable.value=e}getActiveTool(){return this.activeToolName?this.getTool(this.activeToolName):null}get activeToolName(){return this.activeToolNameObservable.value}setActiveTool(e){this.activeToolNameObservable.value=e}onToolChanged(e){return this.activeToolNameObservable.onChanged(e)}get openModal(){return this.openModalObservable.value}setOpenModal(e){this.openModalObservable.value=e}onOpenModalChanged(e){return this.openModalObservable.onChanged(e)}onToolsLoadedChanged(e){return this.toolsLoadedObservable.onChanged(e)}get toolsLoaded(){return this.toolsLoadedObservable.value}get toolAccess(){return this.toolAccessObservable.value}setToolAccess(e){this.toolAccessObservable.value=e}onToolAssetAccessChanged(e){return this.toolAccessObservable.onChanged(e)}isPanelOpen(){return this.toolPanelLayout===a.wS.SIDE_PANEL||this.toolPanelLayout===a.wS.BOTTOM_PANEL}isPanelCollapsedToBottom(){return this.toolPanelLayout===a.wS.BOTTOM_PANEL&&this.panelCollapsed}setToolPanelLayout(e){this.panelLayoutObservable.value=e}get toolPanelLayout(){return this.panelLayoutObservable.value}onToolPanelLayoutChanged(e){return this.panelLayoutObservable.onChanged(e)}onPanelCollapsedChanged(e){return this.panelCollapsedObservable.onChanged(e)}setPanelCollapsed(e){this.panelCollapsedObservable.value=e}get panelCollapsed(){return this.panelCollapsedObservable.value}onToolsAddedOrRemoved(){this.toolsLoadedObservable.value=!this.toolsLoadedObservable.value}}},92532:(e,t,i)=>{"use strict";i.d(t,{zK:()=>PanelToggleCollapseCommand,$K:()=>OpenHighlightReelCommand,Cc:()=>OpenHlrSettingsCommand,tT:()=>ToggleToolCommand,Ye:()=>CloseAndRemoveToolsCommand,MV:()=>RegisterToolsCommand});var n=i(17386);class PanelToggleCollapseCommand extends n.m{constructor(e){super(),this.payload={collapse:e}}}PanelToggleCollapseCommand.id="TOOL_PANEL_TOGGLE_COLLAPSE";class OpenHighlightReelCommand extends n.m{}OpenHighlightReelCommand.id="OPEN_HIGHLIGHT_REEL";class OpenHlrSettingsCommand extends n.m{constructor(){super(...arguments),this.id="OPEN_HLR_SETTINGS"}}class ToggleToolCommand extends n.m{constructor(e,t){super(),this.payload={tool:e,active:t}}}ToggleToolCommand.id="TOGGLE_TOOL";class CloseAndRemoveToolsCommand extends n.m{}CloseAndRemoveToolsCommand.id="CLOSE_REMOVE_TOOLS";class RegisterToolsCommand extends n.m{constructor(e){super(),this.payload={tools:e}}}RegisterToolsCommand.id="REGISTER_TOOLS"},79553:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{w1:()=>n,wS:()=>s,X$:()=>r}),function(e){e.START_LOCATION="START_LOCATION",e.SCANS_3D="SCANS_3D",e.VIEW_360="VIEW_360",e.PHOTOS="PHOTOS",e.LABELS="LABELS",e.MEASUREMENTS="MEASUREMENTS",e.MATTERTAGS="MATTERTAGS",e.HLR="HLR",e.SETTINGS_PANEL="SETTINGS_PANEL",e.NOTES="NOTES",e.TAGS="TAGS",e.BLUR="BLUR",e.SEARCH="SEARCH",e.MESH_TRIM="MESH_TRIM",e.SUMMARY="SUMMARY"}(n||(n={})),function(e){e.NORMAL="normal",e.NARROW="narrow",e.SIDE_PANEL="side-panel",e.BOTTOM_PANEL="bottom-panel"}(s||(s={})),function(e){e.SCENE="scene",e.TOOL="tool",e.LIST="list"}(r||(r={}))},82228:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AssetDockedMessage:()=>c.ro,AssetUndockedMessage:()=>c.A,CloseAndRemoveToolsCommand:()=>l.Ye,FullSizeEditorMessage:()=>c.Zi,OpenHighlightReelCommand:()=>l.$K,OpenHlrSettingsCommand:()=>l.Cc,PanelCollapseMessage:()=>c.U7,PanelToggleCollapseCommand:()=>l.zK,PanelTransitionEndMessage:()=>c.rh,RegisterToolsCommand:()=>l.MV,ToggleToolCommand:()=>l.tT,ToggleViewingControlsMessage:()=>c.ps,Tool:()=>v.U,ToolAccess:()=>o.X$,ToolPanelLayout:()=>o.wS,ToolToggledMessage:()=>c.Oj,Tools:()=>o.w1,ToolsData:()=>a.t,default:()=>y});var n=i(47724),s=i(96909),r=i(21479),o=i(79553),a=i(24151);var l=i(92532),c=i(66157),d=i(89046),h=i(84842),u=i(67799),p=i(36016),m=i(8430),f=i(33874),g=i(17386);class AppSwitchCommand extends g.m{constructor(e){super(),this.payload={application:e}}}AppSwitchCommand.id="APP_SWITCH";class ToggleWorkshopBarCommand extends g.m{constructor(e){super(),this.payload={visible:e}}}ToggleWorkshopBarCommand.id="TOGGLE_WORKSHOP_BAR";class EditFromParentCommand extends g.m{}EditFromParentCommand.id="EDIT_FROM_PARENT";class ToolsModule extends n.Y{constructor(){super(...arguments),this.name="tools-module",this.activeToolDurationMap={},this.keyboardTimeout=0,this.bottomPanelHeight=0,this.sidePanelWidth=0,this.sidePanelLeft=0,this.closeAndRemoveTools=async()=>{const{activeToolName:e}=this.toolsData;e&&await this.toggleTool(e,!1),this.toolsData.removeAllTools()},this.onAssetDocked=()=>{this.toolsData.setAssetDocked(!0),this.adjustCanvasForPanel()},this.onAssetUndocked=()=>{this.toolsData.setAssetDocked(!1),this.adjustCanvasForPanel()},this.handleTextBoxFocus=e=>{window.clearTimeout(this.keyboardTimeout),e.focused?this.keyboardTimeout=window.setTimeout((()=>{document.documentElement.classList.add("keyboard-layout")}),500):document.documentElement.classList.remove("keyboard-layout")},this.onToggleModal=async e=>{this.toggleModal(e.modal,e.open)},this.closeModal=()=>{this.toolsData.openModal&&this.toggleModal(this.toolsData.openModal,!1)},this.onToggleTool=async e=>{const{tool:t,active:i}=e;return this.toggleTool(t,i)},this.toggleTool=async(e,t)=>{const i=this.toolsData,{activeToolName:n,openModal:s,toolPanelLayout:r}=i;if(!t&&e!==n)return;t||r!==o.wS.SIDE_PANEL||this.closePanel();const a=i.getActiveTool(),l=t?i.getTool(e):null;if(t&&e===n)return;s&&this.toggleModal(s,!1);let d=!1,h=null;if(a){h=a.analytic;const{manager:e}=a;await e.deactivate(),this.closeModal(),!a.panel||l&&l.panel||this.closePanel(),l||(i.setActiveTool(null),d=!0)}let u=h;if(t)if(l){u=l.analytic;const{manager:t}=l;l.panel&&this.openPanel(),await t.activate(),i.setActiveTool(e),d=!l.hidesAppBar}else this.log.error(`Tool not loaded: ${e}`);this.setAppBarVisible(d),this.trackToolTime(h,u),this.engine.broadcast(new c.Oj(t,e))},this.updateLayoutSize=()=>{const{toolPanelLayout:e}=this.toolsData;let t=e;const i=(0,u.OR)();switch(e){case o.wS.NORMAL:i||(t=o.wS.NARROW);break;case o.wS.SIDE_PANEL:i||(t=o.wS.BOTTOM_PANEL);break;case o.wS.NARROW:i&&(t=o.wS.NORMAL);break;case o.wS.BOTTOM_PANEL:i&&(t=o.wS.SIDE_PANEL)}this.toolsData.setToolPanelLayout(t),this.adjustCanvasForPanel()},this.handlePanelCollapse=async e=>{const{collapse:t}=e;t!==this.toolsData.panelCollapsed&&(this.toolsData.setPanelCollapsed(t),t||this.toolsData.toolPanelLayout!==o.wS.BOTTOM_PANEL||this.closeModal(),this.adjustCanvasForPanel(),this.engine.broadcast(new c.U7(t)))},this.adjustCanvasForPanel=()=>{const{toolPanelLayout:e,panelCollapsed:t,assetDocked:i,openModal:n}=this.toolsData,{sidePanelWidth:s,bottomPanelHeight:r,sidePanelLeft:a}=this,l=this.toolsData.getActiveTool(),c=e===o.wS.SIDE_PANEL,d=l&&c&&!t,h=d&&!!(null==l?void 0:l.panelLeft),m=d?-u.LH:0,f=m!==s?m:void 0,g=h?u.LH:0,v=g!==a?g:void 0,y=e===o.wS.BOTTOM_PANEL&&!n&&i,b=-Math.floor(50*window.innerHeight/100),S=y?b:0,E=S!==r?S:void 0,T=0===f||0===E?0:500;this.resizeCanvas((0,p.hf)(f,E,v,T)),this.bottomPanelHeight=S,this.sidePanelWidth=m,this.sidePanelLeft=g},this.resizeCanvas=async e=>{this.engine.commandBinder.issueCommand(new m.M(e))}}async init(e,t){this.inWorkshop=e.inWorkshop,this.engine=t,await t.getModuleBySymbol(s.y.SHOWCASE_ANALYTICS),this.analytics=await t.getModuleBySymbol(s.y.ANALYTICS),[this.settingsData,this.appData]=await Promise.all([t.market.waitForData(f.e),t.market.waitForData(r.pu)]),this.toolsData=new a.t,window.addEventListener("resize",this.updateLayoutSize),this.updateLayoutSize(),this.bindings.push(t.commandBinder.addBinding(l.tT,this.onToggleTool),t.commandBinder.addBinding(d.Bz,this.onToggleModal),t.commandBinder.addBinding(d.rE,(async()=>this.closeModal())),t.commandBinder.addBinding(l.zK,this.handlePanelCollapse),t.subscribe(c.ro,this.onAssetDocked),t.subscribe(c.A,this.onAssetUndocked),t.subscribe(h.SN,this.handleTextBoxFocus),this.toolsData.onToolPanelLayoutChanged(this.adjustCanvasForPanel),this.toolsData.onToolChanged(this.adjustCanvasForPanel),t.commandBinder.addBinding(l.Ye,this.closeAndRemoveTools),t.commandBinder.addBinding(l.MV,(async({tools:e})=>this.registerTools(...e)))),t.market.register(this,a.t,this.toolsData)}dispose(e){this.closeAndRemoveTools(),window.removeEventListener("resize",this.updateLayoutSize),e.market.unregister(this,a.t)}registerTools(...e){e.forEach((e=>{e.featureFlag&&this.bindings.push(this.settingsData.onPropertyChanged(e.featureFlag,(()=>this.updateEnabledTools())))})),this.toolsData.addTool(...e)}closePanel(){this.toolsData.setToolPanelLayout((0,u.OR)()?o.wS.NORMAL:o.wS.NARROW)}openPanel(){const e=(0,u.OR)();this.toolsData.setToolPanelLayout(e?o.wS.SIDE_PANEL:o.wS.BOTTOM_PANEL),e||this.toolsData.setPanelCollapsed(!0)}setAppBarVisible(e){this.inWorkshop&&this.engine.commandBinder.issueCommand(new ToggleWorkshopBarCommand(e))}toggleModal(e,t){const{openModal:i,toolPanelLayout:n}=this.toolsData;if(t&&i===e||!t&&e!==i)return;const s=e.toLowerCase(),a=this.appData.application===r.Mx.WORKSHOP?"workshop_gui":"showcase_gui";this.analytics.track(a,{gui_action:`open_${s}`}),e&&this.analytics.track("modal_shown",{modal:e}),this.toolsData.setOpenModal(t?e:null),n===o.wS.BOTTOM_PANEL&&t!==!!i&&this.adjustCanvasForPanel(),this.engine.broadcast(new h.nV(e,t))}trackToolTime(e,t){if(t&&e!==t&&(this.activeToolDurationMap[t]=Date.now()),e){this.activeToolDurationMap[e]=Date.now()-this.activeToolDurationMap[e];const t={tool:`${e}_session_time`,duration:this.activeToolDurationMap[e]};this.analytics.track("tool_session_time",t)}}updateEnabledTools(){const e=this.toolsData.toolsMap;e.atomic((()=>{for(const t of e)if(t.featureFlag){const e=this.settingsData.tryGetProperty(t.featureFlag,!1);t.enabled!==e&&(t.enabled=e,t.commit())}}))}}var v=i(23953);const y=ToolsModule},66157:(e,t,i)=>{"use strict";i.d(t,{Oj:()=>ToolToggledMessage,ro:()=>AssetDockedMessage,A:()=>AssetUndockedMessage,U7:()=>PanelCollapseMessage,Zi:()=>FullSizeEditorMessage,rh:()=>PanelTransitionEndMessage,ps:()=>ToggleViewingControlsMessage});var n=i(91466);class ToolToggledMessage extends n.v{constructor(e,t){super(),this.open=e,this.tool=t}}class AssetDockedMessage extends n.v{}class AssetUndockedMessage extends n.v{}class PanelCollapseMessage extends n.v{constructor(e){super(),this.collapsed=e}}class FullSizeEditorMessage extends n.v{constructor(e){super(),this.fullSized=e}}class PanelTransitionEndMessage extends n.v{constructor(e,t){super(),this.active=e,this.collapsed=t}}class ToggleViewingControlsMessage extends n.v{constructor(e){super(),this.show=e}}},96216:(e,t,i)=>{"use strict";i.d(t,{TH:()=>TourStartCommand,vy:()=>TourStopCommand,rU:()=>TourStepCommand,HW:()=>TourRelativeCommand});var n=i(17386);class TourStartCommand extends n.m{constructor(e,t,i){super(),this.id="TOUR_START",this.payload={index:e,loop:t,steps:i}}}class TourStopCommand extends n.m{constructor(){super(...arguments),this.id="TOUR_STOP"}}class TourStepCommand extends n.m{constructor(e,t=!1){super(),this.id="TOUR_STEP",this.payload={index:e,instant:t}}}class TourRelativeCommand extends n.m{constructor(e,t=!1){super(),this.id="TOUR_RELATIVE",this.payload={forward:e,instant:t}}}},80191:(e,t,i)=>{"use strict";i.d(t,{z:()=>TourTransitionError,Y:()=>TourStartError});var n=i(31102);class TourTransitionError extends n.y{constructor(e="Invalid tour transition"){super(e),this.name="TourTransition"}}class TourStartError extends n.y{constructor(e="Cannot start tour"){super(e),this.name="TourStart"}}},52599:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{BZ:()=>n,kw:()=>s,Aq:()=>r}),function(e){e[e.Pan=0]="Pan",e[e.PanDollhouse=1]="PanDollhouse",e[e.Zoom=2]="Zoom",e[e.Delay=3]="Delay",e[e.None=4]="None"}(n||(n={})),function(e){e[e.Left=1]="Left",e[e.Auto=0]="Auto",e[e.Right=-1]="Right"}(s||(s={})),function(e){e[e.Move=0]="Move",e[e.Burns=1]="Burns",e[e.Zoom=2]="Zoom",e[e.Path=3]="Path",e[e.FloorChange=4]="FloorChange",e[e.Delay=5]="Delay",e[e.Nop=6]="Nop"}(r||(r={}))},91302:(e,t,i)=>{"use strict";i.d(t,{oR:()=>TourStartedMessage,Vx:()=>TourSteppedMessage,dW:()=>TourStartTransitionMessage,_3:()=>TourStartBurnsTransitionMessage,NR:()=>TourStoppedMessage,Mt:()=>TourEndedMessage,sY:()=>TourStopAddedMessage});var n=i(91466);class TourStartedMessage extends n.v{}class TourSteppedMessage extends n.v{constructor(e){super(),this.index=e}}class TourStartTransitionMessage extends n.v{constructor(e){super(),this.index=e}}class TourStartBurnsTransitionMessage extends n.v{constructor(e,t,i){super(),this.index=e,this.transitionType=t,this.duration=i}}class TourStoppedMessage extends n.v{}class TourEndedMessage extends n.v{}class TourStopAddedMessage extends n.v{}},77037:(e,t,i)=>{"use strict";i.d(t,{WQ:()=>r,EU:()=>o,OJ:()=>a,BY:()=>l,Im:()=>c,LO:()=>d,N5:()=>h,Qo:()=>u,Pv:()=>p,Mk:()=>m,mL:()=>f,eu:()=>g,NY:()=>v,gS:()=>y,O2:()=>b,rM:()=>S,z8:()=>E,f7:()=>T,Cp:()=>w,_D:()=>x,HJ:()=>_,BA:()=>M,pn:()=>O,z$:()=>A,b_:()=>C,mS:()=>P,GS:()=>D,su:()=>N,_c:()=>I,Xd:()=>L});var n=i(17597),s=i(93263);const r="TourSpeed &wts",o="ToursMetersPerSecond",a=.4,l=10,c=1.25,d=.8,h=6,u=3,p=1e3*d,m=1e3*c,f=600,g=400,v=1200,y=1200,b=35,S=15,E=120,T=1200,w=75,x=400,_=s.DEFAULT_TRANSITION_TIME-f,M=35,O=M/3500*1e3,A=2,C=52,P=0,D=2e3,N=.2*O,I=3500,L=Object.freeze({panAtSnapshot:1===(0,n.eY)("kb",1),snapshotPanZoomDuration:(0,n.eY)("st",3500),snapshotPanAngle:(0,n.eY)("sspa",M),walkingTourIncludeExtraPanosDistance:.4,walkingStageMinimumDistance:.8,maxWalkingSweepsBetweenSnapshots:40,autoStartDelay:(0,n.eY)("ts",-1)})},20601:(e,t,i)=>{"use strict";i.d(t,{HG:()=>o,JG:()=>a,mf:()=>l,DA:()=>c});var n=i(19674),s=i(7170),r=i(77037);const o=e=>{let t=r.Im;if(!isNaN(e)){const i=Math.min(Math.max(r.OJ,e),r.BY);t=(0,n.et)(i,r.OJ,r.BY,r.LO,r.Qo)}return t},a=e=>(0,n.et)(e,r.LO,r.N5,r.OJ,r.BY),l=e=>Math.min(Math.max(r.LO,e),r.N5),c=e=>(0,s.Id)(e)/1e3},69941:(e,t,i)=>{"use strict";i.d(t,{k:()=>TourData});var n=i(32770),s=i(52599),r=i(85876),o=i(29293);class TourData extends n.V{constructor(e={},t,i,n,r){super(),this.snapshots=e,this.activeReel=t,this.allowedModes=i,this.modelSweeps=n,this.looping=r,this.name="tour",this.enabledTourStops=[],this.tourPlaying=!1,this.tourEnded=!1,this.updateEnabledStops=e=>{if(this.enabledTourStops=[],this.activeReel&&this.activeReel.reel)for(const t of this.activeReel.reel)if(t&&t.sid in this.snapshots){const i=this.snapshots[t.sid],n=i.metadata.cameraMode,s=i.metadata.scanId,r=-1!==e.indexOf(n),o=this.modelSweeps.findIndex((e=>e.id===s)),a=void 0!==s&&-1!==o&&this.modelSweeps[o].enabled,l=!s;r&&(l||a)&&this.enabledTourStops.push(t.sid)}},this.updateEnabledStops(i),this.tourState=o.Vs.Inactive,this.tourCurrentSnapshot=-1,this.transition={active:!1,type:s.Aq.Move,promise:Promise.resolve(),stop:()=>Promise.resolve(),toIndex:-1,duration:0},this.looping=r,this.commit()}addSnapshotToTour(e,t=o.VH.Current){this.snapshots[e.sid]=e;this.allowedModes.includes(e.metadata.cameraMode)&&this.enabledTourStops.push(e.sid);const i=this.tourCurrentSnapshotSid;switch(this.tourCurrentSnapshotSid=e.sid,t){case o.VH.Beginning:this.tourCurrentSnapshot=0,this.activeReel.reel.insert(0,{sid:e.sid});break;case o.VH.End:this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});break;case o.VH.Current:if(void 0===i)this.tourCurrentSnapshot=this.enabledTourStops.length-1,this.activeReel.reel.push({sid:e.sid});else{let t=this.activeReel.reel.findIndex((e=>!!e&&e.sid===i))+1;(t<=0||t>this.activeReel.reel.length)&&(t=this.activeReel.reel.length-1),this.tourCurrentSnapshot=this.tourCurrentSnapshot+1,this.activeReel.reel.insert(t,{sid:e.sid})}break;default:throw new Error(`Tours.addSnapshotToTour not implemented: ${t}`)}this.commit()}clearHighlightOverrides(e,t,i){if(!t&&!i)return;const n={};t&&(n.transitionType=void 0),i&&(n.panDirection=void 0,n.panAngle=void 0),this.applyHighlightOverrides(e,n)}clearAllHighlightOverrides(){this.getReel().reel.forEach((e=>{e&&this.clearHighlightOverrides(e.sid,!0,!0)}))}resetAllTransitionTypeOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&t.overrides.transitionType&&(delete t.overrides.transitionType,this.activeReel.reel.update(i,t),e=!0)})),e&&this.activeReel.setDirty()}}resetAllPanSettingOverrides(){if(this.activeReel&&this.activeReel.reel){let e=!1;this.activeReel.reel.forEach(((t,i)=>{t&&t.overrides&&(void 0===t.overrides.panAngle&&void 0===t.overrides.panDirection||(delete t.overrides.panAngle,delete t.overrides.panDirection,e=!0,this.activeReel.reel.update(i,t)))})),e&&this.activeReel.setDirty()}}applyHighlightOverrides(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e));this.setHighlightOverrides(i,t)}setHighlightOverrides(e,t){const i=this.activeReel.reel.get(e);if(!i)throw Error(`Highlight not found for ${e}`);const n={sid:i.sid};i.overrides?(n.overrides=Object.assign({},i.overrides),t.hasOwnProperty("panDirection")&&(n.overrides.panDirection=t.panDirection),t.hasOwnProperty("transitionType")&&(n.overrides.transitionType=t.transitionType),t.hasOwnProperty("panAngle")&&(n.overrides.panAngle=t.panAngle)):n.overrides={transitionType:t.transitionType,panDirection:t.panDirection,panAngle:t.panAngle},this.activeReel.reel.update(e,n)}updateReelEntry(e){const{sid:t}=e,i=this.activeReel.reel.findIndex((e=>!!e&&e.sid===t));if(-1===i)throw Error(`Reel entry not found for ${t}`);const n=this.activeReel.reel.get(i);if(!e)throw Error(`Reel entry not found for ${i}`);const s=Object.assign({},n,e);this.activeReel.reel.update(i,s)}moveTourStop(e,t){const i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),n=this.activeReel.reel.findIndex((e=>!!e&&e.sid===t));this.activeReel.reel.move(i,n)}clear(){this.resetEmptyReel(),this.enabledTourStops.length=0,this.activeReel.reel.length=0,this.commit()}removeTourStop(e){const t=this.enabledTourStops.indexOf(e),i=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),n=this.getTourIndexBySid(e);if(-1!==t&&this.enabledTourStops.splice(t,1),this.enabledTourStops.length>0){const e=n<=this.tourCurrentSnapshot?this.tourCurrentSnapshot-1:this.tourCurrentSnapshot;this.setTourCurrentSnapshotByIndex(Math.max(e,0))}else this.resetEmptyReel();this.activeReel.reel.remove(i)}getReel(){return this.activeReel}isLooping(){return this.looping}setLooping(e){this.looping=e}getActiveReelTourMode(){return this.activeReel.mode||r.Z.REEL}setActiveReelTourMode(e){this.activeReel.mode=e,this.activeReel.commit()}isTourActive(){return this.tourState!==o.Vs.Inactive}getCurrentTourState(){return{currentStep:this.getTourCurrentSnapshotIndex(),tourPlaying:this.tourPlaying,totalSteps:this.getSnapshotCount(),tourEnded:this.tourEnded,activeStep:this.transition&&-1!==this.transition.toIndex?this.transition.toIndex:this.getTourCurrentSnapshotIndex(),highlights:this.getReelHighlights(),transition:this.transition}}isTourTransitionActive(){return this.transition.active}getTourTransitionType(){return this.transition.type}useTransition(e){this.transition=e}setTourTransitionToIndex(e){this.transition.toIndex=e}async stopTourTransition(){await this.transition.stop()}iterateSnapshots(e){let t=0;this.activeReel.reel.forEach((i=>{if(i&&this.isEnabled(i.sid)){const n=this.snapshots[i.sid];e(n,t++)}}))}isSnapshotInTour(e){return-1!==this.activeReel.reel.findIndex((t=>!!t&&t.sid===e))}getEnabledSnapshots(){const e=[];return this.iterateSnapshots(((t,i)=>{e.push(t)})),e}updateSnapshots(e){this.snapshots=e}async getPhotosForTour(){const e=[];for(const t in this.snapshots){const i=this.snapshots[t];"tour"!==i.category&&"panorama"!==i.category&&e.push({name:i.name,sid:i.sid,thumbnailUrl:await i.thumbnailUrl.get(),inReel:-1!==this.activeReel.reel.findIndex((e=>!!e&&e.sid===t)),created:i.created})}return e.sort(((e,t)=>t.created.getTime()-e.created.getTime())),e}getSnapshot(e){return this.snapshots[e]}getTourStop(e){const t=this.activeReel.reel.findIndex((t=>!!t&&t.sid===e)),i=this.activeReel.reel.get(t);return{snapshot:this.getSnapshot(e),reelEntry:i}}getReelHighlights(){const e=[];return this.activeReel.reel.forEach((t=>{if(t&&this.isEnabled(t.sid)){const i=this.snapshots[t.sid],n=t.overrides&&t.overrides.panDirection,s=t.overrides&&t.overrides.panAngle;e.push({sid:i.sid,snapshot:i,panDirection:n,panAngle:s,transitionType:t.overrides&&t.overrides.transitionType,title:t.title,description:t.description})}})),e}getSnapshotCount(){return this.enabledTourStops.length}getTourState(){return this.tourState}setTourState(e){this.tourState=e}getTourCurrentSnapshotIndex(){return this.tourCurrentSnapshot}getTourCurrentSnapshotSid(){return this.tourCurrentSnapshotSid}getTourSnapshotSid(e){let t=0;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)){if(t===e)return i.sid;t++}throw new Error("getTourSnapshotSid() -> Invalid snapshot index.")}getTourSnapshotsWithSweepId(e){const t=[];for(const i of this.activeReel.reel)i&&i.sid in this.snapshots&&this.snapshots[i.sid].metadata.scanId===e&&t.push(i.sid);return t}setTourCurrentSnapshotByIndex(e){if(e<0||e>this.getSnapshotCount())throw new Error("setTourCurrentSnapshotByIndex() -> Invalid tour index.");let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,t===e)){this.tourCurrentSnapshot=e,this.tourCurrentSnapshotSid=i.sid;break}-1===t&&this.resetEmptyReel(),this.setTourTransitionToIndex(-1),this.commit()}getTourIndexBySid(e){let t=-1;for(const i of this.activeReel.reel)if(i&&this.isEnabled(i.sid)&&(t++,i.sid===e))return t;return-1}isEnabled(e){return-1!==this.enabledTourStops.indexOf(e)}resetEmptyReel(){this.tourCurrentSnapshot=-1,this.tourCurrentSnapshotSid=void 0,this.setTourTransitionToIndex(-1),this.commit()}}},29293:(e,t,i)=>{"use strict";var n,s,r;i.d(t,{zz:()=>n,Vs:()=>s,VH:()=>r}),function(e){e.NONE="none",e.STORIES="stories",e.LEGACY="legacy"}(n||(n={})),function(e){e[e.Inactive=0]="Inactive",e[e.Active=1]="Active",e[e.StopScheduled=2]="StopScheduled"}(s||(s={})),function(e){e[e.Beginning=0]="Beginning",e[e.Current=1]="Current",e[e.End=2]="End"}(r||(r={}))},23796:(e,t,i)=>{"use strict";i.d(t,{lj:()=>n,RN:()=>s,Un:()=>r,So:()=>o,vw:()=>a,kk:()=>l,rU:()=>c,Nu:()=>d,iL:()=>h});const n="features/tour-stories",s="gt",r=0,o=1,a=2,l=3,c="hr",d=0,h=1},73394:(e,t,i)=>{"use strict";i.d(t,{O8:()=>a,BO:()=>l,Cf:()=>c,w7:()=>d,oI:()=>h});var n=i(3248),s=i(29293),r=i(23796),o=i(85876);function a(e){const t=e.tryGetProperty(n.gx.TourButtons,!0),i=e.tryGetProperty(r.RN,r.So);return t&&i!==r.Un}function l(e){const t=e.tryGetProperty(n.gx.HighlightReel,!0),i=e.tryGetProperty(r.rU,r.iL);return t&&i!==r.Nu}function c(e,t){if(!h(e))return!1;const i=e.tryGetProperty(r.RN,r.So);return i===r.vw||i!==r.kk&&t===o.Z.REEL}function d(e,t){const i=e.tryGetProperty(n.gx.TourButtons,!0),r=e.tryGetProperty(n.gx.HighlightReel,!0);return i||r?h(e)&&t===o.Z.REEL?s.zz.STORIES:s.zz.LEGACY:s.zz.NONE}function h(e){return e.tryGetProperty(r.lj,!1)}},76236:(e,t,i)=>{"use strict";i.d(t,{F:()=>DeletedObject});var n=i(23573),s=i(10757);class DeletedObject extends n.T{constructor(e){super(),this.id=(0,s.O1)(11),e&&Object.assign(this,e)}}},93673:(e,t,i)=>{"use strict";i.d(t,{B:()=>RegisterDeletedObjectTypeCommand,p:()=>RestoreDeletedObjectCommand});var n=i(17386);class RegisterDeletedObjectTypeCommand extends n.m{constructor(e){super(),this.id="REGISTER_DELETED_OBJECT_TYPE_COMMAND",this.payload=e}}class RestoreDeletedObjectCommand extends n.m{constructor(e){super(),this.id="RESTORE_DELETED_OBJECT_COMMAND",this.payload={id:e}}}},81347:(e,t,i)=>{"use strict";i.d(t,{m:()=>UserData});var n=i(32770),s=i(64781),r=i(88172),o=i(61481),a=i(80161),l=i(49747);class UserData extends n.V{constructor(e,t,i,n=[]){super(),this.orgAdmin=i,this.policies=n,this.name="users-data",this.users=(0,s.q)();const l=e.modelAccess||a.x.PUBLIC;this.currentUser=new r.a(Object.assign(Object.assign({},e),{modelAccess:l,userStatus:t?o.J.KNOWN:o.J.UNKNOWN})),this.addUser(this.currentUser)}loadSearchResults(e,t,i){this.atomic((()=>{e.forEach((e=>{this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.KNOWN}))})),t.forEach((e=>{this.users.get(e)||this.loadUser({email:e,id:"",userStatus:i})}))}))}loadKnownUsers(e){this.atomic((()=>{e.forEach((e=>{this.loadKnownUser(e)}))}))}loadKnownUser(e){return this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.KNOWN}))}loadContributor(e){const t=this.users.get(e.email);return t||this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.CONTRIBUTOR}))}loadFailedUser(e){return this.loadUser(Object.assign(Object.assign({},e),{userStatus:o.J.FAILED}))}loadUser(e){let t=this.users.get(e.email);return e.email===this.currentUser.email||t&&t.userStatus===o.J.KNOWN&&t.modelAccess!==a.x.PUBLIC||(t=new r.a(e),t?this.users.set(e.email,t):this.addUser(t)),t}getUserInfoByEmail(e){return this.users.has(e)?this.users.get(e):null}getUserInfoById(e){return""===e?null:this.users.values.find((t=>t.id===e))||null}getUserDisplay(e){return this.users.has(e)?this.users.get(e):(0,l.Q)(e)}iterate(e){for(const t of this.users)e(t)}getUsersWhoMayNeedAccess(){const e={};return this.users.values.forEach((t=>{t.userStatus===o.J.KNOWN&&t.modelAccess!==a.x.PUBLIC||(e[t.email]=t)})),e}getKnownUsers(){return this.users.values.filter((e=>e.userStatus===o.J.KNOWN))}addUser(e){this.users.has(e.email)||this.users.set(e.email,e)}getCurrentUser(){return this.currentUser}isLoggedIn(){return!!this.currentUser.id}isPolicyFlagEnabled(e){return this.policies.includes(e)}isOrgAdmin(){return this.orgAdmin}isInviter(){return this.orgAdmin}isEditor(){return this.currentUser.modelAccess===a.x.FULL}isCommenter(){const{modelAccess:e}=this.currentUser;return e===a.x.VIEWER||e===a.x.FULL}getCurrentUserId(){return this.currentUser.id}onUsersChanged(e){return this.users.onChanged(e)}}},88172:(e,t,i)=>{"use strict";i.d(t,{a:()=>UserInfo});var n=i(61481),s=i(80161),r=i(49747);class UserInfo{constructor(e){this.email="",this.id="",this.firstName="",this.lastName="",this.modelAccess=s.x.PUBLIC,this.userStatus=n.J.UNKNOWN,this.name="",this.initials="",this.color="",e&&Object.assign(this,e);const t=this.id?this.getFullName(this.firstName,this.lastName):"";this.name=t||this.email||"",this.initials=this.getInitials(this.name),this.color=(0,r._)(this.id)}getFullName(e,t){return e&&t?`${e} ${t}`:e||t}getInitials(e){const t=e?e.split(" ").map((e=>e[0])).join(""):"?";return t.length<3?t:`${t[0]}${t[t.length-1]}`}}},7683:(e,t,i)=>{"use strict";i.d(t,{V1:()=>UserMentionSearchCommand,Vu:()=>ResolveUserMentionsCommand,JB:()=>InviteUsersCommand});var n=i(17386);class UserMentionSearchCommand extends n.m{constructor(e){super(),this.payload={search:e}}}class ResolveUserMentionsCommand extends n.m{constructor(e){super(),this.payload={userMentions:e}}}class InviteUsersCommand extends n.m{constructor(e,t,i,n){super(),this.payload={emails:e,message:t,modelAccess:i,noteId:n}}}},61481:(e,t,i)=>{"use strict";var n;i.d(t,{J:()=>n}),function(e){e.UNKNOWN="unknown",e.FAILED="failed",e.MENTIONED="mentioned",e.CONTRIBUTOR="contributor",e.KNOWN="known"}(n||(n={}))},54791:(e,t,i)=>{"use strict";i.r(t),i.d(t,{InviteUsersCommand:()=>p.JB,OrgUser:()=>OrgUser,ResolveUserMentionsCommand:()=>p.Vu,UserData:()=>u.m,UserInfo:()=>f.a,UserMentionSearchCommand:()=>p.V1,UserStatus:()=>h.J,default:()=>g,defaultUserColor:()=>m._,getUnknownUserInfo:()=>m.Q});var n=i(47724),s=i(88512),r=i(94474),o=i(36651),a=i(80161);class OrgUser{constructor(e){this.id="",this.email="",this.firstName="",this.lastName="",this.modelAccess=a.x.PUBLIC,Object.assign(this,e)}}const l=new s.Z("mds-user-deserializer");class MdsUserDeserializer{constructor(){this.validate=e=>{if(!e)return!1;const t=["id","email"].filter((t=>!(t in e))),i=0===t.length;return i||l.debug("OrgUserMetadata invalid:",{missingFields:t}),i}}deserialize(e){return e&&this.validate(e)?new OrgUser(e):(l.debug("Deserialized invalid OrgUserMetadata from MDS",e),null)}}var c=i(11820);const d=new s.Z("users-store");class MdsUserStore extends r.u{constructor(e){super(e),this.deserializer=new MdsUserDeserializer}static getEnabledPolicies(e){return(null==e?void 0:e.filter((e=>e.enabled)).map((e=>e.name)))||[]}async fetchAccessForUser(e){const t=this.getViewId();return this.query(c.GetCurrentUserModelAccess,{modelId:t,userId:e}).then((t=>{const i=(0,o.q)(t,"data.model.policies"),n=MdsUserStore.getEnabledPolicies(i),s=(0,o.q)(t,"data.model.users.results");let r;return s&&Array.isArray(s)&&1===s.length?r=s[0].modelAccess:(d.debug(`fetchModelAccess failed for ${e}`),r=a.x.PUBLIC),{policies:n,modelAccess:r}}))}async search(e,t,i){const n=this.getViewId();return this.query(c.GetUsers,{modelId:n,search:e,ids:i,emails:t}).then((e=>{const t=(0,o.q)(e,"data.model.users.results");if(!t||!Array.isArray(t))return[];const i=[];for(const e of t){const t=this.deserializer.deserialize(e);t&&i.push(t)}return i}))}}var h=i(61481),u=i(81347),p=i(7683);class Users extends n.Y{constructor(){super(...arguments),this.name="users-module",this.onUserMentionSearch=async e=>{const t=await this.store.search(e.search);this.userData.loadKnownUsers(t)},this.resolveUserMentions=async e=>{if(0===e.userMentions.length)return void this.log.debug("No user mentions to resolve");const t=[];if(e.userMentions.forEach((e=>{this.userData.getUserInfoByEmail(e.email)&&e.userStatus!==h.J.MENTIONED||t.push(e)})),t.length>0){const e=t.map((e=>e.email));return this.searchUsers(new Set(e),h.J.MENTIONED)}},this.inviteUsers=async e=>{const{emails:t,modelAccess:i,message:n,noteId:s}=e;if(0===t.length)return;const{baseUrl:r,modelId:o,queue:a}=this.config,l=`${r}/api/v2/shares/`,c={object_type:"model",object_id:o,role:i,inviter_message:n,note:s},d=new Set;return await Promise.all(e.emails.map((e=>a.post(l,{responseType:"json",body:Object.assign(Object.assign({},c),{email:e})}).then((e=>{const t=e.user;this.userData.loadKnownUser({id:t.sid,email:t.email,firstName:t.first_name,lastName:t.last_name,modelAccess:e.role})})).catch((()=>{this.log.debug(`User Invite failed: ${e}`),d.add(e)}))))),d.size>0?this.searchUsers(d,h.J.FAILED):void 0}}async init(e,t){this.config=e,this.store=new MdsUserStore({readonly:!0,baseUrl:e.baseUrl,viewId:e.modelId});const i=e.api.user;let n=a.x.PUBLIC,s=[],r=!1;if(i.loggedIn&&i.id){const t=await this.store.fetchAccessForUser(i.id);n=t.modelAccess,s=t.policies,e.organizationId&&(r=i.isOrganizationAdmin(e.organizationId))}this.userData=new u.m({id:i.id,firstName:i.firstName,lastName:i.lastName,email:i.email,modelAccess:n},i.loggedIn,r,s),this.bindings.push(t.commandBinder.addBinding(p.V1,this.onUserMentionSearch),t.commandBinder.addBinding(p.Vu,this.resolveUserMentions),t.commandBinder.addBinding(p.JB,this.inviteUsers)),t.market.register(this,u.m,this.userData)}getUserData(){return this.userData}async searchUsers(e,t){const i=Array.from(e),n=await this.store.search(void 0,i);this.userData.loadSearchResults(n,i,t)}isPolicyFlagEnabled(e){return this.userData.isPolicyFlagEnabled(e)}}var m=i(49747),f=i(88172);const g=Users},49747:(e,t,i)=>{"use strict";i.d(t,{_:()=>a,Q:()=>l});var n=i(84933),s=i(61481),r=i(80161);const o=["#d44441","#f44336","#e91e63","#f78da7","#9c4b92","#673ab7","#5c7fff","#03a9f4","#417505","#00bcd4","#51a868","#37d67a","#cddc39","#fbcd00","#ffac17","#ff6900","#abb8c3","#607d8b"];function a(e){const t=o.length;return o[(0,n.Wm)(e||"",t)]}function l(e){return{email:e,id:"",firstName:"",lastName:"",name:"Unknown",initials:"?",color:a(e),userStatus:s.J.UNKNOWN,modelAccess:r.x.PUBLIC}}},3805:(e,t,i)=>{"use strict";i.d(t,{BD:()=>n,g:()=>a,KP:()=>l,ty:()=>c,_i:()=>ChangeViewmodeCommand});var n,s=i(17386),r=i(5087),o=i(31278);!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning",e.ORTHOGRAPHIC="mode.orthographic",e.MESH="mode.mesh"}(n||(n={}));const a=n.INSIDE,l=(n.INSIDE,r.Ey.Panorama,n.DOLLHOUSE,r.Ey.Dollhouse,n.FLOORPLAN,r.Ey.Floorplan,n.TRANSITIONING,r.Ey.Transition,n.OUTSIDE,r.Ey.Outdoor,n.ORTHOGRAPHIC,r.Ey.Orthographic,n.MESH,r.Ey.Mesh,{[r.Ey.Panorama]:n.INSIDE,[r.Ey.Dollhouse]:n.DOLLHOUSE,[r.Ey.Floorplan]:n.FLOORPLAN,[r.Ey.Transition]:n.TRANSITIONING,[r.Ey.Outdoor]:n.OUTSIDE,[r.Ey.Orthographic]:n.ORTHOGRAPHIC,[r.Ey.Mesh]:n.MESH}),c=e=>{const t=l[e];return void 0!==t?t:n.OUTSIDE};class ChangeViewmodeCommand extends s.m{constructor(e,t=o.n.Interpolate,i={}){super(),this.payload={mode:e,transitionType:t,pose:i}}}ChangeViewmodeCommand.id="CHANGE_VIEWMODE"},11426:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ViewmodeChange});var n=i(3248),s=i(47724),r=i(3805),o=i(93263),a=i(33874),l=i(5087),c=i(31278),d=i(67027),h=i(12216),u=i(2212),p=i(69626),m=i(75892),f=i(51263),g=i(57051),v=i(59088),y=i(29422),b=i(21479),S=i(8150),E=i(35597),T=i(18469),w=i(27326),x=i(96909);class ViewmodeChange extends s.Y{constructor(){super(...arguments),this.name="viewmode-change",this.dhDisabled=()=>!1,this.fpDisabled=()=>!1}async init(e,t){this.engine=t,this.viewmodesModule=await t.getModule(o.default),this.bindings.push(t.subscribe(S.bS,(e=>this.setEnabledModes(e.application))),t.commandBinder.addBinding(r._i,this.onChangeViewmodeCommand.bind(this))),Promise.all([t.market.waitForData(b.pu),t.market.waitForData(a.e)]).then((([e,t])=>{this.settings=t,this.setEnabledModes(e.application)}))}async setEnabledModes(e){if(e===b.Mx.SHOWCASE){if(this.dhDisabled=()=>this.settings.checkUrlParam("dh",0,1)||!this.settings.tryGetProperty(n.gx.Dollhouse,!1),this.fpDisabled=()=>this.settings.checkUrlParam("fp",0,1)||!this.settings.tryGetProperty(n.gx.FloorPlan,!1),!this.previousApp)return;const e=(await this.engine.market.waitForData(E.O)).currentMode;if(e===l.Ey.Dollhouse&&this.dhDisabled()||e===l.Ey.Floorplan&&this.fpDisabled()){const e=(await this.engine.market.waitForData(T.O)).pose;if(e&&(0,l.Bw)(e.mode))this.goToInsideMode(c.n.Interpolate,{position:e.camera.position},e.mode);else{const e=(await this.engine.market.waitForData(v.M_)).pose,t=(await this.engine.market.waitForData(m.Z)).getClosestSweep(e.position,!0),i=t?{position:t.position}:void 0;this.goToInsideMode(c.n.Interpolate,i,l.Ey.Panorama)}}}else e===b.Mx.WORKSHOP&&(this.dhDisabled=()=>!1,this.fpDisabled=()=>!1);this.previousApp=e}async onChangeViewmodeCommand(e){switch(e.mode){case r.BD.INSIDE:return this.goToInsideMode(e.transitionType,e.pose,l.Ey.Panorama);case r.BD.DOLLHOUSE:return this.goToDollhouse(e.transitionType,e.pose);case r.BD.FLOORPLAN:return this.goToFloorplan(e.transitionType,e.pose);case r.BD.ORTHOGRAPHIC:return this.goToOrthographic(e.transitionType,e.pose);case r.BD.MESH:return this.goToInsideMode(e.transitionType,e.pose,l.Ey.Mesh)}return Promise.reject(`viewmode-change => Could not move to ${e.mode}`)}async goToInsideMode(e=c.n.Interpolate,t={},i){const n=this.engine.market.tryGetData(m.Z);if(!n)return Promise.reject("Cannot go to inside mode");if(!(0,l.Bw)(i))return Promise.reject("Unsupport mode!");let s=t.sweepID||n.currentSweep;if(s||(s=await this.getLookAtSweep(n)),n.isSweepUnaligned(s)){const e=n.getFirstAlignedSweep();s=e?e.id:this.getFirstSweepId(n)}return(0,l.Bw)(this.viewmodesModule.currentMode)&&n.isSweepUnaligned(n.currentSweep)?this.engine.commandBinder.issueCommand(new y.ju({sweep:s,rotation:t.rotation,transition:c.n.FadeToBlack})):this.viewmodesModule.switchToMode(i,e,{sweepID:s,rotation:t.rotation},o.DEFAULT_TRANSITION_TIME)}async getLookAtSweep(e){const t=this.engine.market.tryGetData(v.M_);if(!t)return this.getFirstSweepId(e);const i=this.engine.market.tryGetData(w.c),n=(null==i?void 0:i.getFloorMin())||this.getModelMinHeight(),s=new u.Plane(h.f.DOWN,n),r=(0,p.Fe)(t.pose.position,t.pose.rotation,s);if(!r)return this.getFirstSweepId(e);const o=[f._T(),f._k(),e=>!i||i.isCurrentOrAllFloors(e.floorId)],a=[g.l0(r)],l=e.sortByScore(o,a).shift();if(l)return l.sweep.id;const c=e.getClosestSweep(r,!0);return c?c.id:this.getFirstSweepId(e)}getFirstSweepId(e){const t=e.getFirstSweep();if(void 0===t)throw new Error("First enabled sweep not found");return t.id}getModelMinHeight(){return this.meshData||(this.meshData=this.engine.market.tryGetData(d._)),this.meshData?this.meshData.bounds.min.y:0}async goToDollhouse(e=c.n.Interpolate,t={}){return this.dhDisabled()?Promise.reject("Cannot go to dollhouse mode"):this.viewmodesModule.switchToMode(l.Ey.Dollhouse,e,t)}async goToFloorplan(e=c.n.Interpolate,t={}){if(this.fpDisabled())return Promise.reject("Cannot go to floorplan mode");const i=await this.engine.getModuleBySymbol(x.y.CANVAS);return i&&await i.getTransitionPromise(),this.viewmodesModule.switchToMode(l.Ey.Floorplan,e,t)}async goToOrthographic(e=c.n.Interpolate,t={}){const i=await this.engine.getModuleBySymbol(x.y.CANVAS);return i&&await i.getTransitionPromise(),this.viewmodesModule.switchToMode(l.Ey.Orthographic,e,t)}}},36297:(e,t,i)=>{"use strict";i.d(t,{M:()=>LockViewmodeCommand,I:()=>UnlockViewmodeCommand});var n=i(17386);class LockViewmodeCommand extends n.m{constructor(){super()}}LockViewmodeCommand.id="LOCK_VIEWMODE";class UnlockViewmodeCommand extends n.m{constructor(){super()}}UnlockViewmodeCommand.id="UNLOCK_VIEWMODE"},68576:(e,t,i)=>{"use strict";i.d(t,{Z:()=>BeginSwitchViewmodeMessage});var n=i(35015);class BeginSwitchViewmodeMessage extends n.a{}},88814:(e,t,i)=>{"use strict";i.d(t,{Z:()=>EndSwitchViewmodeMessage});var n=i(35015);class EndSwitchViewmodeMessage extends n.a{}},35015:(e,t,i)=>{"use strict";i.d(t,{a:()=>SwitchViewmodeMessage});var n=i(91466);class SwitchViewmodeMessage extends n.v{constructor(e,t){super(),this.fromMode=t,this.toMode=e,this.timestamp=Date.now()}}},5087:(e,t,i)=>{"use strict";var n;i.d(t,{Ey:()=>n,Ae:()=>s,Bw:()=>r}),function(e){e[e.Panorama=1]="Panorama",e[e.Dollhouse=2]="Dollhouse",e[e.Floorplan=3]="Floorplan",e[e.Outdoor=4]="Outdoor",e[e.Orthographic=5]="Orthographic",e[e.Mesh=6]="Mesh",e[e.Transition=-1]="Transition"}(n||(n={}));const s=e=>{switch(e){case n.Panorama:return"Panorama";case n.Floorplan:return"Floorplan";case n.Dollhouse:return"Dollhouse";case n.Transition:return"Transition";case n.Orthographic:return"Orthographic";case n.Mesh:return"Mesh"}return"Unknown"};function r(e){return e===n.Panorama||e===n.Mesh}},35597:(e,t,i)=>{"use strict";i.d(t,{O:()=>ViewmodeData});var n=i(32770),s=i(5087),r=i(48715);class ViewmodeData extends n.V{constructor(){super(),this.name="viewmode",this.viewmodeChangeEnabled=!0,this.currentModeObservable=(0,r.Y)(null),this.transition={active:!1,progress:0,from:null,to:null,startTime:0,transitionTime:0},this.isPano=this.isPano.bind(this),this.isFloorplan=this.isFloorplan.bind(this),this.isInside=this.isInside.bind(this),this.isDollhouse=this.isDollhouse.bind(this),this.isOrthographic=this.isOrthographic.bind(this)}get currentMode(){return this.currentModeObservable.value}set currentMode(e){e!==this.currentModeObservable.value&&(this.currentModeObservable.value=e)}get closestMode(){return this.currentMode===s.Ey.Transition?this.transition.progress<.5?this.transition.from:this.transition.to:this.currentMode}makeModeChangeSubscription(e){return this.currentModeObservable.onChanged(e)}activateTransition(e,t,i){this.transition.active=!0,this.transition.progress=0,this.transition.startTime=Date.now(),this.transition.transitionTime=i,this.transition.to=t,this.transition.from=e}deactivateTransition(){this.transition.active=!1}isPano(){return this.currentMode===s.Ey.Panorama}isInside(){return(0,s.Bw)(this.currentMode)}isMesh(){return this.currentMode===s.Ey.Mesh}isFloorplan(){return this.currentMode===s.Ey.Floorplan}isDollhouse(){return this.currentMode===s.Ey.Dollhouse}isOrthographic(){return this.currentMode===s.Ey.Orthographic}canStartTransition(){const e=this.transition.active,t=this.currentMode===s.Ey.Transition;return!e&&!t}transitionActive(){return!this.canStartTransition()}isAlreadyInMode(e){const t=this.transition.from===this.transition.to,i=this.currentMode===e;return this.transition.active&&t||i}canSwitchViewMode(e){return this.canStartTransition()&&this.viewmodeChangeEnabled&&!this.isAlreadyInMode(e)}}},93263:(e,t,i)=>{"use strict";i.r(t),i.d(t,{DEFAULT_TRANSITION_TIME:()=>M,default:()=>ViewmodeModule});var n=i(96909),s=i(5087),r=i(31278),o=i(2212),a=i(12216),l=i(63560),c=i(47724),d=i(35597),h=i(59088),u=i(2240),p=i(75892),m=i(88814),f=i(68576),g=i(35015),v=i(31102);class ViewmodeActiveTransitionError extends v.y{constructor(e="Tried to start view-mode transition while another transition was active"){super(e),this.name="ViewmodeActiveTransition"}}class ViewmodeChangeLockedError extends v.y{constructor(e="Cannot change viewmode when locked"){super(e),this.name="ViewmodeChangeLockedError"}}var y=i(69626);var b=i(40168),S=i(36371),E=i(79437);const T={rotationDuration:1,rotationDelay:0,matrixDelay:0,matrixDuration:.5},w={[s.Ey.Dollhouse]:{matrixDelay:.5,matrixDuration:1},[s.Ey.Panorama]:{rotationDuration:.5}};var x=i(67027),_=i(36297);const M=1e3,O=Math.PI/2+Number.EPSILON,A=Math.PI-Number.EPSILON,C={[s.Ey.Panorama]:M,[s.Ey.Dollhouse]:M,[s.Ey.Floorplan]:M,[s.Ey.Orthographic]:M};class ViewmodeModule extends c.Y{constructor(){super(...arguments),this.viewmodeData=new d.O,this.name="viewmode",this.minDollhouseDistance=15,this.maxDollhouseDistance=50,this._orthoMatrix=new S.M,this.getFlyinStartPose=(e,t)=>{const i=t||this.cameraData.pose.position,n=e.position.y-i.y,s=(0,y.Ll)(e.position,i,this.meshData.center),r=a.f.FORWARD.clone().applyQuaternion(s);return{position:(0,y.D7)(e.position,i,Math.sign(r.y)*Math.PI/4,!0).setY(1.5*n)}},this.getFlyinEndPose=e=>{const t=e.position||this.sweepData.getSweep(e.sweepID).position,i=e.rotation||new o.Quaternion,n=Math.PI/180*l.oR.fov;return(0,y.YN)(t,i,-Math.PI/6,this.meshData.bounds,n,this.canvas.aspectRatio)}}async init(e,t){this.engine=t,this.market=t.market,null!==e.startingMode&&(this.viewmodeData.currentMode=e.startingMode),this.market.register(this,d.O,this.viewmodeData),t.market.waitForData(x._).then((e=>{this.meshData=e,this.setDollhouseBounds()})),this.bindings.push(t.commandBinder.addBinding(_.M,this.lockViewmode.bind(this)),t.commandBinder.addBinding(_.I,this.unlockViewmode.bind(this)));const[i,s,r,o,a]=await Promise.all([t.getModuleBySymbol(n.y.CAMERA),t.getModule(u.default),t.market.waitForData(p.Z),t.market.waitForData(b.W),t.market.waitForData(h.M_)]);this.cameraModule=i,this.sweepModule=s,this.sweepData=r,this.canvas=o,this.cameraData=a}lockViewmode(){this.viewmodeData.viewmodeChangeEnabled=!1,this.viewmodeData.commit()}unlockViewmode(){this.viewmodeData.viewmodeChangeEnabled=!0,this.viewmodeData.commit()}get currentMode(){return this.viewmodeData.currentMode}async switchToMode(e,t=r.n.FadeToBlack,i,o){if(this.log.info(`switchToMode mode:${e} type:${t}`),this.meshData||e!==s.Ey.Floorplan&&e!==s.Ey.Dollhouse||await this.engine.getModuleBySymbol(n.y.MODEL_MESH),t===r.n.Instant&&(o=0),o=void 0!==o?o:C[e],!this.viewmodeData.canStartTransition()||!this.cameraData.canTransition())throw new ViewmodeActiveTransitionError;if(e!==this.currentMode&&!this.viewmodeData.viewmodeChangeEnabled)throw new ViewmodeChangeLockedError;const a=this.isAlreadyInMode(this.viewmodeData,e),l=i&&!ViewmodeModule.willPoseChange(this.cameraData,i);if(a&&l)return Promise.resolve();this.sweepData.currentSweep&&this.sweepData.isSweepUnaligned(this.sweepData.currentSweep)&&!(0,s.Bw)(e)&&(t=r.n.FadeToBlack);const c=null!==this.viewmodeData.currentMode?this.viewmodeData.currentMode:void 0;this.viewmodeData.activateTransition(this.viewmodeData.currentMode,e,o),this.viewmodeData.currentMode=s.Ey.Transition,this.viewmodeData.commit(),this.engine.broadcast(new f.Z(e,c));const d=this.moveCameraToViewmode(e,c,t,o,i);let h=!1;return d.progress((t=>{this.viewmodeData.transition.progress=t,this.viewmodeData.commit(),t>=.5&&!h&&(h=!0,this.engine.broadcast(new g.a(e,c)))})),d.then((()=>{this.viewmodeData.transition.progress=1,this.viewmodeData.currentMode=e,this.viewmodeData.deactivateTransition(),this.viewmodeData.commit(),this.engine.broadcast(new m.Z(e,c))})),d.nativePromise()}isAlreadyInMode(e,t){const i=e.transition.from===e.transition.to,n=e.currentMode===t;return e.transition.active&&i||n}static willPoseChange(e,t){return void 0!==t.position&&!e.pose.position.equals(t.position)||void 0!==t.rotation&&!e.pose.rotation.equals(t.rotation)||void 0!==t.zoom&&e.zoom()!==t.zoom}moveCameraToViewmode(e,t,i,n,r){switch(e){case s.Ey.Mesh:case s.Ey.Panorama:return this.moveCameraToPanorama(i,n,r);case s.Ey.Dollhouse:return this.moveCameraToDollhouse(t,i,n,r);case s.Ey.Floorplan:return this.moveCameraToFloorplan(t,i,n,r);case s.Ey.Orthographic:return this.moveCameraToOrthographic(t,i,n,r);default:throw Error(`moveCameraToViewmode(): Invalid view-mode to go to: ${e}`)}}moveCameraToPanorama(e,t,i){if(this.sweepData.canTransition()||this.cameraData.canTransition()){let n;if(i&&i.sweepID)n=i.sweepID;else{const e=this.sweepData.getFirstSweep();n=this.sweepData.currentSweep,!n&&e&&(n=e.id)}if(!n)throw new Error("moveCameraToPanorama(): Invalid target sweep!");this.sweepData.isSweepUnaligned(n)&&(e=r.n.FadeToBlack);let l=i&&i.rotation?i.rotation:void 0;if(!l){const e=(this.viewmodeData.transition.from===s.Ey.Floorplan?a.f.UP:a.f.FORWARD).clone().applyQuaternion(this.cameraData.pose.rotation).setY(0).normalize();l=(new o.Quaternion).setFromUnitVectors(a.f.FORWARD,e)}return this.sweepModule.moveToSweep({transitionType:e,sweepId:n,rotation:l,transitionTime:t,rotationDelay:.5})}throw new Error("Could not move to panorama mode because another transition was active")}moveCameraToDollhouse(e,t,i,n){const r=this.meshData.bounds,c={};let d;if(n&&(n.position||n.rotation)){if(n.position&&n.rotation){c.position=n.position,c.rotation=n.rotation;const e=new o.Plane(a.f.UP.clone(),this.meshData.center.y);let t=(0,y.Fe)(c.position,c.rotation,e);t||(t=new o.Vector3,t.copy(this.meshData.center)),r.containsPoint(t)&&(d=c.position.distanceTo(t))}else if(n.position)c.position=n.position,c.rotation=(0,y.n0)(n.position,this.meshData.center);else{c.rotation=n.rotation;const e=r.min.distanceTo(r.max);c.position=(0,y.fd)(c.rotation,this.meshData.center,e)}d||(d=this.meshData.center.clone().distanceTo(c.position))}else{let e,t;const i=this.sweepData.isSweepUnaligned(this.sweepData.currentSweep),n=i||this.viewmodeData.transition.from===s.Ey.Floorplan?this.meshData.center:this.cameraData.pose.position;if(i)t=new o.Vector3(0,0,0),e=new o.Vector3(15,10,15);else if(this.viewmodeData.transition.from!==s.Ey.Floorplan){const i=1.5,s=(0,y.YN)(this.cameraData.pose.position,this.cameraData.pose.rotation,-Math.PI/6,this.meshData.bounds,this.cameraData.fovY()*i,this.cameraData.pose.aspect()),r=((e,t)=>{const i=e.clone().add(new o.Vector3(0,6,0)),n=a.f.FORWARD.clone().applyQuaternion(t);return n.y>=.01&&(n.y=.01),{position:i.clone().add(n.clone().multiplyScalar(-10)),direction:n}})(n,this.cameraData.pose.rotation);[e,t]=[s.position,r.direction]}else{const i=((e,t)=>{const i=e.clone(),n=a.f.DOWN.clone().applyQuaternion(t).multiplyScalar(6),s=i.clone().add(n).setY(6),r=a.f.UP.clone().applyQuaternion(t);return r.setY(-.5).normalize(),{position:s,direction:r}})(n,this.cameraData.pose.rotation);[e,t]=[i.position,i.direction]}const r=n.clone().add(t).setY(this.meshData.center.y);c.position=(0,y.r0)(e,r,this.minDollhouseDistance,this.maxDollhouseDistance),c.position=(0,y.m$)(c.position,r,O,A),c.rotation=(0,y.n0)(c.position,r),d=r.distanceTo(c.position)}return this.cameraModule.moveTo({transitionType:t,pose:c,transitionTime:i,projection:(0,l.AN)(this.cameraData.aspect()),focalDistance:d,rotationDuration:.5})}setDollhouseBounds(){const e=this.meshData.bounds,t=e.min.distanceTo(e.max);this.minDollhouseDistance=Math.min(t/2,this.minDollhouseDistance),this.maxDollhouseDistance=Math.max(t,this.maxDollhouseDistance)}moveCameraToFloorplan(e,t,i,n){const s={},r=this.meshData.center,c=this.meshData.size,d=Math.max(c.x,c.z),h=this.canvas.aspectRatio,u=this.getDefaultFloorplanZoom(),p=n&&n.zoom?this.canvas.height/(2*n.zoom):u,m=(0,l.aH)(this.canvas.width,this.canvas.height,p),f=(0,l.aH)(this.canvas.width,this.canvas.height,u);if(this.cameraModule.setBaseProjection(f),n&&n.position)s.position=n.position;else{const e=a.f.UP.clone().multiplyScalar(d);s.position=r.clone().add(e)}if(n&&n.rotation)s.rotation=n.rotation;else{const e=(new S.M).setPosition(s.position);e.lookAt(s.position,r,a.f.FORWARD),s.rotation=(new o.Quaternion).setFromRotationMatrix(e.asThreeMatrix4());if(h<1!==c.x/c.z<1){const e=(new o.Quaternion).setFromUnitVectors(a.f.UP,a.f.LEFT);s.rotation.multiply(e)}}const g=s.position.y-this.meshData.center.y;let v=Object.assign(Object.assign({},T),{easing:E.hl,transitionType:t,pose:s,transitionTime:i,projection:m,focalDistance:g});return e&&e in w&&(v=Object.assign(Object.assign({},w[e]),v)),this.cameraModule.moveTo(v)}moveCameraToOrthographic(e,t,i,n){const s=n&&n.zoom?n.zoom:this.getDefaultFloorplanZoom(),r=(0,l.aH)(this.canvas.width,this.canvas.height,s,this._orthoMatrix);this.cameraModule.setBaseProjection(r);const o={easing:E.hl,transitionType:t,pose:n||{},transitionTime:i,projection:r,focalDistance:2};return this.cameraModule.moveTo(o)}getDefaultFloorplanZoom(){const e=this.meshData.size,t=Math.max(e.x,e.z),i=Math.min(e.x,e.z),n=this.canvas.aspectRatio,s=Math.max(t,i/n),r=Math.max(i,t/n),o=n<1?s:r;return this.canvas.height/(1.2*o)}}},17838:(e,t,i)=>{"use strict";function n(e){try{const t=e.getExtension("WEBGL_debug_renderer_info");if(t)return{vendor:e.getParameter(t.UNMASKED_VENDOR_WEBGL),renderer:e.getParameter(t.UNMASKED_RENDERER_WEBGL)}}catch(e){}return{vendor:"Unknown",renderer:"Unknown"}}function s(e){return/Apple A(9|1\d)/.test(e.renderer)||/Adreno \(TM\) (512|530|540|[6-9]\d\d)/.test(e.renderer)||/Mali-G(7[1-9]|[8-9]\d)/.test(e.renderer)}i.d(t,{t:()=>n,W:()=>s})},67627:(e,t,i)=>{"use strict";i.d(t,{a:()=>n,Z:()=>WebGLScene});var n,s=i(2212),r=i(63560),o=i(84561);class CameraRig extends s.Object3D{constructor(e){super(),this.anchor=this,this.update=e=>{this.anchor.position.copy(e.position),this.camera.quaternion.copy(e.rotation),this.camera.projectionMatrix.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.copy(e.projection.asThreeMatrix4()),this.camera.projectionMatrixInverse.invert(),this.updateMatrixWorld(!0)},this.camera=new s.PerspectiveCamera(r.oR.fov,e,r.oR.near,r.oR.far),this.add(this.camera),this.camera.layers.mask=o.o.ALL.mask,this.name="CameraRig"}dispose(){this.remove(this.camera)}}!function(e){e[e.Root=0]="Root",e[e.CameraRig=1]="CameraRig"}(n||(n={}));class WebGLScene{constructor(e,t,i,r){this.scene=e,this.threeRenderer=t,this.cameraData=i,this.useEffectComposer=r,this.ids=n,this.rendering=!1,this.composer=null,this.cameraRigStale=!0,this.canvasSizeChanged=!0,this.updateComposer=(()=>{const e=new s.Vector2;return()=>{this.canvasSizeChanged&&this.composer&&(this.composer.setPixelRatio(this.composer.renderer.getPixelRatio()),this.composer.renderer.getSize(e),this.composer.setSize(e.x,e.y),this.canvasSizeChanged=!1)}})()}add(...e){for(const t of e)this.addChild(n.Root,t)}remove(...e){for(const t of e)this.removeChild(n.Root,t)}addChild(e,t){switch(e){case n.Root:this.scene.add(t);break;case n.CameraRig:this.cameraRig.add(t);break;default:return!1}return!0}removeChild(e,t){switch(e){case n.Root:this.scene.remove(t);break;case n.CameraRig:this.cameraRig.remove(t);break;default:return!1}return!0}get camera(){return this.updateCameraRig(),this.cameraRig.camera}get effectComposer(){return this.composer}init(){this.cameraRig=new CameraRig(this.cameraData.aspect()),this.useEffectComposer&&Promise.all([i.e(525).then(i.bind(i,32903)),i.e(525).then(i.bind(i,86426))]).then((([e,t])=>{this.composer=new e.EffectComposer(this.threeRenderer),this.composer.addPass(new t.RenderPass(this.scene,this.cameraRig.camera)),this.cameraRigStale=!0})),this.cameraRigStale=!0}dispose(){this.cameraRig.dispose()}startRender(e){this.rendering=e}activate(e){this.scene.add(this.cameraRig),this.cameraDataCallback=()=>this.cameraRigStale=!0,this.cameraData.pose.onChanged(this.cameraDataCallback)}deactivate(e){this.scene.remove(this.cameraRig),this.cameraData.pose.removeOnChanged(this.cameraDataCallback)}beforeRender(){this.updateCameraRig(),this.updateComposer()}updateCameraRig(){this.cameraRigStale&&(this.cameraRig.update(this.cameraData.pose),this.cameraRigStale=!1)}render(e){this.rendering&&(this.composer?this.composer.render(e):(this.threeRenderer.clear(),this.threeRenderer.render(this.scene,this.cameraRig.camera)))}setCameraDirty(){this.cameraRigStale=!0,this.cameraRig.camera.updateProjectionMatrix()}onCanvasSizeChanged(){this.canvasSizeChanged=!0}}},15982:(e,t,i)=>{"use strict";i.d(t,{b:()=>GetScreenPositionCommand});var n=i(17386);class GetScreenPositionCommand extends n.m{constructor(e){super(),this.payload=Object.assign({},e)}}},35300:(e,t,i)=>{"use strict";i.d(t,{vx:()=>WebGLSupportException,Rg:()=>ContextLostException,Gw:()=>RendererCreationException});var n=i(31102);class WebGLSupportException extends n.y{constructor(e){super(e)}}class ContextLostException extends n.y{constructor(e){super(e)}}class RendererCreationException extends n.y{constructor(e){super(e)}}},84294:(e,t,i)=>{"use strict";i.r(t),i.d(t,{MAX_RESOLUTION:()=>w,default:()=>WebGLRendererModule});var n=i(47724),s=i(40168),r=i(67627),o=i(2212);const a={basicTextured:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:i(79826),fragmentShader:i(64715)},screenSpaceColored:{uniforms:{color:{type:"v3",value:new o.Vector3(0,0,0)},opacity:{type:"f",value:1}},vertexShader:i(55546),fragmentShader:i(96228)}};var l=i(35300),c=i(17838),d=i(48277);const h=(e,t)=>{switch(e){case d.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_X:t.set(0,-Math.PI/2,0);break;case d.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_X:t.set(0,Math.PI/2,0);break;case d.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Y:t.set(Math.PI/2,Math.PI,0);break;case d.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Y:t.set(-Math.PI/2,Math.PI,0);break;case d.Z.GL_TEXTURE_CUBE_MAP_POSITIVE_Z:t.set(0,-Math.PI,0);break;case d.Z.GL_TEXTURE_CUBE_MAP_NEGATIVE_Z:t.set(0,0,0)}},u={copyCubeMap:{uniforms:{tDiffuse:{type:"t",value:null},alpha:{type:"f",value:1}},vertexShader:i(28737),fragmentShader:i(93366)}};var p=i(56247);const m={0:[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0],1:[0,0,0,0,0,0,0,3e-6,229e-6,.005977,.060598,.24173,.382925,.24173,.060598,.005977,229e-6,3e-6,0,0,0,0,0,0,0],2:[0,0,1e-6,1e-5,78e-6,489e-6,.002403,.009245,.027835,.065591,.120978,.174666,.197413,.174666,.120978,.065591,.027835,.009245,.002403,489e-6,78e-6,1e-5,1e-6,0,0],3:[48e-6,169e-6,538e-6,.001532,.003907,.008921,.018247,.033432,.054867,.080658,.106212,.125283,.132372,.125283,.106212,.080658,.054867,.033432,.018247,.008921,.003907,.001532,538e-6,169e-6,48e-6],4:[.001133,.002316,.00445,.008033,.013627,.021724,.032542,.04581,.0606,.075333,.088001,.096603,.099654,.096603,.088001,.075333,.0606,.04581,.032542,.021724,.013627,.008033,.00445,.002316,.001133],5:[.004571,.00723,.010989,.016048,.022521,.03037,.039354,.049003,.058632,.067411,.074476,.079066,.080657,.079066,.074476,.067411,.058632,.049003,.039354,.03037,.022521,.016048,.010989,.00723,.004571],6:[.009379,.012899,.017256,.022453,.028417,.034983,.041888,.048784,.055264,.060893,.065262,.068032,.068981,.068032,.065262,.060893,.055264,.048784,.041888,.034983,.028417,.022453,.017256,.012899,.009379],7:[.014185,.01793,.022207,.02695,.032045,.037335,.042622,.047676,.052254,.056116,.059048,.06088,.061504,.06088,.059048,.056116,.052254,.047676,.042622,.037335,.032045,.02695,.022207,.01793,.014185]};class CWFWebGLRenderer{constructor(e){this.threeRenderer=e,this.cachedSize=new o.Vector2,this.renderToCubeMap=(()=>{let e,t,i,n,s,r=!1;const l=.5;return(c,d,h,u,p,m,f,g,v,y,b,S,E,T,w,x)=>{r||(t=new o.OrthographicCamera(-.5,l,l,-.5,-200,200),t.position.z=150,e=new o.Scene,e.name="rttCube",e.add(t),i=new o.RawShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:a.basicTextured.vertexShader,fragmentShader:a.basicTextured.fragmentShader,depthWrite:!1,depthTest:!1,side:o.DoubleSide}),n=new o.PlaneBufferGeometry(1,1),s=new o.Mesh(n,i),s.position.z=0,e.add(s),r=!0);const _=n.getAttribute("uv");_.setUsage(o.DynamicDrawUsage),_.needsUpdate=!0;const M=_.array,O=p/h,A=m/u,C=f/h,P=g/u;M[0]=O,M[1]=A+P,M[2]=O+C,M[3]=A+P,M[4]=O,M[5]=A,M[6]=O+C,M[7]=A;const D=n.getAttribute("position");D.setUsage(o.DynamicDrawUsage),D.needsUpdate=!0;const N=D.array,I=v/d.width-l,L=y/d.height-l,R=b/d.width,k=S/d.height;N[0]=I,N[1]=L+k,N[3]=I+R,N[4]=L+k,N[6]=I,N[7]=L,N[9]=I+R,N[10]=L,i.uniforms.tDiffuse.value=c,i.blending=T||o.NoBlending,i.transparent=!!w,null==x&&(x=1),i.uniforms.alpha.value=x,d.viewport.set(0,0,d.width,d.height);const U=this.threeRenderer.getRenderTarget(),B=this.threeRenderer.autoClear,F=this.threeRenderer.xr.enabled;this.threeRenderer.xr.enabled=!1,this.threeRenderer.autoClear=!1,this.threeRenderer.setRenderTarget(d,E),this.threeRenderer.render(e,t),this.threeRenderer.setRenderTarget(U),this.threeRenderer.autoClear=B,this.threeRenderer.xr.enabled=F}})(),this.copyCubemap=(()=>{let e,t,i,n,s,r=!1;const a=new o.Euler,l=this;return(c,d,p,m,f)=>{if(!r){const a=2,l=a/2;t=new o.OrthographicCamera(-l,l,l,-l,0,200),t.position.set(0,0,0),e=new o.Scene,e.name="copyCube",e.add(t),i=new o.RawShaderMaterial({uniforms:{tDiffuse:{value:null},alpha:{value:1}},vertexShader:u.copyCubeMap.vertexShader,fragmentShader:u.copyCubeMap.fragmentShader,depthWrite:!1,depthTest:!1,side:o.DoubleSide}),n=new o.BoxGeometry(a,a,a),s=new o.Mesh(n,i),e.add(s),r=!0}const g=l.threeRenderer.getRenderTarget(),v=l.threeRenderer.autoClear,y=l.threeRenderer.xr.enabled;l.threeRenderer.xr.enabled=!1,l.threeRenderer.autoClear=!1;for(let n=0;n<6;n++)h(n,a),s.rotation.copy(a),s.matrixWorldNeedsUpdate=!0,s.updateMatrixWorld(!0),i.uniforms.tDiffuse.value=c,i.blending=p||o.NoBlending,i.transparent=!!m,null==f&&(f=1),i.uniforms.alpha.value=f,d.viewport.set(0,0,d.width,d.height),l.threeRenderer.setRenderTarget(d,n),l.threeRenderer.render(e,t);l.threeRenderer.setRenderTarget(g),l.threeRenderer.autoClear=v,l.threeRenderer.xr.enabled=y}})(),this.blurCubemap=(()=>{const e=e=>{const t=new o.WebGLCubeRenderTarget(e);return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,{renderTarget:t,cubeCamera:new o.CubeCamera(.1,1e3,t)}};class BlurCubeMesh extends o.Mesh{}const t={512:e(512)},i=new o.Scene,n=new BlurCubeMesh(new o.BoxGeometry(1,1,1));i.add(n);const s={};return(r,a,l=3,c=.005)=>{const d=a.renderTarget;t[d.width]||(t[d.width]=e(d.width)),n.material=function(e){if(!s[e]){const t=new o.RawShaderMaterial({uniforms:o.UniformsUtils.clone(p.Z.blurCube.uniforms),vertexShader:p.Z.blurCube.vertexShader,fragmentShader:p.Z.blurCube.fragmentShader,side:o.BackSide});t.defines={};const i=m[`${e}`];for(const[e,n]of i.entries())t.defines[`KERNEL_${e+1}`]=0===n||1===n?n.toFixed(1):n;s[e]=t}return s[e]}(l);const h=t[d.width];n.material.uniforms.map.value=r,n.material.uniforms.dir.value.set(c,0),h.cubeCamera.update(this.renderer,i),n.material.uniforms.map.value=h.renderTarget.texture,n.material.uniforms.dir.value.set(0,c),a.update(this.renderer,i)}})();try{const e=this.threeRenderer.getContext();this._maxCubemapSize=e.getParameter(e.MAX_CUBE_MAP_TEXTURE_SIZE),this._maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this._gpuInfo=(0,c.t)(e)}catch(e){throw new l.Gw("Unable to create a WebGL rendering context")}}get renderer(){return this.threeRenderer}get maxCubemapSize(){return this._maxCubemapSize}get maxTextureSize(){return this._maxTextureSize}get gpuInfo(){return this._gpuInfo}getSize(){return this.threeRenderer.getSize(this.cachedSize)}getPixelRatio(){return this.threeRenderer.getPixelRatio()}dispose(){this.threeRenderer.dispose()}initSizedTexture2D(e,t){const i=new o.DataTexture(null,e,e);return t&&Object.assign(i,t),this.threeRenderer.initTexture(i),i}initRenderTargetCube(e){const t=new o.WebGLCubeRenderTarget(e,{stencilBuffer:!1,depthBuffer:!1,generateMipmaps:!1});return t.texture.image={},t.texture.image.width=e,t.texture.image.height=e,t}uploadTexture2D(e,t,i,n){const s=new o.Texture;s.image=e,this.threeRenderer.copyTextureToTexture(new o.Vector2(i,n),s,t,0)}fence(e){return new Promise((function(t,i){const n=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);if(null===n)return i();e.flush();const s=()=>{switch(e.getSyncParameter(n,e.SYNC_STATUS)){case e.TIMEOUT_EXPIRED:return void setTimeout(s,0);case e.WAIT_FAILED:return void i();case e.SIGNALED:return e.deleteSync(n),void t();default:return void setTimeout(s,0)}};setTimeout(s,0)}))}}var f=i(59088),g=i(67790),v=i(84303),y=i(64323),b=i(48358);class ScreenOverlayMesh extends o.Mesh{constructor(e){super(new o.PlaneBufferGeometry(2,2,1,1),new o.RawShaderMaterial({uniforms:o.UniformsUtils.clone(a.screenSpaceColored.uniforms),vertexShader:a.screenSpaceColored.vertexShader,fragmentShader:a.screenSpaceColored.fragmentShader,transparent:!0,depthTest:!1,depthWrite:!1})),this._opacity=1,this.material.uniforms.color.value=new o.Color(e),this.renderOrder=b.z.colorOverlay,this.name="ScreenOverlayMesh"}set opacity(e){this.visible=e>0,this._opacity=e,this.material.uniforms.opacity.value=e}get opacity(){return this._opacity}dispose(){this.material.dispose(),this.geometry.dispose()}}class ScreenOverlayComponent{constructor(e,t){this.scene=e,this.cameraData=t}init(){this.blackoutOverlayMesh=new ScreenOverlayMesh(0)}dispose(){this.blackoutOverlayMesh.dispose()}render(e){this.blackoutOverlayMesh.opacity=this.cameraData.transition.blackoutProgress.value}activate(e){this.scene.addChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}deactivate(e){this.scene.removeChild(this.scene.ids.CameraRig,this.blackoutOverlayMesh)}}var S=i(27687),E=i(33874),T=i(15982);const w=3686400;class WebGLRendererModule extends n.Y{constructor(){super(...arguments),this.name="webgl-renderer",this.contextLostError=null,this.setContextLostError=e=>{this.contextLostError=e},this.getPixelRatioFor=(e,t)=>{const i=window.devicePixelRatio||1;return e*t*i<=w?i:1}}async init(e,t){if(!("WebGLRenderingContext"in window))throw new l.vx("WebGL not supported");let i;this.canvas=e.canvas,this.engine=t;try{const t={canvas:this.canvas,antialias:e.antialias,alpha:!0,powerPreference:"high-performance"};i=e.useWebGL2?new o.WebGLRenderer(t):new o.WebGL1Renderer(t),i.autoClear=!1,i.xr.enabled=!0}catch(e){throw new l.Gw("Unable to create a WebGL rendering context")}i.setOpaqueSort(this.painterSortStable),this._cwfRenderer=new CWFWebGLRenderer(i),[this.cameraData,this.settingsData]=await Promise.all([t.market.waitForData(f.M_),t.market.waitForData(E.e)]);const n=new o.Scene;n.name="main",this.scene=new r.Z(n,i,this.cameraData,e.useEffectComposer),t.addComponent(this,this.scene),t.addComponent(this,new ScreenOverlayComponent(this.scene,this.cameraData));const a=await t.market.waitForData(s.W);this.setSize(a.width,a.height),this.bindings.push(t.subscribe(g.a,(e=>this.setSize(e.width,e.height))),t.commandBinder.addBinding(T.b,(async e=>(0,S.q9)(this.cameraData,e.worldPosition).screenPosition))),this.webGlMemoryTracker=i.getContext().getExtension("GMAN_webgl_memory"),this.webGlMemoryTracker||this.log.warn("Unable to find WebGL memory tracker!"),this.canvas.addEventListener("webglcontextlost",this.setContextLostError)}dispose(e){super.dispose(e),this.canvas.removeEventListener("webglcontextlost",this.setContextLostError)}onUpdate(e){if(this.contextLostError)throw new l.Rg(`WebGL context lost: ${this.contextLostError.statusMessage||"no status given"}`)}get gpuInfo(){return this._cwfRenderer.gpuInfo}get maxCubemapSize(){return this._cwfRenderer.maxCubemapSize}get maxTextureSize(){return this._cwfRenderer.maxTextureSize}get maxVaryings(){return this._cwfRenderer.renderer.capabilities.maxVaryings}getScene(){return this.scene}getCamera(){return this.scene.camera}get cwfRenderer(){return this._cwfRenderer}get textureManager(){return this._cwfRenderer}get threeRenderer(){return this.cwfRenderer.renderer}async renderOnce(){return this.scene.startRender(!0),this.engine.after(v.A.Render).then((()=>this.scene.startRender(!1)))}startRender(e=!0){this.scene.startRender(e),this.engine.broadcast(new y.V(this.cwfRenderer.getPixelRatio()))}setSize(e,t){const i=this.getPixelRatioFor(e,t);i!==this.cwfRenderer.getPixelRatio()&&(this.log.debug(`Setting pixel ratio to ${i}`),this.engine.broadcast(new y.V(i))),this.threeRenderer.xr.isPresenting&&this.log.error("setting size while in xr is a no no, it resets the viewport",e,t),this.threeRenderer.setPixelRatio(i),this.threeRenderer.setSize(e,t,!1),this.scene.setCameraDirty()}supportsInstancing(){const{threeRenderer:e,settingsData:t}=this;return!t.checkUrlParam("noInstancing",1,0)&&(e.capabilities.isWebGL2||e.extensions.has("ANGLE_instanced_arrays"))}getCapabilities(){const{capabilities:e,extensions:t}=this.threeRenderer,i=e.isWebGL2;let n=!1;try{n=!!document.createElement("canvas").getContext("webgl2")}catch(e){}return{gl_v2:n,gl_max_textures:e.maxTextures,gl_max_texture_size:e.maxTextureSize,gl_max_cubemap_size:e.maxCubemapSize,gl_instancing:this.supportsInstancing(),gl_oes_texture_float:i||t.has("OES_texture_float"),gl_oes_texture_half_float:i||t.has("OES_texture_half_float"),gl_depth_texture:i||t.has("WEBGL_depth_texture"),gl_draw_buffers:i||t.has("WEBGL_draw_buffers"),gl_oes_fbo_render_mip_map:i||t.has("OES_fbo_render_mipmap"),gl_shader_texture_lod:i||t.has("EXT_shader_texture_lod"),gl_oes_vertex_array_obj:i||t.has("OES_vertex_array_object"),gl_ovr_multi_view:i&&t.has("OVR_multiview2"),gl_color_buffer_float:i&&t.has("EXT_color_buffer_float"),gl_astc_supported:t.has("WEBGL_compressed_texture_astc"),gl_etc1_supported:t.has("WEBGL_compressed_texture_etc1"),gl_etc2_supported:t.has("WEBGL_compressed_texture_etc"),gl_dxt_supported:t.has("WEBGL_compressed_texture_s3tc"),gl_bptc_supported:t.has("EXT_texture_compression_bptc"),gl_pvrtc_supported:t.has("WEBGL_compressed_texture_pvrtc")||t.has("WEBKIT_WEBGL_compressed_texture_pvrtc")}}estimatedGPUMemoryAllocated(){if(this.webGlMemoryTracker){return this.webGlMemoryTracker.getMemoryInfo().memory.total}return-1}painterSortStable(e,t){if(e.groupOrder!==t.groupOrder)return e.groupOrder-t.groupOrder;if(e.renderOrder!==t.renderOrder)return e.renderOrder-t.renderOrder;if(e.program!==t.program)return e.program.id-t.program.id;if(e.material.id!==t.material.id)return e.material.id-t.material.id;if(e.object.getSortKey&&t.object.getSortKey){const i=e.object.getSortKey()-t.object.getSortKey();if(0!==i)return i}return e.z!==t.z?e.z-t.z:e.id-t.id}}},64323:(e,t,i)=>{"use strict";i.d(t,{V:()=>PixelRatioChangedMessage});var n=i(91466);class PixelRatioChangedMessage extends n.v{constructor(e){super(),this.pixelRatio=e}}},1630:(e,t,i)=>{"use strict";i.d(t,{j:()=>XRSessionRequestCommand});var n=i(17386);class XRSessionRequestCommand extends n.m{constructor(e){super(),this.id="XR_PRESENT",this.payload=Object.assign({},e)}}},7855:(e,t,i)=>{"use strict";i.d(t,{hX:()=>a,pl:()=>l,bk:()=>n});var n,s=i(60771),r=i(42472),o=i(25138);!function(e){e.webxr="webxr",e.unsupported="unsupported"}(n||(n={}));const a=e=>{const t=e.tryGetProperty("is_vr",!1),i=e.tryGetProperty(o.sX,!1),n=e.tryGetProperty("vr",1);return t&&!(!n||2===n&&!(0,s.Dt)())&&!i},l=async()=>{const e=await r.Z.isSessionSupported("immersive-vr");return r.Z.likelySupportsControllers()&&e?n.webxr:n.unsupported}},42472:(e,t,i)=>{"use strict";i.d(t,{Z:()=>a});var n=i(88512),s=i(60771);const r=new n.Z("vr-platform-select"),o=()=>{const e="xr"in navigator&&"isSessionSupported"in navigator.xr&&"requestSession"in navigator.xr;return window.isSecureContext&&e},a={isSessionSupported:async(e="immersive-vr")=>{let t=!1;if(o())try{t=await navigator.xr.isSessionSupported(e)}catch(e){r.info("WebXR disabled",e)}return r.debug(`WebXR session type: ${e} supported: ${t}`),t},likelySupportsControllers:()=>window.isSecureContext&&((0,s.Ot)()||!(0,s.tq)()),apiExists:o}},24285:(e,t,i)=>{"use strict";i.d(t,{Z:()=>ZoomMessage});var n=i(91466);class ZoomMessage extends n.v{constructor(e){super(),this.zoomLevel=e}}},21499:(e,t,i)=>{"use strict";i.d(t,{bj:()=>ZoomInCommand,KB:()=>ZoomOutCommand,ob:()=>ZoomResetCommand,_N:()=>ZoomGetMaxCommand,ts:()=>ZoomSetCommand});var n=i(17386);class ZoomInCommand extends n.m{constructor(e){super(),this.payload={step:e}}}ZoomInCommand.id="ZOOM_IN";class ZoomOutCommand extends n.m{constructor(e){super(),this.payload={step:e}}}ZoomOutCommand.id="ZOOM_OUT";class ZoomResetCommand extends n.m{}ZoomResetCommand.id="ZOOM_RESET";class ZoomGetMaxCommand extends n.m{}ZoomGetMaxCommand.id="ZOOM_MAX_VALUE";class ZoomSetCommand extends n.m{constructor(e){super(),this.payload={value:e}}}ZoomSetCommand.id="ZOOM_SET"},31657:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>ZoomControls});var n=i(47724),s=i(96909),r=i(81040),o=i(38022),a=i(88727),l=i(81507),c=i(88216),d=i(59088),h=i(63560),u=i(35597),p=i(75892),m=i(27408),f=i(7170),g=i(36371);const v=.1,y=.7,b=2,S=3,E=1.1;var T=i(21499),w=i(24285),x=i(34369);class ZoomControls extends n.Y{constructor(){super(...arguments),this.name="zoom-controls",this.uhQuality={},this.config={enabled:!0,tiles:!0}}async init(e,t){if(this.config.enabled=!!e.enabled,this.config.tiles=!!e.tiles,this.config.tiles)try{this.sweepTilingModule=await t.getModuleBySymbol(s.y.SWEEP_PANO)}catch(e){this.log.debug(`Tiling not enabled for zoom controls - ${e}`)}this.config.enabled&&await this.registerControls(t),this.engine=t,this.cameraModule=await t.getModuleBySymbol(s.y.CAMERA),this.cameraData=await t.market.waitForData(d.M_),this.viewmodeData=await t.market.waitForData(u.O),this.sweepData=await t.market.waitForData(p.Z),this.bindings.push(t.commandBinder.addBinding(T.bj,(async e=>this.zoomBy(e.step))),t.commandBinder.addBinding(T.KB,(async e=>this.zoomBy(-e.step))),t.commandBinder.addBinding(T.ob,(async()=>this.zoomTo(1))),t.commandBinder.addBinding(T.ts,(async e=>this.zoomTo(e.value))),t.commandBinder.addBinding(T._N,this.getMaxZoomAvailable.bind(this)))}async registerControls(e){e.getModuleBySymbol(s.y.INPUT).then((e=>{this.bindings.push(e.registerHandler(r.a,(e=>this.zoomByInput(this.scrollToZoomDelta(e))))),this.bindings.push(e.registerHandler(o.G,(e=>this.zoomByInput(this.pinchToZoomDelta(e))))),this.bindings.push(e.registerHandler(a.e,(e=>this.keyHandler(e))))}))}zoomTo(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweepObject;if(this.config.tiles&&this.checkTilingZoomLevels(e,i),(e=(0,m.uZ)(e,y,S))!==t){const t=(0,f.ZY)(this.cameraData.baseFovY/e),i=h.oR.near,n=h.oR.far;this.cameraModule.updateCameraProjection((new g.M).makePerspectiveFov(t,this.cameraData.aspect(),i,n))}return this.engine.broadcast(new w.Z(e)),e}checkTilingZoomLevels(e,t){e>=E&&this.zoomedSweep!==t?(this.zoomedSweep=t,this.sweepTilingModule.enableZooming(!0,t).then((e=>{e?this.uhQuality[t.id]=!0:(this.uhQuality[t.id]=!1,this.zoomedSweep=void 0)}))):e<E&&this.zoomedSweep&&this.zoomedSweep===t&&(this.sweepTilingModule.enableZooming(!1,this.zoomedSweep),this.zoomedSweep=void 0)}getMaxZoom(e){return this.uhQuality[e]?S:b}zoomBy(e){const t=this.cameraData.zoom();return this.validateViewmode()?this.zoomTo(t+e):t}validateViewmode(){return this.viewmodeData.isInside()&&this.cameraData.canTransition()}scrollToZoomDelta(e){return-Math.sign(e.delta.y)*v}pinchToZoomDelta(e){return e.pinchDelta*(b-y)}zoomByInput(e){const t=this.cameraData.zoom();if(!this.validateViewmode())return t;const i=this.sweepData.currentSweep,n=(0,m.uZ)(t+e,y,this.getMaxZoom(i));return this.zoomTo(n)}keyHandler(e){if(e.state===c.M.DOWN)switch(e.key){case l.R.PLUSEQUALS:this.zoomByInput(v);break;case l.R.DASHUNDERSCORE:this.zoomByInput(-v);break;case l.R.OPENBRACKET:this.zoomTo(1)}}async getMaxZoomAvailable(){if(!this.sweepData.currentSweepObject)return b;const e=this.sweepData.currentSweepObject;return await this.sweepTilingModule.availableResolution(e,x.SL.ULTRAHIGH)>=x.SL.ULTRAHIGH?S:b}}},15443:(e,t,i)=>{"use strict";i.d(t,{Y:()=>n});const n={Navigation:Symbol("Navigation"),Octree:Symbol("Octree"),PanoTiles:Symbol("PanoTiles"),Raycaster:Symbol("Raycaster"),Snapping:Symbol("Snapping"),StreamingTexture:Symbol("StreamingTexture"),StreamingMesh:Symbol("StreamingMesh")}},26128:(e,t,i)=>{"use strict";i.d(t,{em:()=>SymbolMessage,bc:()=>SymbolBind,z4:()=>SymbolUnbind,PD:()=>l});var n=i(91466),s=i(17490),r=i(44283);const o=new(i(88512).Z)("symbols"),a=[];class SymbolMessage extends n.v{constructor(e){super(),this.symbol=e}}class SymbolBind extends n.v{constructor(e){super(),this.payload=e}}class SymbolUnbind extends n.v{constructor(e){super(),this.payload=e}}function l(e){return new s.V((0,r.k1)((()=>null),(()=>a.length=0)),e.messageBus.subscribe(SymbolBind,(e=>{a.push(e.payload)})),e.messageBus.subscribe(SymbolUnbind,(e=>{const t=a.findIndex((t=>t.symbol===e.payload.symbol&&t.callback===e.payload.callback));t>=0&&a.splice(t,1)})),e.messageBus.subscribe(SymbolMessage,(e=>{a.forEach((t=>{if(t.symbol===e.symbol)try{t.callback()}catch(t){o.warn("Error handling SymbolMessage",e,t)}}))})))}},67078:(e,t,i)=>{"use strict";i.d(t,{b:()=>AdaptiveRawShaderMaterial});var n=i(2212);class AdaptiveRawShaderMaterial extends n.RawShaderMaterial{onBeforeCompile(e,t){super.onBeforeCompile(e,t),t.capabilities.isWebGL2&&this.glslVersion!==n.GLSL3&&(e.glslVersion=n.GLSL3,e.vertexShader=s+e.vertexShader,e.fragmentShader=r+e.fragmentShader)}}const s="\n#define attribute in\n#define varying out\n#define texture2D texture\n",r="\n#define varying in\nout highp vec4 pc_fragColor;\n#define gl_FragColor pc_fragColor\n#define gl_FragDepthEXT gl_FragDepth\n#define texture2D texture\n#define textureCube texture\n#define texture2DProj textureProj\n"},58232:(e,t,i)=>{"use strict";i.d(t,{P:()=>CircularBuffer});class CircularBuffer{constructor(e){this.size=e,this.index=0,this.buffer=[],this.sorted=!1}push(e){this.index>=this.size&&(this.index=0),this.buffer[this.index]=e,this.index++,this.sorted=!1}peek(){return this.buffer[this.index<=this.buffer.length?this.index-1:0]||null}getList(){return this.buffer}median(){const e=Math.floor(this.buffer.length/2);return this.sorted||this.buffer.sort(),this.buffer[e]}*[Symbol.iterator](){yield*this.buffer}clear(){this.buffer=[],this.index=0}}},24764:(e,t,i)=>{"use strict";i.d(t,{s:()=>Comparator});class Comparator{constructor(e){this.matcher=e}static isValue(e){return new Comparator(new ValueMatcher(e))}static isType(e){return new Comparator(new TypeMatcher(e))}static isInstanceOf(e){return new Comparator(new InstanceMatcher(e))}static is(e){return new Comparator(new PredicateMatcher(e))}static isAny(){return new Comparator(new AnyMatcher)}compare(e){return this.matcher.matches(e)}}class ValueMatcher{constructor(e){this.value=e}matches(e){return this.value===e}}class TypeMatcher{constructor(e){this.type=e}matches(e){return Object.getPrototypeOf(e).constructor===this.type}}class InstanceMatcher{constructor(e){this.type=e}matches(e){if("object"==typeof e)return e instanceof this.type;const t=this.type;switch(typeof e){case"number":return t===Number;case"string":return t===String;case"boolean":return t===Boolean;case"function":return t===Function}return!1}}class PredicateMatcher{constructor(e){this.predicate=e}matches(e){return this.predicate(e)}}class AnyMatcher{constructor(){}matches(){return!0}}},77680:(e,t,i)=>{"use strict";i.d(t,{s:()=>l,n:()=>ExpiringResource});var n=i(10757),s=i(88512),r=i(71918),o=i(64185);const a=new s.Z("expiring-resource");function l(e,t){(0,r.y)(e,(e=>{e instanceof ExpiringResource&&(e.onStale=t)}))}class ExpiringResource{constructor(e,t){this.value=e,this.validUntil=t}refreshFrom(e){this.value=e.value,this.validUntil=e.validUntil,this.refreshPromise&&(this.refreshPromise.resolve(),this.refreshPromise=void 0)}waitForRefresh(e=1e4){this.refreshPromise||(this.refreshPromise=new o.Q);const t=(0,n.gw)(e).then((()=>{throw new Error("Waiting for resource url refresh timed out")}));return Promise.race([this.refreshPromise.nativePromise(),t])}async get(){if(this.validUntil&&this.onStale){const e=Date.now();e+6e4+1e4>this.validUntil.getTime()&&this.onStale(),e+6e4+1e3>this.validUntil.getTime()&&(a.warn("Stale resource, waiting for refresh"),await this.waitForRefresh(),a.info("Refreshed resource"))}return this.value}}},49399:(e,t,i)=>{"use strict";i.d(t,{ZP:()=>LineOctree,FM:()=>SnapLine3,UQ:()=>SnapVector3});var n=i(2212);class LineOctreeNode{constructor(e,t){this.raycast=(()=>{const e=new n.Vector3,t=new n.Box3;return(i,n,s,r)=>{const o=t.copy(this.bounds).expandByScalar(n);if(i.ray.intersectsBox(o))for(const t of this.children)if(t instanceof LineOctreeNode)t.raycast(i,n,s,r);else if(t instanceof SnapLine3){if(!1===(null==r?void 0:r(t)))continue;const o=e,a=i.ray.distanceSqToSegment(t.start,t.end,void 0,e),l=Math.sqrt(a);l<n&&s.push({distance:i.ray.origin.distanceTo(o),object:t,distanceToRay:l,point:o.clone(),isLineOctreeIntersection:!0})}else if(t instanceof SnapVector3){if(!1===(null==r?void 0:r(t)))continue;const e=i.ray.distanceToPoint(t);e<n&&s.push({distance:i.ray.origin.distanceTo(t),object:t,distanceToRay:e,point:t.clone(),isLineOctreeIntersection:!0})}}})(),this.level=t,this.bounds=e.clone(),this.childNodes=[],this.children=[]}add(e){let t=!1;const i=e instanceof n.Line3?[e.start,e.end]:[e];if(this.level<4){0===this.childNodes.length&&this.buildChildNodes();for(const n of this.childNodes)i.every((e=>n.bounds.containsPoint(e)))&&(t=!0,n.add(e))}t||this.children.push(e)}remove(e){const t=e instanceof n.Line3?[e.start,e.end]:[e];for(let i=0;i<this.children.length;i++){const n=this.children[i];if(n instanceof LineOctreeNode){if(t.every((e=>n.bounds.containsPoint(e)))&&n.remove(e))return!0}else if(n===e)return this.children.splice(i,1),!0}return!1}buildChildNodes(){const e=this.bounds.max.clone().sub(this.bounds.min).clone().multiplyScalar(.5);for(let t=0;t<2;t++)for(let i=0;i<2;i++)for(let s=0;s<2;s++){const r=this.bounds.min.x+e.x*s,o=r+e.x,a=this.bounds.min.y+e.y*t,l=a+e.y,c=this.bounds.min.z+e.z*i,d=c+e.z,h=new n.Box3(new n.Vector3(r,a,c),new n.Vector3(o,l,d)),u=new LineOctreeNode(h,this.level+1);this.childNodes.push(u),this.children.push(u)}}spherecast(e,t){if(e.intersectsBox(this.bounds))for(const i of this.children)if(i instanceof LineOctreeNode)i.spherecast(e,t);else if(i instanceof SnapLine3){const s=i.closestPointToPoint(e.center,!0,new n.Vector3);s.distanceTo(e.center)<e.radius&&t.push(new SnapVector3(s))}else i instanceof n.Vector3&&i.distanceTo(e.center)<e.radius&&t.push(i)}traverse(e){for(const t of this.children)t instanceof LineOctreeNode?t.traverse(e):e(t)}}class LineOctree{constructor(e){this.pointCount=0,this.lineCount=0,this.root=new LineOctreeNode(e,0)}add(e){e instanceof n.Line3?this.lineCount++:e instanceof n.Vector3&&this.pointCount++,this.root.add(e)}remove(e){e instanceof SnapLine3?this.lineCount--:e instanceof SnapVector3&&this.pointCount--,this.root.remove(e)}traverse(e){this.root.traverse(e)}raycast(e,t,i){const n=[];return this.root.raycast(e,t,n,i),n}}class SnapLine3 extends n.Line3{constructor(e,t){super(e,t),this.start=e,this.end=t,this.isSnapLine3=!0}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}clone(){return new SnapLine3(this.start,this.end)}}class SnapVector3 extends n.Vector3{constructor(e){super(),this.point=e,this.isSnapVector3=!0,super.copy(e)}copy(e){return this.point.copy(e.point),this}clone(){return new SnapVector3(this.point)}}},43973:(e,t,i)=>{"use strict";i.d(t,{H:()=>Lock});class Lock{constructor(){this.activePromise=Promise.resolve(new Key)}async lock(){const e=new Promise((async e=>{(await this.activePromise).onUnlock((()=>e(new Key)))})),t=this.activePromise;return this.activePromise=e,t}}class Key{onUnlock(e){this.unlockCB=e}unlock(){this.unlockCB()}}},69626:(e,t,i)=>{"use strict";i.d(t,{Pp:()=>l,s1:()=>c,r0:()=>d,m$:()=>h,D7:()=>u,Ll:()=>p,n0:()=>m,fd:()=>f,Fe:()=>g,YN:()=>v,k2:()=>y,mY:()=>b,_U:()=>S,S3:()=>E,J2:()=>T});var n=i(2212),s=i(36371),r=i(12216),o=i(66363),a=i(68524);const l=e=>!!e&&1===e.elements[15],c=e=>!!e&&(e.elements[15]>0&&e.elements[15]<1),d=((()=>{const e=new n.Object3D,t=new n.Vector3})(),(()=>{const e=new n.Vector3;return(t,i,n,s)=>(e.copy(t).sub(i),e.clampLength(n,s),i.clone().add(e))})()),h=(()=>{const e=new n.Vector3;return(t,i,n,s)=>{e.copy(i).sub(t);const r=Math.atan2(Math.sqrt(Math.pow(e.x,2)+Math.pow(e.z,2)),e.y),o=Math.min(Math.max(n,r),s);return Math.abs(r-o)>Number.EPSILON?u(t,i,r-o,!1):t}})(),u=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,n,s,o)=>(e.copy(n).sub(i),o?t.copy(r.f.UP):t.copy(e).applyAxisAngle(r.f.UP,-1*Math.PI/2).setY(0).normalize(),e.applyAxisAngle(t,s),n.clone().sub(e))})(),p=(()=>{const e=new n.Vector3,t=new n.Vector3;return(i,s,r)=>(e.copy(i).sub(s).normalize(),t.copy(i).sub(r).normalize(),(new n.Quaternion).setFromUnitVectors(e,t))})(),m=(()=>{const e=new s.M;return(t,i)=>(e.setPosition(t),e.lookAt(t,i,r.f.UP),(new n.Quaternion).setFromRotationMatrix(e.asThreeMatrix4()))})(),f=(()=>{const e=new n.Vector3;return(t,i,n)=>(e.copy(r.f.FORWARD).applyQuaternion(t).normalize(),e.clone().multiplyScalar(-1*n).add(i))})(),g=(()=>{const e=new n.Ray,t=new n.Vector3,i=new n.Vector3;return(n,s,o)=>(i.set(0,0,0),t.copy(r.f.FORWARD).applyQuaternion(s),e.set(n,t),e.intersectPlane(o,i))})(),v=(()=>{const e=new n.Vector3,t=new n.Vector3,i=new n.Vector3,s=new n.Vector3,o=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3],a=new n.Vector3,l=new n.Vector3,c=new n.Vector3,d=new n.Vector3,h=new n.Plane,u=new n.Vector3,p=new n.Ray,f=new n.Vector3,g=new n.Vector3;return(n,v,y,b,S,E)=>{e.copy(r.f.FORWARD).applyQuaternion(v).setY(0),t.copy(e).setY(y).normalize(),s.copy(t).applyAxisAngle(r.f.UP,-Math.PI/2).setY(0).normalize(),i.copy(s).cross(t).normalize();let T=0;const w=b.max,x=b.min,_=[w,x];for(let e=0;e<2;e++){const t=_[e].x;for(let e=0;e<2;e++){const i=_[e].y;for(let e=0;e<2;e++){const n=_[e].z;o[T].set(t,i,n),T++}}}a.copy(x),c.copy(n).setY(x.y);let M=l.copy(a).sub(c).dot(t);o.forEach((e=>{if(e.y===w.y)return;const i=l.copy(e).sub(c).dot(t);i<M&&(a.copy(e),M=i)}));const O=Math.sign(a.dot(s));d.copy(a).setX(a.x===w.x?x.x:w.x),Math.sign(d.dot(s))!==O?h.set(u.set(0,0,-1*Math.sign(a.z)),Math.abs(a.z)):(d.copy(a).setZ(a.z===w.z?x.z:w.z),h.set(u.set(-1*Math.sign(a.x),0,0),Math.abs(a.x))),p.set(n,f.copy(t).multiplyScalar(-1)),p.intersectPlane(h,g);const A=Math.min(Math.abs(g&&g.dot(t)),M);let C=0,P=0;o.forEach((function(e){l.copy(e).sub(n);const t=Math.abs(l.dot(s)),r=Math.abs(l.dot(i));t>C&&(C=t),r>P&&(P=r)}));const D=C/Math.tan(S*E/2),N=P/Math.tan(S/2),I=Math.max(D,N)+Math.abs(A),L=n.clone().add(t.clone().multiplyScalar(1.1*-I));return{position:L,rotation:m(L,n)}}})(),y=((()=>{const e=new n.Matrix4})(),(()=>{const e=new n.Matrix4,t=new n.Vector4})(),(()=>{const e=new n.Vector3;return(t,i,n=r.f.UP)=>{const s=t.angleTo(i);return Math.sign(e.crossVectors(t,i).dot(n))*s}})()),b=((()=>{const e=new s.M,t=new n.Vector3})(),(e,t,i,n,s=1.5)=>{const r=1/e.elements[5];if(l(e))return s*n/(2*r);const o=t.distanceTo(i),a=Math.atan(r);return n*(s/(2*Math.tan(a)*o))}),S=function(){const e=new n.Vector3,t=new n.Matrix4;return(i,n,s)=>{const r=e.set(0,0,-i).applyMatrix4(n).z;return t.copy(n),t.invert(),e.set(2/s,0,r).applyMatrix4(t),e.x}}(),E=e=>1/e.elements[5],T=(()=>{const e=new n.Vector3;return(t,i,n)=>{const s=n.angleTo(r.f.UP),o=Math.abs(s-Math.PI);return s<.2||o<.2?(t.quaternion.setFromUnitVectors(r.f.FORWARD,n),!0):(t.lookAt(e.copy(i).add(n)),!1)}})();(()=>{const e=new n.Vector3,t=new n.Vector3(1e4,1e4,1e4),i=[new n.Line3,new n.Line3,new n.Line3,new n.Line3],s=[new n.Vector3,new n.Vector3,new n.Vector3,new n.Vector3]})()},44382:(e,t,i)=>{"use strict";i.d(t,{mB:()=>n});const n=e=>!e||!Object.values(e).filter((e=>0!==e)).length},7170:(e,t,i)=>{"use strict";i.d(t,{Ue:()=>n,MN:()=>s,Id:()=>r,ZY:()=>o});const n=Math.PI/180,s=180/Math.PI;function r(e){return e*n}function o(e){return e*s}},27408:(e,t,i)=>{"use strict";i.d(t,{uZ:()=>n});const n=function(e,t,i){return Math.max(t,Math.min(e,i))}},66363:(e,t,i)=>{"use strict";i.d(t,{r6:()=>n,wo:()=>s});const n=(e,t,i=1e-5)=>Math.abs(e-t)<=i,s=(e,t,i=1e-5)=>((e,t,i=1e-5)=>n(e.x,t.x,i)&&n(e.y,t.y,i))(e,t,i)&&n(e.z,t.z,i)},8482:(e,t,i)=>{"use strict";function n(e,t,i){return(1-i)*e+i*t}i.d(t,{t:()=>n})},19674:(e,t,i)=>{"use strict";i.d(t,{ep:()=>d,tf:()=>h,r_:()=>u,zW:()=>p,cb:()=>m,rj:()=>f,jB:()=>g,et:()=>v,dS:()=>y,Z:()=>S,Rq:()=>E,Xe:()=>T,Xv:()=>w});var n=i(2212),s=i(36371),r=i(12216),o=i(27408),a=i(7170);const l=new n.Frustum,c=new s.M;new n.Sphere;var d;!function(e){e.fromVisionVector=function(e){return new n.Vector3(e.x,e.z,-e.y)},e.toVisionVector=function(e){return new n.Vector3(e.x,-e.z,e.y)},e.fromVisionQuaternion=function(e){return new n.Quaternion(e.x,e.z,-e.y,e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),(0,a.Id)(90)))},e.fromVisionCameraQuaternion=function(e){return new n.Quaternion(-e.x,-e.z,e.y,-e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(1,0,0),(0,a.Id)(90)))},e.toVisionQuaternion=function(e){const t=new n.Quaternion(e.x,e.y,e.z,e.w).multiply((new n.Quaternion).setFromAxisAngle(new n.Vector3(0,1,0),(0,a.Id)(-90)));return t.set(t.x,-t.z,t.y,t.w),t},e.toVisionCameraQuaternion=function(e){return new n.Quaternion(e.x,-e.z,e.y,e.w).multiply(new n.Quaternion(-.70710678118,0,0,.70710678118))}}(d||(d={}));const h=function(e){return Math.cos((0,a.Id)(e/2))};function u(e,t,i){return Math.abs(t-e)<=i?t:e+Math.sign(t-e)*i}const p=function(e,t){const i=new n.Vector3(0,0,-1);return i.clone().applyQuaternion(e).angleTo(i.clone().applyQuaternion(t))},m=(e,t,i,n)=>(c.identity().makeRotationFromQuaternion(t).setPosition(e),c.getInverse(c),c.premultiply(i),l.setFromProjectionMatrix(c.asThreeMatrix4()),l.intersectsBox(n)),f=e=>{const t=e.getSize(new n.Vector3),i=Math.max(t.x,t.y,t.z);return(new n.Box3).setFromCenterAndSize(e.getCenter(new n.Vector3),new n.Vector3(i,i,i))},g=(e,t)=>{if(t.length<8)throw new Error("getPointsFromBox3: Result array to small!");t[0].copy(e.min),t[1].copy(e.min),t[1].x=e.max.x,t[2].copy(e.min),t[2].y=e.max.y,t[3].copy(e.min),t[3].z=e.max.z,t[4].copy(e.max),t[5].copy(e.max),t[5].x=e.min.x,t[6].copy(e.max),t[6].y=e.min.y,t[7].copy(e.max),t[7].z=e.min.z},v=(e,t,i,n,s)=>(s-n)*((e-t)/(i-t))+n,y=(e,t,i,n,s)=>{const r=v(e,t,i,n,s);return(0,o.uZ)(r,n,s)};function b(e){return 0===e.x&&0===e.y&&0===e.z}const S=(()=>{const e=new n.Vector3,t=new n.Matrix4;return i=>b(i)?i.clone():(e.copy(r.f.FORWARD).applyQuaternion(i),t.lookAt(r.f.ZERO,e,r.f.UP),(new n.Quaternion).setFromRotationMatrix(t))})(),E=(()=>{const e=new n.Vector3,t=new n.Matrix4;return(i,n)=>b(i)?n.copy(i):(e.copy(r.f.FORWARD).applyQuaternion(i).setY(0).normalize(),t.lookAt(r.f.ZERO,e,r.f.UP),n.setFromRotationMatrix(t))})(),T=(()=>{const e=new n.Vector3,t=new n.Ray;return(i,s,r,o)=>(o=o||new n.Vector3,t.origin.copy(i),t.lookAt(s),o.copy(t.at(r,e)))})(),w=(()=>{const e=new n.Vector3,t=new n.Ray;return(i,s,r,o)=>(o=o||new n.Vector3,t.set(i,s),o.copy(t.at(r,e)))})()},9293:(e,t,i)=>{"use strict";i.d(t,{L:()=>ObjectPool});class ObjectPool{constructor(e){this.comparer=e||this.defaultComparer,this.poolArray=[]}add(e){const t=this.createObjectDescriptor(e);return t.object=e,t.inUse=!0,this.addObjectDescriptorToPool(t),t}get(e){for(const t of this.poolArray)if(!t.inUse&&this.comparer(t,e))return t.inUse=!0,t;return null}free(e){for(const t of this.poolArray)if(t.object===e)return t.inUse=!1,!0;return!1}all(){return this.poolArray}remove(e){const t=this.poolArray.findIndex((t=>t.object===e));return-1!==t&&(this.poolArray.splice(t,1),!0)}defaultComparer(e,t){return!0}createObjectDescriptor(e){return{object:e,inUse:!1}}addObjectDescriptorToPool(e){this.poolArray.push(e)}}},64185:(e,t,i)=>{"use strict";i.d(t,{Q:()=>OpenDeferred});class OpenDeferred{constructor(){this.base=new Promise(((e,t)=>{this.resolver=e,this.rejecter=t})),this._promise=new OpenPromise(this.base,this),this.progressCallbacks=[]}then(e,t){return this.base.then(e,t)}catch(e){return this.base.catch(e)}resolve(e){return this.resolver(e),this}reject(e){return this.rejecter(e),this}notify(e){for(const t of this.progressCallbacks)t(e)}progress(e){return this.progressCallbacks.push(e),this}promise(){return this._promise}nativePromise(){return this.base}static resolve(){const e=new OpenDeferred;return e.resolve(),e.promise()}static reject(e){const t=new OpenDeferred;return t.reject(e),t.promise()}static all(e){const t=[];for(const i of e)i.nativePromise?t.push(i.nativePromise()):t.push(i);const i=new OpenDeferred;return Promise.all(t).then((e=>i.resolve(e)),(e=>i.reject(e))),i.promise()}}class OpenPromise{constructor(e,t){this.basePromise=e,this.baseDeferred=t}then(e,t){return this.baseDeferred.then(e,t),this}catch(e){return this.baseDeferred.catch(e),this}progress(e){return this.baseDeferred.progress(e),this}nativePromise(){return this.basePromise}}},38493:(e,t,i)=>{"use strict";i.d(t,{Z:()=>OrderedMap});const n=e=>""+e;class OrderedMap{constructor(e=n){this.mappingFunction=e,this.list=[],this.map={}}add(e){const t=this.mappingFunction(e);return!this.map[t]&&(this.list.push(e),this.map[t]=e,!0)}set(e){const t=this.mappingFunction(e);return this.map[t]?(this.map[t]=e,!0):(this.add(e),!0)}count(){return this.list.length}*[Symbol.iterator](){for(const e of this.list)yield e}getByIndex(e){return this.list[e]}get(e){return this.map[e]}copyToList(e){return e.push.apply(e,this.list),e}clear(){this.list=[],this.map={}}mapElements(e){return this.list.map(e)}}},17486:(e,t,i)=>{"use strict";i.d(t,{a:()=>PersistentStorage});class VariableContainer{constructor(e){this._value=e}value(){return this._value}set(e){this._value=e}}class PersistentStorage{constructor(){this.storage={}}get(e,t){let i=this.storage[e];return i||(i=t(),this.storage[e]=i),i}getNumber(e){return this.get(e,(()=>new VariableContainer(0)))}getString(e){return this.get(e,(()=>new VariableContainer("")))}getArray(e){return this.get(e,(()=>[]))}getNumberMap(e){return this.get(e,(()=>({})))}getStringMap(e){return this.get(e,(()=>({})))}}},87324:(e,t,i)=>{"use strict";function n(e){return{x:e.x,y:e.y,z:e.z}}function s(e){return{x:e.x||e._x,y:e.y||e._y,z:e.z||e._z,w:e.w||e._w}}i.d(t,{m:()=>n,J5:()=>s})},53225:(e,t,i)=>{"use strict";i.d(t,{E:()=>TypedMesh});var n=i(2212);class TypedMesh extends n.Mesh{constructor(e,t){super(e,t)}}},17131:(e,t,i)=>{"use strict";i.d(t,{z:()=>AnimatedNumber});var n=i(79437),s=i(23573);const r=new(i(88512).Z)("animation");class AnimatedNumber extends s.T{constructor(e,t,i,s=n.vG,r=0){super(),this._easing=n.vG,void 0===t&&(t=e),void 0===i&&(this._active=!1,i=0,this._elapsed=0,this._duration=0),this.modifyAnimation(e,t,i,s,0,r)}get active(){return this._active}get duration(){return this._duration}get endValue(){return this._endValue}get easing(){return this._easing}get elapsed(){return this._elapsed}get delay(){return this._delay}tick(e){if(!this._active)return this.endValue;if(this._delay>0)return this._delay-=e,this.startValue;const t=(this._elapsed+e)/Math.max(this._duration,1e-5);return this.updateProgress(t),this.value}updateProgress(e){if(isNaN(e))return void r.error(`Invalid progress value: ${e}`);const t=Math.max(0,Math.min(e,1)),i=this.active,n=this.value;if(t>=1)return this.activate(!1),this.value=this._easing(1,this.startValue,this._endValue-this.startValue,1),this._elapsed=this.duration,this.commit(),void(this._onComplete&&this._onComplete());this.activate(!0),this.value=this._easing(t,this.startValue,this._endValue-this.startValue,1),this._elapsed=t*this.duration,n===this.value&&i===this.active||this.commit()}updateAbsolute(e){const t=e/Math.max(this._duration,1e-5);this.updateProgress(t)}modifyAnimation(e,t,i,s=n.vG,r=0,o=0){return this._easing=s,this._endValue=t,this._duration=i,this.activate(this._duration>=0&&e!==t),this._elapsed=r,this._delay=o,this.startValue=e,this.value=e,this.commit(),this}onComplete(e){return this._onComplete=e,this}activate(e){this._active=e}copy(e){this._endValue=e.endValue,this._duration=e.duration,this._active=e.active,this._easing=e.easing,this._elapsed=e.elapsed,this.startValue=e.startValue,this.value=e.value,this.commit()}clone(){const e=new AnimatedNumber(0);return e.copy(this),e}stop(e){this._active=!1,this._elapsed=this._duration,this.value=e,this._endValue=e,this.commit()}equals(e){return this._active===e._active&&this.duration===e.duration&&this.easing===e.easing&&this.elapsed===e.elapsed&&this.endValue===e.endValue&&this.startValue===e.startValue&&this.value===e.value}}},14063:(e,t,i)=>{"use strict";i.d(t,{b:()=>n});const n=(e,t)=>{if(0!==e.length)for(let i=0;i<e.length;i++){e[i]===t&&e.splice(i,1)}}},53931:(e,t,i)=>{"use strict";i.d(t,{g$:()=>n,LP:()=>s,lZ:()=>r});const n=16/9,s=1/n,r=function(e,t){return Math.min(Math.max(t/e,s),1)*e}},40732:(e,t,i)=>{"use strict";i.d(t,{h:()=>n,K:()=>s});class Heap{constructor(e){this.comparator=e,this.nodes=[]}push(e){return this.nodes.push(e),this.siftdown(0,this.nodes.length-1)}pop(){let e,t;return this.nodes.length&&(e=this.nodes.pop(),e)?(this.nodes.length?(t=this.nodes[0],this.nodes[0]=e,this.siftup(0)):t=e,t):null}peek(){return this.nodes[0]}contains(e){return-1!==this.nodes.indexOf(e)}replace(e){if(this.nodes.length){const t=this.nodes[0];return this.nodes[0]=e,this.siftup(0),t}return null}_pushpop(e,t,i){let n;const s=i||this.defaultCompare;return e.length&&s(e[0],t)<0&&(n=[e[0],t],t=n[0],e[0]=n[1],this._siftup(e,0,s)),t}pushpop(e){return this._pushpop(this.nodes,e,this.comparator)}_heapify(e,t){let i,n,s,r,o,a;const l=Math.floor(e.length/2),c=function(){for(a=[],s=0,o=l;0<=o?s<o:s>o;0<=o?s++:s--)a.push(s);return a}.apply(this).reverse(),d=[];for(n=0,r=c.length;n<r;n++)i=c[n],d.push(this._siftup(e,i,t));return d}heapify(){let e,t,i,n,s,r;const o=Math.floor(this.nodes.length/2),a=function(){for(r=[],i=0,s=o;0<=s?i<s:i>s;0<=s?i++:i--)r.push(i);return r}.apply(this).reverse(),l=[];for(t=0,n=a.length;t<n;t++)e=a[t],l.push(this.siftup(e));return l}updateItem(e){const t=this.nodes.indexOf(e);return-1===t?null:(this.siftdown(0,t),this.siftup(t))}clear(){return this.nodes=[]}empty(){return 0===this.nodes.length}size(){return this.nodes.length}clone(){const e=new Heap(this.comparator);return e.nodes=this.nodes.slice(0),e}toArray(){return this.nodes.slice(0)}insert(e){return this.push(e)}top(){return this.peek()}front(){return this.peek()}has(e){return this.contains(e)}copy(){return this.clone()}nlargest(e){let t,i,n;const s=this.nodes.slice(0,e);if(!s.length)return s;this._heapify(s,this.comparator);const r=this.nodes.slice(e);for(i=0,n=r.length;i<n;i++)t=r[i],this._pushpop(s,t,this.comparator);return s.sort(this.comparator).reverse()}defaultCompare(e,t){return e<t?-1:e>t?1:0}_siftdown(e,t,i,n){let s,r;const o=n||this.defaultCompare,a=e[i];for(;i>t&&(r=i-1>>1,s=e[r],o(a,s)<0);)e[i]=s,i=r;return e[i]=a}siftdown(e,t){return this._siftdown(this.nodes,e,t,this.comparator)}_siftup(e,t,i){let n,s;const r=i||this.defaultCompare,o=e.length,a=t,l=e[t];for(n=2*t+1;n<o;)s=n+1,s<o&&!(r(e[n],e[s])<0)&&(n=s),e[t]=e[n],n=2*(t=n)+1;return e[t]=l,this._siftdown(e,a,t,r)}siftup(e){return this._siftup(this.nodes,e,this.comparator)}}var n;function s(e){void 0===e.timeout&&(e.timeout=1/0);const t={data:e.start,g:0,heuristicValue:e.heuristic(e.start)};let i=t;t.f=t.heuristicValue;const s=new Set,a=new Heap(o),l=new Map;a.push(t),l.set(t.data,t);const c=Date.now();for(;a.size();){if(Date.now()-c>e.timeout)return{status:n.Timeout,cost:i.g,path:r(i)};const t=a.pop();if(l.delete(t.data),t&&e.isEnd(t.data))return{status:n.Success,cost:t.g,path:r(t)};s.add(t.data);const o=e.neighbors(t.data);for(const n of o){if(s.has(n))continue;const r=t.g+e.distance(t.data,n);let o=l.get(n),c=!1;if(void 0===o)o={data:n,g:0,heuristicValue:0,f:0},l.set(n,o);else{if(o.g<r)continue;c=!0}o.parent=t||void 0,o.g=r,o.heuristicValue=e.heuristic(n),o.f=r+o.heuristicValue,o.heuristicValue<i.heuristicValue&&(i=o),c?a.heapify():a.push(o)}}return{status:n.NoPath,cost:i.g,path:r(i)}}function r(e){if(void 0!==e.parent){const t=r(e.parent);return t.push(e.data),t}return[e.data]}function o(e,t){if(e.f&&t.f)return e.f-t.f;throw new Error('heapComparator() -> Property "f" is undefined.')}!function(e){e[e.Success=0]="Success",e[e.NoPath=1]="NoPath",e[e.Timeout=2]="Timeout"}(n||(n={}))},14624:(e,t,i)=>{"use strict";i.d(t,{V:()=>n});const n=function(e,t){if(t.setLength(0),0===e.length)return t;let i=0;for(const n of e)t.add(n),i++;return t.divideScalar(i),t}},60771:(e,t,i)=>{"use strict";i.d(t,{dy:()=>o,tq:()=>a,jx:()=>l,_1:()=>d,Tt:()=>h,V5:()=>u,Kr:()=>p,w1:()=>m,Dt:()=>f,vU:()=>g,rI:()=>v,Ot:()=>y,Jm:()=>b,J1:()=>S,yL:()=>E,SP:()=>T,UD:()=>w,Vf:()=>x,Hx:()=>_,rm:()=>M,O6:()=>O,Zx:()=>A,Qg:()=>C,PI:()=>P,ht:()=>D});var n=i(88512),s=i(65006);const r=new n.Z("util-browser"),o=()=>{const e=window.innerWidth/window.innerHeight;return isFinite(e)?e:1},a=function(){const e=navigator.userAgent||navigator.vendor,t=new RegExp("(android|bbd+|meego).+mobile|android|avantgo|bada/|blackberry|blazer|compal|elaine|fennec|\n    hiptop|iemobile|ip(hone|od|ad)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|\n    palm( os)?|phone|p(ixi|re)/|plucker|pocket|psp|series(4|6)0|symbian|treo|up.(browser|link)|vodafone|\n    wap|windows ce|xda|xiino","i"),i=new RegExp("1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|\n    amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|\n    br(e|v)w|bumb|bw-(n|u)|c55/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|\n    devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|\n    g560|gene|gf-5|g-mo|go(.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|\n    a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|\n    jemu|jigs|kddi|keji|kgt( |/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|/(k|l|u)|50|54|-[a-w])|libw|lynx|\n    m1-w|m3ga|m50/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|\n    zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|\n    nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|\n    po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55/|\n    sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|\n    sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|\n    tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|\n    vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|\n    zeto|zte-","i");return(t.test(e)||i.test(e.substr(0,4))||d())&&!y()},l=/([\s\{\}\"\']|[^\x00-\x7F]|%[^0-9a-fA-F]{2})+/g,c=(e,t)=>{let i=window.navigator.userAgent.match(e);return i=i?i[1].split(t):[],{major:parseInt(i[0],10)||0,minor:parseInt(i[1],10)||0,patch:parseInt(i[2],10)||0}},d=()=>{const e=window.navigator.userAgent;return/iPad/.test(e)||u()&&navigator.maxTouchPoints>1},h=()=>{const e=window.navigator.userAgent;return/iPod|iPhone/.test(e)||u()&&navigator.maxTouchPoints>1},u=()=>{const e=window.navigator.platform;return/MAC/.test(e.toUpperCase())},p=()=>{const e=window.navigator.platform;return/WIN/.test(e.toUpperCase())},m=()=>{const e=window.navigator.userAgent;return/Trident\//.test(e)},f=()=>-1!==window.navigator.userAgent.indexOf("Android"),g=()=>-1!==window.navigator.userAgent.indexOf("Firefox"),v=()=>{if(!g())throw new Error("Not a Firefox browser");return c(/Firefox\/((?:\d+\.?){1,3})/,".")},y=()=>-1!==window.navigator.userAgent.indexOf("OculusBrowser"),b=()=>"ontouchstart"in window,S=()=>"share"in navigator&&(a()||d()),E=()=>window.parent!==window,T=()=>E()&&(()=>{const e=new URL(document.referrer);return s.yx.some((t=>t.test(e.hostname)))})(),w=()=>window.location.search.substr(1).split("&"),x=(e,t=!1)=>{const i=`${window.location.origin}${window.location.pathname}?${e}`;t?window.history.pushState({},"",i):window.location.replace(i)},_=function(){const e=window.URL||window.webkitURL,t=document.createElement("a");return document.body.appendChild(t),t.style.display="none",(i,n)=>{const s=e.createObjectURL(i);t.href=s,t.download=n,t.click(),e.revokeObjectURL(s)}}(),M=function(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)},O=function(){return!d()&&!h()&&!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.webkitFullscreenEnabled||document.msFullscreenEnabled)},A=function(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()},C=function(){document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()};function P(e){try{return document.featurePolicy.allowsFeature(e)}catch(t){return r.warn(t),r.warn(`Feature Policy check failed, defaulting ${e} to false.`),!1}}const D=()=>(e=>{const t={language:"en",region:void 0,script:void 0,ext:void 0},i=new RegExp([/^([a-z]{2,3})/,/(?:[_-]([ut]{1}[_-][a-z\-\_]+))?/,/(?:[_-]([a-z]{4}))?/,/(?:[_-]([a-z]{2}))?$/].map((e=>e.source)).join(""),"i").exec(e);if(i){const[,e,n,s,r]=i;Object.assign(t,{language:e,ext:n,script:s,region:r})}return t})(navigator.language).language||""},55356:(e,t,i)=>{"use strict";i.d(t,{G1:()=>a,rn:()=>l,D5:()=>c,Ex:()=>d});var n=i(2212),s=i(10757);const r=()=>Math.random(),o={},a=(e,t=r())=>(o[t]||(o[t]=new n.Vector4(r(),r(),r(),e)),o[t]),l=()=>new n.Color(r(),r(),r()),c=e=>"object"==typeof e&&"r"in e&&"g"in e&&"b"in e;function d(e){return`#${(0,s.Q_)(255*e.r,2,"0",16)}${(0,s.Q_)(255*e.g,2,"0",16)}${(0,s.Q_)(255*e.b,2,"0",16)}`}},31879:(e,t,i)=>{"use strict";i.d(t,{U:()=>s,p:()=>r});const n=new Object,s=e=>{if(e){const t=e.valueOf();if(!isNaN(t))return e.toISOString()}return(new Date).toISOString()},r=(e,t=n)=>{if(e){const t=new Date(e);if(!isNaN(t.valueOf()))return t}return t===n?new Date:t}},98292:(e,t,i)=>{"use strict";i.d(t,{D:()=>n});const n=(e,t=250)=>{let i;return(...n)=>{window.clearTimeout(i),i=window.setTimeout((()=>e.apply(null,n)),t)}}},48711:(e,t,i)=>{"use strict";i.d(t,{_F:()=>s,zy:()=>r,XJ:()=>o});const n=.3048,s=e=>e*n,r=e=>e/n,o=e=>{const t=e/n;let i=Math.floor(t),s=12*t%12;return 12===Math.round(s)?(i+=1,s=0):s=Math.round(s),{feet:i,inches:s}}},79437:(e,t,i)=>{"use strict";i.d(t,{vG:()=>r,FG:()=>o,hl:()=>a,to:()=>l,Q9:()=>c,w2:()=>d,qb:()=>h,Fs:()=>u,e3:()=>p,tf:()=>m,aB:()=>f});var n=i(69436),s=i.n(n);const r=function(e,t,i,n){return i*e/n+t},o=function(e,t,i,n){return i*(e/=n)*e+t},a=function(e,t,i,n){return-i*(e/=n)*(e-2)+t},l=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e+t:-i/2*(--e*(e-2)-1)+t},c=function(e,t,i,n){return i*(e/=n)*e*e+t},d=function(e,t,i,n){return e/=n,i*(--e*e*e+1)+t},h=function(e,t,i,n){return(e/=n/2)<1?i/2*e*e*e+t:i/2*((e-=2)*e*e+2)+t},u=function(e,t,i,n){return-i/2*(Math.cos(Math.PI*e/n)-1)+t},p=(e,t,i,n,s)=>{let r=t;if(s>0){const t=(1-Math.max(s,0))*Math.abs(n);r=i<=t?0:e(i-t,0,1,t)}return r};function m(e,t,i,n){const r=new(s())(e,t,i,n);return(e,t,i,n)=>{const s=e/n;return t+i*r.solve(s)}}const f=function(e,t,i,n){return-4*i*Math.pow(e/n-(.5+t),2)+1}},74002:(e,t,i)=>{"use strict";i.d(t,{bX:()=>n,z6:()=>s});const n=e=>void 0!==e.pointerId,s=e=>void 0!==e.changedTouches},74384:(e,t,i)=>{"use strict";i.d(t,{qf:()=>r,A5:()=>l,GO:()=>c,fc:()=>h});var n=i(2212),s=i(12216);function r(e){if(0===e.length)throw Error("Can't merge empty list of geometries");if(1===e.length)return e[0];let t=0,i=0,s=0,r=0;const a=new n.Box3;for(const n of e)n.index&&(t+=n.index.count,i+=n.getAttribute("position").count,n.getAttribute("uv")&&(s+=n.getAttribute("uv").count),n.boundingBox&&(a.union(n.boundingBox),r++));const c=new n.BufferGeometry;r!==e.length||a.isEmpty()?c.computeBoundingBox():c.boundingBox=a,a.copy(l(c)),c.boundingSphere=a.getBoundingSphere(new n.Sphere);const d=o(new Float32Array(3*i),"position",e);c.setAttribute("position",new n.BufferAttribute(d,3));const h=function(e,t){let i=0,n=0;for(const s of t){const t=s.index;for(let s=0;s<t.array.length;s++)e[i+s]=t.array[s]+n;i+=t.array.length,n+=s.getAttribute("position").count}return e}(new Uint32Array(t),e);if(c.setIndex(new n.BufferAttribute(h,1)),s){const t=o(new Float32Array(2*s),"uv",e);c.setAttribute("uv",new n.BufferAttribute(t,2))}return c}function o(e,t,i){let n=0;for(const s of i){const i=s.getAttribute(t);e.set(i.array,n),n+=i.array.length}return e}const a=new n.Box3(s.f.ZERO,s.f.UNIT);function l(e){return e.boundingBox||e.computeBoundingBox(),e.boundingBox||a}function c(e,t){let i=1/0;const s=t.clone(),r=new n.Vector3,o=new n.Vector3(1/0,1/0,1/0);let a=-1;const l=new n.Triangle;return function(e,t){var i;const n=null===(i=e.index)||void 0===i?void 0:i.array,s=e.getAttribute("position");if(!s)return;const r=e.groups.length>0?e.groups:[{start:0,count:n?n.length:s.count,materialIndex:0}];let o=0;for(const e of r)for(let i=e.start;i<e.start+e.count;i+=3){let r=i,a=i+1,l=i+2;n&&(r=n[r],a=n[a],l=n[l]),t(s.getX(r),s.getY(r),s.getZ(r),s.getX(a),s.getY(a),s.getZ(a),s.getX(l),s.getY(l),s.getZ(l),o++,e.materialIndex||0)}}(e,((e,t,n,c,d,h,u,p,m,f)=>{l.a.set(e,t,n),l.b.set(c,d,h),l.c.set(u,p,m),l.closestPointToPoint(s,r);const g=s.distanceToSquared(r);g<i&&(o.copy(r),i=g,a=f)})),{point:o,distance:Math.sqrt(i),faceIndex:a}}const d=new n.PlaneBufferGeometry(1,1);function h(){return d}},10757:(e,t,i)=>{"use strict";i.d(t,{gw:()=>s,Ig:()=>r,Y8:()=>o,XN:()=>a,Yv:()=>l,TH:()=>c,Jq:()=>d,Pe:()=>h,DZ:()=>u,Q_:()=>p,O1:()=>m,$B:()=>f,ow:()=>g,aS:()=>v,lY:()=>y});var n=i(1030);const s=function(e){return new Promise(((t,i)=>{setTimeout(t,e)}))},r=e=>{let t,i=-1;return{promise:new Promise(((n,s)=>{t=n,i=window.setTimeout(n,e)})).then((()=>{i=-1})),cancel:()=>{-1!==i&&(window.clearTimeout(i),t())}}},o=function(e,t){if(0===e.length)return null;let i=0,n=0;for(let s of e)s=t?s[t]:s,i+=s,n++;return i/n},a=function(e){const t={};for(const i of e)t[i]=i;return t},l=function(e){return!e.replace(/\n/g,"").trim().length},c=function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0},d=function(e,t){const i=Math.min(e.length,t.length);for(let n=0;n<i;n++)if(e[n]!==t[n])return!1;return!0},h=function(e,t,i=!0){if(0===e.length)return null;i&&e.sort((function(e,t){return e-t}));const n=t/100;return e[Math.floor(e.length*n)]},u=function(e){return[p(e.getMonth()+1),".",p(e.getDate()),".",e.getFullYear(),"_",p(e.getHours()),".",p(e.getMinutes()),".",p(e.getSeconds())].join("")},p=function(e,t=2,i="0",n=10){const s=e.toString(n),r=t-s.length+1;return r>0?new Array(r).join(i)+s:s},m=function(e){let t="";const i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t},f=e=>{const t=[];for(let i=0;i<e.length;i+=8192)t.push(String.fromCharCode.apply(null,e.subarray(i,i+8192)));return btoa(t.join(""))},g=(e=[])=>{const t={};for(const i of e)t[i]=!0;return t};const v=(e,t,i="...")=>e.length<t?e:`${e.substr(0,t)}${i}`,y=(e,t,i)=>{if(!(Math.abs(e)<4294967295)||!(t<32)||!(i<32))throw new n.Z("argument out of range");const s=1&(e>>>t^e>>>i);return(e^=s<<t|s<<i)>>>0};(()=>{const e={}})()},36169:(e,t,i)=>{"use strict";i.d(t,{h:()=>s});const n=new(i(88512).Z)("passive-support"),s=(()=>{let e=!1;try{const t=Object.defineProperty({},"passive",{get:()=>{e=!0}});return window.addEventListener("testPassive",(()=>{}),t),window.removeEventListener("testPassive",(()=>{}),t),e}catch(e){return n.warn(`Passive Option for addEventListener is not supported, Safari zoom may not perform as expected: ${e}`),!1}})()},98612:(e,t,i)=>{"use strict";i.d(t,{fp:()=>s,m8:()=>r});const n=new(i(88512).Z)("util-browser"),s=function(e,t){if(!("localStorage"in window))return t;let i;try{i=window.localStorage.getItem(e)}catch(e){return n.debug(e),t}return null===i?t:"boolean"==typeof t?"true"===i:"number"==typeof t?parseFloat(i):i},r=function(e,t){try{window.localStorage.setItem(e,t)}catch(e){n.error(e)}}},88512:(e,t,i)=>{"use strict";i.d(t,{Z:()=>Logger});const n=window.navigationStart||Date.now();var s;!function(e){e[e.ERROR=0]="ERROR",e[e.WARN=1]="WARN",e[e.INFO=2]="INFO",e[e.DEBUG=3]="DEBUG"}(s||(s={}));class Logger{constructor(e){this.timers={},this.handlers={[s.DEBUG]:console.debug,[s.INFO]:console.info,[s.WARN]:console.warn,[s.ERROR]:console.error};const t=e.split(new RegExp("/|\\\\"));this.prefix="["+t[t.length-1].replace(".js","")+"]"}message(e){if(Logger.level>=e&&console){return(this.handlers[e]?this.handlers[e]:console.log).bind(console,this.getPrefix())}return()=>{}}get debug(){return this.message(s.DEBUG)}get debugWarn(){return this.message(Logger.level>=s.DEBUG?s.WARN:s.DEBUG)}get info(){return this.message(s.INFO)}get warn(){return this.message(s.WARN)}get error(){return this.message(s.ERROR)}time(e){Logger.level>=s.DEBUG&&(this.timers[e]=Date.now())}timeEnd(e){if(Logger.level>=s.DEBUG){const t=this.timers[e];if(!t)return;const i=(Date.now()-t)/1e3;this.debug(e,i+"s")}}getPrefix(){const e=(Date.now()-n)/1e3+"s";return`${this.prefix} ${e}`}}Logger.level=s.INFO},71918:(e,t,i)=>{"use strict";function n(e){const t={};for(const i in e)t[e[i]]=i;return t}function s(e,t){if(null!==e&&"object"==typeof e)for(const i in e)t(e[i],i,e),s(e[i],t)}i.d(t,{S:()=>n,y:()=>s})},84933:(e,t,i)=>{"use strict";function n(e=11){let t="";const i="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";for(let n=0;n<e;n++)t+=i.charAt(Math.floor(Math.random()*i.length));return t}function s(e,t){return function(e,t){return(e%t+t)%t}(r(e),t)}function r(e){let t,i=0;for(let n=0;n<e.length;n++)t=e.charCodeAt(n),i=(i<<5)-i+t,i|=0;return i}i.d(t,{fV:()=>n,Wm:()=>s,un:()=>r})},18654:(e,t,i)=>{"use strict";i.d(t,{m5:()=>r,an:()=>o});const n="referrer";let s="";function r(e){let t;try{t=new URL(e)}catch(t){return e}return t.searchParams.set(n,o()),t.href}function o(){return(function(){if(!window.document.referrer)return!1;let e;try{e=new URL(window.document.referrer)}catch(e){return!1}return e.origin===window.location.origin}()?function(){const e=new URL(window.location.href);if(!e.searchParams.has(n))return s;const t=e.searchParams.get(n)||"";try{new URL(t),s=t}catch(e){}return e.searchParams.delete(n),window.history.replaceState(null,"",e.href),s}():"")||window.document.referrer}},85917:(e,t,i)=>{"use strict";i.d(t,{g_:()=>s,i5:()=>r,T8:()=>u,kp:()=>f});var n=i(44283);var s,r;!function(e){e[e.RESIZE=1]="RESIZE",e[e.ORIENTATION_CHANGED=2]="ORIENTATION_CHANGED"}(s||(s={})),function(e){e[e.PORTRAIT=1]="PORTRAIT",e[e.LANDSCAPE=2]="LANDSCAPE"}(r||(r={}));let o=[],a=[];const l=window.visualViewport,c=()=>({w:l?l.width:window.innerWidth,h:l?l.height:window.innerHeight}),d=c(),h=new n.ne((()=>d),(e=>o.push(e)),(e=>{o=o.filter((t=>t!==e))})),u=()=>({orientation:window.innerWidth>window.innerHeight?r.LANDSCAPE:r.PORTRAIT});let p=u();const m=new n.ne((()=>p),(e=>a.push(e)),(e=>{a=a.filter((t=>t!==e))}));function f(e,t){switch(e){case s.RESIZE:return h.createSubscription(t);case s.ORIENTATION_CHANGED:return m.createSubscription(t)}}const g=(()=>{let e,t;return()=>{const i=c(),n=()=>{window.clearInterval(e),window.clearTimeout(t)};n();const s=()=>{d.w===i.w&&d.h===i.h||(d.w=i.w,d.h=i.h,(()=>{if(o.length>0&&o.forEach((e=>e(d))),a.length>0){const e=u();e!==p&&(p=e,a.forEach((t=>t(e))))}})())};e=window.setInterval(s,100),t=window.setTimeout(n,1e3),s()}})();l?l.addEventListener("resize",g):window.addEventListener("resize",g)},26605:(e,t,i)=>{"use strict";i.d(t,{f:()=>ReticleMesh});var n=i(2212);const s={extensions:{derivatives:!0},defines:{RING_COUNT:0,USE_TEXTURE:!1},uniforms:{discRadius:{value:.2},discNormal:{value:new n.Vector3(0,0,1)},ringRadii:{value:[]},ringColors:{value:[]},opacity:{value:1},texture:{value:null}},vertexShader:i(35757),fragmentShader:i(37923),side:n.FrontSide,transparent:!0};var r=i(67078);const o=new n.Color,a=[{outerRadius:1,innerRadius:.75,color:16777215,opacity:1}];class ReticleMaterial extends r.b{constructor(e=a){super(Object.assign(Object.assign({},s),{defines:Object.assign({},s.defines),uniforms:n.UniformsUtils.clone(s.uniforms)})),this.setRings(e),Object.defineProperty(this,"opacity",{set(e){this.uniforms.opacity.value=e},get(){return this.uniforms.opacity.value}})}setDiscNormal(e){this.uniforms.discNormal.value.copy(e)}setDiscRadius(e){this.uniforms.discRadius.value=e}setRings(e){e=e||[],this.defines.RING_COUNT!==e.length&&(this.defines.RING_COUNT=e.length,this.needsUpdate=!0),this.uniforms.ringRadii.value=e.map((({innerRadius:e,outerRadius:t})=>new n.Vector2(e||-1,t))),this.uniforms.ringColors.value=e.map((({color:e,opacity:t})=>(o.set(e),new n.Vector4(o.r,o.g,o.b,t))))}setTexture(e){this.defines.USE_TEXTURE!==!!e&&(this.defines.USE_TEXTURE=!!e,this.needsUpdate=!0),this.uniforms.texture.value=e}getTexture(){return this.uniforms.texture.value}}class ReticleMesh extends n.Mesh{constructor(e){super(new n.SphereGeometry(Math.sqrt(2),8,6),new ReticleMaterial),e&&this.configure(e)}configure(e){const{radius:t,normal:i,rings:n,texture:s,opacity:r}=e,{material:o}=this;void 0!==t&&(this.scale.setScalar(t),o.setDiscRadius(t)),void 0!==i&&o.setDiscNormal(i),void 0!==n&&o.setRings(n),void 0!==s&&o.setTexture(s),void 0!==r&&(o.opacity=r)}dispose(){var e;null===(e=this.material.getTexture())||void 0===e||e.dispose(),this.geometry.dispose()}}},66223:(e,t,i)=>{"use strict";i.d(t,{p:()=>r});var n=i(2212);const s=new(i(88512).Z)("texture"),r=(e,t,i)=>{const r=new n.TextureLoader;return r.crossOrigin="anonymous",r.load(e,t,void 0,(t=>{s.error(`Failed to load ${e}`),i&&i(t)}))}},62330:(e,t,i)=>{"use strict";i.d(t,{P:()=>n});const n=(e,t)=>{let i,n=Date.now()-t;return(...s)=>{const r=Date.now()-n,o=()=>{e.apply(null,s),n=Date.now()};if(i&&clearTimeout(i),r>=t)o();else{const e=t-r;i=window.setTimeout(o,e)}}}},65006:(e,t,i)=>{"use strict";i.d(t,{sU:()=>s,bf:()=>r,yx:()=>o,KK:()=>a});var n=i(8575);const s=function(e="",t){let i,s,r;if(e.match(/^https?/)){const t=(0,n.Qc)(e);i=t.protocol+"//"+t.host,s=e,r=e.match(/[^/]*$/)[0]}else{if(t.match(/^https?/)){const e=(0,n.Qc)(t);i=e.protocol+"//"+e.host}else i=window.location.protocol+"//"+t;s=i+"/api/player/models/"+e,r=e}return{sid:r,urlBase:i,urlModel:s,urlFiles:s+(s.match(/\/$/)?"files":"/files"),urlThumb:s+(s.match(/\/$/)?"thumb":"/thumb")}},r=function(e,t={}){for(const i in t){const n=t[i];e+=(-1===e.indexOf("?")?"?":"&")+`${i}=${n}`}return e},o=[/^([a-z0-9\-]*\.)*matterport\.com$/,/^([a-z0-9\-]*\.)*matterportvr\.cn$/,/^localhost$/],a=e=>{let t;try{t=new URL(e)}catch(e){return null}const i=t.hostname;for(const e of o)if(i.match(e))return t.origin;return null}},17597:(e,t,i)=>{"use strict";i.d(t,{FU:()=>r,kD:()=>o,eY:()=>a});i(1939);const n=new URLSearchParams(window.location.search),s={};function r(){return Object.assign({},s)}function o(){return new URLSearchParams(n.toString())}function a(e,t=null){const i=n.get(e),s=typeof t;return null===i?t:"boolean"===s?"true"===i||"1"===i:"number"===s?+i:i}n.forEach(((e,t)=>{s[t]=e}))},82702:(e,t,i)=>{"use strict";i.d(t,{D:()=>s});const n=[];for(let e=0;e<256;e++)n[e]=(e<16?"0":"")+e.toString(16);function s(){let e;const t=window.crypto||window.msCrypto;return e=t?t.getRandomValues(new Uint8Array(16)):new Uint8Array(16).map((()=>255*Math.random())),e[6]=15&e[6]|64,e[8]=63&e[8]|128,n[e[0]]+n[e[1]]+n[e[2]]+n[e[3]]+"-"+n[e[4]]+n[e[5]]+"-"+n[e[6]]+n[e[7]]+"-"+n[e[8]]+n[e[9]]+"-"+n[e[10]]+n[e[11]]+n[e[12]]+n[e[13]]+n[e[14]]+n[e[15]]}},96909:(e,t,i)=>{"use strict";i.d(t,{y:()=>Z,m:()=>ModuleLoader});var n=i(64185);const s=new(i(88512).Z)("module-loader");var r;!function(e){e[e.Registered=0]="Registered",e[e.Loading=1]="Loading",e[e.Initialized=2]="Initialized",e[e.Unloaded=3]="Unloaded"}(r||(r={}));class ModuleLoader{constructor(){this.symbolMap=new Map}registerModule(e,t){if(this.symbolMap.has(e))throw Error(`Type ${String(e)} already registered`);this.symbolMap.set(e,{es6ModulePromise:t,ctorPromise:new n.Q,initPromise:new n.Q,state:r.Registered})}moduleRegistered(e){return this.symbolMap.has(e)}moduleLoaded(e){const t=this.symbolMap.get(e);return!!t&&![r.Registered,r.Unloaded].includes(t.state)}getModule(e){const t=this.symbolMap.get(e);if(!t)throw Error(`Trying to get ${String(e)} before it was registered!`);if(t.state===r.Unloaded)throw Error(`${String(e)} module unloaded`);return t.initPromise.nativePromise()}getModuleSync(e){const t=this.symbolMap.get(e);return t?t.state!==r.Initialized?null:t.module:null}loadModule(e,t,i={}){const n=this.symbolMap.get(t);if(!n)throw Error(`${String(t)} not found`);if(n.state===r.Initialized)return n;if(n.state!==r.Registered&&n.state!==r.Unloaded)throw Error(`${String(t)} already loading`);n.state=r.Loading;const o=String(t);return n.es6ModulePromise(o).then((o=>{if(!o.default)throw new Error(`${String(t)} has no default export during module loading`);const a=new o.default;n.ctorPromise.resolve(a).then((()=>{const t=Date.now();let o=!1;setTimeout((()=>{o||s.debug(`${a.name} init took over 2 seconds`)}),2e3),a.init(i,e).then((()=>{s.debug(`${a.name} init took ${(Date.now()-t)/1e3} secs.`),o=!0,n.state=r.Initialized,n.module=a,n.initPromise.resolve(a)})).catch((e=>{n.initPromise.reject(e)}))}))})).catch((e=>{s.error(`Failed to load es6Module for ${String(t)}: ${e}`),n.initPromise.reject(e)})),n}whenQueueEmpties(){const e=[];for(const[,t]of this.symbolMap)t.state===r.Loading&&e.push(t.initPromise);return n.Q.all(e).nativePromise()}unloadModule(e){const t=this.symbolMap.get(e);if(!t)throw Error("Attempting to unload unregistered module");if(t.state===r.Unloaded||t.state===r.Registered)throw Error("Attempting to unload not-loaded module");t.state=r.Unloaded,t.ctorPromise=new n.Q,t.initPromise=new n.Q,t.module=void 0}}const o=Symbol("analytics"),a=Symbol("automation-support"),l=Symbol("blur-data"),c=Symbol("blur-editor"),d=Symbol("blur-suggestions"),h=Symbol("camera"),u=Symbol("canvas"),p=Symbol("cursor-controller"),m=Symbol("deep-links"),f=Symbol("gui"),g=Symbol("input"),v=Symbol("label-data"),y=Symbol("label-render"),b=Symbol("measurement-mode"),S=Symbol("mesh-query"),E=Symbol("mesh-api-fixup"),T=Symbol("mesh-trim-data"),w=Symbol("mesh-trim-editor-module"),x=Symbol("model-mesh"),_=Symbol("model-rating"),M=Symbol("orthographic-controls"),O=Symbol("pins"),A=Symbol("raycaster"),C=Symbol("scan-info"),P=Symbol("scene"),D=Symbol("sdk"),N=Symbol("search"),I=Symbol("settings"),L=Symbol("pano"),R=Symbol("pucks"),k=Symbol("tours-controls"),U=Symbol("tours-data"),B=Symbol("transform-gizmo"),F=Symbol("trash"),V=Symbol("video"),H=Symbol("vision-catalog"),j=Symbol("webgl-renderer"),G=(Symbol("webvr"),Symbol("webxr")),z=Symbol("dwell-analytics"),W=Symbol("show-analytics"),K=Symbol("model-mesh-quality"),Y=Symbol("view-ui"),q=Symbol("edit-ui"),Z={ANALYTICS:o,AUTOMATION_SUPPORT:a,BLUR_DATA:l,BLUR_EDITOR:c,BLUR_SUGGESTIONS:d,CAMERA:h,CANVAS:u,CURSOR_CONTROLLER:p,DEEP_LINKS:m,DWELL_ANALYTICS:z,GUI:f,INPUT:g,LOADING_GUI:Symbol("init-ui"),LABEL_DATA:v,LABEL_RENDERER:y,MEASUREMENT_MODE:b,MODEL_MESH:x,MODEL_MESH_QUALITY:K,MESH_API_FIXUP:E,MESH_QUERY:S,MESH_TRIM_DATA:T,MESH_TRIM_EDITOR:w,MODEL_RATING:_,ORTHOGRAPHIC_CONTROLS:M,PINS:O,RAYCASTER:A,SCAN_INFO:C,SCENE:P,SDK:D,SEARCH:N,SETTINGS:I,SHOWCASE_GUI:Y,SHOWCASE_ANALYTICS:W,SWEEP_PANO:L,SWEEP_PUCKS:R,TOUR_CONTROLS:k,TOUR_DATA:U,TRANSFORM_GIZMO:B,TRASH:F,VIDEO_RECORDER:V,VISION_CATALOG:H,WEBGL_RENDERER:j,WEBXR:G,WORKSHOP_GUI:q}},36651:(e,t,i)=>{"use strict";function n(e={},t){return t.split(".").reduce(((e,t)=>e&&e[t]),e)}i.d(t,{q:()=>n})},8684:(e,t,i)=>{"use strict";i.d(t,{M:()=>DynamicLibLoader});class DynamicLibLoader{constructor(){this.libraryCache=new Map}load(e,t){const i=this.libraryCache.get(e)||new ScriptFetcher(e,t);return this.libraryCache.set(e,i),i.library}}class ScriptFetcher{constructor(e,t){this._libraryPromise=new Promise(((e,t)=>{this.libraryResolver=e,this.libraryRejecter=t})),this.fetch(e,t)}async fetch(e,t){let i;try{const t=new Request(e),n=new URL(t.url);if(!n.hostname.endsWith(window.location.hostname)&&!n.host.endsWith("matterport.com")&&!n.host.endsWith("matterportvr.cn"))return void this.libraryRejecter(`Request made for ${n.href} does not have the same origin as the request origin ${window.location.origin}`);i=await fetch(new Request(e,{}))}catch(e){return void this.libraryRejecter(e)}if(!i.ok)return void this.libraryRejecter("Script not found.");const n={},s=await i.text();if(new Function(s).call(n),t&&t in window){const e=window[t]||{};Object.assign(n,e),delete window[t]}this.libraryResolver(n)}get library(){return this._libraryPromise}}},97807:(e,t,i)=>{"use strict";var n;i.d(t,{a_:()=>OEmbedConsumer,t1:()=>OEmbedLinkError,HF:()=>OEmbedProviderError,ht:()=>n}),function(e){e.PHOTO="photo",e.VIDEO="video",e.LINK="link",e.RICH="rich"}(n||(n={}));class OEmbedConsumerError extends Error{constructor(e,t,i){super(e),this.status=t,this.type=i,Error.captureStackTrace&&Error.captureStackTrace(this,OEmbedConsumerError)}}class OEmbedProviderError extends OEmbedConsumerError{constructor(e="unknown provider"){super(`Content from OEmbed provider ${e} is not currently not supported`,200,"OEmbedProvider")}}class OEmbedLinkError extends OEmbedConsumerError{constructor(e="unknown provider"){super(`Content from ${e} is type "link", which Link content is not currently supported`,200,"OEmbedLink")}}function s(e){const t=Math.max(window.screen.height,window.screen.width);return{queryParams:new URLSearchParams({maxWidth:`${t}`,maxHeight:`${t}`,url:e}),headers:{responseType:"json"}}}const r=/^https:\/\/www.instagram.com/;const o=/^https:\/\/www.facebook.com/,a=/^https:\/\/www.facebook.com\/(.*\/)?(posts\/|activity\/|photo\.php|photos\/|permalink\.php|media\/set|questions\/|notes\/)/,l=/^https:\/\/www.facebook.com\/(video\.php|.*\/videos\/)/;async function c(e,t,i,n){const{queryParams:r,headers:o}=s(e);i&&n&&r.append("access_token",`${i}|${n}`);const c=function(e){return a.test(e)?"https://graph.facebook.com/v10.0/oembed_post":l.test(e)?"https://graph.facebook.com/v10.0/oembed_video":"https://graph.facebook.com/v10.0/oembed_page"}(e),d=new URL(`${c}?${r.toString()}`);try{return await t.get(d.toString(),o)}catch(e){const t=e;throw new OEmbedConsumerError(t.error.message,t.status_code,t.error.type)}}const d={behance:!1,dailymotion:!0,facebook:!1,flickr:!0,giphy:!0,instagram:!1,linkedin:!1,matterport:!0,mixcloud:!1,pinterest:!1,reddit:!1,soundcloud:!0,sketchfab:!0,spotify:!0,tenor:!0,tiktok:!1,twitter:!1,tumblr:!0,vimeo:!0,youtube:!0};class OEmbedConsumer{constructor(e){this.cache={},Object.assign(this,e)}async getOEmbedData(e){if(this.cache[e])return this.validate(this.cache[e]);const t=await this.requestOEmbedData(e);return this.cache[e]=t,this.validate(t)}async requestOEmbedData(e){let t;return t=function(e){return r.test(e)}(e)?await async function(e,t,i,n){const{queryParams:r,headers:o}=s(e);i&&n&&r.append("access_token",`${i}|${n}`);const a=new URL(`https://graph.facebook.com/v10.0/instagram_oembed?${r.toString()}`);try{return await t.get(a.toString(),o)}catch(e){const t=e;throw new OEmbedConsumerError(t.error.message,t.status_code,t.error.type)}}(e,this.queue,this.instagramAppId,this.instagramClientToken):function(e){return o.test(e)}(e)?await c(e,this.queue,this.instagramAppId,this.instagramClientToken):await async function(e,t,i){const{queryParams:n,headers:r}=s(e);i&&n.append("key",i);const o=new URL(`https://api.embed.ly/1/oembed?${n.toString()}`);try{return await t.get(o.toString(),r)}catch(e){const t=e;throw new OEmbedConsumerError(t.error_message,t.status_code,t.type)}}(e,this.queue,this.embedlyKey),t}clearCache(){this.cache={}}validate(e){if(!(e=>{const{provider_name:t,type:i}=e,s=void 0===t?void 0:d[t.toLowerCase()];return void 0===s&&i===n.PHOTO||!!s})(e))throw new OEmbedProviderError(e.provider_name);if(e.type===n.LINK)throw new OEmbedLinkError(e.provider_name);return e}}},3560:(e,t,i)=>{"use strict";i.d(t,{U7:()=>AcceptMessage,fE:()=>AcceptObserver_AcceptObserver,HE:()=>ConnectMessage_ConnectMessage,OR:()=>ConnectMessageObserver,RS:()=>HandshakeMessage,tK:()=>n,pP:()=>s,HX:()=>RejectMessage,MJ:()=>RejectObserver_RejectObserver});i(90939);var n,s,r,o,a=i(8684);!function(e){const t=new a.M;e.connect=async function(e,i,n){let s;try{s=await e.connect()}finally{e.cancelConnecting()}return function(e,t,i,n){return new t(i,e).build(n)}(n,await async function(e){if(!e)throw new Error("Unabled to load the sdk");try{const i=await t.load(e,"sdk-client");if(i&&i.SdkBuilder&&"function"==typeof i.SdkBuilder)return i.SdkBuilder}catch(e){}throw Error(`Could not load the sdk from ${e}`)}(s.scriptUrl),i.getFactory(s),s.serializedInterface)}}(n||(n={})),function(e){e.CONNECT="postmessage.connect"}(s||(s={})),function(e){e.HANDSHAKE="postmessage.handshake",e.ACCEPT="postmessage.accept",e.REJECT="postmessage.reject"}(r||(r={}));class ConnectMessage_ConnectMessage{constructor(e,t){this.type=s.CONNECT,this.payload={bootstrapVersion:e,options:{auth:t.auth}}}}class AcceptObserver_AcceptObserver{constructor(e){this.receiver=e,this.messageType=r.ACCEPT}notify(e,t,i){const{sourceId:n,scriptUrl:s,targetId:r,targetOrigin:o}=e,a=e.interface;this.receiver.accept(n,s,a,r,o)}}class RejectObserver_RejectObserver{constructor(e){this.receiver=e,this.messageType=r.REJECT}notify(e,t,i){this.receiver.reject(e.reason)}}!function(e){e[e.IDLE=0]="IDLE",e[e.CONNECTING=1]="CONNECTING",e[e.HANDSHAKE=2]="HANDSHAKE",e[e.CONNECTED=3]="CONNECTED",e[e.REJECTED=4]="REJECTED"}(o||(o={}));class HandshakeMessage{constructor(){this.type=r.HANDSHAKE,this.payload={}}}class AcceptMessage{constructor(e,t,i,n,s){this.type=r.ACCEPT,this.payload={scriptUrl:e,interface:t,sourceId:i,targetId:n,targetOrigin:s}}}class RejectMessage{constructor(e){this.type=r.REJECT,this.payload={reason:e}}}class ConnectMessageObserver{constructor(e){this.receiver=e,this.messageType=s.CONNECT}notify(e,t){this.receiver.onConnectionReceived(e,t)}}},24344:(e,t,i)=>{"use strict";i(52363);var n;i(2815);!function(e){e[e.POSTMESSAGE=1]="POSTMESSAGE"}(n||(n={}))},2815:(e,t,i)=>{"use strict";var n;!function(e){e.LOADED="inject.loaded",e.SETUP="inject.setup",e.RESOLVE="inject.resolve"}(n||(n={}))},94326:(e,t,i)=>{"use strict";var n;i.d(t,{dE:()=>n}),function(e){e.CAMERA="sensor.sensortype.camera"}(n||(n={}))},60402:(e,t,i)=>{"use strict";i.d(t,{PO:()=>n});var n;!function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(n||(n={}))},90939:(e,t,i)=>{"use strict";i.d(t,{UX:()=>DirectMessageFactory,tY:()=>DirectMessageListener,Ej:()=>DirectMessageNode,l:()=>PostMessageFactory,R9:()=>PostMessageListener,TY:()=>UndirectedMessenger});class BridgeObserver{constructor(e){this.messageReceiver=e}notify(e,t){this.messageReceiver.onMessageReceived(e,t)}}var n=i(52363);class ErrorMessageBridge{listen(){}stopListening(){}send(){throw Error("The sdk has been disconnected and can't make any new calls")}}class Messenger{constructor(e,t,i){this.sourceId=e,this.targetId=t,this.messageBridge=i,this.observers=new n.X}init(){const e=new class MessengerFacade{constructor(e){this.messenger=e}onMessageReceived(e,t){this.messenger.onMessageReceived(e,t)}}(this),t=new BridgeObserver(e);this.messageBridge.listen(t)}dispose(){this.messageBridge.stopListening(),this.messageBridge=new ErrorMessageBridge}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e){const t=this.sourceId,i=this.targetId;this.messageBridge.send(Object.assign(Object.assign({},e),{fromId:t,toId:i,timestamp:Date.now()}))}onMessageReceived(e,t){if(!this.filterMessageId(e))return;const i=e.type,n=this.observers.getValuesAtKey(i);if(n)for(const i of n)i.notify(e.payload,t,e.timestamp)}filterMessageId(e){const t=e.toId,i=e.fromId;return t instanceof Array?t.indexOf(this.sourceId)>-1:t===this.sourceId&&i===this.targetId}}class UndirectedMessenger{constructor(e,t){this.sourceId=e,this.listenerBridge=t,this.observers=new n.X}init(){const e=new class UndirectedFacade{constructor(e){this.messenger=e}onMessageReceived(e,t){this.messenger.onMessageReceived(e,t)}}(this),t=new BridgeObserver(e);this.listenerBridge.listen(t)}dispose(){this.listenerBridge.stopListening()}addObserver(e){this.observers.add(e.messageType,e)}removeObserver(e){this.observers.remove(e.messageType,e)}send(e,t,i,n){i.send(Object.assign(Object.assign({},e),{fromId:this.sourceId,toId:t,timestamp:Date.now()}),n)}onMessageReceived(e,t){const i=e.type,n=this.observers.getValuesAtKey(i);if(n)for(const i of n)i.notify(e.payload,t,e.timestamp)}}class PostMessageListener{constructor(e){this.targetWindow=e,this.messageObserver=null,this.onMessage=e=>{if(this.messageObserver){const t=e.data;this.messageObserver.notify(Object.assign({},t),{id:t.fromId,origin:e.origin,source:e.source},e.data.timestamp)}}}listen(e){this.messageObserver||(this.messageObserver=e,this.targetWindow.addEventListener("message",this.onMessage))}stopListening(){this.targetWindow.removeEventListener("message",this.onMessage),this.messageObserver=null}}class PostMessageSender{constructor(e,t="*"){this.targetWindow=e,this.targetOrigin=t}send(e,t){this.targetWindow.postMessage(e,this.targetOrigin)}}class PostMessageBridge{constructor(e,t,i="*"){this.sourceWindow=e,this.listener=new PostMessageListener(e),this.sender=new PostMessageSender(t,i)}listen(e){this.listener.listen(e)}stopListening(){this.listener.stopListening()}send(e){this.sender.send(e,this.sourceWindow)}}class PostMessageFactory{constructor(e,t,i,n,s="*"){this.sourceId=e,this.sourceWindow=t,this.targetId=i,this.targetWindow=n,this.targetOrigin=s}createMessenger(){const e=new PostMessageBridge(this.sourceWindow,this.targetWindow,this.targetOrigin);return new Messenger(this.sourceId,this.targetId,e)}}class DirectMessageBridge{constructor(e,t){this.source=e,this.target=t,this.messageObserver=null}listen(e){this.messageObserver||(this.messageObserver=e,this.source.addObserver(e))}stopListening(){this.messageObserver&&this.source.removeObserver(this.messageObserver)}send(e){const t=this.target;t&&t.post(Object.assign({},e),this.source)}}class DirectMessageFactory{constructor(e,t,i,n){this.sourceId=e,this.sourceNode=t,this.targetId=i,this.targetNode=n}createMessenger(){const e=new DirectMessageBridge(this.sourceNode,this.targetNode);return new Messenger(this.sourceId,this.targetId,e)}}class DirectMessageNode{constructor(e){this.origin=e,this.observers=new Set}addObserver(e){this.observers.add(e)}removeObserver(e){this.observers.delete(e)}post(e,t){for(const i of this.observers)i.notify(e,t)}}class DirectMessageListener{constructor(e){this.targetNode=e,this.messageObserver=null,this.onMessage=(e,t)=>{this.messageObserver&&this.messageObserver.notify({payload:Object.assign({},e.payload),type:e.type},{id:e.fromId,source:t},e.timestamp)}}listen(e){this.messageObserver||(this.messageObserver=e,this.targetNode.addObserver({notify:(e,t)=>{this.onMessage(e,t)}}))}stopListening(){this.messageObserver=null}}},51522:(e,t,i)=>{"use strict";var n,s,r,o,a,l,c,d,h,u,p,m,f,g;i.d(t,{kJ:()=>o,AR:()=>d}),function(e){let t,i,n;!function(e){e.PHASE_CHANGE="application.phasechange"}(t=e.Event||(e.Event={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(i=e.Phase||(e.Phase={})),function(e){e.SHOWCASE="application.showcase"}(n=e.Application||(e.Application={}))}(n||(n={})),function(e){let t,i;!function(e){e.MOVE="camera.move"}(t=e.Event||(e.Event={})),function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(i=e.Direction||(e.Direction={}))}(s||(s={})),function(e){let t;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(t=e.Event||(e.Event={}))}(r||(r={})),function(e){let t;!function(e){e.SUCCESS="astar.status.success",e.NO_PATH="astar.status.no_path",e.TIMEOUT="astar.status.timeout",e.NO_START_VERTEX="astar.status.no_start",e.NO_END_VERTEX="astar.status.no_end"}(t=e.AStarStatus||(e.AStarStatus={}))}(o||(o={})),function(e){let t;!function(e){e.POSITION_UPDATED="label.positionupdated"}(t=e.Event||(e.Event={}))}(a||(a={})),function(e){let t,i;!function(e){e.WINDOW="link.creationpolicy.window",e.REFERRER="link.creationpolicy.referrer",e.MATTERPORT="link.creationpolicy.matterport"}(t=e.CreationPolicy||(e.CreationPolicy={})),function(e){e.DEFAULT="link.openpolicy.deafult",e.NEW_WINDOW="link.openpolicy.newwindow",e.SAME_FRAME="link.openpolicy.sameframe",e.CURRENT_WINDOW="link.openpolicy.current"}(i=e.OpenPolicy||(e.OpenPolicy={}))}(l||(l={})),function(e){let t,i,n,s,r;!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(t=e.Transition||(e.Transition={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(i=e.LinkType||(e.LinkType={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(n=e.DescriptionChunkType||(e.DescriptionChunkType={})),function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(s=e.Event||(e.Event={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(r=e.MediaType||(e.MediaType={}))}(c||(c={})),function(e){let t,i,n;!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(t=e.Mode||(e.Mode={})),function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(i=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(n=e.TransitionType||(e.TransitionType={}))}(d||(d={})),function(e){let t;!function(e){e.MODEL_LOADED="model.loaded"}(t=e.Event||(e.Event={}))}(h||(h={})),function(e){let t;!function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(t=e.Colliders||(e.Colliders={}))}(u||(u={})),function(e){let t,i;!function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(t=e.InteractionType||(e.InteractionType={})),function(e){e.INPUT="input",e.OUTPUT="output",e.EVENT="event",e.EMIT="emit"}(i=e.PathType||(e.PathType={}))}(p||(p={})),function(e){let t,i;!function(e){e.CAMERA="sensor.sensortype.camera"}(t=e.SensorType||(e.SensorType={})),function(e){e.SPHERE="sensor.sourcetype.sphere",e.BOX="sensor.sourcetype.box",e.CYLINDER="sensor.sourcetype.cylinder"}(i=e.SourceType||(e.SourceType={}))}(m||(m={})),function(e){let t,i,n,s;!function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(t=e.Event||(e.Event={})),function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade"}(i=e.Transition||(e.Transition={})),function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(n=e.Alignment||(e.Alignment={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(s=e.Placement||(e.Placement={}))}(f||(f={})),function(e){let t;!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(t=e.Event||(e.Event={}))}(g||(g={}))},52363:(e,t,i)=>{"use strict";i.d(t,{X:()=>DictArray});class DictArray{constructor(){this.values={}}add(e,t){this.getValuesAtKey(e).push(t)}remove(e,t){const i=this.values[e];if(i){const e=i.indexOf(t);e>-1&&i.splice(e,1)}}removeKey(e){delete this.values[e]}getValuesAtKey(e){const t=this.values[e]||[];return this.values[e]=t,t}valuesPerKey(e){return this.getValuesAtKey(e).length}find(e,t){return this.values[e]&&this.values[e].find(t)}get keys(){return Object.keys(this.values)}hasKey(e){return e in this.values}has(e,t){return this.hasKey(e)&&this.values[e].includes(t)}*[Symbol.iterator](){for(const e in this.values)for(const t of this.values[e])yield[e,t]}}},26649:(e,t,i)=>{"use strict";function n(e){return"number"==typeof e&&!isNaN(e)}i.d(t,{hj:()=>n})},80680:(e,t,i)=>{"use strict";i.d(t,{u:()=>s});var n=i(26649);function s(e){if(e&&"object"==typeof e&&"x"in e&&"y"in e&&"z"in e){const t=e;return(0,n.hj)(t.x)&&(0,n.hj)(t.y)&&(0,n.hj)(t.z)}return!1}},70655:(e,t,i)=>{"use strict";i.d(t,{ZT:()=>s,pi:()=>r,_T:()=>o,mG:()=>a,Jh:()=>l,XA:()=>c,CR:()=>d,fl:()=>h,pr:()=>u});var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(e,t)};function s(e,t){function i(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(i.prototype=t.prototype,new i)}var r=function(){return(r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};function o(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(i[n[s]]=e[n[s]])}return i}function a(e,t,i,n){return new(i||(i=Promise))((function(s,r){function o(e){try{l(n.next(e))}catch(e){r(e)}}function a(e){try{l(n.throw(e))}catch(e){r(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))}function l(e,t){var i,n,s,r,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;o;)try{if(i=1,n&&(s=2&r[0]?n.return:r[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,r[1])).done)return s;switch(n=0,s&&(r=[2&r[0],s.value]),r[0]){case 0:case 1:s=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,n=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(!(s=o.trys,(s=s.length>0&&s[s.length-1])||6!==r[0]&&2!==r[0])){o=0;continue}if(3===r[0]&&(!s||r[1]>s[0]&&r[1]<s[3])){o.label=r[1];break}if(6===r[0]&&o.label<s[1]){o.label=s[1],s=r;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(r);break}s[2]&&o.ops.pop(),o.trys.pop();continue}r=t.call(e,o)}catch(e){r=[6,e],n=0}finally{i=s=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}function c(e){var t="function"==typeof Symbol&&Symbol.iterator,i=t&&e[t],n=0;if(i)return i.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function d(e,t){var i="function"==typeof Symbol&&e[Symbol.iterator];if(!i)return e;var n,s,r=i.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(n=r.next()).done;)o.push(n.value)}catch(e){s={error:e}}finally{try{n&&!n.done&&(i=r.return)&&i.call(r)}finally{if(s)throw s.error}}return o}function h(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(d(arguments[t]));return e}function u(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;var n=Array(e),s=0;for(t=0;t<i;t++)for(var r=arguments[t],o=0,a=r.length;o<a;o++,s++)n[s]=r[o];return n}},42238:function(e,t,i){var n;!function(s,r){"use strict";var o="function",a="undefined",l="object",c="model",d="name",h="type",u="vendor",p="version",m="architecture",f="console",g="mobile",v="tablet",y="smarttv",b="wearable",S={extend:function(e,t){var i={};for(var n in e)t[n]&&t[n].length%2==0?i[n]=t[n].concat(e[n]):i[n]=e[n];return i},has:function(e,t){return"string"==typeof e&&-1!==t.toLowerCase().indexOf(e.toLowerCase())},lowerize:function(e){return e.toLowerCase()},major:function(e){return"string"==typeof e?e.replace(/[^\d\.]/g,"").split(".")[0]:r},trim:function(e){return e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}},E={rgx:function(e,t){for(var i,n,s,a,c,d,h=0;h<t.length&&!c;){var u=t[h],p=t[h+1];for(i=n=0;i<u.length&&!c;)if(c=u[i++].exec(e))for(s=0;s<p.length;s++)d=c[++n],typeof(a=p[s])===l&&a.length>0?2==a.length?typeof a[1]==o?this[a[0]]=a[1].call(this,d):this[a[0]]=a[1]:3==a.length?typeof a[1]!==o||a[1].exec&&a[1].test?this[a[0]]=d?d.replace(a[1],a[2]):r:this[a[0]]=d?a[1].call(this,d,a[2]):r:4==a.length&&(this[a[0]]=d?a[3].call(this,d.replace(a[1],a[2])):r):this[a]=d||r;h+=2}},str:function(e,t){for(var i in t)if(typeof t[i]===l&&t[i].length>0){for(var n=0;n<t[i].length;n++)if(S.has(t[i][n],e))return"?"===i?r:i}else if(S.has(t[i],e))return"?"===i?r:i;return e}},T={browser:{oldsafari:{version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{amazon:{model:{"Fire Phone":["SD","KF"]}},sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"}}}},w={browser:[[/(opera\smini)\/([\w\.-]+)/i,/(opera\s[mobiletab]{3,6}).+version\/([\w\.-]+)/i,/(opera).+version\/([\w\.]+)/i,/(opera)[\/\s]+([\w\.]+)/i],[d,p],[/(opios)[\/\s]+([\w\.]+)/i],[[d,"Opera Mini"],p],[/\s(opr)\/([\w\.]+)/i],[[d,"Opera"],p],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?([\w\.]*)/i,/(avant\s|iemobile|slim)(?:browser)?[\/\s]?([\w\.]*)/i,/(bidubrowser|baidubrowser)[\/\s]?([\w\.]+)/i,/(?:ms|\()(ie)\s([\w\.]+)/i,/(rekonq)\/([\w\.]*)/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon)\/([\w\.-]+)/i],[d,p],[/(konqueror)\/([\w\.]+)/i],[[d,"Konqueror"],p],[/(trident).+rv[:\s]([\w\.]{1,9}).+like\sgecko/i],[[d,"IE"],p],[/(edge|edgios|edga|edg)\/((\d+)?[\w\.]+)/i],[[d,"Edge"],p],[/(yabrowser)\/([\w\.]+)/i],[[d,"Yandex"],p],[/(Avast)\/([\w\.]+)/i],[[d,"Avast Secure Browser"],p],[/(AVG)\/([\w\.]+)/i],[[d,"AVG Secure Browser"],p],[/(puffin)\/([\w\.]+)/i],[[d,"Puffin"],p],[/(focus)\/([\w\.]+)/i],[[d,"Firefox Focus"],p],[/(opt)\/([\w\.]+)/i],[[d,"Opera Touch"],p],[/((?:[\s\/])uc?\s?browser|(?:juc.+)ucweb)[\/\s]?([\w\.]+)/i],[[d,"UCBrowser"],p],[/(comodo_dragon)\/([\w\.]+)/i],[[d,/_/g," "],p],[/(windowswechat qbcore)\/([\w\.]+)/i],[[d,"WeChat(Win) Desktop"],p],[/(micromessenger)\/([\w\.]+)/i],[[d,"WeChat"],p],[/(brave)\/([\w\.]+)/i],[[d,"Brave"],p],[/(whale)\/([\w\.]+)/i],[[d,"Whale"],p],[/(qqbrowserlite)\/([\w\.]+)/i],[d,p],[/(QQ)\/([\d\.]+)/i],[d,p],[/m?(qqbrowser)[\/\s]?([\w\.]+)/i],[d,p],[/(baiduboxapp)[\/\s]?([\w\.]+)/i],[d,p],[/(2345Explorer)[\/\s]?([\w\.]+)/i],[d,p],[/(MetaSr)[\/\s]?([\w\.]+)/i],[d],[/(LBBROWSER)/i],[d],[/xiaomi\/miuibrowser\/([\w\.]+)/i],[p,[d,"MIUI Browser"]],[/;fbav\/([\w\.]+);/i],[p,[d,"Facebook"]],[/FBAN\/FBIOS|FB_IAB\/FB4A/i],[[d,"Facebook"]],[/safari\s(line)\/([\w\.]+)/i,/android.+(line)\/([\w\.]+)\/iab/i],[d,p],[/headlesschrome(?:\/([\w\.]+)|\s)/i],[p,[d,"Chrome Headless"]],[/\swv\).+(chrome)\/([\w\.]+)/i],[[d,/(.+)/,"$1 WebView"],p],[/((?:oculus|samsung)browser)\/([\w\.]+)/i],[[d,/(.+(?:g|us))(.+)/,"$1 $2"],p],[/android.+version\/([\w\.]+)\s+(?:mobile\s?safari|safari)*/i],[p,[d,"Android Browser"]],[/(sailfishbrowser)\/([\w\.]+)/i],[[d,"Sailfish Browser"],p],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?([\w\.]+)/i],[d,p],[/(dolfin)\/([\w\.]+)/i],[[d,"Dolphin"],p],[/(qihu|qhbrowser|qihoobrowser|360browser)/i],[[d,"360 Browser"]],[/((?:android.+)crmo|crios)\/([\w\.]+)/i],[[d,"Chrome"],p],[/(coast)\/([\w\.]+)/i],[[d,"Opera Coast"],p],[/fxios\/([\w\.-]+)/i],[p,[d,"Firefox"]],[/version\/([\w\.]+)\s.*mobile\/\w+\s(safari)/i],[p,[d,"Mobile Safari"]],[/version\/([\w\.]+)\s.*(mobile\s?safari|safari)/i],[p,d],[/webkit.+?(gsa)\/([\w\.]+)\s.*(mobile\s?safari|safari)(\/[\w\.]+)/i],[[d,"GSA"],p],[/webkit.+?(mobile\s?safari|safari)(\/[\w\.]+)/i],[d,[p,E.str,T.browser.oldsafari.version]],[/(webkit|khtml)\/([\w\.]+)/i],[d,p],[/(navigator|netscape)\/([\w\.-]+)/i],[[d,"Netscape"],p],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?([\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([\w\.-]+)$/i,/(firefox)\/([\w\.]+)\s[\w\s\-]+\/[\w\.]+$/i,/(mozilla)\/([\w\.]+)\s.+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir)[\/\s]?([\w\.]+)/i,/(links)\s\(([\w\.]+)/i,/(gobrowser)\/?([\w\.]*)/i,/(ice\s?browser)\/v?([\w\._]+)/i,/(mosaic)[\/\s]([\w\.]+)/i],[d,p]],cpu:[[/(?:(amd|x(?:(?:86|64)[_-])?|wow|win)64)[;\)]/i],[[m,"amd64"]],[/(ia32(?=;))/i],[[m,S.lowerize]],[/((?:i[346]|x)86)[;\)]/i],[[m,"ia32"]],[/windows\s(ce|mobile);\sppc;/i],[[m,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?:\smac|;|\))/i],[[m,/ower/,"",S.lowerize]],[/(sun4\w)[;\)]/i],[[m,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|arm(?:64|(?=v\d+[;l]))|(?=atmel\s)avr|(?:irix|mips|sparc)(?:64)?(?=;)|pa-risc)/i],[[m,S.lowerize]]],device:[[/\((ipad|playbook);[\w\s\),;-]+(rim|apple)/i],[c,u,[h,v]],[/applecoremedia\/[\w\.]+ \((ipad)/],[c,[u,"Apple"],[h,v]],[/(apple\s{0,1}tv)/i],[[c,"Apple TV"],[u,"Apple"],[h,y]],[/(archos)\s(gamepad2?)/i,/(hp).+(touchpad)/i,/(hp).+(tablet)/i,/(kindle)\/([\w\.]+)/i,/\s(nook)[\w\s]+build\/(\w+)/i,/(dell)\s(strea[kpr\s\d]*[\dko])/i],[u,c,[h,v]],[/(kf[A-z]+)(\sbuild\/|\)).+silk\//i],[c,[u,"Amazon"],[h,v]],[/(sd|kf)[0349hijorstuw]+(\sbuild\/|\)).+silk\//i],[[c,E.str,T.device.amazon.model],[u,"Amazon"],[h,g]],[/android.+aft([bms])\sbuild/i],[c,[u,"Amazon"],[h,y]],[/\((ip[honed|\s\w*]+);.+(apple)/i],[c,u,[h,g]],[/\((ip[honed|\s\w*]+);/i],[c,[u,"Apple"],[h,g]],[/(blackberry)[\s-]?(\w+)/i,/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[\s_-]?([\w-]*)/i,/(hp)\s([\w\s]+\w)/i,/(asus)-?(\w+)/i],[u,c,[h,g]],[/\(bb10;\s(\w+)/i],[c,[u,"BlackBerry"],[h,g]],[/android.+(transfo[prime\s]{4,10}\s\w+|eeepc|slider\s\w+|nexus 7|padfone|p00c)/i],[c,[u,"Asus"],[h,v]],[/(sony)\s(tablet\s[ps])\sbuild\//i,/(sony)?(?:sgp.+)\sbuild\//i],[[u,"Sony"],[c,"Xperia Tablet"],[h,v]],[/android.+\s([c-g]\d{4}|so[-l]\w+)(?=\sbuild\/|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[u,"Sony"],[h,g]],[/\s(ouya)\s/i,/(nintendo)\s([wids3u]+)/i],[u,c,[h,f]],[/android.+;\s(shield)\sbuild/i],[c,[u,"Nvidia"],[h,f]],[/(playstation\s[34portablevi]+)/i],[c,[u,"Sony"],[h,f]],[/(sprint\s(\w+))/i],[[u,E.str,T.device.sprint.vendor],[c,E.str,T.device.sprint.model],[h,g]],[/(htc)[;_\s-]{1,2}([\w\s]+(?=\)|\sbuild)|\w+)/i,/(zte)-(\w*)/i,/(alcatel|geeksphone|nexian|panasonic|(?=;\s)sony)[_\s-]?([\w-]*)/i],[u,[c,/_/g," "],[h,g]],[/(nexus\s9)/i],[c,[u,"HTC"],[h,v]],[/d\/huawei([\w\s-]+)[;\)]/i,/android.+\s(nexus\s6p|vog-[at]?l\d\d|ane-[at]?l[x\d]\d|eml-a?l\d\da?|lya-[at]?l\d[\dc]|clt-a?l\d\di?)/i],[c,[u,"Huawei"],[h,g]],[/android.+(bah2?-a?[lw]\d{2})/i],[c,[u,"Huawei"],[h,v]],[/(microsoft);\s(lumia[\s\w]+)/i],[u,c,[h,g]],[/[\s\(;](xbox(?:\sone)?)[\s\);]/i],[c,[u,"Microsoft"],[h,f]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[u,"Microsoft"],[h,g]],[/\s(milestone|droid(?:[2-4x]|\s(?:bionic|x2|pro|razr))?:?(\s4g)?)[\w\s]+build\//i,/mot[\s-]?(\w*)/i,/(XT\d{3,4}) build\//i,/(nexus\s6)/i],[c,[u,"Motorola"],[h,g]],[/android.+\s(mz60\d|xoom[\s2]{0,2})\sbuild\//i],[c,[u,"Motorola"],[h,v]],[/hbbtv\/\d+\.\d+\.\d+\s+\([\w\s]*;\s*(\w[^;]*);([^;]*)/i],[[u,S.trim],[c,S.trim],[h,y]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[u,"Samsung"],[h,y]],[/\(dtv[\);].+(aquos)/i],[c,[u,"Sharp"],[h,y]],[/android.+((sch-i[89]0\d|shw-m380s|SM-P605|SM-P610|gt-p\d{4}|gt-n\d+|sgh-t8[56]9|nexus 10))/i,/((SM-T\w+))/i],[[u,"Samsung"],c,[h,v]],[/smart-tv.+(samsung)/i],[u,[h,y],c],[/((s[cgp]h-\w+|gt-\w+|galaxy\snexus|sm-\w[\w\d]+))/i,/(sam[sung]*)[\s-]*(\w+-?[\w-]*)/i,/sec-((sgh\w+))/i],[[u,"Samsung"],c,[h,g]],[/sie-(\w*)/i],[c,[u,"Siemens"],[h,g]],[/(maemo|nokia).*(n900|lumia\s\d+)/i,/(nokia)[\s_-]?([\w-]*)/i],[[u,"Nokia"],c,[h,g]],[/android[x\d\.\s;]+\s([ab][1-7]\-?[0178a]\d\d?)/i],[c,[u,"Acer"],[h,v]],[/android.+([vl]k\-?\d{3})\s+build/i],[c,[u,"LG"],[h,v]],[/android\s3\.[\s\w;-]{10}(lg?)-([06cv9]{3,4})/i],[[u,"LG"],c,[h,v]],[/linux;\snetcast.+smarttv/i,/lg\snetcast\.tv-201\d/i],[[u,"LG"],c,[h,y]],[/(nexus\s[45])/i,/lg[e;\s\/-]+(\w*)/i,/android.+lg(\-?[\d\w]+)\s+build/i],[c,[u,"LG"],[h,g]],[/(lenovo)\s?(s(?:5000|6000)(?:[\w-]+)|tab(?:[\s\w]+))/i],[u,c,[h,v]],[/android.+(ideatab[a-z0-9\-\s]+)/i],[c,[u,"Lenovo"],[h,v]],[/(lenovo)[_\s-]?([\w-]+)/i],[u,c,[h,g]],[/linux;.+((jolla));/i],[u,c,[h,g]],[/((pebble))app\/[\d\.]+\s/i],[u,c,[h,b]],[/android.+;\s(oppo)\s?([\w\s]+)\sbuild/i],[u,c,[h,g]],[/crkey/i],[[c,"Chromecast"],[u,"Google"],[h,y]],[/android.+;\s(glass)\s\d/i],[c,[u,"Google"],[h,b]],[/android.+;\s(pixel c)[\s)]/i],[c,[u,"Google"],[h,v]],[/android.+;\s(pixel( [2-9]a?)?( xl)?)[\s)]/i],[c,[u,"Google"],[h,g]],[/android.+;\s(\w+)\s+build\/hm\1/i,/android.+(hm[\s\-_]?note?[\s_]?(?:\d\w)?)\sbuild/i,/android.+(redmi[\s\-_]?(?:note|k)?(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i,/android.+(mi[\s\-_]?(?:a\d|one|one[\s_]plus|note lte)?[\s_]?(?:\d?\w?)[\s_]?(?:plus)?)\sbuild/i],[[c,/_/g," "],[u,"Xiaomi"],[h,g]],[/android.+(mi[\s\-_]?(?:pad)(?:[\s_]?[\w\s]+))(?:\sbuild|\))/i],[[c,/_/g," "],[u,"Xiaomi"],[h,v]],[/android.+;\s(m[1-5]\snote)\sbuild/i],[c,[u,"Meizu"],[h,g]],[/(mz)-([\w-]{2,})/i],[[u,"Meizu"],c,[h,g]],[/android.+a000(1)\s+build/i,/android.+oneplus\s(a\d{4})[\s)]/i],[c,[u,"OnePlus"],[h,g]],[/android.+[;\/]\s*(RCT[\d\w]+)\s+build/i],[c,[u,"RCA"],[h,v]],[/android.+[;\/\s](Venue[\d\s]{2,7})\s+build/i],[c,[u,"Dell"],[h,v]],[/android.+[;\/]\s*(Q[T|M][\d\w]+)\s+build/i],[c,[u,"Verizon"],[h,v]],[/android.+[;\/]\s+(Barnes[&\s]+Noble\s+|BN[RT])(V?.*)\s+build/i],[[u,"Barnes & Noble"],c,[h,v]],[/android.+[;\/]\s+(TM\d{3}.*\b)\s+build/i],[c,[u,"NuVision"],[h,v]],[/android.+;\s(k88)\sbuild/i],[c,[u,"ZTE"],[h,v]],[/android.+[;\/]\s*(gen\d{3})\s+build.*49h/i],[c,[u,"Swiss"],[h,g]],[/android.+[;\/]\s*(zur\d{3})\s+build/i],[c,[u,"Swiss"],[h,v]],[/android.+[;\/]\s*((Zeki)?TB.*\b)\s+build/i],[c,[u,"Zeki"],[h,v]],[/(android).+[;\/]\s+([YR]\d{2})\s+build/i,/android.+[;\/]\s+(Dragon[\-\s]+Touch\s+|DT)(\w{5})\sbuild/i],[[u,"Dragon Touch"],c,[h,v]],[/android.+[;\/]\s*(NS-?\w{0,9})\sbuild/i],[c,[u,"Insignia"],[h,v]],[/android.+[;\/]\s*((NX|Next)-?\w{0,9})\s+build/i],[c,[u,"NextBook"],[h,v]],[/android.+[;\/]\s*(Xtreme\_)?(V(1[045]|2[015]|30|40|60|7[05]|90))\s+build/i],[[u,"Voice"],c,[h,g]],[/android.+[;\/]\s*(LVTEL\-)?(V1[12])\s+build/i],[[u,"LvTel"],c,[h,g]],[/android.+;\s(PH-1)\s/i],[c,[u,"Essential"],[h,g]],[/android.+[;\/]\s*(V(100MD|700NA|7011|917G).*\b)\s+build/i],[c,[u,"Envizen"],[h,v]],[/android.+[;\/]\s*(Le[\s\-]+Pan)[\s\-]+(\w{1,9})\s+build/i],[u,c,[h,v]],[/android.+[;\/]\s*(Trio[\s\w\-\.]+)\s+build/i],[c,[u,"MachSpeed"],[h,v]],[/android.+[;\/]\s*(Trinity)[\-\s]*(T\d{3})\s+build/i],[u,c,[h,v]],[/android.+[;\/]\s*TU_(1491)\s+build/i],[c,[u,"Rotor"],[h,v]],[/android.+(Gigaset)[\s\-]+(Q\w{1,9})\s+build/i],[u,c,[h,v]],[/android .+?; ([^;]+?)(?: build|\) applewebkit).+? mobile safari/i],[c,[h,g]],[/android .+?;\s([^;]+?)(?: build|\) applewebkit).+?(?! mobile) safari/i],[c,[h,v]],[/\s(tablet|tab)[;\/]/i,/\s(mobile)(?:[;\/]|\ssafari)/i],[[h,S.lowerize],u,c],[/[\s\/\(](smart-?tv)[;\)]/i],[[h,y]],[/(android[\w\.\s\-]{0,9});.+build/i],[c,[u,"Generic"]]],engine:[[/windows.+\sedge\/([\w\.]+)/i],[p,[d,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[p,[d,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[d,p],[/rv\:([\w\.]{1,9}).+(gecko)/i],[p,d]],os:[[/microsoft\s(windows)\s(vista|xp)/i],[d,p],[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*)[\s\/]?([\d\.\s\w]*)/i,/(windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[d,[p,E.str,T.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[d,"Windows"],[p,E.str,T.os.windows.version]],[/\((bb)(10);/i],[[d,"BlackBerry"],p],[/(blackberry)\w*\/?([\w\.]*)/i,/(tizen|kaios)[\/\s]([\w\.]+)/i,/(android|webos|palm\sos|qnx|bada|rim\stablet\sos|meego|sailfish|contiki)[\/\s-]?([\w\.]*)/i],[d,p],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]*)/i],[[d,"Symbian"],p],[/\((series40);/i],[d],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[d,"Firefox OS"],p],[/crkey\/([\d\.]+)/i],[p,[d,"Chromecast"]],[/(nintendo|playstation)\s([wids34portablevu]+)/i,/(mint)[\/\s\(]?(\w*)/i,/(mageia|vectorlinux)[;\s]/i,/(joli|[kxln]?ubuntu|debian|suse|opensuse|gentoo|(?=\s)arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk|linpus)[\/\s-]?(?!chrom)([\w\.-]*)/i,/(hurd|linux)\s?([\w\.]*)/i,/(gnu)\s?([\w\.]*)/i],[d,p],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[d,"Chromium OS"],p],[/(sunos)\s?([\w\.\d]*)/i],[[d,"Solaris"],p],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]*)/i],[d,p],[/(haiku)\s(\w+)/i],[d,p],[/cfnetwork\/.+darwin/i,/ip[honead]{2,4}(?:.*os\s([\w]+)\slike\smac|;\sopera)/i],[[p,/_/g,"."],[d,"iOS"]],[/(mac\sos\sx)\s?([\w\s\.]*)/i,/(macintosh|mac(?=_powerpc)\s)/i],[[d,"Mac OS"],[p,/_/g,"."]],[/((?:open)?solaris)[\/\s-]?([\w\.]*)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.])*/i,/(plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos|openvms|fuchsia)/i,/(unix)\s?([\w\.]*)/i],[d,p]]},x=function(e,t){if("object"==typeof e&&(t=e,e=r),!(this instanceof x))return new x(e,t).getResult();var i=e||(s&&s.navigator&&s.navigator.userAgent?s.navigator.userAgent:""),n=t?S.extend(w,t):w;return this.getBrowser=function(){var e={name:r,version:r};return E.rgx.call(e,i,n.browser),e.major=S.major(e.version),e},this.getCPU=function(){var e={architecture:r};return E.rgx.call(e,i,n.cpu),e},this.getDevice=function(){var e={vendor:r,model:r,type:r};return E.rgx.call(e,i,n.device),e},this.getEngine=function(){var e={name:r,version:r};return E.rgx.call(e,i,n.engine),e},this.getOS=function(){var e={name:r,version:r};return E.rgx.call(e,i,n.os),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return i},this.setUA=function(e){return i=e,this},this};x.VERSION="0.7.23",x.BROWSER={NAME:d,MAJOR:"major",VERSION:p},x.CPU={ARCHITECTURE:m},x.DEVICE={MODEL:c,VENDOR:u,TYPE:h,CONSOLE:f,MOBILE:g,SMARTTV:y,TABLET:v,WEARABLE:b,EMBEDDED:"embedded"},x.ENGINE={NAME:d,VERSION:p},x.OS={NAME:d,VERSION:p},typeof t!==a?(e.exports&&(t=e.exports=x),t.UAParser=x):(n=function(){return x}.call(t,i,t,e))===r||(e.exports=n);var _=s&&(s.jQuery||s.Zepto);if(_&&!_.ua){var M=new x;_.ua=M.getResult(),_.ua.get=function(){return M.getUA()},_.ua.set=function(e){M.setUA(e);var t=M.getResult();for(var i in t)_.ua[i]=t[i]}}}("object"==typeof window?window:this)},69436:e=>{function t(e,t,i,n){this.cx=3*e,this.bx=3*(i-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=n,this.p2x=i,this.p2y=n}e.exports=t,t.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},t.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},t.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},t.prototype.solveCurveX=function(e,t){var i,n,s,r,o;for(void 0===t&&(t=1e-6),s=e,o=0;o<8;o++){if(r=this.sampleCurveX(s)-e,Math.abs(r)<t)return s;var a=this.sampleCurveDerivativeX(s);if(Math.abs(a)<1e-6)break;s-=r/a}if((s=e)<(i=0))return i;if(s>(n=1))return n;for(;i<n;){if(r=this.sampleCurveX(s),Math.abs(r-e)<t)return s;e>r?i=s:n=s,s=.5*(n-i)+i}return s},t.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},52511:function(e,t,i){var n;e=i.nmd(e),function(s){t&&t.nodeType,e&&e.nodeType;var r="object"==typeof i.g&&i.g;r.global!==r&&r.window!==r&&r.self;var o,a=2147483647,l=36,c=/^xn--/,d=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,m=String.fromCharCode;function f(e){throw RangeError(u[e])}function g(e,t){for(var i=e.length,n=[];i--;)n[i]=t(e[i]);return n}function v(e,t){var i=e.split("@"),n="";return i.length>1&&(n=i[0]+"@",e=i[1]),n+g((e=e.replace(h,".")).split("."),t).join(".")}function y(e){for(var t,i,n=[],s=0,r=e.length;s<r;)(t=e.charCodeAt(s++))>=55296&&t<=56319&&s<r?56320==(64512&(i=e.charCodeAt(s++)))?n.push(((1023&t)<<10)+(1023&i)+65536):(n.push(t),s--):n.push(t);return n}function b(e){return g(e,(function(e){var t="";return e>65535&&(t+=m((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=m(e)})).join("")}function S(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function E(e,t,i){var n=0;for(e=i?p(e/700):e>>1,e+=p(e/t);e>455;n+=l)e=p(e/35);return p(n+36*e/(e+38))}function T(e){var t,i,n,s,r,o,c,d,h,u,m,g=[],v=e.length,y=0,S=128,T=72;for((i=e.lastIndexOf("-"))<0&&(i=0),n=0;n<i;++n)e.charCodeAt(n)>=128&&f("not-basic"),g.push(e.charCodeAt(n));for(s=i>0?i+1:0;s<v;){for(r=y,o=1,c=l;s>=v&&f("invalid-input"),((d=(m=e.charCodeAt(s++))-48<10?m-22:m-65<26?m-65:m-97<26?m-97:l)>=l||d>p((a-y)/o))&&f("overflow"),y+=d*o,!(d<(h=c<=T?1:c>=T+26?26:c-T));c+=l)o>p(a/(u=l-h))&&f("overflow"),o*=u;T=E(y-r,t=g.length+1,0==r),p(y/t)>a-S&&f("overflow"),S+=p(y/t),y%=t,g.splice(y++,0,S)}return b(g)}function w(e){var t,i,n,s,r,o,c,d,h,u,g,v,b,T,w,x=[];for(v=(e=y(e)).length,t=128,i=0,r=72,o=0;o<v;++o)(g=e[o])<128&&x.push(m(g));for(n=s=x.length,s&&x.push("-");n<v;){for(c=a,o=0;o<v;++o)(g=e[o])>=t&&g<c&&(c=g);for(c-t>p((a-i)/(b=n+1))&&f("overflow"),i+=(c-t)*b,t=c,o=0;o<v;++o)if((g=e[o])<t&&++i>a&&f("overflow"),g==t){for(d=i,h=l;!(d<(u=h<=r?1:h>=r+26?26:h-r));h+=l)w=d-u,T=l-u,x.push(m(S(u+w%T,0))),d=p(w/T);x.push(m(S(d,0))),r=E(i,b,n==s),i=0,++n}++i,++t}return x.join("")}o={version:"1.3.2",ucs2:{decode:y,encode:b},decode:T,encode:w,toASCII:function(e){return v(e,(function(e){return d.test(e)?"xn--"+w(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?T(e.slice(4).toLowerCase()):e}))}},void 0===(n=function(){return o}.call(t,i,t,e))||(e.exports=n)}()},27225:e=>{"use strict";function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,i,n,s){i=i||"&",n=n||"=";var r={};if("string"!=typeof e||0===e.length)return r;var o=/\+/g;e=e.split(i);var a=1e3;s&&"number"==typeof s.maxKeys&&(a=s.maxKeys);var l=e.length;a>0&&l>a&&(l=a);for(var c=0;c<l;++c){var d,h,u,p,m=e[c].replace(o,"%20"),f=m.indexOf(n);f>=0?(d=m.substr(0,f),h=m.substr(f+1)):(d=m,h=""),u=decodeURIComponent(d),p=decodeURIComponent(h),t(r,u)?Array.isArray(r[u])?r[u].push(p):r[u]=[r[u],p]:r[u]=p}return r}},44066:e=>{"use strict";var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,i,n,s){return i=i||"&",n=n||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((function(s){var r=encodeURIComponent(t(s))+n;return Array.isArray(e[s])?e[s].map((function(e){return r+encodeURIComponent(t(e))})).join(i):r+encodeURIComponent(t(e[s]))})).join(i):s?encodeURIComponent(t(s))+n+encodeURIComponent(t(e)):""}},36254:(e,t,i)=>{"use strict";t.decode=t.parse=i(27225),t.encode=t.stringify=i(44066)},8575:(e,t,i)=>{"use strict";var n=i(52511),s=i(62502);function r(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.Qc=b;var o=/^([a-z0-9.+-]+:)/i,a=/:[0-9]*$/,l=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),d=["'"].concat(c),h=["%","/","?",";","#"].concat(d),u=["/","?","#"],p=/^[+a-z0-9A-Z_-]{0,63}$/,m=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,f={javascript:!0,"javascript:":!0},g={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},y=i(36254);function b(e,t,i){if(e&&s.isObject(e)&&e instanceof r)return e;var n=new r;return n.parse(e,t,i),n}r.prototype.parse=function(e,t,i){if(!s.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var r=e.indexOf("?"),a=-1!==r&&r<e.indexOf("#")?"?":"#",c=e.split(a);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(a);if(b=b.trim(),!i&&1===e.split("#").length){var S=l.exec(b);if(S)return this.path=b,this.href=b,this.pathname=S[1],S[2]?(this.search=S[2],this.query=t?y.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var E=o.exec(b);if(E){var T=(E=E[0]).toLowerCase();this.protocol=T,b=b.substr(E.length)}if(i||E||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var w="//"===b.substr(0,2);!w||E&&g[E]||(b=b.substr(2),this.slashes=!0)}if(!g[E]&&(w||E&&!v[E])){for(var x,_,M=-1,O=0;O<u.length;O++){-1!==(A=b.indexOf(u[O]))&&(-1===M||A<M)&&(M=A)}-1!==(_=-1===M?b.lastIndexOf("@"):b.lastIndexOf("@",M))&&(x=b.slice(0,_),b=b.slice(_+1),this.auth=decodeURIComponent(x)),M=-1;for(O=0;O<h.length;O++){var A;-1!==(A=b.indexOf(h[O]))&&(-1===M||A<M)&&(M=A)}-1===M&&(M=b.length),this.host=b.slice(0,M),b=b.slice(M),this.parseHost(),this.hostname=this.hostname||"";var C="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!C)for(var P=this.hostname.split(/\./),D=(O=0,P.length);O<D;O++){var N=P[O];if(N&&!N.match(p)){for(var I="",L=0,R=N.length;L<R;L++)N.charCodeAt(L)>127?I+="x":I+=N[L];if(!I.match(p)){var k=P.slice(0,O),U=P.slice(O+1),B=N.match(m);B&&(k.push(B[1]),U.unshift(B[2])),U.length&&(b="/"+U.join(".")+b),this.hostname=k.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),C||(this.hostname=n.toASCII(this.hostname));var F=this.port?":"+this.port:"",V=this.hostname||"";this.host=V+F,this.href+=this.host,C&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!f[T])for(O=0,D=d.length;O<D;O++){var H=d[O];if(-1!==b.indexOf(H)){var j=encodeURIComponent(H);j===H&&(j=escape(H)),b=b.split(H).join(j)}}var G=b.indexOf("#");-1!==G&&(this.hash=b.substr(G),b=b.slice(0,G));var z=b.indexOf("?");if(-1!==z?(this.search=b.substr(z),this.query=b.substr(z+1),t&&(this.query=y.parse(this.query)),b=b.slice(0,z)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[T]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){F=this.pathname||"";var W=this.search||"";this.path=F+W}return this.href=this.format(),this},r.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",i=this.pathname||"",n=this.hash||"",r=!1,o="";this.host?r=e+this.host:this.hostname&&(r=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(r+=":"+this.port)),this.query&&s.isObject(this.query)&&Object.keys(this.query).length&&(o=y.stringify(this.query));var a=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==r?(r="//"+(r||""),i&&"/"!==i.charAt(0)&&(i="/"+i)):r||(r=""),n&&"#"!==n.charAt(0)&&(n="#"+n),a&&"?"!==a.charAt(0)&&(a="?"+a),t+r+(i=i.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(a=a.replace("#","%23"))+n},r.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},r.prototype.resolveObject=function(e){if(s.isString(e)){var t=new r;t.parse(e,!1,!0),e=t}for(var i=new r,n=Object.keys(this),o=0;o<n.length;o++){var a=n[o];i[a]=this[a]}if(i.hash=e.hash,""===e.href)return i.href=i.format(),i;if(e.slashes&&!e.protocol){for(var l=Object.keys(e),c=0;c<l.length;c++){var d=l[c];"protocol"!==d&&(i[d]=e[d])}return v[i.protocol]&&i.hostname&&!i.pathname&&(i.path=i.pathname="/"),i.href=i.format(),i}if(e.protocol&&e.protocol!==i.protocol){if(!v[e.protocol]){for(var h=Object.keys(e),u=0;u<h.length;u++){var p=h[u];i[p]=e[p]}return i.href=i.format(),i}if(i.protocol=e.protocol,e.host||g[e.protocol])i.pathname=e.pathname;else{for(var m=(e.pathname||"").split("/");m.length&&!(e.host=m.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==m[0]&&m.unshift(""),m.length<2&&m.unshift(""),i.pathname=m.join("/")}if(i.search=e.search,i.query=e.query,i.host=e.host||"",i.auth=e.auth,i.hostname=e.hostname||e.host,i.port=e.port,i.pathname||i.search){var f=i.pathname||"",y=i.search||"";i.path=f+y}return i.slashes=i.slashes||e.slashes,i.href=i.format(),i}var b=i.pathname&&"/"===i.pathname.charAt(0),S=e.host||e.pathname&&"/"===e.pathname.charAt(0),E=S||b||i.host&&e.pathname,T=E,w=i.pathname&&i.pathname.split("/")||[],x=(m=e.pathname&&e.pathname.split("/")||[],i.protocol&&!v[i.protocol]);if(x&&(i.hostname="",i.port=null,i.host&&(""===w[0]?w[0]=i.host:w.unshift(i.host)),i.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===m[0]?m[0]=e.host:m.unshift(e.host)),e.host=null),E=E&&(""===m[0]||""===w[0])),S)i.host=e.host||""===e.host?e.host:i.host,i.hostname=e.hostname||""===e.hostname?e.hostname:i.hostname,i.search=e.search,i.query=e.query,w=m;else if(m.length)w||(w=[]),w.pop(),w=w.concat(m),i.search=e.search,i.query=e.query;else if(!s.isNullOrUndefined(e.search)){if(x)i.hostname=i.host=w.shift(),(C=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=C.shift(),i.host=i.hostname=C.shift());return i.search=e.search,i.query=e.query,s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.href=i.format(),i}if(!w.length)return i.pathname=null,i.search?i.path="/"+i.search:i.path=null,i.href=i.format(),i;for(var _=w.slice(-1)[0],M=(i.host||e.host||w.length>1)&&("."===_||".."===_)||""===_,O=0,A=w.length;A>=0;A--)"."===(_=w[A])?w.splice(A,1):".."===_?(w.splice(A,1),O++):O&&(w.splice(A,1),O--);if(!E&&!T)for(;O--;O)w.unshift("..");!E||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),M&&"/"!==w.join("/").substr(-1)&&w.push("");var C,P=""===w[0]||w[0]&&"/"===w[0].charAt(0);x&&(i.hostname=i.host=P?"":w.length?w.shift():"",(C=!!(i.host&&i.host.indexOf("@")>0)&&i.host.split("@"))&&(i.auth=C.shift(),i.host=i.hostname=C.shift()));return(E=E||i.host&&w.length)&&!P&&w.unshift(""),w.length?i.pathname=w.join("/"):(i.pathname=null,i.path=null),s.isNull(i.pathname)&&s.isNull(i.search)||(i.path=(i.pathname?i.pathname:"")+(i.search?i.search:"")),i.auth=e.auth||i.auth,i.slashes=i.slashes||e.slashes,i.href=i.format(),i},r.prototype.parseHost=function(){var e=this.host,t=a.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},62502:e=>{"use strict";e.exports={isString:function(e){return"string"==typeof e},isObject:function(e){return"object"==typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},42473:e=>{"use strict";var t=function(){};e.exports=t},2209:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float opacity;uniform vec3 color;uniform sampler2D bg;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);gl_FragColor=vec4(bgColor.rgb,bgColor.a*opacity);}"},64116:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 diffuse;uniform float opacity;uniform sampler2D mask;\n#ifdef USE_DASH\nuniform float dashSize;uniform float gapSize;\n#endif\nvarying float vLineDistance;\n#include <common>\nvarying vec2 vUv;void main(){\n#ifdef USE_DASH\nif(vUv.y<-1.||vUv.y>1.)discard;if(mod(vLineDistance,dashSize+gapSize)>dashSize)discard;\n#endif\n#ifdef USE_MASK\nvec2 modUv=vec2(vUv);modUv*=2.;vec4 texelColor=texture2D(mask,modUv);gl_FragColor=vec4(texelColor.rgb,min(texelColor.a,opacity));\n#else\ngl_FragColor=vec4(diffuse,opacity);\n#endif\n}"},63862:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#include <common>\nuniform float linewidth;uniform vec2 resolution;attribute vec3 instanceStart;attribute vec3 instanceEnd;attribute vec3 instanceColorStart;attribute vec3 instanceColorEnd;varying vec2 vUv;\n#ifdef USE_DASH\nuniform float dashScale;attribute float instanceDistanceStart;attribute float instanceDistanceEnd;varying float vLineDistance;\n#endif\nvoid trimSegment(const in vec4 start,inout vec4 end){float a=projectionMatrix[2][2];float b=projectionMatrix[3][2];float nearEstimate=-0.5*b/a;float alpha=(nearEstimate-start.z)/(end.z-start.z);end.xyz=mix(start.xyz,end.xyz,alpha);}void main(){\n#ifdef USE_COLOR\nvColor.xyz=(position.y<0.5)?instanceColorStart:instanceColorEnd;\n#endif\n#ifdef USE_DASH\nvLineDistance=(position.y<0.5)?dashScale*instanceDistanceStart:dashScale*instanceDistanceEnd;\n#endif\nfloat aspect=resolution.x/resolution.y;vUv=uv;vec4 start=modelViewMatrix*vec4(instanceStart,1.);vec4 end=modelViewMatrix*vec4(instanceEnd,1.);bool perspective=(projectionMatrix[2][3]==-1.);if(perspective){if(start.z<0.&&end.z>=0.){trimSegment(start,end);}else if(end.z<0.&&start.z>=0.){trimSegment(end,start);}}vec4 clipStart=projectionMatrix*start;vec4 clipEnd=projectionMatrix*end;vec2 ndcStart=clipStart.xy/clipStart.w;vec2 ndcEnd=clipEnd.xy/clipEnd.w;vec2 dir=ndcEnd-ndcStart;dir.x*=aspect;dir=normalize(dir);vec2 offset=vec2(dir.y,-dir.x);dir.x/=aspect;offset.x/=aspect;if(position.x<0.)offset*=-1.;offset*=linewidth;offset/=resolution.y;vec4 clip=(position.y<0.5)?clipStart:clipEnd;\n#ifdef USE_MASK\noffset*=(clipEnd.w+clipStart.w)*0.5;\n#else\noffset*=clip.w;\n#endif\nclip.xy+=offset;gl_Position=clip;\n#include <worldpos_vertex>\n}"},48326:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform samplerCube map;uniform vec2 dir;varying vec3 vWorldPosition;vec3 sphereToUnit(float x,float y){return vec3(sin(x)*cos(y),cos(x),sin(x)*sin(y));}vec2 unitToSphere(vec3 unit){return vec2(atan(sqrt(pow(unit.x,2.)+pow(unit.z,2.)),unit.y),atan(unit.z,unit.x));}void main(){vec2 coord=unitToSphere(vWorldPosition);vec4 sum=textureCube(map,sphereToUnit(coord.x-12.*dir.x,coord.y-12.*dir.y))*KERNEL_1;sum+=textureCube(map,sphereToUnit(coord.x-11.*dir.x,coord.y-11.*dir.y))*KERNEL_2;sum+=textureCube(map,sphereToUnit(coord.x-10.*dir.x,coord.y-10.*dir.y))*KERNEL_3;sum+=textureCube(map,sphereToUnit(coord.x-9.*dir.x,coord.y-9.*dir.y))*KERNEL_4;sum+=textureCube(map,sphereToUnit(coord.x-8.*dir.x,coord.y-8.*dir.y))*KERNEL_5;sum+=textureCube(map,sphereToUnit(coord.x-7.*dir.x,coord.y-7.*dir.y))*KERNEL_6;sum+=textureCube(map,sphereToUnit(coord.x-6.*dir.x,coord.y-6.*dir.y))*KERNEL_7;sum+=textureCube(map,sphereToUnit(coord.x-5.*dir.x,coord.y-5.*dir.y))*KERNEL_8;sum+=textureCube(map,sphereToUnit(coord.x-4.*dir.x,coord.y-4.*dir.y))*KERNEL_9;sum+=textureCube(map,sphereToUnit(coord.x-3.*dir.x,coord.y-3.*dir.y))*KERNEL_10;sum+=textureCube(map,sphereToUnit(coord.x-2.*dir.x,coord.y-2.*dir.y))*KERNEL_11;sum+=textureCube(map,sphereToUnit(coord.x-1.*dir.x,coord.y-1.*dir.y))*KERNEL_12;sum+=textureCube(map,sphereToUnit(coord.x,coord.y))*KERNEL_13;sum+=textureCube(map,sphereToUnit(coord.x+1.*dir.x,coord.y+1.*dir.y))*KERNEL_14;sum+=textureCube(map,sphereToUnit(coord.x+2.*dir.x,coord.y+2.*dir.y))*KERNEL_15;sum+=textureCube(map,sphereToUnit(coord.x+3.*dir.x,coord.y+3.*dir.y))*KERNEL_16;sum+=textureCube(map,sphereToUnit(coord.x+4.*dir.x,coord.y+4.*dir.y))*KERNEL_17;sum+=textureCube(map,sphereToUnit(coord.x+5.*dir.x,coord.y+5.*dir.y))*KERNEL_18;sum+=textureCube(map,sphereToUnit(coord.x+6.*dir.x,coord.y+6.*dir.y))*KERNEL_19;sum+=textureCube(map,sphereToUnit(coord.x+7.*dir.x,coord.y+7.*dir.y))*KERNEL_20;sum+=textureCube(map,sphereToUnit(coord.x+8.*dir.x,coord.y+8.*dir.y))*KERNEL_21;sum+=textureCube(map,sphereToUnit(coord.x+9.*dir.x,coord.y+9.*dir.y))*KERNEL_22;sum+=textureCube(map,sphereToUnit(coord.x+10.*dir.x,coord.y+10.*dir.y))*KERNEL_23;sum+=textureCube(map,sphereToUnit(coord.x+11.*dir.x,coord.y+11.*dir.y))*KERNEL_24;sum+=textureCube(map,sphereToUnit(coord.x+12.*dir.x,coord.y+12.*dir.y))*KERNEL_25;gl_FragColor=sum;}"},25247:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},59253:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform samplerCube map;uniform float opacity;varying vec3 vWorldPosition;void main(){vec4 color=textureCube(map,vec3(-vWorldPosition.x,vWorldPosition.yz));gl_FragColor=vec4(color.rgb,opacity);}"},54124:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec3 vWorldPosition;void main(){vWorldPosition=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},24074:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 color;uniform float opacity;uniform float maxDistance;varying vec3 vWorldPosition;void main(){float distanceToCamera=distance(cameraPosition,vWorldPosition);float distanceBucketed=1.-clamp(distanceToCamera/maxDistance,0.,1.);if(opacity<1.){discard;}gl_FragColor=vec4(distanceBucketed,distanceBucketed,distanceBucketed,1.);}"},27409:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec3 vWorldPosition;void main(){vWorldPosition=(modelMatrix*vec4(position,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},96432:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform sampler2D map;uniform float opacity;uniform vec4 colorOverlay;varying vec2 vUv;vec4 white=vec4(0.8,0.8,0.8,1.);vec4 black=vec4(0.,0.,0.,1.);void main(){vec4 colorFromTexture=texture2D(map,vUv);float whiteness=1.-smoothstep(0.1,0.2,opacity);colorFromTexture=mix(colorFromTexture,vec4(colorOverlay.rgb,1.),colorOverlay.a);colorFromTexture=mix(colorFromTexture,white,whiteness);gl_FragColor=vec4(colorFromTexture.rgb,opacity);}"},10982:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},40933:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;\n#define MAX_TRIMS_PER_FLOOR  10\n#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform samplerCube pano0Map;varying vec3 pano0SweepDirection;uniform float panoOpacity;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform float progress;uniform vec3 pano1Position;uniform samplerCube pano1Map;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nuniform samplerCube overlay0Map;varying vec3 overlay0WorldPos;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nuniform samplerCube overlay1Map;varying vec3 overlay1WorldPos;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nuniform vec3 meshPreviewCenter;uniform float meshPreviewSize;\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;uniform sampler2D map;uniform float meshOpacity;uniform float opacity;uniform float transparentDiscardDist;varying vec3 worldPos;\n#ifdef MESH_TRIM_VERTEX\nvarying vec3 trimPos[MAX_TRIMS_PER_FLOOR];uniform bool meshTrimsDiscardContents[MAX_TRIMS_PER_FLOOR];uniform bool hasKeepVolume;\n#endif\n#ifdef MESH_TRIM_PIXEL\nuniform mat4 meshTrimMatrices[MAX_TRIMS_PER_FLOOR];uniform bool meshTrimsDiscardContents[MAX_TRIMS_PER_FLOOR];uniform bool hasKeepVolume;\n#endif\n#endif\n#ifdef COLOR_OVERLAY\nuniform vec4 colorOverlay;\n#endif\n#ifdef WIREFRAME\nvarying vec3 vBarycentric;uniform float time;uniform float thickness;uniform float secondThickness;uniform float dashRepeats;uniform float dashLength;uniform bool dashOverlap;uniform bool dashEnabled;uniform bool dashAnimate;uniform bool fillEnabled;uniform bool insideAltColor;uniform bool dualStroke;uniform bool squeeze;uniform float squeezeMin;uniform float squeezeMax;uniform float wireframeOpacity;uniform vec3 stroke;uniform vec3 fill;float aastep(float threshold,float dist){float afwidth=fwidth(dist)*0.5;return smoothstep(threshold-afwidth,threshold+afwidth,dist);}float computeScreenSpaceWireframe(vec3 barycentric,float lineWidth){vec3 dist=fwidth(barycentric);vec3 smoothed=smoothstep(dist*((lineWidth*0.5)-0.5),dist*((lineWidth*0.5)+0.5),barycentric);return 1.-min(min(smoothed.x,smoothed.y),smoothed.z);}vec4 getStyledWireframe(vec3 barycentric){float PI=3.14159265359;float d=min(min(barycentric.x,barycentric.y),barycentric.z);float positionAlong=max(barycentric.x,barycentric.y);if(barycentric.y<barycentric.x&&barycentric.y<barycentric.z){positionAlong=1.-positionAlong;}float computedThickness=thickness;if(squeeze){computedThickness*=mix(squeezeMin,squeezeMax,(1.-sin(positionAlong*PI)));}if(dashEnabled){float offset=1./dashRepeats*dashLength/2.;if(!dashOverlap){offset+=1./dashRepeats/2.;}if(dashAnimate){offset+=time*0.22;}float pattern=fract((positionAlong+offset)*dashRepeats);computedThickness*=1.-aastep(dashLength,pattern);}float edge=computeScreenSpaceWireframe(barycentric,computedThickness);vec4 outColor=vec4(0.,0.,0.,0.);if(!fillEnabled){outColor=vec4(stroke,edge);if(insideAltColor&&!gl_FrontFacing){outColor.rgb=fill;}}else{outColor.a=1.;if(dualStroke){float inner=1.-aastep(secondThickness,d);vec3 wireColor=mix(fill,stroke,abs(inner-edge));outColor.rgb=wireColor;}else{outColor.rgb=mix(fill,stroke,edge);}}outColor.a*=wireframeOpacity;return outColor;}\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){\n#ifdef PANO_TEXTURE_TRANSITION\nvec4 colorFromPano0=textureCube(pano0Map,pano0SweepDirection.xyz);vec4 colorFromPano1=textureCube(pano1Map,pano1SweepDirection.xyz);\n#ifdef PANO_OVERLAY_TRANSITION\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);vec4 colorFromOverlay1=textureCube(overlay1Map,overlay1WorldPos.xyz);colorFromPano0.rgb=mix(colorFromPano0.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);colorFromPano1.rgb=mix(colorFromPano1.rgb,colorFromOverlay1.rgb,colorFromOverlay1.a);\n#endif\nvec4 color=mix(colorFromPano0,colorFromPano1,progress);color.a=panoOpacity;\n#elif defined(PANO_TEXTURE)\nvec4 color=textureCube(pano0Map,pano0SweepDirection.xyz);\n#ifdef PANO_OVERLAY\nvec4 colorFromOverlay0=textureCube(overlay0Map,overlay0WorldPos.xyz);color.rgb=mix(color.rgb,colorFromOverlay0.rgb,colorFromOverlay0.a);\n#endif\ncolor.a=panoOpacity;\n#else\nvec4 color=vec4(0.,0.,0.,0.);\n#endif\n#ifdef MESH_TEXTURE\nvec4 colorFromTexture=texture2D(map,vUv);float depth=distance(cameraPosition,worldPos.xyz);if(opacity<1.&&depth<transparentDiscardDist){discard;}\n#endif\n#ifdef MESH_PREVIEW_SPHERE\nfloat previewDistance=distance(worldPos.xyz,meshPreviewCenter.xyz);float inSphere=step(previewDistance,meshPreviewSize);colorFromTexture+=colorFromTexture*(0.2*inSphere);color=mix(color,colorFromTexture,max(meshOpacity,inSphere));\n#elif defined(MESH_TEXTURE)\ncolor=mix(color,colorFromTexture,meshOpacity);\n#endif\n#ifdef FLAT_SHADING\nfloat ao=0.9-abs(vNormal.y)*0.1-abs(vNormal.x)*0.05+abs(vNormal.z)*0.05;color.rgb=vec3(ao,ao*1.025,ao*1.05);\n#endif\n#ifdef COLOR_OVERLAY\ncolor=mix(color,vec4(colorOverlay.rgb,1.),colorOverlay.a);\n#endif\n#ifdef WIREFRAME\nvec4 colorFromWireframe=getStyledWireframe(vBarycentric);color=mix(color,vec4(colorFromWireframe.rgb,1.),colorFromWireframe.a);\n#endif\n#ifdef MESH_TEXTURE\ncolor.a=opacity;\n#if defined(MESH_TRIM_VERTEX) || defined(MESH_TRIM_PIXEL)\nbool isWithinVolume=false;bool doKeepFragment=true;bool enabled=true;vec4 worldPos4=vec4(worldPos.xyz,1);vec3 compare=vec3(0.5);\n#pragma unroll_loop_start\nfor(int i=0;i<10;i++){\n#ifdef MESH_TRIM_VERTEX\nenabled=!all(equal(trimPos[UNROLLED_LOOP_INDEX],vec3(0.)));if(enabled){if(all(lessThan(abs(trimPos[UNROLLED_LOOP_INDEX]),compare))){isWithinVolume=true;if(meshTrimsDiscardContents[UNROLLED_LOOP_INDEX]){doKeepFragment=false;}}}\n#endif\n#ifdef MESH_TRIM_PIXEL\nenabled=meshTrimMatrices[UNROLLED_LOOP_INDEX][3][3]>0.;if(enabled){if(all(lessThan(abs((meshTrimMatrices[UNROLLED_LOOP_INDEX]*worldPos4).xyz),compare))){isWithinVolume=true;if(meshTrimsDiscardContents[UNROLLED_LOOP_INDEX]){doKeepFragment=false;}}}\n#endif\n}\n#pragma unroll_loop_end\nif(!isWithinVolume&&hasKeepVolume){discard;}else if(isWithinVolume&&!doKeepFragment){discard;}\n#endif\n#endif\ngl_FragColor=color;}"},57971:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#define MAX_TRIMS_PER_FLOOR  10\n#ifdef PANO_TEXTURE\nuniform vec3 pano0Position;uniform mat4 pano0Matrix1;uniform mat4 pano0Matrix2;varying vec3 pano0SweepDirection;\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nuniform vec3 pano1Position;uniform mat4 pano1Matrix1;uniform mat4 pano1Matrix2;varying vec3 pano1SweepDirection;\n#endif\n#ifdef PANO_OVERLAY\nvarying vec3 overlay0WorldPos;uniform mat4 overlay0Matrix;\n#endif\n#ifdef PANO_OVERLAY_TRANSITION\nvarying vec3 overlay1WorldPos;uniform mat4 overlay1Matrix;\n#endif\n#ifdef MESH_PREVIEW_SPHERE\n#endif\n#ifdef MESH_TEXTURE\nvarying vec2 vUv;varying vec3 worldPos;\n#ifdef MESH_TRIM_VERTEX\nuniform mat4 meshTrimMatrices[MAX_TRIMS_PER_FLOOR];varying vec3 trimPos[MAX_TRIMS_PER_FLOOR];\n#endif\n#endif\n#ifdef WIREFRAME\nattribute vec3 barycentric;varying vec3 vBarycentric;\n#endif\n#ifdef FLAT_SHADING\nvarying vec3 vNormal;\n#endif\nvoid main(){vec4 worldPosition=modelMatrix*vec4(position,1.);\n#ifdef MESH_TEXTURE\nvUv=uv;worldPos=worldPosition.xyz;\n#ifdef MESH_TRIM_VERTEX\n#pragma unroll_loop_start\nfor(int i=0;i<10;i++){trimPos[UNROLLED_LOOP_INDEX]=(meshTrimMatrices[UNROLLED_LOOP_INDEX]*vec4(worldPos,1.)).xyz;}\n#pragma unroll_loop_end    \n#endif\n#endif\n#ifdef WIREFRAME\nvBarycentric=barycentric;\n#endif\n#ifdef FLAT_SHADING\nvNormal=normal;\n#endif\n#ifdef PANO_TEXTURE\nvec3 positionLocalToPanoCenter0=worldPosition.xyz-pano0Position;pano0SweepDirection=(pano0Matrix2*pano0Matrix1*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#ifdef PANO_OVERLAY\noverlay0WorldPos=(overlay0Matrix*vec4(positionLocalToPanoCenter0,1.)).xyz;\n#endif\n#endif\n#ifdef PANO_TEXTURE_TRANSITION\nvec3 positionLocalToPanoCenter1=worldPosition.xyz-pano1Position;pano1SweepDirection=(pano1Matrix2*pano1Matrix1*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#ifdef PANO_OVERLAY_TRANSITION\noverlay1WorldPos=(overlay1Matrix*vec4(positionLocalToPanoCenter1,1.)).xyz;\n#endif\n#endif\nvec4 projectedPosition=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},57223:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float borderSize;uniform float textureSampleScale;uniform samplerCube panoTexture;uniform vec4 borderColor;varying vec2 vUv;const vec4 transparent=vec4(0.,0.,0.,0.);const float PI=3.14159265359;const float HALF_PI=PI/2.;void main(){float fadeDist=0.1;float r=1.;vec2 uv=(vUv*2.)-vec2(1.,1.);float d=length(uv);float p=d*PI-HALF_PI;float y=sin(p);float h=cos(p)*textureSampleScale;vec3 sampleVec=vec3(uv.x*h,y,uv.y*h);vec4 panoColor=textureCube(panoTexture,sampleVec);panoColor.a=clamp(((1.-d)/d)/fadeDist,0.,1.);vec4 outColor=mix(panoColor,transparent,step(1.,d));float isBorder=max(sign(borderSize),0.)*step(1.-borderSize,d)*step(d,1.);gl_FragColor=mix(outColor,borderColor,isBorder);}"},74624:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;vec4 projectedPosition=projectionMatrix*viewMatrix*modelMatrix*vec4(position,1.);gl_Position=projectedPosition;}"},14499:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 existingColor=texture2D(bg,vUv);vec4 maskColor=texture2D(mask,vUv);gl_FragColor=vec4(existingColor.rgb*maskColor.rgb,maskColor.a);}"},47151:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},54779:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform sampler2D texture;varying vec2 vUv;void main(){vec4 color=texture2D(texture,vUv);gl_FragColor=vec4(color.rgb,1.);}"},95611:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*vec4(position,1.);}"},72488:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;\n#define M_PI  3.14159265359\nuniform samplerCube cubemap;uniform float yaw;varying vec2 vUv;void main(){vec2 uv=vUv;float theta=uv.x*2.*M_PI+yaw;float phi=uv.y*M_PI;vec3 longitude=vec3(sin(theta),1.,-cos(theta));vec3 latitude=vec3(sin(phi),-cos(phi),sin(phi));vec3 dir=longitude*latitude;normalize(dir);gl_FragColor=vec4(textureCube(cubemap,dir).rgb,1.);}"},64799:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;void main(){vUv=vec2(1.-uv.x,uv.y);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},55185:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 topColor;uniform vec3 bottomColor;uniform float radius;varying vec4 worldPosition;\n#define SRGB_TO_LINEAR(c)pow((c),vec3(2.2))\n#define LINEAR_TO_SRGB(c)pow((c),vec3(1./2.2))\n#define USE_DITHER \nfloat gradientNoise(in vec2 uv){const vec3 magic=vec3(0.06711056,0.00583715,52.9829189);return fract(magic.z*fract(dot(uv,magic.xy)));}void main(){float normalizedHeight=(worldPosition.y+radius)/(radius*2.);float ratio=smoothstep(0.,0.5,normalizedHeight);vec3 colorFromGradient=mix(SRGB_TO_LINEAR(bottomColor),SRGB_TO_LINEAR(topColor),ratio);vec3 color=LINEAR_TO_SRGB(colorFromGradient);\n#if defined (USE_DITHER)\ncolor+=(1./255.)*gradientNoise(gl_FragCoord.xy)-(0.5/255.);\n#endif\ngl_FragColor=vec4(color,1.);}"},13833:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec4 worldPosition;void main(){worldPosition=modelMatrix*vec4(position,1.);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},69254:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform sampler2D tMask;uniform sampler2D tPinHole;uniform vec3 pinColor;uniform float opacity;void main(){vec4 maskColor=texture2D(tMask,vUv);vec4 pinHoleColor=vec4(texture2D(tPinHole,vec2(vUv.x,vUv.y-0.11)).xyz,1.);float redness=maskColor.r-maskColor.b;vec4 mixedPinColor=mix(vec4(pinColor,1.),pinHoleColor,redness);mixedPinColor.a=min(mixedPinColor.a,maskColor.a)*opacity;gl_FragColor=mixedPinColor;}"},76570:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},64506:e=>{e.exports="precision highp float;precision highp int;uniform samplerCube tMap;varying vec3 vUvw;void main(){vec4 color=textureCube(tMap,vec3(-vUvw.x,vUvw.yz));gl_FragColor=vec4(color.rgb,1.);}"},95432:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;varying vec3 vUvw;void main(){vUvw=position;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},28100:e=>{e.exports="precision highp float;precision highp int;varying vec2 vUv;uniform float progress;uniform float opacity;uniform sampler2D tNoHover;uniform sampler2D tHover;uniform sampler2D tPortal;void main(){vec4 noHoverColor=texture2D(tNoHover,vUv);vec4 hoverColor=texture2D(tHover,vUv);vec4 portalColor=texture2D(tPortal,vUv);float xToCtr=2.*vUv.x-1.;float yToCtr=2.*vUv.y-1.;float withinRadius=step(xToCtr*xToCtr+yToCtr*yToCtr,0.9);vec4 mixedPortalColor=mix(hoverColor,portalColor,withinRadius);mixedPortalColor=mix(mixedPortalColor,hoverColor,hoverColor.a);mixedPortalColor=mix(noHoverColor,mixedPortalColor,progress);mixedPortalColor.a=min(mixedPortalColor.a,opacity);gl_FragColor=mixedPortalColor;}"},22118:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;attribute vec3 position;attribute vec2 uv;varying vec2 vUv;void main(){vUv=uv;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},93366:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;varying vec3 vWorldPos;uniform float alpha;uniform samplerCube tDiffuse;void main(){vec4 texColor=textureCube(tDiffuse,vWorldPos);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},28737:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec3 vWorldPos;void main(){vWorldPos=vec3(-position.x,-position.y,position.z);gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},64715:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;varying vec2 vUv;uniform sampler2D tDiffuse;\n#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){vec4 texColor=texture2D(tDiffuse,vUv);gl_FragColor=vec4(texColor.rgb,texColor.a*alpha);}"},79826:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;varying float alpha;\n#endif\nvarying vec2 vUv;void main(){vUv=uv;\n#ifdef INSTANCED\nmat4 mvp=projectionMatrix*modelViewMatrix*instanceMatrix;alpha=instanceAlpha;\n#else\nmat4 mvp=projectionMatrix*modelViewMatrix;\n#endif\ngl_Position=mvp*vec4(position,1.);}"},96228:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform vec3 color;uniform float opacity;void main(){gl_FragColor=vec4(color,opacity);}"},55546:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;void main(){gl_Position=vec4(position,1.);}"},37923:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;uniform float opacity;uniform float discRadius;uniform vec3 discNormal;varying vec3 vFragWorldPos;varying vec3 vCenterWorldPos;\n#ifdef USE_TEXTURE\nuniform sampler2D texture;\n#else\nuniform vec2 ringRadii[RING_COUNT];uniform vec4 ringColors[RING_COUNT];\n#endif\nfloat rayDistToPlane(vec3 rayOrigin,vec3 rayDir,vec3 planeOrigin,vec3 planeNormal){float planeConstant=-dot(planeOrigin,planeNormal);float denom=dot(planeNormal,rayDir);return denom==0.?-1e9:-(dot(rayOrigin,planeNormal)+planeConstant)/denom;}vec4 getColorAtRay(vec3 rayOrigin,vec3 rayDir){vec4 color=vec4(0.);float intersectDist=rayDistToPlane(rayOrigin,rayDir,vCenterWorldPos,discNormal);vec3 intersect=rayOrigin+rayDir*intersectDist;\n#ifdef USE_TEXTURE\nif(intersectDist>0.){vec3 stableDir=abs(discNormal.y)>0.8?normalize((vCenterWorldPos-rayOrigin)*vec3(1.,0.,1.))*sign(discNormal.y):vec3(0.,1.,0.);vec3 xAxis=normalize(cross(stableDir,discNormal));vec3 yAxis=normalize(cross(discNormal,xAxis));intersect-=vCenterWorldPos;vec2 uv=vec2(dot(xAxis,intersect),dot(yAxis,intersect))/discRadius/2.+0.5;if(clamp(uv,vec2(0.),vec2(1.))==uv){color=texture2D(texture,uv);}}\n#else\nfloat fragRadius=intersectDist>0.?distance(intersect,vCenterWorldPos):1e9;if(fragRadius<=discRadius*2.){for(int i=0;i<RING_COUNT;i++){vec2 radii=ringRadii[i]*discRadius;vec4 ringColor=ringColors[i];float ringDist=min(fragRadius-radii[0],radii[1]-fragRadius);\n#if defined(GL_OES_standard_derivatives) || __VERSION__ >= 300\nfloat delta=length(vec2(dFdx(fragRadius),dFdy(fragRadius)))*0.70710678;ringColor.a*=smoothstep(-delta,delta,ringDist);\n#else\nringColor.a*=step(0.,ringDist);\n#endif\ncolor=vec4(color.rgb,1.)*color.a+ringColor*(1.-color.a);}}\n#endif\nreturn color;}void main(){vec3 rayDir=normalize(vFragWorldPos-cameraPosition);gl_FragColor=getColorAtRay(cameraPosition,rayDir);gl_FragColor.a*=opacity;if(gl_FragColor.a==0.){discard;}}"},35757:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec3 vCenterWorldPos;varying vec3 vFragWorldPos;void main(){vCenterWorldPos=(modelMatrix*vec4(0.,0.,0.,1.)).xyz;vFragWorldPos=(modelMatrix*vec4(position,1.)).xyz;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);}"},49329:(e,t,i)=>{e.exports=i(60516).Observable},60516:(e,t)=>{"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e}t.Observable=void 0;var r=function(){return"function"==typeof Symbol},o=function(e){return r()&&Boolean(Symbol[e])},a=function(e){return o(e)?Symbol[e]:"@@"+e};r()&&!o("observable")&&(Symbol.observable=Symbol("observable"));var l=a("iterator"),c=a("observable"),d=a("species");function h(e,t){var i=e[t];if(null!=i){if("function"!=typeof i)throw new TypeError(i+" is not a function");return i}}function u(e){var t=e.constructor;return void 0!==t&&null===(t=t[d])&&(t=void 0),void 0!==t?t:T}function p(e){return e instanceof T}function m(e){m.log?m.log(e):setTimeout((function(){throw e}))}function f(e){Promise.resolve().then((function(){try{e()}catch(e){m(e)}}))}function g(e){var t=e._cleanup;if(void 0!==t&&(e._cleanup=void 0,t))try{if("function"==typeof t)t();else{var i=h(t,"unsubscribe");i&&i.call(t)}}catch(e){m(e)}}function v(e){e._observer=void 0,e._queue=void 0,e._state="closed"}function y(e,t,i){e._state="running";var n=e._observer;try{var s=h(n,t);switch(t){case"next":s&&s.call(n,i);break;case"error":if(v(e),!s)throw i;s.call(n,i);break;case"complete":v(e),s&&s.call(n)}}catch(e){m(e)}"closed"===e._state?g(e):"running"===e._state&&(e._state="ready")}function b(e,t,i){if("closed"!==e._state){if("buffering"!==e._state)return"ready"!==e._state?(e._state="buffering",e._queue=[{type:t,value:i}],void f((function(){return function(e){var t=e._queue;if(t){e._queue=void 0,e._state="ready";for(var i=0;i<t.length&&(y(e,t[i].type,t[i].value),"closed"!==e._state);++i);}}(e)}))):void y(e,t,i);e._queue.push({type:t,value:i})}}var S=function(){function e(t,n){i(this,e),this._cleanup=void 0,this._observer=t,this._queue=void 0,this._state="initializing";var s=new E(this);try{this._cleanup=n.call(void 0,s)}catch(e){s.error(e)}"initializing"===this._state&&(this._state="ready")}return s(e,[{key:"unsubscribe",value:function(){"closed"!==this._state&&(v(this),g(this))}},{key:"closed",get:function(){return"closed"===this._state}}]),e}(),E=function(){function e(t){i(this,e),this._subscription=t}return s(e,[{key:"next",value:function(e){b(this._subscription,"next",e)}},{key:"error",value:function(e){b(this._subscription,"error",e)}},{key:"complete",value:function(){b(this._subscription,"complete")}},{key:"closed",get:function(){return"closed"===this._subscription._state}}]),e}(),T=function(){function e(t){if(i(this,e),!(this instanceof e))throw new TypeError("Observable cannot be called as a function");if("function"!=typeof t)throw new TypeError("Observable initializer must be a function");this._subscriber=t}return s(e,[{key:"subscribe",value:function(e){return"object"==typeof e&&null!==e||(e={next:e,error:arguments[1],complete:arguments[2]}),new S(e,this._subscriber)}},{key:"forEach",value:function(e){var t=this;return new Promise((function(i,n){if("function"==typeof e)var s=t.subscribe({next:function(t){try{e(t,r)}catch(e){n(e),s.unsubscribe()}},error:n,complete:i});else n(new TypeError(e+" is not a function"));function r(){s.unsubscribe(),i()}}))}},{key:"map",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{t=e(t)}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"filter",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");return new(u(this))((function(i){return t.subscribe({next:function(t){try{if(!e(t))return}catch(e){return i.error(e)}i.next(t)},error:function(e){i.error(e)},complete:function(){i.complete()}})}))}},{key:"reduce",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this),n=arguments.length>1,s=!1,r=arguments[1],o=r;return new i((function(i){return t.subscribe({next:function(t){var r=!s;if(s=!0,!r||n)try{o=e(o,t)}catch(e){return i.error(e)}else o=t},error:function(e){i.error(e)},complete:function(){if(!s&&!n)return i.error(new TypeError("Cannot reduce an empty sequence"));i.next(o),i.complete()}})}))}},{key:"concat",value:function(){for(var e=this,t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s=u(this);return new s((function(t){var n,r=0;return function e(o){n=o.subscribe({next:function(e){t.next(e)},error:function(e){t.error(e)},complete:function(){r===i.length?(n=void 0,t.complete()):e(s.from(i[r++]))}})}(e),function(){n&&(n.unsubscribe(),n=void 0)}}))}},{key:"flatMap",value:function(e){var t=this;if("function"!=typeof e)throw new TypeError(e+" is not a function");var i=u(this);return new i((function(n){var s=[],r=t.subscribe({next:function(t){if(e)try{t=e(t)}catch(e){return n.error(e)}var r=i.from(t).subscribe({next:function(e){n.next(e)},error:function(e){n.error(e)},complete:function(){var e=s.indexOf(r);e>=0&&s.splice(e,1),o()}});s.push(r)},error:function(e){n.error(e)},complete:function(){o()}});function o(){r.closed&&0===s.length&&n.complete()}return function(){s.forEach((function(e){return e.unsubscribe()})),r.unsubscribe()}}))}},{key:c,value:function(){return this}}],[{key:"from",value:function(t){var i="function"==typeof this?this:e;if(null==t)throw new TypeError(t+" is not an object");var n=h(t,c);if(n){var s=n.call(t);if(Object(s)!==s)throw new TypeError(s+" is not an object");return p(s)&&s.constructor===i?s:new i((function(e){return s.subscribe(e)}))}if(o("iterator")&&(n=h(t,l)))return new i((function(e){f((function(){if(!e.closed){var i=!0,s=!1,r=void 0;try{for(var o,a=n.call(t)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var l=o.value;if(e.next(l),e.closed)return}}catch(e){s=!0,r=e}finally{try{i||null==a.return||a.return()}finally{if(s)throw r}}e.complete()}}))}));if(Array.isArray(t))return new i((function(e){f((function(){if(!e.closed){for(var i=0;i<t.length;++i)if(e.next(t[i]),e.closed)return;e.complete()}}))}));throw new TypeError(t+" is not observable")}},{key:"of",value:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];var s="function"==typeof this?this:e;return new s((function(e){f((function(){if(!e.closed){for(var t=0;t<i.length;++t)if(e.next(i[t]),e.closed)return;e.complete()}}))}))}},{key:d,get:function(){return this}}]),e}();t.Observable=T,r()&&Object.defineProperty(T,Symbol("extensions"),{value:{symbol:c,hostReportError:m},configurable:!0})},20331:function(e,t){"use strict";var i,n,s=this&&this.__assign||function(){return(s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++)for(var s in t=arguments[i])Object.prototype.hasOwnProperty.call(t,s)&&(e[s]=t[s]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.Request=t.RequestQueue=t.RequestStatus=t.RequestPriority=void 0,function(e){e[e.LOW=0]="LOW",e[e.MEDIUM=1]="MEDIUM",e[e.HIGH=2]="HIGH",e[e.HIGHEST=3]="HIGHEST"}(i=t.RequestPriority||(t.RequestPriority={})),function(e){e[e.PENDING=0]="PENDING",e[e.SENDING=1]="SENDING",e[e.FAILED=2]="FAILED",e[e.DONE=3]="DONE"}(n=t.RequestStatus||(t.RequestStatus={}));var r=function(){function e(e){var t=void 0===e?{}:e,i=t.retries,n=void 0===i?0:i,s=t.concurrency,r=void 0===s?6:s;this.totalBytesDownloaded=0,this.queue=[],this.retries=n,this.concurrency=r}return e.prototype.get=function(e,t){return this.request("GET",e,t)},e.prototype.head=function(e,t){return this.request("HEAD",e,t)},e.prototype.options=function(e,t){return this.request("OPTIONS",e,t)},e.prototype.post=function(e,t){return this.request("POST",e,t)},e.prototype.put=function(e,t){return this.request("PUT",e,t)},e.prototype.patch=function(e,t){return this.request("PATCH",e,t)},e.prototype.delete=function(e,t){return this.request("DELETE",e,t)},e.prototype.request=function(e,t,i){var s,r=this,a=new o(e,t,i);return null===(s=null==i?void 0:i.signal)||void 0===s||s.addEventListener("abort",(function(){r.queue.includes(a)&&(a.status===n.SENDING&&a.abort(),r.dequeue(a),a.onFail(new DOMException("Aborted","AbortError")))})),this.enqueue(a),a.promise},e.prototype.update=function(){for(var e;e=this.getNextPendingRequest();)this.sendRequest(e);for(;e=this.getNextOverflowingGet();)e.abort(),e.status=n.PENDING;this.updateTimeout=null},e.prototype.enqueue=function(e){var t=this,i=0;for(i=0;i<this.queue.length;i++){if(this.queue[i].priority<e.priority)break}this.queue.splice(i,0,e),this.updateTimeout||(this.updateTimeout=window.setTimeout((function(){t.update()}),1))},e.prototype.dequeue=function(e){var t=this.queue.indexOf(e);if(-1===t)throw new Error("Can't dequeue request not in queue");this.queue.splice(t,1),this.update()},e.prototype.getNextPendingRequest=function(){for(var e=0;e<this.queue.length&&e<this.concurrency;e++){var t=this.queue[e];if(t.status===n.PENDING)return t}return null},e.prototype.getNextOverflowingGet=function(){for(var e=this.concurrency;e<this.queue.length;e++){var t=this.queue[e];if(t.status===n.SENDING&&t.priority!==i.HIGHEST&&"GET"===t.method)return t}return null},e.prototype.shouldRetryStatusCode=function(t){return!e.doNotRetryStatusCodes[t]},e.prototype.sendRequest=function(e){var t=this;e.status=n.SENDING,e.send().then((function(i){e.status=n.DONE,t.dequeue(e),e.contentLength&&e.contentLength>0&&(t.totalBytesDownloaded+=Number(e.contentLength)),e.onDone(i)})).catch((function(i){var s=null!==e.maxRetries?e.maxRetries:t.retries,r=e.sendAttempts<s;if("object"==typeof i){var o=i.status_code||0;r=r&&t.shouldRetryStatusCode(o)}r?(e.status=n.PENDING,t.update(),console.warn("Retried "+e.url),console.warn(i)):(e.status=n.FAILED,t.dequeue(e),console.warn("Failed "+e.url),e.onFail(i))}))},e.doNotRetryStatusCodes={400:!0,401:!0,403:!0,404:!0,405:!0,406:!0,410:!0,411:!0,414:!0,415:!0,421:!0,431:!0,451:!0},e}();t.RequestQueue=r;var o=function(){function e(e,t,s){var r=this;void 0===s&&(s={}),this.sendAttempts=0,this.status=n.PENDING,this.contentLength=0,this.url=t,this.method=e,this.auth=s.auth||null,this.withCredentials=s.withCredentials||!1,this.priority=s.priority||i.MEDIUM,this.responseType=s.responseType||null,this.body=s.body||null,this.headers=s.headers||{},this.maxRetries=s.maxRetries||null,this.onProgress=s.onProgress,this.promise=new Promise((function(e,t){r.onDone=e,r.onFail=t}))}return e.prototype.send=function(){var e=this,t=this.xhr=function(e,t,i){var n;if("undefined"!=typeof XMLHttpRequest)(n=new XMLHttpRequest).withCredentials=i;else{if("undefined"==typeof XDomainRequest)throw new Error("No XMLHTTPRequest or XDomainRequest... are you trying to run me in node? :(");n=new XDomainRequest}return n.open(e,t,!0),n}(this.method,this.url,this.withCredentials);if(this.responseType)if("arraybuffer"===this.responseType||"text"===this.responseType||"json"===this.responseType||"blob"===this.responseType)t.responseType=this.responseType;else{if("image"!==this.responseType)throw new Error('reponseType can only be one of "arraybuffer", "text", "json", "blob", "image"');t.responseType="blob"}for(var i in"json"===this.responseType&&t.setRequestHeader("Accept","application/json"),this.auth&&"string"==typeof this.auth&&t.setRequestHeader("Authorization",this.auth),this.headers)t.setRequestHeader(i,this.headers[i]);return this.body&&"object"==typeof this.body&&(this.body instanceof FormData||(this.body=JSON.stringify(this.body),t.setRequestHeader("Content-Type","application/json"))),this.onProgress&&(t.onprogress=this.onProgress),new Promise((function(i,n){t.onreadystatechange=function(r){if(4===t.readyState){if(200===t.status||201===t.status||204===t.status)return e.parseResponse(e.xhr).then((function(e){i(e)}));if(0!==t.status)return e.parseResponse(e.xhr).then((function(e){n(s({status_code:t.status},e))})).catch((function(){n({status_code:t.status})}))}},t.onerror=function(e){n(e)},t.send(e.body),e.sendAttempts++}))},e.prototype.parseResponse=function(e){var t=this;return new Promise((function(i,n){try{var s=e.response;if(t.contentLength=e.getResponseHeader("Content-Length"),"json"===t.responseType&&"object"!=typeof s)i(JSON.parse(e.responseText));else if(200!==e.status&&201!==e.status&&204!==e.status||"image"!==t.responseType)i(s);else{var r=URL.createObjectURL(s);(s=new Image).src=r,s.crossOrigin="Anonymous",s.onload=function(){URL.revokeObjectURL(r),i(s)}}}catch(e){n({error:"Payload was not valid JSON"})}}))},e.prototype.abort=function(){if(null===this.xhr)throw new Error("Cannot abort unsent Request");this.xhr.abort()},e}();t.Request=o},98443:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"FileAttachments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"fileAttachmentsByModelId"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteExternalAttachment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ParentType"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteExternalAttachment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"attachmentId"},value:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}}},{kind:"Argument",name:{kind:"Name",value:"parentType"},value:{kind:"Variable",name:{kind:"Name",value:"parentType"}}},{kind:"Argument",name:{kind:"Name",value:"parentId"},value:{kind:"Variable",name:{kind:"Name",value:"parentId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RemoveFileAttachment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ParentType"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"removeFileAttachment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"attachmentId"},value:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}}},{kind:"Argument",name:{kind:"Name",value:"parentType"},value:{kind:"Variable",name:{kind:"Name",value:"parentType"}}},{kind:"Argument",name:{kind:"Name",value:"parentId"},value:{kind:"Variable",name:{kind:"Name",value:"parentId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteFileAttachment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"id"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteFileAttachment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"id"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadFileAttachmentToModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"organizationId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"filename"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"uploadFileAttachmentToModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"organizationId"},value:{kind:"Variable",name:{kind:"Name",value:"organizationId"}}},{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"filename"},value:{kind:"Variable",name:{kind:"Name",value:"filename"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"FileAttachmentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"FileAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"bytes"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mimeType"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ImageFileAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"imageWidth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"imageHeight"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ExternalAttachmentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ExternalAttachment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"thumbnailUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parentDetails"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"parent"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}}],loc:{start:0,end:1683}};t.loc.source={body:"\n# read all attachments for the specified model\nquery FileAttachments($modelId: ID!) {\n  fileAttachmentsByModelId(modelId: $modelId) {\n    results { ...FileAttachmentDetails }\n  }\n}\n\n# Deletes a single external attachment\nmutation DeleteExternalAttachment($modelId: ID!, $attachmentId: ID!, $parentType: ParentType!, $parentId: ID!) {\n  deleteExternalAttachment(modelId: $modelId, , attachmentId: $attachmentId, parentType: $parentType, parentId: $parentId)\n}\n\n# Removes a file attachment association from the annotation it is attached to.\n# Can delete the file attachment completely if the 'cascadeDelete' flag is set to true (not currently used)\nmutation RemoveFileAttachment($modelId: ID!, $attachmentId: ID!, $parentType: ParentType!, $parentId: ID!) {\n  removeFileAttachment(modelId: $modelId, , attachmentId: $attachmentId, parentType: $parentType, parentId: $parentId)\n}\n\nmutation DeleteFileAttachment($id: ID!) {\n  deleteFileAttachment(id: $id)\n}\n\nmutation UploadFileAttachmentToModel($organizationId: ID!, $modelId: ID!, $contents: FileUpload!, $filename: String!) {\n  uploadFileAttachmentToModel(organizationId: $organizationId, modelId: $modelId,\n                              contents: $contents, filename: $filename) {\n    ...FileAttachmentDetails\n  }\n}\n\nfragment FileAttachmentDetails on FileAttachment {\n  id\n  created\n  filename\n  url\n  validUntil\n  bytes\n  mimeType\n  ...on ImageFileAttachment {\n      imageWidth\n      imageHeight\n  }\n}\n\n# common External Attachment properties\nfragment ExternalAttachmentDetails on ExternalAttachment {\n  id\n  created\n  modified\n  thumbnailUrl\n  url\n  mediaType\n  width\n  height\n  category\n  parentDetails { type, parent { id } }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.FileAttachments=r(t,"FileAttachments"),e.exports.DeleteExternalAttachment=r(t,"DeleteExternalAttachment"),e.exports.RemoveFileAttachment=r(t,"RemoveFileAttachment"),e.exports.DeleteFileAttachment=r(t,"DeleteFileAttachment"),e.exports.UploadFileAttachmentToModel=r(t,"UploadFileAttachmentToModel"),e.exports.FileAttachmentDetails=r(t,"FileAttachmentDetails"),e.exports.ExternalAttachmentDetails=r(t,"ExternalAttachmentDetails")},70129:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddCommentAttachments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"parentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"externalAttachments"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ExternalAttachmentDetails"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"fileAttachments"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addCommentAttachments"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"parentId"}}},{kind:"Argument",name:{kind:"Name",value:"externalAttachments"},value:{kind:"Variable",name:{kind:"Name",value:"externalAttachments"}}},{kind:"Argument",name:{kind:"Name",value:"fileAttachments"},value:{kind:"Variable",name:{kind:"Name",value:"fileAttachments"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentAttachments"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"commentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CommentPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"commentId"},value:{kind:"Variable",name:{kind:"Name",value:"commentId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"CommentDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Comment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"edited"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"text"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"externalAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"fileAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"CommentAttachments"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Comment"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"externalAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"fileAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}}],loc:{start:0,end:1211}};n.loc.source={body:'#import "./attachments.gql"\n\n# Add comment attachments\nmutation AddCommentAttachments($modelId: ID!, $parentId: ID!, $externalAttachments: [ExternalAttachmentDetails!], $fileAttachments: [ID!]) {\n  addCommentAttachments(modelId: $modelId, , commentId: $parentId,\n                        externalAttachments: $externalAttachments,\n                        fileAttachments: $fileAttachments) {\n    ...CommentAttachments\n  }\n}\n\n# Deletes a single comment\nmutation DeleteComment ($modelId: ID!, $commentId: ID!) {\n  deleteComment(modelId: $modelId, , commentId: $commentId)\n}\n\n# Update a single comment\nmutation PatchComment($modelId: ID!, $commentId: ID!, $data: CommentPatch!) {\n  patchComment(modelId: $modelId, , commentId: $commentId, patch: $data) {\n    ...CommentDetails\n  }\n}\n\n# common Comment properties\nfragment CommentDetails on Comment {\n  id\n  created\n  modified\n  edited\n  text\n  createdBy { id, firstName, lastName, email }\n  externalAttachments { ...ExternalAttachmentDetails }\n  fileAttachments { ...FileAttachmentDetails }\n}\n\n# Attachments on a Comment\nfragment CommentAttachments on Comment {\n  externalAttachments { ...ExternalAttachmentDetails }\n  fileAttachments { ...FileAttachmentDetails }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,t)})),e.definitions&&e.definitions.forEach((function(e){r(e,t)}))}n.definitions=n.definitions.concat(i(98443).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var l=r;r=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;r(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.AddCommentAttachments=l(n,"AddCommentAttachments"),e.exports.DeleteComment=l(n,"DeleteComment"),e.exports.PatchComment=l(n,"PatchComment"),e.exports.CommentDetails=l(n,"CommentDetails"),e.exports.CommentAttachments=l(n,"CommentAttachments")},81047:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetFloors"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"FloorDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelFloor"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchFloor"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"floorId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FloorPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchFloor"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"floorId"},value:{kind:"Variable",name:{kind:"Name",value:"floorId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:380}};t.loc.source={body:"query GetFloors($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    floors { ...FloorDetails }\n  }\n}\n\nfragment FloorDetails on ModelFloor {\n  id\n  meshId\n  classification\n  label\n  sequence\n  dimensions {\n    areaFloor\n  }\n}\n\nmutation PatchFloor($modelId: ID!, $floorId: ID!, $data: FloorPatch!) {\n  patchFloor(modelId: $modelId, , floorId: $floorId, patch: $data) {\n    id\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetFloors=r(t,"GetFloors"),e.exports.FloorDetails=r(t,"FloorDetails"),e.exports.PatchFloor=r(t,"PatchFloor")},95162:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetLabels"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"LabelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteLabel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"labelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteLabel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"labelId"},value:{kind:"Variable",name:{kind:"Name",value:"labelId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"LabelDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Label"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:929}};t.loc.source={body:"# Read all labels for the given model\nquery GetLabels($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    labels (includeDisabled: $includeDisabled) {\n      ...LabelDetails\n    }\n  }\n}\n\n# Create a new label\nmutation AddLabel ($modelId: ID!, $labelId: ID, $data: LabelDetails!) {\n  addLabel(modelId: $modelId, labelId: $labelId, label: $data) {\n    ...LabelDetails\n  }\n}\n\n# Update a single label\nmutation PatchLabel ($modelId: ID!, $labelId: ID!, $data: LabelPatch!) {\n  patchLabel(modelId: $modelId, , labelId: $labelId, patch: $data) {\n    ...LabelDetails\n  }\n}\n\n# Deletes a single label\nmutation DeleteLabel ($modelId: ID!, ,$labelId: ID!) {\n  deleteLabel(modelId: $modelId, ,labelId: $labelId)\n}\n\n# Default Label properties used by Showcase and Workshop\nfragment LabelDetails on Label {\n  id\n  position { x y z }\n  floor { id meshId }\n  room { id meshId }\n  label\n  enabled\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetLabels=r(t,"GetLabels"),e.exports.AddLabel=r(t,"AddLabel"),e.exports.PatchLabel=r(t,"PatchLabel"),e.exports.DeleteLabel=r(t,"DeleteLabel"),e.exports.LabelDetails=r(t,"LabelDetails")},60344:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetOrderedLists"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"orderedLists"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"entries"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"EntryDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetOrderedListByName"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NamedType",name:{kind:"Name",value:"string"}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"orderedLists"},arguments:[{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"entries"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"EntryDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddOrderedList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"description"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entries"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntryInput"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addOrderedList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"description"},value:{kind:"Variable",name:{kind:"Name",value:"description"}}},{kind:"Argument",name:{kind:"Name",value:"entries"},value:{kind:"Variable",name:{kind:"Name",value:"entries"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"entries"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"EntryDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchOrderedList"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"orderedListId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"description"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"entries"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"EntryInput"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchOrderedList"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"orderedListId"},value:{kind:"Variable",name:{kind:"Name",value:"orderedListId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"description"},value:{kind:"Variable",name:{kind:"Name",value:"description"}}},{kind:"Argument",name:{kind:"Name",value:"entries"},value:{kind:"Variable",name:{kind:"Name",value:"entries"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"entries"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"EntryDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"EntryDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Entry"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}],loc:{start:0,end:1189}};t.loc.source={body:"\n# get the ordered lists for the specified model\nquery GetOrderedLists($modelId: ID!) {\n  model(id: $modelId) {\n    orderedLists(ids: []) {\n      label\n      id\n      entries {\n        ...EntryDetails\n      }\n    }\n  }\n}\n\n# get an ordered list by name for the specified model\nquery GetOrderedListByName($modelId: ID!, $label: string) {\n  model(id: $modelId) {\n    orderedLists(label: $label) {\n      entries {\n        ...EntryDetails\n      }\n    }\n  }\n}\n\n# add a new ordered list\nmutation AddOrderedList($modelId: ID!, $label: String!, $description: String!, $entries: [EntryInput!]) {\n  addOrderedList(modelId: $modelId, , label: $label, description: $description, entries: $entries) {\n    id\n    label\n    entries {\n      ...EntryDetails\n    }\n  }\n}\n\n# patch an existing ordered list\nmutation PatchOrderedList($modelId: ID!, $orderedListId: ID!, $label: String!, $description: String!, $entries: [EntryInput!]) {\n  patchOrderedList(modelId: $modelId, , orderedListId: $orderedListId, label: $label, description: $description, entries: $entries) {\n    id\n    label\n    entries {\n      ...EntryDetails\n    }\n  }\n}\n\n# Default Entry properties\nfragment EntryDetails on Entry {\n  id\n  type\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetOrderedLists=r(t,"GetOrderedLists"),e.exports.GetOrderedListByName=r(t,"GetOrderedListByName"),e.exports.AddOrderedList=r(t,"AddOrderedList"),e.exports.PatchOrderedList=r(t,"PatchOrderedList"),e.exports.EntryDetails=r(t,"EntryDetails")},6850:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMattertags"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"RefreshTagFileAttachments"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"fileAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NamedType",name:{kind:"Name",value:"ID"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MattertagDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertag"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMattertag"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMattertag"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"mattertagId"},value:{kind:"Variable",name:{kind:"Name",value:"mattertagId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MattertagDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mattertag"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"description"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"media"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mediaType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ExternalAttachmentDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"fileAttachments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FileAttachmentDetails"},directives:[]}]}}]}}],loc:{start:0,end:1359}};n.loc.source={body:'#import "./attachments.gql"\n\n# read all mattertags for the specified model\nquery GetMattertags($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    mattertags(includeDisabled: $includeDisabled) {\n      ...MattertagDetails\n    }\n  }\n}\n\n# refresh file attachment expiring resources for all mattertags\nquery RefreshTagFileAttachments($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    mattertags(includeDisabled: $includeDisabled) {\n      id\n      fileAttachments { ...FileAttachmentDetails }\n    }\n  }\n}\n\n# add a new mattertag\nmutation AddMattertag($modelId:ID!, $mattertagId: ID, $data: MattertagDetails!) {\n  addMattertag(modelId: $modelId, mattertagId: $mattertagId, mattertag: $data) {\n    id\n    created\n    modified\n  }\n}\n\n# delete an existing tag by id\nmutation DeleteMattertag($modelId: ID!, $mattertagId: ID!) {\n  deleteMattertag(modelId: $modelId, mattertagId: $mattertagId)\n}\n\n# common Mattertag properties used by Showcase and Workshop\nfragment MattertagDetails on Mattertag {\n  id\n  label\n  description\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x y z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  media\n  mediaType\n  created\n  modified\n  externalAttachments { ...ExternalAttachmentDetails }\n  fileAttachments { ...FileAttachmentDetails }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,t)})),e.definitions&&e.definitions.forEach((function(e){r(e,t)}))}n.definitions=n.definitions.concat(i(98443).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var l=r;r=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;r(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.GetMattertags=l(n,"GetMattertags"),e.exports.RefreshTagFileAttachments=l(n,"RefreshTagFileAttachments"),e.exports.AddMattertag=l(n,"AddMattertag"),e.exports.DeleteMattertag=l(n,"DeleteMattertag"),e.exports.MattertagDetails=l(n,"MattertagDetails")},37946:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMeasurements"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"Boolean"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"Variable",name:{kind:"Name",value:"includeDisabled"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPathDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"path"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pathId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPathPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"pathId"},value:{kind:"Variable",name:{kind:"Name",value:"pathId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteMeasurement"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"pathId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteMeasurementPath"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"pathId"},value:{kind:"Variable",name:{kind:"Name",value:"pathId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"MeasurementDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MeasurementPath"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lineType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"points"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}],loc:{start:0,end:835}};t.loc.source={body:"\nquery GetMeasurements($modelId: ID!, $includeDisabled: Boolean!) {\n  model(id: $modelId) {\n    id,\n    measurementPaths(includeDisabled: $includeDisabled) {\n      ...MeasurementDetails\n    }\n  }\n}\n\nmutation AddMeasurement($modelId: ID!, $data: MeasurementPathDetails!) {\n  addMeasurementPath(modelId: $modelId, , path: $data) {\n    id\n  }\n}\n\nmutation PatchMeasurement($modelId: ID!, $pathId: ID!, $data: MeasurementPathPatch!) {\n  patchMeasurementPath(modelId: $modelId, , pathId: $pathId, patch: $data) {\n    id\n  }\n}\n\nmutation DeleteMeasurement($modelId: ID!, $pathId: ID!) {\n  deleteMeasurementPath(modelId: $modelId, , pathId: $pathId)\n}\n\nfragment MeasurementDetails on MeasurementPath {\n  id\n  lineType\n  label\n  enabled\n  points {\n    position { x y z }\n    floor { id meshId }\n    room { id meshId }\n  }\n  created\n  modified\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetMeasurements=r(t,"GetMeasurements"),e.exports.AddMeasurement=r(t,"AddMeasurement"),e.exports.PatchMeasurement=r(t,"PatchMeasurement"),e.exports.DeleteMeasurement=r(t,"DeleteMeasurement"),e.exports.MeasurementDetails=r(t,"MeasurementDetails")},97997:e=>{var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"MeshDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Mesh"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"TextureDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Texture"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"quality"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"TilesetDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Tileset"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationDetails"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"published"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastPublished"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"summary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contact"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"phoneNumber"},arguments:[],directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"ModelOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"backgroundColor"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dollhouseLabelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorSelectEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorplanEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"highlightReelEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"labelsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"measurements"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"socialSharingEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"spaceSearchEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourButtonsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourDollhousePanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourFastTransitionsEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanAngle"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanDirection"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourPanSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionSpeed"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourTransitionTime"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tourZoomDuration"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"unitType"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"vrEnabled"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"PublicationOptions"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelPublicationOptions"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"contactEmail"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"contactPhone"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelSummary"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"presentedBy"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"address"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"externalUrl"},arguments:[],directives:[]}]}}],loc:{start:0,end:1166}};t.loc.source={body:"fragment MeshDetails on Mesh {\n  id\n  status\n  filename\n  format\n  resolution\n  url\n  validUntil\n}\n\nfragment TextureDetails on Texture {\n  id\n  status\n  format\n  resolution\n  quality\n  urlTemplate\n  validUntil\n}\n\nfragment TilesetDetails on Tileset {\n  status\n  url\n  urlTemplate\n  validUntil\n}\n\nfragment PublicationDetails on ModelPublicationDetails {\n  address\n  published\n  lastPublished\n  presentedBy\n  summary\n  externalUrl\n  contact {\n    name\n    email\n    phoneNumber\n  }\n}\n\nfragment ModelOptions on ModelOptions {\n  backgroundColor\n  dollhouseEnabled\n  dollhouseLabelsEnabled\n  floorSelectEnabled\n  floorplanEnabled\n  highlightReelEnabled\n  labelsEnabled\n  measurements\n  socialSharingEnabled\n  spaceSearchEnabled\n  tourButtonsEnabled\n  tourDollhousePanSpeed\n  tourFastTransitionsEnabled\n  tourPanAngle\n  tourPanDirection\n  tourPanSpeed\n  tourTransitionSpeed\n  tourTransitionTime\n  tourZoomDuration\n  unitType\n  vrEnabled\n  # disable until platform 21.9.2 release\n  # urlBrandingEnabled\n}\n\nfragment PublicationOptions on ModelPublicationOptions {\n  contactEmail\n  contactName\n  contactPhone\n  modelName\n  modelSummary\n  presentedBy\n  address\n  externalUrl\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.MeshDetails=r(t,"MeshDetails"),e.exports.TextureDetails=r(t,"TextureDetails"),e.exports.TilesetDetails=r(t,"TilesetDetails"),e.exports.PublicationDetails=r(t,"PublicationDetails"),e.exports.ModelOptions=r(t,"ModelOptions"),e.exports.PublicationOptions=r(t,"PublicationOptions")},91985:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelOptions"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelDetails"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"tilesets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TilesetDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchModel"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"patch"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ModelPatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchModel"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"patch"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:780}};n.loc.source={body:'#import "./model-fragments.gql"\n#import "./photo-fragments.gql"\n\nquery GetModelOptions($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    publication {\n      options { ...PublicationOptions }\n    }\n    options { ...ModelOptions }\n  }\n}\n\nquery GetModelDetails($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    name\n    organization\n    visibility\n    created\n    image { ...PhotoDetails }\n    publication { ...PublicationDetails }\n    options { ...ModelOptions }\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n      tilesets { ...TilesetDetails }\n    }\n  }\n}\n\nmutation PatchModel($modelId: ID!, $patch: ModelPatch!) {\n  patchModel(id: $modelId, , patch: $patch) {\n    id\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(97997).definitions)),n.definitions=n.definitions.concat(r(i(22164).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function c(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetModelOptions=c(n,"GetModelOptions"),e.exports.GetModelDetails=c(n,"GetModelDetails"),e.exports.PatchModel=c(n,"PatchModel")},11764:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetNotes"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"notes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NoteDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"note"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddNoteComment"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"CommentDetails"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addNoteComment"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}},{kind:"Argument",name:{kind:"Name",value:"comment"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"data"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"NotePatch"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}},{kind:"Argument",name:{kind:"Name",value:"patch"},value:{kind:"Variable",name:{kind:"Name",value:"data"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"NoteDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ReopenNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"reopenNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ResolveNote"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"noteId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolveNote"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"noteId"},value:{kind:"Variable",name:{kind:"Name",value:"noteId"}}}],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"NoteDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Note"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"createdBy"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"color"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchorPosition"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemEnabled"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"stemNormal"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"stemLength"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastCommentAt"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"comments"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"CommentDetails"},directives:[]}]}}]}}]}}],loc:{start:0,end:1499}};n.loc.source={body:'#import "./attachments.gql"\n#import "./comments.gql"\n\n# read all notes for the specified model\nquery GetNotes($modelId: ID!, $ids: [ID!]) {\n  model(id: $modelId) {\n    id\n    notes(ids: $ids) {\n      ...NoteDetails\n    }\n  }\n}\n\n# Create a new note\nmutation AddNote($modelId: ID!, $data: NoteDetails!) {\n  addNote(modelId: $modelId, , note: $data) {\n    ...NoteDetails\n  }\n}\n\n# Add a comment to the note\nmutation AddNoteComment($modelId: ID!, $noteId: ID!, $data: CommentDetails!) {\n  addNoteComment(modelId: $modelId, , noteId: $noteId, comment: $data) {\n    ...CommentDetails\n  }\n}\n\n# Deletes a single note\nmutation DeleteNote ($modelId: ID!, $noteId: ID!) {\n  deleteNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# Update a single note\nmutation PatchNote($modelId: ID!, $noteId: ID!, $data: NotePatch!) {\n  patchNote(modelId: $modelId, , noteId: $noteId, patch: $data) {\n    ...NoteDetails\n  }\n}\n\n# Reopen a note\nmutation ReopenNote ($modelId: ID!, $noteId: ID!) {\n  reopenNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# Resolve a note\nmutation ResolveNote($modelId: ID!, $noteId: ID!) {\n  resolveNote(modelId: $modelId, , noteId: $noteId)\n}\n\n# common Note properties\nfragment NoteDetails on Note {\n  id\n  createdBy { id, firstName, lastName, email }\n  color\n  enabled\n  floor { id, meshId }\n  room { id, meshId }\n  anchorPosition { x, y, z }\n  stemEnabled\n  stemNormal { x, y, z }\n  stemLength\n  resolution\n  created\n  modified\n  lastCommentAt\n  comments {\n    results { ...CommentDetails }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(98443).definitions)),n.definitions=n.definitions.concat(r(i(70129).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function c(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetNotes=c(n,"GetNotes"),e.exports.AddNote=c(n,"AddNote"),e.exports.AddNoteComment=c(n,"AddNoteComment"),e.exports.DeleteNote=c(n,"DeleteNote"),e.exports.PatchNote=c(n,"PatchNote"),e.exports.ReopenNote=c(n,"ReopenNote"),e.exports.ResolveNote=c(n,"ResolveNote"),e.exports.NoteDetails=c(n,"NoteDetails")},22164:e=>{var t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"PhotoDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"Photo"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"classification"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"category"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"created"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"filename"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"format"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"url"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"origin"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]},{kind:"Field",alias:{kind:"Name",value:"thumbnailUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"thumbnail"}}],directives:[]},{kind:"Field",alias:{kind:"Name",value:"presentationUrl"},name:{kind:"Name",value:"resizeUrl"},arguments:[{kind:"Argument",name:{kind:"Name",value:"resolution"},value:{kind:"EnumValue",value:"presentation"}}],directives:[]},{kind:"Field",name:{kind:"Name",value:"snapshotLocation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"viewMode"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"zoom"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floorVisibility"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sequence"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"anchor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:535}};t.loc.source={body:"\nfragment PhotoDetails on Photo {\n  id\n  label\n  classification\n  category\n  height\n  width\n  created\n  modified\n  status\n  filename\n  format\n  url\n  resolutions\n  type\n  origin\n  validUntil\n  thumbnailUrl: resizeUrl(resolution: thumbnail)\n  presentationUrl: resizeUrl(resolution: presentation)\n  snapshotLocation {\n    viewMode\n    position { x y z }\n    rotation { x y z w }\n    zoom\n    floorVisibility {\n      id\n      meshId\n      sequence\n    }\n    anchor {\n      id\n      pano {\n        id\n        placement\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.PhotoDetails=function(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}(t,"PhotoDetails")},70778:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSnapshots"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"photos"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PatchPhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"patchPhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeletePhoto"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deletePhoto"},arguments:[{kind:"Argument",name:{kind:"Name",value:"modelId"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"photoId"},value:{kind:"Variable",name:{kind:"Name",value:"photoId"}}}],directives:[]}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadHighlightReelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadHighlightReelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"UploadModelSnapshot"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"contents"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"FileUpload"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"label"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"SnapshotLocationInput"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"photoType"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"PhotoType"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"snapshot"},name:{kind:"Name",value:"uploadModelSnapshot"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}},{kind:"Argument",name:{kind:"Name",value:"contents"},value:{kind:"Variable",name:{kind:"Name",value:"contents"}}},{kind:"Argument",name:{kind:"Name",value:"label"},value:{kind:"Variable",name:{kind:"Name",value:"label"}}},{kind:"Argument",name:{kind:"Name",value:"snapshotLocation"},value:{kind:"Variable",name:{kind:"Name",value:"snapshotLocation"}}},{kind:"Argument",name:{kind:"Name",value:"photoType"},value:{kind:"Variable",name:{kind:"Name",value:"photoType"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}}]}}],loc:{start:0,end:1048}};n.loc.source={body:'#import "./photo-fragments.gql"\nquery GetSnapshots($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      photos { ...PhotoDetails }\n    }\n  }\n}\n\nmutation PatchPhoto($modelId: ID!, $photoId: ID!, $label: String!) {\n  patchPhoto(modelId: $modelId, photoId: $photoId, label: $label) {\n    ...PhotoDetails\n  }\n}\n\nmutation DeletePhoto($modelId: ID!, $photoId: ID!) {\n  deletePhoto(modelId: $modelId, photoId: $photoId)\n}\n\nmutation UploadHighlightReelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!) {\n  snapshot: uploadHighlightReelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation) {\n    ...PhotoDetails\n  }\n}\n\nmutation UploadModelSnapshot($modelId: ID!, $contents: FileUpload!, $label: String!, $snapshotLocation: SnapshotLocationInput!, $photoType: PhotoType!) {\n  snapshot: uploadModelSnapshot(id: $modelId, contents: $contents, label: $label, snapshotLocation: $snapshotLocation, photoType: $photoType) {\n    ...PhotoDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){r(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){r(e,t)})),e.definitions&&e.definitions.forEach((function(e){r(e,t)}))}n.definitions=n.definitions.concat(i(22164).definitions.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)})));var o={};function a(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function l(e,t){var i={kind:e.kind,definitions:[a(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=o[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var l=r;r=new Set,l.forEach((function(e){s.has(e)||(s.add(e),(o[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=a(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;r(e,t),o[e.name.value]=t}})),e.exports=n,e.exports.GetSnapshots=l(n,"GetSnapshots"),e.exports.PatchPhoto=l(n,"PatchPhoto"),e.exports.DeletePhoto=l(n,"DeletePhoto"),e.exports.UploadHighlightReelSnapshot=l(n,"UploadHighlightReelSnapshot"),e.exports.UploadModelSnapshot=l(n,"UploadModelSnapshot")},83531:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetModelPrefetch"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"assets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"meshes"},arguments:[{kind:"Argument",name:{kind:"Name",value:"formats"},value:{kind:"StringValue",value:"dam",block:!1}},{kind:"Argument",name:{kind:"Name",value:"resolutions"},value:{kind:"ListValue",values:[{kind:"StringValue",value:"50k",block:!1},{kind:"StringValue",value:"500k",block:!1}]}},{kind:"Argument",name:{kind:"Name",value:"compressions"},value:{kind:"EnumValue",value:"none"}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeshDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"textures"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TextureDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"tilesets"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"TilesetDetails"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"floors"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"FloorDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"image"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PhotoDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"StringValue",value:"showcase",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"ModelOptions"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"organization"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"publication"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationDetails"},directives:[]},{kind:"Field",name:{kind:"Name",value:"options"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"PublicationOptions"},directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"visibility"},arguments:[],directives:[]}]}}]}}],loc:{start:0,end:855}};n.loc.source={body:'#import "./model-fragments.gql"\n#import "./photo-fragments.gql"\n#import "./floors.gql"\n#import "./rooms.gql"\n#import "./sweeps.gql"\n\n# Preloaded model data to be embedded into Showcase HTML page,\n# only load data that is required for Showcase to start (ie. NO Mattertags)\nquery GetModelPrefetch($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    assets {\n      meshes(formats: "dam", resolutions: ["50k", "500k"], compressions: none) { ...MeshDetails }\n      textures { ...TextureDetails }\n      tilesets { ...TilesetDetails }\n    }\n    floors { ...FloorDetails }\n    image { ...PhotoDetails }\n    locations(tags:"showcase") { ...AnchorLocationDetails }\n    name\n    options { ...ModelOptions }\n    organization\n    publication {\n      ...PublicationDetails\n      options { ...PublicationOptions }\n    }\n    rooms { ...RoomDetails }\n    visibility\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(97997).definitions)),n.definitions=n.definitions.concat(r(i(22164).definitions)),n.definitions=n.definitions.concat(r(i(81047).definitions)),n.definitions=n.definitions.concat(r(i(88655).definitions)),n.definitions=n.definitions.concat(r(i(15100).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetModelPrefetch=function(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}(n,"GetModelPrefetch")},88655:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetRooms"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"rooms"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"RoomDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"RoomDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ModelRoom"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"dimensions"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"height"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"width"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"depth"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"areaFloor"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]}]}}],loc:{start:0,end:266}};t.loc.source={body:"\nquery GetRooms ($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    rooms {\n      ...RoomDetails\n    }\n  }\n}\n\nfragment RoomDetails on ModelRoom {\n  id\n  meshId\n  floor {\n    id\n    meshId\n  }\n  dimensions {\n    height\n    width\n    depth\n    areaFloor\n  }\n  tags\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetRooms=r(t,"GetRooms"),e.exports.RoomDetails=r(t,"RoomDetails")},15100:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetShowcaseSweeps"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"locations"},arguments:[{kind:"Argument",name:{kind:"Name",value:"tags"},value:{kind:"StringValue",value:"showcase",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"AnchorLocationDetails"},directives:[]}]}}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"SkyboxPanorama"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"resolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"status"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"urlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileResolution"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileCount"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tileUrlTemplate"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"validUntil"},arguments:[],directives:[]}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"SkyboxUrlDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PanoramicImageLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"resolutions"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"skyboxes"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxDetails"},directives:[]}]}}]}},{kind:"FragmentDefinition",name:{kind:"Name",value:"AnchorLocationDetails"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"AnchorLocation"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"index"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"floor"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"room"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"meshId"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"neighbors"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"tags"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"pano"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"sweepUuid"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"label"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"placement"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"source"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"position"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"rotation"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"x"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"y"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"z"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"w"},arguments:[],directives:[]}]}},{kind:"FragmentSpread",name:{kind:"Name",value:"SkyboxUrlDetails"},directives:[]}]}}]}}],loc:{start:0,end:954}};t.loc.source={body:'\nquery GetSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nquery GetShowcaseSweeps($modelId: ID!) {\n  model(id: $modelId) {\n    id,\n    locations(tags: "showcase") {\n      ...AnchorLocationDetails\n    }\n  }\n}\n\nfragment SkyboxDetails on SkyboxPanorama {\n  # TODO(PL-5928) all SkyboxDetail results have the same non-unique id,\n  # using it as a map key will yield unexpected results\n  # id\n  resolution\n  status\n  urlTemplate\n  tileResolution\n  tileCount\n  tileUrlTemplate\n  validUntil\n}\n\nfragment SkyboxUrlDetails on PanoramicImageLocation {\n  id\n  resolutions\n  skyboxes { ...SkyboxDetails }\n}\n\nfragment AnchorLocationDetails on AnchorLocation {\n  id\n  index\n  floor { id, meshId }\n  room { id, meshId }\n  neighbors\n  tags\n  position { x y z }\n  pano {\n    id\n    sweepUuid\n    label\n    placement\n    source\n    position { x y z }\n    rotation { x y z w }\n    ...SkyboxUrlDetails\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetSweeps=r(t,"GetSweeps"),e.exports.GetShowcaseSweeps=r(t,"GetShowcaseSweeps"),e.exports.SkyboxDetails=r(t,"SkyboxDetails"),e.exports.SkyboxUrlDetails=r(t,"SkyboxUrlDetails"),e.exports.AnchorLocationDetails=r(t,"AnchorLocationDetails")},11820:e=>{var t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetCurrentUserModelAccess"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"userId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"ListValue",values:[{kind:"Variable",name:{kind:"Name",value:"userId"}}]}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}},{kind:"Field",name:{kind:"Name",value:"policies"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"name"},arguments:[],directives:[]},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"PolicyFlag"}},directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"enabled"},arguments:[],directives:[]}]}}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetUsers"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"search"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"ids"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"emails"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"String"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"users"},arguments:[{kind:"Argument",name:{kind:"Name",value:"search"},value:{kind:"Variable",name:{kind:"Name",value:"search"}}},{kind:"Argument",name:{kind:"Name",value:"ids"},value:{kind:"Variable",name:{kind:"Name",value:"ids"}}},{kind:"Argument",name:{kind:"Name",value:"emails"},value:{kind:"Variable",name:{kind:"Name",value:"emails"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"results"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"email"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"firstName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"lastName"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modelAccess"},arguments:[],directives:[]}]}}]}}]}}]}}],loc:{start:0,end:613}};t.loc.source={body:"# get access for the current user\nquery GetCurrentUserModelAccess($modelId: ID!, $userId: ID!) {\n  model(id: $modelId) {\n    users(ids: [$userId]) {\n      results {\n        modelAccess\n      }\n    }\n    policies {\n      name\n      ...on PolicyFlag {\n        enabled\n      }\n    }\n  }\n}\n\n# get users with access to the specified model\nquery GetUsers($modelId: ID!, $search: String, $ids: [ID!], $emails: [String!]) {\n  model(id: $modelId) {\n    users(search: $search, ids: $ids, emails: $emails) {\n      results {\n        id\n        email\n        firstName\n        lastName\n        modelAccess\n      }\n    }\n  }\n}\n",name:"GraphQL request",locationOffset:{line:1,column:1}};function i(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var n=e.type;"NamedType"===n.kind&&t.add(n.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){i(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){i(e,t)})),e.definitions&&e.definitions.forEach((function(e){i(e,t)}))}var n={};function s(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function r(e,t){var i={kind:e.kind,definitions:[s(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var r=n[t]||new Set,o=new Set,a=new Set;for(r.forEach((function(e){a.add(e)}));a.size>0;){var l=a;a=new Set,l.forEach((function(e){o.has(e)||(o.add(e),(n[e]||new Set).forEach((function(e){a.add(e)})))}))}return o.forEach((function(t){var n=s(e,t);n&&i.definitions.push(n)})),i}t.definitions.forEach((function(e){if(e.name){var t=new Set;i(e,t),n[e.name.value]=t}})),e.exports=t,e.exports.GetCurrentUserModelAccess=r(t,"GetCurrentUserModelAccess"),e.exports.GetUsers=r(t,"GetUsers")},53306:(e,t,i)=>{var n={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetMergeDiff"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"mergeDiff"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"src"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"dest"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"typesModified"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetViews"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"views"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"type"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"PublishView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"merge"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"RevertView"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"viewId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}},type:{kind:"ListType",type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"MergeableType"}}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"mergeMutator"},arguments:[{kind:"Argument",name:{kind:"Name",value:"src"},value:{kind:"Variable",name:{kind:"Name",value:"viewId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"revert"},arguments:[{kind:"Argument",name:{kind:"Name",value:"types"},value:{kind:"Variable",name:{kind:"Name",value:"mergeTypes"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]}]}}]}}]}},{kind:"OperationDefinition",operation:"query",name:{kind:"Name",value:"GetSessionDiff"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"modelId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"ID"}}},directives:[]}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"model"},arguments:[{kind:"Argument",name:{kind:"Name",value:"id"},value:{kind:"Variable",name:{kind:"Name",value:"modelId"}}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",alias:{kind:"Name",value:"base"},name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"StringValue",value:"matterport.model.default",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"LabelDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MattertagDetails"},directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"FragmentSpread",name:{kind:"Name",value:"MeasurementDetails"},directives:[]}]}}]}}]}},{kind:"Field",alias:{kind:"Name",value:"view"},name:{kind:"Name",value:"view"},arguments:[{kind:"Argument",name:{kind:"Name",value:"type"},value:{kind:"StringValue",value:"matterport.workshop.session",block:!1}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"model"},arguments:[],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"labels"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"mattertags"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}},{kind:"Field",name:{kind:"Name",value:"measurementPaths"},arguments:[{kind:"Argument",name:{kind:"Name",value:"includeDisabled"},value:{kind:"BooleanValue",value:!0}}],directives:[],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"},arguments:[],directives:[]},{kind:"Field",name:{kind:"Name",value:"modified"},arguments:[],directives:[]}]}}]}}]}}]}}]}}],loc:{start:0,end:1499}};n.loc.source={body:'#import "./labels.gql"\n#import "./mattertags.gql"\n#import "./measurements.gql"\n\n# Gets the data types that have changed between a view and the base model\nquery GetMergeDiff($viewId: ID!) {\n  model(id: $viewId) {\n    id\n    mergeDiff {\n      src\n      dest\n      typesModified\n    }\n  }\n}\n\n# Get available views for a model\nquery GetViews($modelId: ID!) {\n  model(id: $modelId) {\n    id\n    views {\n      id\n      type\n    }\n  }\n}\n\n# Merges the given view into the base model view\nmutation PublishView($viewId: ID!) {\n  mergeMutator(src: $viewId) {\n    merge {\n      id\n    }\n  }\n}\n\n# Resets the provided view to be the same as the base model view\nmutation RevertView($viewId: ID!, $mergeTypes: [MergeableType!]) {\n  mergeMutator(src: $viewId) {\n    revert(types: $mergeTypes ) {\n      id\n    }\n  }\n}\n\n# Gets the data that has changed between the Workshop session and base model\nquery GetSessionDiff($modelId: ID!) {\n  model(id: $modelId) {\n    base: view(type: "matterport.model.default") {\n      id\n      model {\n        labels(includeDisabled: true) { ...LabelDetails }\n        mattertags(includeDisabled: true) { ...MattertagDetails }\n        measurementPaths(includeDisabled: true) { ...MeasurementDetails }\n      }\n    }\n    view: view(type: "matterport.workshop.session") {\n      id\n      model {\n        labels(includeDisabled: true) { id modified }\n        mattertags(includeDisabled: true) { id modified }\n        measurementPaths(includeDisabled: true) { id modified }\n      }\n    }\n  }\n}\n',name:"GraphQL request",locationOffset:{line:1,column:1}};var s={};function r(e){return e.filter((function(e){if("FragmentDefinition"!==e.kind)return!0;var t=e.name.value;return!s[t]&&(s[t]=!0,!0)}))}function o(e,t){if("FragmentSpread"===e.kind)t.add(e.name.value);else if("VariableDefinition"===e.kind){var i=e.type;"NamedType"===i.kind&&t.add(i.name.value)}e.selectionSet&&e.selectionSet.selections.forEach((function(e){o(e,t)})),e.variableDefinitions&&e.variableDefinitions.forEach((function(e){o(e,t)})),e.definitions&&e.definitions.forEach((function(e){o(e,t)}))}n.definitions=n.definitions.concat(r(i(95162).definitions)),n.definitions=n.definitions.concat(r(i(6850).definitions)),n.definitions=n.definitions.concat(r(i(37946).definitions));var a={};function l(e,t){for(var i=0;i<e.definitions.length;i++){var n=e.definitions[i];if(n.name&&n.name.value==t)return n}}function c(e,t){var i={kind:e.kind,definitions:[l(e,t)]};e.hasOwnProperty("loc")&&(i.loc=e.loc);var n=a[t]||new Set,s=new Set,r=new Set;for(n.forEach((function(e){r.add(e)}));r.size>0;){var o=r;r=new Set,o.forEach((function(e){s.has(e)||(s.add(e),(a[e]||new Set).forEach((function(e){r.add(e)})))}))}return s.forEach((function(t){var n=l(e,t);n&&i.definitions.push(n)})),i}n.definitions.forEach((function(e){if(e.name){var t=new Set;o(e,t),a[e.name.value]=t}})),e.exports=n,e.exports.GetMergeDiff=c(n,"GetMergeDiff"),e.exports.GetViews=c(n,"GetViews"),e.exports.PublishView=c(n,"PublishView"),e.exports.RevertView=c(n,"RevertView"),e.exports.GetSessionDiff=c(n,"GetSessionDiff")}},r={};function o(e){var t=r[e];if(void 0!==t)return t.exports;var i=r[e]={id:e,loaded:!1,exports:{}};return s[e].call(i.exports,i,i.exports,o),i.loaded=!0,i.exports}o.m=s,o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,o.t=function(i,n){if(1&n&&(i=this(i)),8&n)return i;if("object"==typeof i&&i){if(4&n&&i.__esModule)return i;if(16&n&&"function"==typeof i.then)return i}var s=Object.create(null);o.r(s);var r={};e=e||[null,t({}),t([]),t(t)];for(var a=2&n&&i;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>r[e]=()=>i[e]));return r.default=()=>i,o.d(s,r),s},o.d=(e,t)=>{for(var i in t)o.o(t,i)&&!o.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},o.f={},o.e=e=>Promise.all(Object.keys(o.f).reduce(((t,i)=>(o.f[i](e,t),t)),[])),o.u=e=>"js/"+e+".js",o.miniCssF=e=>"css/"+({66:"control-kit",136:"late",143:"font",316:"menus",321:"core",376:"vr",458:"showcase",521:"late-stream",525:"sdk-bundle",718:"encoders",833:"split",838:"externalSdkLoader",932:"lib-lottie",983:"tiled"}[e]||e)+".css",o.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),o.hmd=e=>((e=Object.create(e)).children||(e.children=[]),Object.defineProperty(e,"exports",{enumerable:!0,set:()=>{throw new Error("ES Modules may not assign module.exports or exports.*, Use ESM export syntax, instead: "+e.id)}}),e),o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i={},n="mp_webgl:",o.l=(e,t,s,r)=>{if(i[e])i[e].push(t);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),d=0;d<c.length;d++){var h=c[d];if(h.getAttribute("src")==e||h.getAttribute("data-webpack")==n+s){a=h;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",a.timeout=120,o.nc&&a.setAttribute("nonce",o.nc),a.setAttribute("data-webpack",n+s),a.src=e),i[e]=[t];var u=(t,n)=>{a.onerror=a.onload=null,clearTimeout(p);var s=i[e];if(delete i[e],a.parentNode&&a.parentNode.removeChild(a),s&&s.forEach((e=>e(n))),t)return t(n)},p=setTimeout(u.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=u.bind(null,a.onerror),a.onload=u.bind(null,a.onload),l&&document.head.appendChild(a)}},o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),o.p="",(()=>{var e={458:0};o.f.j=(t,i)=>{var n=o.o(e,t)?e[t]:void 0;if(0!==n)if(n)i.push(n[2]);else{var s=new Promise(((i,s)=>n=e[t]=[i,s]));i.push(n[2]=s);var r=o.p+o.u(t),a=new Error;o.l(r,(i=>{if(o.o(e,t)&&(0!==(n=e[t])&&(e[t]=void 0),n)){var s=i&&("load"===i.type?"missing":i.type),r=i&&i.target&&i.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+r+")",a.name="ChunkLoadError",a.type=s,a.request=r,n[1](a)}}),"chunk-"+t,t)}};var t=(t,i)=>{var n,s,[r,a,l]=i,c=0;for(n in a)o.o(a,n)&&(o.m[n]=a[n]);if(l)l(o);for(t&&t(i);c<r.length;c++)s=r[c],o.o(e,s)&&e[s]&&e[s][0](),e[r[c]]=0},i=self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[];i.forEach(t.bind(null,0)),i.push=t.bind(null,i.push.bind(i))})(),(()=>{"use strict";var e=o(90933);class EngineContext{constructor(e,t){this.fetchedModules=[],this.engine=e,this.moduleLookup=t,this.messageBus=e.msgBus,this.market=new MarketContext(e.market),this.commandBinder=e.commandBinder,this.getModuleSync=e.getModuleSync.bind(e),this.getModuleBySymbolSync=e.getModuleBySymbolSync.bind(e),this.addComponent=e.addComponent.bind(e),this.getComponentByType=e.getComponentByType.bind(e),this.getComponents=e.getComponents.bind(e),this.removeComponent=e.removeComponent.bind(e),this.subscribe=e.subscribe.bind(e),this.unsubscribe=e.unsubscribe.bind(e),this.broadcast=e.broadcast.bind(e),this.claimRenderLayer=e.claimRenderLayer.bind(e),this.getRenderLayer=e.getRenderLayer.bind(e),this.disposeRenderLayer=e.disposeRenderLayer.bind(e),this.startGenerator=e.startGenerator.bind(e),this.stopGenerator=e.stopGenerator.bind(e),this.after=e.after.bind(e),this.deactivate=e.deactivate.bind(e),this.toggleRendering=e.toggleRendering.bind(e),this.getXrFrame=e.getXrFrame.bind(e)}getModule(e){const t=Date.now();return this.engine.getModule(e).then((e=>{const i=Date.now();return this.fetchedModules.push({moduleName:e.name,isModule:!0,startAwait:t,finishAwait:i}),e}))}getModuleBySymbol(e){const t=Date.now();return this.engine.getModuleBySymbol(e).then((e=>{const i=Date.now();return this.fetchedModules.push({moduleName:this.getModuleName(e),isModule:!0,startAwait:t,finishAwait:i}),e}))}getLoadedDependencies(){return[...this.fetchedModules,...this.market.getLoadedDependencies()]}get msgBus(){return this.messageBus}getModuleName(e){for(const t in this.moduleLookup)if(e===this.moduleLookup[t].module)return t;return"[Unknown module]"}}class MarketContext{constructor(e){this.fetchedData=[],this.market=e,this.register=e.register.bind(e),this.unregister=e.unregister.bind(e),this.tryGetData=e.tryGetData.bind(e),this.getModuleNameFromData=e.getModuleNameFromData.bind(e)}waitForData(t){const i=Date.now();return this.market.waitForData(t).then((t=>{const n=Date.now();return this.fetchedData.push({moduleName:this.getModuleNameFromData((0,e.oL)(t)),isModule:!1,startAwait:i,finishAwait:n}),t}))}getLoadedDependencies(){return this.fetchedData}}var t=o(64185),i=o(88512);const n=new i.Z("module-loader");var s;!function(e){e[e.Registered=0]="Registered",e[e.Loading=1]="Loading",e[e.Initialized=2]="Initialized",e[e.Unloaded=3]="Unloaded"}(s||(s={}));class ModuleLoader{constructor(){this.registeredModules={},this.typeLookup=new e.cj}registerModule(e,i){const n=this.typeLookup.addType(e),r={es6ModulePromise:i,ctorPromise:new t.Q,initPromise:new t.Q,state:s.Registered};this.registeredModules[n]=r}getTypeID(e){const t=this.typeLookup.getKeyByType(e);if(!t)throw Error("Trying to access unregistered Module");return t}getTypeFromTypeID(e){return this.typeLookup.getTypeByKey(e)}moduleRegistered(e){return!!this.typeLookup.getKeyByType(e)}moduleLoaded(e){if(!this.moduleRegistered(e))return!1;const t=this.typeLookup.getKeyByType(e),i=this.registeredModules[t].state;return![s.Registered,s.Unloaded].includes(i)}getModule(t){const i=this.typeLookup.getKeyByType(t);if(!i)throw Error(`Trying to get ${(0,e.HS)(t)} before it was registered!`);if(this.registeredModules[i].state===s.Unloaded)throw Error(`${(0,e.HS)(t)} module unloaded`);return this.registeredModules[i].initPromise.nativePromise()}getModuleSync(t){const i=this.typeLookup.getKeyByType(t);if(!i)throw new Error(`Trying to get ${(0,e.HS)(t)} before it was registered!`);const n=this.registeredModules[i];if(n.state!==s.Initialized||void 0===n.module)throw Error(`${(0,e.HS)(t)} module not loaded!`);return n.module}loadModule(t,i,r={}){const o=this.typeLookup.getKeyByType(i);if(!o)throw Error(`Attempting to load an unregistered module ${(0,e.HS)(i)}`);const a=this.registeredModules[o];if(a.state===s.Initialized)return a;if(a.state!==s.Registered&&a.state!==s.Unloaded)throw Error(`${(0,e.HS)(i)} already loading`);a.state=s.Loading;const l=(0,e.HS)(i);return a.es6ModulePromise(l).then((o=>{if(!o.default)throw new Error(`${(0,e.HS)(i)} has no default export during module loading`);const l=new o.default;a.ctorPromise.resolve(l).then((()=>{const e=Date.now();let i=!1;setTimeout((()=>{i||n.debug(`${l.name} init took over 2 seconds`)}),2e3),l.init(r,t).then((()=>{n.debug(`${l.name} init took ${(Date.now()-e)/1e3} secs.`),i=!0,a.state=s.Initialized,a.module=l,a.initPromise.resolve(l)})).catch((e=>{a.initPromise.reject(e)}))}))})).catch((t=>{n.error(`Failed to load es6Module for ${(0,e.HS)(i)}: ${t}`),a.initPromise.reject(t)})),a}whenQueueEmpties(){const e=[];for(const t in this.registeredModules){const i=this.registeredModules[t];i.state===s.Loading&&e.push(i.initPromise)}return t.Q.all(e).nativePromise()}unloadModule(e){const i=this.typeLookup.getKeyByType(e);if(!i)throw Error("Attempting to unload unregistered module");const n=this.registeredModules[i];if(n.state===s.Unloaded||n.state===s.Registered)throw Error("Attempting to unload not-loaded module");n.state=s.Unloaded,n.ctorPromise=new t.Q,n.initPromise=new t.Q,n.module=void 0}}const r="Data not present.",a=new i.Z("market");class Market{constructor(){this.typeLookup=new e.cj,this.store={},this.moduleRegistry={},this.firstUpdatePromises={}}register(e,t,i){const n=this.typeLookup.getKeyByType(t,!0);if(this.moduleRegistry[n])throw Error("Data can only be registered to one Module");this.moduleRegistry[n]=e,this.store[n]=i,i.commit(),this.firstUpdatePromises[n]&&(this.firstUpdatePromises[n].resolve(this.store[n]),delete this.firstUpdatePromises[n])}unregister(e,t){const i=this.typeLookup.getKeyByType(t,!0);if(!this.moduleRegistry[i])throw Error("No Data was registered to the Module");delete this.moduleRegistry[i],delete this.store[i]}getData(e){const t=this.typeLookup.getKeyByType(e);if(t in this.store)return this.store[t];throw Error(r)}waitForData(e){const n=this.typeLookup.getKeyByType(e,!0);return n in this.store?Promise.resolve(this.store[n]):(this.firstUpdatePromises[n]||(this.firstUpdatePromises[n]=new t.Q,setTimeout((()=>{i.Z.level>=3&&!(n in this.store)&&a.debug(`still waiting for ${e.name}-data after 5 seconds`)}),5e3)),this.firstUpdatePromises[n].nativePromise())}tryGetData(e){try{return this.getData(e)}catch(e){if(e.message!==r)throw a.error("tryGetData",e.message),e}return null}debugData(){const e={};for(const t in this.moduleRegistry){const i=this.moduleRegistry[t];i&&(e[i.name]||(e[i.name]=[]),e[i.name].push(this.store[t]))}return Object.freeze(e)}getModuleNameFromData(e){const t=this.typeLookup.getKeyByType(e);if(t){const e=this.moduleRegistry[t];if(e)return e.name}throw Error(r)}}var l=o(63432),c=o(11554),d=o(84303),h=o(76701),u=o(84561),p=o(21479);class Profiler{constructor(){this.phaseTimes=[],this.modules={},this.addAppPhase(p.nh.UNINITIALIZED),window.profilingData={phaseTimes:this.phaseTimes,modules:this.modules}}addAppPhase(e){this.phaseTimes[e]=Date.now()}addModuleLoadTime(e,t,i,n){const s=n.map((e=>e.moduleName)).join(","),r=n.reduce(((e,t)=>e+t.finishAwait-t.startAwait),0)/(i-t)*100;this.modules[e]=[e,e,null,t,i,null,r,s]}}var m=o(8150),f=o(96909);const g=new i.Z("engine");let v=d.A.End;class Engine{constructor(e=!1){this.moduleLookup={},this.componentLookup={},this.deactivatedHack=!1,this.currentApplication=null,this.moduleProfiler=new Profiler,this.commandBinder=new c.B,this.market=new Market,this.messageBus=new l.Y,this.engineGenerators=new h.ZP,this.layers=new u.o,this.moduleLoader=new ModuleLoader,this.symbolLoader=new f.m,this.afterPhasePromises=[],this.afterPhaseListenerCount=[],this.resetPromises(),this.subscribe(m.LZ,(e=>this.moduleProfiler.addAppPhase(e.phase)))}async loadApplication(e,t,i){if(e===this.currentApplication)throw Error("Application already loaded");const n=(this.currentApplication?this.currentApplication.getManifest():[]).map((e=>e.type)),s=e.getManifest(),r=s.map((e=>e.type)),o=this.currentApplication;this.currentApplication=null;const a=n.filter((e=>-1===r.indexOf(e))),l=a.filter((e=>"symbol"!=typeof e)),c=a.filter((e=>"symbol"==typeof e)),d=[...l.map((e=>this.unloadModule(e))),...c.map((e=>this.unloadModuleBySymbol(e)))];o&&d.push(o.unload(this));const h=s.filter((e=>-1===n.indexOf(e.type)));for(const e of h)"symbol"==typeof e.type?this.symbolLoader.moduleRegistered(e.type)||this.registerModule(e):this.moduleLoader.moduleRegistered(e.type)||this.registerModule(e);if(d.length)try{await Promise.all(d)}catch(e){g.error(e),t&&t(e)}try{this.currentApplication=e,await e.load(this,{coldStart:null===o,autoPlay:i})}catch(e){g.error(e),t&&t(e)}}registerModule(e){if(this.currentApplication)throw Error("Cannot register modules while application is running");"symbol"==typeof e.type?this.symbolLoader.registerModule(e.type,e.promise):this.moduleLoader.registerModule(e.type,e.promise)}loadModule(e){const t=e;this.moduleLoadInjectionHook&&(t.config=this.moduleLoadInjectionHook(t.type,t.config||{}));const i=new EngineContext(this,this.moduleLookup),n=Date.now(),s=this.moduleLoader.loadModule(i,t.type,t.config);return s.ctorPromise.then((e=>this.moduleLookup[this.moduleLoader.getTypeID(t.type)]={module:e,initialized:!1})),s.initPromise.then((e=>{this.moduleProfiler.addModuleLoadTime(e.name,n,Date.now(),i.getLoadedDependencies()),this.moduleLookup[this.moduleLoader.getTypeID(t.type)].initialized=!0})),s.initPromise.nativePromise()}loadModuleBySymbol(e){const t=e,i=String(t.type);this.moduleLoadInjectionHook&&(t.config=this.moduleLoadInjectionHook(i,t.config||{}));const n=new EngineContext(this,this.moduleLookup),s=Date.now(),r=this.symbolLoader.loadModule(n,t.type,t.config);return r.ctorPromise.then((e=>this.moduleLookup[i]={symbol:t.type,module:e,initialized:!1,initPromise:r.initPromise.nativePromise()})),r.initPromise.then((e=>{this.moduleProfiler.addModuleLoadTime(e.name,s,Date.now(),n.getLoadedDependencies()),this.moduleLookup[i].initialized=!0})),r.initPromise.nativePromise()}setLoadInjection(e){if(void 0!==this.moduleLoadInjectionHook)throw Error("Hook already registered");this.moduleLoadInjectionHook=e}async unloadModule(t){if(!this.moduleLoader.moduleLoaded(t))return void g.debug(`${(0,e.HS)(t)} module already unloaded`);g.debug(`Unloading ${(0,e.HS)(t)} module`);const i=await this.getModule(t),n=this.getModuleIndex(i);this.componentLookup[n]&&(await Promise.all(this.componentLookup[n].map((async e=>{await this.removeComponent(i,e.component),e.component.dispose()}))),this.componentLookup[n]=[]),this.moduleLoader.unloadModule(t),i.dispose(this)}async unloadModuleBySymbol(e){if(!this.symbolLoader.moduleLoaded(e))return void g.debug(`${String(e)} module already unloaded`);g.debug(`Unloading ${String(e)} module`);const{module:t,initPromise:i}=this.moduleLookup[String(e)];await i;const n=this.getModuleIndex(t);this.componentLookup[n]&&(await Promise.all(this.componentLookup[n].map((async e=>{await this.removeComponent(t,e.component),e.component.dispose()}))),this.componentLookup[n]=[]),this.symbolLoader.unloadModule(e),t.dispose(this)}async waitForLoadingModules(){await Promise.all([this.moduleLoader.whenQueueEmpties(),this.symbolLoader.whenQueueEmpties()])}async getModule(e){return this.moduleLoader.getModule(e)}getModuleBySymbol(e){return this.symbolLoader.getModule(e)}getModuleSync(e){return this.moduleLoader.getModuleSync(e)}getModuleBySymbolSync(e){return this.symbolLoader.getModuleSync(e)}getComponentByType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t].module,n=this.getModuleIndex(i),s=this.componentLookup[n]||[];for(const t of s)if(t.component instanceof e)return t.component}return null}async addComponent(e,t){const i=this.getModuleIndex(e);let n=this.componentLookup[i];n||(this.componentLookup[i]=n=[]);let s=-1;for(let e=0;e<n.length;e++)if(n[e].component===t){s=e;break}if(-1===s&&(s=n.push({component:t,active:!1})-1,t.init()),n[s].active)throw Error("Tried to add already active component: "+typeof t);await t.activate(this),n[s].active=!0}async removeComponent(e,t){const i=this.getModuleIndex(e),n=this.componentLookup[i];if(n){let e=null;for(const i of n)if(i.component===t){e=i;break}e&&e.active&&(await t.deactivate(this),e.active=!1)}}tick(){if(this.deactivatedHack)return;if(v!==d.A.End)throw Error("Engine.tick called outside of waiting. Did the engine get called recursively?!");v=d.A.Begin,this.resolveAfterPhase(d.A.Begin);const e=performance.now(),t=this.lastTick?e-this.lastTick:16;this.lastTick=e,v=d.A.Logic;try{for(const e in this.moduleLookup){const i=this.moduleLookup[e];i&&i.initialized&&i.module.onUpdate(t)}}catch(e){throw g.error(e),e}this.resolveAfterPhase(d.A.Logic),this.engineGenerators.processGenerators(h.p3.Phase,d.A.Logic);try{this.renderComponents(t)}catch(e){throw g.error(e),e}try{v=d.A.Render,this.resolveAfterPhase(d.A.Render),this.engineGenerators.processGenerators(h.p3.Phase,d.A.Render),v=d.A.End,this.resolveAfterPhase(d.A.End),this.engineGenerators.processGenerators(h.p3.None),this.engineGenerators.processGenerators(h.p3.Promise),this.engineGenerators.processGenerators(h.p3.Duration)}catch(e){throw g.error(e),e}}subscribe(e,t,i=l.Q.PERMANENT){return this.messageBus.subscribe(e,t,i)}unsubscribe(e,t){this.messageBus.unsubscribe(e,t)}broadcast(e){this.messageBus.broadcast(e)}claimRenderLayer(e){return this.layers.claimLayer(e)}getRenderLayer(e){return this.layers.getLayer(e)}disposeRenderLayer(e){this.layers.disposeLayer(e)}startGenerator(e){this.engineGenerators.startGenerator(e)}stopGenerator(e){this.engineGenerators.stopGenerator(e)}after(e){return this.afterPhaseListenerCount[e]++,this.afterPhasePromises[e].nativePromise()}getModuleIndex(e){for(const t in this.moduleLookup)if(this.moduleLookup[t]&&this.moduleLookup[t].module===e)return t;return""}*getComponents(){for(const e in this.moduleLookup){const t=this.componentLookup[e];if(t)for(const e of t)yield e}}toggleRendering(e,t){const i=this.getModuleIndex(e),n=this.componentLookup[i];if(n)for(const e of n)e.active=t}renderComponents(e){for(const t in this.moduleLookup){const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.beforeRender&&t.component.beforeRender(e)}for(const t in this.moduleLookup){if(!t)continue;const i=this.componentLookup[t];if(i)for(const t of i)t.active&&t.component.render(e)}}resetPromises(){this.resetAfterPhasePromises()}resetAfterPhasePromises(){this.resetAfterPhasePromise(d.A.Logic),this.resetAfterPhasePromise(d.A.Render),this.resetAfterPhasePromise(d.A.Begin),this.resetAfterPhasePromise(d.A.End)}resetAfterPhasePromise(e){this.afterPhasePromises[e]=new t.Q,this.afterPhaseListenerCount[e]=0}resolveAfterPhase(e){this.afterPhaseListenerCount[e]>0&&(this.afterPhasePromises[e].resolve(),this.resetAfterPhasePromise(e))}deactivate(){for(const e in this.moduleLookup){const t=this.moduleLookup[e];if(t&&t.initialized)if(t.symbol)this.unloadModuleBySymbol(t.symbol);else{const e=this.getModuleType(t.module);e&&this.unloadModule(e)}}this.deactivatedHack=!0}setXrFrame(e){this.xrFrame=e}getXrFrame(){return this.xrFrame}getModuleType(e){for(const t in this.moduleLookup){const i=this.moduleLookup[t];if(i&&i.module===e)return this.moduleLoader.getTypeFromTypeID(t)}return null}get msgBus(){return this.messageBus}}const y=6407,b=6408,S=5121,E=5126,T=5131,w=36193;{const e={};e[6406]={numColorComponents:1},e[6409]={numColorComponents:1},e[6410]={numColorComponents:2},e[y]={numColorComponents:3},e[b]={numColorComponents:4},e[6403]={numColorComponents:1},e[36244]={numColorComponents:1},e[33319]={numColorComponents:2},e[33320]={numColorComponents:2},e[y]={numColorComponents:3},e[36248]={numColorComponents:3},e[b]={numColorComponents:4},e[36249]={numColorComponents:4},e[6402]={numColorComponents:1},e[34041]={numColorComponents:2}}let x;function _(e,t,i){return function(n,s,r){return((n+e-1)/e|0)*((s+t-1)/t|0)*i*r}}function M(e,t,i){return function(n,s,r){return(Math.max(n,e)*Math.max(s,t)/i|0)*r}}const O=new Map([[33776,_(4,4,8)],[33777,_(4,4,8)],[33778,_(4,4,16)],[33779,_(4,4,16)],[36196,_(4,4,8)],[35840,M(8,8,2)],[35842,M(8,8,2)],[35841,M(16,8,4)],[35843,M(16,8,4)],[37488,_(4,4,8)],[37489,_(4,4,8)],[37492,_(4,4,8)],[37493,_(4,4,8)],[37494,_(4,4,8)],[37495,_(4,4,8)],[37490,_(4,4,16)],[37491,_(4,4,16)],[37496,_(4,4,16)],[37497,_(4,4,16)],[37808,_(4,4,16)],[37840,_(4,4,16)],[37809,_(5,4,16)],[37841,_(5,4,16)],[37810,_(5,5,16)],[37842,_(5,5,16)],[37811,_(6,5,16)],[37843,_(6,5,16)],[37812,_(6,6,16)],[37844,_(6,6,16)],[37813,_(8,5,16)],[37845,_(8,5,16)],[37814,_(8,6,16)],[37846,_(8,6,16)],[37815,_(8,8,16)],[37847,_(8,8,16)],[37816,_(10,5,16)],[37848,_(10,5,16)],[37817,_(10,6,16)],[37849,_(10,6,16)],[37818,_(10,8,16)],[37850,_(10,8,16)],[37819,_(10,10,16)],[37851,_(10,10,16)],[37820,_(12,10,16)],[37852,_(12,10,16)],[37821,_(12,12,16)],[37853,_(12,12,16)],[35916,_(4,4,8)],[35917,_(4,4,8)],[35918,_(4,4,16)],[35919,_(4,4,16)]]);function A(e,t){const i=function(e){if(!x){const e={};e[6406]={bytesPerElement:[1,2,2,4],type:[S,T,w,E]},e[6409]={bytesPerElement:[1,2,2,4],type:[S,T,w,E]},e[6410]={bytesPerElement:[2,4,4,8],type:[S,T,w,E]},e[y]={bytesPerElement:[3,6,6,12,2],type:[S,T,w,E,33635]},e[b]={bytesPerElement:[4,8,8,16,2,2],type:[S,T,w,E,32819,32820]},e[6402]={bytesPerElement:[2,4],type:[5125,5123]},e[34041]={bytesPerElement:[4]},e[33321]={bytesPerElement:[1]},e[36756]={bytesPerElement:[1]},e[33325]={bytesPerElement:[2]},e[33326]={bytesPerElement:[4]},e[33330]={bytesPerElement:[1]},e[33329]={bytesPerElement:[1]},e[33332]={bytesPerElement:[2]},e[33331]={bytesPerElement:[2]},e[33334]={bytesPerElement:[4]},e[33333]={bytesPerElement:[4]},e[33323]={bytesPerElement:[2]},e[36757]={bytesPerElement:[2]},e[33327]={bytesPerElement:[4]},e[33328]={bytesPerElement:[8]},e[33336]={bytesPerElement:[2]},e[33335]={bytesPerElement:[2]},e[33338]={bytesPerElement:[4]},e[33337]={bytesPerElement:[4]},e[33340]={bytesPerElement:[8]},e[33339]={bytesPerElement:[8]},e[32849]={bytesPerElement:[3]},e[35905]={bytesPerElement:[3]},e[36194]={bytesPerElement:[2]},e[36758]={bytesPerElement:[3]},e[35898]={bytesPerElement:[4]},e[35901]={bytesPerElement:[4]},e[34843]={bytesPerElement:[6]},e[34837]={bytesPerElement:[12]},e[36221]={bytesPerElement:[3]},e[36239]={bytesPerElement:[3]},e[36215]={bytesPerElement:[6]},e[36233]={bytesPerElement:[6]},e[36209]={bytesPerElement:[12]},e[36227]={bytesPerElement:[12]},e[32856]={bytesPerElement:[4]},e[35907]={bytesPerElement:[4]},e[36759]={bytesPerElement:[4]},e[32855]={bytesPerElement:[2]},e[32854]={bytesPerElement:[2]},e[32857]={bytesPerElement:[4]},e[34842]={bytesPerElement:[8]},e[34836]={bytesPerElement:[16]},e[36220]={bytesPerElement:[4]},e[36238]={bytesPerElement:[4]},e[36975]={bytesPerElement:[4]},e[36214]={bytesPerElement:[8]},e[36232]={bytesPerElement:[8]},e[36226]={bytesPerElement:[16]},e[36208]={bytesPerElement:[16]},e[33189]={bytesPerElement:[2]},e[33190]={bytesPerElement:[4]},e[36012]={bytesPerElement:[4]},e[35056]={bytesPerElement:[4]},e[36013]={bytesPerElement:[4]},x=e}return x[e]}(e);if(!i)throw"unknown internal format";if(i.type){const n=i.type.indexOf(t);if(n<0)throw new Error(`unsupported type ${t} for internalformat ${e}`);return i.bytesPerElement[n]}return i.bytesPerElement[0]}function C(e,t,i,n,s){const r=O.get(e);return r?r(t,i,n):function(e,t,i,n,s){return t*i*n*A(e,s)}(e,t,i,n,s)}function P(e){return function(e){return e&&e.buffer&&e.buffer instanceof ArrayBuffer}(e)||e instanceof ArrayBuffer}new Map([[34962,34964],[34963,34965],[3553,32873],[34067,34068],[32879,32874],[35866,35869],[36161,36007],[36160,36006],[36009,36006],[36008,36010],[35345,35368],[35982,35983],[36386,36389]]);new Map([[35670,1],[5120,1],[5121,1],[5122,2],[5123,2],[5124,4],[5125,4],[5126,4]]);new Map([[5121,Uint8Array],[5123,Uint16Array],[5125,Uint32Array]]);function D(e,t,i={}){const n=i.origGLErrorFn||e.getError;const s=i.sharedState||function(e){const t={samples:(n=e).getParameter(n.SAMPLES),depthBits:n.getParameter(n.DEPTH_BITS),contextAttributes:n.getContextAttributes()};var n;const s={baseContext:e,config:i,apis:{gman_webgl_memory:{ctx:{getMemoryInfo(){const i=function(e,t){const{samples:i,depthBits:n,contextAttributes:s}=t,{width:r,height:o}=e.canvas,a=r*o*4,l=s.depth?1:0,c=s.stencil?1:0;return a+a*i+a*l*Math.min(c+n>16?4:2,4)}(e,t);return{memory:{...c,drawingbuffer:i,total:i+c.buffer+c.texture+c.renderbuffer},resources:{...d}}}}}},resources:{},memory:{texture:0,buffer:0,renderbuffer:0},bindings:new Map,defaultVertexArray:{},webglObjectToMemory:new Map};return s.webglObjectToMemory.set(s.defaultVertexArray,{}),s.currentVertexArray=s.defaultVertexArray,s}(e);i.sharedState=s;const{apis:r,baseContext:o,bindings:a,config:l,memory:c,resources:d,webglObjectToMemory:h}=s,u={};function p(){}function m(e,t,i){if(e[i||`create${t[0].toUpperCase()}${t.substr(1)}`])return d[t]=0,function(e,i,n,s){++d[t],h.set(s,{size:0})}}function f(t,i=p,n){const s=n||`delete${t[0].toUpperCase()}${t.substr(1)}`;if(e[s])return function(e,n,s){const[r]=s,o=h.get(r);o&&(--d[t],i(r,o),h.delete(r))}}function g(e,t,i,n,s){const r=a.get(e);if(!r)throw new Error(`no renderbuffer bound to ${e}`);const o=h.get(r);if(!o)throw new Error(`unknown renderbuffer ${r}`);const l=C(i,n,s,1)*t;c.renderbuffer-=o.size,o.size=l,c.renderbuffer+=l}const v=5121,y=34067,b=35866,S=34069,E=new Set([S,34070,34071,34072,34073,34074]);function T(e){return E.has(e)}function w(e){e=T(e)?y:e;const t=a.get(e);if(!t)throw new Error(`no texture bound to ${e}`);const i=h.get(t);if(!i)throw new Error(`unknown texture ${t}`);return i}function x(e,t,i,n,s,r,o,a){const l=e.size,d=C(n,s,r,o,a),h=T(t)?t-S:0;e.mips=e.mips||[],e.mips[i]=e.mips[i]||[];const u=e.mips[i][h]||{};e.size-=u.size||0,u.size=d,u.internalFormat=n,u.type=a,u.width=s,u.height=r,u.depth=o,e.mips[i][h]=u,e.size+=d,c.texture-=l,c.texture+=e.size}function _(e,t,i,n,s,r){const o=w(e),a=e===y?6:1,l=e===y?S:e;for(let c=0;c<t;++c){for(let e=0;e<a;++e)x(o,l+e,c,i,n,s,r);n=Math.ceil(Math.max(n/2,1)),s=Math.ceil(Math.max(s/2,1)),r=e===b?r:Math.ceil(Math.max(r/2,1))}}function M(e,t,i){const[n]=i;s.currentVertexArray=n||s.defaultVertexArray}function O(e,t){switch(e){case 34963:h.get(s.currentVertexArray).elementArrayBuffer=t;break;default:a.set(e,t)}}const A={},N={bufferData(e,t,i){const[n,r,,o=0,l]=i;let d;switch(n){case 34963:d=h.get(s.currentVertexArray).elementArrayBuffer;break;default:d=a.get(n)}if(!d)throw new Error(`no buffer bound to ${n}`);let u=0;if(void 0!==l)u=l;else if(P(r))u=r.byteLength;else{if("number"!=typeof r)throw new Error(`unsupported bufferData src type ${r}`);u=r}const p=h.get(d);if(!p)throw new Error(`unknown buffer ${d}`);c.buffer-=p.size,p.size=u,c.buffer+=u},bindVertexArray:M,bindVertexArrayOES:M,bindBuffer(e,t,i){const[n,s]=i;O(n,s)},bindBufferBase(e,t,i){const[n,s,r]=i;O(n,r)},bindBufferRange(e,t,i){const[n,s,r,o,a]=i;O(n,r)},bindRenderbuffer(e,t,i){const[n,s]=i;a.set(n,s)},bindTexture(e,t,i){const[n,s]=i;a.set(n,s)},copyTexImage2D(e,t,i){const[n,s,r,o,a,l,c,d]=i;x(w(n),n,s,r,l,c,1,v)},createBuffer:m(e,"buffer"),createFramebuffer:m(e,"framebuffer"),createRenderbuffer:m(e,"renderbuffer"),createProgram:m(e,"program"),createQuery:m(e,"query"),createShader:m(e,"shader"),createSampler:m(e,"sampler"),createTexture:m(e,"texture"),createTransformFeedback:m(e,"transformFeedback"),createVertexArray:m(e,"vertexArray"),createVertexArrayOES:m(e,"vertexArray","createVertexArrayOES"),compressedTexImage2D(e,t,i){const[n,s,r,o,a]=i;x(w(n),n,s,r,o,a,1,v)},compressedTexImage3D(e,t,i){const[n,s,r,o,a,l]=i;x(w(n),n,s,r,o,a,l,v)},deleteBuffer:f("buffer",(function(e,t){c.buffer-=t.size})),deleteFramebuffer:f("framebuffer"),deleteProgram:f("program"),deleteQuery:f("query"),deleteRenderbuffer:f("renderbuffer",(function(e,t){c.renderbuffer-=t.size})),deleteSampler:f("sampler"),deleteShader:f("shader"),deleteSync:f("sync"),deleteTexture:f("texture",(function(e,t){c.texture-=t.size})),deleteTransformFeedback:f("transformFeedback"),deleteVertexArray:f("vertexArray"),deleteVertexArrayOES:f("vertexArray",p,"deleteVertexArrayOES"),fenceSync:function(e){if(e.fenceSync)return d.sync=0,function(e,t,i,n){++d.sync,h.set(n,{size:0})}}(e),generateMipmap(e,t,i){const[n]=i,s=w(n),r=s.parameters&&s.parameters.get(33084)||0,o=s.parameters&&s.parameters.get(33085)||1024;let{width:a,height:l,depth:c,internalFormat:d,type:h}=s.mips[r][0],u=r+1;const p=n===y?6:1,m=n===y?S:n;for(;u<=o&&(1!==a||1!==l||1!==c&&n!==b);){a=Math.ceil(Math.max(a/2,1)),l=Math.ceil(Math.max(l/2,1)),c=n===b?c:Math.ceil(Math.max(c/2,1));for(let e=0;e<p;++e)x(s,m+e,u,d,a,l,c,h);++u}},getSupportedExtensions(e,t,i,n){n.push("GMAN_webgl_memory")},renderbufferStorage(e,t,i){const[n,s,r,o]=i;g(n,1,s,r,o)},renderbufferStorageMultisample(e,t,i){const[n,s,r,o,a]=i;g(n,s,r,o,a)},texImage2D(e,t,i){let n,s,r,[o,a,l]=i;if(6==i.length){const e=i[5];n=e.width,s=e.height,r=i[4]}else n=i[3],s=i[4],r=i[7];x(w(o),o,a,l,n,s,1,r)},texImage3D(e,t,i){let[n,s,r,o,a,l,c,d,h]=i;x(w(n),n,s,r,o,a,l,h)},texParameteri(e,t,i){let[n,s,r]=i;const o=w(n);o.parameters=o.parameters||new Map,o.parameters.set(s,r)},texStorage2D(e,t,i){let[n,s,r,o,a]=i;_(n,s,r,o,a,1)},texStorage3D(e,t,i){let[n,s,r,o,a,l]=i;_(n,s,r,o,a,l)}},I={getExtension(e,t){const s=e[t];e[t]=function(...t){const o=t[0].toLowerCase(),a=r[o];if(a)return a.ctx;const l=s.call(e,...t);return l&&D(l,o,{...i,origGLErrorFn:n}),l}}};function L(e,t){const i=e[t],s=A[t]||p,r=N[t]||p;if(s===p&&N===p)return;e[t]=function(...n){s(e,t,n);const o=i.call(e,...n);return r(e,t,n,o),o};const o=I[t];o&&o(e,t,n)}for(const t in e)"function"==typeof e[t]&&(u[t]=e[t],L(e,t));r[t.toLowerCase()]={ctx:e,origFuncs:u}}function N(e){const t=e.prototype.getContext;e.prototype.getContext=function(e,...i){const n=t.call(this,e,...i);if(n&&n.bindTexture){D(n,e,{});n.getExtension("GMAN_webgl_memory")}return n}}"undefined"!=typeof HTMLCanvasElement&&N(HTMLCanvasElement),"undefined"!=typeof OffscreenCanvas&&N(OffscreenCanvas);var I=o(36822),L=o(60771),R=o(17597),k=o(95395),U=o(8445),B=o(54791),F=o(18469),V=o(95877),H=o(68972),j=o(14608),G=o(4305),z=o(29539),W=o(58851),K=o(20331),Y=o(2240),q=o(23889),Z=o(29419),$=o(6189),Q=o(64147),X=o(15030),J=o(55402),ee=o(30075),te=o(55305),ie=o(43993),ne=o(69941),se=o(23796),re=o(37238),oe=o(93263),ae=o(50620),le=o(84285),ce=o(90938),de=o(94625),he=o(63781),ue=o(68113),pe=o(62881),me=o(55130),fe=o(42952),ge=o(78768),ve=o(87738),ye=o(92895),be=o(26589),Se=o(13988),Ee=o(13827),Te=o(31657),we=o(41452),xe=o(65006),_e=o(97251),Me=o(5087),Oe=o(70384),Ae=o(52720),Ce=o(19917),Pe=o(86097),De=o(89799),Ne=o(16400),Ie=o(51561),Le=o(32086),Re=o(32306),ke=o(11426),Ue=o(63739),Be=o(35597),Fe=o(82228),Ve=o(79553),He=o(23923),je=o(21783),Ge=o(53345),ze=o(96513),We=o(76541),Ke=o(14880),Ye=o(32600),qe=o(35300);const Ze=new i.Z("AB");class AB{constructor(e){this.values={};for(const t in e){const i=e[t];if(i&&i.ab)try{this.values[t]=$e(i.ab)}catch(e){Ze.warn(`Skipping key ${t}, could not pick: ${e}`)}}}get(e){return this.values[e]}serialize(){return Object.keys(this.values).map((e=>`${e}:${this.values[e]}`))}}function $e(e){if(0===e.length)throw Error("A/B cannot choose from an empty choice array");let t=0;for(const i of e){if(void 0===i.value||void 0===i.weight||i.weight<0)throw Error(`Malformed AB choice: ${i}`);t+=i.weight}const i=Math.random()*t;let n=0;for(const t of e)if(n+=t.weight,i<=n)return t.value}var Qe=o(2388),Xe=o(44060),Je=o(23502),et=o(39504),tt=o(87182),it=o(30060),nt=o(28963),st=o(66999),rt=o(77037),ot=o(73844),at=o(69808),lt=o(20601),ct=o(80301),dt=o(6559),ht=o(17838),ut=o(34369);const pt=new i.Z("showcase-settings/quality");var mt=o(24844),ft=o(37381),gt=o(96216),vt=o(29422),yt=o(10757),bt=o(68655),St=o(89683),Et=o(95469);class EngineTick{constructor(e,t,i){this.engine=e,this.onErrorCallback=i,this.ticking=!1,this.start=()=>{this.ticking=!0},this.stop=()=>{this.ticking=!1},this.tick=(e,t)=>{if(this.ticking)try{this.engine.setXrFrame(t),this.engine.tick()}catch(e){this.stop(),this.onErrorCallback(e)}},t.setAnimationLoop(this.tick)}}var Tt=o(99252),wt=o(50988),xt=o(38420),_t=o(44283);class ControllerProxy{constructor(e,t){this.proxy=e,this.target=t}beginExternalTransition(){this.proxy.activeSession(this)&&this.target.beginExternalTransition()}endExternalTransition(){this.proxy.activeSession(this)&&this.target.endExternalTransition()}updateCameraPosition(e){this.proxy.activeSession(this)&&this.target.updateCameraPosition(e)}updateCameraRotation(e){this.proxy.activeSession(this)&&this.target.updateCameraRotation(e)}updateCameraFocus(e){this.proxy.activeSession(this)&&this.target.updateCameraFocus(e)}moveTo(e){return this.proxy.activeSession(this)?this.target.moveTo(e):t.Q.resolve()}}class CameraPoseProxy{constructor(e,t){this.controller=e,this.data=t,this.proxies=[]}get pose(){return this.data}activeSession(e){if(0===this.proxies.length)return!1;return this.proxies[this.proxies.length-1].controller===e}newSession(e){let t=null;if(-1!==this.proxies.findIndex((t=>t.requester===e)))throw new Error("Cannot create two sessions with the same requester");return(0,_t.k1)((()=>{if(!t){if(this.proxies.length>0){const e=this.proxies[this.proxies.length-1];e.requester.onAccessRevoked(e.controller)}t=new ControllerProxy(this,this.controller),this.proxies.push({controller:t,requester:e}),e.onAccessGranted(t)}}),(()=>{if(t){const e=this.proxies.findIndex((e=>e.controller===t));if(-1!==e){const t=this.proxies[e],i=e===this.proxies.length-1;if(i&&t.requester.onAccessRevoked(t.controller),this.proxies.splice(e,1),this.proxies.length>0&&i){const e=this.proxies[this.proxies.length-1];e.requester.onAccessGranted(e.controller)}}}}))}}var Mt=o(59088);var Ot=o(81063),At=o(35934),Ct=o(73710),Pt=o(51058);var Dt=o(87220),Nt=o(26128),It=o(15443);const Lt=new i.Z("showcase"),Rt=window.MP_PREFETCHED_MODELDATA;class Showcase{constructor(e,i={},n=!1){this.inWorkshop=e,this.settingOverrides=i,this.editModePreferred=n,this.bindings=[],this.externalCanvas=!1,this.urlValues=(0,R.FU)(),this.storeQueue=new K.RequestQueue,this.apiQueue=new K.RequestQueue,this.analyticsQueue=new K.RequestQueue({concurrency:1}),this.errorPromise=new t.Q,this.quickstart="1"===this.urlValues.qs||void 0!==this.urlValues.note||void 0!==this.urlValues.tag,this.autoplay=!1,this.forceLogin=!1,this.openingTool=null,this.needsFramebustToPlayXR=!0,this.uiLoading=Promise.resolve(),this.stopTourHook=async e=>{const t=e.market.tryGetData(ne.k);t&&t.tourPlaying&&(await e.commandBinder.issueCommand(new gt.vy),await(0,yt.gw)(10))};const{container:s}=this.settingOverrides;(0,At.C)(this.urlValues.applicationKey||i.applicationKey||null),this.apiHost=((e,t)=>{const i=e.apiHost||t.apiHost;if(i){const e=(0,xe.KK)(i);if(e)return e}return window.location.origin})(this.urlValues,this.settingOverrides),i.canvas&&(this.externalCanvas=!0,this.canvas=i.canvas),this.apiHost!==window.location.origin&&(this.settingOverrides.apiHost=this.apiHost),this.container=s||document.body,this.modelUrls=(0,xe.sU)(this.urlValues.m||this.urlValues.model,this.apiHost),this.modelUrl=`${this.modelUrls.urlBase}/api/v1/player/models/${this.modelUrls.sid}`,this.modelId=this.modelUrls.sid}getManifest(){const e=[{type:f.y.GUI,promise:()=>Promise.resolve().then(o.bind(o,71813))},{type:f.y.LOADING_GUI,promise:()=>Promise.resolve().then(o.bind(o,23503))},{type:f.y.SHOWCASE_GUI,promise:()=>Promise.resolve().then(o.bind(o,68944))},{type:I.default,promise:()=>Promise.resolve().then(o.bind(o,36822))},{type:f.y.SETTINGS,promise:()=>Promise.resolve().then(o.bind(o,43993))},{type:f.y.ANALYTICS,promise:()=>Promise.resolve().then(o.bind(o,54081))},{type:f.y.SDK,promise:()=>Promise.resolve().then(o.bind(o,75083))},{type:Q.default,promise:()=>Promise.resolve().then(o.bind(o,64147))},{type:$.default,promise:()=>Promise.resolve().then(o.bind(o,6189))},{type:W.default,promise:()=>Promise.resolve().then(o.bind(o,58851))},{type:k.default,promise:()=>Promise.resolve().then(o.bind(o,95395))},{type:f.y.RAYCASTER,promise:()=>Promise.resolve().then(o.bind(o,71291))},{type:V.default,promise:()=>Promise.resolve().then(o.bind(o,95877))},{type:H.default,promise:()=>Promise.resolve().then(o.bind(o,68972))},{type:we.default,promise:()=>Promise.resolve().then(o.bind(o,41452))},{type:Y.default,promise:()=>Promise.resolve().then(o.bind(o,2240))},{type:f.y.SHOWCASE_ANALYTICS,promise:()=>Promise.resolve().then(o.bind(o,80100))},{type:f.y.WEBGL_RENDERER,promise:()=>Promise.resolve().then(o.bind(o,84294))},this.externalCanvas?{type:f.y.CANVAS,promise:()=>Promise.resolve().then(o.bind(o,37554))}:{type:f.y.CANVAS,promise:()=>Promise.resolve().then(o.bind(o,86718))},{type:f.y.INPUT,promise:()=>Promise.resolve().then(o.bind(o,48221))},{type:Ae.default,promise:()=>Promise.resolve().then(o.bind(o,52720))},{type:f.y.CAMERA,promise:()=>Promise.resolve().then(o.bind(o,77719))},{type:Et.default,promise:()=>Promise.resolve().then(o.bind(o,95469))},{type:Tt.F,promise:()=>Promise.resolve().then(o.bind(o,37339))},{type:B.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,54791))},{type:q.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,23889))},{type:re.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,37238))},{type:oe.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,93263))},{type:ke.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,11426))},{type:ae.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,50620))},{type:Re.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,32306))},{type:Fe.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,82228))},{type:Se.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,13988))},{type:pe.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,62881))},{type:Ye.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,32600))},{type:le.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,84285))},{type:ce.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,90938))},{type:de.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,94625))},{type:me.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,55130))},{type:fe.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,42952))},{type:Te.default,promise:()=>Promise.resolve().then(o.bind(o,31657))},{type:Le.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,32086))},{type:J.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,55402))},{type:ee.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,30075))},{type:z.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,29539))},{type:Ke.default,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,14880))},{type:f.y.MODEL_MESH,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,42926))},{type:f.y.MODEL_MESH_QUALITY,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,14824))},{type:f.y.MESH_QUERY,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,26203))},{type:f.y.MESH_API_FIXUP,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,57724))},{type:f.y.MESH_TRIM_DATA,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,97665))},{type:f.y.ORTHOGRAPHIC_CONTROLS,promise:()=>Promise.all([o.e(947),o.e(321)]).then(o.bind(o,35726))},{type:f.y.SWEEP_PUCKS,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,17206))},{type:he.default,promise:()=>o.e(136).then(o.bind(o,63781))},{type:ue.default,promise:()=>o.e(136).then(o.bind(o,68113))},{type:f.y.CURSOR_CONTROLLER,promise:()=>o.e(136).then(o.bind(o,67394))},{type:ge.default,promise:()=>o.e(136).then(o.bind(o,78768))},{type:f.y.PINS,promise:()=>o.e(136).then(o.bind(o,41591))},{type:ve.default,promise:()=>o.e(136).then(o.bind(o,87738))},{type:ye.default,promise:()=>o.e(136).then(o.bind(o,92895))},{type:Z.default,promise:()=>o.e(136).then(o.bind(o,29419))},{type:Oe.default,promise:()=>o.e(136).then(o.bind(o,70384))},{type:f.y.DEEP_LINKS,promise:()=>o.e(880).then(o.bind(o,4880))},{type:Ce.default,promise:()=>o.e(136).then(o.bind(o,19917))},{type:j.default,promise:()=>o.e(136).then(o.bind(o,14608))},{type:Ue.default,promise:()=>o.e(136).then(o.bind(o,63739))},{type:be.default,promise:()=>o.e(136).then(o.bind(o,26589))},{type:mt.default,promise:()=>o.e(136).then(o.bind(o,24844))},{type:We.default,promise:()=>o.e(136).then(o.bind(o,76541))},{type:G.default,promise:()=>o.e(136).then(o.bind(o,4305))},{type:je.default,promise:()=>o.e(136).then(o.bind(o,21783))},{type:He.default,promise:()=>o.e(136).then(o.bind(o,23923))},{type:Ge.default,promise:()=>o.e(136).then(o.bind(o,53345))},{type:ze.default,promise:()=>o.e(136).then(o.bind(o,96513))},{type:Pe.default,promise:()=>o.e(136).then(o.bind(o,86097))},{type:De.default,promise:()=>o.e(136).then(o.bind(o,89799))},{type:Ne.default,promise:()=>o.e(136).then(o.bind(o,16400))},{type:Ie.default,promise:()=>o.e(136).then(o.bind(o,51561))},{type:Ee.default,promise:()=>o.e(136).then(o.bind(o,13827))},{type:f.y.DWELL_ANALYTICS,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,18574))},{type:f.y.LABEL_DATA,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,36097))},{type:f.y.LABEL_RENDERER,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,36542))},{type:f.y.MODEL_RATING,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,76265))},{type:f.y.SEARCH,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,53409))},{type:f.y.SCAN_INFO,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,17317))},{type:f.y.MEASUREMENT_MODE,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,44652))},{type:f.y.TOUR_CONTROLS,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,27166))},{type:f.y.TOUR_DATA,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,67914))},{type:f.y.VIDEO_RECORDER,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,15903))},{type:f.y.WEBXR,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,75708))},{type:f.y.TRASH,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,86102))},{type:f.y.AUTOMATION_SUPPORT,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,89430))},{type:f.y.SCENE,promise:()=>Promise.all([o.e(47),o.e(764),o.e(670),o.e(376),o.e(755),o.e(524),o.e(46)]).then(o.bind(o,18046))}];return"0"!==this.urlValues.tiles?e.push({type:f.y.SWEEP_PANO,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,52061))}):e.push({type:f.y.SWEEP_PANO,promise:()=>Promise.all([o.e(477),o.e(934),o.e(463),o.e(833)]).then(o.bind(o,30268))}),e}getAppPhases(e){return{[p.nh.UNINITIALIZED]:[],[p.nh.WAITING]:[(async()=>{await e.getModuleBySymbol(f.y.LOADING_GUI)})()],[p.nh.LOADING]:[(async()=>(await e.getModuleBySymbol(f.y.LOADING_GUI)).waitForPlaying)()],[p.nh.STARTING]:[(async()=>(await e.getModule(J.default)).waitForFirstRender)()],[p.nh.PLAYING]:[(async()=>(await e.getModule(J.default)).waitForFlyin)()],[p.nh.ERROR]:[this.errorPromise.nativePromise()]}}setError(e){this.errorPromise.reject(e),this.engineTick&&this.engineTick.stop()}async load(e,t){var n;if(this.engine=e,this.engine.loadModule({type:I.default,config:{tasks:this.getAppPhases(e)}}),this.engine.loadModuleBySymbol({type:f.y.SETTINGS,config:{useGUI:!0}}),this.engine.loadModuleBySymbol({type:f.y.ANALYTICS}),e.getModule(I.default).then((i=>{i.updateActiveApp(p.Mx.SHOWCASE),t.coldStart||e.broadcast(new m.pB(p.Mx.SHOWCASE))})),e.market.waitForData(p.pu).then((t=>{t.onChanged((async()=>{const i=this.urlValues.oops;if(t.phase===p.nh.ERROR||i){const n=t.error,s=await e.getModule(Ae.default);throw n instanceof qe.vx||"unsupported"===i?s.showError(Ae.ErrorType.UNSUPPORTED):n instanceof qe.Gw||"webgl"===i?s.showError(Ae.ErrorType.WEBGL):s.showError(Ae.ErrorType.GENERIC),n}}))})),this.bindings.push((0,Nt.PD)({messageBus:this.engine.msgBus}),function(e){const t=[];return e.urlValues.debug&&t.push(new Nt.bc({symbol:It.Y.Navigation,callback:()=>Promise.all([o.e(477),o.e(463),o.e(316)]).then(o.bind(o,84715)).then((t=>t.default(e.engine)))}),new Nt.bc({symbol:It.Y.Octree,callback:()=>Promise.all([o.e(477),o.e(463),o.e(316)]).then(o.bind(o,74135)).then((t=>t.default(e.engine)))}),new Nt.bc({symbol:It.Y.PanoTiles,callback:()=>Promise.all([o.e(477),o.e(463),o.e(316)]).then(o.bind(o,90477)).then((t=>t.default(e.engine)))}),new Nt.bc({symbol:It.Y.Raycaster,callback:()=>Promise.all([o.e(477),o.e(463),o.e(316)]).then(o.bind(o,15250)).then((t=>t.default(e.engine)))}),new Nt.bc({symbol:It.Y.Snapping,callback:()=>Promise.all([o.e(477),o.e(463),o.e(316)]).then(o.bind(o,80524)).then((t=>t.default(e.engine)))})),e.urlValues.tiledmesh&&t.push(new Nt.bc({symbol:It.Y.StreamingMesh,callback:()=>o.e(521).then(o.bind(o,45364)).then((t=>t.default(e.engine)))}),new Nt.bc({symbol:It.Y.StreamingTexture,callback:()=>o.e(521).then(o.bind(o,61501)).then((t=>t.default(e.engine)))})),t.forEach((t=>e.messageBus.broadcast(t))),(0,_t.k1)((()=>null),(()=>t.forEach((t=>e.messageBus.broadcast(new Nt.z4(t.payload))))))}({engine:this.engine,messageBus:this.engine.msgBus,urlValues:this.urlValues})),!t.coldStart)return void(this.uiLoading=this.loadUI(!0));let s;Lt.info("Showcase app version: 3.1.63.0-125-g1fd7fd3bed"),this.externalCanvas||(this.canvas=document.createElement("canvas"),this.canvas.className="webgl-canvas",s=document.querySelector("#canvas-container"));const r=document.querySelector("#app-container"),a=document.querySelector("main")||document.body,l=document.querySelector("#react-render-root")||document.body,c=parseInt(this.urlValues.log,10);this.urlValues.hasOwnProperty("log")&&!isNaN(c)&&(i.Z.level=c),this.quickstart&&Lt.info("Quickstart engaged. Hold on to your knickers. "+performance.now());const d=this.engine.loadModule({type:W.default,config:{baseUrl:this.modelUrls.urlBase,apiQueue:this.apiQueue,storeQueue:this.storeQueue,prefetchedData:Rt,preloadConfig:"showcase"}});this.engine.loadModule({type:we.default,config:{queue:this.apiQueue}}),this.engine.loadModule({type:Ae.default});const h=(await d).getApi(),u=this.urlValues.applicationKey||this.settingOverrides.applicationKey,g=this.loadSdkModule(h,u),v=!!u&&await g;if(v)try{await h.modelIsAccessible(this.modelId)}catch(e){Lt.error(e);throw(await this.engine.getModule(Ae.default)).showError(Ae.ErrorType.GENERIC),e}this.engine.loadModuleBySymbol({type:f.y.WEBGL_RENDERER,config:{canvas:this.canvas,useWebGL2:"1"===this.urlValues.gl2,antialias:"1"===this.urlValues.aa,useEffectComposer:!(!this.settingOverrides||!this.settingOverrides.hasOwnProperty("useEffectComposer"))&&!!this.settingOverrides.useEffectComposer}}),this.engine.loadModuleBySymbol({type:f.y.CAMERA}),this.engine.loadModuleBySymbol({type:f.y.CANVAS,config:{canvas:this.canvas,container:s}}),this.engine.loadModule({type:Et.default}),this.engine.loadModule({type:Ee.default});const[y,b,S,E]=await Promise.all([e.getModule(W.default),e.getModuleBySymbol(f.y.WEBGL_RENDERER),e.getModuleBySymbol(f.y.SETTINGS),e.getModuleBySymbol(f.y.CAMERA)]);this.engineTick=new EngineTick(this.engine,b.threeRenderer,(e=>{this.engine.getModule(Ae.default).then((t=>{this.setError(e),t.showError(Ae.ErrorType.GENERIC)}))}));const T=y.getApi();this.apiConfig=await T.getConfigs("showcase");const w=new AB(this.apiConfig),x=!this.urlValues.applicationKey&&("roomnav_ab"in this.urlValues?"1"===this.urlValues.roomnav_ab:w.get("roomnav_ab_1"));Lt.debug("Roomnav AB "+(x?"enabled":"disabled"));const _=T.user.getFlags("showcase/"),M=(0,lt.HG)(parseFloat(this.urlValues.wts)),{labels:O,mt:A,roomnav:C,play:P,search:D,q:N,allowRating:R,tiledmesh:k,newtags:V,advancedSearch:H,stories:G}=this.urlValues,K=T.user.loggedIn,Y=!(!($=this.modelId)||11!==$.length);var $;const Q=Y&&("1"===V||_.has(et.R)&&"0"!==V),X=Y;this.openingTool=(0,_e.u)(S.settingsData,Q,X),this.forceLogin=this.openingTool===Ve.w1.NOTES&&!K&&!L.yL();let ee=this.editModePreferred;ee&&this.forceLogin&&(Lt.warn("Cannot start in edit mode. Need to login to view note."),ee=!1);const pe=_.has(it.b),Se=(0,Pt.z)(navigator.language),xe=_.has(at.B)&&"0"!==D,He=_.has(at.l)?"0"!==H:"1"===H,Ge=_.has(Dt.i)?"0"!==R:"1"===R,ze=this.inWorkshop&&K&&Ge,Ze=ze&&_.has(Dt.j)?"0"!==R:"1"===R,$e=_.has(Qe.iT)?"0"!==k:"1"===k,tt=_.has(se.lj)?"0"!==G:"1"===G,yt=!("1"!==P&&!t.autoPlay&&!this.openingTool);this.needsFramebustToPlayXR=L.Ot()&&!L.PI("xr-spatial-tracking"),this.autoplay=!this.forceLogin&&(!L.yL()||yt&&!this.needsFramebustToPlayXR);const bt={Features:{[st.U]:!0,[nt.s]:!0,[Qe.iT]:$e,[se.lj]:tt,[Je.Nj]:"0"!==O,[Xe.re]:"0"!==A,[ot.ws]:"0"!==this.urlValues.f,[ot.Q5]:void 0===C&&_.has(ot.Q5)||void 0!==C&&"0"!==C,[rt.EU]:M,[it.b]:pe,[Dt.i]:ze,[Dt.j]:Ze,[at.B]:xe,[at.l]:He,[et.R]:Q,[Ot.AR]:_.has(Ot.AR),[ot.u_]:!x,[Ct.o]:!x,[ot.gu]:!x},"User Preferences":{[te.F.UnitType]:Se,[te.F.MeasurementSnapping]:!0,[te.F.MeasurementContinuousLines]:!0,[te.F.MeasurementUserNudgeSeen]:!1,[te.F.NotesModeNudgeSeen]:!1,[te.F.NotesIntroModalSeen]:!1,[te.F.LastRatingPromptTime]:null}};for(const e in bt)for(const t in bt[e]){if(void 0===bt[e][t])continue;const i="User Preferences"===e?ie.SettingPersistence.LOCAL_STORAGE:ie.SettingPersistence.NONE;S.registerSetting(e,t,bt[e][t],!0,i)}const St={[ft.YS]:null,sid:this.modelId,quickstart:this.quickstart,lang:this.urlValues.lang,perf:this.urlValues.perf,perfInterval:this.urlValues.perfInterval};for(const e in St)S.updateSetting(e,St[e]);if(this.settingOverrides)for(const e in this.settingOverrides)S.updateSetting(e,this.settingOverrides[e]);this.loadInitialAppModules(w,b.gpuInfo,bt),S.hasProperty(Xe.lc)||S.updateSetting(Xe.lc,this.apiConfig.embedly_key),v||await this.loginToModel(this.modelId,T).catch((e=>{this.setError(e)})),this.forceLogin&&this.openingTool===Ve.w1.NOTES&&await this.loginToNote(),await this.initWorkshopStorage(),this.loadInitialDataModules(bt);const Tt=((e,t)=>new CameraPoseProxy(e,t))(E,(await e.market.waitForData(Mt.M_)).pose);e.commandBinder.hookCommand(vt.ju,!0,(()=>this.stopTourHook(e))),e.commandBinder.hookCommand(gt.rU,!0,(()=>this.stopTourHook(e)));try{await e.waitForLoadingModules()}catch(t){this.setError(t),e.tick()}const[wt,xt]=await Promise.all([e.market.waitForData(U.T),e.market.waitForData(F.O)]),{details:At,organizationId:kt}=wt.model;document.title=At.name;const Ut=xt.pose;!this.quickstart||Ut&&(0,Me.Bw)(Ut.mode)||(Lt.warn("Disabling quickstart. No panorama start position."),this.quickstart=!1,S.updateSetting("quickstart",!1));const{maxMeshQuality:Bt,navPanoSize:Ft,zoomPanoSize:Vt,textureLODThreshold:Ht}=((e,t)=>{let i,n,s,r;(0,L.tq)()||(0,L.w1)()?(0,L.tq)()&&(0,ht.W)(t)?(i=dt.S7.ULTRA,n=ut.eE[ut.SL.STANDARD],s=ut.eE[ut.SL.HIGH],r=10):(i=dt.S7.MEDIUM,n=ut.eE[ut.SL.STANDARD],s=ut.eE[ut.SL.HIGH],r=6):(i=dt.S7.ULTRA,n=ut.eE[ut.SL.HIGH],s=ut.eE[ut.SL.ULTRAHIGH],r=20);try{i=e.maxmeshq?(0,dt.Pm)(parseInt(e.maxmeshq,10)):i}catch(t){pt.warn(`Not a valid texture size: ${e.maxmeshq}`)}return n=e.maxtileq?parseInt(e.maxtileq,10):n,s=e.maxztileq?parseInt(e.maxztileq,10):s,r=e.texlodthreshold?parseInt(e.texlodthreshold,10):r,{maxMeshQuality:i,navPanoSize:n,zoomPanoSize:s,textureLODThreshold:r}})(this.urlValues,b.gpuInfo);Lt.info({maxMeshQuality:Bt,navPanoSize:Ft,zoomPanoSize:Vt,textureLODThreshold:Ht,gpuInfo:b.gpuInfo}),e.loadModuleBySymbol({type:f.y.SCENE,config:{cameraPoseProxy:Tt}}).then((e=>e.startLoading())),await this.engine.loadModuleBySymbol({type:f.y.SWEEP_PANO,config:{navPanoSize:Ft,zoomPanoSize:Vt}}),await this.engine.loadModule({type:re.default}),this.quickstart&&(this.loadPanoControls(ee),this.engineTick.start()),await(await e.getModuleBySymbol(f.y.LOADING_GUI)).waitForPlaying,this.engine.loadModule({type:Ye.default,config:{container:this.container}});const jt=_.has("features/meshtrim")&&"0"!==this.urlValues.allowMeshTrim;jt&&this.engine.loadModuleBySymbol({type:f.y.MESH_TRIM_DATA,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,queue:this.storeQueue}});const Gt="2"===this.urlValues.texlod?ct.l.RAYCAST:"0"===this.urlValues.texlod?ct.l.NONE:ct.l.RAYCAST;this.engine.loadModuleBySymbol({type:f.y.MODEL_MESH,config:{textureLOD:Gt,textureLODThreshold:Ht,colorizeRooms:"1"===this.urlValues.colorizeRooms,colorizeChunks:"1"===this.urlValues.colorizeChunks,wireframe:"1"===this.urlValues.wireframe,meshTrimEnabled:jt}}),this.engine.loadModuleBySymbol({type:f.y.MODEL_MESH_QUALITY,config:{maxQuality:Bt,textureLOD:Gt,textureLODThreshold:Ht,meshTrimEnabled:jt}}),this.engine.loadModule({type:ke.default}),this.engine.loadModule({type:oe.default,config:{startingMode:this.quickstart?Me.Ey.Panorama:null}}),this.engine.loadModule({type:ce.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase}}),this.engine.loadModule({type:q.default}),this.engine.loadModule({type:ae.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:le.default,config:{allowFloorChanges:bt.Features[ot.ws],focusBasedNav:bt.Features[ot.Q5]}}),this.engine.loadModule({type:Re.default}),this.engine.loadModule({type:B.default,config:{baseUrl:this.modelUrls.urlBase,api:T,modelId:this.modelId,organizationId:kt||void 0,queue:this.apiQueue}}).then((e=>{this.loadUserPolicyModules(e,K,S,_,X,Q,kt||void 0)})),this.engine.loadModuleBySymbol({type:f.y.GUI,config:{workshopApp:this.inWorkshop,container:r,mainDiv:a,reactContainer:l,queue:this.apiQueue}}),this.engine.loadModule({type:Fe.default,config:{inWorkshop:this.inWorkshop}}),this.engine.loadModuleBySymbol({type:f.y.SHOWCASE_GUI}),this.engine.loadModule({type:de.default}),this.engine.loadModule({type:me.default,config:{cameraPoseProxy:Tt}}),this.engine.loadModule({type:fe.default}),this.engine.loadModuleBySymbol({type:f.y.ORTHOGRAPHIC_CONTROLS}),this.engine.loadModule({type:Te.default,config:{enabled:"1"!==this.urlValues.nozoom,tiles:"0"!==this.urlValues.tiles}}),this.engine.loadModule({type:J.default}),this.engine.loadModule({type:z.default,config:{enableWheel:"1"===this.urlValues.nozoom,focusBasedNav:bt.Features[ot.Q5]}}),this.engine.loadModule({type:Ke.default}),this.engine.loadModuleBySymbol({type:f.y.MESH_QUERY}),this.engine.loadModuleBySymbol({type:f.y.MESH_API_FIXUP}),this.engine.loadModule({type:Le.default}),this.quickstart||this.engineTick.start(),this.quickstart||this.loadPanoControls(ee),await this.engine.waitForLoadingModules(),"0"!==this.urlValues.portal&&(this.engine.loadModule({type:De.default}),this.engine.loadModule({type:Pe.default})),this.engine.loadModule({type:Ie.default,config:{showPinsInFloorplanDollhouse:"0"!==this.urlValues.pin}}),this.engine.loadModule({type:Ne.default}),this.engine.loadModuleBySymbol({type:f.y.SWEEP_PUCKS,config:{checkRenderModes:()=>{const t=e.market.tryGetData(ne.k);if(t&&t.isTourActive())return!1;const i=e.market.tryGetData(Be.O);return!!i&&i.isInside()}}}),this.engine.loadModuleBySymbol({type:f.y.LABEL_DATA,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModuleBySymbol({type:f.y.LABEL_RENDERER}),this.engine.loadModuleBySymbol({type:f.y.PINS,config:{newTagsEnabled:Q}}),this.engine.loadModule({type:je.default,config:{newTagsEnabled:Q}}),this.engine.loadModule({type:We.default,config:{debug:"1"===this.urlValues.fcdbg}}),this.engine.loadModule({type:be.default}),this.engine.loadModule({type:ge.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,parserOptions:{model:this.modelId,supportLinks:!this.urlValues.mls||"0"===this.urlValues.mls,keepLinkLabels:!0},queue:this.storeQueue,newTagsEnabled:Q}}),this.engine.loadModule({type:ve.default}),this.engine.loadModule({type:ye.default}),this.engine.loadModule({type:Z.default}),this.engine.loadModuleBySymbol({type:f.y.TOUR_DATA,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,looping:"1"===this.urlValues.lp,queue:this.storeQueue}}),this.engine.loadModuleBySymbol({type:f.y.TOUR_CONTROLS}),this.engine.loadModule({type:Oe.default}),this.engine.loadModule({type:he.default}),this.engine.loadModule({type:ue.default}),this.engine.loadModuleBySymbol({type:f.y.CURSOR_CONTROLLER}),this.engine.loadModuleBySymbol({type:f.y.SCAN_INFO,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase}}),this.engine.loadModuleBySymbol({type:f.y.DEEP_LINKS}),this.engine.loadModule({type:Ce.default}),this.engine.loadModule({type:Ue.default}),this.engine.loadModule({type:mt.default}),this.engine.loadModuleBySymbol({type:f.y.VIDEO_RECORDER}),this.engine.loadModuleBySymbol({type:f.y.MEASUREMENT_MODE,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0}}),this.engine.loadModule({type:j.default}),this.engine.loadModuleBySymbol({type:f.y.DWELL_ANALYTICS}),xe&&this.engine.loadModuleBySymbol({type:f.y.SEARCH,config:{urlQuery:N,workshop:this.inWorkshop,newTagsEnabled:Q,advancedSearchEnabled:He}}),this.inWorkshop&&e.loadModuleBySymbol({type:f.y.TRASH,config:{modelId:this.modelId,queue:this.storeQueue,baseUrl:this.modelUrls.urlBase}}),this.engine.loadModuleBySymbol({type:f.y.WEBXR,config:{enableEventPositions:!1,framebufferScaling:Math.min(this.urlValues.xrframebuffer?parseFloat(this.urlValues.xrframebuffer):0,1),tracking:+(null!==(n=this.urlValues.xrtracking)&&void 0!==n?n:0),navPanoSize:Ft}}),ze&&this.engine.loadModuleBySymbol({type:f.y.MODEL_RATING,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,queue:this.storeQueue,promptEnabled:Ze}}),this.engine.loadModuleBySymbol({type:f.y.AUTOMATION_SUPPORT})}loadUserPolicyModules(e,t,i,n,s,r,o){let a=!1;if(s&&t){const t=e.isPolicyFlagEnabled(tt.uE),s=e.getUserData().isCommenter();a=t&&s,a&&(i.updateSetting(tt.IA,a),i.updateSetting(tt.Mp,a),i.updateSetting(tt.pE,a&&n.has(tt.pE)))}(a||r)&&(this.engine.loadModule({type:G.default,config:{apiConfig:this.apiConfig,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,organizationId:o,modelUrl:this.modelUrl,queue:this.apiQueue}}),a&&this.engine.loadModule({type:He.default,config:{workshop:this.inWorkshop,baseUrl:this.modelUrls.urlBase,modelId:this.modelId,readonly:!1}}),r&&(this.engine.loadModule({type:Ge.default}),this.engine.loadModule({type:ze.default,config:{workshop:this.inWorkshop,baseUrl:this.modelUrls.urlBase,modelId:this.modelId}})))}async unload(e){try{await e.commandBinder.issueCommand(new gt.vy)}catch(e){Lt.debug("showcase unload called before tour controls registered, ignoring stopTour",e)}await this.uiLoading,await this.showcaseGui.unloadUi().catch((e=>{Lt.error(e)})),e.commandBinder.resetHooks(),this.bindings.forEach((e=>e.cancel())),this.bindings.length=0}async loginToModel(e,t){Lt.info(`Loading model ${e}`);const i=this.forceLogin;await t.modelExists(e,{ignorePrefetch:i}).catch((async e=>{if(i&&(e instanceof bt.GT||e instanceof bt.V2))await this.showLoginScreen();else{if(!(e instanceof bt.GT))throw e;await this.login()}}))}async loginToNote(){const e=this.modelId;this.forceLogin&&await this.showLoginScreen(e)}async initWorkshopStorage(){this.inWorkshop&&(await this.engine.getModule(Tt.F),await this.engine.commandBinder.issueCommand(new wt.dS({viewType:xt.XZ.SESSION})))}loadInitialAppModules(e,t,i){this.engine.loadModuleBySymbol({type:f.y.RAYCASTER}),this.engine.loadModuleBySymbol({type:f.y.INPUT,config:{disableWheel:"0"===this.urlValues.wh,pointerPreventDefault:!this.settingOverrides||!this.settingOverrides.hasOwnProperty("pointerPreventDefault")||!!this.settingOverrides.pointerPreventDefault}}),this.engine.loadModuleBySymbol({type:f.y.SHOWCASE_ANALYTICS,config:{appName:this.settingOverrides&&this.settingOverrides.appName||"showcase",provider:this.urlValues.analytics,additionalValues:{ab_tests:e.serialize(),gpu:t},apiQueue:this.apiQueue,analyticsQueue:this.analyticsQueue}});let n=i.Features[Ot.AR]?xt.hV.CACHE:xt.hV.NONE;const s=this.urlValues.prefetch;s&&Object.values(xt.hV).includes(s)&&(n=s),this.engine.loadModule({type:Tt.F,config:{modelId:this.modelId,prefetchPolicy:n,baseUrl:this.apiHost}})}loadInitialDataModules(e){this.engine.loadModule({type:ee.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:k.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue,tiledMeshEnabled:e.Features[Qe.iT]}});const t=this.settingOverrides.disableMobileRedirect||!(L.tq()||this.needsFramebustToPlayXR),i=!!this.openingTool||void 0,n=!!this.openingTool||void 0,s=!!this.openingTool||void 0;this.engine.loadModuleBySymbol({type:f.y.LOADING_GUI,config:{noUi:this.forceLogin,inWorkshop:this.inWorkshop,modelId:this.modelId,baseUrl:this.modelUrls.urlBase,quickstart:this.quickstart,autoplay:this.autoplay,allowPlayInIframe:t,startNewTab:"1"===this.urlValues.nt,hideTitle:n,hideBranding:s,hidePoweredBy:i}}),this.engine.loadModule({type:H.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:V.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}}),this.engine.loadModule({type:Y.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,readonly:!0,queue:this.storeQueue}})}loadPanoControls(e){this.uiLoading=this.loadUI(!(e||this.forceLogin)),this.engine.loadModule({type:Se.default}),this.engine.loadModule({type:pe.default})}async loadSdkModule(e,t){const i=this.engine;async function n(){return window.location.origin+window.location.pathname.slice(0,window.location.pathname.lastIndexOf("/")+1)+"sdk/sdk-client.js"}async function s(t){const n=await o.e(838).then(o.bind(o,33412));await n.loadInterface(t,i,e)}return new Promise((async e=>{await i.loadModuleBySymbol({type:f.y.SDK,config:{applicationKey:t||null,validationUrl:this.apiHost+"/api/v1/user/",getClientScriptUrl:n,setupExternalSdk:s,onClientConnect(t){t&&St.w.setToken(t),e(!!t)},queue:this.apiQueue}})}))}loadUI(e){return Promise.all([this.engine.getModuleBySymbol(f.y.GUI),this.engine.getModuleBySymbol(f.y.SHOWCASE_GUI)]).then((([t,i])=>{this.guiModule=t,this.showcaseGui=i,e&&t.loadUi(i.loadUi)}))}async showLoginScreen(e){var t,i;this.engine.loadModule({type:$.default,config:{loginUrl:(null===(t=this.apiConfig)||void 0===t?void 0:t.authn_login_url)||"",registerUrl:(null===(i=this.apiConfig)||void 0===i?void 0:i.account_register_url)||"",modelId:e,baseUrl:this.modelUrls.urlBase,container:this.container}});return(await this.engine.getModule($.default)).loadUi()}login(){return new Promise((async e=>{this.engine.loadModule({type:Q.default,config:{modelId:this.modelId,baseUrl:this.modelUrls.urlBase,container:this.container}});const t=await this.engine.getModule(Q.default);this.engine.subscribe(X.L,(()=>{t.hidePasswordScreen(),e()})),t.showPasswordScreen()}))}}var kt=o(3560);window.addEventListener("app-start",(e=>{!function(e){const t=new Engine,i=new Showcase(!1,e);t.loadApplication(i,i.setError.bind(i)),L.Jm()||document.body.classList.add("no-touch");!function(e){class BundleSdkBootstrap{constructor(e){this.windowContext=e}async connect(t,i={}){const n=await e.getModuleBySymbol(f.y.SDK);return kt.tK.connect(new BundleConnector(n,i),new BundleMessengerFactoryFetcher,this.windowContext)}}Object.defineProperty(window,"MP_SDK",{get(){let e=window;return window!==window.top&&(e=window.parent),window.opener&&(e=window.opener),new BundleSdkBootstrap(e)}})}(t)}(e.detail.config||{})}),!0);class BundleConnector{constructor(e,t){this.sdk=e,this.options=t}connect(){return this.sdk.connect(`${window.location.protocol}//${window.location.host}`,this.options)}cancelConnecting(){}}class BundleMessengerFactoryFetcher{getFactory(e){return e.messengerFactory}}})()})();