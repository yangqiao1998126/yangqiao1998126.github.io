(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[880],{4880:(e,a,r)=>{"use strict";r.r(a),r.d(a,{default:()=>N});var s,t=r(47724),i=r(59088),o=r(27326),n=r(75892),c=r(35597),l=r(73272);class LinkCreator{constructor(e,a,r,s){this.cameraData=e,this.viewmodeData=a,this.floorsViewData=r,this.sweepData=s,this.name="deeplinks",this.defaultBaseUrl=new URL(window.location.href),this.requiredParams=[...LinkCreator.requiredUrlParams]}createLink(e){const{baseHref:a,paramFilter:r,thisArg:s}=e||{},t=new URLSearchParams(window.location.search),i=new URL(a||this.defaultBaseUrl.href);for(const[e,a]of t)i.searchParams.set(e,a);return r&&this.filterParamsFromURL(i,r,s),this.removeStartParams(i),this.dedupeModelParam(i),i}createModelLink(e,a){const{baseHref:r,paramFilter:s,thisArg:t}=a||{},i=new URLSearchParams(window.location.search),o=new URL(r||this.defaultBaseUrl.href);for(const[e,a]of i)o.searchParams.set(e,a);return s&&this.filterParamsFromURL(o,s,t),this.removeStartParams(o),o.searchParams.delete("m"),o.searchParams.delete("model"),o.searchParams.set("m",e),o}createDeepLink(e){const{baseHref:a,paramFilter:r,thisArg:s}=e||{},t=new URLSearchParams(l.K.getQueryString({cameraData:this.cameraData,floorsViewData:this.floorsViewData,sweepData:this.sweepData,viewmodeData:this.viewmodeData})),i=new URLSearchParams(window.location.search),o=new URL(a||this.defaultBaseUrl.href);for(const[e,a]of i)o.searchParams.set(e,a);this.removeStartParams(o),r&&this.filterParamsFromURL(o,r,s);for(const[e,a]of t)o.searchParams.set(e,a);return this.dedupeModelParam(o),o}setDefaultBaseHref(e,a){this.defaultBaseUrl=new URL(e),this.requiredParams=[...LinkCreator.requiredUrlParams,...a]}filterParamsFromURL(e,a,r){for(const[s,t]of e.searchParams)this.requiredParams.includes(s)||a.call(r,s,t)||e.searchParams.delete(s)}dedupeModelParam(e){const a=e.searchParams.get("m")||e.searchParams.get("model")||"";e.searchParams.delete("model"),e.searchParams.set("m",a)}removeStartParams(e){["start","sm","sp","sq","sr","ss","sf","sz"].forEach(e.searchParams.delete,e.searchParams)}}function h(e){return!!e&&"object"==typeof e}LinkCreator.requiredUrlParams=["m","model"],function(e){e[e.SAME_ORIGIN=0]="SAME_ORIGIN",e[e.EXTERNAL=1]="EXTERNAL",e[e.MODEL=2]="MODEL",e[e.NAVIGATION=3]="NAVIGATION"}(s||(s={}));var m,d=r(29422);!function(e){e[e.IN_FRAME=0]="IN_FRAME",e[e.NEW_WINDOW=1]="NEW_WINDOW",e[e.CUSTOM=2]="CUSTOM"}(m||(m={}));class LinkHandler{constructor(e){this.commandBinder=e,this.defaultPolicy={[s.NAVIGATION]:m.IN_FRAME,[s.MODEL]:m.IN_FRAME,[s.SAME_ORIGIN]:m.NEW_WINDOW,[s.EXTERNAL]:m.NEW_WINDOW},this.activePolicy=Object.assign({},this.defaultPolicy),this.linkHandlers={[s.NAVIGATION]:{[m.IN_FRAME]:e=>{const a=l.K.deserialize(e);a&&this.navigateToPose(a)},[m.NEW_WINDOW]:e=>this.openNewWindow(e),[m.CUSTOM]:e=>this.customHandlers[s.NAVIGATION](e)},[s.MODEL]:{[m.IN_FRAME]:e=>this.replaceFrameLocation(e),[m.NEW_WINDOW]:e=>this.openNewWindow(e),[m.CUSTOM]:e=>this.customHandlers[s.MODEL](e)},[s.SAME_ORIGIN]:{[m.IN_FRAME]:e=>this.replaceFrameLocation(e),[m.NEW_WINDOW]:e=>this.openNewWindow(e),[m.CUSTOM]:e=>this.customHandlers[s.SAME_ORIGIN](e)},[s.EXTERNAL]:{[m.IN_FRAME]:()=>{throw Error("Navigating Showcase's frame to an external domain is not supported.")},[m.NEW_WINDOW]:e=>this.openNewWindow(e),[m.CUSTOM]:e=>this.customHandlers[s.EXTERNAL](e)}},this.customHandlers={[s.NAVIGATION]:e=>{},[s.MODEL]:e=>{},[s.SAME_ORIGIN]:e=>{},[s.EXTERNAL]:e=>{}}}get HandlingPolicy(){return m}setPolicy(e,a,r){a===m.CUSTOM&&r&&(this.customHandlers[e]=r),this.activePolicy[e]=a}resetPolicy(e){this.activePolicy[e]=this.defaultPolicy[e]}openLink(e){if(function(e){return h(e)&&"pose"in e}(e)){const a=this.activePolicy[s.NAVIGATION];this.linkHandlers[s.NAVIGATION][a](e.fullLink)}else if(function(e){return h(e)&&"modelId"in e}(e)){const a=this.activePolicy[s.MODEL],r=new URL(window.location.href);r.searchParams.delete("m"),r.searchParams.delete("model"),r.searchParams.set("m",e.modelId),r.searchParams.set("play","1"),this.linkHandlers[s.MODEL][a](r.href)}else try{const a=new URL(e);if(a.origin===document.referrer||a.origin===window.location.origin){const a=this.activePolicy[s.SAME_ORIGIN];this.linkHandlers[s.SAME_ORIGIN][a](e)}else{const a=this.activePolicy[s.EXTERNAL];this.linkHandlers[s.EXTERNAL][a](e)}}catch(a){const r=this.activePolicy[s.EXTERNAL];this.linkHandlers[s.EXTERNAL][r](e)}}replaceFrameLocation(e){window.location.replace(e)}openNewWindow(e){window.open(e)}navigateToPose(e){this.commandBinder.issueCommand(new d.L4(e))}}const N=class extends t.Y{constructor(){super(...arguments),this.name="deep linker"}async init(e,a){const[r,s,t,l]=await Promise.all([a.market.waitForData(i.M_),a.market.waitForData(c.O),a.market.waitForData(o.c),a.market.waitForData(n.Z)]);this.creator=new LinkCreator(r,s,t,l),this.handler=new LinkHandler(a.commandBinder)}get LinkType(){return s}}}}]);