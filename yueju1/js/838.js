(self.webpackChunkmp_webgl=self.webpackChunkmp_webgl||[]).push([[838],{33412:(e,t,i)=>{"use strict";i.r(t),i.d(t,{loadInterface:()=>pt});var a,r,o,n,s,d,c,l=i(84303),h=i(96909);!function(e){e.FORWARD="FORWARD",e.LEFT="LEFT",e.RIGHT="RIGHT",e.BACK="BACK",e.UP="UP",e.DOWN="DOWN"}(a||(a={}));!function(e){e.INSIDE="mode.inside",e.OUTSIDE="mode.outside",e.DOLLHOUSE="mode.dollhouse",e.FLOORPLAN="mode.floorplan",e.TRANSITIONING="mode.transitioning"}(r||(r={}));!function(e){e.INSTANT="transition.instant",e.FLY="transition.fly",e.FADEOUT="transition.fade",e.MOVEFADE="transition.movefade"}(o||(o={}));class convertRotation_Conversion{constructor(e){this.THREE=e,this.tempEuler=new e.Euler}quaternionToRotation(e,t){const i=this.tempEuler.setFromQuaternion(e,convertRotation_Conversion.eulerOrder),a=t||{};return a.x=this.THREE.MathUtils.radToDeg(i.x),a.y=this.THREE.MathUtils.radToDeg(i.y),a.z=this.THREE.MathUtils.radToDeg(i.z),a}rotationToQuaternion(e,t){const i=t||new this.THREE.Quaternion;return this.tempEuler.x=this.THREE.MathUtils.degToRad(e.x),this.tempEuler.y=this.THREE.MathUtils.degToRad(e.y),this.tempEuler.z=this.THREE.MathUtils.degToRad(e.z||0),this.tempEuler.order=convertRotation_Conversion.eulerOrder,i.setFromEuler(this.tempEuler)}}convertRotation_Conversion.eulerOrder="YXZ",function(e){e.LEGACY="legacy",e.API="api"}(n||(n={})),function(e){e.PHASE_CHANGE="application.phasechange",e.APP_CHANGE="application.appchange"}(s||(s={})),function(e){e.UNKNOWN="application.unknown",e.WEBVR="application.webvr",e.SHOWCASE="application.showcase",e.WORKSHOP="application.workshop"}(d||(d={})),function(e){e.UNINITIALIZED="appphase.uninitialized",e.WAITING="appphase.waiting",e.LOADING="appphase.loading",e.STARTING="appphase.starting",e.PLAYING="appphase.playing",e.ERROR="appphase.error"}(c||(c={}));Math.PI;var u;!function(e){e.MOVE="camera.move"}(u||(u={}));var p=i(88512);new p.Z("broadcast.move");new p.Z("command.zoom");var m,g;!function(e){e.CHANGE_START="floors.changestart",e.CHANGE_END="floors.changeend"}(m||(m={})),function(e){e.POSITION_UPDATED="label.positionupdated"}(g||(g={}));var w,S,v,f;i(51522);!function(e){e.HOVER="tag.hover",e.CLICK="tag.click",e.LINK_OPEN="tag.linkopen"}(w||(w={})),function(e){e.NONE="mattertag.media.none",e.PHOTO="mattertag.media.photo",e.VIDEO="mattertag.media.video",e.RICH="mattertag.media.rich"}(S||(S={})),function(e){e.NONE="tag.chunk.none",e.TEXT="tag.chunk.text",e.LINK="tag.chunk.link"}(v||(v={})),function(e){e.NAVIGATION="tag.link.nav",e.MODEL="tag.link.model",e.EXT_LINK="tag.link.ext"}(f||(f={}));i(20331);const y=new p.Z("sdk.editIcon");class SvgLoader{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),i=document.createElement("div");i.innerHTML=t;const a=i.querySelector("svg");if(!a)throw Error("Failed trying to load "+e+"as an svg.");const r=a.getAttribute("width"),o=a.getAttribute("height");return r||o?(o&&!r&&(y.warn(e,"does not have a defined width. Defaulting width equal to height"),a.setAttribute("width",o)),r&&!o&&(y.warn(e,"does not have a defined height. Defaulting height equal to width"),a.setAttribute("height",r))):(y.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),a.setAttribute("width",SvgLoader.defaultResolution),a.setAttribute("height",SvgLoader.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([a.outerHTML],{type:"image/svg+xml"}))}))}}SvgLoader.defaultResolution="128";new p.Z("mattertag-util");new p.Z("mattertag.add");new p.Z("mattertag.edit");var M;!function(e){e.LABEL="label",e.DESCRIPTION="description",e.MEDIA="media"}(M||(M={}));new p.Z("command.editOpacity");var T;i(2815),i(24344);!function(e){e.CHANGE_START="viewmode.changestart",e.CHANGE_END="viewmode.changeend"}(T||(T={}));new p.Z("move-to-mode-command");var C,b;!function(e){e.MODEL_LOADED="model.loaded"}(C||(C={})),function(e){e.NONE="intersectedobject.none",e.MODEL="intersectedobject.model",e.TAG="intersectedobject.tag",e.SWEEP="intersectedobject.sweep",e.UNKNOWN="intersectedobject.unknown"}(b||(b={}));const E=new p.Z("sdk.textureLoader");class TextureLoader_SvgLoader{constructor(e){this.queue=e}async load(e){const t=await this.queue.get(e,{responseType:"text"}),i=document.createElement("div");i.innerHTML=t;const a=i.querySelector("svg");if(!a)throw Error("Failed trying to load "+e+"as an svg.");const r=a.getAttribute("width"),o=a.getAttribute("height");return r||o?(o&&!r&&(E.warn(e,"does not have a defined width. Defaulting width equal to height"),a.setAttribute("width",o)),r&&!o&&(E.warn(e,"does not have a defined height. Defaulting height equal to width"),a.setAttribute("height",r))):(E.warn(e,"does not have a defined size. Defaulting to a 128x128 resolution"),a.setAttribute("width",TextureLoader_SvgLoader.defaultResolution),a.setAttribute("height",TextureLoader_SvgLoader.defaultResolution)),new Promise((e=>{const t=new Image;t.onload=()=>e(t),t.src=URL.createObjectURL(new Blob([a.outerHTML],{type:"image/svg+xml"}))}))}}TextureLoader_SvgLoader.defaultResolution="128";var D,I,N;!function(e){e.Base64JPG="screenshot.base64.jpg",e.ArrayBufferJPG="screenshot.arraybuffer.jpg"}(D||(D={}));class EquirectangularExecutor{constructor(e,t,i){this.Viewmode=t.Viewmode,this.requestTarget=i.requestTarget,this.encodeRenderTarget=i.encodeRenderTarget,this.jpegAsBase64=i.jpegAsBase64,this.getXmp=i.getXmp,this.getOrientedAngleTo=i.getOrientedAngleTo,this.forward=new e.Vector3(0,0,-1),this.sweepForward=new e.Vector3,this.viewForward=new e.Vector3}validateInput(e){return e}async exec(e,t,i,a,r,o,n){if(!o.currentSweep||r.currentMode!==this.Viewmode.Panorama)throw new Error("Can only capture equirectangular projections while stationary in a sweep");const s=i.getScene().camera,d=o.getSweep(o.currentSweep),c=await n.load(d);this.sweepForward.copy(this.forward),this.sweepForward.copy(this.forward).applyQuaternion(d.rotation).setY(0);const l=this.getOrientedAngleTo(this.sweepForward,s.getWorldDirection(this.viewForward).setY(0))+Math.PI,h=await this.requestTarget();h.setSize(EquirectangularExecutor.equirectangularRes.width,EquirectangularExecutor.equirectangularRes.height),a.renderEquirectangular(c,h.target,l);const u=await this.encodeRenderTarget(h,this.getXmp(h.width,h.height,0,0));t.return(this.jpegAsBase64(u))}}EquirectangularExecutor.equirectangularRes={width:4096,height:2048},function(e){e.CLICK="INTERACTION.CLICK",e.HOVER="INTERACTION.HOVER",e.DRAG="INTERACTION.DRAG",e.DRAG_BEGIN="INTERACTION.DRAG_BEGIN",e.DRAG_END="INTERACTION.DRAG_END",e.POINTER_MOVE="INTERACTION.POINTER_MOVE",e.POINTER_BUTTON="INTERACTION.POINTER_BUTTON",e.SCROLL="INTERACTION.SCROLL",e.KEY="INTERACTION.KEY",e.LONG_PRESS_START="INTERACTION.LONG_PRESS_START",e.LONG_PRESS_END="INTERACTION.LONG_PRESS_END",e.MULTI_SWIPE="INTERACTION.MULTI_SWIPE",e.MULTI_SWIPE_END="INTERACTION.MULTI_SWIPE_END",e.PINCH="INTERACTION.PINCH",e.PINCH_END="INTERACTION.PINCH_END",e.ROTATE="INTERACTION.ROTATE",e.ROTATE_END="INTERACTION.ROTATE_END"}(I||(I={})),function(e){e.OBJ_LOADER="mp.objLoader",e.FBX_LOADER="mp.fbxLoader",e.DAE_LOADER="mp.daeLoader",e.GLTF_LOADER="mp.gltfLoader",e.SCROLLING_TUBE="mp.scrollingTube",e.TRANSFORM_CONTROLS="mp.transformControls",e.LIGHTS_COMPONENT="mp.lights",e.POINT_LIGHT="mp.pointLight",e.DIRECTIONAL_LIGHT="mp.directionalLight",e.AMBIENT_LIGHT="mp.ambientLight",e.CAMERA="mp.camera",e.INPUT="mp.input",e.XR="mp.xr"}(N||(N={}));class SensorReadingCollection{constructor(){this.sourceMap=new Map,this.reverseSourceLookup=new Map,this.sourceId=0,this._data={}}get data(){return this._data}isItemEqual(e,t){return e.data[t].inRange===this.data[t].inRange&&e.data[t].inView===this.data[t].inView}update(e){for(const[r,o]of e.readings){const e=this.addOrGetSourceId(r),n=this._data[e]||{};n.inRange=o.inRange,n.inView=o.inView,n.distanceSquared=o.distanceSq,n.direction=(t=o,i="direction",(a=(a=n.direction)||{}).x=t[i].x,a.y=t[i].y,a.z=t[i].z,a),this._data[e]=n}var t,i,a;for(const t in this.data){const i=this.reverseSourceLookup.get(t);i&&!e.readings.get(i)&&(this.sourceMap.delete(i),this.reverseSourceLookup.delete(t),delete this._data[t])}}clear(){this._data={}}addOrGetSourceId(e){const t=this.sourceMap.get(e);if(t)return t;const i="source-"+ ++this.sourceId;return this.sourceMap.set(e,i),this.reverseSourceLookup.set(i,e),i}}class DependencyFetcher_DependencyFetcher{constructor(...e){this.dependencies=e}async getDependencies(){return Promise.all(this.dependencies)}static extend(e,...t){return new DependencyFetcher_DependencyFetcher(...e.dependencies,...t)}static combine(e,t){return new DependencyFetcher_DependencyFetcher(...e.dependencies,...t.dependencies)}}class ClassFactory_ClassFactory{constructor(e,...t){this.ctor=e,this.args=t}create(){return new this.ctor(...this.args)}}class SdkCollection_SdkCollection{constructor(e,t,i){this.dependencies=e,this.subscriptionFactory=t,this.dataFactory=i,this.dirty=!0,this.observers=new Set,this.currentData=i.create();this.changeSubscription=this.subscriptionFactory.create(new class DirtinessObserver{constructor(e){this.collection=e}onChanged(){this.collection.dirty=!0;for(const e of this.collection.observers)e.onChanged()}}(this),...this.dependencies),this.changeSubscription.cancel()}static async create(e,t,i){const a=await e.getDependencies();return new SdkCollection_SdkCollection(a,t,i)}getData(){return this.currentData.data}subscribe(){const e=this.dependencies;const t=new class CollectionChangeObserver{constructor(e){this.sdkCollection=e,this.needsUpdate=!0,this.diffRecord={added:new Map,removed:new Map,updated:new Map},this.dataView=e.dataFactory.create()}get dirty(){return this.needsUpdate}readDiff(){const{added:t,removed:i,updated:a}=this.diffRecord;if(t.clear(),i.clear(),a.clear(),!this.dirty)return this.diffRecord;this.sdkCollection.update();const r=this.sdkCollection.currentData;for(const e in r.data)this.dataView.data.hasOwnProperty(e)?this.dataView.isItemEqual(r,e)||a.set(e,r.data[e]):t.set(e,r.data[e]);for(const e in this.dataView.data)r.data.hasOwnProperty(e)||i.set(e,this.dataView.data[e]);return this.dataView.update(...e),this.needsUpdate=!1,this.diffRecord}onChanged(){this.needsUpdate=!0}renew(){this.sdkCollection.addObserver(this)}cancel(){this.sdkCollection.removeObserver(this)}}(this);return this.addObserver(t),t}update(){this.dirty&&(this.currentData.update(...this.dependencies),this.dirty=!1)}addObserver(e){0===this.observers.size&&(this.changeSubscription.renew(),this.dirty=!0),this.observers.add(e)}removeObserver(e){this.observers.delete(e),0===this.observers.size&&(this.changeSubscription.cancel(),this.currentData.clear())}}var x=i(94326),P=i(40918);function O(e,t){!function(e,t){e.x=t.x,e.y=t.y}(e,t),e.z=t.z}var A=i(66363);class SensorStateObservable{constructor(){this._data={origin:{x:0,y:0,z:0},forward:{x:0,y:0,z:-1}}}get data(){return this._data}equals(e){const t=1e-5;return(0,A.wo)(this.data.origin,e.data.origin,t)&&(0,A.wo)(this.data.forward,e.data.forward,t)}copy(e){O(this._data.origin,e.data.origin),O(this._data.forward,e.data.forward)}update(e){O(this._data.origin,e.frustum.origin),O(this._data.forward,e.frustum.forward)}}function R(e,t){return Object.values(e).includes(t)}class executor_createSensor_CreateSensorExecutor{constructor(e,t){this.sdkModule=e,this.sensorFactories=t}validateInput(e){if(!R(x.dE,e.type))throw Error(e.type+" is not a valid sensor type");return this.sensorFactories[e.type].validateInput(e)}async exec(e,t,i,a,r){const o=this.sensorFactories[e.type].create(e,i),n="sensor-"+ ++executor_createSensor_CreateSensorExecutor.nextSensorId;a.set(n,o);const s=P.l.create(new DependencyFetcher_DependencyFetcher(o),new SensorStateSubscriptionFactory,new ClassFactory_ClassFactory(SensorStateObservable)),d=this.sdkModule.addObservable(n,s),c=SdkCollection_SdkCollection.create(new DependencyFetcher_DependencyFetcher(o),new SensorReadingSubscriptionFactory,new ClassFactory_ClassFactory(SensorReadingCollection)),l=this.sdkModule.addCollection(n,c);r.set(n,{dispose(){d.dispose(),l.dispose()}}),t.return({sensorId:n})}}executor_createSensor_CreateSensorExecutor.nextSensorId=0;class SensorStateSubscriptionFactory{create(e,t){return t.frustum.observe(new DependencyObserverAdaptor(e))}}class SensorReadingSubscriptionFactory{create(e,t){return t.onReadingsUpdated(new DependencyObserverAdaptor(e))}}class DependencyObserverAdaptor{constructor(e){this.dependencyObserver=e}notify(){this.dependencyObserver.onChanged()}}var k=i(60402);Math.PI;class executor_createSource_CreateSourceExecutor{constructor(e){this.sourceFactories=e}validateInput(e,t){if(!R(k.PO,e.type))throw Error(e.type+" is not a valid source type");return this.sourceFactories[e.type].validateInput(e)}exec(e,t,i){const a=this.sourceFactories[e.type].create(e),r="source-"+ ++executor_createSource_CreateSourceExecutor.nextSourceId;i.set(r,a),t.return({sourceId:r,type:e.type,volume:a.describeVolume()})}}executor_createSource_CreateSourceExecutor.nextSourceId=0;var L,_,F;!function(e){e.FPS="stat.fps"}(L||(L={}));!function(e){e.ALIGNED="aligned",e.UNALIGNED="unaligned"}(_||(_={})),function(e){e.UNPLACED="unplaced",e.AUTO="auto",e.MANUAL="manual"}(F||(F={}));var V,H,U=i(68524);class CurrentSweepObservable{constructor(e,t){this.currentSweep=Object.assign(Object.assign({},CurrentSweepObservable.empty),{floorInfo:Object.assign({},CurrentSweepObservable.empty.floorInfo),neighbors:[],position:Object.assign({},CurrentSweepObservable.empty.position),rotation:Object.assign({},CurrentSweepObservable.empty.rotation)}),this.Viewmode=e.Viewmode,this.sweepPlacementConverter=t.sweepPlacementConverter}get data(){return this.currentSweep}equals(e){const t=U.Z.epsilon;return this.currentSweep.id===e.data.id&&this.currentSweep.enabled===e.data.enabled&&this.currentSweep.alignmentType===e.data.alignmentType&&this.currentSweep.placementType===e.data.placementType&&this.currentSweep.floorInfo.id===e.data.floorInfo.id&&this.currentSweep.floorInfo.sequence===e.data.floorInfo.sequence&&this.compareNeighbors(e.currentSweep)&&(0,A.wo)(this.currentSweep.position,e.data.position,t)&&(0,A.wo)(this.currentSweep.rotation,e.data.rotation,t)}copy(e){this.copySweep(e.data)}update(e,t,i,a,r){const o=e.currentSweepObject;if(!o||e.transition.active||t.transition.active||!t.isInside()&&t.currentMode!==this.Viewmode.Outdoor)return void this.copySweep(CurrentSweepObservable.empty);let n;try{n=i.getFloor(o.floorId||"")}catch(e){n={id:void 0,index:void 0}}const s=a.getIdForSweep(o);this.currentSweep.uuid=o.uuid,this.currentSweep.sid=s,this.currentSweep.id=s,this.currentSweep.enabled=o.enabled,this.currentSweep.alignmentType=this.sweepPlacementConverter.toSdkAlignment(o.alignmentType),this.currentSweep.placementType=this.sweepPlacementConverter.toSdkPlacement(o.placementType),this.currentSweep.neighbors=[...o.neighbours],O(this.currentSweep.position,o.position),O(this.currentSweep.rotation,o.rotation),this.currentSweep.alignmentType===_.UNALIGNED&&this.currentSweep.placementType===F.UNPLACED?(this.currentSweep.floorInfo.id=void 0,this.currentSweep.floorInfo.sequence=void 0):(this.currentSweep.floorInfo.id=n.id?r.getIdFromCwfId(n.id):n.id,this.currentSweep.floorInfo.sequence=n.index)}copySweep(e){this.currentSweep.uuid=e.uuid,this.currentSweep.sid=e.sid,this.currentSweep.id=e.id,this.currentSweep.enabled=e.enabled,this.currentSweep.alignmentType=e.alignmentType,this.currentSweep.placementType=e.placementType,this.currentSweep.floorInfo.id=e.floorInfo.id,this.currentSweep.floorInfo.sequence=e.floorInfo.sequence,this.currentSweep.neighbors=[...e.neighbors],O(this.currentSweep.position,e.position),O(this.currentSweep.rotation,e.rotation)}compareNeighbors(e){const t=this.currentSweep.neighbors.length;for(let i=0;i<t;++i)if(this.currentSweep.neighbors[i]!==e.neighbors[i])return!1;return t===e.neighbors.length}}CurrentSweepObservable.empty={uuid:"",sid:"",id:"",enabled:!1,alignmentType:_.ALIGNED,placementType:F.UNPLACED,floorInfo:{id:void 0,sequence:void 0},neighbors:[],position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},function(e){e.ENTER="sweep.enter",e.EXIT="sweep.exit"}(V||(V={}));!function(e){e.STARTED="tour.started",e.STOPPED="tour.stopped",e.ENDED="tour.ended",e.STEPPED="tour.stepped"}(H||(H={}));new p.Z("sdk: tours");var G=i(8684),z=i(66223),B=i(87202),Z=i(76463),j=i(69626),q=i(27687),W=i(89683),Y=i(84561),K=i(3248),X=i(8150),Q=i(31278),J=i(49924),$=i(90454),ee=i(76896),te=i(2725),ie=i(98649),ae=i(41663),re=i(34986),oe=i(90756),ne=i(46610),se=i(60225),de=i(58014),ce=i(36123),le=i(29422),he=i(48470),ue=i(40554),pe=i(42835),me=i(61709),ge=i(17386);class SettingGetCommand extends ge.m{constructor(e){super(),this.payload={key:e}}}SettingGetCommand.id="SETTING_GET";class SettingUpdateCommand extends ge.m{constructor(e,t){super(),this.payload={key:e,value:t}}}SettingUpdateCommand.id="SETTING_UPDATE";var we=i(16101),Se=i(35026),ve=i(29397),fe=i(85895),ye=i(92532),Me=i(79553),Te=i(91302),Ce=i(87068),be=i(12216),Ee=i(5087),De=i(3805),Ie=i(68576),Ne=i(88814),xe=i(21479),Pe=i(59088),Oe=i(40168),Ae=i(26627),Re=i(27326),ke=i(74371),Le=i(40698),_e=i(58626),Fe=i(60725),Ve=i(38003),He=i(8445),Ue=i(44019),Ge=i(86488),ze=i(33874),Be=i(75892),Ze=i(65379),je=i(69941),qe=i(35597),We=i(15982),Ye=i(21499),Ke=i(36822),Xe=i(13988),Qe=i(14880),Je=i(78768),$e=i(92895),et=i(87738),tt=i(95395),it=i(29539),at=i(32306),rt=i(1466),ot=i(13827),nt=i(88269),st=i(3198),dt=i(9576),ct=i(55105),lt=i(31657),ht=i(2212),ut=i(67027);async function pt(e,t,i){const a=await async function(){return window.location.origin+window.location.pathname.slice(0,window.location.pathname.lastIndexOf("/")+1)+"sdk/sdk-interface.js"}(),r=new G.M;let o;try{o=await r.load(a)}catch(e){throw Error("Unable to fetch the sdk interface. The sdk will be disabled. "+e)}const s={THREE:ht},d={MpSdkAuthentication:W.w,RenderLayers:Y.o,OptionsKey:K.gx,Application:xe.Mx,AppPhase:xe.nh,AppPhaseChangeMessage:X.LZ,CameraTransitionType:Q.n,GetFloorIntersectCommand:J.Z,StartMoveToFloorMessage:$.S,EndMoveToFloorMessage:ee.P,MoveToFloorIndexCommand:te.h9,ShowAllFloorsCommand:te.EU,MattertagMediaType:ie.L,RemoveMattertagCommand:ae.Gn,TagDescriptionChunkType:re.z,TagLinkType:oe.U,AddMattertagCommand:ae.Fz,EditMattertagCommand:ae.Ek,MattertagLinkOpenedMessage:ne.Ik,NavigateToMattertagCommand:se.Y,ModelDataLoadedMessage:de.Z,ModelColliderTarget:ce.S,NavigateToSweepCommand:le.ju,MeasuringPhase:Fe.au,SettingGetCommand:SettingGetCommand,SettingUpdateCommand:SettingUpdateCommand,PuckCollider:we.YY,PinClickedMessage:he.F7,PinHoverChangeMessage:he.tP,PinHeadMesh:ue.$,InstancedPinHeads:me.z,PinType:pe.Er,SweepAlignmentType:Se.z9,SweepPlacementType:Se.hU,BeginMoveToSweepMessage:ve.Z,EndMoveToSweepMessage:fe.Z,ToggleToolCommand:ye.tT,Tools:Me.w1,TourStartedMessage:Te.oR,TourStoppedMessage:Te.NR,TourEndedMessage:Te.Mt,TourSteppedMessage:Te.Vx,Color:Ce.I,Vectors:be.f,Viewmode:Ee.Ey,CommandViewmode:De.BD,ChangeViewmodeCommand:De._i,BeginSwitchViewmodeMessage:Ie.Z,EndSwitchViewmodeMessage:Ne.Z,GetScreenPositionCommand:We.b,ZoomInCommand:Ye.bj,ZoomResetCommand:Ye.ob,ZoomSetCommand:Ye.ts,SourceType:ot.SourceType,sensorVolumes:{sphere:nt.b,box:st.k,cylinder:dt.X}},c=mt(t),l=function(e){const t=(async()=>{const t=(await e.getModule(tt.default)).getSignedUrls();return new Z.Z(t)})();return{applicationData:e.market.waitForData(xe.pu),cameraData:e.market.waitForData(Pe.M_),canvasData:e.market.waitForData(Oe.W),cursorController:e.getModuleBySymbol(h.y.CURSOR_CONTROLLER),deepLinks:e.getModuleBySymbol(h.y.DEEP_LINKS),floorData:e.market.waitForData(Ae.i),floorViewData:e.market.waitForData(Re.c),labelData:e.market.waitForData(ke.D),mattertagData:e.market.waitForData(Le.n),mattertagViewData:e.market.waitForData(_e.P5),measurementModeData:e.market.waitForData(Ve.X),modelData:e.market.waitForData(He.T),raycasterData:e.market.waitForData(Ue.P),roomData:e.market.waitForData(Ge.Z),settingsData:e.market.waitForData(ze.e),sweepData:e.market.waitForData(Be.Z),sweepViewData:e.market.waitForData(Ze.D),tourData:e.market.waitForData(je.k),viewmodeData:e.market.waitForData(qe.O),appPhaseModule:e.getModule(Ke.default),commonControlsModule:e.getModule(Xe.default),floorCasterModule:e.getModule(Qe.default),mattertagDataModule:e.getModule(Je.default),mattertagMeshModule:e.getModule($e.default),mattertagViewDataModule:e.getModule(et.default),meshQuery:e.getModuleBySymbol(h.y.MESH_QUERY),modelDataModule:e.getModule(tt.default),modelMeshModule:e.getModuleBySymbol(h.y.MODEL_MESH),meshData:e.market.waitForData(ut._),navigationModule:e.getModule(it.default),renderToTextureModule:e.getModule(at.default),sceneModule:e.getModuleBySymbol(h.y.SCENE),sensorModule:e.getModule(ct.K),settingsModule:e.getModuleBySymbol(h.y.SETTINGS),tourControlsModule:e.getModuleBySymbol(h.y.TOUR_CONTROLS),webglRendererModule:e.getModuleBySymbol(h.y.WEBGL_RENDERER),zoomControlModule:e.getModule(lt.default),sweepTextureLoader:t}}(t),u=new URLSearchParams(window.location.search).get("useLegacyIds"),p=null===u||parseInt(u,10)?n.LEGACY:n.API;o.setup(e,s,d,c,l,{idOption:p})}function mt(e){return{loadImage:z.p,waitForUpdate:()=>e.after(l.A.End),subscribe:(t,i)=>e.subscribe(t,i),addBinding:(t,i)=>e.commandBinder.addBinding(t,i),issueCommand:t=>e.commandBinder.issueCommand(t),requestTarget:()=>e.commandBinder.issueCommand(new B.oM),getRenderLayer:t=>e.getRenderLayer(t),jpegAsBase64:rt.jJ,encodeRenderTarget:rt.vP,getXmp:rt.fY,getOrientedAngleTo:j.k2,screenPositionToNDC:q.z5,ndcToWorldPosition:q.st,worldToScreenPosition:q.q9}}},61709:(e,t,i)=>{"use strict";i.d(t,{z:()=>InstancedPinHeads});var a=i(48358),r=i(88512),o=i(2212),n=i(4299),s=i(79386);const d=new r.Z("InstancedPinHeads");class InstancedPinHeads extends o.InstancedMesh{constructor(e,t,i,r){const d=new o.PlaneBufferGeometry(s.l,s.l),c=new Float32Array(e),l=new o.InstancedBufferAttribute(c,1);d.setAttribute("instanceAlpha",l);super(d,r&&i?new n.Vp(t,i):new n.m0(t,!0),e),this.maxCount=e,this.opacityArray=c,this.opacityAttrib=l,this.setColorAt(0,new o.Color),this.renderedPins=[],this.renderOrder=a.z.pins}update(e){let t=0;this.renderedPins.length=0;for(const i of e)i.visible&&(t>=this.maxCount?d.error("Instance count is too small!"):(this.setMatrixAt(t,i.pinHeadMatrix),this.setColorAt(t,i.pinColor),this.opacityArray[t]=i.opacity*i.opacityAnimation.value,t++,this.renderedPins.push(i)));this.count=t,this.visible=this.count>0,this.instanceMatrix.needsUpdate=!0,this.opacityAttrib.needsUpdate=!0,this.instanceColor?this.instanceColor.needsUpdate=!0:d.error("Instance color should be defined")}}},40554:(e,t,i)=>{"use strict";i.d(t,{$:()=>PinHeadMesh});var a=i(68524),r=i(48358),o=i(2212),n=i(49487),s=i(27408),d=i(79386);class PinHeadMesh extends o.Mesh{constructor(e,t,i,a){super(t,i),this.geomScale=new o.Vector3(1,1,1),this.userData.sid=e,this.worldPosition=new o.Vector3,this.cameraPosition=new o.Vector3,this.layers.mask=a.mask,this.renderOrder=r.z.pins,this.scale.set(.01,.01,.01)}dispose(){this.material.dispose(),this.geometry.dispose()}updatePosition(e){this.position.copy(e.stemNormal).setLength(Math.max(e.stemLength,.01))}update(e,t,i){const r=d.Z.pinHeadMesh.scale;this.getWorldPosition(this.worldPosition);const c=e.getWorldPosition(this.cameraPosition).distanceTo(this.worldPosition);this.quaternion.copy(e.quaternion);const l=r.maxSize-(r.maxSize-r.minSize)*(0,n.C)(c,r.nearBound,r.farBound),h=this.worldPosition.clone().project(e),u=new o.Vector3(i.width/2,i.height/2,1).multiply(h),p=new o.Vector3(l/2,0,0).add(u),m=new o.Vector3(2/i.width,2/i.height,1).multiply(p).clone().unproject(e).clone().distanceTo(this.worldPosition)*(1+r.responsiveness/100*(t-1)),g=(0,s.uZ)(m,a.Z.epsilon,m);this.scale.set(g*this.geomScale.x,g*this.geomScale.y,g*this.geomScale.z)}}},4299:(e,t,i)=>{"use strict";i.d(t,{Vp:()=>InstancedPinHeadMaterial,uW:()=>InstancedPinStemMaterial,m0:()=>PinHeadCustomMaterial,Nv:()=>PinHeadMaterial,Dx:()=>PinSelectedMaterial,l0:()=>PinStemMaterial});var a=i(2212),r=i(79386);const o={pinHead:{uniforms:{alpha:{type:"f",value:1},color:{type:"c",value:new a.Color},bg:{type:"t",value:null},mask:{type:"t",value:null}},vertexShader:i(34086),fragmentShader:i(36888)},pinStem:{uniforms:{pinHeadMatrix:{value:new a.Matrix4},resolution:{value:new a.Vector2},alpha:{value:1}},vertexShader:i(18934),fragmentShader:i(7532)},pinSelected:{vertexShader:i(18144),fragmentShader:i(81713)}};class PinHeadMaterial extends a.RawShaderMaterial{constructor(e,t,i,r){const n=a.UniformsUtils.clone(o.pinHead.uniforms);n.bg.value=t,n.mask.value=i,n.color.value.copy(e),n.alpha.value=r,super({fragmentShader:o.pinHead.fragmentShader,vertexShader:o.pinHead.vertexShader,uniforms:n,name:"PinHeadMaterial",transparent:!0})}}class PinStemMaterial extends a.RawShaderMaterial{constructor(){const e=a.UniformsUtils.clone(o.pinStem.uniforms);super({fragmentShader:o.pinStem.fragmentShader,vertexShader:o.pinStem.vertexShader,uniforms:e,name:"PinStemMaterial",linewidth:r.Z.stem.width,opacity:r.Z.stem.opacity,transparent:r.Z.stem.transparent,alphaTest:r.Z.stem.opacity*r.Z.stem.alphaTest})}}class InstancedPinStemMaterial extends a.RawShaderMaterial{constructor(){const e=a.UniformsUtils.clone(o.pinStem.uniforms);super({defines:{INSTANCED:!0},fragmentShader:o.pinStem.fragmentShader,vertexShader:o.pinStem.vertexShader,uniforms:e,name:"InstancedPinStemMaterial",linewidth:r.Z.stem.width,opacity:r.Z.stem.opacity,transparent:r.Z.stem.transparent,alphaTest:r.Z.stem.opacity*r.Z.stem.alphaTest})}}class InstancedPinHeadMaterial extends a.RawShaderMaterial{constructor(e,t){const i=a.UniformsUtils.clone(o.pinHead.uniforms);i.bg.value=e,i.mask.value=t,super({defines:{INSTANCED:!0},fragmentShader:o.pinHead.fragmentShader,vertexShader:o.pinHead.vertexShader,uniforms:i,name:"InstancedPinHeadMaterial",transparent:!0})}}class PinHeadCustomMaterial extends a.RawShaderMaterial{constructor(e,t){super({defines:{INSTANCED:t},vertexShader:i(79826),fragmentShader:i(64715),uniforms:{alpha:{value:1},tDiffuse:{value:e}},name:"InstancedPinHeadCustomMaterial",transparent:!0})}}class PinSelectedMaterial extends a.RawShaderMaterial{constructor(){super({depthTest:!0,depthWrite:!1,transparent:!0,side:a.DoubleSide,vertexShader:o.pinSelected.vertexShader,fragmentShader:o.pinSelected.fragmentShader})}}},79386:(e,t,i)=>{"use strict";i.d(t,{l:()=>a,Z:()=>r});const a=1,r=Object.freeze({anchor:{size:.1},stem:{length:.23,width:1,opacity:1,transparent:!0,color:"white",alphaTest:.05},pinHeadMesh:{scale:{nearBound:1.5,farBound:4.8,maxSize:80,minSize:40,baseViewportSize:800,responsiveness:100}}})},86383:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PuckClickedMessage});var a=i(91466);class PuckClickedMessage extends a.v{constructor(e,t,i){super(),this.sweepId=e,this.sweepIndex=t,this.totalSweeps=i}}},84394:(e,t,i)=>{"use strict";i.d(t,{Z:()=>PuckHoverMessage});var a=i(91466);class PuckHoverMessage extends a.v{constructor(e,t){super(),this.sweepId=e,this.hovered=t}}},16101:(e,t,i)=>{"use strict";i.d(t,{YY:()=>PuckCollider,C$:()=>PuckRenderer});var a=i(2212),r=i(95586),o=i(94610),n=i(35003),s=i(86383),d=i(84561),c=i(48358),l=i(35026),h=i(66999),u=i(84394);class PuckMesh extends a.Mesh{}class PuckCollider extends a.Mesh{}class PuckRenderer{constructor(e,t,i,r,o,n,s,c=new a.Color(16724312),l=new a.Color(16724312),h=.8,u=.8,p=300,m=.4,g=d.o.ALL){this.scene=e,this.input=t,this.settingsData=i,this.sweepViewData=r,this.puckImagery=o,this.onFloor=n,this.checkRenderModes=s,this.idleColor=c,this.selectionColor=l,this.idleOpacity=h,this.editingOpacity=u,this.selectionDuration=p,this.puckSize=m,this.layer=g,this.sweepToMesh={},this.colliderToSweep={},this.editingEnabled=!1,this.dummyMat=new a.MeshBasicMaterial,this.puckOffset=new a.Vector3(0,.05,0),this.bindings=[],this.wasDrawing=!1,this.renderPuckHighlight=(e,t)=>{if(!this.sweepViewData.isSweepAligned(e))return;const i=this.sweepToMesh[e].material.color;t?i.copy(this.selectionColor):i.copy(this.idleColor)},this.updateLookAt=e=>{this.sweepViewData.iterate((t=>{const i=this.sweepToMesh[t.id];i&&i.visible&&i.lookAt(e)}))}}init(){if(this.puckGeometry=new a.PlaneBufferGeometry(this.puckSize,this.puckSize),this.onFloor){const e=new a.Matrix4;e.makeRotationFromEuler(new a.Euler(-Math.PI/2,0,0,"XYZ")),this.puckGeometry.applyMatrix4(e)}this.sphereColliderGeometry=new a.SphereBufferGeometry(.5*this.puckSize,10,10),this.matParamsEnabled={color:this.idleColor.getHex(),opacity:this.idleOpacity,transparent:!0,depthWrite:!1,map:this.puckImagery.enabled},this.sweepViewData.iterate(this.createPuck.bind(this))}get displayDisabled(){return void 0!==this.puckImagery.disabled}onSweepStateAnimationChanged(e,t,i){const a=i.value,r=e.enabled?this.puckImagery.enabled:this.puckImagery.disabled,o=e.enabled?this.puckImagery.enabledHover:this.puckImagery.disabledHover,n=a>0&&this.editingEnabled,s=e.id===this.sweepViewData.selectedSweep,d=this.editingEnabled&&s?this.selectionColor:this.idleColor,c=this.editingEnabled?this.editingOpacity:this.idleOpacity;t.setValues({map:n?o:r}),t.color.copy(d),t.opacity=c*(1-a)+1*a}createMaterial(e){const t=new a.MeshBasicMaterial(this.matParamsEnabled);return this.puckImagery.disabled&&!e.enabled&&t.setValues({map:this.puckImagery.disabled}),this.bindings.push(e.onPropertyChanged("enabled",(()=>{t.setValues({map:e.enabled?this.puckImagery.enabled:this.puckImagery.disabled})}))),t}createMesh(e,t){const i=new PuckMesh(this.puckGeometry,t);this.onFloor?i.position.copy(e.floorPosition).add(this.puckOffset):(i.position.copy(e.position),i.rotation.setFromQuaternion(e.rotation)),i.name=e.id,i.updateMatrixWorld(!1),i.renderOrder=c.z.panoMarker;const a=this.sweepViewData.getState(e.id);return i.visible=a.visible,this.bindings.push(a.onPropertyChanged("visible",(e=>{i.visible=e}))),this.bindings.push(a.onPropertyChanged("animation",(i=>this.onSweepStateAnimationChanged(e,t,i)))),i.layers.mask=this.layer.mask,i}createCollider(e,t){let i;return i=this.onFloor?new PuckCollider(this.puckGeometry,this.dummyMat):new PuckCollider(this.sphereColliderGeometry,this.dummyMat),i.userData.sid=e.id,i.position.copy(t.position),i.rotation.copy(t.rotation),i.name=e.id,i.updateMatrixWorld(!1),i}createPuck(e){if(e.alignmentType!==l.z9.ALIGNED)return;const t=this.createMaterial(e),i=this.createMesh(e,t),a=this.createCollider(e,i);i.collider=a,this.sweepToMesh[e.id]=i,this.colliderToSweep[a.id]=e.id}toggleEditingEnabled(e){this.editingEnabled=e;for(const t in this.sweepToMesh){this.sweepToMesh[t].material.opacity=e?this.editingOpacity:this.idleOpacity}}getSweepId(e){return this.colliderToSweep[e]}updatePuckImagery(e){let t;this.displayDisabled||void 0===e.disabled?this.displayDisabled&&void 0===e.disabled&&(t=!1):t=!0,this.puckImagery=e,this.sweepViewData.iterate((e=>{if(e.alignmentType!==l.z9.ALIGNED)return;const i=this.sweepToMesh[e.id],a=this.sweepViewData.getState(e.id);i.visible=a.visible;let r=this.puckImagery.enabled;if(!e.enabled&&this.puckImagery.disabled&&(r=this.puckImagery.disabled),this.sweepToMesh[e.id].material.setValues({map:r}),void 0!==t){if(e.enabled)return;t?this.addSweepToScene(e.id):this.removeSweepFromScene(e.id)}}))}updateCheckRenderModes(e){this.checkRenderModes=e}removeSweepFromScene(e){const t=this.sweepToMesh[e];this.scene.remove(t),this.input.unregisterMesh(t.collider)}addSweepToScene(e){if(!this.sweepViewData.getSweep(e).enabled&&!this.displayDisabled)return;const t=this.sweepToMesh[e];this.scene.add(t),this.input.registerMesh(t.collider,!0)}render(){const e=this.checkRenderModes(),t=this.settingsData.tryGetProperty(h.U,!0);if(e&&t){if(!this.wasDrawing){for(const e in this.sweepToMesh)this.addSweepToScene(e);this.wasDrawing=!0}}else if(this.wasDrawing){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);this.wasDrawing=!1}}dispose(){for(const e in this.sweepToMesh){const t=this.sweepToMesh[e];t.material.dispose(),t.geometry.dispose()}}activate(e){this.wasDrawing=!1;const t=new PuckComparator(this.sweepViewData);this.bindings.push(this.input.registerMeshHandler(o.z,t,((t,i)=>{e.commandBinder.issueCommand(new r.kR(this.getSweepId(i.id),!0,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!0))}))),this.bindings.push(this.input.registerMeshHandler(o.A,t,((t,i)=>{e.commandBinder.issueCommand(new r.kR(this.getSweepId(i.id),!1,this.selectionDuration)),e.broadcast(new u.Z(this.getSweepId(i.id),!1))}))),this.bindings.push(this.input.registerMeshHandler(n.R,t,((t,i)=>{const a=this.sweepViewData.getSweep(this.colliderToSweep[i.id]).index,r=this.sweepViewData.getAlignedSweeps(!0).length;e.broadcast(new s.Z(this.colliderToSweep[i.id],a,r))})))}deactivate(e){for(const e in this.sweepToMesh)this.removeSweepFromScene(e);for(const e of this.bindings)e.cancel();this.bindings.length=0}}class PuckComparator{constructor(e){this.sweepViewData=e}compare(e){if(e instanceof PuckCollider){return this.sweepViewData.getSweepVisibility(this.sweepViewData.getSweep(e.userData.sid))}return!1}}},49487:(e,t,i)=>{"use strict";function a(e,t,i){return e<=t?0:e>=i?1:(e=(e-t)/(i-t))*e*(3-2*e)}i.d(t,{C:()=>a})},36888:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;\n#ifdef INSTANCED\nvarying float alpha;varying vec3 color;\n#else\nuniform float alpha;uniform vec3 color;\n#endif\nuniform sampler2D bg;uniform sampler2D mask;varying vec2 vUv;void main(){vec4 bgColor=texture2D(bg,vUv);if(bgColor.a*alpha<0.1){discard;}vec4 maskColor=texture2D(mask,vUv);vec3 mappedColor=mix(color,maskColor.rgb,maskColor.a);gl_FragColor=vec4(mappedColor,bgColor.a*alpha);}"},34086:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute float instanceAlpha;attribute vec3 instanceColor;varying float alpha;varying vec3 color;\n#endif\nvoid main(){vUv=uv;\n#ifdef INSTANCED\nalpha=instanceAlpha;color=instanceColor;gl_Position=projectionMatrix*modelViewMatrix*instanceMatrix*vec4(position,1.);\n#else\ngl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);\n#endif\n}"},81713:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;varying vec2 vUv;void main(){float dist=length(vUv);float alpha=(1.-smoothstep(0.95,1.,dist))*0.3;gl_FragColor=vec4(1.,1.,1.,alpha);}"},18144:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;varying vec2 vUv;void main(){vUv=(uv*2.)-1.;gl_Position=projectionMatrix*modelViewMatrix*vec4(position,1.);gl_Position.z*=1.00001;}"},7532:e=>{e.exports="precision highp float;precision highp int;uniform mat4 viewMatrix;uniform vec3 cameraPosition;\n#ifdef INSTANCED\nvarying float alpha;\n#else\nuniform float alpha;\n#endif\nvoid main(){gl_FragColor=vec4(1.,1.,1.,alpha);}"},18934:e=>{e.exports="precision highp float;precision highp int;uniform mat4 modelMatrix;uniform mat4 modelViewMatrix;uniform mat4 projectionMatrix;uniform mat4 viewMatrix;uniform mat3 normalMatrix;uniform vec3 cameraPosition;attribute vec3 position;attribute vec3 normal;attribute vec2 uv;uniform vec2 resolution;\n#ifdef INSTANCED\nattribute mat4 instanceMatrix;attribute vec3 stemVector;attribute vec4 pinHeadMatrixCol0;attribute vec4 pinHeadMatrixCol1;attribute vec4 pinHeadMatrixCol2;attribute vec4 pinHeadMatrixCol3;attribute float instanceAlpha;varying float alpha;\n#else\nuniform mat4 pinHeadMatrix;\n#endif\n#define PI  3.1415926538\nvoid main(){\n#ifdef INSTANCED\nvec3 pos=position*stemVector;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix*instanceMatrix;mat4 pinHeadMatrix=mat4(pinHeadMatrixCol0,pinHeadMatrixCol1,pinHeadMatrixCol2,pinHeadMatrixCol3);alpha=instanceAlpha;\n#else\nvec3 pos=position;mat4 modelViewProjMatrix=projectionMatrix*modelViewMatrix;\n#endif\nvec3 fromOrigin=(vec3(0.,0.,0.)-pos);if(length(fromOrigin)<1e-6){gl_Position=modelViewProjMatrix*vec4(pos,1.);}else{mat4 noteViewProj=projectionMatrix*viewMatrix*pinHeadMatrix;vec4 noteNDC=noteViewProj*vec4(0.,0.,0.,1.);noteNDC.xyz/=abs(noteNDC.w);vec4 discEdgeNDC=noteViewProj*vec4(0.5,0.,0.,1.);discEdgeNDC.xyz/=abs(discEdgeNDC.w);float noteSizeNDC=length(discEdgeNDC.xy-noteNDC.xy);vec4 anchorNDC=modelViewProjMatrix*vec4(0.,0.,0.,1.);anchorNDC.xyz/=abs(anchorNDC.w);vec4 vectorNDC=modelViewProjMatrix*vec4(pos,1.);vectorNDC.xyz/=abs(vectorNDC.w);vectorNDC-=anchorNDC;float lineLengthNDC=length(vectorNDC.xy);float vertDot=abs(dot(normalize(vectorNDC.xy),vec2(0,1)));float angle=acos(vertDot)/(PI/2.);float aspect=mix(resolution.x/resolution.y,1.,angle);vec2 vector2d=normalize(vectorNDC.xy)*max(lineLengthNDC-noteSizeNDC*aspect,0.);vectorNDC.xy=vector2d.xy;vectorNDC+=anchorNDC;gl_Position=vec4(vectorNDC.xyz,1.);}}"}}]);